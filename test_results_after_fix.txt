--- SUITE A: SMOKE TESTS ---
Running basic tests to ensure the API is online and responsive...
# Test A.1: Basic ADDITION request
{
  "success": true,
  "question": {
    "text": "Charlotte buys a apple for £4 and a banana for £1. What is the total cost?",
    "options": [
      {
        "text": "3",
        "value": 3,
        "index": 0
      },
      {
        "text": "£5.00",
        "value": 5,
        "index": 1
      },
      {
        "text": "6",
        "value": 6,
        "index": 2
      },
      {
        "text": "4",
        "value": 4,
        "index": 3
      }
    ],
    "correctIndex": 1,
    "format": "DIRECT_CALCULATION",
    "difficulty": {
      "year": 1,
      "subLevel": 1,
      "displayName": "1.1",
      "cognitiveLoad": 10
    },
    "cognitiveLoad": 10,
    "curriculumTags": [
      "1N1a",
      "1N1b"
    ],
    "scenario": {
      "id": "shop-002-realistic-general",
      "theme": "SHOPPING",
      "setting": {
        "location": "local shop",
        "timeContext": "after school",
        "atmosphere": "friendly"
      },
      "characters": [
        {
          "name": "Charlotte",
          "role": "student"
        }
      ],
      "items": [
        {
          "name": "apple",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.2,
            "max": 0.5,
            "typical": 0.35,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "banana",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.15,
            "max": 0.4,
            "typical": 0.25,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "sandwich",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 2.5,
            "max": 6,
            "typical": 4,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "drink",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.8,
            "max": 2.5,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "cake",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 1.5,
            "max": 4,
            "typical": 2.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "biscuit",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.8,
            "max": 2,
            "typical": 1.2,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "sweet",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.1,
            "max": 1,
            "typical": 0.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "chocolate",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.6,
            "max": 3,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "pen",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.5,
            "max": 2,
            "typical": 1,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "pencil",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.2,
            "max": 1,
            "typical": 0.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "ruler",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.8,
            "max": 2.5,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "notebook",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 1,
            "max": 4,
            "typical": 2,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "eraser",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.3,
            "max": 1.5,
            "typical": 0.75,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "book",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 3,
            "max": 15,
            "typical": 8,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "comic",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 2,
            "max": 5,
            "typical": 3,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "magazine",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 2.5,
            "max": 6,
            "typical": 4,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "toy",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 5,
            "max": 25,
            "typical": 12,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "game",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 8,
            "max": 60,
            "typical": 25,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "puzzle",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 5,
            "max": 20,
            "typical": 12,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "sticker",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 0.2,
            "max": 2,
            "typical": 0.8,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "badge",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 0.5,
            "max": 3,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "poster",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 2,
            "max": 8,
            "typical": 4,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "card",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 0.5,
            "max": 4,
            "typical": 2,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        }
      ],
      "culturalElements": [
        {
          "type": "currency",
          "value": "£",
          "explanation": "British pounds"
        },
        {
          "type": "location",
          "value": "UK local shop",
          "explanation": "Typical British corner shop"
        }
      ],
      "realWorldConnection": "Everyday shopping with realistic UK prices",
      "yearAppropriate": [
        1,
        2,
        3,
        4,
        5,
        6
      ],
      "templates": [
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "MULTI_STEP"
          ],
          "modelCompatibility": [
            "ADDITION"
          ],
          "operandCount": 3,
          "template": "{character} buys a {item1} for {price1}, a {item2} for {price2}, and a {item3} for {price3}. What is the total cost?",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item1",
              "type": "item"
            },
            {
              "key": "item2",
              "type": "item"
            },
            {
              "key": "item3",
              "type": "item"
            },
            {
              "key": "price1",
              "type": "value"
            },
            {
              "key": "price2",
              "type": "value"
            },
            {
              "key": "price3",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "MULTI_STEP"
          ],
          "modelCompatibility": [
            "ADDITION"
          ],
          "operandCount": 2,
          "template": "{character} buys a {item1} for {price1} and a {item2} for {price2}. What is the total cost?",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item1",
              "type": "item"
            },
            {
              "key": "item2",
              "type": "item"
            },
            {
              "key": "price1",
              "type": "value"
            },
            {
              "key": "price2",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION"
          ],
          "modelCompatibility": [
            "SUBTRACTION",
            "CHANGE_CALCULATION"
          ],
          "template": "{character} buys a {item} for {price} and pays with {payment}. How much change does {character} get?",
          "answerTemplate": "{character} receives {result} in change",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "price",
              "type": "value"
            },
            {
              "key": "payment",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION"
          ],
          "modelCompatibility": [
            "MULTIPLICATION"
          ],
          "template": "{character} buys {quantity} {item} at {price} each. What is the total cost?",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "quantity",
              "type": "value"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "price",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION"
          ],
          "modelCompatibility": [
            "DIVISION"
          ],
          "template": "{character} has {total} to spend equally on {quantity} {item}. How much can {character} spend on each one?",
          "answerTemplate": "{character} can spend {result} on each {item}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "total",
              "type": "value"
            },
            {
              "key": "quantity",
              "type": "value"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "COMPARISON",
            "ESTIMATION",
            "MULTI_STEP"
          ],
          "template": "{character} goes to the shop and buys {items}. How much does {character} spend in total?",
          "answerTemplate": "{character} spends {result} in total",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "items",
              "type": "item_list"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "ESTIMATION"
          ],
          "template": "Estimate: If {character} buys {items}, about how much will it cost?",
          "answerTemplate": "It will cost approximately {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "items",
              "type": "item_list"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "VALIDATION"
          ],
          "template": "{character} calculated that {items} costs {amount}. Is this correct?",
          "answerTemplate": "{validation_result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "items",
              "type": "item_list"
            },
            {
              "key": "amount",
              "type": "value"
            },
            {
              "key": "validation_result",
              "type": "boolean"
            }
          ]
        }
      ]
    },
    "distractors": [
      {
        "value": 3,
        "displayText": "3",
        "strategy": "WRONG_OPERATION",
        "reasoning": "Subtracted instead of adding"
      },
      {
        "value": 4,
        "displayText": "4",
        "strategy": "WRONG_OPERATION",
        "reasoning": "Multiplied instead of adding"
      },
      {
        "value": 6,
        "displayText": "6",
        "strategy": "CLOSE_VALUE",
        "reasoning": "Off by 1"
      }
    ],
    "enhancementStatus": {
      "level": "partial",
      "requestedFormat": "DIRECT_CALCULATION",
      "actualFormat": "DIRECT_CALCULATION",
      "featuresActive": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "featuresPending": [],
      "isFullyEnhanced": true
    },
    "mathOutput": {
      "operation": "ADDITION",
      "operand_1": 4,
      "operand_2": 1,
      "result": 5
    },
    "generationTime": 0,
    "questionId": "q_1759077132325_6j4t052ng",
    "generationSetup": {
      "controller_used": "DIRECT_CALCULATIONController",
      "format_requested": "DIRECT_CALCULATION",
      "format_actual": "DIRECT_CALCULATION",
      "scenario_theme": "SHOPPING",
      "scenario_id": "shop-002-realistic-general",
      "scenario_selection_method": "default",
      "distractor_strategies": [
        "WRONG_OPERATION",
        "WRONG_OPERATION",
        "CLOSE_VALUE"
      ],
      "distractor_count": 3,
      "theme_variety": false,
      "format_variety": false,
      "enhancement_level": "partial",
      "features_active": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "features_pending": [],
      "generation_time_ms": 0
    }
  },
  "metadata": {
    "format": "DIRECT_CALCULATION",
    "cognitive_load": 10,
    "curriculum_alignment": [
      "1N1a",
      "1N1b"
    ],
    "difficulty": "1.1",
    "scenario_theme": "SHOPPING",
    "distractor_strategies": [
      "WRONG_OPERATION",
      "WRONG_OPERATION",
      "CLOSE_VALUE"
    ],
    "generation_time_ms": 0,
    "api_version": "2.0",
    "enhancement_status": "partial",
    "format_requested": "DIRECT_CALCULATION",
    "format_used": "DIRECT_CALCULATION",
    "features_active": [
      "enhanced_distractors",
      "rich_scenarios",
      "cognitive_load",
      "advanced_formats"
    ],
    "features_pending": []
  },
  "context": {
    "id": "shop-002-realistic-general",
    "theme": "SHOPPING",
    "setting": {
      "location": "local shop",
      "timeContext": "after school",
      "atmosphere": "friendly"
    },
    "characters": [
      {
        "name": "Charlotte",
        "role": "student"
      }
    ],
    "items": [
      {
        "name": "apple",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.2,
          "max": 0.5,
          "typical": 0.35,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "banana",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.15,
          "max": 0.4,
          "typical": 0.25,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "sandwich",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 2.5,
          "max": 6,
          "typical": 4,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "drink",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.8,
          "max": 2.5,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "cake",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 1.5,
          "max": 4,
          "typical": 2.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "biscuit",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.8,
          "max": 2,
          "typical": 1.2,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "sweet",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.1,
          "max": 1,
          "typical": 0.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "chocolate",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.6,
          "max": 3,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "pen",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.5,
          "max": 2,
          "typical": 1,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "pencil",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.2,
          "max": 1,
          "typical": 0.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "ruler",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.8,
          "max": 2.5,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "notebook",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 1,
          "max": 4,
          "typical": 2,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "eraser",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.3,
          "max": 1.5,
          "typical": 0.75,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "book",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 3,
          "max": 15,
          "typical": 8,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "comic",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 2,
          "max": 5,
          "typical": 3,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "magazine",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 2.5,
          "max": 6,
          "typical": 4,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "toy",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 5,
          "max": 25,
          "typical": 12,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "game",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 8,
          "max": 60,
          "typical": 25,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "puzzle",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 5,
          "max": 20,
          "typical": 12,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "sticker",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 0.2,
          "max": 2,
          "typical": 0.8,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "badge",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 0.5,
          "max": 3,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "poster",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 2,
          "max": 8,
          "typical": 4,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "card",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 0.5,
          "max": 4,
          "typical": 2,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      }
    ],
    "culturalElements": [
      {
        "type": "currency",
        "value": "£",
        "explanation": "British pounds"
      },
      {
        "type": "location",
        "value": "UK local shop",
        "explanation": "Typical British corner shop"
      }
    ],
    "realWorldConnection": "Everyday shopping with realistic UK prices",
    "yearAppropriate": [
      1,
      2,
      3,
      4,
      5,
      6
    ],
    "templates": [
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "MULTI_STEP"
        ],
        "modelCompatibility": [
          "ADDITION"
        ],
        "operandCount": 3,
        "template": "{character} buys a {item1} for {price1}, a {item2} for {price2}, and a {item3} for {price3}. What is the total cost?",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item1",
            "type": "item"
          },
          {
            "key": "item2",
            "type": "item"
          },
          {
            "key": "item3",
            "type": "item"
          },
          {
            "key": "price1",
            "type": "value"
          },
          {
            "key": "price2",
            "type": "value"
          },
          {
            "key": "price3",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "MULTI_STEP"
        ],
        "modelCompatibility": [
          "ADDITION"
        ],
        "operandCount": 2,
        "template": "{character} buys a {item1} for {price1} and a {item2} for {price2}. What is the total cost?",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item1",
            "type": "item"
          },
          {
            "key": "item2",
            "type": "item"
          },
          {
            "key": "price1",
            "type": "value"
          },
          {
            "key": "price2",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION"
        ],
        "modelCompatibility": [
          "SUBTRACTION",
          "CHANGE_CALCULATION"
        ],
        "template": "{character} buys a {item} for {price} and pays with {payment}. How much change does {character} get?",
        "answerTemplate": "{character} receives {result} in change",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "price",
            "type": "value"
          },
          {
            "key": "payment",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION"
        ],
        "modelCompatibility": [
          "MULTIPLICATION"
        ],
        "template": "{character} buys {quantity} {item} at {price} each. What is the total cost?",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "quantity",
            "type": "value"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "price",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION"
        ],
        "modelCompatibility": [
          "DIVISION"
        ],
        "template": "{character} has {total} to spend equally on {quantity} {item}. How much can {character} spend on each one?",
        "answerTemplate": "{character} can spend {result} on each {item}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "total",
            "type": "value"
          },
          {
            "key": "quantity",
            "type": "value"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "COMPARISON",
          "ESTIMATION",
          "MULTI_STEP"
        ],
        "template": "{character} goes to the shop and buys {items}. How much does {character} spend in total?",
        "answerTemplate": "{character} spends {result} in total",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "items",
            "type": "item_list"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "ESTIMATION"
        ],
        "template": "Estimate: If {character} buys {items}, about how much will it cost?",
        "answerTemplate": "It will cost approximately {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "items",
            "type": "item_list"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "VALIDATION"
        ],
        "template": "{character} calculated that {items} costs {amount}. Is this correct?",
        "answerTemplate": "{validation_result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "items",
            "type": "item_list"
          },
          {
            "key": "amount",
            "type": "value"
          },
          {
            "key": "validation_result",
            "type": "boolean"
          }
        ]
      }
    ]
  }
}
# Test A.2: Basic SUBTRACTION request
{
  "success": true,
  "question": {
    "text": "Charlotte buys a apple for £2 and pays with £4. How much change does Charlotte get?",
    "options": [
      {
        "text": "1",
        "value": 1,
        "index": 0
      },
      {
        "text": "6",
        "value": 6,
        "index": 1
      },
      {
        "text": "£2.00",
        "value": 2,
        "index": 2
      },
      {
        "text": "3",
        "value": 3,
        "index": 3
      }
    ],
    "correctIndex": 2,
    "format": "DIRECT_CALCULATION",
    "difficulty": {
      "year": 1,
      "subLevel": 2,
      "displayName": "1.2",
      "cognitiveLoad": 15
    },
    "cognitiveLoad": 15,
    "curriculumTags": [
      "1N1c",
      "1N1d"
    ],
    "scenario": {
      "id": "shop-002-realistic-general",
      "theme": "SHOPPING",
      "setting": {
        "location": "local shop",
        "timeContext": "after school",
        "atmosphere": "friendly"
      },
      "characters": [
        {
          "name": "Charlotte",
          "role": "student"
        }
      ],
      "items": [
        {
          "name": "apple",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.2,
            "max": 0.5,
            "typical": 0.35,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "banana",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.15,
            "max": 0.4,
            "typical": 0.25,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "sandwich",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 2.5,
            "max": 6,
            "typical": 4,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "drink",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.8,
            "max": 2.5,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "cake",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 1.5,
            "max": 4,
            "typical": 2.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "biscuit",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.8,
            "max": 2,
            "typical": 1.2,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "sweet",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.1,
            "max": 1,
            "typical": 0.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "chocolate",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.6,
            "max": 3,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "pen",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.5,
            "max": 2,
            "typical": 1,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "pencil",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.2,
            "max": 1,
            "typical": 0.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "ruler",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.8,
            "max": 2.5,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "notebook",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 1,
            "max": 4,
            "typical": 2,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "eraser",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.3,
            "max": 1.5,
            "typical": 0.75,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "book",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 3,
            "max": 15,
            "typical": 8,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "comic",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 2,
            "max": 5,
            "typical": 3,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "magazine",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 2.5,
            "max": 6,
            "typical": 4,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "toy",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 5,
            "max": 25,
            "typical": 12,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "game",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 8,
            "max": 60,
            "typical": 25,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "puzzle",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 5,
            "max": 20,
            "typical": 12,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "sticker",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 0.2,
            "max": 2,
            "typical": 0.8,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "badge",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 0.5,
            "max": 3,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "poster",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 2,
            "max": 8,
            "typical": 4,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "card",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 0.5,
            "max": 4,
            "typical": 2,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        }
      ],
      "culturalElements": [
        {
          "type": "currency",
          "value": "£",
          "explanation": "British pounds"
        },
        {
          "type": "location",
          "value": "UK local shop",
          "explanation": "Typical British corner shop"
        }
      ],
      "realWorldConnection": "Everyday shopping with realistic UK prices",
      "yearAppropriate": [
        1,
        2,
        3,
        4,
        5,
        6
      ],
      "templates": [
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "MULTI_STEP"
          ],
          "modelCompatibility": [
            "ADDITION"
          ],
          "operandCount": 3,
          "template": "{character} buys a {item1} for {price1}, a {item2} for {price2}, and a {item3} for {price3}. What is the total cost?",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item1",
              "type": "item"
            },
            {
              "key": "item2",
              "type": "item"
            },
            {
              "key": "item3",
              "type": "item"
            },
            {
              "key": "price1",
              "type": "value"
            },
            {
              "key": "price2",
              "type": "value"
            },
            {
              "key": "price3",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "MULTI_STEP"
          ],
          "modelCompatibility": [
            "ADDITION"
          ],
          "operandCount": 2,
          "template": "{character} buys a {item1} for {price1} and a {item2} for {price2}. What is the total cost?",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item1",
              "type": "item"
            },
            {
              "key": "item2",
              "type": "item"
            },
            {
              "key": "price1",
              "type": "value"
            },
            {
              "key": "price2",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION"
          ],
          "modelCompatibility": [
            "SUBTRACTION",
            "CHANGE_CALCULATION"
          ],
          "template": "{character} buys a {item} for {price} and pays with {payment}. How much change does {character} get?",
          "answerTemplate": "{character} receives {result} in change",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "price",
              "type": "value"
            },
            {
              "key": "payment",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION"
          ],
          "modelCompatibility": [
            "MULTIPLICATION"
          ],
          "template": "{character} buys {quantity} {item} at {price} each. What is the total cost?",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "quantity",
              "type": "value"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "price",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION"
          ],
          "modelCompatibility": [
            "DIVISION"
          ],
          "template": "{character} has {total} to spend equally on {quantity} {item}. How much can {character} spend on each one?",
          "answerTemplate": "{character} can spend {result} on each {item}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "total",
              "type": "value"
            },
            {
              "key": "quantity",
              "type": "value"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "COMPARISON",
            "ESTIMATION",
            "MULTI_STEP"
          ],
          "template": "{character} goes to the shop and buys {items}. How much does {character} spend in total?",
          "answerTemplate": "{character} spends {result} in total",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "items",
              "type": "item_list"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "ESTIMATION"
          ],
          "template": "Estimate: If {character} buys {items}, about how much will it cost?",
          "answerTemplate": "It will cost approximately {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "items",
              "type": "item_list"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "VALIDATION"
          ],
          "template": "{character} calculated that {items} costs {amount}. Is this correct?",
          "answerTemplate": "{validation_result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "items",
              "type": "item_list"
            },
            {
              "key": "amount",
              "type": "value"
            },
            {
              "key": "validation_result",
              "type": "boolean"
            }
          ]
        }
      ]
    },
    "distractors": [
      {
        "value": 6,
        "displayText": "6",
        "strategy": "WRONG_OPERATION",
        "reasoning": "Added instead of subtracting"
      },
      {
        "value": 3,
        "displayText": "3",
        "strategy": "CLOSE_VALUE",
        "reasoning": "Off by 1"
      },
      {
        "value": 1,
        "displayText": "1",
        "strategy": "CLOSE_VALUE",
        "reasoning": "Off by 1"
      }
    ],
    "enhancementStatus": {
      "level": "partial",
      "requestedFormat": "DIRECT_CALCULATION",
      "actualFormat": "DIRECT_CALCULATION",
      "featuresActive": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "featuresPending": [],
      "isFullyEnhanced": true
    },
    "mathOutput": {
      "operation": "SUBTRACTION",
      "minuend": 4,
      "subtrahend": 2,
      "result": 2
    },
    "generationTime": 0,
    "questionId": "q_1759077132374_fwlhbzdo0",
    "generationSetup": {
      "controller_used": "DIRECT_CALCULATIONController",
      "format_requested": "DIRECT_CALCULATION",
      "format_actual": "DIRECT_CALCULATION",
      "scenario_theme": "SHOPPING",
      "scenario_id": "shop-002-realistic-general",
      "scenario_selection_method": "default",
      "distractor_strategies": [
        "WRONG_OPERATION",
        "CLOSE_VALUE",
        "CLOSE_VALUE"
      ],
      "distractor_count": 3,
      "theme_variety": false,
      "format_variety": false,
      "enhancement_level": "partial",
      "features_active": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "features_pending": [],
      "generation_time_ms": 0
    }
  },
  "metadata": {
    "format": "DIRECT_CALCULATION",
    "cognitive_load": 15,
    "curriculum_alignment": [
      "1N1c",
      "1N1d"
    ],
    "difficulty": "1.2",
    "scenario_theme": "SHOPPING",
    "distractor_strategies": [
      "WRONG_OPERATION",
      "CLOSE_VALUE",
      "CLOSE_VALUE"
    ],
    "generation_time_ms": 0,
    "api_version": "2.0",
    "enhancement_status": "partial",
    "format_requested": "DIRECT_CALCULATION",
    "format_used": "DIRECT_CALCULATION",
    "features_active": [
      "enhanced_distractors",
      "rich_scenarios",
      "cognitive_load",
      "advanced_formats"
    ],
    "features_pending": []
  },
  "context": {
    "id": "shop-002-realistic-general",
    "theme": "SHOPPING",
    "setting": {
      "location": "local shop",
      "timeContext": "after school",
      "atmosphere": "friendly"
    },
    "characters": [
      {
        "name": "Charlotte",
        "role": "student"
      }
    ],
    "items": [
      {
        "name": "apple",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.2,
          "max": 0.5,
          "typical": 0.35,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "banana",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.15,
          "max": 0.4,
          "typical": 0.25,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "sandwich",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 2.5,
          "max": 6,
          "typical": 4,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "drink",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.8,
          "max": 2.5,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "cake",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 1.5,
          "max": 4,
          "typical": 2.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "biscuit",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.8,
          "max": 2,
          "typical": 1.2,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "sweet",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.1,
          "max": 1,
          "typical": 0.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "chocolate",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.6,
          "max": 3,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "pen",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.5,
          "max": 2,
          "typical": 1,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "pencil",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.2,
          "max": 1,
          "typical": 0.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "ruler",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.8,
          "max": 2.5,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "notebook",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 1,
          "max": 4,
          "typical": 2,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "eraser",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.3,
          "max": 1.5,
          "typical": 0.75,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "book",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 3,
          "max": 15,
          "typical": 8,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "comic",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 2,
          "max": 5,
          "typical": 3,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "magazine",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 2.5,
          "max": 6,
          "typical": 4,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "toy",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 5,
          "max": 25,
          "typical": 12,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "game",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 8,
          "max": 60,
          "typical": 25,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "puzzle",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 5,
          "max": 20,
          "typical": 12,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "sticker",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 0.2,
          "max": 2,
          "typical": 0.8,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "badge",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 0.5,
          "max": 3,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "poster",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 2,
          "max": 8,
          "typical": 4,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "card",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 0.5,
          "max": 4,
          "typical": 2,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      }
    ],
    "culturalElements": [
      {
        "type": "currency",
        "value": "£",
        "explanation": "British pounds"
      },
      {
        "type": "location",
        "value": "UK local shop",
        "explanation": "Typical British corner shop"
      }
    ],
    "realWorldConnection": "Everyday shopping with realistic UK prices",
    "yearAppropriate": [
      1,
      2,
      3,
      4,
      5,
      6
    ],
    "templates": [
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "MULTI_STEP"
        ],
        "modelCompatibility": [
          "ADDITION"
        ],
        "operandCount": 3,
        "template": "{character} buys a {item1} for {price1}, a {item2} for {price2}, and a {item3} for {price3}. What is the total cost?",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item1",
            "type": "item"
          },
          {
            "key": "item2",
            "type": "item"
          },
          {
            "key": "item3",
            "type": "item"
          },
          {
            "key": "price1",
            "type": "value"
          },
          {
            "key": "price2",
            "type": "value"
          },
          {
            "key": "price3",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "MULTI_STEP"
        ],
        "modelCompatibility": [
          "ADDITION"
        ],
        "operandCount": 2,
        "template": "{character} buys a {item1} for {price1} and a {item2} for {price2}. What is the total cost?",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item1",
            "type": "item"
          },
          {
            "key": "item2",
            "type": "item"
          },
          {
            "key": "price1",
            "type": "value"
          },
          {
            "key": "price2",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION"
        ],
        "modelCompatibility": [
          "SUBTRACTION",
          "CHANGE_CALCULATION"
        ],
        "template": "{character} buys a {item} for {price} and pays with {payment}. How much change does {character} get?",
        "answerTemplate": "{character} receives {result} in change",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "price",
            "type": "value"
          },
          {
            "key": "payment",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION"
        ],
        "modelCompatibility": [
          "MULTIPLICATION"
        ],
        "template": "{character} buys {quantity} {item} at {price} each. What is the total cost?",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "quantity",
            "type": "value"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "price",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION"
        ],
        "modelCompatibility": [
          "DIVISION"
        ],
        "template": "{character} has {total} to spend equally on {quantity} {item}. How much can {character} spend on each one?",
        "answerTemplate": "{character} can spend {result} on each {item}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "total",
            "type": "value"
          },
          {
            "key": "quantity",
            "type": "value"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "COMPARISON",
          "ESTIMATION",
          "MULTI_STEP"
        ],
        "template": "{character} goes to the shop and buys {items}. How much does {character} spend in total?",
        "answerTemplate": "{character} spends {result} in total",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "items",
            "type": "item_list"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "ESTIMATION"
        ],
        "template": "Estimate: If {character} buys {items}, about how much will it cost?",
        "answerTemplate": "It will cost approximately {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "items",
            "type": "item_list"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "VALIDATION"
        ],
        "template": "{character} calculated that {items} costs {amount}. Is this correct?",
        "answerTemplate": "{validation_result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "items",
            "type": "item_list"
          },
          {
            "key": "amount",
            "type": "value"
          },
          {
            "key": "validation_result",
            "type": "boolean"
          }
        ]
      }
    ]
  }
}

--- SUITE B: MODEL COVERAGE TESTS ---
Testing every mathematical model to ensure basic generation and catch crashes...
# Test B.1: ADDITION model
{
  "success": true,
  "question": {
    "text": "Charlotte buys a apple for £82, a banana for £139, and a sandwich for £57. What is the total cost?",
    "options": [
      {
        "text": "378",
        "value": 378,
        "index": 0
      },
      {
        "text": "£278.00",
        "value": 278,
        "index": 1
      },
      {
        "text": "221",
        "value": 221,
        "index": 2
      },
      {
        "text": "11398",
        "value": 11398,
        "index": 3
      }
    ],
    "correctIndex": 1,
    "format": "DIRECT_CALCULATION",
    "difficulty": {
      "year": 4,
      "subLevel": 1,
      "displayName": "4.1",
      "cognitiveLoad": 40
    },
    "cognitiveLoad": 40,
    "curriculumTags": [
      "4N1a",
      "4N1b"
    ],
    "scenario": {
      "id": "shop-002-realistic-general",
      "theme": "SHOPPING",
      "setting": {
        "location": "local shop",
        "timeContext": "after school",
        "atmosphere": "friendly"
      },
      "characters": [
        {
          "name": "Charlotte",
          "role": "student"
        }
      ],
      "items": [
        {
          "name": "apple",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.2,
            "max": 0.5,
            "typical": 0.35,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "banana",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.15,
            "max": 0.4,
            "typical": 0.25,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "sandwich",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 2.5,
            "max": 6,
            "typical": 4,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "drink",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.8,
            "max": 2.5,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "cake",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 1.5,
            "max": 4,
            "typical": 2.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "biscuit",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.8,
            "max": 2,
            "typical": 1.2,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "sweet",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.1,
            "max": 1,
            "typical": 0.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "chocolate",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.6,
            "max": 3,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "pen",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.5,
            "max": 2,
            "typical": 1,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "pencil",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.2,
            "max": 1,
            "typical": 0.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "ruler",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.8,
            "max": 2.5,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "notebook",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 1,
            "max": 4,
            "typical": 2,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "eraser",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.3,
            "max": 1.5,
            "typical": 0.75,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "book",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 3,
            "max": 15,
            "typical": 8,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "comic",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 2,
            "max": 5,
            "typical": 3,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "magazine",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 2.5,
            "max": 6,
            "typical": 4,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "toy",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 5,
            "max": 25,
            "typical": 12,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "game",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 8,
            "max": 60,
            "typical": 25,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "puzzle",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 5,
            "max": 20,
            "typical": 12,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "sticker",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 0.2,
            "max": 2,
            "typical": 0.8,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "badge",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 0.5,
            "max": 3,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "poster",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 2,
            "max": 8,
            "typical": 4,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "card",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 0.5,
            "max": 4,
            "typical": 2,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        }
      ],
      "culturalElements": [
        {
          "type": "currency",
          "value": "£",
          "explanation": "British pounds"
        },
        {
          "type": "location",
          "value": "UK local shop",
          "explanation": "Typical British corner shop"
        }
      ],
      "realWorldConnection": "Everyday shopping with realistic UK prices",
      "yearAppropriate": [
        1,
        2,
        3,
        4,
        5,
        6
      ],
      "templates": [
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "MULTI_STEP"
          ],
          "modelCompatibility": [
            "ADDITION"
          ],
          "operandCount": 3,
          "template": "{character} buys a {item1} for {price1}, a {item2} for {price2}, and a {item3} for {price3}. What is the total cost?",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item1",
              "type": "item"
            },
            {
              "key": "item2",
              "type": "item"
            },
            {
              "key": "item3",
              "type": "item"
            },
            {
              "key": "price1",
              "type": "value"
            },
            {
              "key": "price2",
              "type": "value"
            },
            {
              "key": "price3",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "MULTI_STEP"
          ],
          "modelCompatibility": [
            "ADDITION"
          ],
          "operandCount": 2,
          "template": "{character} buys a {item1} for {price1} and a {item2} for {price2}. What is the total cost?",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item1",
              "type": "item"
            },
            {
              "key": "item2",
              "type": "item"
            },
            {
              "key": "price1",
              "type": "value"
            },
            {
              "key": "price2",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION"
          ],
          "modelCompatibility": [
            "SUBTRACTION",
            "CHANGE_CALCULATION"
          ],
          "template": "{character} buys a {item} for {price} and pays with {payment}. How much change does {character} get?",
          "answerTemplate": "{character} receives {result} in change",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "price",
              "type": "value"
            },
            {
              "key": "payment",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION"
          ],
          "modelCompatibility": [
            "MULTIPLICATION"
          ],
          "template": "{character} buys {quantity} {item} at {price} each. What is the total cost?",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "quantity",
              "type": "value"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "price",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION"
          ],
          "modelCompatibility": [
            "DIVISION"
          ],
          "template": "{character} has {total} to spend equally on {quantity} {item}. How much can {character} spend on each one?",
          "answerTemplate": "{character} can spend {result} on each {item}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "total",
              "type": "value"
            },
            {
              "key": "quantity",
              "type": "value"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "COMPARISON",
            "ESTIMATION",
            "MULTI_STEP"
          ],
          "template": "{character} goes to the shop and buys {items}. How much does {character} spend in total?",
          "answerTemplate": "{character} spends {result} in total",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "items",
              "type": "item_list"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "ESTIMATION"
          ],
          "template": "Estimate: If {character} buys {items}, about how much will it cost?",
          "answerTemplate": "It will cost approximately {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "items",
              "type": "item_list"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "VALIDATION"
          ],
          "template": "{character} calculated that {items} costs {amount}. Is this correct?",
          "answerTemplate": "{validation_result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "items",
              "type": "item_list"
            },
            {
              "key": "amount",
              "type": "value"
            },
            {
              "key": "validation_result",
              "type": "boolean"
            }
          ]
        }
      ]
    },
    "distractors": [
      {
        "value": 11398,
        "displayText": "11398",
        "strategy": "WRONG_OPERATION",
        "reasoning": "Multiplied instead of adding"
      },
      {
        "value": 378,
        "displayText": "378",
        "strategy": "PLACE_VALUE_ERROR",
        "reasoning": "Error in carrying to next column"
      },
      {
        "value": 221,
        "displayText": "221",
        "strategy": "PARTIAL_CALCULATION",
        "reasoning": "Stopped calculation early"
      }
    ],
    "enhancementStatus": {
      "level": "partial",
      "requestedFormat": "DIRECT_CALCULATION",
      "actualFormat": "DIRECT_CALCULATION",
      "featuresActive": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "featuresPending": [],
      "isFullyEnhanced": true
    },
    "mathOutput": {
      "operation": "ADDITION",
      "operand_1": 82,
      "operand_2": 139,
      "operand_3": 57,
      "result": 278
    },
    "generationTime": 0,
    "questionId": "q_1759077132415_um1vmdqu7",
    "generationSetup": {
      "controller_used": "DIRECT_CALCULATIONController",
      "format_requested": "DIRECT_CALCULATION",
      "format_actual": "DIRECT_CALCULATION",
      "scenario_theme": "SHOPPING",
      "scenario_id": "shop-002-realistic-general",
      "scenario_selection_method": "default",
      "distractor_strategies": [
        "WRONG_OPERATION",
        "PLACE_VALUE_ERROR",
        "PARTIAL_CALCULATION"
      ],
      "distractor_count": 3,
      "theme_variety": false,
      "format_variety": false,
      "enhancement_level": "partial",
      "features_active": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "features_pending": [],
      "generation_time_ms": 0
    }
  },
  "metadata": {
    "format": "DIRECT_CALCULATION",
    "cognitive_load": 40,
    "curriculum_alignment": [
      "4N1a",
      "4N1b"
    ],
    "difficulty": "4.1",
    "scenario_theme": "SHOPPING",
    "distractor_strategies": [
      "WRONG_OPERATION",
      "PLACE_VALUE_ERROR",
      "PARTIAL_CALCULATION"
    ],
    "generation_time_ms": 0,
    "api_version": "2.0",
    "enhancement_status": "partial",
    "format_requested": "DIRECT_CALCULATION",
    "format_used": "DIRECT_CALCULATION",
    "features_active": [
      "enhanced_distractors",
      "rich_scenarios",
      "cognitive_load",
      "advanced_formats"
    ],
    "features_pending": []
  },
  "context": {
    "id": "shop-002-realistic-general",
    "theme": "SHOPPING",
    "setting": {
      "location": "local shop",
      "timeContext": "after school",
      "atmosphere": "friendly"
    },
    "characters": [
      {
        "name": "Charlotte",
        "role": "student"
      }
    ],
    "items": [
      {
        "name": "apple",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.2,
          "max": 0.5,
          "typical": 0.35,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "banana",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.15,
          "max": 0.4,
          "typical": 0.25,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "sandwich",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 2.5,
          "max": 6,
          "typical": 4,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "drink",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.8,
          "max": 2.5,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "cake",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 1.5,
          "max": 4,
          "typical": 2.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "biscuit",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.8,
          "max": 2,
          "typical": 1.2,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "sweet",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.1,
          "max": 1,
          "typical": 0.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "chocolate",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.6,
          "max": 3,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "pen",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.5,
          "max": 2,
          "typical": 1,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "pencil",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.2,
          "max": 1,
          "typical": 0.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "ruler",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.8,
          "max": 2.5,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "notebook",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 1,
          "max": 4,
          "typical": 2,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "eraser",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.3,
          "max": 1.5,
          "typical": 0.75,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "book",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 3,
          "max": 15,
          "typical": 8,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "comic",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 2,
          "max": 5,
          "typical": 3,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "magazine",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 2.5,
          "max": 6,
          "typical": 4,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "toy",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 5,
          "max": 25,
          "typical": 12,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "game",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 8,
          "max": 60,
          "typical": 25,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "puzzle",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 5,
          "max": 20,
          "typical": 12,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "sticker",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 0.2,
          "max": 2,
          "typical": 0.8,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "badge",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 0.5,
          "max": 3,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "poster",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 2,
          "max": 8,
          "typical": 4,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "card",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 0.5,
          "max": 4,
          "typical": 2,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      }
    ],
    "culturalElements": [
      {
        "type": "currency",
        "value": "£",
        "explanation": "British pounds"
      },
      {
        "type": "location",
        "value": "UK local shop",
        "explanation": "Typical British corner shop"
      }
    ],
    "realWorldConnection": "Everyday shopping with realistic UK prices",
    "yearAppropriate": [
      1,
      2,
      3,
      4,
      5,
      6
    ],
    "templates": [
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "MULTI_STEP"
        ],
        "modelCompatibility": [
          "ADDITION"
        ],
        "operandCount": 3,
        "template": "{character} buys a {item1} for {price1}, a {item2} for {price2}, and a {item3} for {price3}. What is the total cost?",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item1",
            "type": "item"
          },
          {
            "key": "item2",
            "type": "item"
          },
          {
            "key": "item3",
            "type": "item"
          },
          {
            "key": "price1",
            "type": "value"
          },
          {
            "key": "price2",
            "type": "value"
          },
          {
            "key": "price3",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "MULTI_STEP"
        ],
        "modelCompatibility": [
          "ADDITION"
        ],
        "operandCount": 2,
        "template": "{character} buys a {item1} for {price1} and a {item2} for {price2}. What is the total cost?",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item1",
            "type": "item"
          },
          {
            "key": "item2",
            "type": "item"
          },
          {
            "key": "price1",
            "type": "value"
          },
          {
            "key": "price2",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION"
        ],
        "modelCompatibility": [
          "SUBTRACTION",
          "CHANGE_CALCULATION"
        ],
        "template": "{character} buys a {item} for {price} and pays with {payment}. How much change does {character} get?",
        "answerTemplate": "{character} receives {result} in change",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "price",
            "type": "value"
          },
          {
            "key": "payment",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION"
        ],
        "modelCompatibility": [
          "MULTIPLICATION"
        ],
        "template": "{character} buys {quantity} {item} at {price} each. What is the total cost?",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "quantity",
            "type": "value"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "price",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION"
        ],
        "modelCompatibility": [
          "DIVISION"
        ],
        "template": "{character} has {total} to spend equally on {quantity} {item}. How much can {character} spend on each one?",
        "answerTemplate": "{character} can spend {result} on each {item}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "total",
            "type": "value"
          },
          {
            "key": "quantity",
            "type": "value"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "COMPARISON",
          "ESTIMATION",
          "MULTI_STEP"
        ],
        "template": "{character} goes to the shop and buys {items}. How much does {character} spend in total?",
        "answerTemplate": "{character} spends {result} in total",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "items",
            "type": "item_list"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "ESTIMATION"
        ],
        "template": "Estimate: If {character} buys {items}, about how much will it cost?",
        "answerTemplate": "It will cost approximately {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "items",
            "type": "item_list"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "VALIDATION"
        ],
        "template": "{character} calculated that {items} costs {amount}. Is this correct?",
        "answerTemplate": "{validation_result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "items",
            "type": "item_list"
          },
          {
            "key": "amount",
            "type": "value"
          },
          {
            "key": "validation_result",
            "type": "boolean"
          }
        ]
      }
    ]
  }
}
# Test B.2: SUBTRACTION model
{
  "success": true,
  "question": {
    "text": "Sarah wants to buy books at the book fair. Calculate the total cost.",
    "options": [
      {
        "text": "50",
        "value": 50,
        "index": 0
      },
      {
        "text": "£40.00",
        "value": 40,
        "index": 1
      },
      {
        "text": "198",
        "value": 198,
        "index": 2
      },
      {
        "text": "42",
        "value": 42,
        "index": 3
      }
    ],
    "correctIndex": 1,
    "format": "DIRECT_CALCULATION",
    "difficulty": {
      "year": 4,
      "subLevel": 1,
      "displayName": "4.1",
      "cognitiveLoad": 40
    },
    "cognitiveLoad": 40,
    "curriculumTags": [
      "4N1c",
      "4N1d"
    ],
    "scenario": {
      "id": "shop-001-bookfair",
      "theme": "SHOPPING",
      "setting": {
        "location": "school book fair",
        "timeContext": "lunch break",
        "atmosphere": "busy"
      },
      "characters": [
        {
          "name": "Sarah",
          "role": "student"
        },
        {
          "name": "Mr. Johnson",
          "role": "teacher"
        }
      ],
      "items": [
        {
          "name": "book",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 3,
            "max": 12,
            "typical": 6.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "bookmark",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.5,
            "max": 2,
            "typical": 1,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        }
      ],
      "culturalElements": [
        {
          "type": "currency",
          "value": "£",
          "explanation": "British pounds"
        },
        {
          "type": "event",
          "value": "book fair",
          "explanation": "School fundraising event"
        }
      ],
      "realWorldConnection": "School fundraising and reading promotion",
      "yearAppropriate": [
        2,
        3,
        4,
        5
      ],
      "templates": [
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "COMPARISON"
          ],
          "template": "{character} wants to buy books at the book fair. Calculate the total cost.",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        }
      ]
    },
    "distractors": [
      {
        "value": 198,
        "displayText": "198",
        "strategy": "WRONG_OPERATION",
        "reasoning": "Added instead of subtracting"
      },
      {
        "value": 50,
        "displayText": "50",
        "strategy": "PLACE_VALUE_ERROR",
        "reasoning": "Error in carrying to next column"
      },
      {
        "value": 42,
        "displayText": "42",
        "strategy": "CLOSE_VALUE",
        "reasoning": "Off by 2"
      }
    ],
    "enhancementStatus": {
      "level": "partial",
      "requestedFormat": "DIRECT_CALCULATION",
      "actualFormat": "DIRECT_CALCULATION",
      "featuresActive": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "featuresPending": [],
      "isFullyEnhanced": true
    },
    "mathOutput": {
      "operation": "SUBTRACTION",
      "minuend": 119,
      "subtrahend": 79,
      "result": 40
    },
    "generationTime": 0,
    "questionId": "q_1759077132459_nlumcp6tk",
    "generationSetup": {
      "controller_used": "DIRECT_CALCULATIONController",
      "format_requested": "DIRECT_CALCULATION",
      "format_actual": "DIRECT_CALCULATION",
      "scenario_theme": "SHOPPING",
      "scenario_id": "shop-001-bookfair",
      "scenario_selection_method": "default",
      "distractor_strategies": [
        "WRONG_OPERATION",
        "PLACE_VALUE_ERROR",
        "CLOSE_VALUE"
      ],
      "distractor_count": 3,
      "theme_variety": false,
      "format_variety": false,
      "enhancement_level": "partial",
      "features_active": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "features_pending": [],
      "generation_time_ms": 0
    }
  },
  "metadata": {
    "format": "DIRECT_CALCULATION",
    "cognitive_load": 40,
    "curriculum_alignment": [
      "4N1c",
      "4N1d"
    ],
    "difficulty": "4.1",
    "scenario_theme": "SHOPPING",
    "distractor_strategies": [
      "WRONG_OPERATION",
      "PLACE_VALUE_ERROR",
      "CLOSE_VALUE"
    ],
    "generation_time_ms": 0,
    "api_version": "2.0",
    "enhancement_status": "partial",
    "format_requested": "DIRECT_CALCULATION",
    "format_used": "DIRECT_CALCULATION",
    "features_active": [
      "enhanced_distractors",
      "rich_scenarios",
      "cognitive_load",
      "advanced_formats"
    ],
    "features_pending": []
  },
  "context": {
    "id": "shop-001-bookfair",
    "theme": "SHOPPING",
    "setting": {
      "location": "school book fair",
      "timeContext": "lunch break",
      "atmosphere": "busy"
    },
    "characters": [
      {
        "name": "Sarah",
        "role": "student"
      },
      {
        "name": "Mr. Johnson",
        "role": "teacher"
      }
    ],
    "items": [
      {
        "name": "book",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 3,
          "max": 12,
          "typical": 6.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "bookmark",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.5,
          "max": 2,
          "typical": 1,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      }
    ],
    "culturalElements": [
      {
        "type": "currency",
        "value": "£",
        "explanation": "British pounds"
      },
      {
        "type": "event",
        "value": "book fair",
        "explanation": "School fundraising event"
      }
    ],
    "realWorldConnection": "School fundraising and reading promotion",
    "yearAppropriate": [
      2,
      3,
      4,
      5
    ],
    "templates": [
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "COMPARISON"
        ],
        "template": "{character} wants to buy books at the book fair. Calculate the total cost.",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      }
    ]
  }
}
# Test B.3: MULTIPLICATION model
{
  "error": "Failed to generate enhanced question",
  "details": "Cannot read properties of undefined (reading 'correctAnswer')",
  "api_version": "2.0"
}
# Test B.4: DIVISION model
{
  "success": true,
  "question": {
    "text": "Charlotte has £56 to spend equally on 1 apple. How much can Charlotte spend on each one?",
    "options": [
      {
        "text": "£56.00",
        "value": 56,
        "index": 0
      },
      {
        "text": "£55.00",
        "value": 55,
        "index": 1
      },
      {
        "text": "5.6",
        "value": 5.6,
        "index": 2
      },
      {
        "text": "560",
        "value": 560,
        "index": 3
      }
    ],
    "correctIndex": 0,
    "format": "DIRECT_CALCULATION",
    "difficulty": {
      "year": 4,
      "subLevel": 1,
      "displayName": "4.1",
      "cognitiveLoad": 40
    },
    "cognitiveLoad": 40,
    "curriculumTags": [
      "4N1a"
    ],
    "scenario": {
      "id": "shop-002-realistic-general",
      "theme": "SHOPPING",
      "setting": {
        "location": "local shop",
        "timeContext": "after school",
        "atmosphere": "friendly"
      },
      "characters": [
        {
          "name": "Charlotte",
          "role": "student"
        }
      ],
      "items": [
        {
          "name": "apple",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.2,
            "max": 0.5,
            "typical": 0.35,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "banana",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.15,
            "max": 0.4,
            "typical": 0.25,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "sandwich",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 2.5,
            "max": 6,
            "typical": 4,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "drink",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.8,
            "max": 2.5,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "cake",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 1.5,
            "max": 4,
            "typical": 2.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "biscuit",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.8,
            "max": 2,
            "typical": 1.2,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "sweet",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.1,
            "max": 1,
            "typical": 0.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "chocolate",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.6,
            "max": 3,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "pen",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.5,
            "max": 2,
            "typical": 1,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "pencil",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.2,
            "max": 1,
            "typical": 0.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "ruler",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.8,
            "max": 2.5,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "notebook",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 1,
            "max": 4,
            "typical": 2,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "eraser",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.3,
            "max": 1.5,
            "typical": 0.75,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "book",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 3,
            "max": 15,
            "typical": 8,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "comic",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 2,
            "max": 5,
            "typical": 3,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "magazine",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 2.5,
            "max": 6,
            "typical": 4,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "toy",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 5,
            "max": 25,
            "typical": 12,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "game",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 8,
            "max": 60,
            "typical": 25,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "puzzle",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 5,
            "max": 20,
            "typical": 12,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "sticker",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 0.2,
            "max": 2,
            "typical": 0.8,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "badge",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 0.5,
            "max": 3,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "poster",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 2,
            "max": 8,
            "typical": 4,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "card",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 0.5,
            "max": 4,
            "typical": 2,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        }
      ],
      "culturalElements": [
        {
          "type": "currency",
          "value": "£",
          "explanation": "British pounds"
        },
        {
          "type": "location",
          "value": "UK local shop",
          "explanation": "Typical British corner shop"
        }
      ],
      "realWorldConnection": "Everyday shopping with realistic UK prices",
      "yearAppropriate": [
        1,
        2,
        3,
        4,
        5,
        6
      ],
      "templates": [
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "MULTI_STEP"
          ],
          "modelCompatibility": [
            "ADDITION"
          ],
          "operandCount": 3,
          "template": "{character} buys a {item1} for {price1}, a {item2} for {price2}, and a {item3} for {price3}. What is the total cost?",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item1",
              "type": "item"
            },
            {
              "key": "item2",
              "type": "item"
            },
            {
              "key": "item3",
              "type": "item"
            },
            {
              "key": "price1",
              "type": "value"
            },
            {
              "key": "price2",
              "type": "value"
            },
            {
              "key": "price3",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "MULTI_STEP"
          ],
          "modelCompatibility": [
            "ADDITION"
          ],
          "operandCount": 2,
          "template": "{character} buys a {item1} for {price1} and a {item2} for {price2}. What is the total cost?",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item1",
              "type": "item"
            },
            {
              "key": "item2",
              "type": "item"
            },
            {
              "key": "price1",
              "type": "value"
            },
            {
              "key": "price2",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION"
          ],
          "modelCompatibility": [
            "SUBTRACTION",
            "CHANGE_CALCULATION"
          ],
          "template": "{character} buys a {item} for {price} and pays with {payment}. How much change does {character} get?",
          "answerTemplate": "{character} receives {result} in change",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "price",
              "type": "value"
            },
            {
              "key": "payment",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION"
          ],
          "modelCompatibility": [
            "MULTIPLICATION"
          ],
          "template": "{character} buys {quantity} {item} at {price} each. What is the total cost?",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "quantity",
              "type": "value"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "price",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION"
          ],
          "modelCompatibility": [
            "DIVISION"
          ],
          "template": "{character} has {total} to spend equally on {quantity} {item}. How much can {character} spend on each one?",
          "answerTemplate": "{character} can spend {result} on each {item}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "total",
              "type": "value"
            },
            {
              "key": "quantity",
              "type": "value"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "COMPARISON",
            "ESTIMATION",
            "MULTI_STEP"
          ],
          "template": "{character} goes to the shop and buys {items}. How much does {character} spend in total?",
          "answerTemplate": "{character} spends {result} in total",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "items",
              "type": "item_list"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "ESTIMATION"
          ],
          "template": "Estimate: If {character} buys {items}, about how much will it cost?",
          "answerTemplate": "It will cost approximately {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "items",
              "type": "item_list"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "VALIDATION"
          ],
          "template": "{character} calculated that {items} costs {amount}. Is this correct?",
          "answerTemplate": "{validation_result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "items",
              "type": "item_list"
            },
            {
              "key": "amount",
              "type": "value"
            },
            {
              "key": "validation_result",
              "type": "boolean"
            }
          ]
        }
      ]
    },
    "distractors": [
      {
        "value": 5.6,
        "displayText": "5.6",
        "strategy": "OFF_BY_MAGNITUDE",
        "reasoning": "Result is 10 times too small"
      },
      {
        "value": 560,
        "displayText": "560",
        "strategy": "OFF_BY_MAGNITUDE",
        "reasoning": "Result is 10 times too large"
      },
      {
        "value": 55,
        "displayText": "£55.00",
        "strategy": "WRONG_OPERATION",
        "reasoning": "Subtracted instead of dividing"
      }
    ],
    "enhancementStatus": {
      "level": "partial",
      "requestedFormat": "DIRECT_CALCULATION",
      "actualFormat": "DIRECT_CALCULATION",
      "featuresActive": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "featuresPending": [],
      "isFullyEnhanced": true
    },
    "mathOutput": {
      "operation": "DIVISION",
      "dividend": 56,
      "divisor": 1,
      "quotient": 56
    },
    "generationTime": 0,
    "questionId": "q_1759077132668_unnsr6fcy",
    "generationSetup": {
      "controller_used": "DIRECT_CALCULATIONController",
      "format_requested": "DIRECT_CALCULATION",
      "format_actual": "DIRECT_CALCULATION",
      "scenario_theme": "SHOPPING",
      "scenario_id": "shop-002-realistic-general",
      "scenario_selection_method": "default",
      "distractor_strategies": [
        "OFF_BY_MAGNITUDE",
        "OFF_BY_MAGNITUDE",
        "WRONG_OPERATION"
      ],
      "distractor_count": 3,
      "theme_variety": false,
      "format_variety": false,
      "enhancement_level": "partial",
      "features_active": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "features_pending": [],
      "generation_time_ms": 0
    }
  },
  "metadata": {
    "format": "DIRECT_CALCULATION",
    "cognitive_load": 40,
    "curriculum_alignment": [
      "4N1a"
    ],
    "difficulty": "4.1",
    "scenario_theme": "SHOPPING",
    "distractor_strategies": [
      "OFF_BY_MAGNITUDE",
      "OFF_BY_MAGNITUDE",
      "WRONG_OPERATION"
    ],
    "generation_time_ms": 0,
    "api_version": "2.0",
    "enhancement_status": "partial",
    "format_requested": "DIRECT_CALCULATION",
    "format_used": "DIRECT_CALCULATION",
    "features_active": [
      "enhanced_distractors",
      "rich_scenarios",
      "cognitive_load",
      "advanced_formats"
    ],
    "features_pending": []
  },
  "context": {
    "id": "shop-002-realistic-general",
    "theme": "SHOPPING",
    "setting": {
      "location": "local shop",
      "timeContext": "after school",
      "atmosphere": "friendly"
    },
    "characters": [
      {
        "name": "Charlotte",
        "role": "student"
      }
    ],
    "items": [
      {
        "name": "apple",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.2,
          "max": 0.5,
          "typical": 0.35,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "banana",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.15,
          "max": 0.4,
          "typical": 0.25,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "sandwich",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 2.5,
          "max": 6,
          "typical": 4,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "drink",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.8,
          "max": 2.5,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "cake",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 1.5,
          "max": 4,
          "typical": 2.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "biscuit",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.8,
          "max": 2,
          "typical": 1.2,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "sweet",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.1,
          "max": 1,
          "typical": 0.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "chocolate",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.6,
          "max": 3,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "pen",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.5,
          "max": 2,
          "typical": 1,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "pencil",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.2,
          "max": 1,
          "typical": 0.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "ruler",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.8,
          "max": 2.5,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "notebook",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 1,
          "max": 4,
          "typical": 2,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "eraser",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.3,
          "max": 1.5,
          "typical": 0.75,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "book",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 3,
          "max": 15,
          "typical": 8,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "comic",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 2,
          "max": 5,
          "typical": 3,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "magazine",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 2.5,
          "max": 6,
          "typical": 4,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "toy",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 5,
          "max": 25,
          "typical": 12,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "game",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 8,
          "max": 60,
          "typical": 25,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "puzzle",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 5,
          "max": 20,
          "typical": 12,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "sticker",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 0.2,
          "max": 2,
          "typical": 0.8,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "badge",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 0.5,
          "max": 3,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "poster",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 2,
          "max": 8,
          "typical": 4,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "card",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 0.5,
          "max": 4,
          "typical": 2,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      }
    ],
    "culturalElements": [
      {
        "type": "currency",
        "value": "£",
        "explanation": "British pounds"
      },
      {
        "type": "location",
        "value": "UK local shop",
        "explanation": "Typical British corner shop"
      }
    ],
    "realWorldConnection": "Everyday shopping with realistic UK prices",
    "yearAppropriate": [
      1,
      2,
      3,
      4,
      5,
      6
    ],
    "templates": [
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "MULTI_STEP"
        ],
        "modelCompatibility": [
          "ADDITION"
        ],
        "operandCount": 3,
        "template": "{character} buys a {item1} for {price1}, a {item2} for {price2}, and a {item3} for {price3}. What is the total cost?",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item1",
            "type": "item"
          },
          {
            "key": "item2",
            "type": "item"
          },
          {
            "key": "item3",
            "type": "item"
          },
          {
            "key": "price1",
            "type": "value"
          },
          {
            "key": "price2",
            "type": "value"
          },
          {
            "key": "price3",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "MULTI_STEP"
        ],
        "modelCompatibility": [
          "ADDITION"
        ],
        "operandCount": 2,
        "template": "{character} buys a {item1} for {price1} and a {item2} for {price2}. What is the total cost?",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item1",
            "type": "item"
          },
          {
            "key": "item2",
            "type": "item"
          },
          {
            "key": "price1",
            "type": "value"
          },
          {
            "key": "price2",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION"
        ],
        "modelCompatibility": [
          "SUBTRACTION",
          "CHANGE_CALCULATION"
        ],
        "template": "{character} buys a {item} for {price} and pays with {payment}. How much change does {character} get?",
        "answerTemplate": "{character} receives {result} in change",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "price",
            "type": "value"
          },
          {
            "key": "payment",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION"
        ],
        "modelCompatibility": [
          "MULTIPLICATION"
        ],
        "template": "{character} buys {quantity} {item} at {price} each. What is the total cost?",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "quantity",
            "type": "value"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "price",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION"
        ],
        "modelCompatibility": [
          "DIVISION"
        ],
        "template": "{character} has {total} to spend equally on {quantity} {item}. How much can {character} spend on each one?",
        "answerTemplate": "{character} can spend {result} on each {item}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "total",
            "type": "value"
          },
          {
            "key": "quantity",
            "type": "value"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "COMPARISON",
          "ESTIMATION",
          "MULTI_STEP"
        ],
        "template": "{character} goes to the shop and buys {items}. How much does {character} spend in total?",
        "answerTemplate": "{character} spends {result} in total",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "items",
            "type": "item_list"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "ESTIMATION"
        ],
        "template": "Estimate: If {character} buys {items}, about how much will it cost?",
        "answerTemplate": "It will cost approximately {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "items",
            "type": "item_list"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "VALIDATION"
        ],
        "template": "{character} calculated that {items} costs {amount}. Is this correct?",
        "answerTemplate": "{validation_result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "items",
            "type": "item_list"
          },
          {
            "key": "amount",
            "type": "value"
          },
          {
            "key": "validation_result",
            "type": "boolean"
          }
        ]
      }
    ]
  }
}
# Test B.5: PERCENTAGE model
{
  "success": true,
  "question": {
    "text": "Sarah wants to buy books at the book fair. Calculate the total cost.",
    "options": [
      {
        "text": "£40.00",
        "value": 40,
        "index": 0
      },
      {
        "value": 39.354223381969575,
        "text": "£39.35",
        "isCorrect": false
      },
      {
        "text": "4",
        "value": 4,
        "index": 2
      },
      {
        "text": "42",
        "value": 42,
        "index": 3
      }
    ],
    "correctIndex": 0,
    "format": "DIRECT_CALCULATION",
    "difficulty": {
      "year": 4,
      "subLevel": 1,
      "displayName": "4.1",
      "cognitiveLoad": 40
    },
    "cognitiveLoad": 40,
    "curriculumTags": [
      "4N1a"
    ],
    "scenario": {
      "id": "shop-001-bookfair",
      "theme": "SHOPPING",
      "setting": {
        "location": "school book fair",
        "timeContext": "lunch break",
        "atmosphere": "busy"
      },
      "characters": [
        {
          "name": "Sarah",
          "role": "student"
        },
        {
          "name": "Mr. Johnson",
          "role": "teacher"
        }
      ],
      "items": [
        {
          "name": "book",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 3,
            "max": 12,
            "typical": 6.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "bookmark",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.5,
            "max": 2,
            "typical": 1,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        }
      ],
      "culturalElements": [
        {
          "type": "currency",
          "value": "£",
          "explanation": "British pounds"
        },
        {
          "type": "event",
          "value": "book fair",
          "explanation": "School fundraising event"
        }
      ],
      "realWorldConnection": "School fundraising and reading promotion",
      "yearAppropriate": [
        2,
        3,
        4,
        5
      ],
      "templates": [
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "COMPARISON"
          ],
          "template": "{character} wants to buy books at the book fair. Calculate the total cost.",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        }
      ]
    },
    "distractors": [
      {
        "value": null,
        "displayText": "NaN",
        "strategy": "UNIT_CONFUSION",
        "reasoning": "Multiplied by percentage without converting to decimal"
      },
      {
        "value": 42,
        "displayText": "42",
        "strategy": "CLOSE_VALUE",
        "reasoning": "Off by 2"
      },
      {
        "value": 4,
        "displayText": "4",
        "strategy": "OFF_BY_MAGNITUDE",
        "reasoning": "Result is 10 times too small"
      }
    ],
    "enhancementStatus": {
      "level": "partial",
      "requestedFormat": "DIRECT_CALCULATION",
      "actualFormat": "DIRECT_CALCULATION",
      "featuresActive": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "featuresPending": [],
      "isFullyEnhanced": true
    },
    "mathOutput": {
      "operation": "PERCENTAGE",
      "base_value": 40,
      "percentage": 100,
      "result": 40
    },
    "generationTime": 0,
    "questionId": "q_1759077132722_g93hsn8dr",
    "generationSetup": {
      "controller_used": "DIRECT_CALCULATIONController",
      "format_requested": "DIRECT_CALCULATION",
      "format_actual": "DIRECT_CALCULATION",
      "scenario_theme": "SHOPPING",
      "scenario_id": "shop-001-bookfair",
      "scenario_selection_method": "default",
      "distractor_strategies": [
        "UNIT_CONFUSION",
        "CLOSE_VALUE",
        "OFF_BY_MAGNITUDE"
      ],
      "distractor_count": 3,
      "theme_variety": false,
      "format_variety": false,
      "enhancement_level": "partial",
      "features_active": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "features_pending": [],
      "generation_time_ms": 0
    }
  },
  "metadata": {
    "format": "DIRECT_CALCULATION",
    "cognitive_load": 40,
    "curriculum_alignment": [
      "4N1a"
    ],
    "difficulty": "4.1",
    "scenario_theme": "SHOPPING",
    "distractor_strategies": [
      "UNIT_CONFUSION",
      "CLOSE_VALUE",
      "OFF_BY_MAGNITUDE"
    ],
    "generation_time_ms": 1,
    "api_version": "2.0",
    "enhancement_status": "partial",
    "format_requested": "DIRECT_CALCULATION",
    "format_used": "DIRECT_CALCULATION",
    "features_active": [
      "enhanced_distractors",
      "rich_scenarios",
      "cognitive_load",
      "advanced_formats"
    ],
    "features_pending": []
  },
  "context": {
    "id": "shop-001-bookfair",
    "theme": "SHOPPING",
    "setting": {
      "location": "school book fair",
      "timeContext": "lunch break",
      "atmosphere": "busy"
    },
    "characters": [
      {
        "name": "Sarah",
        "role": "student"
      },
      {
        "name": "Mr. Johnson",
        "role": "teacher"
      }
    ],
    "items": [
      {
        "name": "book",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 3,
          "max": 12,
          "typical": 6.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "bookmark",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.5,
          "max": 2,
          "typical": 1,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      }
    ],
    "culturalElements": [
      {
        "type": "currency",
        "value": "£",
        "explanation": "British pounds"
      },
      {
        "type": "event",
        "value": "book fair",
        "explanation": "School fundraising event"
      }
    ],
    "realWorldConnection": "School fundraising and reading promotion",
    "yearAppropriate": [
      2,
      3,
      4,
      5
    ],
    "templates": [
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "COMPARISON"
        ],
        "template": "{character} wants to buy books at the book fair. Calculate the total cost.",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      }
    ]
  }
}
# Test B.6: FRACTION model
{
  "success": true,
  "question": {
    "text": "Madison buys a item for £5.33. How much does it cost?",
    "options": [
      {
        "text": "6.33",
        "value": 6.33,
        "index": 0
      },
      {
        "text": "£5.33",
        "value": 5.33,
        "index": 1
      },
      {
        "text": "4.33",
        "value": 4.33,
        "index": 2
      }
    ],
    "correctIndex": 1,
    "format": "DIRECT_CALCULATION",
    "difficulty": {
      "year": 4,
      "subLevel": 1,
      "displayName": "4.1",
      "cognitiveLoad": 40
    },
    "cognitiveLoad": 40,
    "curriculumTags": [
      "4N1a"
    ],
    "scenario": {
      "id": "default-4-1759077132782",
      "theme": "SHOPPING",
      "setting": {
        "location": "shop",
        "timeContext": "afternoon",
        "atmosphere": "friendly"
      },
      "characters": [
        {
          "name": "Madison",
          "role": "student"
        }
      ],
      "items": [
        {
          "name": "item",
          "category": "HOUSEHOLD_ITEMS",
          "typicalValue": {
            "min": 1,
            "max": 10,
            "typical": 5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        }
      ],
      "culturalElements": [
        {
          "type": "currency",
          "value": "£",
          "explanation": "British pounds"
        }
      ],
      "realWorldConnection": "Basic shopping calculations",
      "yearAppropriate": [
        4
      ],
      "templates": [
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION"
          ],
          "template": "{character} buys a {item} for {price}. How much does it cost?",
          "answerTemplate": "It costs {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "price",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        }
      ]
    },
    "distractors": [
      {
        "value": 6.33,
        "displayText": "6.33",
        "strategy": "CLOSE_VALUE",
        "reasoning": "Off by 1"
      },
      {
        "value": 4.33,
        "displayText": "4.33",
        "strategy": "CLOSE_VALUE",
        "reasoning": "Off by 1"
      }
    ],
    "enhancementStatus": {
      "level": "partial",
      "requestedFormat": "DIRECT_CALCULATION",
      "actualFormat": "DIRECT_CALCULATION",
      "featuresActive": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "featuresPending": [],
      "isFullyEnhanced": true
    },
    "mathOutput": {
      "operation": "FRACTION",
      "whole_value": 16,
      "numerator": 1,
      "denominator": 3,
      "result": 5.33
    },
    "generationTime": 1,
    "questionId": "q_1759077132783_sleqhv33l",
    "generationSetup": {
      "controller_used": "DIRECT_CALCULATIONController",
      "format_requested": "DIRECT_CALCULATION",
      "format_actual": "DIRECT_CALCULATION",
      "scenario_theme": "SHOPPING",
      "scenario_id": "default-4-1759077132782",
      "scenario_selection_method": "default",
      "distractor_strategies": [
        "CLOSE_VALUE",
        "CLOSE_VALUE"
      ],
      "distractor_count": 2,
      "theme_variety": false,
      "format_variety": false,
      "enhancement_level": "partial",
      "features_active": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "features_pending": [],
      "generation_time_ms": 1
    }
  },
  "metadata": {
    "format": "DIRECT_CALCULATION",
    "cognitive_load": 40,
    "curriculum_alignment": [
      "4N1a"
    ],
    "difficulty": "4.1",
    "scenario_theme": "SHOPPING",
    "distractor_strategies": [
      "CLOSE_VALUE",
      "CLOSE_VALUE"
    ],
    "generation_time_ms": 1,
    "api_version": "2.0",
    "enhancement_status": "partial",
    "format_requested": "DIRECT_CALCULATION",
    "format_used": "DIRECT_CALCULATION",
    "features_active": [
      "enhanced_distractors",
      "rich_scenarios",
      "cognitive_load",
      "advanced_formats"
    ],
    "features_pending": []
  },
  "context": {
    "id": "default-4-1759077132782",
    "theme": "SHOPPING",
    "setting": {
      "location": "shop",
      "timeContext": "afternoon",
      "atmosphere": "friendly"
    },
    "characters": [
      {
        "name": "Madison",
        "role": "student"
      }
    ],
    "items": [
      {
        "name": "item",
        "category": "HOUSEHOLD_ITEMS",
        "typicalValue": {
          "min": 1,
          "max": 10,
          "typical": 5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      }
    ],
    "culturalElements": [
      {
        "type": "currency",
        "value": "£",
        "explanation": "British pounds"
      }
    ],
    "realWorldConnection": "Basic shopping calculations",
    "yearAppropriate": [
      4
    ],
    "templates": [
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION"
        ],
        "template": "{character} buys a {item} for {price}. How much does it cost?",
        "answerTemplate": "It costs {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "price",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      }
    ]
  }
}
# Test B.7: COUNTING model
{
  "success": true,
  "question": {
    "text": "Elijah buys a item for £5. How much does it cost?",
    "options": [
      {
        "value": 0,
        "text": "0p",
        "isCorrect": true
      }
    ],
    "correctIndex": 0,
    "format": "DIRECT_CALCULATION",
    "difficulty": {
      "year": 4,
      "subLevel": 1,
      "displayName": "4.1",
      "cognitiveLoad": 40
    },
    "cognitiveLoad": 40,
    "curriculumTags": [
      "4N1a"
    ],
    "scenario": {
      "id": "default-4-1759077132833",
      "theme": "SHOPPING",
      "setting": {
        "location": "shop",
        "timeContext": "afternoon",
        "atmosphere": "friendly"
      },
      "characters": [
        {
          "name": "Elijah",
          "role": "student"
        }
      ],
      "items": [
        {
          "name": "item",
          "category": "HOUSEHOLD_ITEMS",
          "typicalValue": {
            "min": 1,
            "max": 10,
            "typical": 5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        }
      ],
      "culturalElements": [
        {
          "type": "currency",
          "value": "£",
          "explanation": "British pounds"
        }
      ],
      "realWorldConnection": "Basic shopping calculations",
      "yearAppropriate": [
        4
      ],
      "templates": [
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION"
          ],
          "template": "{character} buys a {item} for {price}. How much does it cost?",
          "answerTemplate": "It costs {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "price",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        }
      ]
    },
    "distractors": [],
    "enhancementStatus": {
      "level": "partial",
      "requestedFormat": "DIRECT_CALCULATION",
      "actualFormat": "DIRECT_CALCULATION",
      "featuresActive": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "featuresPending": [],
      "isFullyEnhanced": true
    },
    "mathOutput": {
      "operation": "COUNTING"
    },
    "generationTime": 1,
    "questionId": "q_1759077132833_79wdq5mnn",
    "generationSetup": {
      "controller_used": "DIRECT_CALCULATIONController",
      "format_requested": "DIRECT_CALCULATION",
      "format_actual": "DIRECT_CALCULATION",
      "scenario_theme": "SHOPPING",
      "scenario_id": "default-4-1759077132833",
      "scenario_selection_method": "default",
      "distractor_strategies": [],
      "distractor_count": 0,
      "theme_variety": false,
      "format_variety": false,
      "enhancement_level": "partial",
      "features_active": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "features_pending": [],
      "generation_time_ms": 1
    }
  },
  "metadata": {
    "format": "DIRECT_CALCULATION",
    "cognitive_load": 40,
    "curriculum_alignment": [
      "4N1a"
    ],
    "difficulty": "4.1",
    "scenario_theme": "SHOPPING",
    "distractor_strategies": [],
    "generation_time_ms": 1,
    "api_version": "2.0",
    "enhancement_status": "partial",
    "format_requested": "DIRECT_CALCULATION",
    "format_used": "DIRECT_CALCULATION",
    "features_active": [
      "enhanced_distractors",
      "rich_scenarios",
      "cognitive_load",
      "advanced_formats"
    ],
    "features_pending": []
  },
  "context": {
    "id": "default-4-1759077132833",
    "theme": "SHOPPING",
    "setting": {
      "location": "shop",
      "timeContext": "afternoon",
      "atmosphere": "friendly"
    },
    "characters": [
      {
        "name": "Elijah",
        "role": "student"
      }
    ],
    "items": [
      {
        "name": "item",
        "category": "HOUSEHOLD_ITEMS",
        "typicalValue": {
          "min": 1,
          "max": 10,
          "typical": 5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      }
    ],
    "culturalElements": [
      {
        "type": "currency",
        "value": "£",
        "explanation": "British pounds"
      }
    ],
    "realWorldConnection": "Basic shopping calculations",
    "yearAppropriate": [
      4
    ],
    "templates": [
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION"
        ],
        "template": "{character} buys a {item} for {price}. How much does it cost?",
        "answerTemplate": "It costs {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "price",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      }
    ]
  }
}
# Test B.8: TIME_RATE model
{
  "success": true,
  "question": {
    "text": "Sophia buys a item for £5. How much does it cost?",
    "options": [
      {
        "value": 0,
        "text": "0p",
        "isCorrect": true
      }
    ],
    "correctIndex": 0,
    "format": "DIRECT_CALCULATION",
    "difficulty": {
      "year": 4,
      "subLevel": 1,
      "displayName": "4.1",
      "cognitiveLoad": 40
    },
    "cognitiveLoad": 40,
    "curriculumTags": [
      "4N1a"
    ],
    "scenario": {
      "id": "default-4-1759077132886",
      "theme": "SHOPPING",
      "setting": {
        "location": "shop",
        "timeContext": "afternoon",
        "atmosphere": "friendly"
      },
      "characters": [
        {
          "name": "Sophia",
          "role": "student"
        }
      ],
      "items": [
        {
          "name": "item",
          "category": "HOUSEHOLD_ITEMS",
          "typicalValue": {
            "min": 1,
            "max": 10,
            "typical": 5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        }
      ],
      "culturalElements": [
        {
          "type": "currency",
          "value": "£",
          "explanation": "British pounds"
        }
      ],
      "realWorldConnection": "Basic shopping calculations",
      "yearAppropriate": [
        4
      ],
      "templates": [
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION"
          ],
          "template": "{character} buys a {item} for {price}. How much does it cost?",
          "answerTemplate": "It costs {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "price",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        }
      ]
    },
    "distractors": [],
    "enhancementStatus": {
      "level": "partial",
      "requestedFormat": "DIRECT_CALCULATION",
      "actualFormat": "DIRECT_CALCULATION",
      "featuresActive": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "featuresPending": [],
      "isFullyEnhanced": true
    },
    "mathOutput": {
      "operation": "TIME_RATE",
      "rate": {
        "value": 5,
        "period": "day"
      }
    },
    "generationTime": 0,
    "questionId": "q_1759077132886_s5818jlcu",
    "generationSetup": {
      "controller_used": "DIRECT_CALCULATIONController",
      "format_requested": "DIRECT_CALCULATION",
      "format_actual": "DIRECT_CALCULATION",
      "scenario_theme": "SHOPPING",
      "scenario_id": "default-4-1759077132886",
      "scenario_selection_method": "default",
      "distractor_strategies": [],
      "distractor_count": 0,
      "theme_variety": false,
      "format_variety": false,
      "enhancement_level": "partial",
      "features_active": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "features_pending": [],
      "generation_time_ms": 0
    }
  },
  "metadata": {
    "format": "DIRECT_CALCULATION",
    "cognitive_load": 40,
    "curriculum_alignment": [
      "4N1a"
    ],
    "difficulty": "4.1",
    "scenario_theme": "SHOPPING",
    "distractor_strategies": [],
    "generation_time_ms": 0,
    "api_version": "2.0",
    "enhancement_status": "partial",
    "format_requested": "DIRECT_CALCULATION",
    "format_used": "DIRECT_CALCULATION",
    "features_active": [
      "enhanced_distractors",
      "rich_scenarios",
      "cognitive_load",
      "advanced_formats"
    ],
    "features_pending": []
  },
  "context": {
    "id": "default-4-1759077132886",
    "theme": "SHOPPING",
    "setting": {
      "location": "shop",
      "timeContext": "afternoon",
      "atmosphere": "friendly"
    },
    "characters": [
      {
        "name": "Sophia",
        "role": "student"
      }
    ],
    "items": [
      {
        "name": "item",
        "category": "HOUSEHOLD_ITEMS",
        "typicalValue": {
          "min": 1,
          "max": 10,
          "typical": 5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      }
    ],
    "culturalElements": [
      {
        "type": "currency",
        "value": "£",
        "explanation": "British pounds"
      }
    ],
    "realWorldConnection": "Basic shopping calculations",
    "yearAppropriate": [
      4
    ],
    "templates": [
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION"
        ],
        "template": "{character} buys a {item} for {price}. How much does it cost?",
        "answerTemplate": "It costs {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "price",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      }
    ]
  }
}
# Test B.9: CONVERSION model
{
  "success": true,
  "question": {
    "text": "Michael buys a item for £5. How much does it cost?",
    "options": [
      {
        "value": 0,
        "text": "0p",
        "isCorrect": true
      }
    ],
    "correctIndex": 0,
    "format": "DIRECT_CALCULATION",
    "difficulty": {
      "year": 4,
      "subLevel": 1,
      "displayName": "4.1",
      "cognitiveLoad": 40
    },
    "cognitiveLoad": 40,
    "curriculumTags": [
      "4N1a"
    ],
    "scenario": {
      "id": "default-4-1759077132938",
      "theme": "SHOPPING",
      "setting": {
        "location": "shop",
        "timeContext": "afternoon",
        "atmosphere": "friendly"
      },
      "characters": [
        {
          "name": "Michael",
          "role": "student"
        }
      ],
      "items": [
        {
          "name": "item",
          "category": "HOUSEHOLD_ITEMS",
          "typicalValue": {
            "min": 1,
            "max": 10,
            "typical": 5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        }
      ],
      "culturalElements": [
        {
          "type": "currency",
          "value": "£",
          "explanation": "British pounds"
        }
      ],
      "realWorldConnection": "Basic shopping calculations",
      "yearAppropriate": [
        4
      ],
      "templates": [
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION"
          ],
          "template": "{character} buys a {item} for {price}. How much does it cost?",
          "answerTemplate": "It costs {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "price",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        }
      ]
    },
    "distractors": [],
    "enhancementStatus": {
      "level": "partial",
      "requestedFormat": "DIRECT_CALCULATION",
      "actualFormat": "DIRECT_CALCULATION",
      "featuresActive": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "featuresPending": [],
      "isFullyEnhanced": true
    },
    "mathOutput": {
      "operation": "CONVERSION",
      "original_value": 747,
      "converted_value": 7.47,
      "conversion_factor": 0.01
    },
    "generationTime": 0,
    "questionId": "q_1759077132938_t1jssjg7f",
    "generationSetup": {
      "controller_used": "DIRECT_CALCULATIONController",
      "format_requested": "DIRECT_CALCULATION",
      "format_actual": "DIRECT_CALCULATION",
      "scenario_theme": "SHOPPING",
      "scenario_id": "default-4-1759077132938",
      "scenario_selection_method": "default",
      "distractor_strategies": [],
      "distractor_count": 0,
      "theme_variety": false,
      "format_variety": false,
      "enhancement_level": "partial",
      "features_active": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "features_pending": [],
      "generation_time_ms": 0
    }
  },
  "metadata": {
    "format": "DIRECT_CALCULATION",
    "cognitive_load": 40,
    "curriculum_alignment": [
      "4N1a"
    ],
    "difficulty": "4.1",
    "scenario_theme": "SHOPPING",
    "distractor_strategies": [],
    "generation_time_ms": 0,
    "api_version": "2.0",
    "enhancement_status": "partial",
    "format_requested": "DIRECT_CALCULATION",
    "format_used": "DIRECT_CALCULATION",
    "features_active": [
      "enhanced_distractors",
      "rich_scenarios",
      "cognitive_load",
      "advanced_formats"
    ],
    "features_pending": []
  },
  "context": {
    "id": "default-4-1759077132938",
    "theme": "SHOPPING",
    "setting": {
      "location": "shop",
      "timeContext": "afternoon",
      "atmosphere": "friendly"
    },
    "characters": [
      {
        "name": "Michael",
        "role": "student"
      }
    ],
    "items": [
      {
        "name": "item",
        "category": "HOUSEHOLD_ITEMS",
        "typicalValue": {
          "min": 1,
          "max": 10,
          "typical": 5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      }
    ],
    "culturalElements": [
      {
        "type": "currency",
        "value": "£",
        "explanation": "British pounds"
      }
    ],
    "realWorldConnection": "Basic shopping calculations",
    "yearAppropriate": [
      4
    ],
    "templates": [
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION"
        ],
        "template": "{character} buys a {item} for {price}. How much does it cost?",
        "answerTemplate": "It costs {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "price",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      }
    ]
  }
}
# Test B.10: COMPARISON model
{
  "success": true,
  "question": {
    "text": "Sarah wants to buy books at the book fair. Calculate the total cost.",
    "options": [
      {
        "text": "Both options are equally good value",
        "value": -1,
        "index": 0
      },
      {
        "text": "B saves you £208.00",
        "value": 1,
        "index": 1
      },
      {
        "text": "B is better value",
        "value": 1,
        "index": 2
      },
      {
        "text": "A is better value",
        "value": 0,
        "index": 3
      }
    ],
    "correctIndex": 1,
    "format": "COMPARISON",
    "difficulty": {
      "year": 4,
      "subLevel": 1,
      "displayName": "4.1",
      "cognitiveLoad": 40
    },
    "cognitiveLoad": 40,
    "curriculumTags": [
      "4N1a"
    ],
    "scenario": {
      "id": "shop-001-bookfair",
      "theme": "SHOPPING",
      "setting": {
        "location": "school book fair",
        "timeContext": "lunch break",
        "atmosphere": "busy"
      },
      "characters": [
        {
          "name": "Sarah",
          "role": "student"
        },
        {
          "name": "Mr. Johnson",
          "role": "teacher"
        }
      ],
      "items": [
        {
          "name": "book",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 3,
            "max": 12,
            "typical": 6.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "bookmark",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.5,
            "max": 2,
            "typical": 1,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        }
      ],
      "culturalElements": [
        {
          "type": "currency",
          "value": "£",
          "explanation": "British pounds"
        },
        {
          "type": "event",
          "value": "book fair",
          "explanation": "School fundraising event"
        }
      ],
      "realWorldConnection": "School fundraising and reading promotion",
      "yearAppropriate": [
        2,
        3,
        4,
        5
      ],
      "templates": [
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "COMPARISON"
          ],
          "template": "{character} wants to buy books at the book fair. Calculate the total cost.",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        }
      ]
    },
    "distractors": [
      {
        "value": 0,
        "displayText": "A is better value",
        "strategy": "REVERSED_COMPARISON",
        "reasoning": "Selected the option with lower value"
      },
      {
        "value": -1,
        "displayText": "Both options are equally good value",
        "strategy": "WRONG_SELECTION",
        "reasoning": "Failed to calculate the difference correctly"
      },
      {
        "value": 1,
        "displayText": "B saves you £208.00",
        "strategy": "CALCULATION_ERROR",
        "reasoning": "Arithmetic error in calculating the difference"
      }
    ],
    "enhancementStatus": {
      "level": "full",
      "requestedFormat": "COMPARISON",
      "actualFormat": "COMPARISON",
      "featuresActive": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "featuresPending": [],
      "isFullyEnhanced": true
    },
    "mathOutput": {
      "operation": "COMPARISON",
      "option_1_value": 22,
      "option_1_quantity": 750,
      "option_2_value": 126,
      "option_2_quantity": 250
    },
    "generationTime": 1,
    "questionId": "q_1759077132995_zcisxaca9",
    "generationSetup": {
      "controller_used": "COMPARISONController",
      "format_requested": "COMPARISON",
      "format_actual": "COMPARISON",
      "scenario_theme": "SHOPPING",
      "scenario_id": "shop-001-bookfair",
      "scenario_selection_method": "default",
      "distractor_strategies": [
        "REVERSED_COMPARISON",
        "WRONG_SELECTION",
        "CALCULATION_ERROR"
      ],
      "distractor_count": 3,
      "theme_variety": false,
      "format_variety": false,
      "enhancement_level": "full",
      "features_active": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "features_pending": [],
      "generation_time_ms": 1
    }
  },
  "metadata": {
    "format": "COMPARISON",
    "cognitive_load": 40,
    "curriculum_alignment": [
      "4N1a"
    ],
    "difficulty": "4.1",
    "scenario_theme": "SHOPPING",
    "distractor_strategies": [
      "REVERSED_COMPARISON",
      "WRONG_SELECTION",
      "CALCULATION_ERROR"
    ],
    "generation_time_ms": 1,
    "api_version": "2.0",
    "enhancement_status": "full",
    "format_requested": "COMPARISON",
    "format_used": "COMPARISON",
    "features_active": [
      "enhanced_distractors",
      "rich_scenarios",
      "cognitive_load",
      "advanced_formats"
    ],
    "features_pending": []
  },
  "context": {
    "id": "shop-001-bookfair",
    "theme": "SHOPPING",
    "setting": {
      "location": "school book fair",
      "timeContext": "lunch break",
      "atmosphere": "busy"
    },
    "characters": [
      {
        "name": "Sarah",
        "role": "student"
      },
      {
        "name": "Mr. Johnson",
        "role": "teacher"
      }
    ],
    "items": [
      {
        "name": "book",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 3,
          "max": 12,
          "typical": 6.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "bookmark",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.5,
          "max": 2,
          "typical": 1,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      }
    ],
    "culturalElements": [
      {
        "type": "currency",
        "value": "£",
        "explanation": "British pounds"
      },
      {
        "type": "event",
        "value": "book fair",
        "explanation": "School fundraising event"
      }
    ],
    "realWorldConnection": "School fundraising and reading promotion",
    "yearAppropriate": [
      2,
      3,
      4,
      5
    ],
    "templates": [
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "COMPARISON"
        ],
        "template": "{character} wants to buy books at the book fair. Calculate the total cost.",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      }
    ]
  }
}
# Test B.11: MULTI_STEP model
{
  "success": true,
  "question": {
    "text": "Sarah wants to buy books at the book fair. Calculate the total cost.",
    "options": [
      {
        "text": "15",
        "value": 15,
        "index": 0
      },
      {
        "text": "£16.00",
        "value": 16,
        "index": 1
      },
      {
        "text": "17",
        "value": 17,
        "index": 2
      }
    ],
    "correctIndex": 1,
    "format": "DIRECT_CALCULATION",
    "difficulty": {
      "year": 4,
      "subLevel": 1,
      "displayName": "4.1",
      "cognitiveLoad": 40
    },
    "cognitiveLoad": 40,
    "curriculumTags": [
      "4N1a"
    ],
    "scenario": {
      "id": "shop-001-bookfair",
      "theme": "SHOPPING",
      "setting": {
        "location": "school book fair",
        "timeContext": "lunch break",
        "atmosphere": "busy"
      },
      "characters": [
        {
          "name": "Sarah",
          "role": "student"
        },
        {
          "name": "Mr. Johnson",
          "role": "teacher"
        }
      ],
      "items": [
        {
          "name": "book",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 3,
            "max": 12,
            "typical": 6.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "bookmark",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.5,
            "max": 2,
            "typical": 1,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        }
      ],
      "culturalElements": [
        {
          "type": "currency",
          "value": "£",
          "explanation": "British pounds"
        },
        {
          "type": "event",
          "value": "book fair",
          "explanation": "School fundraising event"
        }
      ],
      "realWorldConnection": "School fundraising and reading promotion",
      "yearAppropriate": [
        2,
        3,
        4,
        5
      ],
      "templates": [
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "COMPARISON"
          ],
          "template": "{character} wants to buy books at the book fair. Calculate the total cost.",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        }
      ]
    },
    "distractors": [
      {
        "value": 17,
        "displayText": "17",
        "strategy": "CLOSE_VALUE",
        "reasoning": "Off by 1"
      },
      {
        "value": 15,
        "displayText": "15",
        "strategy": "CLOSE_VALUE",
        "reasoning": "Off by 1"
      }
    ],
    "enhancementStatus": {
      "level": "partial",
      "requestedFormat": "DIRECT_CALCULATION",
      "actualFormat": "DIRECT_CALCULATION",
      "featuresActive": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "featuresPending": [],
      "isFullyEnhanced": true
    },
    "mathOutput": {
      "operation": "MULTI_STEP",
      "step_1_result": 18,
      "step_2_result": 67,
      "step_3_result": 16
    },
    "generationTime": 1,
    "questionId": "q_1759077133047_4i94g2e19",
    "generationSetup": {
      "controller_used": "DIRECT_CALCULATIONController",
      "format_requested": "DIRECT_CALCULATION",
      "format_actual": "DIRECT_CALCULATION",
      "scenario_theme": "SHOPPING",
      "scenario_id": "shop-001-bookfair",
      "scenario_selection_method": "default",
      "distractor_strategies": [
        "CLOSE_VALUE",
        "CLOSE_VALUE"
      ],
      "distractor_count": 2,
      "theme_variety": false,
      "format_variety": false,
      "enhancement_level": "partial",
      "features_active": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "features_pending": [],
      "generation_time_ms": 1
    }
  },
  "metadata": {
    "format": "DIRECT_CALCULATION",
    "cognitive_load": 40,
    "curriculum_alignment": [
      "4N1a"
    ],
    "difficulty": "4.1",
    "scenario_theme": "SHOPPING",
    "distractor_strategies": [
      "CLOSE_VALUE",
      "CLOSE_VALUE"
    ],
    "generation_time_ms": 1,
    "api_version": "2.0",
    "enhancement_status": "partial",
    "format_requested": "DIRECT_CALCULATION",
    "format_used": "DIRECT_CALCULATION",
    "features_active": [
      "enhanced_distractors",
      "rich_scenarios",
      "cognitive_load",
      "advanced_formats"
    ],
    "features_pending": []
  },
  "context": {
    "id": "shop-001-bookfair",
    "theme": "SHOPPING",
    "setting": {
      "location": "school book fair",
      "timeContext": "lunch break",
      "atmosphere": "busy"
    },
    "characters": [
      {
        "name": "Sarah",
        "role": "student"
      },
      {
        "name": "Mr. Johnson",
        "role": "teacher"
      }
    ],
    "items": [
      {
        "name": "book",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 3,
          "max": 12,
          "typical": 6.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "bookmark",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.5,
          "max": 2,
          "typical": 1,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      }
    ],
    "culturalElements": [
      {
        "type": "currency",
        "value": "£",
        "explanation": "British pounds"
      },
      {
        "type": "event",
        "value": "book fair",
        "explanation": "School fundraising event"
      }
    ],
    "realWorldConnection": "School fundraising and reading promotion",
    "yearAppropriate": [
      2,
      3,
      4,
      5
    ],
    "templates": [
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "COMPARISON"
        ],
        "template": "{character} wants to buy books at the book fair. Calculate the total cost.",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      }
    ]
  }
}
# Test B.12: LINEAR_EQUATION model
{
  "success": true,
  "question": {
    "text": "Charlotte goes to the shop and buys apple, banana, sandwich, drink, cake, biscuit, sweet, chocolate, pen, pencil, ruler, notebook, eraser, book, comic, magazine, toy, game, puzzle, sticker, badge, poster, card. How much does Charlotte spend in total?",
    "options": [
      {
        "value": 0,
        "text": "0p",
        "isCorrect": true
      }
    ],
    "correctIndex": 0,
    "format": "DIRECT_CALCULATION",
    "difficulty": {
      "year": 4,
      "subLevel": 1,
      "displayName": "4.1",
      "cognitiveLoad": 40
    },
    "cognitiveLoad": 40,
    "curriculumTags": [
      "4N1a"
    ],
    "scenario": {
      "id": "shop-002-realistic-general",
      "theme": "SHOPPING",
      "setting": {
        "location": "local shop",
        "timeContext": "after school",
        "atmosphere": "friendly"
      },
      "characters": [
        {
          "name": "Charlotte",
          "role": "student"
        }
      ],
      "items": [
        {
          "name": "apple",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.2,
            "max": 0.5,
            "typical": 0.35,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "banana",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.15,
            "max": 0.4,
            "typical": 0.25,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "sandwich",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 2.5,
            "max": 6,
            "typical": 4,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "drink",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.8,
            "max": 2.5,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "cake",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 1.5,
            "max": 4,
            "typical": 2.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "biscuit",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.8,
            "max": 2,
            "typical": 1.2,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "sweet",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.1,
            "max": 1,
            "typical": 0.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "chocolate",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.6,
            "max": 3,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "pen",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.5,
            "max": 2,
            "typical": 1,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "pencil",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.2,
            "max": 1,
            "typical": 0.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "ruler",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.8,
            "max": 2.5,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "notebook",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 1,
            "max": 4,
            "typical": 2,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "eraser",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.3,
            "max": 1.5,
            "typical": 0.75,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "book",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 3,
            "max": 15,
            "typical": 8,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "comic",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 2,
            "max": 5,
            "typical": 3,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "magazine",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 2.5,
            "max": 6,
            "typical": 4,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "toy",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 5,
            "max": 25,
            "typical": 12,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "game",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 8,
            "max": 60,
            "typical": 25,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "puzzle",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 5,
            "max": 20,
            "typical": 12,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "sticker",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 0.2,
            "max": 2,
            "typical": 0.8,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "badge",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 0.5,
            "max": 3,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "poster",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 2,
            "max": 8,
            "typical": 4,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "card",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 0.5,
            "max": 4,
            "typical": 2,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        }
      ],
      "culturalElements": [
        {
          "type": "currency",
          "value": "£",
          "explanation": "British pounds"
        },
        {
          "type": "location",
          "value": "UK local shop",
          "explanation": "Typical British corner shop"
        }
      ],
      "realWorldConnection": "Everyday shopping with realistic UK prices",
      "yearAppropriate": [
        1,
        2,
        3,
        4,
        5,
        6
      ],
      "templates": [
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "MULTI_STEP"
          ],
          "modelCompatibility": [
            "ADDITION"
          ],
          "operandCount": 3,
          "template": "{character} buys a {item1} for {price1}, a {item2} for {price2}, and a {item3} for {price3}. What is the total cost?",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item1",
              "type": "item"
            },
            {
              "key": "item2",
              "type": "item"
            },
            {
              "key": "item3",
              "type": "item"
            },
            {
              "key": "price1",
              "type": "value"
            },
            {
              "key": "price2",
              "type": "value"
            },
            {
              "key": "price3",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "MULTI_STEP"
          ],
          "modelCompatibility": [
            "ADDITION"
          ],
          "operandCount": 2,
          "template": "{character} buys a {item1} for {price1} and a {item2} for {price2}. What is the total cost?",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item1",
              "type": "item"
            },
            {
              "key": "item2",
              "type": "item"
            },
            {
              "key": "price1",
              "type": "value"
            },
            {
              "key": "price2",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION"
          ],
          "modelCompatibility": [
            "SUBTRACTION",
            "CHANGE_CALCULATION"
          ],
          "template": "{character} buys a {item} for {price} and pays with {payment}. How much change does {character} get?",
          "answerTemplate": "{character} receives {result} in change",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "price",
              "type": "value"
            },
            {
              "key": "payment",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION"
          ],
          "modelCompatibility": [
            "MULTIPLICATION"
          ],
          "template": "{character} buys {quantity} {item} at {price} each. What is the total cost?",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "quantity",
              "type": "value"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "price",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION"
          ],
          "modelCompatibility": [
            "DIVISION"
          ],
          "template": "{character} has {total} to spend equally on {quantity} {item}. How much can {character} spend on each one?",
          "answerTemplate": "{character} can spend {result} on each {item}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "total",
              "type": "value"
            },
            {
              "key": "quantity",
              "type": "value"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "COMPARISON",
            "ESTIMATION",
            "MULTI_STEP"
          ],
          "template": "{character} goes to the shop and buys {items}. How much does {character} spend in total?",
          "answerTemplate": "{character} spends {result} in total",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "items",
              "type": "item_list"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "ESTIMATION"
          ],
          "template": "Estimate: If {character} buys {items}, about how much will it cost?",
          "answerTemplate": "It will cost approximately {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "items",
              "type": "item_list"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "VALIDATION"
          ],
          "template": "{character} calculated that {items} costs {amount}. Is this correct?",
          "answerTemplate": "{validation_result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "items",
              "type": "item_list"
            },
            {
              "key": "amount",
              "type": "value"
            },
            {
              "key": "validation_result",
              "type": "boolean"
            }
          ]
        }
      ]
    },
    "distractors": [],
    "enhancementStatus": {
      "level": "partial",
      "requestedFormat": "DIRECT_CALCULATION",
      "actualFormat": "DIRECT_CALCULATION",
      "featuresActive": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "featuresPending": [],
      "isFullyEnhanced": true
    },
    "mathOutput": {
      "operation": "LINEAR_EQUATION",
      "slope": 4,
      "intercept": 7
    },
    "generationTime": 0,
    "questionId": "q_1759077133091_46e0imvzl",
    "generationSetup": {
      "controller_used": "DIRECT_CALCULATIONController",
      "format_requested": "DIRECT_CALCULATION",
      "format_actual": "DIRECT_CALCULATION",
      "scenario_theme": "SHOPPING",
      "scenario_id": "shop-002-realistic-general",
      "scenario_selection_method": "default",
      "distractor_strategies": [],
      "distractor_count": 0,
      "theme_variety": false,
      "format_variety": false,
      "enhancement_level": "partial",
      "features_active": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "features_pending": [],
      "generation_time_ms": 0
    }
  },
  "metadata": {
    "format": "DIRECT_CALCULATION",
    "cognitive_load": 40,
    "curriculum_alignment": [
      "4N1a"
    ],
    "difficulty": "4.1",
    "scenario_theme": "SHOPPING",
    "distractor_strategies": [],
    "generation_time_ms": 1,
    "api_version": "2.0",
    "enhancement_status": "partial",
    "format_requested": "DIRECT_CALCULATION",
    "format_used": "DIRECT_CALCULATION",
    "features_active": [
      "enhanced_distractors",
      "rich_scenarios",
      "cognitive_load",
      "advanced_formats"
    ],
    "features_pending": []
  },
  "context": {
    "id": "shop-002-realistic-general",
    "theme": "SHOPPING",
    "setting": {
      "location": "local shop",
      "timeContext": "after school",
      "atmosphere": "friendly"
    },
    "characters": [
      {
        "name": "Charlotte",
        "role": "student"
      }
    ],
    "items": [
      {
        "name": "apple",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.2,
          "max": 0.5,
          "typical": 0.35,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "banana",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.15,
          "max": 0.4,
          "typical": 0.25,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "sandwich",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 2.5,
          "max": 6,
          "typical": 4,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "drink",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.8,
          "max": 2.5,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "cake",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 1.5,
          "max": 4,
          "typical": 2.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "biscuit",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.8,
          "max": 2,
          "typical": 1.2,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "sweet",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.1,
          "max": 1,
          "typical": 0.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "chocolate",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.6,
          "max": 3,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "pen",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.5,
          "max": 2,
          "typical": 1,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "pencil",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.2,
          "max": 1,
          "typical": 0.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "ruler",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.8,
          "max": 2.5,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "notebook",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 1,
          "max": 4,
          "typical": 2,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "eraser",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.3,
          "max": 1.5,
          "typical": 0.75,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "book",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 3,
          "max": 15,
          "typical": 8,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "comic",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 2,
          "max": 5,
          "typical": 3,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "magazine",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 2.5,
          "max": 6,
          "typical": 4,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "toy",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 5,
          "max": 25,
          "typical": 12,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "game",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 8,
          "max": 60,
          "typical": 25,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "puzzle",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 5,
          "max": 20,
          "typical": 12,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "sticker",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 0.2,
          "max": 2,
          "typical": 0.8,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "badge",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 0.5,
          "max": 3,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "poster",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 2,
          "max": 8,
          "typical": 4,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "card",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 0.5,
          "max": 4,
          "typical": 2,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      }
    ],
    "culturalElements": [
      {
        "type": "currency",
        "value": "£",
        "explanation": "British pounds"
      },
      {
        "type": "location",
        "value": "UK local shop",
        "explanation": "Typical British corner shop"
      }
    ],
    "realWorldConnection": "Everyday shopping with realistic UK prices",
    "yearAppropriate": [
      1,
      2,
      3,
      4,
      5,
      6
    ],
    "templates": [
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "MULTI_STEP"
        ],
        "modelCompatibility": [
          "ADDITION"
        ],
        "operandCount": 3,
        "template": "{character} buys a {item1} for {price1}, a {item2} for {price2}, and a {item3} for {price3}. What is the total cost?",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item1",
            "type": "item"
          },
          {
            "key": "item2",
            "type": "item"
          },
          {
            "key": "item3",
            "type": "item"
          },
          {
            "key": "price1",
            "type": "value"
          },
          {
            "key": "price2",
            "type": "value"
          },
          {
            "key": "price3",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "MULTI_STEP"
        ],
        "modelCompatibility": [
          "ADDITION"
        ],
        "operandCount": 2,
        "template": "{character} buys a {item1} for {price1} and a {item2} for {price2}. What is the total cost?",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item1",
            "type": "item"
          },
          {
            "key": "item2",
            "type": "item"
          },
          {
            "key": "price1",
            "type": "value"
          },
          {
            "key": "price2",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION"
        ],
        "modelCompatibility": [
          "SUBTRACTION",
          "CHANGE_CALCULATION"
        ],
        "template": "{character} buys a {item} for {price} and pays with {payment}. How much change does {character} get?",
        "answerTemplate": "{character} receives {result} in change",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "price",
            "type": "value"
          },
          {
            "key": "payment",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION"
        ],
        "modelCompatibility": [
          "MULTIPLICATION"
        ],
        "template": "{character} buys {quantity} {item} at {price} each. What is the total cost?",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "quantity",
            "type": "value"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "price",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION"
        ],
        "modelCompatibility": [
          "DIVISION"
        ],
        "template": "{character} has {total} to spend equally on {quantity} {item}. How much can {character} spend on each one?",
        "answerTemplate": "{character} can spend {result} on each {item}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "total",
            "type": "value"
          },
          {
            "key": "quantity",
            "type": "value"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "COMPARISON",
          "ESTIMATION",
          "MULTI_STEP"
        ],
        "template": "{character} goes to the shop and buys {items}. How much does {character} spend in total?",
        "answerTemplate": "{character} spends {result} in total",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "items",
            "type": "item_list"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "ESTIMATION"
        ],
        "template": "Estimate: If {character} buys {items}, about how much will it cost?",
        "answerTemplate": "It will cost approximately {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "items",
            "type": "item_list"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "VALIDATION"
        ],
        "template": "{character} calculated that {items} costs {amount}. Is this correct?",
        "answerTemplate": "{validation_result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "items",
            "type": "item_list"
          },
          {
            "key": "amount",
            "type": "value"
          },
          {
            "key": "validation_result",
            "type": "boolean"
          }
        ]
      }
    ]
  }
}
# Test B.13: UNIT_RATE model
{
  "success": true,
  "question": {
    "text": "Sarah wants to buy books at the book fair. Calculate the total cost.",
    "options": [
      {
        "value": 0,
        "text": "0p",
        "isCorrect": true
      }
    ],
    "correctIndex": 0,
    "format": "DIRECT_CALCULATION",
    "difficulty": {
      "year": 4,
      "subLevel": 1,
      "displayName": "4.1",
      "cognitiveLoad": 40
    },
    "cognitiveLoad": 40,
    "curriculumTags": [
      "4N1a"
    ],
    "scenario": {
      "id": "shop-001-bookfair",
      "theme": "SHOPPING",
      "setting": {
        "location": "school book fair",
        "timeContext": "lunch break",
        "atmosphere": "busy"
      },
      "characters": [
        {
          "name": "Sarah",
          "role": "student"
        },
        {
          "name": "Mr. Johnson",
          "role": "teacher"
        }
      ],
      "items": [
        {
          "name": "book",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 3,
            "max": 12,
            "typical": 6.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "bookmark",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.5,
            "max": 2,
            "typical": 1,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        }
      ],
      "culturalElements": [
        {
          "type": "currency",
          "value": "£",
          "explanation": "British pounds"
        },
        {
          "type": "event",
          "value": "book fair",
          "explanation": "School fundraising event"
        }
      ],
      "realWorldConnection": "School fundraising and reading promotion",
      "yearAppropriate": [
        2,
        3,
        4,
        5
      ],
      "templates": [
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "COMPARISON"
          ],
          "template": "{character} wants to buy books at the book fair. Calculate the total cost.",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        }
      ]
    },
    "distractors": [],
    "enhancementStatus": {
      "level": "partial",
      "requestedFormat": "DIRECT_CALCULATION",
      "actualFormat": "DIRECT_CALCULATION",
      "featuresActive": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "featuresPending": [],
      "isFullyEnhanced": true
    },
    "mathOutput": {
      "operation": "UNIT_RATE"
    },
    "generationTime": 0,
    "questionId": "q_1759077133135_mch57jw80",
    "generationSetup": {
      "controller_used": "DIRECT_CALCULATIONController",
      "format_requested": "DIRECT_CALCULATION",
      "format_actual": "DIRECT_CALCULATION",
      "scenario_theme": "SHOPPING",
      "scenario_id": "shop-001-bookfair",
      "scenario_selection_method": "default",
      "distractor_strategies": [],
      "distractor_count": 0,
      "theme_variety": false,
      "format_variety": false,
      "enhancement_level": "partial",
      "features_active": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "features_pending": [],
      "generation_time_ms": 0
    }
  },
  "metadata": {
    "format": "DIRECT_CALCULATION",
    "cognitive_load": 40,
    "curriculum_alignment": [
      "4N1a"
    ],
    "difficulty": "4.1",
    "scenario_theme": "SHOPPING",
    "distractor_strategies": [],
    "generation_time_ms": 0,
    "api_version": "2.0",
    "enhancement_status": "partial",
    "format_requested": "DIRECT_CALCULATION",
    "format_used": "DIRECT_CALCULATION",
    "features_active": [
      "enhanced_distractors",
      "rich_scenarios",
      "cognitive_load",
      "advanced_formats"
    ],
    "features_pending": []
  },
  "context": {
    "id": "shop-001-bookfair",
    "theme": "SHOPPING",
    "setting": {
      "location": "school book fair",
      "timeContext": "lunch break",
      "atmosphere": "busy"
    },
    "characters": [
      {
        "name": "Sarah",
        "role": "student"
      },
      {
        "name": "Mr. Johnson",
        "role": "teacher"
      }
    ],
    "items": [
      {
        "name": "book",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 3,
          "max": 12,
          "typical": 6.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "bookmark",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.5,
          "max": 2,
          "typical": 1,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      }
    ],
    "culturalElements": [
      {
        "type": "currency",
        "value": "£",
        "explanation": "British pounds"
      },
      {
        "type": "event",
        "value": "book fair",
        "explanation": "School fundraising event"
      }
    ],
    "realWorldConnection": "School fundraising and reading promotion",
    "yearAppropriate": [
      2,
      3,
      4,
      5
    ],
    "templates": [
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "COMPARISON"
        ],
        "template": "{character} wants to buy books at the book fair. Calculate the total cost.",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      }
    ]
  }
}
# Test B.14: COIN_RECOGNITION model
{
  "success": true,
  "question": {
    "text": "Charlotte goes to the shop and buys apple, banana, sandwich, drink, cake, biscuit, sweet, chocolate, pen, pencil, ruler, notebook, eraser, book, comic, magazine, toy, game, puzzle, sticker, badge, poster, card. How much does Charlotte spend in total?",
    "options": [
      {
        "value": 0,
        "text": "0p",
        "isCorrect": true
      }
    ],
    "correctIndex": 0,
    "format": "DIRECT_CALCULATION",
    "difficulty": {
      "year": 4,
      "subLevel": 1,
      "displayName": "4.1",
      "cognitiveLoad": 40
    },
    "cognitiveLoad": 40,
    "curriculumTags": [
      "4N1a"
    ],
    "scenario": {
      "id": "shop-002-realistic-general",
      "theme": "SHOPPING",
      "setting": {
        "location": "local shop",
        "timeContext": "after school",
        "atmosphere": "friendly"
      },
      "characters": [
        {
          "name": "Charlotte",
          "role": "student"
        }
      ],
      "items": [
        {
          "name": "apple",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.2,
            "max": 0.5,
            "typical": 0.35,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "banana",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.15,
            "max": 0.4,
            "typical": 0.25,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "sandwich",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 2.5,
            "max": 6,
            "typical": 4,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "drink",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.8,
            "max": 2.5,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "cake",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 1.5,
            "max": 4,
            "typical": 2.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "biscuit",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.8,
            "max": 2,
            "typical": 1.2,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "sweet",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.1,
            "max": 1,
            "typical": 0.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "chocolate",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.6,
            "max": 3,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "pen",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.5,
            "max": 2,
            "typical": 1,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "pencil",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.2,
            "max": 1,
            "typical": 0.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "ruler",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.8,
            "max": 2.5,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "notebook",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 1,
            "max": 4,
            "typical": 2,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "eraser",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.3,
            "max": 1.5,
            "typical": 0.75,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "book",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 3,
            "max": 15,
            "typical": 8,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "comic",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 2,
            "max": 5,
            "typical": 3,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "magazine",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 2.5,
            "max": 6,
            "typical": 4,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "toy",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 5,
            "max": 25,
            "typical": 12,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "game",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 8,
            "max": 60,
            "typical": 25,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "puzzle",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 5,
            "max": 20,
            "typical": 12,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "sticker",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 0.2,
            "max": 2,
            "typical": 0.8,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "badge",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 0.5,
            "max": 3,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "poster",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 2,
            "max": 8,
            "typical": 4,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "card",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 0.5,
            "max": 4,
            "typical": 2,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        }
      ],
      "culturalElements": [
        {
          "type": "currency",
          "value": "£",
          "explanation": "British pounds"
        },
        {
          "type": "location",
          "value": "UK local shop",
          "explanation": "Typical British corner shop"
        }
      ],
      "realWorldConnection": "Everyday shopping with realistic UK prices",
      "yearAppropriate": [
        1,
        2,
        3,
        4,
        5,
        6
      ],
      "templates": [
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "MULTI_STEP"
          ],
          "modelCompatibility": [
            "ADDITION"
          ],
          "operandCount": 3,
          "template": "{character} buys a {item1} for {price1}, a {item2} for {price2}, and a {item3} for {price3}. What is the total cost?",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item1",
              "type": "item"
            },
            {
              "key": "item2",
              "type": "item"
            },
            {
              "key": "item3",
              "type": "item"
            },
            {
              "key": "price1",
              "type": "value"
            },
            {
              "key": "price2",
              "type": "value"
            },
            {
              "key": "price3",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "MULTI_STEP"
          ],
          "modelCompatibility": [
            "ADDITION"
          ],
          "operandCount": 2,
          "template": "{character} buys a {item1} for {price1} and a {item2} for {price2}. What is the total cost?",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item1",
              "type": "item"
            },
            {
              "key": "item2",
              "type": "item"
            },
            {
              "key": "price1",
              "type": "value"
            },
            {
              "key": "price2",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION"
          ],
          "modelCompatibility": [
            "SUBTRACTION",
            "CHANGE_CALCULATION"
          ],
          "template": "{character} buys a {item} for {price} and pays with {payment}. How much change does {character} get?",
          "answerTemplate": "{character} receives {result} in change",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "price",
              "type": "value"
            },
            {
              "key": "payment",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION"
          ],
          "modelCompatibility": [
            "MULTIPLICATION"
          ],
          "template": "{character} buys {quantity} {item} at {price} each. What is the total cost?",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "quantity",
              "type": "value"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "price",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION"
          ],
          "modelCompatibility": [
            "DIVISION"
          ],
          "template": "{character} has {total} to spend equally on {quantity} {item}. How much can {character} spend on each one?",
          "answerTemplate": "{character} can spend {result} on each {item}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "total",
              "type": "value"
            },
            {
              "key": "quantity",
              "type": "value"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "COMPARISON",
            "ESTIMATION",
            "MULTI_STEP"
          ],
          "template": "{character} goes to the shop and buys {items}. How much does {character} spend in total?",
          "answerTemplate": "{character} spends {result} in total",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "items",
              "type": "item_list"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "ESTIMATION"
          ],
          "template": "Estimate: If {character} buys {items}, about how much will it cost?",
          "answerTemplate": "It will cost approximately {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "items",
              "type": "item_list"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "VALIDATION"
          ],
          "template": "{character} calculated that {items} costs {amount}. Is this correct?",
          "answerTemplate": "{validation_result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "items",
              "type": "item_list"
            },
            {
              "key": "amount",
              "type": "value"
            },
            {
              "key": "validation_result",
              "type": "boolean"
            }
          ]
        }
      ]
    },
    "distractors": [],
    "enhancementStatus": {
      "level": "partial",
      "requestedFormat": "DIRECT_CALCULATION",
      "actualFormat": "DIRECT_CALCULATION",
      "featuresActive": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "featuresPending": [],
      "isFullyEnhanced": true
    },
    "mathOutput": {
      "operation": "COIN_RECOGNITION",
      "total_value": 5
    },
    "generationTime": 1,
    "questionId": "q_1759077133180_h57oj5n59",
    "generationSetup": {
      "controller_used": "DIRECT_CALCULATIONController",
      "format_requested": "DIRECT_CALCULATION",
      "format_actual": "DIRECT_CALCULATION",
      "scenario_theme": "SHOPPING",
      "scenario_id": "shop-002-realistic-general",
      "scenario_selection_method": "default",
      "distractor_strategies": [],
      "distractor_count": 0,
      "theme_variety": false,
      "format_variety": false,
      "enhancement_level": "partial",
      "features_active": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "features_pending": [],
      "generation_time_ms": 1
    }
  },
  "metadata": {
    "format": "DIRECT_CALCULATION",
    "cognitive_load": 40,
    "curriculum_alignment": [
      "4N1a"
    ],
    "difficulty": "4.1",
    "scenario_theme": "SHOPPING",
    "distractor_strategies": [],
    "generation_time_ms": 1,
    "api_version": "2.0",
    "enhancement_status": "partial",
    "format_requested": "DIRECT_CALCULATION",
    "format_used": "DIRECT_CALCULATION",
    "features_active": [
      "enhanced_distractors",
      "rich_scenarios",
      "cognitive_load",
      "advanced_formats"
    ],
    "features_pending": []
  },
  "context": {
    "id": "shop-002-realistic-general",
    "theme": "SHOPPING",
    "setting": {
      "location": "local shop",
      "timeContext": "after school",
      "atmosphere": "friendly"
    },
    "characters": [
      {
        "name": "Charlotte",
        "role": "student"
      }
    ],
    "items": [
      {
        "name": "apple",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.2,
          "max": 0.5,
          "typical": 0.35,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "banana",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.15,
          "max": 0.4,
          "typical": 0.25,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "sandwich",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 2.5,
          "max": 6,
          "typical": 4,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "drink",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.8,
          "max": 2.5,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "cake",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 1.5,
          "max": 4,
          "typical": 2.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "biscuit",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.8,
          "max": 2,
          "typical": 1.2,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "sweet",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.1,
          "max": 1,
          "typical": 0.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "chocolate",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.6,
          "max": 3,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "pen",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.5,
          "max": 2,
          "typical": 1,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "pencil",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.2,
          "max": 1,
          "typical": 0.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "ruler",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.8,
          "max": 2.5,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "notebook",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 1,
          "max": 4,
          "typical": 2,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "eraser",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.3,
          "max": 1.5,
          "typical": 0.75,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "book",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 3,
          "max": 15,
          "typical": 8,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "comic",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 2,
          "max": 5,
          "typical": 3,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "magazine",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 2.5,
          "max": 6,
          "typical": 4,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "toy",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 5,
          "max": 25,
          "typical": 12,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "game",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 8,
          "max": 60,
          "typical": 25,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "puzzle",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 5,
          "max": 20,
          "typical": 12,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "sticker",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 0.2,
          "max": 2,
          "typical": 0.8,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "badge",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 0.5,
          "max": 3,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "poster",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 2,
          "max": 8,
          "typical": 4,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "card",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 0.5,
          "max": 4,
          "typical": 2,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      }
    ],
    "culturalElements": [
      {
        "type": "currency",
        "value": "£",
        "explanation": "British pounds"
      },
      {
        "type": "location",
        "value": "UK local shop",
        "explanation": "Typical British corner shop"
      }
    ],
    "realWorldConnection": "Everyday shopping with realistic UK prices",
    "yearAppropriate": [
      1,
      2,
      3,
      4,
      5,
      6
    ],
    "templates": [
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "MULTI_STEP"
        ],
        "modelCompatibility": [
          "ADDITION"
        ],
        "operandCount": 3,
        "template": "{character} buys a {item1} for {price1}, a {item2} for {price2}, and a {item3} for {price3}. What is the total cost?",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item1",
            "type": "item"
          },
          {
            "key": "item2",
            "type": "item"
          },
          {
            "key": "item3",
            "type": "item"
          },
          {
            "key": "price1",
            "type": "value"
          },
          {
            "key": "price2",
            "type": "value"
          },
          {
            "key": "price3",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "MULTI_STEP"
        ],
        "modelCompatibility": [
          "ADDITION"
        ],
        "operandCount": 2,
        "template": "{character} buys a {item1} for {price1} and a {item2} for {price2}. What is the total cost?",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item1",
            "type": "item"
          },
          {
            "key": "item2",
            "type": "item"
          },
          {
            "key": "price1",
            "type": "value"
          },
          {
            "key": "price2",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION"
        ],
        "modelCompatibility": [
          "SUBTRACTION",
          "CHANGE_CALCULATION"
        ],
        "template": "{character} buys a {item} for {price} and pays with {payment}. How much change does {character} get?",
        "answerTemplate": "{character} receives {result} in change",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "price",
            "type": "value"
          },
          {
            "key": "payment",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION"
        ],
        "modelCompatibility": [
          "MULTIPLICATION"
        ],
        "template": "{character} buys {quantity} {item} at {price} each. What is the total cost?",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "quantity",
            "type": "value"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "price",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION"
        ],
        "modelCompatibility": [
          "DIVISION"
        ],
        "template": "{character} has {total} to spend equally on {quantity} {item}. How much can {character} spend on each one?",
        "answerTemplate": "{character} can spend {result} on each {item}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "total",
            "type": "value"
          },
          {
            "key": "quantity",
            "type": "value"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "COMPARISON",
          "ESTIMATION",
          "MULTI_STEP"
        ],
        "template": "{character} goes to the shop and buys {items}. How much does {character} spend in total?",
        "answerTemplate": "{character} spends {result} in total",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "items",
            "type": "item_list"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "ESTIMATION"
        ],
        "template": "Estimate: If {character} buys {items}, about how much will it cost?",
        "answerTemplate": "It will cost approximately {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "items",
            "type": "item_list"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "VALIDATION"
        ],
        "template": "{character} calculated that {items} costs {amount}. Is this correct?",
        "answerTemplate": "{validation_result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "items",
            "type": "item_list"
          },
          {
            "key": "amount",
            "type": "value"
          },
          {
            "key": "validation_result",
            "type": "boolean"
          }
        ]
      }
    ]
  }
}
# Test B.15: CHANGE_CALCULATION model
{
  "success": true,
  "question": {
    "text": "Sarah wants to buy books at the book fair. Calculate the total cost.",
    "options": [
      {
        "value": 0,
        "text": "0p",
        "isCorrect": true
      }
    ],
    "correctIndex": 0,
    "format": "DIRECT_CALCULATION",
    "difficulty": {
      "year": 4,
      "subLevel": 1,
      "displayName": "4.1",
      "cognitiveLoad": 40
    },
    "cognitiveLoad": 40,
    "curriculumTags": [
      "4N1a"
    ],
    "scenario": {
      "id": "shop-001-bookfair",
      "theme": "SHOPPING",
      "setting": {
        "location": "school book fair",
        "timeContext": "lunch break",
        "atmosphere": "busy"
      },
      "characters": [
        {
          "name": "Sarah",
          "role": "student"
        },
        {
          "name": "Mr. Johnson",
          "role": "teacher"
        }
      ],
      "items": [
        {
          "name": "book",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 3,
            "max": 12,
            "typical": 6.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "bookmark",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.5,
            "max": 2,
            "typical": 1,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        }
      ],
      "culturalElements": [
        {
          "type": "currency",
          "value": "£",
          "explanation": "British pounds"
        },
        {
          "type": "event",
          "value": "book fair",
          "explanation": "School fundraising event"
        }
      ],
      "realWorldConnection": "School fundraising and reading promotion",
      "yearAppropriate": [
        2,
        3,
        4,
        5
      ],
      "templates": [
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "COMPARISON"
          ],
          "template": "{character} wants to buy books at the book fair. Calculate the total cost.",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        }
      ]
    },
    "distractors": [],
    "enhancementStatus": {
      "level": "partial",
      "requestedFormat": "DIRECT_CALCULATION",
      "actualFormat": "DIRECT_CALCULATION",
      "featuresActive": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "featuresPending": [],
      "isFullyEnhanced": true
    },
    "mathOutput": {
      "operation": "CHANGE_CALCULATION"
    },
    "generationTime": 1,
    "questionId": "q_1759077133226_m31lhssmw",
    "generationSetup": {
      "controller_used": "DIRECT_CALCULATIONController",
      "format_requested": "DIRECT_CALCULATION",
      "format_actual": "DIRECT_CALCULATION",
      "scenario_theme": "SHOPPING",
      "scenario_id": "shop-001-bookfair",
      "scenario_selection_method": "default",
      "distractor_strategies": [],
      "distractor_count": 0,
      "theme_variety": false,
      "format_variety": false,
      "enhancement_level": "partial",
      "features_active": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "features_pending": [],
      "generation_time_ms": 1
    }
  },
  "metadata": {
    "format": "DIRECT_CALCULATION",
    "cognitive_load": 40,
    "curriculum_alignment": [
      "4N1a"
    ],
    "difficulty": "4.1",
    "scenario_theme": "SHOPPING",
    "distractor_strategies": [],
    "generation_time_ms": 1,
    "api_version": "2.0",
    "enhancement_status": "partial",
    "format_requested": "DIRECT_CALCULATION",
    "format_used": "DIRECT_CALCULATION",
    "features_active": [
      "enhanced_distractors",
      "rich_scenarios",
      "cognitive_load",
      "advanced_formats"
    ],
    "features_pending": []
  },
  "context": {
    "id": "shop-001-bookfair",
    "theme": "SHOPPING",
    "setting": {
      "location": "school book fair",
      "timeContext": "lunch break",
      "atmosphere": "busy"
    },
    "characters": [
      {
        "name": "Sarah",
        "role": "student"
      },
      {
        "name": "Mr. Johnson",
        "role": "teacher"
      }
    ],
    "items": [
      {
        "name": "book",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 3,
          "max": 12,
          "typical": 6.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "bookmark",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.5,
          "max": 2,
          "typical": 1,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      }
    ],
    "culturalElements": [
      {
        "type": "currency",
        "value": "£",
        "explanation": "British pounds"
      },
      {
        "type": "event",
        "value": "book fair",
        "explanation": "School fundraising event"
      }
    ],
    "realWorldConnection": "School fundraising and reading promotion",
    "yearAppropriate": [
      2,
      3,
      4,
      5
    ],
    "templates": [
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "COMPARISON"
        ],
        "template": "{character} wants to buy books at the book fair. Calculate the total cost.",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      }
    ]
  }
}
# Test B.16: MONEY_COMBINATIONS model
{
  "success": true,
  "question": {
    "text": "Charlotte goes to the shop and buys apple, banana, sandwich, drink, cake, biscuit, sweet, chocolate, pen, pencil, ruler, notebook, eraser, book, comic, magazine, toy, game, puzzle, sticker, badge, poster, card. How much does Charlotte spend in total?",
    "options": [
      {
        "value": 0,
        "text": "0p",
        "isCorrect": true
      }
    ],
    "correctIndex": 0,
    "format": "DIRECT_CALCULATION",
    "difficulty": {
      "year": 4,
      "subLevel": 1,
      "displayName": "4.1",
      "cognitiveLoad": 40
    },
    "cognitiveLoad": 40,
    "curriculumTags": [
      "4N1a"
    ],
    "scenario": {
      "id": "shop-002-realistic-general",
      "theme": "SHOPPING",
      "setting": {
        "location": "local shop",
        "timeContext": "after school",
        "atmosphere": "friendly"
      },
      "characters": [
        {
          "name": "Charlotte",
          "role": "student"
        }
      ],
      "items": [
        {
          "name": "apple",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.2,
            "max": 0.5,
            "typical": 0.35,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "banana",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.15,
            "max": 0.4,
            "typical": 0.25,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "sandwich",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 2.5,
            "max": 6,
            "typical": 4,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "drink",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.8,
            "max": 2.5,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "cake",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 1.5,
            "max": 4,
            "typical": 2.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "biscuit",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.8,
            "max": 2,
            "typical": 1.2,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "sweet",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.1,
            "max": 1,
            "typical": 0.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "chocolate",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.6,
            "max": 3,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "pen",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.5,
            "max": 2,
            "typical": 1,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "pencil",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.2,
            "max": 1,
            "typical": 0.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "ruler",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.8,
            "max": 2.5,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "notebook",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 1,
            "max": 4,
            "typical": 2,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "eraser",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.3,
            "max": 1.5,
            "typical": 0.75,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "book",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 3,
            "max": 15,
            "typical": 8,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "comic",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 2,
            "max": 5,
            "typical": 3,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "magazine",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 2.5,
            "max": 6,
            "typical": 4,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "toy",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 5,
            "max": 25,
            "typical": 12,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "game",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 8,
            "max": 60,
            "typical": 25,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "puzzle",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 5,
            "max": 20,
            "typical": 12,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "sticker",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 0.2,
            "max": 2,
            "typical": 0.8,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "badge",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 0.5,
            "max": 3,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "poster",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 2,
            "max": 8,
            "typical": 4,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "card",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 0.5,
            "max": 4,
            "typical": 2,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        }
      ],
      "culturalElements": [
        {
          "type": "currency",
          "value": "£",
          "explanation": "British pounds"
        },
        {
          "type": "location",
          "value": "UK local shop",
          "explanation": "Typical British corner shop"
        }
      ],
      "realWorldConnection": "Everyday shopping with realistic UK prices",
      "yearAppropriate": [
        1,
        2,
        3,
        4,
        5,
        6
      ],
      "templates": [
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "MULTI_STEP"
          ],
          "modelCompatibility": [
            "ADDITION"
          ],
          "operandCount": 3,
          "template": "{character} buys a {item1} for {price1}, a {item2} for {price2}, and a {item3} for {price3}. What is the total cost?",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item1",
              "type": "item"
            },
            {
              "key": "item2",
              "type": "item"
            },
            {
              "key": "item3",
              "type": "item"
            },
            {
              "key": "price1",
              "type": "value"
            },
            {
              "key": "price2",
              "type": "value"
            },
            {
              "key": "price3",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "MULTI_STEP"
          ],
          "modelCompatibility": [
            "ADDITION"
          ],
          "operandCount": 2,
          "template": "{character} buys a {item1} for {price1} and a {item2} for {price2}. What is the total cost?",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item1",
              "type": "item"
            },
            {
              "key": "item2",
              "type": "item"
            },
            {
              "key": "price1",
              "type": "value"
            },
            {
              "key": "price2",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION"
          ],
          "modelCompatibility": [
            "SUBTRACTION",
            "CHANGE_CALCULATION"
          ],
          "template": "{character} buys a {item} for {price} and pays with {payment}. How much change does {character} get?",
          "answerTemplate": "{character} receives {result} in change",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "price",
              "type": "value"
            },
            {
              "key": "payment",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION"
          ],
          "modelCompatibility": [
            "MULTIPLICATION"
          ],
          "template": "{character} buys {quantity} {item} at {price} each. What is the total cost?",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "quantity",
              "type": "value"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "price",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION"
          ],
          "modelCompatibility": [
            "DIVISION"
          ],
          "template": "{character} has {total} to spend equally on {quantity} {item}. How much can {character} spend on each one?",
          "answerTemplate": "{character} can spend {result} on each {item}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "total",
              "type": "value"
            },
            {
              "key": "quantity",
              "type": "value"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "COMPARISON",
            "ESTIMATION",
            "MULTI_STEP"
          ],
          "template": "{character} goes to the shop and buys {items}. How much does {character} spend in total?",
          "answerTemplate": "{character} spends {result} in total",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "items",
              "type": "item_list"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "ESTIMATION"
          ],
          "template": "Estimate: If {character} buys {items}, about how much will it cost?",
          "answerTemplate": "It will cost approximately {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "items",
              "type": "item_list"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "VALIDATION"
          ],
          "template": "{character} calculated that {items} costs {amount}. Is this correct?",
          "answerTemplate": "{validation_result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "items",
              "type": "item_list"
            },
            {
              "key": "amount",
              "type": "value"
            },
            {
              "key": "validation_result",
              "type": "boolean"
            }
          ]
        }
      ]
    },
    "distractors": [],
    "enhancementStatus": {
      "level": "partial",
      "requestedFormat": "DIRECT_CALCULATION",
      "actualFormat": "DIRECT_CALCULATION",
      "featuresActive": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "featuresPending": [],
      "isFullyEnhanced": true
    },
    "mathOutput": {
      "operation": "MONEY_COMBINATIONS",
      "target_amount": 464,
      "combination_count": 3
    },
    "generationTime": 41439,
    "questionId": "q_1759077174706_fxnbuz2zp",
    "generationSetup": {
      "controller_used": "DIRECT_CALCULATIONController",
      "format_requested": "DIRECT_CALCULATION",
      "format_actual": "DIRECT_CALCULATION",
      "scenario_theme": "SHOPPING",
      "scenario_id": "shop-002-realistic-general",
      "scenario_selection_method": "default",
      "distractor_strategies": [],
      "distractor_count": 0,
      "theme_variety": false,
      "format_variety": false,
      "enhancement_level": "partial",
      "features_active": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "features_pending": [],
      "generation_time_ms": 41439
    }
  },
  "metadata": {
    "format": "DIRECT_CALCULATION",
    "cognitive_load": 40,
    "curriculum_alignment": [
      "4N1a"
    ],
    "difficulty": "4.1",
    "scenario_theme": "SHOPPING",
    "distractor_strategies": [],
    "generation_time_ms": 41439,
    "api_version": "2.0",
    "enhancement_status": "partial",
    "format_requested": "DIRECT_CALCULATION",
    "format_used": "DIRECT_CALCULATION",
    "features_active": [
      "enhanced_distractors",
      "rich_scenarios",
      "cognitive_load",
      "advanced_formats"
    ],
    "features_pending": []
  },
  "context": {
    "id": "shop-002-realistic-general",
    "theme": "SHOPPING",
    "setting": {
      "location": "local shop",
      "timeContext": "after school",
      "atmosphere": "friendly"
    },
    "characters": [
      {
        "name": "Charlotte",
        "role": "student"
      }
    ],
    "items": [
      {
        "name": "apple",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.2,
          "max": 0.5,
          "typical": 0.35,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "banana",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.15,
          "max": 0.4,
          "typical": 0.25,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "sandwich",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 2.5,
          "max": 6,
          "typical": 4,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "drink",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.8,
          "max": 2.5,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "cake",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 1.5,
          "max": 4,
          "typical": 2.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "biscuit",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.8,
          "max": 2,
          "typical": 1.2,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "sweet",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.1,
          "max": 1,
          "typical": 0.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "chocolate",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.6,
          "max": 3,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "pen",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.5,
          "max": 2,
          "typical": 1,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "pencil",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.2,
          "max": 1,
          "typical": 0.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "ruler",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.8,
          "max": 2.5,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "notebook",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 1,
          "max": 4,
          "typical": 2,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "eraser",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.3,
          "max": 1.5,
          "typical": 0.75,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "book",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 3,
          "max": 15,
          "typical": 8,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "comic",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 2,
          "max": 5,
          "typical": 3,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "magazine",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 2.5,
          "max": 6,
          "typical": 4,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "toy",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 5,
          "max": 25,
          "typical": 12,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "game",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 8,
          "max": 60,
          "typical": 25,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "puzzle",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 5,
          "max": 20,
          "typical": 12,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "sticker",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 0.2,
          "max": 2,
          "typical": 0.8,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "badge",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 0.5,
          "max": 3,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "poster",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 2,
          "max": 8,
          "typical": 4,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "card",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 0.5,
          "max": 4,
          "typical": 2,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      }
    ],
    "culturalElements": [
      {
        "type": "currency",
        "value": "£",
        "explanation": "British pounds"
      },
      {
        "type": "location",
        "value": "UK local shop",
        "explanation": "Typical British corner shop"
      }
    ],
    "realWorldConnection": "Everyday shopping with realistic UK prices",
    "yearAppropriate": [
      1,
      2,
      3,
      4,
      5,
      6
    ],
    "templates": [
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "MULTI_STEP"
        ],
        "modelCompatibility": [
          "ADDITION"
        ],
        "operandCount": 3,
        "template": "{character} buys a {item1} for {price1}, a {item2} for {price2}, and a {item3} for {price3}. What is the total cost?",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item1",
            "type": "item"
          },
          {
            "key": "item2",
            "type": "item"
          },
          {
            "key": "item3",
            "type": "item"
          },
          {
            "key": "price1",
            "type": "value"
          },
          {
            "key": "price2",
            "type": "value"
          },
          {
            "key": "price3",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "MULTI_STEP"
        ],
        "modelCompatibility": [
          "ADDITION"
        ],
        "operandCount": 2,
        "template": "{character} buys a {item1} for {price1} and a {item2} for {price2}. What is the total cost?",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item1",
            "type": "item"
          },
          {
            "key": "item2",
            "type": "item"
          },
          {
            "key": "price1",
            "type": "value"
          },
          {
            "key": "price2",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION"
        ],
        "modelCompatibility": [
          "SUBTRACTION",
          "CHANGE_CALCULATION"
        ],
        "template": "{character} buys a {item} for {price} and pays with {payment}. How much change does {character} get?",
        "answerTemplate": "{character} receives {result} in change",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "price",
            "type": "value"
          },
          {
            "key": "payment",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION"
        ],
        "modelCompatibility": [
          "MULTIPLICATION"
        ],
        "template": "{character} buys {quantity} {item} at {price} each. What is the total cost?",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "quantity",
            "type": "value"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "price",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION"
        ],
        "modelCompatibility": [
          "DIVISION"
        ],
        "template": "{character} has {total} to spend equally on {quantity} {item}. How much can {character} spend on each one?",
        "answerTemplate": "{character} can spend {result} on each {item}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "total",
            "type": "value"
          },
          {
            "key": "quantity",
            "type": "value"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "COMPARISON",
          "ESTIMATION",
          "MULTI_STEP"
        ],
        "template": "{character} goes to the shop and buys {items}. How much does {character} spend in total?",
        "answerTemplate": "{character} spends {result} in total",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "items",
            "type": "item_list"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "ESTIMATION"
        ],
        "template": "Estimate: If {character} buys {items}, about how much will it cost?",
        "answerTemplate": "It will cost approximately {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "items",
            "type": "item_list"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "VALIDATION"
        ],
        "template": "{character} calculated that {items} costs {amount}. Is this correct?",
        "answerTemplate": "{validation_result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "items",
            "type": "item_list"
          },
          {
            "key": "amount",
            "type": "value"
          },
          {
            "key": "validation_result",
            "type": "boolean"
          }
        ]
      }
    ]
  }
}
# Test B.17: MIXED_MONEY_UNITS model
{
  "success": true,
  "question": {
    "text": "Sarah wants to buy books at the book fair. Calculate the total cost.",
    "options": [
      {
        "value": 0,
        "text": "0p",
        "isCorrect": true
      }
    ],
    "correctIndex": 0,
    "format": "DIRECT_CALCULATION",
    "difficulty": {
      "year": 4,
      "subLevel": 1,
      "displayName": "4.1",
      "cognitiveLoad": 40
    },
    "cognitiveLoad": 40,
    "curriculumTags": [
      "4N1a"
    ],
    "scenario": {
      "id": "shop-001-bookfair",
      "theme": "SHOPPING",
      "setting": {
        "location": "school book fair",
        "timeContext": "lunch break",
        "atmosphere": "busy"
      },
      "characters": [
        {
          "name": "Sarah",
          "role": "student"
        },
        {
          "name": "Mr. Johnson",
          "role": "teacher"
        }
      ],
      "items": [
        {
          "name": "book",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 3,
            "max": 12,
            "typical": 6.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "bookmark",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.5,
            "max": 2,
            "typical": 1,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        }
      ],
      "culturalElements": [
        {
          "type": "currency",
          "value": "£",
          "explanation": "British pounds"
        },
        {
          "type": "event",
          "value": "book fair",
          "explanation": "School fundraising event"
        }
      ],
      "realWorldConnection": "School fundraising and reading promotion",
      "yearAppropriate": [
        2,
        3,
        4,
        5
      ],
      "templates": [
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "COMPARISON"
          ],
          "template": "{character} wants to buy books at the book fair. Calculate the total cost.",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        }
      ]
    },
    "distractors": [],
    "enhancementStatus": {
      "level": "partial",
      "requestedFormat": "DIRECT_CALCULATION",
      "actualFormat": "DIRECT_CALCULATION",
      "featuresActive": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "featuresPending": [],
      "isFullyEnhanced": true
    },
    "mathOutput": {
      "operation": "MIXED_MONEY_UNITS"
    },
    "generationTime": 1,
    "questionId": "q_1759077174770_ww8ht6044",
    "generationSetup": {
      "controller_used": "DIRECT_CALCULATIONController",
      "format_requested": "DIRECT_CALCULATION",
      "format_actual": "DIRECT_CALCULATION",
      "scenario_theme": "SHOPPING",
      "scenario_id": "shop-001-bookfair",
      "scenario_selection_method": "default",
      "distractor_strategies": [],
      "distractor_count": 0,
      "theme_variety": false,
      "format_variety": false,
      "enhancement_level": "partial",
      "features_active": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "features_pending": [],
      "generation_time_ms": 1
    }
  },
  "metadata": {
    "format": "DIRECT_CALCULATION",
    "cognitive_load": 40,
    "curriculum_alignment": [
      "4N1a"
    ],
    "difficulty": "4.1",
    "scenario_theme": "SHOPPING",
    "distractor_strategies": [],
    "generation_time_ms": 1,
    "api_version": "2.0",
    "enhancement_status": "partial",
    "format_requested": "DIRECT_CALCULATION",
    "format_used": "DIRECT_CALCULATION",
    "features_active": [
      "enhanced_distractors",
      "rich_scenarios",
      "cognitive_load",
      "advanced_formats"
    ],
    "features_pending": []
  },
  "context": {
    "id": "shop-001-bookfair",
    "theme": "SHOPPING",
    "setting": {
      "location": "school book fair",
      "timeContext": "lunch break",
      "atmosphere": "busy"
    },
    "characters": [
      {
        "name": "Sarah",
        "role": "student"
      },
      {
        "name": "Mr. Johnson",
        "role": "teacher"
      }
    ],
    "items": [
      {
        "name": "book",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 3,
          "max": 12,
          "typical": 6.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "bookmark",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.5,
          "max": 2,
          "typical": 1,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      }
    ],
    "culturalElements": [
      {
        "type": "currency",
        "value": "£",
        "explanation": "British pounds"
      },
      {
        "type": "event",
        "value": "book fair",
        "explanation": "School fundraising event"
      }
    ],
    "realWorldConnection": "School fundraising and reading promotion",
    "yearAppropriate": [
      2,
      3,
      4,
      5
    ],
    "templates": [
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "COMPARISON"
        ],
        "template": "{character} wants to buy books at the book fair. Calculate the total cost.",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      }
    ]
  }
}
# Test B.18: MONEY_FRACTIONS model
{
  "success": true,
  "question": {
    "text": "Sarah wants to buy books at the book fair. Calculate the total cost.",
    "options": [
      {
        "text": "£7.60",
        "value": 7.6,
        "index": 0
      },
      {
        "text": "6.6",
        "value": 6.6,
        "index": 1
      },
      {
        "text": "8.6",
        "value": 8.6,
        "index": 2
      }
    ],
    "correctIndex": 0,
    "format": "DIRECT_CALCULATION",
    "difficulty": {
      "year": 4,
      "subLevel": 1,
      "displayName": "4.1",
      "cognitiveLoad": 40
    },
    "cognitiveLoad": 40,
    "curriculumTags": [
      "4N1a"
    ],
    "scenario": {
      "id": "shop-001-bookfair",
      "theme": "SHOPPING",
      "setting": {
        "location": "school book fair",
        "timeContext": "lunch break",
        "atmosphere": "busy"
      },
      "characters": [
        {
          "name": "Sarah",
          "role": "student"
        },
        {
          "name": "Mr. Johnson",
          "role": "teacher"
        }
      ],
      "items": [
        {
          "name": "book",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 3,
            "max": 12,
            "typical": 6.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "bookmark",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.5,
            "max": 2,
            "typical": 1,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        }
      ],
      "culturalElements": [
        {
          "type": "currency",
          "value": "£",
          "explanation": "British pounds"
        },
        {
          "type": "event",
          "value": "book fair",
          "explanation": "School fundraising event"
        }
      ],
      "realWorldConnection": "School fundraising and reading promotion",
      "yearAppropriate": [
        2,
        3,
        4,
        5
      ],
      "templates": [
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "COMPARISON"
          ],
          "template": "{character} wants to buy books at the book fair. Calculate the total cost.",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        }
      ]
    },
    "distractors": [
      {
        "value": 8.6,
        "displayText": "8.6",
        "strategy": "CLOSE_VALUE",
        "reasoning": "Off by 1"
      },
      {
        "value": 6.6,
        "displayText": "6.6",
        "strategy": "CLOSE_VALUE",
        "reasoning": "Off by 1"
      }
    ],
    "enhancementStatus": {
      "level": "partial",
      "requestedFormat": "DIRECT_CALCULATION",
      "actualFormat": "DIRECT_CALCULATION",
      "featuresActive": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "featuresPending": [],
      "isFullyEnhanced": true
    },
    "mathOutput": {
      "operation": "MONEY_FRACTIONS",
      "result": 7.6
    },
    "generationTime": 0,
    "questionId": "q_1759077174814_dulg27lp1",
    "generationSetup": {
      "controller_used": "DIRECT_CALCULATIONController",
      "format_requested": "DIRECT_CALCULATION",
      "format_actual": "DIRECT_CALCULATION",
      "scenario_theme": "SHOPPING",
      "scenario_id": "shop-001-bookfair",
      "scenario_selection_method": "default",
      "distractor_strategies": [
        "CLOSE_VALUE",
        "CLOSE_VALUE"
      ],
      "distractor_count": 2,
      "theme_variety": false,
      "format_variety": false,
      "enhancement_level": "partial",
      "features_active": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "features_pending": [],
      "generation_time_ms": 0
    }
  },
  "metadata": {
    "format": "DIRECT_CALCULATION",
    "cognitive_load": 40,
    "curriculum_alignment": [
      "4N1a"
    ],
    "difficulty": "4.1",
    "scenario_theme": "SHOPPING",
    "distractor_strategies": [
      "CLOSE_VALUE",
      "CLOSE_VALUE"
    ],
    "generation_time_ms": 0,
    "api_version": "2.0",
    "enhancement_status": "partial",
    "format_requested": "DIRECT_CALCULATION",
    "format_used": "DIRECT_CALCULATION",
    "features_active": [
      "enhanced_distractors",
      "rich_scenarios",
      "cognitive_load",
      "advanced_formats"
    ],
    "features_pending": []
  },
  "context": {
    "id": "shop-001-bookfair",
    "theme": "SHOPPING",
    "setting": {
      "location": "school book fair",
      "timeContext": "lunch break",
      "atmosphere": "busy"
    },
    "characters": [
      {
        "name": "Sarah",
        "role": "student"
      },
      {
        "name": "Mr. Johnson",
        "role": "teacher"
      }
    ],
    "items": [
      {
        "name": "book",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 3,
          "max": 12,
          "typical": 6.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "bookmark",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.5,
          "max": 2,
          "typical": 1,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      }
    ],
    "culturalElements": [
      {
        "type": "currency",
        "value": "£",
        "explanation": "British pounds"
      },
      {
        "type": "event",
        "value": "book fair",
        "explanation": "School fundraising event"
      }
    ],
    "realWorldConnection": "School fundraising and reading promotion",
    "yearAppropriate": [
      2,
      3,
      4,
      5
    ],
    "templates": [
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "COMPARISON"
        ],
        "template": "{character} wants to buy books at the book fair. Calculate the total cost.",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      }
    ]
  }
}
# Test B.19: MONEY_SCALING model
{
  "success": true,
  "question": {
    "text": "Charlotte goes to the shop and buys apple, banana, sandwich, drink, cake, biscuit, sweet, chocolate, pen, pencil, ruler, notebook, eraser, book, comic, magazine, toy, game, puzzle, sticker, badge, poster, card. How much does Charlotte spend in total?",
    "options": [
      {
        "value": 0,
        "text": "0p",
        "isCorrect": true
      }
    ],
    "correctIndex": 0,
    "format": "DIRECT_CALCULATION",
    "difficulty": {
      "year": 4,
      "subLevel": 1,
      "displayName": "4.1",
      "cognitiveLoad": 40
    },
    "cognitiveLoad": 40,
    "curriculumTags": [
      "4N1a"
    ],
    "scenario": {
      "id": "shop-002-realistic-general",
      "theme": "SHOPPING",
      "setting": {
        "location": "local shop",
        "timeContext": "after school",
        "atmosphere": "friendly"
      },
      "characters": [
        {
          "name": "Charlotte",
          "role": "student"
        }
      ],
      "items": [
        {
          "name": "apple",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.2,
            "max": 0.5,
            "typical": 0.35,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "banana",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.15,
            "max": 0.4,
            "typical": 0.25,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "sandwich",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 2.5,
            "max": 6,
            "typical": 4,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "drink",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.8,
            "max": 2.5,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "cake",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 1.5,
            "max": 4,
            "typical": 2.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "biscuit",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.8,
            "max": 2,
            "typical": 1.2,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "sweet",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.1,
            "max": 1,
            "typical": 0.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "chocolate",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.6,
            "max": 3,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "pen",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.5,
            "max": 2,
            "typical": 1,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "pencil",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.2,
            "max": 1,
            "typical": 0.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "ruler",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.8,
            "max": 2.5,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "notebook",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 1,
            "max": 4,
            "typical": 2,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "eraser",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.3,
            "max": 1.5,
            "typical": 0.75,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "book",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 3,
            "max": 15,
            "typical": 8,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "comic",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 2,
            "max": 5,
            "typical": 3,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "magazine",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 2.5,
            "max": 6,
            "typical": 4,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "toy",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 5,
            "max": 25,
            "typical": 12,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "game",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 8,
            "max": 60,
            "typical": 25,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "puzzle",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 5,
            "max": 20,
            "typical": 12,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "sticker",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 0.2,
            "max": 2,
            "typical": 0.8,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "badge",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 0.5,
            "max": 3,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "poster",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 2,
            "max": 8,
            "typical": 4,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "card",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 0.5,
            "max": 4,
            "typical": 2,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        }
      ],
      "culturalElements": [
        {
          "type": "currency",
          "value": "£",
          "explanation": "British pounds"
        },
        {
          "type": "location",
          "value": "UK local shop",
          "explanation": "Typical British corner shop"
        }
      ],
      "realWorldConnection": "Everyday shopping with realistic UK prices",
      "yearAppropriate": [
        1,
        2,
        3,
        4,
        5,
        6
      ],
      "templates": [
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "MULTI_STEP"
          ],
          "modelCompatibility": [
            "ADDITION"
          ],
          "operandCount": 3,
          "template": "{character} buys a {item1} for {price1}, a {item2} for {price2}, and a {item3} for {price3}. What is the total cost?",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item1",
              "type": "item"
            },
            {
              "key": "item2",
              "type": "item"
            },
            {
              "key": "item3",
              "type": "item"
            },
            {
              "key": "price1",
              "type": "value"
            },
            {
              "key": "price2",
              "type": "value"
            },
            {
              "key": "price3",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "MULTI_STEP"
          ],
          "modelCompatibility": [
            "ADDITION"
          ],
          "operandCount": 2,
          "template": "{character} buys a {item1} for {price1} and a {item2} for {price2}. What is the total cost?",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item1",
              "type": "item"
            },
            {
              "key": "item2",
              "type": "item"
            },
            {
              "key": "price1",
              "type": "value"
            },
            {
              "key": "price2",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION"
          ],
          "modelCompatibility": [
            "SUBTRACTION",
            "CHANGE_CALCULATION"
          ],
          "template": "{character} buys a {item} for {price} and pays with {payment}. How much change does {character} get?",
          "answerTemplate": "{character} receives {result} in change",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "price",
              "type": "value"
            },
            {
              "key": "payment",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION"
          ],
          "modelCompatibility": [
            "MULTIPLICATION"
          ],
          "template": "{character} buys {quantity} {item} at {price} each. What is the total cost?",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "quantity",
              "type": "value"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "price",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION"
          ],
          "modelCompatibility": [
            "DIVISION"
          ],
          "template": "{character} has {total} to spend equally on {quantity} {item}. How much can {character} spend on each one?",
          "answerTemplate": "{character} can spend {result} on each {item}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "total",
              "type": "value"
            },
            {
              "key": "quantity",
              "type": "value"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "COMPARISON",
            "ESTIMATION",
            "MULTI_STEP"
          ],
          "template": "{character} goes to the shop and buys {items}. How much does {character} spend in total?",
          "answerTemplate": "{character} spends {result} in total",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "items",
              "type": "item_list"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "ESTIMATION"
          ],
          "template": "Estimate: If {character} buys {items}, about how much will it cost?",
          "answerTemplate": "It will cost approximately {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "items",
              "type": "item_list"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "VALIDATION"
          ],
          "template": "{character} calculated that {items} costs {amount}. Is this correct?",
          "answerTemplate": "{validation_result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "items",
              "type": "item_list"
            },
            {
              "key": "amount",
              "type": "value"
            },
            {
              "key": "validation_result",
              "type": "boolean"
            }
          ]
        }
      ]
    },
    "distractors": [],
    "enhancementStatus": {
      "level": "partial",
      "requestedFormat": "DIRECT_CALCULATION",
      "actualFormat": "DIRECT_CALCULATION",
      "featuresActive": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "featuresPending": [],
      "isFullyEnhanced": true
    },
    "mathOutput": {
      "operation": "MONEY_SCALING",
      "base_amount": 43,
      "scale_factor": 0.25
    },
    "generationTime": 1,
    "questionId": "q_1759077174858_k7ez0xs9b",
    "generationSetup": {
      "controller_used": "DIRECT_CALCULATIONController",
      "format_requested": "DIRECT_CALCULATION",
      "format_actual": "DIRECT_CALCULATION",
      "scenario_theme": "SHOPPING",
      "scenario_id": "shop-002-realistic-general",
      "scenario_selection_method": "default",
      "distractor_strategies": [],
      "distractor_count": 0,
      "theme_variety": false,
      "format_variety": false,
      "enhancement_level": "partial",
      "features_active": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "features_pending": [],
      "generation_time_ms": 1
    }
  },
  "metadata": {
    "format": "DIRECT_CALCULATION",
    "cognitive_load": 40,
    "curriculum_alignment": [
      "4N1a"
    ],
    "difficulty": "4.1",
    "scenario_theme": "SHOPPING",
    "distractor_strategies": [],
    "generation_time_ms": 1,
    "api_version": "2.0",
    "enhancement_status": "partial",
    "format_requested": "DIRECT_CALCULATION",
    "format_used": "DIRECT_CALCULATION",
    "features_active": [
      "enhanced_distractors",
      "rich_scenarios",
      "cognitive_load",
      "advanced_formats"
    ],
    "features_pending": []
  },
  "context": {
    "id": "shop-002-realistic-general",
    "theme": "SHOPPING",
    "setting": {
      "location": "local shop",
      "timeContext": "after school",
      "atmosphere": "friendly"
    },
    "characters": [
      {
        "name": "Charlotte",
        "role": "student"
      }
    ],
    "items": [
      {
        "name": "apple",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.2,
          "max": 0.5,
          "typical": 0.35,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "banana",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.15,
          "max": 0.4,
          "typical": 0.25,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "sandwich",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 2.5,
          "max": 6,
          "typical": 4,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "drink",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.8,
          "max": 2.5,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "cake",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 1.5,
          "max": 4,
          "typical": 2.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "biscuit",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.8,
          "max": 2,
          "typical": 1.2,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "sweet",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.1,
          "max": 1,
          "typical": 0.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "chocolate",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.6,
          "max": 3,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "pen",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.5,
          "max": 2,
          "typical": 1,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "pencil",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.2,
          "max": 1,
          "typical": 0.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "ruler",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.8,
          "max": 2.5,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "notebook",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 1,
          "max": 4,
          "typical": 2,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "eraser",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.3,
          "max": 1.5,
          "typical": 0.75,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "book",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 3,
          "max": 15,
          "typical": 8,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "comic",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 2,
          "max": 5,
          "typical": 3,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "magazine",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 2.5,
          "max": 6,
          "typical": 4,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "toy",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 5,
          "max": 25,
          "typical": 12,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "game",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 8,
          "max": 60,
          "typical": 25,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "puzzle",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 5,
          "max": 20,
          "typical": 12,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "sticker",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 0.2,
          "max": 2,
          "typical": 0.8,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "badge",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 0.5,
          "max": 3,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "poster",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 2,
          "max": 8,
          "typical": 4,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "card",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 0.5,
          "max": 4,
          "typical": 2,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      }
    ],
    "culturalElements": [
      {
        "type": "currency",
        "value": "£",
        "explanation": "British pounds"
      },
      {
        "type": "location",
        "value": "UK local shop",
        "explanation": "Typical British corner shop"
      }
    ],
    "realWorldConnection": "Everyday shopping with realistic UK prices",
    "yearAppropriate": [
      1,
      2,
      3,
      4,
      5,
      6
    ],
    "templates": [
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "MULTI_STEP"
        ],
        "modelCompatibility": [
          "ADDITION"
        ],
        "operandCount": 3,
        "template": "{character} buys a {item1} for {price1}, a {item2} for {price2}, and a {item3} for {price3}. What is the total cost?",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item1",
            "type": "item"
          },
          {
            "key": "item2",
            "type": "item"
          },
          {
            "key": "item3",
            "type": "item"
          },
          {
            "key": "price1",
            "type": "value"
          },
          {
            "key": "price2",
            "type": "value"
          },
          {
            "key": "price3",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "MULTI_STEP"
        ],
        "modelCompatibility": [
          "ADDITION"
        ],
        "operandCount": 2,
        "template": "{character} buys a {item1} for {price1} and a {item2} for {price2}. What is the total cost?",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item1",
            "type": "item"
          },
          {
            "key": "item2",
            "type": "item"
          },
          {
            "key": "price1",
            "type": "value"
          },
          {
            "key": "price2",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION"
        ],
        "modelCompatibility": [
          "SUBTRACTION",
          "CHANGE_CALCULATION"
        ],
        "template": "{character} buys a {item} for {price} and pays with {payment}. How much change does {character} get?",
        "answerTemplate": "{character} receives {result} in change",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "price",
            "type": "value"
          },
          {
            "key": "payment",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION"
        ],
        "modelCompatibility": [
          "MULTIPLICATION"
        ],
        "template": "{character} buys {quantity} {item} at {price} each. What is the total cost?",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "quantity",
            "type": "value"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "price",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION"
        ],
        "modelCompatibility": [
          "DIVISION"
        ],
        "template": "{character} has {total} to spend equally on {quantity} {item}. How much can {character} spend on each one?",
        "answerTemplate": "{character} can spend {result} on each {item}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "total",
            "type": "value"
          },
          {
            "key": "quantity",
            "type": "value"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "COMPARISON",
          "ESTIMATION",
          "MULTI_STEP"
        ],
        "template": "{character} goes to the shop and buys {items}. How much does {character} spend in total?",
        "answerTemplate": "{character} spends {result} in total",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "items",
            "type": "item_list"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "ESTIMATION"
        ],
        "template": "Estimate: If {character} buys {items}, about how much will it cost?",
        "answerTemplate": "It will cost approximately {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "items",
            "type": "item_list"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "VALIDATION"
        ],
        "template": "{character} calculated that {items} costs {amount}. Is this correct?",
        "answerTemplate": "{validation_result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "items",
            "type": "item_list"
          },
          {
            "key": "amount",
            "type": "value"
          },
          {
            "key": "validation_result",
            "type": "boolean"
          }
        ]
      }
    ]
  }
}
# Test B.20: SHAPE_RECOGNITION model
{
  "success": true,
  "question": {
    "text": "Henry buys a item for £5. How much does it cost?",
    "options": [
      {
        "value": 0,
        "text": "0p",
        "isCorrect": true
      }
    ],
    "correctIndex": 0,
    "format": "DIRECT_CALCULATION",
    "difficulty": {
      "year": 4,
      "subLevel": 1,
      "displayName": "4.1",
      "cognitiveLoad": 40
    },
    "cognitiveLoad": 40,
    "curriculumTags": [
      "4N1a"
    ],
    "scenario": {
      "id": "default-4-1759077174901",
      "theme": "SHOPPING",
      "setting": {
        "location": "shop",
        "timeContext": "afternoon",
        "atmosphere": "friendly"
      },
      "characters": [
        {
          "name": "Henry",
          "role": "student"
        }
      ],
      "items": [
        {
          "name": "item",
          "category": "HOUSEHOLD_ITEMS",
          "typicalValue": {
            "min": 1,
            "max": 10,
            "typical": 5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        }
      ],
      "culturalElements": [
        {
          "type": "currency",
          "value": "£",
          "explanation": "British pounds"
        }
      ],
      "realWorldConnection": "Basic shopping calculations",
      "yearAppropriate": [
        4
      ],
      "templates": [
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION"
          ],
          "template": "{character} buys a {item} for {price}. How much does it cost?",
          "answerTemplate": "It costs {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "price",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        }
      ]
    },
    "distractors": [],
    "enhancementStatus": {
      "level": "partial",
      "requestedFormat": "DIRECT_CALCULATION",
      "actualFormat": "DIRECT_CALCULATION",
      "featuresActive": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "featuresPending": [],
      "isFullyEnhanced": true
    },
    "mathOutput": {
      "operation": "SHAPE_RECOGNITION"
    },
    "generationTime": 1,
    "questionId": "q_1759077174901_mdw271168",
    "generationSetup": {
      "controller_used": "DIRECT_CALCULATIONController",
      "format_requested": "DIRECT_CALCULATION",
      "format_actual": "DIRECT_CALCULATION",
      "scenario_theme": "SHOPPING",
      "scenario_id": "default-4-1759077174901",
      "scenario_selection_method": "default",
      "distractor_strategies": [],
      "distractor_count": 0,
      "theme_variety": false,
      "format_variety": false,
      "enhancement_level": "partial",
      "features_active": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "features_pending": [],
      "generation_time_ms": 1
    }
  },
  "metadata": {
    "format": "DIRECT_CALCULATION",
    "cognitive_load": 40,
    "curriculum_alignment": [
      "4N1a"
    ],
    "difficulty": "4.1",
    "scenario_theme": "SHOPPING",
    "distractor_strategies": [],
    "generation_time_ms": 1,
    "api_version": "2.0",
    "enhancement_status": "partial",
    "format_requested": "DIRECT_CALCULATION",
    "format_used": "DIRECT_CALCULATION",
    "features_active": [
      "enhanced_distractors",
      "rich_scenarios",
      "cognitive_load",
      "advanced_formats"
    ],
    "features_pending": []
  },
  "context": {
    "id": "default-4-1759077174901",
    "theme": "SHOPPING",
    "setting": {
      "location": "shop",
      "timeContext": "afternoon",
      "atmosphere": "friendly"
    },
    "characters": [
      {
        "name": "Henry",
        "role": "student"
      }
    ],
    "items": [
      {
        "name": "item",
        "category": "HOUSEHOLD_ITEMS",
        "typicalValue": {
          "min": 1,
          "max": 10,
          "typical": 5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      }
    ],
    "culturalElements": [
      {
        "type": "currency",
        "value": "£",
        "explanation": "British pounds"
      }
    ],
    "realWorldConnection": "Basic shopping calculations",
    "yearAppropriate": [
      4
    ],
    "templates": [
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION"
        ],
        "template": "{character} buys a {item} for {price}. How much does it cost?",
        "answerTemplate": "It costs {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "price",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      }
    ]
  }
}
# Test B.21: SHAPE_PROPERTIES model
{
  "success": true,
  "question": {
    "text": "Evelyn buys a item for £5. How much does it cost?",
    "options": [
      {
        "value": 0,
        "text": "0p",
        "isCorrect": true
      }
    ],
    "correctIndex": 0,
    "format": "DIRECT_CALCULATION",
    "difficulty": {
      "year": 4,
      "subLevel": 1,
      "displayName": "4.1",
      "cognitiveLoad": 40
    },
    "cognitiveLoad": 40,
    "curriculumTags": [
      "4N1a"
    ],
    "scenario": {
      "id": "default-4-1759077174948",
      "theme": "SHOPPING",
      "setting": {
        "location": "shop",
        "timeContext": "afternoon",
        "atmosphere": "friendly"
      },
      "characters": [
        {
          "name": "Evelyn",
          "role": "student"
        }
      ],
      "items": [
        {
          "name": "item",
          "category": "HOUSEHOLD_ITEMS",
          "typicalValue": {
            "min": 1,
            "max": 10,
            "typical": 5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        }
      ],
      "culturalElements": [
        {
          "type": "currency",
          "value": "£",
          "explanation": "British pounds"
        }
      ],
      "realWorldConnection": "Basic shopping calculations",
      "yearAppropriate": [
        4
      ],
      "templates": [
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION"
          ],
          "template": "{character} buys a {item} for {price}. How much does it cost?",
          "answerTemplate": "It costs {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "price",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        }
      ]
    },
    "distractors": [],
    "enhancementStatus": {
      "level": "partial",
      "requestedFormat": "DIRECT_CALCULATION",
      "actualFormat": "DIRECT_CALCULATION",
      "featuresActive": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "featuresPending": [],
      "isFullyEnhanced": true
    },
    "mathOutput": {
      "operation": "SHAPE_PROPERTIES"
    },
    "generationTime": 0,
    "questionId": "q_1759077174948_w1li0is6t",
    "generationSetup": {
      "controller_used": "DIRECT_CALCULATIONController",
      "format_requested": "DIRECT_CALCULATION",
      "format_actual": "DIRECT_CALCULATION",
      "scenario_theme": "SHOPPING",
      "scenario_id": "default-4-1759077174948",
      "scenario_selection_method": "default",
      "distractor_strategies": [],
      "distractor_count": 0,
      "theme_variety": false,
      "format_variety": false,
      "enhancement_level": "partial",
      "features_active": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "features_pending": [],
      "generation_time_ms": 0
    }
  },
  "metadata": {
    "format": "DIRECT_CALCULATION",
    "cognitive_load": 40,
    "curriculum_alignment": [
      "4N1a"
    ],
    "difficulty": "4.1",
    "scenario_theme": "SHOPPING",
    "distractor_strategies": [],
    "generation_time_ms": 0,
    "api_version": "2.0",
    "enhancement_status": "partial",
    "format_requested": "DIRECT_CALCULATION",
    "format_used": "DIRECT_CALCULATION",
    "features_active": [
      "enhanced_distractors",
      "rich_scenarios",
      "cognitive_load",
      "advanced_formats"
    ],
    "features_pending": []
  },
  "context": {
    "id": "default-4-1759077174948",
    "theme": "SHOPPING",
    "setting": {
      "location": "shop",
      "timeContext": "afternoon",
      "atmosphere": "friendly"
    },
    "characters": [
      {
        "name": "Evelyn",
        "role": "student"
      }
    ],
    "items": [
      {
        "name": "item",
        "category": "HOUSEHOLD_ITEMS",
        "typicalValue": {
          "min": 1,
          "max": 10,
          "typical": 5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      }
    ],
    "culturalElements": [
      {
        "type": "currency",
        "value": "£",
        "explanation": "British pounds"
      }
    ],
    "realWorldConnection": "Basic shopping calculations",
    "yearAppropriate": [
      4
    ],
    "templates": [
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION"
        ],
        "template": "{character} buys a {item} for {price}. How much does it cost?",
        "answerTemplate": "It costs {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "price",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      }
    ]
  }
}
# Test B.22: ANGLE_MEASUREMENT model
{
  "success": true,
  "question": {
    "text": "Sofia buys a item for £5. How much does it cost?",
    "options": [
      {
        "value": 0,
        "text": "0p",
        "isCorrect": true
      }
    ],
    "correctIndex": 0,
    "format": "DIRECT_CALCULATION",
    "difficulty": {
      "year": 4,
      "subLevel": 1,
      "displayName": "4.1",
      "cognitiveLoad": 40
    },
    "cognitiveLoad": 40,
    "curriculumTags": [
      "4N1a"
    ],
    "scenario": {
      "id": "default-4-1759077174992",
      "theme": "SHOPPING",
      "setting": {
        "location": "shop",
        "timeContext": "afternoon",
        "atmosphere": "friendly"
      },
      "characters": [
        {
          "name": "Sofia",
          "role": "student"
        }
      ],
      "items": [
        {
          "name": "item",
          "category": "HOUSEHOLD_ITEMS",
          "typicalValue": {
            "min": 1,
            "max": 10,
            "typical": 5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        }
      ],
      "culturalElements": [
        {
          "type": "currency",
          "value": "£",
          "explanation": "British pounds"
        }
      ],
      "realWorldConnection": "Basic shopping calculations",
      "yearAppropriate": [
        4
      ],
      "templates": [
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION"
          ],
          "template": "{character} buys a {item} for {price}. How much does it cost?",
          "answerTemplate": "It costs {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "price",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        }
      ]
    },
    "distractors": [],
    "enhancementStatus": {
      "level": "partial",
      "requestedFormat": "DIRECT_CALCULATION",
      "actualFormat": "DIRECT_CALCULATION",
      "featuresActive": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "featuresPending": [],
      "isFullyEnhanced": true
    },
    "mathOutput": {
      "operation": "ANGLE_MEASUREMENT",
      "angle_degrees": 120,
      "angle_type": "obtuse"
    },
    "generationTime": 1,
    "questionId": "q_1759077174993_598eqdh1d",
    "generationSetup": {
      "controller_used": "DIRECT_CALCULATIONController",
      "format_requested": "DIRECT_CALCULATION",
      "format_actual": "DIRECT_CALCULATION",
      "scenario_theme": "SHOPPING",
      "scenario_id": "default-4-1759077174992",
      "scenario_selection_method": "default",
      "distractor_strategies": [],
      "distractor_count": 0,
      "theme_variety": false,
      "format_variety": false,
      "enhancement_level": "partial",
      "features_active": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "features_pending": [],
      "generation_time_ms": 1
    }
  },
  "metadata": {
    "format": "DIRECT_CALCULATION",
    "cognitive_load": 40,
    "curriculum_alignment": [
      "4N1a"
    ],
    "difficulty": "4.1",
    "scenario_theme": "SHOPPING",
    "distractor_strategies": [],
    "generation_time_ms": 1,
    "api_version": "2.0",
    "enhancement_status": "partial",
    "format_requested": "DIRECT_CALCULATION",
    "format_used": "DIRECT_CALCULATION",
    "features_active": [
      "enhanced_distractors",
      "rich_scenarios",
      "cognitive_load",
      "advanced_formats"
    ],
    "features_pending": []
  },
  "context": {
    "id": "default-4-1759077174992",
    "theme": "SHOPPING",
    "setting": {
      "location": "shop",
      "timeContext": "afternoon",
      "atmosphere": "friendly"
    },
    "characters": [
      {
        "name": "Sofia",
        "role": "student"
      }
    ],
    "items": [
      {
        "name": "item",
        "category": "HOUSEHOLD_ITEMS",
        "typicalValue": {
          "min": 1,
          "max": 10,
          "typical": 5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      }
    ],
    "culturalElements": [
      {
        "type": "currency",
        "value": "£",
        "explanation": "British pounds"
      }
    ],
    "realWorldConnection": "Basic shopping calculations",
    "yearAppropriate": [
      4
    ],
    "templates": [
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION"
        ],
        "template": "{character} buys a {item} for {price}. How much does it cost?",
        "answerTemplate": "It costs {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "price",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      }
    ]
  }
}
# Test B.23: POSITION_DIRECTION model
{
  "success": true,
  "question": {
    "text": "Abigail buys a item for £5. How much does it cost?",
    "options": [
      {
        "value": 0,
        "text": "0p",
        "isCorrect": true
      }
    ],
    "correctIndex": 0,
    "format": "DIRECT_CALCULATION",
    "difficulty": {
      "year": 4,
      "subLevel": 1,
      "displayName": "4.1",
      "cognitiveLoad": 40
    },
    "cognitiveLoad": 40,
    "curriculumTags": [
      "4N1a"
    ],
    "scenario": {
      "id": "default-4-1759077175039",
      "theme": "SHOPPING",
      "setting": {
        "location": "shop",
        "timeContext": "afternoon",
        "atmosphere": "friendly"
      },
      "characters": [
        {
          "name": "Abigail",
          "role": "student"
        }
      ],
      "items": [
        {
          "name": "item",
          "category": "HOUSEHOLD_ITEMS",
          "typicalValue": {
            "min": 1,
            "max": 10,
            "typical": 5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        }
      ],
      "culturalElements": [
        {
          "type": "currency",
          "value": "£",
          "explanation": "British pounds"
        }
      ],
      "realWorldConnection": "Basic shopping calculations",
      "yearAppropriate": [
        4
      ],
      "templates": [
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION"
          ],
          "template": "{character} buys a {item} for {price}. How much does it cost?",
          "answerTemplate": "It costs {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "price",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        }
      ]
    },
    "distractors": [],
    "enhancementStatus": {
      "level": "partial",
      "requestedFormat": "DIRECT_CALCULATION",
      "actualFormat": "DIRECT_CALCULATION",
      "featuresActive": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "featuresPending": [],
      "isFullyEnhanced": true
    },
    "mathOutput": {
      "operation": "POSITION_DIRECTION"
    },
    "generationTime": 1,
    "questionId": "q_1759077175039_ps7vbe7a9",
    "generationSetup": {
      "controller_used": "DIRECT_CALCULATIONController",
      "format_requested": "DIRECT_CALCULATION",
      "format_actual": "DIRECT_CALCULATION",
      "scenario_theme": "SHOPPING",
      "scenario_id": "default-4-1759077175039",
      "scenario_selection_method": "default",
      "distractor_strategies": [],
      "distractor_count": 0,
      "theme_variety": false,
      "format_variety": false,
      "enhancement_level": "partial",
      "features_active": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "features_pending": [],
      "generation_time_ms": 1
    }
  },
  "metadata": {
    "format": "DIRECT_CALCULATION",
    "cognitive_load": 40,
    "curriculum_alignment": [
      "4N1a"
    ],
    "difficulty": "4.1",
    "scenario_theme": "SHOPPING",
    "distractor_strategies": [],
    "generation_time_ms": 1,
    "api_version": "2.0",
    "enhancement_status": "partial",
    "format_requested": "DIRECT_CALCULATION",
    "format_used": "DIRECT_CALCULATION",
    "features_active": [
      "enhanced_distractors",
      "rich_scenarios",
      "cognitive_load",
      "advanced_formats"
    ],
    "features_pending": []
  },
  "context": {
    "id": "default-4-1759077175039",
    "theme": "SHOPPING",
    "setting": {
      "location": "shop",
      "timeContext": "afternoon",
      "atmosphere": "friendly"
    },
    "characters": [
      {
        "name": "Abigail",
        "role": "student"
      }
    ],
    "items": [
      {
        "name": "item",
        "category": "HOUSEHOLD_ITEMS",
        "typicalValue": {
          "min": 1,
          "max": 10,
          "typical": 5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      }
    ],
    "culturalElements": [
      {
        "type": "currency",
        "value": "£",
        "explanation": "British pounds"
      }
    ],
    "realWorldConnection": "Basic shopping calculations",
    "yearAppropriate": [
      4
    ],
    "templates": [
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION"
        ],
        "template": "{character} buys a {item} for {price}. How much does it cost?",
        "answerTemplate": "It costs {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "price",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      }
    ]
  }
}
# Test B.24: AREA_PERIMETER model
{
  "success": true,
  "question": {
    "text": "Amelia buys a item for £5. How much does it cost?",
    "options": [
      {
        "value": 0,
        "text": "0p",
        "isCorrect": true
      }
    ],
    "correctIndex": 0,
    "format": "DIRECT_CALCULATION",
    "difficulty": {
      "year": 4,
      "subLevel": 1,
      "displayName": "4.1",
      "cognitiveLoad": 40
    },
    "cognitiveLoad": 40,
    "curriculumTags": [
      "4N1a"
    ],
    "scenario": {
      "id": "default-4-1759077175085",
      "theme": "SHOPPING",
      "setting": {
        "location": "shop",
        "timeContext": "afternoon",
        "atmosphere": "friendly"
      },
      "characters": [
        {
          "name": "Amelia",
          "role": "student"
        }
      ],
      "items": [
        {
          "name": "item",
          "category": "HOUSEHOLD_ITEMS",
          "typicalValue": {
            "min": 1,
            "max": 10,
            "typical": 5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        }
      ],
      "culturalElements": [
        {
          "type": "currency",
          "value": "£",
          "explanation": "British pounds"
        }
      ],
      "realWorldConnection": "Basic shopping calculations",
      "yearAppropriate": [
        4
      ],
      "templates": [
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION"
          ],
          "template": "{character} buys a {item} for {price}. How much does it cost?",
          "answerTemplate": "It costs {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "price",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        }
      ]
    },
    "distractors": [],
    "enhancementStatus": {
      "level": "partial",
      "requestedFormat": "DIRECT_CALCULATION",
      "actualFormat": "DIRECT_CALCULATION",
      "featuresActive": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "featuresPending": [],
      "isFullyEnhanced": true
    },
    "mathOutput": {
      "operation": "AREA_PERIMETER"
    },
    "generationTime": 1,
    "questionId": "q_1759077175085_t1vcnwqi2",
    "generationSetup": {
      "controller_used": "DIRECT_CALCULATIONController",
      "format_requested": "DIRECT_CALCULATION",
      "format_actual": "DIRECT_CALCULATION",
      "scenario_theme": "SHOPPING",
      "scenario_id": "default-4-1759077175085",
      "scenario_selection_method": "default",
      "distractor_strategies": [],
      "distractor_count": 0,
      "theme_variety": false,
      "format_variety": false,
      "enhancement_level": "partial",
      "features_active": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "features_pending": [],
      "generation_time_ms": 1
    }
  },
  "metadata": {
    "format": "DIRECT_CALCULATION",
    "cognitive_load": 40,
    "curriculum_alignment": [
      "4N1a"
    ],
    "difficulty": "4.1",
    "scenario_theme": "SHOPPING",
    "distractor_strategies": [],
    "generation_time_ms": 1,
    "api_version": "2.0",
    "enhancement_status": "partial",
    "format_requested": "DIRECT_CALCULATION",
    "format_used": "DIRECT_CALCULATION",
    "features_active": [
      "enhanced_distractors",
      "rich_scenarios",
      "cognitive_load",
      "advanced_formats"
    ],
    "features_pending": []
  },
  "context": {
    "id": "default-4-1759077175085",
    "theme": "SHOPPING",
    "setting": {
      "location": "shop",
      "timeContext": "afternoon",
      "atmosphere": "friendly"
    },
    "characters": [
      {
        "name": "Amelia",
        "role": "student"
      }
    ],
    "items": [
      {
        "name": "item",
        "category": "HOUSEHOLD_ITEMS",
        "typicalValue": {
          "min": 1,
          "max": 10,
          "typical": 5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      }
    ],
    "culturalElements": [
      {
        "type": "currency",
        "value": "£",
        "explanation": "British pounds"
      }
    ],
    "realWorldConnection": "Basic shopping calculations",
    "yearAppropriate": [
      4
    ],
    "templates": [
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION"
        ],
        "template": "{character} buys a {item} for {price}. How much does it cost?",
        "answerTemplate": "It costs {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "price",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      }
    ]
  }
}

--- SUITE C: FORMAT COVERAGE TESTS ---
Testing every question format using the ADDITION model...
# Test C.1: DIRECT_CALCULATION format
{
  "success": true,
  "question": {
    "text": "Charlotte goes to the shop and buys apple, banana, sandwich, drink, cake, biscuit, sweet, chocolate, pen, pencil, ruler, notebook, eraser, book, comic, magazine, toy, game, puzzle, sticker, badge, poster, card. How much does Charlotte spend in total?",
    "options": [
      {
        "text": "£2321.00",
        "value": 2321,
        "index": 0
      },
      {
        "text": "155156",
        "value": 155156,
        "index": 1
      },
      {
        "text": "3321",
        "value": 3321,
        "index": 2
      },
      {
        "text": "824",
        "value": 824,
        "index": 3
      }
    ],
    "correctIndex": 0,
    "format": "DIRECT_CALCULATION",
    "difficulty": {
      "year": 5,
      "subLevel": 3,
      "displayName": "5.3",
      "cognitiveLoad": 60
    },
    "cognitiveLoad": 60,
    "curriculumTags": [
      "5N1a",
      "5N1b"
    ],
    "scenario": {
      "id": "shop-002-realistic-general",
      "theme": "SHOPPING",
      "setting": {
        "location": "local shop",
        "timeContext": "after school",
        "atmosphere": "friendly"
      },
      "characters": [
        {
          "name": "Charlotte",
          "role": "student"
        }
      ],
      "items": [
        {
          "name": "apple",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.2,
            "max": 0.5,
            "typical": 0.35,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "banana",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.15,
            "max": 0.4,
            "typical": 0.25,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "sandwich",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 2.5,
            "max": 6,
            "typical": 4,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "drink",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.8,
            "max": 2.5,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "cake",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 1.5,
            "max": 4,
            "typical": 2.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "biscuit",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.8,
            "max": 2,
            "typical": 1.2,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "sweet",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.1,
            "max": 1,
            "typical": 0.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "chocolate",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.6,
            "max": 3,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "pen",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.5,
            "max": 2,
            "typical": 1,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "pencil",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.2,
            "max": 1,
            "typical": 0.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "ruler",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.8,
            "max": 2.5,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "notebook",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 1,
            "max": 4,
            "typical": 2,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "eraser",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.3,
            "max": 1.5,
            "typical": 0.75,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "book",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 3,
            "max": 15,
            "typical": 8,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "comic",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 2,
            "max": 5,
            "typical": 3,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "magazine",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 2.5,
            "max": 6,
            "typical": 4,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "toy",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 5,
            "max": 25,
            "typical": 12,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "game",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 8,
            "max": 60,
            "typical": 25,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "puzzle",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 5,
            "max": 20,
            "typical": 12,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "sticker",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 0.2,
            "max": 2,
            "typical": 0.8,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "badge",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 0.5,
            "max": 3,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "poster",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 2,
            "max": 8,
            "typical": 4,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "card",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 0.5,
            "max": 4,
            "typical": 2,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        }
      ],
      "culturalElements": [
        {
          "type": "currency",
          "value": "£",
          "explanation": "British pounds"
        },
        {
          "type": "location",
          "value": "UK local shop",
          "explanation": "Typical British corner shop"
        }
      ],
      "realWorldConnection": "Everyday shopping with realistic UK prices",
      "yearAppropriate": [
        1,
        2,
        3,
        4,
        5,
        6
      ],
      "templates": [
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "MULTI_STEP"
          ],
          "modelCompatibility": [
            "ADDITION"
          ],
          "operandCount": 3,
          "template": "{character} buys a {item1} for {price1}, a {item2} for {price2}, and a {item3} for {price3}. What is the total cost?",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item1",
              "type": "item"
            },
            {
              "key": "item2",
              "type": "item"
            },
            {
              "key": "item3",
              "type": "item"
            },
            {
              "key": "price1",
              "type": "value"
            },
            {
              "key": "price2",
              "type": "value"
            },
            {
              "key": "price3",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "MULTI_STEP"
          ],
          "modelCompatibility": [
            "ADDITION"
          ],
          "operandCount": 2,
          "template": "{character} buys a {item1} for {price1} and a {item2} for {price2}. What is the total cost?",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item1",
              "type": "item"
            },
            {
              "key": "item2",
              "type": "item"
            },
            {
              "key": "price1",
              "type": "value"
            },
            {
              "key": "price2",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION"
          ],
          "modelCompatibility": [
            "SUBTRACTION",
            "CHANGE_CALCULATION"
          ],
          "template": "{character} buys a {item} for {price} and pays with {payment}. How much change does {character} get?",
          "answerTemplate": "{character} receives {result} in change",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "price",
              "type": "value"
            },
            {
              "key": "payment",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION"
          ],
          "modelCompatibility": [
            "MULTIPLICATION"
          ],
          "template": "{character} buys {quantity} {item} at {price} each. What is the total cost?",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "quantity",
              "type": "value"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "price",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION"
          ],
          "modelCompatibility": [
            "DIVISION"
          ],
          "template": "{character} has {total} to spend equally on {quantity} {item}. How much can {character} spend on each one?",
          "answerTemplate": "{character} can spend {result} on each {item}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "total",
              "type": "value"
            },
            {
              "key": "quantity",
              "type": "value"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "COMPARISON",
            "ESTIMATION",
            "MULTI_STEP"
          ],
          "template": "{character} goes to the shop and buys {items}. How much does {character} spend in total?",
          "answerTemplate": "{character} spends {result} in total",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "items",
              "type": "item_list"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "ESTIMATION"
          ],
          "template": "Estimate: If {character} buys {items}, about how much will it cost?",
          "answerTemplate": "It will cost approximately {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "items",
              "type": "item_list"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "VALIDATION"
          ],
          "template": "{character} calculated that {items} costs {amount}. Is this correct?",
          "answerTemplate": "{validation_result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "items",
              "type": "item_list"
            },
            {
              "key": "amount",
              "type": "value"
            },
            {
              "key": "validation_result",
              "type": "boolean"
            }
          ]
        }
      ]
    },
    "distractors": [
      {
        "value": 824,
        "displayText": "824",
        "strategy": "WRONG_OPERATION",
        "reasoning": "Subtracted instead of adding"
      },
      {
        "value": 155156,
        "displayText": "155156",
        "strategy": "WRONG_OPERATION",
        "reasoning": "Multiplied instead of adding"
      },
      {
        "value": 3321,
        "displayText": "3321",
        "strategy": "PLACE_VALUE_ERROR",
        "reasoning": "Error in carrying to next column"
      }
    ],
    "enhancementStatus": {
      "level": "partial",
      "requestedFormat": "DIRECT_CALCULATION",
      "actualFormat": "DIRECT_CALCULATION",
      "featuresActive": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "featuresPending": [],
      "isFullyEnhanced": true
    },
    "mathOutput": {
      "operation": "ADDITION",
      "operand_1": 982,
      "operand_2": 158,
      "operand_3": 339,
      "operand_4": 842,
      "result": 2321
    },
    "generationTime": 0,
    "questionId": "q_1759077175132_4wrlc5f4k",
    "generationSetup": {
      "controller_used": "DIRECT_CALCULATIONController",
      "format_requested": "DIRECT_CALCULATION",
      "format_actual": "DIRECT_CALCULATION",
      "scenario_theme": "SHOPPING",
      "scenario_id": "shop-002-realistic-general",
      "scenario_selection_method": "default",
      "distractor_strategies": [
        "WRONG_OPERATION",
        "WRONG_OPERATION",
        "PLACE_VALUE_ERROR"
      ],
      "distractor_count": 3,
      "theme_variety": false,
      "format_variety": false,
      "enhancement_level": "partial",
      "features_active": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "features_pending": [],
      "generation_time_ms": 0
    }
  },
  "metadata": {
    "format": "DIRECT_CALCULATION",
    "cognitive_load": 60,
    "curriculum_alignment": [
      "5N1a",
      "5N1b"
    ],
    "difficulty": "5.3",
    "scenario_theme": "SHOPPING",
    "distractor_strategies": [
      "WRONG_OPERATION",
      "WRONG_OPERATION",
      "PLACE_VALUE_ERROR"
    ],
    "generation_time_ms": 0,
    "api_version": "2.0",
    "enhancement_status": "partial",
    "format_requested": "DIRECT_CALCULATION",
    "format_used": "DIRECT_CALCULATION",
    "features_active": [
      "enhanced_distractors",
      "rich_scenarios",
      "cognitive_load",
      "advanced_formats"
    ],
    "features_pending": []
  },
  "context": {
    "id": "shop-002-realistic-general",
    "theme": "SHOPPING",
    "setting": {
      "location": "local shop",
      "timeContext": "after school",
      "atmosphere": "friendly"
    },
    "characters": [
      {
        "name": "Charlotte",
        "role": "student"
      }
    ],
    "items": [
      {
        "name": "apple",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.2,
          "max": 0.5,
          "typical": 0.35,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "banana",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.15,
          "max": 0.4,
          "typical": 0.25,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "sandwich",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 2.5,
          "max": 6,
          "typical": 4,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "drink",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.8,
          "max": 2.5,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "cake",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 1.5,
          "max": 4,
          "typical": 2.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "biscuit",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.8,
          "max": 2,
          "typical": 1.2,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "sweet",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.1,
          "max": 1,
          "typical": 0.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "chocolate",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.6,
          "max": 3,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "pen",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.5,
          "max": 2,
          "typical": 1,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "pencil",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.2,
          "max": 1,
          "typical": 0.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "ruler",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.8,
          "max": 2.5,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "notebook",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 1,
          "max": 4,
          "typical": 2,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "eraser",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.3,
          "max": 1.5,
          "typical": 0.75,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "book",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 3,
          "max": 15,
          "typical": 8,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "comic",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 2,
          "max": 5,
          "typical": 3,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "magazine",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 2.5,
          "max": 6,
          "typical": 4,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "toy",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 5,
          "max": 25,
          "typical": 12,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "game",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 8,
          "max": 60,
          "typical": 25,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "puzzle",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 5,
          "max": 20,
          "typical": 12,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "sticker",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 0.2,
          "max": 2,
          "typical": 0.8,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "badge",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 0.5,
          "max": 3,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "poster",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 2,
          "max": 8,
          "typical": 4,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "card",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 0.5,
          "max": 4,
          "typical": 2,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      }
    ],
    "culturalElements": [
      {
        "type": "currency",
        "value": "£",
        "explanation": "British pounds"
      },
      {
        "type": "location",
        "value": "UK local shop",
        "explanation": "Typical British corner shop"
      }
    ],
    "realWorldConnection": "Everyday shopping with realistic UK prices",
    "yearAppropriate": [
      1,
      2,
      3,
      4,
      5,
      6
    ],
    "templates": [
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "MULTI_STEP"
        ],
        "modelCompatibility": [
          "ADDITION"
        ],
        "operandCount": 3,
        "template": "{character} buys a {item1} for {price1}, a {item2} for {price2}, and a {item3} for {price3}. What is the total cost?",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item1",
            "type": "item"
          },
          {
            "key": "item2",
            "type": "item"
          },
          {
            "key": "item3",
            "type": "item"
          },
          {
            "key": "price1",
            "type": "value"
          },
          {
            "key": "price2",
            "type": "value"
          },
          {
            "key": "price3",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "MULTI_STEP"
        ],
        "modelCompatibility": [
          "ADDITION"
        ],
        "operandCount": 2,
        "template": "{character} buys a {item1} for {price1} and a {item2} for {price2}. What is the total cost?",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item1",
            "type": "item"
          },
          {
            "key": "item2",
            "type": "item"
          },
          {
            "key": "price1",
            "type": "value"
          },
          {
            "key": "price2",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION"
        ],
        "modelCompatibility": [
          "SUBTRACTION",
          "CHANGE_CALCULATION"
        ],
        "template": "{character} buys a {item} for {price} and pays with {payment}. How much change does {character} get?",
        "answerTemplate": "{character} receives {result} in change",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "price",
            "type": "value"
          },
          {
            "key": "payment",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION"
        ],
        "modelCompatibility": [
          "MULTIPLICATION"
        ],
        "template": "{character} buys {quantity} {item} at {price} each. What is the total cost?",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "quantity",
            "type": "value"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "price",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION"
        ],
        "modelCompatibility": [
          "DIVISION"
        ],
        "template": "{character} has {total} to spend equally on {quantity} {item}. How much can {character} spend on each one?",
        "answerTemplate": "{character} can spend {result} on each {item}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "total",
            "type": "value"
          },
          {
            "key": "quantity",
            "type": "value"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "COMPARISON",
          "ESTIMATION",
          "MULTI_STEP"
        ],
        "template": "{character} goes to the shop and buys {items}. How much does {character} spend in total?",
        "answerTemplate": "{character} spends {result} in total",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "items",
            "type": "item_list"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "ESTIMATION"
        ],
        "template": "Estimate: If {character} buys {items}, about how much will it cost?",
        "answerTemplate": "It will cost approximately {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "items",
            "type": "item_list"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "VALIDATION"
        ],
        "template": "{character} calculated that {items} costs {amount}. Is this correct?",
        "answerTemplate": "{validation_result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "items",
            "type": "item_list"
          },
          {
            "key": "amount",
            "type": "value"
          },
          {
            "key": "validation_result",
            "type": "boolean"
          }
        ]
      }
    ]
  }
}
# Test C.2: COMPARISON format
{
  "success": true,
  "question": {
    "text": "Sarah wants to buy books at the book fair. Calculate the total cost.",
    "options": [
      {
        "text": "Option A saves you £2908.00",
        "value": 0,
        "index": 0
      },
      {
        "text": "Option A is better value",
        "value": 0,
        "index": 1
      },
      {
        "text": "Option B is better value",
        "value": 1,
        "index": 2
      },
      {
        "text": "Both options are equally good value",
        "value": -1,
        "index": 3
      }
    ],
    "correctIndex": 0,
    "format": "COMPARISON",
    "difficulty": {
      "year": 5,
      "subLevel": 3,
      "displayName": "5.3",
      "cognitiveLoad": 60
    },
    "cognitiveLoad": 60,
    "curriculumTags": [
      "5N1a",
      "5N1b"
    ],
    "scenario": {
      "id": "shop-001-bookfair",
      "theme": "SHOPPING",
      "setting": {
        "location": "school book fair",
        "timeContext": "lunch break",
        "atmosphere": "busy"
      },
      "characters": [
        {
          "name": "Sarah",
          "role": "student"
        },
        {
          "name": "Mr. Johnson",
          "role": "teacher"
        }
      ],
      "items": [
        {
          "name": "book",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 3,
            "max": 12,
            "typical": 6.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "bookmark",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.5,
            "max": 2,
            "typical": 1,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        }
      ],
      "culturalElements": [
        {
          "type": "currency",
          "value": "£",
          "explanation": "British pounds"
        },
        {
          "type": "event",
          "value": "book fair",
          "explanation": "School fundraising event"
        }
      ],
      "realWorldConnection": "School fundraising and reading promotion",
      "yearAppropriate": [
        2,
        3,
        4,
        5
      ],
      "templates": [
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "COMPARISON"
          ],
          "template": "{character} wants to buy books at the book fair. Calculate the total cost.",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        }
      ]
    },
    "distractors": [
      {
        "value": 1,
        "displayText": "Option B is better value",
        "strategy": "REVERSED_COMPARISON",
        "reasoning": "Selected the option with lower value"
      },
      {
        "value": -1,
        "displayText": "Both options are equally good value",
        "strategy": "WRONG_SELECTION",
        "reasoning": "Failed to calculate the difference correctly"
      },
      {
        "value": 0,
        "displayText": "Option A saves you £2908.00",
        "strategy": "CALCULATION_ERROR",
        "reasoning": "Arithmetic error in calculating the difference"
      }
    ],
    "enhancementStatus": {
      "level": "full",
      "requestedFormat": "COMPARISON",
      "actualFormat": "COMPARISON",
      "featuresActive": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "featuresPending": [],
      "isFullyEnhanced": true
    },
    "mathOutput": {
      "operation": "ADDITION",
      "option_1_value": 2735,
      "option_2_value": 1281
    },
    "generationTime": 1,
    "questionId": "q_1759077175177_bhs1r2pfm",
    "generationSetup": {
      "controller_used": "COMPARISONController",
      "format_requested": "COMPARISON",
      "format_actual": "COMPARISON",
      "scenario_theme": "SHOPPING",
      "scenario_id": "shop-001-bookfair",
      "scenario_selection_method": "default",
      "distractor_strategies": [
        "REVERSED_COMPARISON",
        "WRONG_SELECTION",
        "CALCULATION_ERROR"
      ],
      "distractor_count": 3,
      "theme_variety": false,
      "format_variety": false,
      "enhancement_level": "full",
      "features_active": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "features_pending": [],
      "generation_time_ms": 1
    }
  },
  "metadata": {
    "format": "COMPARISON",
    "cognitive_load": 60,
    "curriculum_alignment": [
      "5N1a",
      "5N1b"
    ],
    "difficulty": "5.3",
    "scenario_theme": "SHOPPING",
    "distractor_strategies": [
      "REVERSED_COMPARISON",
      "WRONG_SELECTION",
      "CALCULATION_ERROR"
    ],
    "generation_time_ms": 1,
    "api_version": "2.0",
    "enhancement_status": "full",
    "format_requested": "COMPARISON",
    "format_used": "COMPARISON",
    "features_active": [
      "enhanced_distractors",
      "rich_scenarios",
      "cognitive_load",
      "advanced_formats"
    ],
    "features_pending": []
  },
  "context": {
    "id": "shop-001-bookfair",
    "theme": "SHOPPING",
    "setting": {
      "location": "school book fair",
      "timeContext": "lunch break",
      "atmosphere": "busy"
    },
    "characters": [
      {
        "name": "Sarah",
        "role": "student"
      },
      {
        "name": "Mr. Johnson",
        "role": "teacher"
      }
    ],
    "items": [
      {
        "name": "book",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 3,
          "max": 12,
          "typical": 6.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "bookmark",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.5,
          "max": 2,
          "typical": 1,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      }
    ],
    "culturalElements": [
      {
        "type": "currency",
        "value": "£",
        "explanation": "British pounds"
      },
      {
        "type": "event",
        "value": "book fair",
        "explanation": "School fundraising event"
      }
    ],
    "realWorldConnection": "School fundraising and reading promotion",
    "yearAppropriate": [
      2,
      3,
      4,
      5
    ],
    "templates": [
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "COMPARISON"
        ],
        "template": "{character} wants to buy books at the book fair. Calculate the total cost.",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      }
    ]
  }
}
# Test C.3: ESTIMATION format
{
  "success": true,
  "question": {
    "text": "Sarah is adding £313.00 + £54.00 + £997.00 + £77.00. Round the result to the nearest hundreds.",
    "options": [
      {
        "text": "1400",
        "value": 1400,
        "index": 0
      },
      {
        "text": "1500",
        "value": 1500,
        "index": 1
      },
      {
        "text": "1440",
        "value": 1440,
        "index": 2
      },
      {
        "text": "£1400.00",
        "value": 1400,
        "index": 3
      }
    ],
    "correctIndex": 0,
    "questionContent": {
      "fullText": "Sarah is adding £313.00 + £54.00 + £997.00 + £77.00. Round the result to the nearest hundreds.",
      "templateData": {
        "character": "Sarah",
        "operation": "is adding £313.00 + £54.00 + £997.00 + £77.00",
        "roundingPlace": "hundreds",
        "exactValue": "1441",
        "roundedValue": "1400"
      }
    },
    "format": "ESTIMATION",
    "difficulty": {
      "year": 5,
      "subLevel": 3,
      "displayName": "5.3",
      "cognitiveLoad": 60
    },
    "cognitiveLoad": 60,
    "curriculumTags": [
      "5N1a",
      "5N1b"
    ],
    "scenario": {
      "id": "shop-001-bookfair",
      "theme": "SHOPPING",
      "setting": {
        "location": "school book fair",
        "timeContext": "lunch break",
        "atmosphere": "busy"
      },
      "characters": [
        {
          "name": "Sarah",
          "role": "student"
        },
        {
          "name": "Mr. Johnson",
          "role": "teacher"
        }
      ],
      "items": [
        {
          "name": "book",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 3,
            "max": 12,
            "typical": 6.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "bookmark",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.5,
            "max": 2,
            "typical": 1,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        }
      ],
      "culturalElements": [
        {
          "type": "currency",
          "value": "£",
          "explanation": "British pounds"
        },
        {
          "type": "event",
          "value": "book fair",
          "explanation": "School fundraising event"
        }
      ],
      "realWorldConnection": "School fundraising and reading promotion",
      "yearAppropriate": [
        2,
        3,
        4,
        5
      ],
      "templates": [
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "COMPARISON"
          ],
          "template": "{character} wants to buy books at the book fair. Calculate the total cost.",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        }
      ]
    },
    "distractors": [
      {
        "value": 1440,
        "strategy": "WRONG_OPERATION",
        "rationale": "Rounded to wrong place value"
      },
      {
        "value": 1400,
        "rationale": "Truncated instead of rounded"
      },
      {
        "value": 1500,
        "rationale": "Always rounded up"
      }
    ],
    "enhancementStatus": {
      "level": "full",
      "requestedFormat": "ESTIMATION",
      "actualFormat": "ESTIMATION",
      "featuresActive": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "featuresPending": [],
      "isFullyEnhanced": true
    },
    "mathOutput": {
      "operation": "ADDITION",
      "operands": [
        313,
        54,
        997,
        77
      ],
      "result": 1441,
      "intermediate_steps": [
        313,
        367,
        1364
      ],
      "decimal_formatted": {
        "operands": [
          "313",
          "54",
          "997",
          "77"
        ],
        "result": "1441"
      },
      "exactValue": 1441,
      "roundedValue": 1400
    },
    "generationTime": 0,
    "questionId": "q_1759077175221_02ndkoy1a",
    "generationSetup": {
      "controller_used": "ESTIMATIONController",
      "format_requested": "ESTIMATION",
      "format_actual": "ESTIMATION",
      "scenario_theme": "SHOPPING",
      "scenario_id": "shop-001-bookfair",
      "scenario_selection_method": "default",
      "distractor_strategies": [
        "WRONG_OPERATION",
        null,
        null
      ],
      "distractor_count": 3,
      "theme_variety": false,
      "format_variety": false,
      "enhancement_level": "full",
      "features_active": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "features_pending": [],
      "generation_time_ms": 0
    }
  },
  "metadata": {
    "format": "ESTIMATION",
    "cognitive_load": 60,
    "curriculum_alignment": [
      "5N1a",
      "5N1b"
    ],
    "difficulty": "5.3",
    "scenario_theme": "SHOPPING",
    "distractor_strategies": [
      "WRONG_OPERATION",
      null,
      null
    ],
    "generation_time_ms": 0,
    "api_version": "2.0",
    "enhancement_status": "full",
    "format_requested": "ESTIMATION",
    "format_used": "ESTIMATION",
    "features_active": [
      "enhanced_distractors",
      "rich_scenarios",
      "cognitive_load",
      "advanced_formats"
    ],
    "features_pending": []
  },
  "context": {
    "id": "shop-001-bookfair",
    "theme": "SHOPPING",
    "setting": {
      "location": "school book fair",
      "timeContext": "lunch break",
      "atmosphere": "busy"
    },
    "characters": [
      {
        "name": "Sarah",
        "role": "student"
      },
      {
        "name": "Mr. Johnson",
        "role": "teacher"
      }
    ],
    "items": [
      {
        "name": "book",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 3,
          "max": 12,
          "typical": 6.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "bookmark",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.5,
          "max": 2,
          "typical": 1,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      }
    ],
    "culturalElements": [
      {
        "type": "currency",
        "value": "£",
        "explanation": "British pounds"
      },
      {
        "type": "event",
        "value": "book fair",
        "explanation": "School fundraising event"
      }
    ],
    "realWorldConnection": "School fundraising and reading promotion",
    "yearAppropriate": [
      2,
      3,
      4,
      5
    ],
    "templates": [
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "COMPARISON"
        ],
        "template": "{character} wants to buy books at the book fair. Calculate the total cost.",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      }
    ]
  }
}
# Test C.4: ORDERING format
{
  "success": true,
  "question": {
    "text": "Charlotte is comparing prices: 437, 957.7, 298, 909 pence. Arrange these prices from smallest to largest.",
    "options": [
      {
        "value": null,
        "text": "NaNp",
        "isCorrect": true
      },
      {
        "value": null,
        "text": "NaNp",
        "isCorrect": false
      },
      {
        "value": null,
        "text": "NaNp",
        "isCorrect": false
      },
      {
        "value": null,
        "text": "NaNp",
        "isCorrect": false
      }
    ],
    "correctIndex": 3,
    "questionContent": {
      "fullText": "Charlotte is comparing prices: 437, 957.7, 298, 909 pence. Arrange these prices from smallest to largest."
    },
    "format": "ORDERING",
    "difficulty": {
      "year": 5,
      "subLevel": 3,
      "displayName": "5.3",
      "cognitiveLoad": 60
    },
    "cognitiveLoad": 60,
    "curriculumTags": [
      "5N1a",
      "5N1b"
    ],
    "scenario": {
      "id": "shop-002-realistic-general",
      "theme": "SHOPPING",
      "setting": {
        "location": "local shop",
        "timeContext": "after school",
        "atmosphere": "friendly"
      },
      "characters": [
        {
          "name": "Charlotte",
          "role": "student"
        }
      ],
      "items": [
        {
          "name": "apple",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.2,
            "max": 0.5,
            "typical": 0.35,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "banana",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.15,
            "max": 0.4,
            "typical": 0.25,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "sandwich",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 2.5,
            "max": 6,
            "typical": 4,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "drink",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.8,
            "max": 2.5,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "cake",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 1.5,
            "max": 4,
            "typical": 2.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "biscuit",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.8,
            "max": 2,
            "typical": 1.2,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "sweet",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.1,
            "max": 1,
            "typical": 0.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "chocolate",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.6,
            "max": 3,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "pen",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.5,
            "max": 2,
            "typical": 1,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "pencil",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.2,
            "max": 1,
            "typical": 0.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "ruler",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.8,
            "max": 2.5,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "notebook",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 1,
            "max": 4,
            "typical": 2,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "eraser",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.3,
            "max": 1.5,
            "typical": 0.75,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "book",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 3,
            "max": 15,
            "typical": 8,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "comic",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 2,
            "max": 5,
            "typical": 3,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "magazine",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 2.5,
            "max": 6,
            "typical": 4,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "toy",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 5,
            "max": 25,
            "typical": 12,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "game",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 8,
            "max": 60,
            "typical": 25,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "puzzle",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 5,
            "max": 20,
            "typical": 12,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "sticker",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 0.2,
            "max": 2,
            "typical": 0.8,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "badge",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 0.5,
            "max": 3,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "poster",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 2,
            "max": 8,
            "typical": 4,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "card",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 0.5,
            "max": 4,
            "typical": 2,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        }
      ],
      "culturalElements": [
        {
          "type": "currency",
          "value": "£",
          "explanation": "British pounds"
        },
        {
          "type": "location",
          "value": "UK local shop",
          "explanation": "Typical British corner shop"
        }
      ],
      "realWorldConnection": "Everyday shopping with realistic UK prices",
      "yearAppropriate": [
        1,
        2,
        3,
        4,
        5,
        6
      ],
      "templates": [
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "MULTI_STEP"
          ],
          "modelCompatibility": [
            "ADDITION"
          ],
          "operandCount": 3,
          "template": "{character} buys a {item1} for {price1}, a {item2} for {price2}, and a {item3} for {price3}. What is the total cost?",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item1",
              "type": "item"
            },
            {
              "key": "item2",
              "type": "item"
            },
            {
              "key": "item3",
              "type": "item"
            },
            {
              "key": "price1",
              "type": "value"
            },
            {
              "key": "price2",
              "type": "value"
            },
            {
              "key": "price3",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "MULTI_STEP"
          ],
          "modelCompatibility": [
            "ADDITION"
          ],
          "operandCount": 2,
          "template": "{character} buys a {item1} for {price1} and a {item2} for {price2}. What is the total cost?",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item1",
              "type": "item"
            },
            {
              "key": "item2",
              "type": "item"
            },
            {
              "key": "price1",
              "type": "value"
            },
            {
              "key": "price2",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION"
          ],
          "modelCompatibility": [
            "SUBTRACTION",
            "CHANGE_CALCULATION"
          ],
          "template": "{character} buys a {item} for {price} and pays with {payment}. How much change does {character} get?",
          "answerTemplate": "{character} receives {result} in change",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "price",
              "type": "value"
            },
            {
              "key": "payment",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION"
          ],
          "modelCompatibility": [
            "MULTIPLICATION"
          ],
          "template": "{character} buys {quantity} {item} at {price} each. What is the total cost?",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "quantity",
              "type": "value"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "price",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION"
          ],
          "modelCompatibility": [
            "DIVISION"
          ],
          "template": "{character} has {total} to spend equally on {quantity} {item}. How much can {character} spend on each one?",
          "answerTemplate": "{character} can spend {result} on each {item}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "total",
              "type": "value"
            },
            {
              "key": "quantity",
              "type": "value"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "COMPARISON",
            "ESTIMATION",
            "MULTI_STEP"
          ],
          "template": "{character} goes to the shop and buys {items}. How much does {character} spend in total?",
          "answerTemplate": "{character} spends {result} in total",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "items",
              "type": "item_list"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "ESTIMATION"
          ],
          "template": "Estimate: If {character} buys {items}, about how much will it cost?",
          "answerTemplate": "It will cost approximately {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "items",
              "type": "item_list"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "VALIDATION"
          ],
          "template": "{character} calculated that {items} costs {amount}. Is this correct?",
          "answerTemplate": "{validation_result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "items",
              "type": "item_list"
            },
            {
              "key": "amount",
              "type": "value"
            },
            {
              "key": "validation_result",
              "type": "boolean"
            }
          ]
        }
      ]
    },
    "distractors": [
      {
        "value": [
          957.7,
          909,
          437,
          298
        ],
        "rationale": "Ordered in opposite direction"
      },
      {
        "value": [
          298,
          437,
          957.7,
          909
        ],
        "rationale": "Partially correct ordering"
      },
      {
        "value": [
          437,
          957.7,
          298,
          909
        ],
        "rationale": "Original unsorted order"
      }
    ],
    "enhancementStatus": {
      "level": "full",
      "requestedFormat": "ORDERING",
      "actualFormat": "ORDERING",
      "featuresActive": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "featuresPending": [],
      "isFullyEnhanced": true
    },
    "mathOutput": {
      "operation": "ADDITION",
      "operands": [
        750,
        549,
        145,
        270
      ],
      "result": 1714,
      "intermediate_steps": [
        750,
        1299,
        1444
      ],
      "decimal_formatted": {
        "operands": [
          "750",
          "549",
          "145",
          "270"
        ],
        "result": "1714"
      }
    },
    "generationTime": 1,
    "questionId": "q_1759077175263_61eqgfae3",
    "generationSetup": {
      "controller_used": "ORDERINGController",
      "format_requested": "ORDERING",
      "format_actual": "ORDERING",
      "scenario_theme": "SHOPPING",
      "scenario_id": "shop-002-realistic-general",
      "scenario_selection_method": "default",
      "distractor_strategies": [
        null,
        null,
        null
      ],
      "distractor_count": 3,
      "theme_variety": false,
      "format_variety": false,
      "enhancement_level": "full",
      "features_active": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "features_pending": [],
      "generation_time_ms": 1
    }
  },
  "metadata": {
    "format": "ORDERING",
    "cognitive_load": 60,
    "curriculum_alignment": [
      "5N1a",
      "5N1b"
    ],
    "difficulty": "5.3",
    "scenario_theme": "SHOPPING",
    "distractor_strategies": [
      null,
      null,
      null
    ],
    "generation_time_ms": 1,
    "api_version": "2.0",
    "enhancement_status": "full",
    "format_requested": "ORDERING",
    "format_used": "ORDERING",
    "features_active": [
      "enhanced_distractors",
      "rich_scenarios",
      "cognitive_load",
      "advanced_formats"
    ],
    "features_pending": []
  },
  "context": {
    "id": "shop-002-realistic-general",
    "theme": "SHOPPING",
    "setting": {
      "location": "local shop",
      "timeContext": "after school",
      "atmosphere": "friendly"
    },
    "characters": [
      {
        "name": "Charlotte",
        "role": "student"
      }
    ],
    "items": [
      {
        "name": "apple",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.2,
          "max": 0.5,
          "typical": 0.35,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "banana",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.15,
          "max": 0.4,
          "typical": 0.25,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "sandwich",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 2.5,
          "max": 6,
          "typical": 4,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "drink",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.8,
          "max": 2.5,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "cake",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 1.5,
          "max": 4,
          "typical": 2.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "biscuit",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.8,
          "max": 2,
          "typical": 1.2,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "sweet",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.1,
          "max": 1,
          "typical": 0.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "chocolate",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.6,
          "max": 3,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "pen",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.5,
          "max": 2,
          "typical": 1,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "pencil",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.2,
          "max": 1,
          "typical": 0.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "ruler",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.8,
          "max": 2.5,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "notebook",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 1,
          "max": 4,
          "typical": 2,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "eraser",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.3,
          "max": 1.5,
          "typical": 0.75,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "book",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 3,
          "max": 15,
          "typical": 8,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "comic",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 2,
          "max": 5,
          "typical": 3,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "magazine",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 2.5,
          "max": 6,
          "typical": 4,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "toy",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 5,
          "max": 25,
          "typical": 12,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "game",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 8,
          "max": 60,
          "typical": 25,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "puzzle",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 5,
          "max": 20,
          "typical": 12,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "sticker",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 0.2,
          "max": 2,
          "typical": 0.8,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "badge",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 0.5,
          "max": 3,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "poster",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 2,
          "max": 8,
          "typical": 4,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "card",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 0.5,
          "max": 4,
          "typical": 2,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      }
    ],
    "culturalElements": [
      {
        "type": "currency",
        "value": "£",
        "explanation": "British pounds"
      },
      {
        "type": "location",
        "value": "UK local shop",
        "explanation": "Typical British corner shop"
      }
    ],
    "realWorldConnection": "Everyday shopping with realistic UK prices",
    "yearAppropriate": [
      1,
      2,
      3,
      4,
      5,
      6
    ],
    "templates": [
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "MULTI_STEP"
        ],
        "modelCompatibility": [
          "ADDITION"
        ],
        "operandCount": 3,
        "template": "{character} buys a {item1} for {price1}, a {item2} for {price2}, and a {item3} for {price3}. What is the total cost?",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item1",
            "type": "item"
          },
          {
            "key": "item2",
            "type": "item"
          },
          {
            "key": "item3",
            "type": "item"
          },
          {
            "key": "price1",
            "type": "value"
          },
          {
            "key": "price2",
            "type": "value"
          },
          {
            "key": "price3",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "MULTI_STEP"
        ],
        "modelCompatibility": [
          "ADDITION"
        ],
        "operandCount": 2,
        "template": "{character} buys a {item1} for {price1} and a {item2} for {price2}. What is the total cost?",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item1",
            "type": "item"
          },
          {
            "key": "item2",
            "type": "item"
          },
          {
            "key": "price1",
            "type": "value"
          },
          {
            "key": "price2",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION"
        ],
        "modelCompatibility": [
          "SUBTRACTION",
          "CHANGE_CALCULATION"
        ],
        "template": "{character} buys a {item} for {price} and pays with {payment}. How much change does {character} get?",
        "answerTemplate": "{character} receives {result} in change",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "price",
            "type": "value"
          },
          {
            "key": "payment",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION"
        ],
        "modelCompatibility": [
          "MULTIPLICATION"
        ],
        "template": "{character} buys {quantity} {item} at {price} each. What is the total cost?",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "quantity",
            "type": "value"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "price",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION"
        ],
        "modelCompatibility": [
          "DIVISION"
        ],
        "template": "{character} has {total} to spend equally on {quantity} {item}. How much can {character} spend on each one?",
        "answerTemplate": "{character} can spend {result} on each {item}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "total",
            "type": "value"
          },
          {
            "key": "quantity",
            "type": "value"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "COMPARISON",
          "ESTIMATION",
          "MULTI_STEP"
        ],
        "template": "{character} goes to the shop and buys {items}. How much does {character} spend in total?",
        "answerTemplate": "{character} spends {result} in total",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "items",
            "type": "item_list"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "ESTIMATION"
        ],
        "template": "Estimate: If {character} buys {items}, about how much will it cost?",
        "answerTemplate": "It will cost approximately {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "items",
            "type": "item_list"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "VALIDATION"
        ],
        "template": "{character} calculated that {items} costs {amount}. Is this correct?",
        "answerTemplate": "{validation_result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "items",
            "type": "item_list"
          },
          {
            "key": "amount",
            "type": "value"
          },
          {
            "key": "validation_result",
            "type": "boolean"
          }
        ]
      }
    ]
  }
}
# Test C.5: VALIDATION format
{
  "success": true,
  "question": {
    "text": "Sarah showed their working:\\nundefined + undefined\\n= NaN\\n\\nIs this working correct?",
    "options": [
      {
        "value": 1709,
        "text": "£1709.00",
        "isCorrect": true
      },
      {
        "text": "£1709.00",
        "value": 1709,
        "index": 1
      }
    ],
    "correctIndex": 1,
    "questionContent": {
      "fullText": "Sarah showed their working:\\nundefined + undefined\\n= NaN\\n\\nIs this working correct?"
    },
    "format": "VALIDATION",
    "difficulty": {
      "year": 5,
      "subLevel": 3,
      "displayName": "5.3",
      "cognitiveLoad": 60
    },
    "cognitiveLoad": 60,
    "curriculumTags": [
      "5N1a",
      "5N1b"
    ],
    "scenario": {
      "id": "shop-001-bookfair",
      "theme": "SHOPPING",
      "setting": {
        "location": "school book fair",
        "timeContext": "lunch break",
        "atmosphere": "busy"
      },
      "characters": [
        {
          "name": "Sarah",
          "role": "student"
        },
        {
          "name": "Mr. Johnson",
          "role": "teacher"
        }
      ],
      "items": [
        {
          "name": "book",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 3,
            "max": 12,
            "typical": 6.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "bookmark",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.5,
            "max": 2,
            "typical": 1,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        }
      ],
      "culturalElements": [
        {
          "type": "currency",
          "value": "£",
          "explanation": "British pounds"
        },
        {
          "type": "event",
          "value": "book fair",
          "explanation": "School fundraising event"
        }
      ],
      "realWorldConnection": "School fundraising and reading promotion",
      "yearAppropriate": [
        2,
        3,
        4,
        5
      ],
      "templates": [
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "COMPARISON"
          ],
          "template": "{character} wants to buy books at the book fair. Calculate the total cost.",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        }
      ]
    },
    "distractors": [
      {
        "value": "Incorrect",
        "rationale": "Incorrectly identified correct work as wrong"
      }
    ],
    "enhancementStatus": {
      "level": "full",
      "requestedFormat": "VALIDATION",
      "actualFormat": "VALIDATION",
      "featuresActive": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "featuresPending": [],
      "isFullyEnhanced": true
    },
    "mathOutput": {
      "operation": "ADDITION",
      "operands": [
        899,
        359,
        418,
        33
      ],
      "result": 1709,
      "intermediate_steps": [
        899,
        1258,
        1676
      ],
      "decimal_formatted": {
        "operands": [
          "899",
          "359",
          "418",
          "33"
        ],
        "result": "1709"
      }
    },
    "generationTime": 0,
    "questionId": "q_1759077175315_9egjwv29v",
    "generationSetup": {
      "controller_used": "VALIDATIONController",
      "format_requested": "VALIDATION",
      "format_actual": "VALIDATION",
      "scenario_theme": "SHOPPING",
      "scenario_id": "shop-001-bookfair",
      "scenario_selection_method": "default",
      "distractor_strategies": [
        null
      ],
      "distractor_count": 1,
      "theme_variety": false,
      "format_variety": false,
      "enhancement_level": "full",
      "features_active": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "features_pending": [],
      "generation_time_ms": 0
    }
  },
  "metadata": {
    "format": "VALIDATION",
    "cognitive_load": 60,
    "curriculum_alignment": [
      "5N1a",
      "5N1b"
    ],
    "difficulty": "5.3",
    "scenario_theme": "SHOPPING",
    "distractor_strategies": [
      null
    ],
    "generation_time_ms": 0,
    "api_version": "2.0",
    "enhancement_status": "full",
    "format_requested": "VALIDATION",
    "format_used": "VALIDATION",
    "features_active": [
      "enhanced_distractors",
      "rich_scenarios",
      "cognitive_load",
      "advanced_formats"
    ],
    "features_pending": []
  },
  "context": {
    "id": "shop-001-bookfair",
    "theme": "SHOPPING",
    "setting": {
      "location": "school book fair",
      "timeContext": "lunch break",
      "atmosphere": "busy"
    },
    "characters": [
      {
        "name": "Sarah",
        "role": "student"
      },
      {
        "name": "Mr. Johnson",
        "role": "teacher"
      }
    ],
    "items": [
      {
        "name": "book",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 3,
          "max": 12,
          "typical": 6.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "bookmark",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.5,
          "max": 2,
          "typical": 1,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      }
    ],
    "culturalElements": [
      {
        "type": "currency",
        "value": "£",
        "explanation": "British pounds"
      },
      {
        "type": "event",
        "value": "book fair",
        "explanation": "School fundraising event"
      }
    ],
    "realWorldConnection": "School fundraising and reading promotion",
    "yearAppropriate": [
      2,
      3,
      4,
      5
    ],
    "templates": [
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "COMPARISON"
        ],
        "template": "{character} wants to buy books at the book fair. Calculate the total cost.",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      }
    ]
  }
}
# Test C.6: MULTI_STEP format
{
  "success": true,
  "question": {
    "text": "Sarah is shopping and needs to make several calculations. First, Sarah adds the cost of 426p and 418p items. Then Sarah adds 18p more to the total. What is the final result?",
    "options": [
      {
        "text": "862",
        "value": 862,
        "index": 0
      },
      {
        "text": "844",
        "value": 844,
        "index": 1
      },
      {
        "text": "£862.00",
        "value": 862,
        "index": 2
      },
      {
        "text": "826",
        "value": 826,
        "index": 3
      }
    ],
    "correctIndex": 0,
    "questionContent": {
      "fullText": "Sarah is shopping and needs to make several calculations. First, Sarah adds the cost of 426p and 418p items. Then Sarah adds 18p more to the total. What is the final result?",
      "components": {
        "narrative": "Sarah needs to solve this step by step:",
        "steps": [
          {
            "stepNumber": 1,
            "text": "Add 426 and 418",
            "operation": "ADDITION",
            "values": [
              426,
              418
            ],
            "result": 844,
            "description": "Add 426 and 418"
          },
          {
            "stepNumber": 2,
            "text": "Add 18 to 844",
            "operation": "ADDITION",
            "values": [
              844,
              18
            ],
            "result": 862,
            "description": "Add 18 to 844"
          }
        ],
        "prompt": "What is the final result?",
        "highlightValues": [
          426,
          418,
          844,
          844,
          18,
          862
        ],
        "operators": [
          "+"
        ]
      },
      "templateData": {
        "character": "Sarah",
        "context": "school book fair",
        "theme": "SHOPPING",
        "quantities": [
          426,
          844
        ],
        "prices": [
          418,
          18
        ],
        "action": "calculating step by step"
      }
    },
    "format": "MULTI_STEP",
    "difficulty": {
      "year": 5,
      "subLevel": 3,
      "displayName": "5.3",
      "cognitiveLoad": 60
    },
    "cognitiveLoad": 60,
    "curriculumTags": [
      "5N1a",
      "5N1b"
    ],
    "scenario": {
      "id": "shop-001-bookfair",
      "theme": "SHOPPING",
      "setting": {
        "location": "school book fair",
        "timeContext": "lunch break",
        "atmosphere": "busy"
      },
      "characters": [
        {
          "name": "Sarah",
          "role": "student"
        },
        {
          "name": "Mr. Johnson",
          "role": "teacher"
        }
      ],
      "items": [
        {
          "name": "book",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 3,
            "max": 12,
            "typical": 6.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "bookmark",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.5,
            "max": 2,
            "typical": 1,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        }
      ],
      "culturalElements": [
        {
          "type": "currency",
          "value": "£",
          "explanation": "British pounds"
        },
        {
          "type": "event",
          "value": "book fair",
          "explanation": "School fundraising event"
        }
      ],
      "realWorldConnection": "School fundraising and reading promotion",
      "yearAppropriate": [
        2,
        3,
        4,
        5
      ],
      "templates": [
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "COMPARISON"
          ],
          "template": "{character} wants to buy books at the book fair. Calculate the total cost.",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        }
      ]
    },
    "distractors": [
      {
        "value": 844,
        "rationale": "Stopped after first step"
      },
      {
        "value": 826,
        "strategy": "WRONG_OPERATION",
        "rationale": "Used wrong operation in step 2"
      },
      {
        "value": 862,
        "rationale": "Performed operations in wrong order"
      }
    ],
    "enhancementStatus": {
      "level": "full",
      "requestedFormat": "MULTI_STEP",
      "actualFormat": "MULTI_STEP",
      "featuresActive": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "featuresPending": [],
      "isFullyEnhanced": true
    },
    "mathOutput": {
      "operation": "ADDITION",
      "operands": [
        307,
        519,
        361,
        497
      ],
      "result": 1684,
      "intermediate_steps": [
        307,
        826,
        1187
      ],
      "decimal_formatted": {
        "operands": [
          "307",
          "519",
          "361",
          "497"
        ],
        "result": "1684"
      }
    },
    "generationTime": 1,
    "questionId": "q_1759077175361_5190nyqzy",
    "generationSetup": {
      "controller_used": "MULTI_STEPController",
      "format_requested": "MULTI_STEP",
      "format_actual": "MULTI_STEP",
      "scenario_theme": "SHOPPING",
      "scenario_id": "shop-001-bookfair",
      "scenario_selection_method": "default",
      "distractor_strategies": [
        null,
        "WRONG_OPERATION",
        null
      ],
      "distractor_count": 3,
      "theme_variety": false,
      "format_variety": false,
      "enhancement_level": "full",
      "features_active": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "features_pending": [],
      "generation_time_ms": 1
    }
  },
  "metadata": {
    "format": "MULTI_STEP",
    "cognitive_load": 60,
    "curriculum_alignment": [
      "5N1a",
      "5N1b"
    ],
    "difficulty": "5.3",
    "scenario_theme": "SHOPPING",
    "distractor_strategies": [
      null,
      "WRONG_OPERATION",
      null
    ],
    "generation_time_ms": 1,
    "api_version": "2.0",
    "enhancement_status": "full",
    "format_requested": "MULTI_STEP",
    "format_used": "MULTI_STEP",
    "features_active": [
      "enhanced_distractors",
      "rich_scenarios",
      "cognitive_load",
      "advanced_formats"
    ],
    "features_pending": []
  },
  "context": {
    "id": "shop-001-bookfair",
    "theme": "SHOPPING",
    "setting": {
      "location": "school book fair",
      "timeContext": "lunch break",
      "atmosphere": "busy"
    },
    "characters": [
      {
        "name": "Sarah",
        "role": "student"
      },
      {
        "name": "Mr. Johnson",
        "role": "teacher"
      }
    ],
    "items": [
      {
        "name": "book",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 3,
          "max": 12,
          "typical": 6.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "bookmark",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.5,
          "max": 2,
          "typical": 1,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      }
    ],
    "culturalElements": [
      {
        "type": "currency",
        "value": "£",
        "explanation": "British pounds"
      },
      {
        "type": "event",
        "value": "book fair",
        "explanation": "School fundraising event"
      }
    ],
    "realWorldConnection": "School fundraising and reading promotion",
    "yearAppropriate": [
      2,
      3,
      4,
      5
    ],
    "templates": [
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "COMPARISON"
        ],
        "template": "{character} wants to buy books at the book fair. Calculate the total cost.",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      }
    ]
  }
}
# Test C.7: MISSING_VALUE format
{
  "success": true,
  "question": {
    "text": "Sarah starts with undefined items and gets more undefined more items. How many items does Sarah have now?",
    "options": [
      {
        "value": 1444,
        "text": "£1444.00",
        "isCorrect": true
      },
      {
        "value": 1270.031720228429,
        "text": "£1270.03",
        "isCorrect": false
      },
      {
        "text": "1445",
        "value": 1445,
        "index": 2
      },
      {
        "text": "1444",
        "value": 1444,
        "index": 3
      }
    ],
    "correctIndex": 3,
    "questionContent": {
      "fullText": "Sarah starts with undefined items and gets more undefined more items. How many items does Sarah have now?"
    },
    "format": "MISSING_VALUE",
    "difficulty": {
      "year": 5,
      "subLevel": 3,
      "displayName": "5.3",
      "cognitiveLoad": 60
    },
    "cognitiveLoad": 60,
    "curriculumTags": [
      "5N1a",
      "5N1b"
    ],
    "scenario": {
      "id": "shop-001-bookfair",
      "theme": "SHOPPING",
      "setting": {
        "location": "school book fair",
        "timeContext": "lunch break",
        "atmosphere": "busy"
      },
      "characters": [
        {
          "name": "Sarah",
          "role": "student"
        },
        {
          "name": "Mr. Johnson",
          "role": "teacher"
        }
      ],
      "items": [
        {
          "name": "book",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 3,
            "max": 12,
            "typical": 6.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "bookmark",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.5,
            "max": 2,
            "typical": 1,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        }
      ],
      "culturalElements": [
        {
          "type": "currency",
          "value": "£",
          "explanation": "British pounds"
        },
        {
          "type": "event",
          "value": "book fair",
          "explanation": "School fundraising event"
        }
      ],
      "realWorldConnection": "School fundraising and reading promotion",
      "yearAppropriate": [
        2,
        3,
        4,
        5
      ],
      "templates": [
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "COMPARISON"
          ],
          "template": "{character} wants to buy books at the book fair. Calculate the total cost.",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        }
      ]
    },
    "distractors": [
      {
        "value": null,
        "strategy": "WRONG_OPERATION",
        "rationale": "Used wrong operation to solve"
      },
      {
        "value": 1445,
        "strategy": "CALCULATION_ERROR",
        "rationale": "Arithmetic calculation error"
      },
      {
        "rationale": "Confused given value with missing value"
      }
    ],
    "enhancementStatus": {
      "level": "full",
      "requestedFormat": "MISSING_VALUE",
      "actualFormat": "MISSING_VALUE",
      "featuresActive": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "featuresPending": [],
      "isFullyEnhanced": true
    },
    "mathOutput": {
      "operation": "ADDITION",
      "operands": [
        592,
        386,
        309,
        157
      ],
      "result": 1444,
      "intermediate_steps": [
        592,
        978,
        1287
      ],
      "decimal_formatted": {
        "operands": [
          "592",
          "386",
          "309",
          "157"
        ],
        "result": "1444"
      }
    },
    "generationTime": 0,
    "questionId": "q_1759077175404_e23fuhond",
    "generationSetup": {
      "controller_used": "MISSING_VALUEController",
      "format_requested": "MISSING_VALUE",
      "format_actual": "MISSING_VALUE",
      "scenario_theme": "SHOPPING",
      "scenario_id": "shop-001-bookfair",
      "scenario_selection_method": "default",
      "distractor_strategies": [
        "WRONG_OPERATION",
        "CALCULATION_ERROR",
        null
      ],
      "distractor_count": 3,
      "theme_variety": false,
      "format_variety": false,
      "enhancement_level": "full",
      "features_active": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "features_pending": [],
      "generation_time_ms": 0
    }
  },
  "metadata": {
    "format": "MISSING_VALUE",
    "cognitive_load": 60,
    "curriculum_alignment": [
      "5N1a",
      "5N1b"
    ],
    "difficulty": "5.3",
    "scenario_theme": "SHOPPING",
    "distractor_strategies": [
      "WRONG_OPERATION",
      "CALCULATION_ERROR",
      null
    ],
    "generation_time_ms": 1,
    "api_version": "2.0",
    "enhancement_status": "full",
    "format_requested": "MISSING_VALUE",
    "format_used": "MISSING_VALUE",
    "features_active": [
      "enhanced_distractors",
      "rich_scenarios",
      "cognitive_load",
      "advanced_formats"
    ],
    "features_pending": []
  },
  "context": {
    "id": "shop-001-bookfair",
    "theme": "SHOPPING",
    "setting": {
      "location": "school book fair",
      "timeContext": "lunch break",
      "atmosphere": "busy"
    },
    "characters": [
      {
        "name": "Sarah",
        "role": "student"
      },
      {
        "name": "Mr. Johnson",
        "role": "teacher"
      }
    ],
    "items": [
      {
        "name": "book",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 3,
          "max": 12,
          "typical": 6.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "bookmark",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.5,
          "max": 2,
          "typical": 1,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      }
    ],
    "culturalElements": [
      {
        "type": "currency",
        "value": "£",
        "explanation": "British pounds"
      },
      {
        "type": "event",
        "value": "book fair",
        "explanation": "School fundraising event"
      }
    ],
    "realWorldConnection": "School fundraising and reading promotion",
    "yearAppropriate": [
      2,
      3,
      4,
      5
    ],
    "templates": [
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "COMPARISON"
        ],
        "template": "{character} wants to buy books at the book fair. Calculate the total cost.",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      }
    ]
  }
}
# Test C.8: PATTERN_RECOGNITION format
{
  "success": true,
  "question": {
    "text": "Charlotte needs to find the missing number in this pattern: 6, 12, 24, 48, 96, 192, ?",
    "options": [
      {
        "text": "384",
        "value": 384,
        "index": 0
      },
      {
        "text": "194",
        "value": 194,
        "index": 1
      },
      {
        "text": "768",
        "value": 768,
        "index": 2
      },
      {
        "text": "383",
        "value": 383,
        "index": 3
      }
    ],
    "correctIndex": 0,
    "questionContent": {
      "fullText": "Charlotte needs to find the missing number in this pattern: 6, 12, 24, 48, 96, 192, ?"
    },
    "format": "PATTERN_RECOGNITION",
    "difficulty": {
      "year": 5,
      "subLevel": 3,
      "displayName": "5.3",
      "cognitiveLoad": 60
    },
    "cognitiveLoad": 60,
    "curriculumTags": [
      "5N1a",
      "5N1b"
    ],
    "scenario": {
      "id": "shop-002-realistic-general",
      "theme": "SHOPPING",
      "setting": {
        "location": "local shop",
        "timeContext": "after school",
        "atmosphere": "friendly"
      },
      "characters": [
        {
          "name": "Charlotte",
          "role": "student"
        }
      ],
      "items": [
        {
          "name": "apple",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.2,
            "max": 0.5,
            "typical": 0.35,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "banana",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.15,
            "max": 0.4,
            "typical": 0.25,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "sandwich",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 2.5,
            "max": 6,
            "typical": 4,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "drink",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.8,
            "max": 2.5,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "cake",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 1.5,
            "max": 4,
            "typical": 2.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "biscuit",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.8,
            "max": 2,
            "typical": 1.2,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "sweet",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.1,
            "max": 1,
            "typical": 0.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "chocolate",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.6,
            "max": 3,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "pen",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.5,
            "max": 2,
            "typical": 1,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "pencil",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.2,
            "max": 1,
            "typical": 0.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "ruler",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.8,
            "max": 2.5,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "notebook",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 1,
            "max": 4,
            "typical": 2,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "eraser",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.3,
            "max": 1.5,
            "typical": 0.75,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "book",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 3,
            "max": 15,
            "typical": 8,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "comic",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 2,
            "max": 5,
            "typical": 3,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "magazine",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 2.5,
            "max": 6,
            "typical": 4,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "toy",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 5,
            "max": 25,
            "typical": 12,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "game",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 8,
            "max": 60,
            "typical": 25,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "puzzle",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 5,
            "max": 20,
            "typical": 12,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "sticker",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 0.2,
            "max": 2,
            "typical": 0.8,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "badge",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 0.5,
            "max": 3,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "poster",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 2,
            "max": 8,
            "typical": 4,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "card",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 0.5,
            "max": 4,
            "typical": 2,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        }
      ],
      "culturalElements": [
        {
          "type": "currency",
          "value": "£",
          "explanation": "British pounds"
        },
        {
          "type": "location",
          "value": "UK local shop",
          "explanation": "Typical British corner shop"
        }
      ],
      "realWorldConnection": "Everyday shopping with realistic UK prices",
      "yearAppropriate": [
        1,
        2,
        3,
        4,
        5,
        6
      ],
      "templates": [
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "MULTI_STEP"
          ],
          "modelCompatibility": [
            "ADDITION"
          ],
          "operandCount": 3,
          "template": "{character} buys a {item1} for {price1}, a {item2} for {price2}, and a {item3} for {price3}. What is the total cost?",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item1",
              "type": "item"
            },
            {
              "key": "item2",
              "type": "item"
            },
            {
              "key": "item3",
              "type": "item"
            },
            {
              "key": "price1",
              "type": "value"
            },
            {
              "key": "price2",
              "type": "value"
            },
            {
              "key": "price3",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "MULTI_STEP"
          ],
          "modelCompatibility": [
            "ADDITION"
          ],
          "operandCount": 2,
          "template": "{character} buys a {item1} for {price1} and a {item2} for {price2}. What is the total cost?",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item1",
              "type": "item"
            },
            {
              "key": "item2",
              "type": "item"
            },
            {
              "key": "price1",
              "type": "value"
            },
            {
              "key": "price2",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION"
          ],
          "modelCompatibility": [
            "SUBTRACTION",
            "CHANGE_CALCULATION"
          ],
          "template": "{character} buys a {item} for {price} and pays with {payment}. How much change does {character} get?",
          "answerTemplate": "{character} receives {result} in change",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "price",
              "type": "value"
            },
            {
              "key": "payment",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION"
          ],
          "modelCompatibility": [
            "MULTIPLICATION"
          ],
          "template": "{character} buys {quantity} {item} at {price} each. What is the total cost?",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "quantity",
              "type": "value"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "price",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION"
          ],
          "modelCompatibility": [
            "DIVISION"
          ],
          "template": "{character} has {total} to spend equally on {quantity} {item}. How much can {character} spend on each one?",
          "answerTemplate": "{character} can spend {result} on each {item}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "total",
              "type": "value"
            },
            {
              "key": "quantity",
              "type": "value"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "COMPARISON",
            "ESTIMATION",
            "MULTI_STEP"
          ],
          "template": "{character} goes to the shop and buys {items}. How much does {character} spend in total?",
          "answerTemplate": "{character} spends {result} in total",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "items",
              "type": "item_list"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "ESTIMATION"
          ],
          "template": "Estimate: If {character} buys {items}, about how much will it cost?",
          "answerTemplate": "It will cost approximately {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "items",
              "type": "item_list"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "VALIDATION"
          ],
          "template": "{character} calculated that {items} costs {amount}. Is this correct?",
          "answerTemplate": "{validation_result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "items",
              "type": "item_list"
            },
            {
              "key": "amount",
              "type": "value"
            },
            {
              "key": "validation_result",
              "type": "boolean"
            }
          ]
        }
      ]
    },
    "distractors": [
      {
        "value": 194,
        "strategy": "WRONG_OPERATION",
        "rationale": "Used wrong operation for pattern"
      },
      {
        "value": 768,
        "rationale": "Started pattern from wrong position"
      },
      {
        "value": 383,
        "strategy": "CALCULATION_ERROR",
        "rationale": "Off by one error"
      }
    ],
    "enhancementStatus": {
      "level": "full",
      "requestedFormat": "PATTERN_RECOGNITION",
      "actualFormat": "PATTERN_RECOGNITION",
      "featuresActive": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "featuresPending": [],
      "isFullyEnhanced": true
    },
    "mathOutput": {
      "operation": "ADDITION",
      "operands": [
        527,
        797,
        322,
        807
      ],
      "result": 2453,
      "intermediate_steps": [
        527,
        1324,
        1646
      ],
      "decimal_formatted": {
        "operands": [
          "527",
          "797",
          "322",
          "807"
        ],
        "result": "2453"
      }
    },
    "generationTime": 1,
    "questionId": "q_1759077175448_ig0rxaa4z",
    "generationSetup": {
      "controller_used": "PATTERN_RECOGNITIONController",
      "format_requested": "PATTERN_RECOGNITION",
      "format_actual": "PATTERN_RECOGNITION",
      "scenario_theme": "SHOPPING",
      "scenario_id": "shop-002-realistic-general",
      "scenario_selection_method": "default",
      "distractor_strategies": [
        "WRONG_OPERATION",
        null,
        "CALCULATION_ERROR"
      ],
      "distractor_count": 3,
      "theme_variety": false,
      "format_variety": false,
      "enhancement_level": "full",
      "features_active": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "features_pending": [],
      "generation_time_ms": 1
    }
  },
  "metadata": {
    "format": "PATTERN_RECOGNITION",
    "cognitive_load": 60,
    "curriculum_alignment": [
      "5N1a",
      "5N1b"
    ],
    "difficulty": "5.3",
    "scenario_theme": "SHOPPING",
    "distractor_strategies": [
      "WRONG_OPERATION",
      null,
      "CALCULATION_ERROR"
    ],
    "generation_time_ms": 1,
    "api_version": "2.0",
    "enhancement_status": "full",
    "format_requested": "PATTERN_RECOGNITION",
    "format_used": "PATTERN_RECOGNITION",
    "features_active": [
      "enhanced_distractors",
      "rich_scenarios",
      "cognitive_load",
      "advanced_formats"
    ],
    "features_pending": []
  },
  "context": {
    "id": "shop-002-realistic-general",
    "theme": "SHOPPING",
    "setting": {
      "location": "local shop",
      "timeContext": "after school",
      "atmosphere": "friendly"
    },
    "characters": [
      {
        "name": "Charlotte",
        "role": "student"
      }
    ],
    "items": [
      {
        "name": "apple",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.2,
          "max": 0.5,
          "typical": 0.35,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "banana",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.15,
          "max": 0.4,
          "typical": 0.25,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "sandwich",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 2.5,
          "max": 6,
          "typical": 4,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "drink",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.8,
          "max": 2.5,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "cake",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 1.5,
          "max": 4,
          "typical": 2.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "biscuit",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.8,
          "max": 2,
          "typical": 1.2,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "sweet",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.1,
          "max": 1,
          "typical": 0.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "chocolate",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.6,
          "max": 3,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "pen",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.5,
          "max": 2,
          "typical": 1,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "pencil",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.2,
          "max": 1,
          "typical": 0.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "ruler",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.8,
          "max": 2.5,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "notebook",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 1,
          "max": 4,
          "typical": 2,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "eraser",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.3,
          "max": 1.5,
          "typical": 0.75,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "book",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 3,
          "max": 15,
          "typical": 8,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "comic",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 2,
          "max": 5,
          "typical": 3,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "magazine",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 2.5,
          "max": 6,
          "typical": 4,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "toy",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 5,
          "max": 25,
          "typical": 12,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "game",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 8,
          "max": 60,
          "typical": 25,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "puzzle",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 5,
          "max": 20,
          "typical": 12,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "sticker",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 0.2,
          "max": 2,
          "typical": 0.8,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "badge",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 0.5,
          "max": 3,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "poster",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 2,
          "max": 8,
          "typical": 4,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "card",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 0.5,
          "max": 4,
          "typical": 2,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      }
    ],
    "culturalElements": [
      {
        "type": "currency",
        "value": "£",
        "explanation": "British pounds"
      },
      {
        "type": "location",
        "value": "UK local shop",
        "explanation": "Typical British corner shop"
      }
    ],
    "realWorldConnection": "Everyday shopping with realistic UK prices",
    "yearAppropriate": [
      1,
      2,
      3,
      4,
      5,
      6
    ],
    "templates": [
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "MULTI_STEP"
        ],
        "modelCompatibility": [
          "ADDITION"
        ],
        "operandCount": 3,
        "template": "{character} buys a {item1} for {price1}, a {item2} for {price2}, and a {item3} for {price3}. What is the total cost?",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item1",
            "type": "item"
          },
          {
            "key": "item2",
            "type": "item"
          },
          {
            "key": "item3",
            "type": "item"
          },
          {
            "key": "price1",
            "type": "value"
          },
          {
            "key": "price2",
            "type": "value"
          },
          {
            "key": "price3",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "MULTI_STEP"
        ],
        "modelCompatibility": [
          "ADDITION"
        ],
        "operandCount": 2,
        "template": "{character} buys a {item1} for {price1} and a {item2} for {price2}. What is the total cost?",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item1",
            "type": "item"
          },
          {
            "key": "item2",
            "type": "item"
          },
          {
            "key": "price1",
            "type": "value"
          },
          {
            "key": "price2",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION"
        ],
        "modelCompatibility": [
          "SUBTRACTION",
          "CHANGE_CALCULATION"
        ],
        "template": "{character} buys a {item} for {price} and pays with {payment}. How much change does {character} get?",
        "answerTemplate": "{character} receives {result} in change",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "price",
            "type": "value"
          },
          {
            "key": "payment",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION"
        ],
        "modelCompatibility": [
          "MULTIPLICATION"
        ],
        "template": "{character} buys {quantity} {item} at {price} each. What is the total cost?",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "quantity",
            "type": "value"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "price",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION"
        ],
        "modelCompatibility": [
          "DIVISION"
        ],
        "template": "{character} has {total} to spend equally on {quantity} {item}. How much can {character} spend on each one?",
        "answerTemplate": "{character} can spend {result} on each {item}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "total",
            "type": "value"
          },
          {
            "key": "quantity",
            "type": "value"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "COMPARISON",
          "ESTIMATION",
          "MULTI_STEP"
        ],
        "template": "{character} goes to the shop and buys {items}. How much does {character} spend in total?",
        "answerTemplate": "{character} spends {result} in total",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "items",
            "type": "item_list"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "ESTIMATION"
        ],
        "template": "Estimate: If {character} buys {items}, about how much will it cost?",
        "answerTemplate": "It will cost approximately {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "items",
            "type": "item_list"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "VALIDATION"
        ],
        "template": "{character} calculated that {items} costs {amount}. Is this correct?",
        "answerTemplate": "{validation_result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "items",
            "type": "item_list"
          },
          {
            "key": "amount",
            "type": "value"
          },
          {
            "key": "validation_result",
            "type": "boolean"
          }
        ]
      }
    ]
  }
}

--- SUITE D: DIFFICULTY PROGRESSION TESTS ---
Testing smooth difficulty increase for the MULTIPLICATION model...
# Test D.1: MULTIPLICATION at difficulty 2.1
{
  "success": true,
  "question": {
    "text": "Charlotte buys 2 apple at £3 each. What is the total cost?",
    "options": [
      {
        "text": "7",
        "value": 7,
        "index": 0
      },
      {
        "text": "1",
        "value": 1,
        "index": 1
      },
      {
        "text": "5",
        "value": 5,
        "index": 2
      },
      {
        "text": "£6.00",
        "value": 6,
        "index": 3
      }
    ],
    "correctIndex": 3,
    "format": "DIRECT_CALCULATION",
    "difficulty": {
      "year": 2,
      "subLevel": 1,
      "displayName": "2.1",
      "cognitiveLoad": 20
    },
    "cognitiveLoad": 20,
    "curriculumTags": [
      "2N1a"
    ],
    "scenario": {
      "id": "shop-002-realistic-general",
      "theme": "SHOPPING",
      "setting": {
        "location": "local shop",
        "timeContext": "after school",
        "atmosphere": "friendly"
      },
      "characters": [
        {
          "name": "Charlotte",
          "role": "student"
        }
      ],
      "items": [
        {
          "name": "apple",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.2,
            "max": 0.5,
            "typical": 0.35,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "banana",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.15,
            "max": 0.4,
            "typical": 0.25,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "sandwich",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 2.5,
            "max": 6,
            "typical": 4,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "drink",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.8,
            "max": 2.5,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "cake",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 1.5,
            "max": 4,
            "typical": 2.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "biscuit",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.8,
            "max": 2,
            "typical": 1.2,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "sweet",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.1,
            "max": 1,
            "typical": 0.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "chocolate",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.6,
            "max": 3,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "pen",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.5,
            "max": 2,
            "typical": 1,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "pencil",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.2,
            "max": 1,
            "typical": 0.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "ruler",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.8,
            "max": 2.5,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "notebook",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 1,
            "max": 4,
            "typical": 2,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "eraser",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.3,
            "max": 1.5,
            "typical": 0.75,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "book",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 3,
            "max": 15,
            "typical": 8,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "comic",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 2,
            "max": 5,
            "typical": 3,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "magazine",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 2.5,
            "max": 6,
            "typical": 4,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "toy",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 5,
            "max": 25,
            "typical": 12,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "game",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 8,
            "max": 60,
            "typical": 25,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "puzzle",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 5,
            "max": 20,
            "typical": 12,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "sticker",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 0.2,
            "max": 2,
            "typical": 0.8,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "badge",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 0.5,
            "max": 3,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "poster",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 2,
            "max": 8,
            "typical": 4,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "card",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 0.5,
            "max": 4,
            "typical": 2,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        }
      ],
      "culturalElements": [
        {
          "type": "currency",
          "value": "£",
          "explanation": "British pounds"
        },
        {
          "type": "location",
          "value": "UK local shop",
          "explanation": "Typical British corner shop"
        }
      ],
      "realWorldConnection": "Everyday shopping with realistic UK prices",
      "yearAppropriate": [
        1,
        2,
        3,
        4,
        5,
        6
      ],
      "templates": [
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "MULTI_STEP"
          ],
          "modelCompatibility": [
            "ADDITION"
          ],
          "operandCount": 3,
          "template": "{character} buys a {item1} for {price1}, a {item2} for {price2}, and a {item3} for {price3}. What is the total cost?",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item1",
              "type": "item"
            },
            {
              "key": "item2",
              "type": "item"
            },
            {
              "key": "item3",
              "type": "item"
            },
            {
              "key": "price1",
              "type": "value"
            },
            {
              "key": "price2",
              "type": "value"
            },
            {
              "key": "price3",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "MULTI_STEP"
          ],
          "modelCompatibility": [
            "ADDITION"
          ],
          "operandCount": 2,
          "template": "{character} buys a {item1} for {price1} and a {item2} for {price2}. What is the total cost?",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item1",
              "type": "item"
            },
            {
              "key": "item2",
              "type": "item"
            },
            {
              "key": "price1",
              "type": "value"
            },
            {
              "key": "price2",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION"
          ],
          "modelCompatibility": [
            "SUBTRACTION",
            "CHANGE_CALCULATION"
          ],
          "template": "{character} buys a {item} for {price} and pays with {payment}. How much change does {character} get?",
          "answerTemplate": "{character} receives {result} in change",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "price",
              "type": "value"
            },
            {
              "key": "payment",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION"
          ],
          "modelCompatibility": [
            "MULTIPLICATION"
          ],
          "template": "{character} buys {quantity} {item} at {price} each. What is the total cost?",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "quantity",
              "type": "value"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "price",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION"
          ],
          "modelCompatibility": [
            "DIVISION"
          ],
          "template": "{character} has {total} to spend equally on {quantity} {item}. How much can {character} spend on each one?",
          "answerTemplate": "{character} can spend {result} on each {item}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "total",
              "type": "value"
            },
            {
              "key": "quantity",
              "type": "value"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "COMPARISON",
            "ESTIMATION",
            "MULTI_STEP"
          ],
          "template": "{character} goes to the shop and buys {items}. How much does {character} spend in total?",
          "answerTemplate": "{character} spends {result} in total",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "items",
              "type": "item_list"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "ESTIMATION"
          ],
          "template": "Estimate: If {character} buys {items}, about how much will it cost?",
          "answerTemplate": "It will cost approximately {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "items",
              "type": "item_list"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "VALIDATION"
          ],
          "template": "{character} calculated that {items} costs {amount}. Is this correct?",
          "answerTemplate": "{validation_result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "items",
              "type": "item_list"
            },
            {
              "key": "amount",
              "type": "value"
            },
            {
              "key": "validation_result",
              "type": "boolean"
            }
          ]
        }
      ]
    },
    "distractors": [
      {
        "value": 5,
        "displayText": "5",
        "strategy": "COMMON_MISCONCEPTION",
        "reasoning": "Counting error"
      },
      {
        "value": 1,
        "displayText": "1",
        "strategy": "WRONG_OPERATION",
        "reasoning": "Subtracted instead of multiplying"
      },
      {
        "value": 7,
        "displayText": "7",
        "strategy": "CLOSE_VALUE",
        "reasoning": "Off by 1"
      }
    ],
    "enhancementStatus": {
      "level": "partial",
      "requestedFormat": "DIRECT_CALCULATION",
      "actualFormat": "DIRECT_CALCULATION",
      "featuresActive": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "featuresPending": [],
      "isFullyEnhanced": true
    },
    "mathOutput": {
      "operation": "MULTIPLICATION",
      "multiplicand": 3,
      "multiplier": 2,
      "result": 6
    },
    "generationTime": 0,
    "questionId": "q_1759077175489_oq8fakap2",
    "generationSetup": {
      "controller_used": "DIRECT_CALCULATIONController",
      "format_requested": "DIRECT_CALCULATION",
      "format_actual": "DIRECT_CALCULATION",
      "scenario_theme": "SHOPPING",
      "scenario_id": "shop-002-realistic-general",
      "scenario_selection_method": "default",
      "distractor_strategies": [
        "COMMON_MISCONCEPTION",
        "WRONG_OPERATION",
        "CLOSE_VALUE"
      ],
      "distractor_count": 3,
      "theme_variety": false,
      "format_variety": false,
      "enhancement_level": "partial",
      "features_active": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "features_pending": [],
      "generation_time_ms": 0
    }
  },
  "metadata": {
    "format": "DIRECT_CALCULATION",
    "cognitive_load": 20,
    "curriculum_alignment": [
      "2N1a"
    ],
    "difficulty": "2.1",
    "scenario_theme": "SHOPPING",
    "distractor_strategies": [
      "COMMON_MISCONCEPTION",
      "WRONG_OPERATION",
      "CLOSE_VALUE"
    ],
    "generation_time_ms": 0,
    "api_version": "2.0",
    "enhancement_status": "partial",
    "format_requested": "DIRECT_CALCULATION",
    "format_used": "DIRECT_CALCULATION",
    "features_active": [
      "enhanced_distractors",
      "rich_scenarios",
      "cognitive_load",
      "advanced_formats"
    ],
    "features_pending": []
  },
  "context": {
    "id": "shop-002-realistic-general",
    "theme": "SHOPPING",
    "setting": {
      "location": "local shop",
      "timeContext": "after school",
      "atmosphere": "friendly"
    },
    "characters": [
      {
        "name": "Charlotte",
        "role": "student"
      }
    ],
    "items": [
      {
        "name": "apple",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.2,
          "max": 0.5,
          "typical": 0.35,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "banana",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.15,
          "max": 0.4,
          "typical": 0.25,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "sandwich",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 2.5,
          "max": 6,
          "typical": 4,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "drink",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.8,
          "max": 2.5,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "cake",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 1.5,
          "max": 4,
          "typical": 2.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "biscuit",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.8,
          "max": 2,
          "typical": 1.2,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "sweet",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.1,
          "max": 1,
          "typical": 0.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "chocolate",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.6,
          "max": 3,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "pen",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.5,
          "max": 2,
          "typical": 1,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "pencil",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.2,
          "max": 1,
          "typical": 0.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "ruler",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.8,
          "max": 2.5,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "notebook",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 1,
          "max": 4,
          "typical": 2,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "eraser",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.3,
          "max": 1.5,
          "typical": 0.75,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "book",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 3,
          "max": 15,
          "typical": 8,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "comic",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 2,
          "max": 5,
          "typical": 3,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "magazine",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 2.5,
          "max": 6,
          "typical": 4,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "toy",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 5,
          "max": 25,
          "typical": 12,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "game",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 8,
          "max": 60,
          "typical": 25,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "puzzle",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 5,
          "max": 20,
          "typical": 12,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "sticker",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 0.2,
          "max": 2,
          "typical": 0.8,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "badge",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 0.5,
          "max": 3,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "poster",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 2,
          "max": 8,
          "typical": 4,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "card",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 0.5,
          "max": 4,
          "typical": 2,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      }
    ],
    "culturalElements": [
      {
        "type": "currency",
        "value": "£",
        "explanation": "British pounds"
      },
      {
        "type": "location",
        "value": "UK local shop",
        "explanation": "Typical British corner shop"
      }
    ],
    "realWorldConnection": "Everyday shopping with realistic UK prices",
    "yearAppropriate": [
      1,
      2,
      3,
      4,
      5,
      6
    ],
    "templates": [
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "MULTI_STEP"
        ],
        "modelCompatibility": [
          "ADDITION"
        ],
        "operandCount": 3,
        "template": "{character} buys a {item1} for {price1}, a {item2} for {price2}, and a {item3} for {price3}. What is the total cost?",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item1",
            "type": "item"
          },
          {
            "key": "item2",
            "type": "item"
          },
          {
            "key": "item3",
            "type": "item"
          },
          {
            "key": "price1",
            "type": "value"
          },
          {
            "key": "price2",
            "type": "value"
          },
          {
            "key": "price3",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "MULTI_STEP"
        ],
        "modelCompatibility": [
          "ADDITION"
        ],
        "operandCount": 2,
        "template": "{character} buys a {item1} for {price1} and a {item2} for {price2}. What is the total cost?",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item1",
            "type": "item"
          },
          {
            "key": "item2",
            "type": "item"
          },
          {
            "key": "price1",
            "type": "value"
          },
          {
            "key": "price2",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION"
        ],
        "modelCompatibility": [
          "SUBTRACTION",
          "CHANGE_CALCULATION"
        ],
        "template": "{character} buys a {item} for {price} and pays with {payment}. How much change does {character} get?",
        "answerTemplate": "{character} receives {result} in change",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "price",
            "type": "value"
          },
          {
            "key": "payment",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION"
        ],
        "modelCompatibility": [
          "MULTIPLICATION"
        ],
        "template": "{character} buys {quantity} {item} at {price} each. What is the total cost?",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "quantity",
            "type": "value"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "price",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION"
        ],
        "modelCompatibility": [
          "DIVISION"
        ],
        "template": "{character} has {total} to spend equally on {quantity} {item}. How much can {character} spend on each one?",
        "answerTemplate": "{character} can spend {result} on each {item}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "total",
            "type": "value"
          },
          {
            "key": "quantity",
            "type": "value"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "COMPARISON",
          "ESTIMATION",
          "MULTI_STEP"
        ],
        "template": "{character} goes to the shop and buys {items}. How much does {character} spend in total?",
        "answerTemplate": "{character} spends {result} in total",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "items",
            "type": "item_list"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "ESTIMATION"
        ],
        "template": "Estimate: If {character} buys {items}, about how much will it cost?",
        "answerTemplate": "It will cost approximately {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "items",
            "type": "item_list"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "VALIDATION"
        ],
        "template": "{character} calculated that {items} costs {amount}. Is this correct?",
        "answerTemplate": "{validation_result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "items",
            "type": "item_list"
          },
          {
            "key": "amount",
            "type": "value"
          },
          {
            "key": "validation_result",
            "type": "boolean"
          }
        ]
      }
    ]
  }
}
# Test D.2: MULTIPLICATION at difficulty 2.4
{
  "success": true,
  "question": {
    "text": "Sarah wants to buy books at the book fair. Calculate the total cost.",
    "options": [
      {
        "text": "£30.00",
        "value": 30,
        "index": 0
      },
      {
        "text": "11",
        "value": 11,
        "index": 1
      },
      {
        "text": "1",
        "value": 1,
        "index": 2
      },
      {
        "text": "40",
        "value": 40,
        "index": 3
      }
    ],
    "correctIndex": 0,
    "format": "DIRECT_CALCULATION",
    "difficulty": {
      "year": 2,
      "subLevel": 4,
      "displayName": "2.4",
      "cognitiveLoad": 35
    },
    "cognitiveLoad": 35,
    "curriculumTags": [
      "2N1a"
    ],
    "scenario": {
      "id": "shop-001-bookfair",
      "theme": "SHOPPING",
      "setting": {
        "location": "school book fair",
        "timeContext": "lunch break",
        "atmosphere": "busy"
      },
      "characters": [
        {
          "name": "Sarah",
          "role": "student"
        },
        {
          "name": "Mr. Johnson",
          "role": "teacher"
        }
      ],
      "items": [
        {
          "name": "book",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 3,
            "max": 12,
            "typical": 6.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "bookmark",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.5,
            "max": 2,
            "typical": 1,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        }
      ],
      "culturalElements": [
        {
          "type": "currency",
          "value": "£",
          "explanation": "British pounds"
        },
        {
          "type": "event",
          "value": "book fair",
          "explanation": "School fundraising event"
        }
      ],
      "realWorldConnection": "School fundraising and reading promotion",
      "yearAppropriate": [
        2,
        3,
        4,
        5
      ],
      "templates": [
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "COMPARISON"
          ],
          "template": "{character} wants to buy books at the book fair. Calculate the total cost.",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        }
      ]
    },
    "distractors": [
      {
        "value": 11,
        "displayText": "11",
        "strategy": "WRONG_OPERATION",
        "reasoning": "Added instead of multiplying"
      },
      {
        "value": 1,
        "displayText": "1",
        "strategy": "WRONG_OPERATION",
        "reasoning": "Subtracted instead of multiplying"
      },
      {
        "value": 40,
        "displayText": "40",
        "strategy": "PLACE_VALUE_ERROR",
        "reasoning": "Error in carrying to next column"
      }
    ],
    "enhancementStatus": {
      "level": "partial",
      "requestedFormat": "DIRECT_CALCULATION",
      "actualFormat": "DIRECT_CALCULATION",
      "featuresActive": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "featuresPending": [],
      "isFullyEnhanced": true
    },
    "mathOutput": {
      "operation": "MULTIPLICATION",
      "multiplicand": 6,
      "multiplier": 5,
      "result": 30
    },
    "generationTime": 0,
    "questionId": "q_1759077175535_xtsv9qual",
    "generationSetup": {
      "controller_used": "DIRECT_CALCULATIONController",
      "format_requested": "DIRECT_CALCULATION",
      "format_actual": "DIRECT_CALCULATION",
      "scenario_theme": "SHOPPING",
      "scenario_id": "shop-001-bookfair",
      "scenario_selection_method": "default",
      "distractor_strategies": [
        "WRONG_OPERATION",
        "WRONG_OPERATION",
        "PLACE_VALUE_ERROR"
      ],
      "distractor_count": 3,
      "theme_variety": false,
      "format_variety": false,
      "enhancement_level": "partial",
      "features_active": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "features_pending": [],
      "generation_time_ms": 0
    }
  },
  "metadata": {
    "format": "DIRECT_CALCULATION",
    "cognitive_load": 35,
    "curriculum_alignment": [
      "2N1a"
    ],
    "difficulty": "2.4",
    "scenario_theme": "SHOPPING",
    "distractor_strategies": [
      "WRONG_OPERATION",
      "WRONG_OPERATION",
      "PLACE_VALUE_ERROR"
    ],
    "generation_time_ms": 0,
    "api_version": "2.0",
    "enhancement_status": "partial",
    "format_requested": "DIRECT_CALCULATION",
    "format_used": "DIRECT_CALCULATION",
    "features_active": [
      "enhanced_distractors",
      "rich_scenarios",
      "cognitive_load",
      "advanced_formats"
    ],
    "features_pending": []
  },
  "context": {
    "id": "shop-001-bookfair",
    "theme": "SHOPPING",
    "setting": {
      "location": "school book fair",
      "timeContext": "lunch break",
      "atmosphere": "busy"
    },
    "characters": [
      {
        "name": "Sarah",
        "role": "student"
      },
      {
        "name": "Mr. Johnson",
        "role": "teacher"
      }
    ],
    "items": [
      {
        "name": "book",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 3,
          "max": 12,
          "typical": 6.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "bookmark",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.5,
          "max": 2,
          "typical": 1,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      }
    ],
    "culturalElements": [
      {
        "type": "currency",
        "value": "£",
        "explanation": "British pounds"
      },
      {
        "type": "event",
        "value": "book fair",
        "explanation": "School fundraising event"
      }
    ],
    "realWorldConnection": "School fundraising and reading promotion",
    "yearAppropriate": [
      2,
      3,
      4,
      5
    ],
    "templates": [
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "COMPARISON"
        ],
        "template": "{character} wants to buy books at the book fair. Calculate the total cost.",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      }
    ]
  }
}
# Test D.3: MULTIPLICATION at difficulty 3.2
{
  "success": true,
  "question": {
    "text": "Sarah wants to buy books at the book fair. Calculate the total cost.",
    "options": [
      {
        "text": "£9.00",
        "value": 9,
        "index": 0
      },
      {
        "text": "10",
        "value": 10,
        "index": 1
      },
      {
        "text": "6",
        "value": 6,
        "index": 2
      },
      {
        "text": "8",
        "value": 8,
        "index": 3
      }
    ],
    "correctIndex": 0,
    "format": "DIRECT_CALCULATION",
    "difficulty": {
      "year": 3,
      "subLevel": 2,
      "displayName": "3.2",
      "cognitiveLoad": 35
    },
    "cognitiveLoad": 35,
    "curriculumTags": [
      "3N1a"
    ],
    "scenario": {
      "id": "shop-001-bookfair",
      "theme": "SHOPPING",
      "setting": {
        "location": "school book fair",
        "timeContext": "lunch break",
        "atmosphere": "busy"
      },
      "characters": [
        {
          "name": "Sarah",
          "role": "student"
        },
        {
          "name": "Mr. Johnson",
          "role": "teacher"
        }
      ],
      "items": [
        {
          "name": "book",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 3,
            "max": 12,
            "typical": 6.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "bookmark",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.5,
            "max": 2,
            "typical": 1,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        }
      ],
      "culturalElements": [
        {
          "type": "currency",
          "value": "£",
          "explanation": "British pounds"
        },
        {
          "type": "event",
          "value": "book fair",
          "explanation": "School fundraising event"
        }
      ],
      "realWorldConnection": "School fundraising and reading promotion",
      "yearAppropriate": [
        2,
        3,
        4,
        5
      ],
      "templates": [
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "COMPARISON"
          ],
          "template": "{character} wants to buy books at the book fair. Calculate the total cost.",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        }
      ]
    },
    "distractors": [
      {
        "value": 6,
        "displayText": "6",
        "strategy": "WRONG_OPERATION",
        "reasoning": "Added instead of multiplying"
      },
      {
        "value": 10,
        "displayText": "10",
        "strategy": "CLOSE_VALUE",
        "reasoning": "Off by 1"
      },
      {
        "value": 8,
        "displayText": "8",
        "strategy": "CLOSE_VALUE",
        "reasoning": "Off by 1"
      }
    ],
    "enhancementStatus": {
      "level": "partial",
      "requestedFormat": "DIRECT_CALCULATION",
      "actualFormat": "DIRECT_CALCULATION",
      "featuresActive": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "featuresPending": [],
      "isFullyEnhanced": true
    },
    "mathOutput": {
      "operation": "MULTIPLICATION",
      "multiplicand": 3,
      "multiplier": 3,
      "result": 9
    },
    "generationTime": 0,
    "questionId": "q_1759077175578_ekg8lcyid",
    "generationSetup": {
      "controller_used": "DIRECT_CALCULATIONController",
      "format_requested": "DIRECT_CALCULATION",
      "format_actual": "DIRECT_CALCULATION",
      "scenario_theme": "SHOPPING",
      "scenario_id": "shop-001-bookfair",
      "scenario_selection_method": "default",
      "distractor_strategies": [
        "WRONG_OPERATION",
        "CLOSE_VALUE",
        "CLOSE_VALUE"
      ],
      "distractor_count": 3,
      "theme_variety": false,
      "format_variety": false,
      "enhancement_level": "partial",
      "features_active": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "features_pending": [],
      "generation_time_ms": 0
    }
  },
  "metadata": {
    "format": "DIRECT_CALCULATION",
    "cognitive_load": 35,
    "curriculum_alignment": [
      "3N1a"
    ],
    "difficulty": "3.2",
    "scenario_theme": "SHOPPING",
    "distractor_strategies": [
      "WRONG_OPERATION",
      "CLOSE_VALUE",
      "CLOSE_VALUE"
    ],
    "generation_time_ms": 0,
    "api_version": "2.0",
    "enhancement_status": "partial",
    "format_requested": "DIRECT_CALCULATION",
    "format_used": "DIRECT_CALCULATION",
    "features_active": [
      "enhanced_distractors",
      "rich_scenarios",
      "cognitive_load",
      "advanced_formats"
    ],
    "features_pending": []
  },
  "context": {
    "id": "shop-001-bookfair",
    "theme": "SHOPPING",
    "setting": {
      "location": "school book fair",
      "timeContext": "lunch break",
      "atmosphere": "busy"
    },
    "characters": [
      {
        "name": "Sarah",
        "role": "student"
      },
      {
        "name": "Mr. Johnson",
        "role": "teacher"
      }
    ],
    "items": [
      {
        "name": "book",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 3,
          "max": 12,
          "typical": 6.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "bookmark",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.5,
          "max": 2,
          "typical": 1,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      }
    ],
    "culturalElements": [
      {
        "type": "currency",
        "value": "£",
        "explanation": "British pounds"
      },
      {
        "type": "event",
        "value": "book fair",
        "explanation": "School fundraising event"
      }
    ],
    "realWorldConnection": "School fundraising and reading promotion",
    "yearAppropriate": [
      2,
      3,
      4,
      5
    ],
    "templates": [
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "COMPARISON"
        ],
        "template": "{character} wants to buy books at the book fair. Calculate the total cost.",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      }
    ]
  }
}
# Test D.4: MULTIPLICATION at difficulty 4.1
{
  "error": "Failed to generate enhanced question",
  "details": "Cannot read properties of undefined (reading 'correctAnswer')",
  "api_version": "2.0"
}
# Test D.5: MULTIPLICATION at difficulty 5.3
{
  "success": true,
  "question": {
    "text": "Charlotte buys 44 apple at £58 each. What is the total cost?",
    "options": [
      {
        "text": "3552",
        "value": 3552,
        "index": 0
      },
      {
        "text": "102",
        "value": 102,
        "index": 1
      },
      {
        "text": "14",
        "value": 14,
        "index": 2
      },
      {
        "text": "£2552.00",
        "value": 2552,
        "index": 3
      }
    ],
    "correctIndex": 3,
    "format": "DIRECT_CALCULATION",
    "difficulty": {
      "year": 5,
      "subLevel": 3,
      "displayName": "5.3",
      "cognitiveLoad": 60
    },
    "cognitiveLoad": 60,
    "curriculumTags": [
      "5N1a"
    ],
    "scenario": {
      "id": "shop-002-realistic-general",
      "theme": "SHOPPING",
      "setting": {
        "location": "local shop",
        "timeContext": "after school",
        "atmosphere": "friendly"
      },
      "characters": [
        {
          "name": "Charlotte",
          "role": "student"
        }
      ],
      "items": [
        {
          "name": "apple",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.2,
            "max": 0.5,
            "typical": 0.35,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "banana",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.15,
            "max": 0.4,
            "typical": 0.25,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "sandwich",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 2.5,
            "max": 6,
            "typical": 4,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "drink",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.8,
            "max": 2.5,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "cake",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 1.5,
            "max": 4,
            "typical": 2.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "biscuit",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.8,
            "max": 2,
            "typical": 1.2,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "sweet",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.1,
            "max": 1,
            "typical": 0.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "chocolate",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.6,
            "max": 3,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "pen",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.5,
            "max": 2,
            "typical": 1,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "pencil",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.2,
            "max": 1,
            "typical": 0.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "ruler",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.8,
            "max": 2.5,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "notebook",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 1,
            "max": 4,
            "typical": 2,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "eraser",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.3,
            "max": 1.5,
            "typical": 0.75,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "book",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 3,
            "max": 15,
            "typical": 8,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "comic",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 2,
            "max": 5,
            "typical": 3,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "magazine",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 2.5,
            "max": 6,
            "typical": 4,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "toy",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 5,
            "max": 25,
            "typical": 12,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "game",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 8,
            "max": 60,
            "typical": 25,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "puzzle",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 5,
            "max": 20,
            "typical": 12,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "sticker",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 0.2,
            "max": 2,
            "typical": 0.8,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "badge",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 0.5,
            "max": 3,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "poster",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 2,
            "max": 8,
            "typical": 4,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "card",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 0.5,
            "max": 4,
            "typical": 2,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        }
      ],
      "culturalElements": [
        {
          "type": "currency",
          "value": "£",
          "explanation": "British pounds"
        },
        {
          "type": "location",
          "value": "UK local shop",
          "explanation": "Typical British corner shop"
        }
      ],
      "realWorldConnection": "Everyday shopping with realistic UK prices",
      "yearAppropriate": [
        1,
        2,
        3,
        4,
        5,
        6
      ],
      "templates": [
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "MULTI_STEP"
          ],
          "modelCompatibility": [
            "ADDITION"
          ],
          "operandCount": 3,
          "template": "{character} buys a {item1} for {price1}, a {item2} for {price2}, and a {item3} for {price3}. What is the total cost?",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item1",
              "type": "item"
            },
            {
              "key": "item2",
              "type": "item"
            },
            {
              "key": "item3",
              "type": "item"
            },
            {
              "key": "price1",
              "type": "value"
            },
            {
              "key": "price2",
              "type": "value"
            },
            {
              "key": "price3",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "MULTI_STEP"
          ],
          "modelCompatibility": [
            "ADDITION"
          ],
          "operandCount": 2,
          "template": "{character} buys a {item1} for {price1} and a {item2} for {price2}. What is the total cost?",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item1",
              "type": "item"
            },
            {
              "key": "item2",
              "type": "item"
            },
            {
              "key": "price1",
              "type": "value"
            },
            {
              "key": "price2",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION"
          ],
          "modelCompatibility": [
            "SUBTRACTION",
            "CHANGE_CALCULATION"
          ],
          "template": "{character} buys a {item} for {price} and pays with {payment}. How much change does {character} get?",
          "answerTemplate": "{character} receives {result} in change",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "price",
              "type": "value"
            },
            {
              "key": "payment",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION"
          ],
          "modelCompatibility": [
            "MULTIPLICATION"
          ],
          "template": "{character} buys {quantity} {item} at {price} each. What is the total cost?",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "quantity",
              "type": "value"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "price",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION"
          ],
          "modelCompatibility": [
            "DIVISION"
          ],
          "template": "{character} has {total} to spend equally on {quantity} {item}. How much can {character} spend on each one?",
          "answerTemplate": "{character} can spend {result} on each {item}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "total",
              "type": "value"
            },
            {
              "key": "quantity",
              "type": "value"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "COMPARISON",
            "ESTIMATION",
            "MULTI_STEP"
          ],
          "template": "{character} goes to the shop and buys {items}. How much does {character} spend in total?",
          "answerTemplate": "{character} spends {result} in total",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "items",
              "type": "item_list"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "ESTIMATION"
          ],
          "template": "Estimate: If {character} buys {items}, about how much will it cost?",
          "answerTemplate": "It will cost approximately {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "items",
              "type": "item_list"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "VALIDATION"
          ],
          "template": "{character} calculated that {items} costs {amount}. Is this correct?",
          "answerTemplate": "{validation_result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "items",
              "type": "item_list"
            },
            {
              "key": "amount",
              "type": "value"
            },
            {
              "key": "validation_result",
              "type": "boolean"
            }
          ]
        }
      ]
    },
    "distractors": [
      {
        "value": 102,
        "displayText": "102",
        "strategy": "WRONG_OPERATION",
        "reasoning": "Added instead of multiplying"
      },
      {
        "value": 14,
        "displayText": "14",
        "strategy": "WRONG_OPERATION",
        "reasoning": "Subtracted instead of multiplying"
      },
      {
        "value": 3552,
        "displayText": "3552",
        "strategy": "PLACE_VALUE_ERROR",
        "reasoning": "Error in carrying to next column"
      }
    ],
    "enhancementStatus": {
      "level": "partial",
      "requestedFormat": "DIRECT_CALCULATION",
      "actualFormat": "DIRECT_CALCULATION",
      "featuresActive": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "featuresPending": [],
      "isFullyEnhanced": true
    },
    "mathOutput": {
      "operation": "MULTIPLICATION",
      "multiplicand": 58,
      "multiplier": 44,
      "result": 2552
    },
    "generationTime": 0,
    "questionId": "q_1759077175775_630rbwfh8",
    "generationSetup": {
      "controller_used": "DIRECT_CALCULATIONController",
      "format_requested": "DIRECT_CALCULATION",
      "format_actual": "DIRECT_CALCULATION",
      "scenario_theme": "SHOPPING",
      "scenario_id": "shop-002-realistic-general",
      "scenario_selection_method": "default",
      "distractor_strategies": [
        "WRONG_OPERATION",
        "WRONG_OPERATION",
        "PLACE_VALUE_ERROR"
      ],
      "distractor_count": 3,
      "theme_variety": false,
      "format_variety": false,
      "enhancement_level": "partial",
      "features_active": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "features_pending": [],
      "generation_time_ms": 0
    }
  },
  "metadata": {
    "format": "DIRECT_CALCULATION",
    "cognitive_load": 60,
    "curriculum_alignment": [
      "5N1a"
    ],
    "difficulty": "5.3",
    "scenario_theme": "SHOPPING",
    "distractor_strategies": [
      "WRONG_OPERATION",
      "WRONG_OPERATION",
      "PLACE_VALUE_ERROR"
    ],
    "generation_time_ms": 0,
    "api_version": "2.0",
    "enhancement_status": "partial",
    "format_requested": "DIRECT_CALCULATION",
    "format_used": "DIRECT_CALCULATION",
    "features_active": [
      "enhanced_distractors",
      "rich_scenarios",
      "cognitive_load",
      "advanced_formats"
    ],
    "features_pending": []
  },
  "context": {
    "id": "shop-002-realistic-general",
    "theme": "SHOPPING",
    "setting": {
      "location": "local shop",
      "timeContext": "after school",
      "atmosphere": "friendly"
    },
    "characters": [
      {
        "name": "Charlotte",
        "role": "student"
      }
    ],
    "items": [
      {
        "name": "apple",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.2,
          "max": 0.5,
          "typical": 0.35,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "banana",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.15,
          "max": 0.4,
          "typical": 0.25,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "sandwich",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 2.5,
          "max": 6,
          "typical": 4,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "drink",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.8,
          "max": 2.5,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "cake",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 1.5,
          "max": 4,
          "typical": 2.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "biscuit",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.8,
          "max": 2,
          "typical": 1.2,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "sweet",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.1,
          "max": 1,
          "typical": 0.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "chocolate",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.6,
          "max": 3,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "pen",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.5,
          "max": 2,
          "typical": 1,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "pencil",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.2,
          "max": 1,
          "typical": 0.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "ruler",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.8,
          "max": 2.5,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "notebook",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 1,
          "max": 4,
          "typical": 2,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "eraser",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.3,
          "max": 1.5,
          "typical": 0.75,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "book",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 3,
          "max": 15,
          "typical": 8,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "comic",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 2,
          "max": 5,
          "typical": 3,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "magazine",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 2.5,
          "max": 6,
          "typical": 4,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "toy",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 5,
          "max": 25,
          "typical": 12,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "game",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 8,
          "max": 60,
          "typical": 25,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "puzzle",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 5,
          "max": 20,
          "typical": 12,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "sticker",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 0.2,
          "max": 2,
          "typical": 0.8,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "badge",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 0.5,
          "max": 3,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "poster",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 2,
          "max": 8,
          "typical": 4,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "card",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 0.5,
          "max": 4,
          "typical": 2,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      }
    ],
    "culturalElements": [
      {
        "type": "currency",
        "value": "£",
        "explanation": "British pounds"
      },
      {
        "type": "location",
        "value": "UK local shop",
        "explanation": "Typical British corner shop"
      }
    ],
    "realWorldConnection": "Everyday shopping with realistic UK prices",
    "yearAppropriate": [
      1,
      2,
      3,
      4,
      5,
      6
    ],
    "templates": [
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "MULTI_STEP"
        ],
        "modelCompatibility": [
          "ADDITION"
        ],
        "operandCount": 3,
        "template": "{character} buys a {item1} for {price1}, a {item2} for {price2}, and a {item3} for {price3}. What is the total cost?",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item1",
            "type": "item"
          },
          {
            "key": "item2",
            "type": "item"
          },
          {
            "key": "item3",
            "type": "item"
          },
          {
            "key": "price1",
            "type": "value"
          },
          {
            "key": "price2",
            "type": "value"
          },
          {
            "key": "price3",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "MULTI_STEP"
        ],
        "modelCompatibility": [
          "ADDITION"
        ],
        "operandCount": 2,
        "template": "{character} buys a {item1} for {price1} and a {item2} for {price2}. What is the total cost?",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item1",
            "type": "item"
          },
          {
            "key": "item2",
            "type": "item"
          },
          {
            "key": "price1",
            "type": "value"
          },
          {
            "key": "price2",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION"
        ],
        "modelCompatibility": [
          "SUBTRACTION",
          "CHANGE_CALCULATION"
        ],
        "template": "{character} buys a {item} for {price} and pays with {payment}. How much change does {character} get?",
        "answerTemplate": "{character} receives {result} in change",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "price",
            "type": "value"
          },
          {
            "key": "payment",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION"
        ],
        "modelCompatibility": [
          "MULTIPLICATION"
        ],
        "template": "{character} buys {quantity} {item} at {price} each. What is the total cost?",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "quantity",
            "type": "value"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "price",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION"
        ],
        "modelCompatibility": [
          "DIVISION"
        ],
        "template": "{character} has {total} to spend equally on {quantity} {item}. How much can {character} spend on each one?",
        "answerTemplate": "{character} can spend {result} on each {item}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "total",
            "type": "value"
          },
          {
            "key": "quantity",
            "type": "value"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "COMPARISON",
          "ESTIMATION",
          "MULTI_STEP"
        ],
        "template": "{character} goes to the shop and buys {items}. How much does {character} spend in total?",
        "answerTemplate": "{character} spends {result} in total",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "items",
            "type": "item_list"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "ESTIMATION"
        ],
        "template": "Estimate: If {character} buys {items}, about how much will it cost?",
        "answerTemplate": "It will cost approximately {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "items",
            "type": "item_list"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "VALIDATION"
        ],
        "template": "{character} calculated that {items} costs {amount}. Is this correct?",
        "answerTemplate": "{validation_result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "items",
            "type": "item_list"
          },
          {
            "key": "amount",
            "type": "value"
          },
          {
            "key": "validation_result",
            "type": "boolean"
          }
        ]
      }
    ]
  }
}
# Test D.6: MULTIPLICATION at difficulty 6.4
{
  "success": true,
  "question": {
    "text": "Charlotte is multiplying £510.00 × 132. Round the result to the nearest hundreds.",
    "options": [
      {
        "text": "202000",
        "value": 202000,
        "index": 0
      },
      {
        "text": "£202000.00",
        "value": 202000,
        "index": 1
      },
      {
        "text": "201960",
        "value": 201960,
        "index": 2
      },
      {
        "text": "201900",
        "value": 201900,
        "index": 3
      }
    ],
    "correctIndex": 0,
    "questionContent": {
      "fullText": "Charlotte is multiplying £510.00 × 132. Round the result to the nearest hundreds.",
      "templateData": {
        "character": "Charlotte",
        "operation": "is multiplying £510.00 × 132",
        "roundingPlace": "hundreds",
        "exactValue": "201960",
        "roundedValue": "202000"
      }
    },
    "format": "ESTIMATION",
    "difficulty": {
      "year": 6,
      "subLevel": 4,
      "displayName": "6.4",
      "cognitiveLoad": 75
    },
    "cognitiveLoad": 75,
    "curriculumTags": [
      "6N1a"
    ],
    "scenario": {
      "id": "shop-002-realistic-general",
      "theme": "SHOPPING",
      "setting": {
        "location": "local shop",
        "timeContext": "after school",
        "atmosphere": "friendly"
      },
      "characters": [
        {
          "name": "Charlotte",
          "role": "student"
        }
      ],
      "items": [
        {
          "name": "apple",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.2,
            "max": 0.5,
            "typical": 0.35,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "banana",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.15,
            "max": 0.4,
            "typical": 0.25,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "sandwich",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 2.5,
            "max": 6,
            "typical": 4,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "drink",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.8,
            "max": 2.5,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "cake",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 1.5,
            "max": 4,
            "typical": 2.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "biscuit",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.8,
            "max": 2,
            "typical": 1.2,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "sweet",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.1,
            "max": 1,
            "typical": 0.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "chocolate",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.6,
            "max": 3,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "pen",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.5,
            "max": 2,
            "typical": 1,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "pencil",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.2,
            "max": 1,
            "typical": 0.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "ruler",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.8,
            "max": 2.5,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "notebook",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 1,
            "max": 4,
            "typical": 2,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "eraser",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.3,
            "max": 1.5,
            "typical": 0.75,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "book",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 3,
            "max": 15,
            "typical": 8,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "comic",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 2,
            "max": 5,
            "typical": 3,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "magazine",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 2.5,
            "max": 6,
            "typical": 4,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "toy",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 5,
            "max": 25,
            "typical": 12,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "game",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 8,
            "max": 60,
            "typical": 25,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "puzzle",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 5,
            "max": 20,
            "typical": 12,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "sticker",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 0.2,
            "max": 2,
            "typical": 0.8,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "badge",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 0.5,
            "max": 3,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "poster",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 2,
            "max": 8,
            "typical": 4,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "card",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 0.5,
            "max": 4,
            "typical": 2,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        }
      ],
      "culturalElements": [
        {
          "type": "currency",
          "value": "£",
          "explanation": "British pounds"
        },
        {
          "type": "location",
          "value": "UK local shop",
          "explanation": "Typical British corner shop"
        }
      ],
      "realWorldConnection": "Everyday shopping with realistic UK prices",
      "yearAppropriate": [
        1,
        2,
        3,
        4,
        5,
        6
      ],
      "templates": [
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "MULTI_STEP"
          ],
          "modelCompatibility": [
            "ADDITION"
          ],
          "operandCount": 3,
          "template": "{character} buys a {item1} for {price1}, a {item2} for {price2}, and a {item3} for {price3}. What is the total cost?",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item1",
              "type": "item"
            },
            {
              "key": "item2",
              "type": "item"
            },
            {
              "key": "item3",
              "type": "item"
            },
            {
              "key": "price1",
              "type": "value"
            },
            {
              "key": "price2",
              "type": "value"
            },
            {
              "key": "price3",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "MULTI_STEP"
          ],
          "modelCompatibility": [
            "ADDITION"
          ],
          "operandCount": 2,
          "template": "{character} buys a {item1} for {price1} and a {item2} for {price2}. What is the total cost?",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item1",
              "type": "item"
            },
            {
              "key": "item2",
              "type": "item"
            },
            {
              "key": "price1",
              "type": "value"
            },
            {
              "key": "price2",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION"
          ],
          "modelCompatibility": [
            "SUBTRACTION",
            "CHANGE_CALCULATION"
          ],
          "template": "{character} buys a {item} for {price} and pays with {payment}. How much change does {character} get?",
          "answerTemplate": "{character} receives {result} in change",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "price",
              "type": "value"
            },
            {
              "key": "payment",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION"
          ],
          "modelCompatibility": [
            "MULTIPLICATION"
          ],
          "template": "{character} buys {quantity} {item} at {price} each. What is the total cost?",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "quantity",
              "type": "value"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "price",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION"
          ],
          "modelCompatibility": [
            "DIVISION"
          ],
          "template": "{character} has {total} to spend equally on {quantity} {item}. How much can {character} spend on each one?",
          "answerTemplate": "{character} can spend {result} on each {item}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "total",
              "type": "value"
            },
            {
              "key": "quantity",
              "type": "value"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "COMPARISON",
            "ESTIMATION",
            "MULTI_STEP"
          ],
          "template": "{character} goes to the shop and buys {items}. How much does {character} spend in total?",
          "answerTemplate": "{character} spends {result} in total",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "items",
              "type": "item_list"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "ESTIMATION"
          ],
          "template": "Estimate: If {character} buys {items}, about how much will it cost?",
          "answerTemplate": "It will cost approximately {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "items",
              "type": "item_list"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "VALIDATION"
          ],
          "template": "{character} calculated that {items} costs {amount}. Is this correct?",
          "answerTemplate": "{validation_result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "items",
              "type": "item_list"
            },
            {
              "key": "amount",
              "type": "value"
            },
            {
              "key": "validation_result",
              "type": "boolean"
            }
          ]
        }
      ]
    },
    "distractors": [
      {
        "value": 201960,
        "strategy": "WRONG_OPERATION",
        "rationale": "Rounded to wrong place value"
      },
      {
        "value": 201900,
        "rationale": "Truncated instead of rounded"
      },
      {
        "value": 202000,
        "rationale": "Always rounded up"
      }
    ],
    "enhancementStatus": {
      "level": "full",
      "requestedFormat": "ESTIMATION",
      "actualFormat": "ESTIMATION",
      "featuresActive": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "featuresPending": [],
      "isFullyEnhanced": true
    },
    "mathOutput": {
      "operation": "MULTIPLICATION",
      "multiplicand": 510,
      "multiplier": 132,
      "result": 201960,
      "factors": [
        510,
        132,
        3
      ],
      "decimal_formatted": {
        "operands": [
          "510",
          "132",
          "3"
        ],
        "result": "201960"
      },
      "exactValue": 201960,
      "roundedValue": 202000
    },
    "generationTime": 0,
    "questionId": "q_1759077175816_kuhdmelzo",
    "generationSetup": {
      "controller_used": "ESTIMATIONController",
      "format_requested": "ESTIMATION",
      "format_actual": "ESTIMATION",
      "scenario_theme": "SHOPPING",
      "scenario_id": "shop-002-realistic-general",
      "scenario_selection_method": "default",
      "distractor_strategies": [
        "WRONG_OPERATION",
        null,
        null
      ],
      "distractor_count": 3,
      "theme_variety": false,
      "format_variety": false,
      "enhancement_level": "full",
      "features_active": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "features_pending": [],
      "generation_time_ms": 0
    }
  },
  "metadata": {
    "format": "ESTIMATION",
    "cognitive_load": 75,
    "curriculum_alignment": [
      "6N1a"
    ],
    "difficulty": "6.4",
    "scenario_theme": "SHOPPING",
    "distractor_strategies": [
      "WRONG_OPERATION",
      null,
      null
    ],
    "generation_time_ms": 0,
    "api_version": "2.0",
    "enhancement_status": "full",
    "format_requested": "ESTIMATION",
    "format_used": "ESTIMATION",
    "features_active": [
      "enhanced_distractors",
      "rich_scenarios",
      "cognitive_load",
      "advanced_formats"
    ],
    "features_pending": []
  },
  "context": {
    "id": "shop-002-realistic-general",
    "theme": "SHOPPING",
    "setting": {
      "location": "local shop",
      "timeContext": "after school",
      "atmosphere": "friendly"
    },
    "characters": [
      {
        "name": "Charlotte",
        "role": "student"
      }
    ],
    "items": [
      {
        "name": "apple",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.2,
          "max": 0.5,
          "typical": 0.35,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "banana",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.15,
          "max": 0.4,
          "typical": 0.25,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "sandwich",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 2.5,
          "max": 6,
          "typical": 4,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "drink",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.8,
          "max": 2.5,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "cake",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 1.5,
          "max": 4,
          "typical": 2.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "biscuit",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.8,
          "max": 2,
          "typical": 1.2,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "sweet",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.1,
          "max": 1,
          "typical": 0.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "chocolate",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.6,
          "max": 3,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "pen",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.5,
          "max": 2,
          "typical": 1,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "pencil",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.2,
          "max": 1,
          "typical": 0.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "ruler",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.8,
          "max": 2.5,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "notebook",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 1,
          "max": 4,
          "typical": 2,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "eraser",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.3,
          "max": 1.5,
          "typical": 0.75,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "book",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 3,
          "max": 15,
          "typical": 8,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "comic",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 2,
          "max": 5,
          "typical": 3,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "magazine",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 2.5,
          "max": 6,
          "typical": 4,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "toy",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 5,
          "max": 25,
          "typical": 12,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "game",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 8,
          "max": 60,
          "typical": 25,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "puzzle",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 5,
          "max": 20,
          "typical": 12,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "sticker",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 0.2,
          "max": 2,
          "typical": 0.8,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "badge",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 0.5,
          "max": 3,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "poster",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 2,
          "max": 8,
          "typical": 4,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "card",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 0.5,
          "max": 4,
          "typical": 2,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      }
    ],
    "culturalElements": [
      {
        "type": "currency",
        "value": "£",
        "explanation": "British pounds"
      },
      {
        "type": "location",
        "value": "UK local shop",
        "explanation": "Typical British corner shop"
      }
    ],
    "realWorldConnection": "Everyday shopping with realistic UK prices",
    "yearAppropriate": [
      1,
      2,
      3,
      4,
      5,
      6
    ],
    "templates": [
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "MULTI_STEP"
        ],
        "modelCompatibility": [
          "ADDITION"
        ],
        "operandCount": 3,
        "template": "{character} buys a {item1} for {price1}, a {item2} for {price2}, and a {item3} for {price3}. What is the total cost?",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item1",
            "type": "item"
          },
          {
            "key": "item2",
            "type": "item"
          },
          {
            "key": "item3",
            "type": "item"
          },
          {
            "key": "price1",
            "type": "value"
          },
          {
            "key": "price2",
            "type": "value"
          },
          {
            "key": "price3",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "MULTI_STEP"
        ],
        "modelCompatibility": [
          "ADDITION"
        ],
        "operandCount": 2,
        "template": "{character} buys a {item1} for {price1} and a {item2} for {price2}. What is the total cost?",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item1",
            "type": "item"
          },
          {
            "key": "item2",
            "type": "item"
          },
          {
            "key": "price1",
            "type": "value"
          },
          {
            "key": "price2",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION"
        ],
        "modelCompatibility": [
          "SUBTRACTION",
          "CHANGE_CALCULATION"
        ],
        "template": "{character} buys a {item} for {price} and pays with {payment}. How much change does {character} get?",
        "answerTemplate": "{character} receives {result} in change",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "price",
            "type": "value"
          },
          {
            "key": "payment",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION"
        ],
        "modelCompatibility": [
          "MULTIPLICATION"
        ],
        "template": "{character} buys {quantity} {item} at {price} each. What is the total cost?",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "quantity",
            "type": "value"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "price",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION"
        ],
        "modelCompatibility": [
          "DIVISION"
        ],
        "template": "{character} has {total} to spend equally on {quantity} {item}. How much can {character} spend on each one?",
        "answerTemplate": "{character} can spend {result} on each {item}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "total",
            "type": "value"
          },
          {
            "key": "quantity",
            "type": "value"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "COMPARISON",
          "ESTIMATION",
          "MULTI_STEP"
        ],
        "template": "{character} goes to the shop and buys {items}. How much does {character} spend in total?",
        "answerTemplate": "{character} spends {result} in total",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "items",
            "type": "item_list"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "ESTIMATION"
        ],
        "template": "Estimate: If {character} buys {items}, about how much will it cost?",
        "answerTemplate": "It will cost approximately {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "items",
            "type": "item_list"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "VALIDATION"
        ],
        "template": "{character} calculated that {items} costs {amount}. Is this correct?",
        "answerTemplate": "{validation_result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "items",
            "type": "item_list"
          },
          {
            "key": "amount",
            "type": "value"
          },
          {
            "key": "validation_result",
            "type": "boolean"
          }
        ]
      }
    ]
  }
}

--- SUITE E: SCENARIO THEME TESTS ---
Testing that each scenario theme can be applied...
# Test E.1: SHOPPING theme
{
  "success": true,
  "question": {
    "text": "Sarah wants to buy books at the book fair. Calculate the total cost.",
    "options": [
      {
        "text": "£42.00",
        "value": 42,
        "index": 0
      },
      {
        "text": "414",
        "value": 414,
        "index": 1
      },
      {
        "text": "52",
        "value": 52,
        "index": 2
      }
    ],
    "correctIndex": 0,
    "format": "DIRECT_CALCULATION",
    "difficulty": {
      "year": 3,
      "subLevel": 1,
      "displayName": "3.1",
      "cognitiveLoad": 30
    },
    "cognitiveLoad": 30,
    "curriculumTags": [
      "3N1a",
      "3N1b"
    ],
    "scenario": {
      "id": "shop-001-bookfair",
      "theme": "SHOPPING",
      "setting": {
        "location": "school book fair",
        "timeContext": "lunch break",
        "atmosphere": "busy"
      },
      "characters": [
        {
          "name": "Sarah",
          "role": "student"
        },
        {
          "name": "Mr. Johnson",
          "role": "teacher"
        }
      ],
      "items": [
        {
          "name": "book",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 3,
            "max": 12,
            "typical": 6.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "bookmark",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.5,
            "max": 2,
            "typical": 1,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        }
      ],
      "culturalElements": [
        {
          "type": "currency",
          "value": "£",
          "explanation": "British pounds"
        },
        {
          "type": "event",
          "value": "book fair",
          "explanation": "School fundraising event"
        }
      ],
      "realWorldConnection": "School fundraising and reading promotion",
      "yearAppropriate": [
        2,
        3,
        4,
        5
      ],
      "templates": [
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "COMPARISON"
          ],
          "template": "{character} wants to buy books at the book fair. Calculate the total cost.",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        }
      ]
    },
    "distractors": [
      {
        "value": 414,
        "displayText": "414",
        "strategy": "WRONG_OPERATION",
        "reasoning": "Multiplied instead of adding"
      },
      {
        "value": 52,
        "displayText": "52",
        "strategy": "PLACE_VALUE_ERROR",
        "reasoning": "Error in carrying to next column"
      }
    ],
    "enhancementStatus": {
      "level": "partial",
      "requestedFormat": "DIRECT_CALCULATION",
      "actualFormat": "DIRECT_CALCULATION",
      "featuresActive": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "featuresPending": [],
      "isFullyEnhanced": true
    },
    "mathOutput": {
      "operation": "ADDITION",
      "operand_1": 18,
      "operand_2": 23,
      "operand_3": 1,
      "result": 42
    },
    "generationTime": 1,
    "questionId": "q_1759077175862_fz8sdld0o",
    "generationSetup": {
      "controller_used": "DIRECT_CALCULATIONController",
      "format_requested": "DIRECT_CALCULATION",
      "format_actual": "DIRECT_CALCULATION",
      "scenario_theme": "SHOPPING",
      "scenario_id": "shop-001-bookfair",
      "scenario_selection_method": "requested",
      "distractor_strategies": [
        "WRONG_OPERATION",
        "PLACE_VALUE_ERROR"
      ],
      "distractor_count": 2,
      "theme_variety": false,
      "format_variety": false,
      "enhancement_level": "partial",
      "features_active": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "features_pending": [],
      "generation_time_ms": 1
    }
  },
  "metadata": {
    "format": "DIRECT_CALCULATION",
    "cognitive_load": 30,
    "curriculum_alignment": [
      "3N1a",
      "3N1b"
    ],
    "difficulty": "3.1",
    "scenario_theme": "SHOPPING",
    "distractor_strategies": [
      "WRONG_OPERATION",
      "PLACE_VALUE_ERROR"
    ],
    "generation_time_ms": 1,
    "api_version": "2.0",
    "enhancement_status": "partial",
    "format_requested": "DIRECT_CALCULATION",
    "format_used": "DIRECT_CALCULATION",
    "features_active": [
      "enhanced_distractors",
      "rich_scenarios",
      "cognitive_load",
      "advanced_formats"
    ],
    "features_pending": []
  },
  "context": {
    "id": "shop-001-bookfair",
    "theme": "SHOPPING",
    "setting": {
      "location": "school book fair",
      "timeContext": "lunch break",
      "atmosphere": "busy"
    },
    "characters": [
      {
        "name": "Sarah",
        "role": "student"
      },
      {
        "name": "Mr. Johnson",
        "role": "teacher"
      }
    ],
    "items": [
      {
        "name": "book",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 3,
          "max": 12,
          "typical": 6.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "bookmark",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.5,
          "max": 2,
          "typical": 1,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      }
    ],
    "culturalElements": [
      {
        "type": "currency",
        "value": "£",
        "explanation": "British pounds"
      },
      {
        "type": "event",
        "value": "book fair",
        "explanation": "School fundraising event"
      }
    ],
    "realWorldConnection": "School fundraising and reading promotion",
    "yearAppropriate": [
      2,
      3,
      4,
      5
    ],
    "templates": [
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "COMPARISON"
        ],
        "template": "{character} wants to buy books at the book fair. Calculate the total cost.",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      }
    ]
  }
}
# Test E.2: COOKING theme
{
  "success": true,
  "question": {
    "text": "Mia is making cake. The ingredients cost £5, £31, £22. What is the total cost?",
    "options": [
      {
        "text": "£58.00",
        "value": 58,
        "index": 0
      },
      {
        "text": "36",
        "value": 36,
        "index": 1
      },
      {
        "text": "68",
        "value": 68,
        "index": 2
      },
      {
        "text": "155",
        "value": 155,
        "index": 3
      }
    ],
    "correctIndex": 0,
    "format": "DIRECT_CALCULATION",
    "difficulty": {
      "year": 3,
      "subLevel": 1,
      "displayName": "3.1",
      "cognitiveLoad": 30
    },
    "cognitiveLoad": 30,
    "curriculumTags": [
      "3N1a",
      "3N1b"
    ],
    "scenario": {
      "id": "cooking-3-1759077175904",
      "theme": "COOKING",
      "setting": {
        "location": "kitchen",
        "timeContext": "weekend baking",
        "atmosphere": "creative"
      },
      "characters": [
        {
          "name": "Mia",
          "role": "student"
        },
        {
          "name": "Mum",
          "role": "parent"
        }
      ],
      "items": [
        {
          "name": "flour",
          "category": "FOOD_ITEMS",
          "typicalValue": {
            "min": 1,
            "max": 5,
            "typical": 2.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "eggs",
          "category": "FOOD_ITEMS",
          "typicalValue": {
            "min": 1,
            "max": 5,
            "typical": 2.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "butter",
          "category": "FOOD_ITEMS",
          "typicalValue": {
            "min": 1,
            "max": 5,
            "typical": 2.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "sugar",
          "category": "FOOD_ITEMS",
          "typicalValue": {
            "min": 1,
            "max": 5,
            "typical": 2.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "milk",
          "category": "FOOD_ITEMS",
          "typicalValue": {
            "min": 1,
            "max": 5,
            "typical": 2.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "chocolate chips",
          "category": "FOOD_ITEMS",
          "typicalValue": {
            "min": 1,
            "max": 5,
            "typical": 2.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        }
      ],
      "culturalElements": [
        {
          "type": "currency",
          "value": "£",
          "explanation": "British pounds"
        },
        {
          "type": "measurement",
          "value": "grams",
          "explanation": "Weight measurement for ingredients"
        }
      ],
      "realWorldConnection": "Following recipes and calculating ingredient costs",
      "yearAppropriate": [
        3
      ],
      "templates": [
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "MULTI_STEP"
          ],
          "template": "{character} is making {recipe}. The ingredients cost {prices}. What is the total cost?",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "recipe",
              "type": "item"
            },
            {
              "key": "prices",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        }
      ]
    },
    "distractors": [
      {
        "value": 155,
        "displayText": "155",
        "strategy": "WRONG_OPERATION",
        "reasoning": "Multiplied instead of adding"
      },
      {
        "value": 68,
        "displayText": "68",
        "strategy": "PLACE_VALUE_ERROR",
        "reasoning": "Error in carrying to next column"
      },
      {
        "value": 36,
        "displayText": "36",
        "strategy": "PARTIAL_CALCULATION",
        "reasoning": "Stopped calculation early"
      }
    ],
    "enhancementStatus": {
      "level": "partial",
      "requestedFormat": "DIRECT_CALCULATION",
      "actualFormat": "DIRECT_CALCULATION",
      "featuresActive": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "featuresPending": [],
      "isFullyEnhanced": true
    },
    "mathOutput": {
      "operation": "ADDITION",
      "operand_1": 5,
      "operand_2": 31,
      "operand_3": 22,
      "result": 58
    },
    "generationTime": 0,
    "questionId": "q_1759077175904_ki6sjoumx",
    "generationSetup": {
      "controller_used": "DIRECT_CALCULATIONController",
      "format_requested": "DIRECT_CALCULATION",
      "format_actual": "DIRECT_CALCULATION",
      "scenario_theme": "COOKING",
      "scenario_id": "cooking-3-1759077175904",
      "scenario_selection_method": "requested",
      "distractor_strategies": [
        "WRONG_OPERATION",
        "PLACE_VALUE_ERROR",
        "PARTIAL_CALCULATION"
      ],
      "distractor_count": 3,
      "theme_variety": false,
      "format_variety": false,
      "enhancement_level": "partial",
      "features_active": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "features_pending": [],
      "generation_time_ms": 0
    }
  },
  "metadata": {
    "format": "DIRECT_CALCULATION",
    "cognitive_load": 30,
    "curriculum_alignment": [
      "3N1a",
      "3N1b"
    ],
    "difficulty": "3.1",
    "scenario_theme": "COOKING",
    "distractor_strategies": [
      "WRONG_OPERATION",
      "PLACE_VALUE_ERROR",
      "PARTIAL_CALCULATION"
    ],
    "generation_time_ms": 0,
    "api_version": "2.0",
    "enhancement_status": "partial",
    "format_requested": "DIRECT_CALCULATION",
    "format_used": "DIRECT_CALCULATION",
    "features_active": [
      "enhanced_distractors",
      "rich_scenarios",
      "cognitive_load",
      "advanced_formats"
    ],
    "features_pending": []
  },
  "context": {
    "id": "cooking-3-1759077175904",
    "theme": "COOKING",
    "setting": {
      "location": "kitchen",
      "timeContext": "weekend baking",
      "atmosphere": "creative"
    },
    "characters": [
      {
        "name": "Mia",
        "role": "student"
      },
      {
        "name": "Mum",
        "role": "parent"
      }
    ],
    "items": [
      {
        "name": "flour",
        "category": "FOOD_ITEMS",
        "typicalValue": {
          "min": 1,
          "max": 5,
          "typical": 2.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "eggs",
        "category": "FOOD_ITEMS",
        "typicalValue": {
          "min": 1,
          "max": 5,
          "typical": 2.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "butter",
        "category": "FOOD_ITEMS",
        "typicalValue": {
          "min": 1,
          "max": 5,
          "typical": 2.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "sugar",
        "category": "FOOD_ITEMS",
        "typicalValue": {
          "min": 1,
          "max": 5,
          "typical": 2.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "milk",
        "category": "FOOD_ITEMS",
        "typicalValue": {
          "min": 1,
          "max": 5,
          "typical": 2.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "chocolate chips",
        "category": "FOOD_ITEMS",
        "typicalValue": {
          "min": 1,
          "max": 5,
          "typical": 2.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      }
    ],
    "culturalElements": [
      {
        "type": "currency",
        "value": "£",
        "explanation": "British pounds"
      },
      {
        "type": "measurement",
        "value": "grams",
        "explanation": "Weight measurement for ingredients"
      }
    ],
    "realWorldConnection": "Following recipes and calculating ingredient costs",
    "yearAppropriate": [
      3
    ],
    "templates": [
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "MULTI_STEP"
        ],
        "template": "{character} is making {recipe}. The ingredients cost {prices}. What is the total cost?",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "recipe",
            "type": "item"
          },
          {
            "key": "prices",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      }
    ]
  }
}
# Test E.3: SPORTS theme
{
  "success": true,
  "question": {
    "text": "The football costs £20. If Alexander buys 2, how much will it cost?",
    "options": [
      {
        "text": "11",
        "value": 11,
        "index": 0
      },
      {
        "text": "180",
        "value": 180,
        "index": 1
      },
      {
        "text": "60",
        "value": 60,
        "index": 2
      },
      {
        "text": "£50.00",
        "value": 50,
        "index": 3
      }
    ],
    "correctIndex": 3,
    "format": "DIRECT_CALCULATION",
    "difficulty": {
      "year": 3,
      "subLevel": 1,
      "displayName": "3.1",
      "cognitiveLoad": 30
    },
    "cognitiveLoad": 30,
    "curriculumTags": [
      "3N1a",
      "3N1b"
    ],
    "scenario": {
      "id": "sports-3-1759077175945",
      "theme": "SPORTS",
      "setting": {
        "location": "school sports hall",
        "timeContext": "weekend",
        "atmosphere": "energetic"
      },
      "characters": [
        {
          "name": "Alexander",
          "role": "student"
        },
        {
          "name": "Mia",
          "role": "coach"
        }
      ],
      "items": [
        {
          "name": "football",
          "category": "SPORTS_EQUIPMENT",
          "typicalValue": {
            "min": 5,
            "max": 50,
            "typical": 20,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "tennis ball",
          "category": "SPORTS_EQUIPMENT",
          "typicalValue": {
            "min": 5,
            "max": 50,
            "typical": 20,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "cricket bat",
          "category": "SPORTS_EQUIPMENT",
          "typicalValue": {
            "min": 5,
            "max": 50,
            "typical": 20,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "rugby ball",
          "category": "SPORTS_EQUIPMENT",
          "typicalValue": {
            "min": 5,
            "max": 50,
            "typical": 20,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "basketball",
          "category": "SPORTS_EQUIPMENT",
          "typicalValue": {
            "min": 5,
            "max": 50,
            "typical": 20,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        }
      ],
      "culturalElements": [
        {
          "type": "currency",
          "value": "£",
          "explanation": "British pounds"
        }
      ],
      "realWorldConnection": "Calculating costs for sports activities",
      "yearAppropriate": [
        3
      ],
      "templates": [
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "MULTI_STEP"
          ],
          "template": "The {item} costs {price}. If {character} buys {quantity}, how much will it cost?",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "price",
              "type": "value"
            },
            {
              "key": "quantity",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        }
      ]
    },
    "distractors": [
      {
        "value": 11,
        "displayText": "11",
        "strategy": "WRONG_OPERATION",
        "reasoning": "Subtracted instead of adding"
      },
      {
        "value": 180,
        "displayText": "180",
        "strategy": "WRONG_OPERATION",
        "reasoning": "Multiplied instead of adding"
      },
      {
        "value": 60,
        "displayText": "60",
        "strategy": "PLACE_VALUE_ERROR",
        "reasoning": "Error in carrying to next column"
      }
    ],
    "enhancementStatus": {
      "level": "partial",
      "requestedFormat": "DIRECT_CALCULATION",
      "actualFormat": "DIRECT_CALCULATION",
      "featuresActive": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "featuresPending": [],
      "isFullyEnhanced": true
    },
    "mathOutput": {
      "operation": "ADDITION",
      "operand_1": 20,
      "operand_2": 9,
      "operand_3": 21,
      "result": 50
    },
    "generationTime": 0,
    "questionId": "q_1759077175945_bb471fomo",
    "generationSetup": {
      "controller_used": "DIRECT_CALCULATIONController",
      "format_requested": "DIRECT_CALCULATION",
      "format_actual": "DIRECT_CALCULATION",
      "scenario_theme": "SPORTS",
      "scenario_id": "sports-3-1759077175945",
      "scenario_selection_method": "requested",
      "distractor_strategies": [
        "WRONG_OPERATION",
        "WRONG_OPERATION",
        "PLACE_VALUE_ERROR"
      ],
      "distractor_count": 3,
      "theme_variety": false,
      "format_variety": false,
      "enhancement_level": "partial",
      "features_active": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "features_pending": [],
      "generation_time_ms": 0
    }
  },
  "metadata": {
    "format": "DIRECT_CALCULATION",
    "cognitive_load": 30,
    "curriculum_alignment": [
      "3N1a",
      "3N1b"
    ],
    "difficulty": "3.1",
    "scenario_theme": "SPORTS",
    "distractor_strategies": [
      "WRONG_OPERATION",
      "WRONG_OPERATION",
      "PLACE_VALUE_ERROR"
    ],
    "generation_time_ms": 0,
    "api_version": "2.0",
    "enhancement_status": "partial",
    "format_requested": "DIRECT_CALCULATION",
    "format_used": "DIRECT_CALCULATION",
    "features_active": [
      "enhanced_distractors",
      "rich_scenarios",
      "cognitive_load",
      "advanced_formats"
    ],
    "features_pending": []
  },
  "context": {
    "id": "sports-3-1759077175945",
    "theme": "SPORTS",
    "setting": {
      "location": "school sports hall",
      "timeContext": "weekend",
      "atmosphere": "energetic"
    },
    "characters": [
      {
        "name": "Alexander",
        "role": "student"
      },
      {
        "name": "Mia",
        "role": "coach"
      }
    ],
    "items": [
      {
        "name": "football",
        "category": "SPORTS_EQUIPMENT",
        "typicalValue": {
          "min": 5,
          "max": 50,
          "typical": 20,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "tennis ball",
        "category": "SPORTS_EQUIPMENT",
        "typicalValue": {
          "min": 5,
          "max": 50,
          "typical": 20,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "cricket bat",
        "category": "SPORTS_EQUIPMENT",
        "typicalValue": {
          "min": 5,
          "max": 50,
          "typical": 20,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "rugby ball",
        "category": "SPORTS_EQUIPMENT",
        "typicalValue": {
          "min": 5,
          "max": 50,
          "typical": 20,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "basketball",
        "category": "SPORTS_EQUIPMENT",
        "typicalValue": {
          "min": 5,
          "max": 50,
          "typical": 20,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      }
    ],
    "culturalElements": [
      {
        "type": "currency",
        "value": "£",
        "explanation": "British pounds"
      }
    ],
    "realWorldConnection": "Calculating costs for sports activities",
    "yearAppropriate": [
      3
    ],
    "templates": [
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "MULTI_STEP"
        ],
        "template": "The {item} costs {price}. If {character} buys {quantity}, how much will it cost?",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "price",
            "type": "value"
          },
          {
            "key": "quantity",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      }
    ]
  }
}
# Test E.4: SCHOOL theme
{
  "success": true,
  "question": {
    "text": "Oliver needs to buy calculator, compass, protractor, highlighter for school. How much will it cost in total?",
    "options": [
      {
        "text": "79",
        "value": 79,
        "index": 0
      },
      {
        "text": "552",
        "value": 552,
        "index": 1
      },
      {
        "text": "47",
        "value": 47,
        "index": 2
      },
      {
        "text": "£69.00",
        "value": 69,
        "index": 3
      }
    ],
    "correctIndex": 3,
    "format": "DIRECT_CALCULATION",
    "difficulty": {
      "year": 3,
      "subLevel": 1,
      "displayName": "3.1",
      "cognitiveLoad": 30
    },
    "cognitiveLoad": 30,
    "curriculumTags": [
      "3N1a",
      "3N1b"
    ],
    "scenario": {
      "id": "school-3-1759077175989",
      "theme": "SCHOOL",
      "setting": {
        "location": "school stationery shop",
        "timeContext": "start of term",
        "atmosphere": "busy"
      },
      "characters": [
        {
          "name": "Oliver",
          "role": "student"
        },
        {
          "name": "Mrs. Thompson",
          "role": "teacher"
        }
      ],
      "items": [
        {
          "name": "calculator",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.5,
            "max": 15,
            "typical": 3,
            "distribution": "skewed_low"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "compass",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.5,
            "max": 15,
            "typical": 3,
            "distribution": "skewed_low"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "protractor",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.5,
            "max": 15,
            "typical": 3,
            "distribution": "skewed_low"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "highlighter",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.5,
            "max": 15,
            "typical": 3,
            "distribution": "skewed_low"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        }
      ],
      "culturalElements": [
        {
          "type": "currency",
          "value": "£",
          "explanation": "British pounds"
        },
        {
          "type": "event",
          "value": "start of term",
          "explanation": "When students buy school supplies"
        }
      ],
      "realWorldConnection": "Budgeting for school supplies",
      "yearAppropriate": [
        3
      ],
      "templates": [
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "COMPARISON"
          ],
          "template": "{character} needs to buy {items} for school. How much will it cost in total?",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "items",
              "type": "item"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        }
      ]
    },
    "distractors": [
      {
        "value": 552,
        "displayText": "552",
        "strategy": "WRONG_OPERATION",
        "reasoning": "Multiplied instead of adding"
      },
      {
        "value": 79,
        "displayText": "79",
        "strategy": "PLACE_VALUE_ERROR",
        "reasoning": "Error in carrying to next column"
      },
      {
        "value": 47,
        "displayText": "47",
        "strategy": "PARTIAL_CALCULATION",
        "reasoning": "Stopped calculation early"
      }
    ],
    "enhancementStatus": {
      "level": "partial",
      "requestedFormat": "DIRECT_CALCULATION",
      "actualFormat": "DIRECT_CALCULATION",
      "featuresActive": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "featuresPending": [],
      "isFullyEnhanced": true
    },
    "mathOutput": {
      "operation": "ADDITION",
      "operand_1": 23,
      "operand_2": 24,
      "operand_3": 22,
      "result": 69
    },
    "generationTime": 0,
    "questionId": "q_1759077175989_m9rg8zmjk",
    "generationSetup": {
      "controller_used": "DIRECT_CALCULATIONController",
      "format_requested": "DIRECT_CALCULATION",
      "format_actual": "DIRECT_CALCULATION",
      "scenario_theme": "SCHOOL",
      "scenario_id": "school-3-1759077175989",
      "scenario_selection_method": "requested",
      "distractor_strategies": [
        "WRONG_OPERATION",
        "PLACE_VALUE_ERROR",
        "PARTIAL_CALCULATION"
      ],
      "distractor_count": 3,
      "theme_variety": false,
      "format_variety": false,
      "enhancement_level": "partial",
      "features_active": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "features_pending": [],
      "generation_time_ms": 0
    }
  },
  "metadata": {
    "format": "DIRECT_CALCULATION",
    "cognitive_load": 30,
    "curriculum_alignment": [
      "3N1a",
      "3N1b"
    ],
    "difficulty": "3.1",
    "scenario_theme": "SCHOOL",
    "distractor_strategies": [
      "WRONG_OPERATION",
      "PLACE_VALUE_ERROR",
      "PARTIAL_CALCULATION"
    ],
    "generation_time_ms": 0,
    "api_version": "2.0",
    "enhancement_status": "partial",
    "format_requested": "DIRECT_CALCULATION",
    "format_used": "DIRECT_CALCULATION",
    "features_active": [
      "enhanced_distractors",
      "rich_scenarios",
      "cognitive_load",
      "advanced_formats"
    ],
    "features_pending": []
  },
  "context": {
    "id": "school-3-1759077175989",
    "theme": "SCHOOL",
    "setting": {
      "location": "school stationery shop",
      "timeContext": "start of term",
      "atmosphere": "busy"
    },
    "characters": [
      {
        "name": "Oliver",
        "role": "student"
      },
      {
        "name": "Mrs. Thompson",
        "role": "teacher"
      }
    ],
    "items": [
      {
        "name": "calculator",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.5,
          "max": 15,
          "typical": 3,
          "distribution": "skewed_low"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "compass",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.5,
          "max": 15,
          "typical": 3,
          "distribution": "skewed_low"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "protractor",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.5,
          "max": 15,
          "typical": 3,
          "distribution": "skewed_low"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "highlighter",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.5,
          "max": 15,
          "typical": 3,
          "distribution": "skewed_low"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      }
    ],
    "culturalElements": [
      {
        "type": "currency",
        "value": "£",
        "explanation": "British pounds"
      },
      {
        "type": "event",
        "value": "start of term",
        "explanation": "When students buy school supplies"
      }
    ],
    "realWorldConnection": "Budgeting for school supplies",
    "yearAppropriate": [
      3
    ],
    "templates": [
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "COMPARISON"
        ],
        "template": "{character} needs to buy {items} for school. How much will it cost in total?",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "items",
            "type": "item"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      }
    ]
  }
}
# Test E.5: POCKET_MONEY theme
{
  "success": true,
  "question": {
    "text": "What is 17 + 29 + 17?",
    "options": [
      {
        "text": "493",
        "value": 493,
        "index": 0
      },
      {
        "text": "46",
        "value": 46,
        "index": 1
      },
      {
        "text": "£63.00",
        "value": 63,
        "index": 2
      },
      {
        "text": "73",
        "value": 73,
        "index": 3
      }
    ],
    "correctIndex": 2,
    "format": "DIRECT_CALCULATION",
    "difficulty": {
      "year": 3,
      "subLevel": 1,
      "displayName": "3.1",
      "cognitiveLoad": 30
    },
    "cognitiveLoad": 30,
    "curriculumTags": [
      "3N1a",
      "3N1b"
    ],
    "scenario": {
      "id": "pocket-money-3-1759077176030",
      "theme": "POCKET_MONEY",
      "setting": {
        "location": "home",
        "timeContext": "weekly",
        "atmosphere": "planning"
      },
      "characters": [
        {
          "name": "Michael",
          "role": "student"
        }
      ],
      "items": [
        {
          "name": "video game",
          "category": "SAVING_GOAL",
          "typicalValue": {
            "min": 12,
            "max": 40,
            "typical": 25,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "board game",
          "category": "SAVING_GOAL",
          "typicalValue": {
            "min": 12,
            "max": 40,
            "typical": 25,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "sports equipment",
          "category": "SAVING_GOAL",
          "typicalValue": {
            "min": 12,
            "max": 40,
            "typical": 25,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        }
      ],
      "culturalElements": [
        {
          "type": "currency",
          "value": "£",
          "explanation": "British pounds"
        },
        {
          "type": "custom",
          "value": "pocket money",
          "explanation": "Weekly allowance for children"
        }
      ],
      "realWorldConnection": "Learning to save and budget money",
      "yearAppropriate": [
        3
      ],
      "templates": [
        {
          "formatCompatibility": [
            "ESTIMATION",
            "MULTI_STEP"
          ],
          "template": "If {character} gets {amount} pocket money each week, how many weeks will it take to save for a {item} that costs {price}?",
          "answerTemplate": "It will take {result} weeks",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "amount",
              "type": "value"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "price",
              "type": "value"
            }
          ]
        }
      ]
    },
    "distractors": [
      {
        "value": 493,
        "displayText": "493",
        "strategy": "WRONG_OPERATION",
        "reasoning": "Multiplied instead of adding"
      },
      {
        "value": 73,
        "displayText": "73",
        "strategy": "PLACE_VALUE_ERROR",
        "reasoning": "Error in carrying to next column"
      },
      {
        "value": 46,
        "displayText": "46",
        "strategy": "PARTIAL_CALCULATION",
        "reasoning": "Stopped calculation early"
      }
    ],
    "enhancementStatus": {
      "level": "partial",
      "requestedFormat": "DIRECT_CALCULATION",
      "actualFormat": "DIRECT_CALCULATION",
      "featuresActive": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "featuresPending": [],
      "isFullyEnhanced": true
    },
    "mathOutput": {
      "operation": "ADDITION",
      "operand_1": 17,
      "operand_2": 29,
      "operand_3": 17,
      "result": 63
    },
    "generationTime": 0,
    "questionId": "q_1759077176030_gkr1htlz3",
    "generationSetup": {
      "controller_used": "DIRECT_CALCULATIONController",
      "format_requested": "DIRECT_CALCULATION",
      "format_actual": "DIRECT_CALCULATION",
      "scenario_theme": "POCKET_MONEY",
      "scenario_id": "pocket-money-3-1759077176030",
      "scenario_selection_method": "requested",
      "distractor_strategies": [
        "WRONG_OPERATION",
        "PLACE_VALUE_ERROR",
        "PARTIAL_CALCULATION"
      ],
      "distractor_count": 3,
      "theme_variety": false,
      "format_variety": false,
      "enhancement_level": "partial",
      "features_active": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "features_pending": [],
      "generation_time_ms": 0
    }
  },
  "metadata": {
    "format": "DIRECT_CALCULATION",
    "cognitive_load": 30,
    "curriculum_alignment": [
      "3N1a",
      "3N1b"
    ],
    "difficulty": "3.1",
    "scenario_theme": "POCKET_MONEY",
    "distractor_strategies": [
      "WRONG_OPERATION",
      "PLACE_VALUE_ERROR",
      "PARTIAL_CALCULATION"
    ],
    "generation_time_ms": 0,
    "api_version": "2.0",
    "enhancement_status": "partial",
    "format_requested": "DIRECT_CALCULATION",
    "format_used": "DIRECT_CALCULATION",
    "features_active": [
      "enhanced_distractors",
      "rich_scenarios",
      "cognitive_load",
      "advanced_formats"
    ],
    "features_pending": []
  },
  "context": {
    "id": "pocket-money-3-1759077176030",
    "theme": "POCKET_MONEY",
    "setting": {
      "location": "home",
      "timeContext": "weekly",
      "atmosphere": "planning"
    },
    "characters": [
      {
        "name": "Michael",
        "role": "student"
      }
    ],
    "items": [
      {
        "name": "video game",
        "category": "SAVING_GOAL",
        "typicalValue": {
          "min": 12,
          "max": 40,
          "typical": 25,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "board game",
        "category": "SAVING_GOAL",
        "typicalValue": {
          "min": 12,
          "max": 40,
          "typical": 25,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "sports equipment",
        "category": "SAVING_GOAL",
        "typicalValue": {
          "min": 12,
          "max": 40,
          "typical": 25,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      }
    ],
    "culturalElements": [
      {
        "type": "currency",
        "value": "£",
        "explanation": "British pounds"
      },
      {
        "type": "custom",
        "value": "pocket money",
        "explanation": "Weekly allowance for children"
      }
    ],
    "realWorldConnection": "Learning to save and budget money",
    "yearAppropriate": [
      3
    ],
    "templates": [
      {
        "formatCompatibility": [
          "ESTIMATION",
          "MULTI_STEP"
        ],
        "template": "If {character} gets {amount} pocket money each week, how many weeks will it take to save for a {item} that costs {price}?",
        "answerTemplate": "It will take {result} weeks",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "amount",
            "type": "value"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "price",
            "type": "value"
          }
        ]
      }
    ]
  }
}
# Test E.6: NATURE theme
{
  "success": true,
  "question": {
    "text": "Benjamin collected flower, leaf, stone, stick, acorn, feather, shell, pine cone while exploring. How many items in total?",
    "options": [
      {
        "text": "29",
        "value": 29,
        "index": 0
      },
      {
        "text": "204",
        "value": 204,
        "index": 1
      },
      {
        "text": "71",
        "value": 71,
        "index": 2
      },
      {
        "text": "61",
        "value": 61,
        "index": 3
      }
    ],
    "correctIndex": 3,
    "format": "DIRECT_CALCULATION",
    "difficulty": {
      "year": 3,
      "subLevel": 1,
      "displayName": "3.1",
      "cognitiveLoad": 30
    },
    "cognitiveLoad": 30,
    "curriculumTags": [
      "3N1a",
      "3N1b"
    ],
    "scenario": {
      "id": "nature-3-1759077176072",
      "theme": "NATURE",
      "setting": {
        "location": "nature reserve",
        "timeContext": "outdoor exploration",
        "atmosphere": "peaceful"
      },
      "characters": [
        {
          "name": "Benjamin",
          "role": "student"
        },
        {
          "name": "Mr. Green",
          "role": "park ranger"
        }
      ],
      "items": [
        {
          "name": "flower",
          "category": "NATURE_ITEMS",
          "typicalValue": {
            "min": 1,
            "max": 20,
            "typical": 5,
            "distribution": "normal"
          },
          "unit": "items",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "leaf",
          "category": "NATURE_ITEMS",
          "typicalValue": {
            "min": 1,
            "max": 20,
            "typical": 5,
            "distribution": "normal"
          },
          "unit": "items",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "stone",
          "category": "NATURE_ITEMS",
          "typicalValue": {
            "min": 1,
            "max": 20,
            "typical": 5,
            "distribution": "normal"
          },
          "unit": "items",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "stick",
          "category": "NATURE_ITEMS",
          "typicalValue": {
            "min": 1,
            "max": 20,
            "typical": 5,
            "distribution": "normal"
          },
          "unit": "items",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "acorn",
          "category": "NATURE_ITEMS",
          "typicalValue": {
            "min": 1,
            "max": 20,
            "typical": 5,
            "distribution": "normal"
          },
          "unit": "items",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "feather",
          "category": "NATURE_ITEMS",
          "typicalValue": {
            "min": 1,
            "max": 20,
            "typical": 5,
            "distribution": "normal"
          },
          "unit": "items",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "shell",
          "category": "NATURE_ITEMS",
          "typicalValue": {
            "min": 1,
            "max": 20,
            "typical": 5,
            "distribution": "normal"
          },
          "unit": "items",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "pine cone",
          "category": "NATURE_ITEMS",
          "typicalValue": {
            "min": 1,
            "max": 20,
            "typical": 5,
            "distribution": "normal"
          },
          "unit": "items",
          "attributes": {
            "quality": "standard"
          }
        }
      ],
      "culturalElements": [
        {
          "type": "location",
          "value": "UK countryside",
          "explanation": "British natural environments"
        }
      ],
      "realWorldConnection": "Counting and collecting in nature",
      "yearAppropriate": [
        3
      ],
      "templates": [
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "COMPARISON"
          ],
          "template": "{character} collected {items} while exploring. How many items in total?",
          "answerTemplate": "{character} collected {result} items",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "items",
              "type": "item"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        }
      ]
    },
    "distractors": [
      {
        "value": 204,
        "displayText": "204",
        "strategy": "WRONG_OPERATION",
        "reasoning": "Multiplied instead of adding"
      },
      {
        "value": 71,
        "displayText": "71",
        "strategy": "PLACE_VALUE_ERROR",
        "reasoning": "Error in carrying to next column"
      },
      {
        "value": 29,
        "displayText": "29",
        "strategy": "PARTIAL_CALCULATION",
        "reasoning": "Stopped calculation early"
      }
    ],
    "enhancementStatus": {
      "level": "partial",
      "requestedFormat": "DIRECT_CALCULATION",
      "actualFormat": "DIRECT_CALCULATION",
      "featuresActive": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "featuresPending": [],
      "isFullyEnhanced": true
    },
    "mathOutput": {
      "operation": "ADDITION",
      "operand_1": 12,
      "operand_2": 17,
      "operand_3": 32,
      "result": 61
    },
    "generationTime": 1,
    "questionId": "q_1759077176072_g4ctyql7l",
    "generationSetup": {
      "controller_used": "DIRECT_CALCULATIONController",
      "format_requested": "DIRECT_CALCULATION",
      "format_actual": "DIRECT_CALCULATION",
      "scenario_theme": "NATURE",
      "scenario_id": "nature-3-1759077176072",
      "scenario_selection_method": "requested",
      "distractor_strategies": [
        "WRONG_OPERATION",
        "PLACE_VALUE_ERROR",
        "PARTIAL_CALCULATION"
      ],
      "distractor_count": 3,
      "theme_variety": false,
      "format_variety": false,
      "enhancement_level": "partial",
      "features_active": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "features_pending": [],
      "generation_time_ms": 1
    }
  },
  "metadata": {
    "format": "DIRECT_CALCULATION",
    "cognitive_load": 30,
    "curriculum_alignment": [
      "3N1a",
      "3N1b"
    ],
    "difficulty": "3.1",
    "scenario_theme": "NATURE",
    "distractor_strategies": [
      "WRONG_OPERATION",
      "PLACE_VALUE_ERROR",
      "PARTIAL_CALCULATION"
    ],
    "generation_time_ms": 1,
    "api_version": "2.0",
    "enhancement_status": "partial",
    "format_requested": "DIRECT_CALCULATION",
    "format_used": "DIRECT_CALCULATION",
    "features_active": [
      "enhanced_distractors",
      "rich_scenarios",
      "cognitive_load",
      "advanced_formats"
    ],
    "features_pending": []
  },
  "context": {
    "id": "nature-3-1759077176072",
    "theme": "NATURE",
    "setting": {
      "location": "nature reserve",
      "timeContext": "outdoor exploration",
      "atmosphere": "peaceful"
    },
    "characters": [
      {
        "name": "Benjamin",
        "role": "student"
      },
      {
        "name": "Mr. Green",
        "role": "park ranger"
      }
    ],
    "items": [
      {
        "name": "flower",
        "category": "NATURE_ITEMS",
        "typicalValue": {
          "min": 1,
          "max": 20,
          "typical": 5,
          "distribution": "normal"
        },
        "unit": "items",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "leaf",
        "category": "NATURE_ITEMS",
        "typicalValue": {
          "min": 1,
          "max": 20,
          "typical": 5,
          "distribution": "normal"
        },
        "unit": "items",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "stone",
        "category": "NATURE_ITEMS",
        "typicalValue": {
          "min": 1,
          "max": 20,
          "typical": 5,
          "distribution": "normal"
        },
        "unit": "items",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "stick",
        "category": "NATURE_ITEMS",
        "typicalValue": {
          "min": 1,
          "max": 20,
          "typical": 5,
          "distribution": "normal"
        },
        "unit": "items",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "acorn",
        "category": "NATURE_ITEMS",
        "typicalValue": {
          "min": 1,
          "max": 20,
          "typical": 5,
          "distribution": "normal"
        },
        "unit": "items",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "feather",
        "category": "NATURE_ITEMS",
        "typicalValue": {
          "min": 1,
          "max": 20,
          "typical": 5,
          "distribution": "normal"
        },
        "unit": "items",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "shell",
        "category": "NATURE_ITEMS",
        "typicalValue": {
          "min": 1,
          "max": 20,
          "typical": 5,
          "distribution": "normal"
        },
        "unit": "items",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "pine cone",
        "category": "NATURE_ITEMS",
        "typicalValue": {
          "min": 1,
          "max": 20,
          "typical": 5,
          "distribution": "normal"
        },
        "unit": "items",
        "attributes": {
          "quality": "standard"
        }
      }
    ],
    "culturalElements": [
      {
        "type": "location",
        "value": "UK countryside",
        "explanation": "British natural environments"
      }
    ],
    "realWorldConnection": "Counting and collecting in nature",
    "yearAppropriate": [
      3
    ],
    "templates": [
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "COMPARISON"
        ],
        "template": "{character} collected {items} while exploring. How many items in total?",
        "answerTemplate": "{character} collected {result} items",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "items",
            "type": "item"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      }
    ]
  }
}
# Test E.7: TRANSPORT theme
{
  "success": true,
  "question": {
    "text": "A {transport} journey costs £39. How much for 20 journeys?",
    "options": [
      {
        "text": "780",
        "value": 780,
        "index": 0
      },
      {
        "text": "19",
        "value": 19,
        "index": 1
      },
      {
        "text": "72",
        "value": 72,
        "index": 2
      },
      {
        "text": "£62.00",
        "value": 62,
        "index": 3
      }
    ],
    "correctIndex": 3,
    "format": "DIRECT_CALCULATION",
    "difficulty": {
      "year": 3,
      "subLevel": 1,
      "displayName": "3.1",
      "cognitiveLoad": 30
    },
    "cognitiveLoad": 30,
    "curriculumTags": [
      "3N1a",
      "3N1b"
    ],
    "scenario": {
      "id": "transport-3-1759077176113",
      "theme": "TRANSPORT",
      "setting": {
        "location": "transport hub",
        "timeContext": "journey planning",
        "atmosphere": "busy"
      },
      "characters": [
        {
          "name": "Ava",
          "role": "passenger"
        },
        {
          "name": "Mrs. Driver",
          "role": "transport operator"
        }
      ],
      "items": [
        {
          "name": "bus",
          "category": "TRANSPORT",
          "typicalValue": {
            "min": 1.5,
            "max": 15,
            "typical": 5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "train",
          "category": "TRANSPORT",
          "typicalValue": {
            "min": 1.5,
            "max": 15,
            "typical": 5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "taxi",
          "category": "TRANSPORT",
          "typicalValue": {
            "min": 1.5,
            "max": 15,
            "typical": 5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "tube",
          "category": "TRANSPORT",
          "typicalValue": {
            "min": 1.5,
            "max": 15,
            "typical": 5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "bike",
          "category": "TRANSPORT",
          "typicalValue": {
            "min": 1.5,
            "max": 15,
            "typical": 5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        }
      ],
      "culturalElements": [
        {
          "type": "currency",
          "value": "£",
          "explanation": "British pounds for transport fares"
        }
      ],
      "realWorldConnection": "Calculating travel costs and distances",
      "yearAppropriate": [
        3
      ],
      "templates": [
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "MULTI_STEP"
          ],
          "template": "A {transport} journey costs {price}. How much for {quantity} journeys?",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "transport",
              "type": "item"
            },
            {
              "key": "price",
              "type": "value"
            },
            {
              "key": "quantity",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        }
      ]
    },
    "distractors": [
      {
        "value": 19,
        "displayText": "19",
        "strategy": "WRONG_OPERATION",
        "reasoning": "Subtracted instead of adding"
      },
      {
        "value": 780,
        "displayText": "780",
        "strategy": "WRONG_OPERATION",
        "reasoning": "Multiplied instead of adding"
      },
      {
        "value": 72,
        "displayText": "72",
        "strategy": "PLACE_VALUE_ERROR",
        "reasoning": "Error in carrying to next column"
      }
    ],
    "enhancementStatus": {
      "level": "partial",
      "requestedFormat": "DIRECT_CALCULATION",
      "actualFormat": "DIRECT_CALCULATION",
      "featuresActive": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "featuresPending": [],
      "isFullyEnhanced": true
    },
    "mathOutput": {
      "operation": "ADDITION",
      "operand_1": 39,
      "operand_2": 20,
      "operand_3": 3,
      "result": 62
    },
    "generationTime": 1,
    "questionId": "q_1759077176113_vm2prewvw",
    "generationSetup": {
      "controller_used": "DIRECT_CALCULATIONController",
      "format_requested": "DIRECT_CALCULATION",
      "format_actual": "DIRECT_CALCULATION",
      "scenario_theme": "TRANSPORT",
      "scenario_id": "transport-3-1759077176113",
      "scenario_selection_method": "requested",
      "distractor_strategies": [
        "WRONG_OPERATION",
        "WRONG_OPERATION",
        "PLACE_VALUE_ERROR"
      ],
      "distractor_count": 3,
      "theme_variety": false,
      "format_variety": false,
      "enhancement_level": "partial",
      "features_active": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "features_pending": [],
      "generation_time_ms": 1
    }
  },
  "metadata": {
    "format": "DIRECT_CALCULATION",
    "cognitive_load": 30,
    "curriculum_alignment": [
      "3N1a",
      "3N1b"
    ],
    "difficulty": "3.1",
    "scenario_theme": "TRANSPORT",
    "distractor_strategies": [
      "WRONG_OPERATION",
      "WRONG_OPERATION",
      "PLACE_VALUE_ERROR"
    ],
    "generation_time_ms": 1,
    "api_version": "2.0",
    "enhancement_status": "partial",
    "format_requested": "DIRECT_CALCULATION",
    "format_used": "DIRECT_CALCULATION",
    "features_active": [
      "enhanced_distractors",
      "rich_scenarios",
      "cognitive_load",
      "advanced_formats"
    ],
    "features_pending": []
  },
  "context": {
    "id": "transport-3-1759077176113",
    "theme": "TRANSPORT",
    "setting": {
      "location": "transport hub",
      "timeContext": "journey planning",
      "atmosphere": "busy"
    },
    "characters": [
      {
        "name": "Ava",
        "role": "passenger"
      },
      {
        "name": "Mrs. Driver",
        "role": "transport operator"
      }
    ],
    "items": [
      {
        "name": "bus",
        "category": "TRANSPORT",
        "typicalValue": {
          "min": 1.5,
          "max": 15,
          "typical": 5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "train",
        "category": "TRANSPORT",
        "typicalValue": {
          "min": 1.5,
          "max": 15,
          "typical": 5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "taxi",
        "category": "TRANSPORT",
        "typicalValue": {
          "min": 1.5,
          "max": 15,
          "typical": 5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "tube",
        "category": "TRANSPORT",
        "typicalValue": {
          "min": 1.5,
          "max": 15,
          "typical": 5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "bike",
        "category": "TRANSPORT",
        "typicalValue": {
          "min": 1.5,
          "max": 15,
          "typical": 5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      }
    ],
    "culturalElements": [
      {
        "type": "currency",
        "value": "£",
        "explanation": "British pounds for transport fares"
      }
    ],
    "realWorldConnection": "Calculating travel costs and distances",
    "yearAppropriate": [
      3
    ],
    "templates": [
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "MULTI_STEP"
        ],
        "template": "A {transport} journey costs {price}. How much for {quantity} journeys?",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "transport",
            "type": "item"
          },
          {
            "key": "price",
            "type": "value"
          },
          {
            "key": "quantity",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      }
    ]
  }
}
# Test E.8: COLLECTIONS theme
{
  "success": true,
  "question": {
    "text": "Mia has sticker, card, coin, stamp, badge, marble, button in their collection. How many altogether?",
    "options": [
      {
        "text": "68",
        "value": 68,
        "index": 0
      },
      {
        "text": "39",
        "value": 39,
        "index": 1
      },
      {
        "text": "58",
        "value": 58,
        "index": 2
      },
      {
        "text": "140",
        "value": 140,
        "index": 3
      }
    ],
    "correctIndex": 2,
    "format": "DIRECT_CALCULATION",
    "difficulty": {
      "year": 3,
      "subLevel": 1,
      "displayName": "3.1",
      "cognitiveLoad": 30
    },
    "cognitiveLoad": 30,
    "curriculumTags": [
      "3N1a",
      "3N1b"
    ],
    "scenario": {
      "id": "collections-3-1759077176167",
      "theme": "COLLECTIONS",
      "setting": {
        "location": "bedroom",
        "timeContext": "organizing collection",
        "atmosphere": "focused"
      },
      "characters": [
        {
          "name": "Mia",
          "role": "collector"
        },
        {
          "name": "Emma",
          "role": "friend"
        }
      ],
      "items": [
        {
          "name": "sticker",
          "category": "COLLECTIBLES",
          "typicalValue": {
            "min": 1,
            "max": 50,
            "typical": 10,
            "distribution": "normal"
          },
          "unit": "items",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "card",
          "category": "COLLECTIBLES",
          "typicalValue": {
            "min": 1,
            "max": 50,
            "typical": 10,
            "distribution": "normal"
          },
          "unit": "items",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "coin",
          "category": "COLLECTIBLES",
          "typicalValue": {
            "min": 1,
            "max": 50,
            "typical": 10,
            "distribution": "normal"
          },
          "unit": "items",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "stamp",
          "category": "COLLECTIBLES",
          "typicalValue": {
            "min": 1,
            "max": 50,
            "typical": 10,
            "distribution": "normal"
          },
          "unit": "items",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "badge",
          "category": "COLLECTIBLES",
          "typicalValue": {
            "min": 1,
            "max": 50,
            "typical": 10,
            "distribution": "normal"
          },
          "unit": "items",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "marble",
          "category": "COLLECTIBLES",
          "typicalValue": {
            "min": 1,
            "max": 50,
            "typical": 10,
            "distribution": "normal"
          },
          "unit": "items",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "button",
          "category": "COLLECTIBLES",
          "typicalValue": {
            "min": 1,
            "max": 50,
            "typical": 10,
            "distribution": "normal"
          },
          "unit": "items",
          "attributes": {
            "quality": "standard"
          }
        }
      ],
      "culturalElements": [
        {
          "type": "hobby",
          "value": "collecting",
          "explanation": "Popular childhood hobby"
        }
      ],
      "realWorldConnection": "Organizing and counting collections",
      "yearAppropriate": [
        3
      ],
      "templates": [
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "ORDERING"
          ],
          "template": "{character} has {items} in their collection. How many altogether?",
          "answerTemplate": "{character} has {result} items total",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "items",
              "type": "item"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        }
      ]
    },
    "distractors": [
      {
        "value": 140,
        "displayText": "140",
        "strategy": "WRONG_OPERATION",
        "reasoning": "Multiplied instead of adding"
      },
      {
        "value": 68,
        "displayText": "68",
        "strategy": "PLACE_VALUE_ERROR",
        "reasoning": "Error in carrying to next column"
      },
      {
        "value": 39,
        "displayText": "39",
        "strategy": "PARTIAL_CALCULATION",
        "reasoning": "Stopped calculation early"
      }
    ],
    "enhancementStatus": {
      "level": "partial",
      "requestedFormat": "DIRECT_CALCULATION",
      "actualFormat": "DIRECT_CALCULATION",
      "featuresActive": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "featuresPending": [],
      "isFullyEnhanced": true
    },
    "mathOutput": {
      "operation": "ADDITION",
      "operand_1": 4,
      "operand_2": 35,
      "operand_3": 19,
      "result": 58
    },
    "generationTime": 1,
    "questionId": "q_1759077176167_cne8y31oe",
    "generationSetup": {
      "controller_used": "DIRECT_CALCULATIONController",
      "format_requested": "DIRECT_CALCULATION",
      "format_actual": "DIRECT_CALCULATION",
      "scenario_theme": "COLLECTIONS",
      "scenario_id": "collections-3-1759077176167",
      "scenario_selection_method": "requested",
      "distractor_strategies": [
        "WRONG_OPERATION",
        "PLACE_VALUE_ERROR",
        "PARTIAL_CALCULATION"
      ],
      "distractor_count": 3,
      "theme_variety": false,
      "format_variety": false,
      "enhancement_level": "partial",
      "features_active": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "features_pending": [],
      "generation_time_ms": 1
    }
  },
  "metadata": {
    "format": "DIRECT_CALCULATION",
    "cognitive_load": 30,
    "curriculum_alignment": [
      "3N1a",
      "3N1b"
    ],
    "difficulty": "3.1",
    "scenario_theme": "COLLECTIONS",
    "distractor_strategies": [
      "WRONG_OPERATION",
      "PLACE_VALUE_ERROR",
      "PARTIAL_CALCULATION"
    ],
    "generation_time_ms": 1,
    "api_version": "2.0",
    "enhancement_status": "partial",
    "format_requested": "DIRECT_CALCULATION",
    "format_used": "DIRECT_CALCULATION",
    "features_active": [
      "enhanced_distractors",
      "rich_scenarios",
      "cognitive_load",
      "advanced_formats"
    ],
    "features_pending": []
  },
  "context": {
    "id": "collections-3-1759077176167",
    "theme": "COLLECTIONS",
    "setting": {
      "location": "bedroom",
      "timeContext": "organizing collection",
      "atmosphere": "focused"
    },
    "characters": [
      {
        "name": "Mia",
        "role": "collector"
      },
      {
        "name": "Emma",
        "role": "friend"
      }
    ],
    "items": [
      {
        "name": "sticker",
        "category": "COLLECTIBLES",
        "typicalValue": {
          "min": 1,
          "max": 50,
          "typical": 10,
          "distribution": "normal"
        },
        "unit": "items",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "card",
        "category": "COLLECTIBLES",
        "typicalValue": {
          "min": 1,
          "max": 50,
          "typical": 10,
          "distribution": "normal"
        },
        "unit": "items",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "coin",
        "category": "COLLECTIBLES",
        "typicalValue": {
          "min": 1,
          "max": 50,
          "typical": 10,
          "distribution": "normal"
        },
        "unit": "items",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "stamp",
        "category": "COLLECTIBLES",
        "typicalValue": {
          "min": 1,
          "max": 50,
          "typical": 10,
          "distribution": "normal"
        },
        "unit": "items",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "badge",
        "category": "COLLECTIBLES",
        "typicalValue": {
          "min": 1,
          "max": 50,
          "typical": 10,
          "distribution": "normal"
        },
        "unit": "items",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "marble",
        "category": "COLLECTIBLES",
        "typicalValue": {
          "min": 1,
          "max": 50,
          "typical": 10,
          "distribution": "normal"
        },
        "unit": "items",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "button",
        "category": "COLLECTIBLES",
        "typicalValue": {
          "min": 1,
          "max": 50,
          "typical": 10,
          "distribution": "normal"
        },
        "unit": "items",
        "attributes": {
          "quality": "standard"
        }
      }
    ],
    "culturalElements": [
      {
        "type": "hobby",
        "value": "collecting",
        "explanation": "Popular childhood hobby"
      }
    ],
    "realWorldConnection": "Organizing and counting collections",
    "yearAppropriate": [
      3
    ],
    "templates": [
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "ORDERING"
        ],
        "template": "{character} has {items} in their collection. How many altogether?",
        "answerTemplate": "{character} has {result} items total",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "items",
            "type": "item"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      }
    ]
  }
}
# Test E.9: HOUSEHOLD theme
{
  "success": true,
  "question": {
    "text": "Elizabeth needs to tidy cup, plate, spoon, towel, pillow, book, toy, sock. How many items to put away?",
    "options": [
      {
        "text": "198",
        "value": 198,
        "index": 0
      },
      {
        "text": "60",
        "value": 60,
        "index": 1
      },
      {
        "text": "39",
        "value": 39,
        "index": 2
      },
      {
        "text": "50",
        "value": 50,
        "index": 3
      }
    ],
    "correctIndex": 3,
    "format": "DIRECT_CALCULATION",
    "difficulty": {
      "year": 3,
      "subLevel": 1,
      "displayName": "3.1",
      "cognitiveLoad": 30
    },
    "cognitiveLoad": 30,
    "curriculumTags": [
      "3N1a",
      "3N1b"
    ],
    "scenario": {
      "id": "household-3-1759077176208",
      "theme": "HOUSEHOLD",
      "setting": {
        "location": "kitchen",
        "timeContext": "tidying up",
        "atmosphere": "homely"
      },
      "characters": [
        {
          "name": "Elizabeth",
          "role": "child"
        },
        {
          "name": "Mum",
          "role": "parent"
        }
      ],
      "items": [
        {
          "name": "cup",
          "category": "HOUSEHOLD_ITEMS",
          "typicalValue": {
            "min": 1,
            "max": 30,
            "typical": 8,
            "distribution": "normal"
          },
          "unit": "items",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "plate",
          "category": "HOUSEHOLD_ITEMS",
          "typicalValue": {
            "min": 1,
            "max": 30,
            "typical": 8,
            "distribution": "normal"
          },
          "unit": "items",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "spoon",
          "category": "HOUSEHOLD_ITEMS",
          "typicalValue": {
            "min": 1,
            "max": 30,
            "typical": 8,
            "distribution": "normal"
          },
          "unit": "items",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "towel",
          "category": "HOUSEHOLD_ITEMS",
          "typicalValue": {
            "min": 1,
            "max": 30,
            "typical": 8,
            "distribution": "normal"
          },
          "unit": "items",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "pillow",
          "category": "HOUSEHOLD_ITEMS",
          "typicalValue": {
            "min": 1,
            "max": 30,
            "typical": 8,
            "distribution": "normal"
          },
          "unit": "items",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "book",
          "category": "HOUSEHOLD_ITEMS",
          "typicalValue": {
            "min": 1,
            "max": 30,
            "typical": 8,
            "distribution": "normal"
          },
          "unit": "items",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "toy",
          "category": "HOUSEHOLD_ITEMS",
          "typicalValue": {
            "min": 1,
            "max": 30,
            "typical": 8,
            "distribution": "normal"
          },
          "unit": "items",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "sock",
          "category": "HOUSEHOLD_ITEMS",
          "typicalValue": {
            "min": 1,
            "max": 30,
            "typical": 8,
            "distribution": "normal"
          },
          "unit": "items",
          "attributes": {
            "quality": "standard"
          }
        }
      ],
      "culturalElements": [
        {
          "type": "custom",
          "value": "household chores",
          "explanation": "Daily home activities"
        }
      ],
      "realWorldConnection": "Organizing and counting household items",
      "yearAppropriate": [
        3
      ],
      "templates": [
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "COMPARISON"
          ],
          "template": "{character} needs to tidy {items}. How many items to put away?",
          "answerTemplate": "{character} needs to put away {result} items",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "items",
              "type": "item"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        }
      ]
    },
    "distractors": [
      {
        "value": 198,
        "displayText": "198",
        "strategy": "WRONG_OPERATION",
        "reasoning": "Multiplied instead of adding"
      },
      {
        "value": 60,
        "displayText": "60",
        "strategy": "PLACE_VALUE_ERROR",
        "reasoning": "Error in carrying to next column"
      },
      {
        "value": 39,
        "displayText": "39",
        "strategy": "PARTIAL_CALCULATION",
        "reasoning": "Stopped calculation early"
      }
    ],
    "enhancementStatus": {
      "level": "partial",
      "requestedFormat": "DIRECT_CALCULATION",
      "actualFormat": "DIRECT_CALCULATION",
      "featuresActive": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "featuresPending": [],
      "isFullyEnhanced": true
    },
    "mathOutput": {
      "operation": "ADDITION",
      "operand_1": 6,
      "operand_2": 33,
      "operand_3": 11,
      "result": 50
    },
    "generationTime": 0,
    "questionId": "q_1759077176208_vdmp5olzx",
    "generationSetup": {
      "controller_used": "DIRECT_CALCULATIONController",
      "format_requested": "DIRECT_CALCULATION",
      "format_actual": "DIRECT_CALCULATION",
      "scenario_theme": "HOUSEHOLD",
      "scenario_id": "household-3-1759077176208",
      "scenario_selection_method": "requested",
      "distractor_strategies": [
        "WRONG_OPERATION",
        "PLACE_VALUE_ERROR",
        "PARTIAL_CALCULATION"
      ],
      "distractor_count": 3,
      "theme_variety": false,
      "format_variety": false,
      "enhancement_level": "partial",
      "features_active": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "features_pending": [],
      "generation_time_ms": 0
    }
  },
  "metadata": {
    "format": "DIRECT_CALCULATION",
    "cognitive_load": 30,
    "curriculum_alignment": [
      "3N1a",
      "3N1b"
    ],
    "difficulty": "3.1",
    "scenario_theme": "HOUSEHOLD",
    "distractor_strategies": [
      "WRONG_OPERATION",
      "PLACE_VALUE_ERROR",
      "PARTIAL_CALCULATION"
    ],
    "generation_time_ms": 0,
    "api_version": "2.0",
    "enhancement_status": "partial",
    "format_requested": "DIRECT_CALCULATION",
    "format_used": "DIRECT_CALCULATION",
    "features_active": [
      "enhanced_distractors",
      "rich_scenarios",
      "cognitive_load",
      "advanced_formats"
    ],
    "features_pending": []
  },
  "context": {
    "id": "household-3-1759077176208",
    "theme": "HOUSEHOLD",
    "setting": {
      "location": "kitchen",
      "timeContext": "tidying up",
      "atmosphere": "homely"
    },
    "characters": [
      {
        "name": "Elizabeth",
        "role": "child"
      },
      {
        "name": "Mum",
        "role": "parent"
      }
    ],
    "items": [
      {
        "name": "cup",
        "category": "HOUSEHOLD_ITEMS",
        "typicalValue": {
          "min": 1,
          "max": 30,
          "typical": 8,
          "distribution": "normal"
        },
        "unit": "items",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "plate",
        "category": "HOUSEHOLD_ITEMS",
        "typicalValue": {
          "min": 1,
          "max": 30,
          "typical": 8,
          "distribution": "normal"
        },
        "unit": "items",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "spoon",
        "category": "HOUSEHOLD_ITEMS",
        "typicalValue": {
          "min": 1,
          "max": 30,
          "typical": 8,
          "distribution": "normal"
        },
        "unit": "items",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "towel",
        "category": "HOUSEHOLD_ITEMS",
        "typicalValue": {
          "min": 1,
          "max": 30,
          "typical": 8,
          "distribution": "normal"
        },
        "unit": "items",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "pillow",
        "category": "HOUSEHOLD_ITEMS",
        "typicalValue": {
          "min": 1,
          "max": 30,
          "typical": 8,
          "distribution": "normal"
        },
        "unit": "items",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "book",
        "category": "HOUSEHOLD_ITEMS",
        "typicalValue": {
          "min": 1,
          "max": 30,
          "typical": 8,
          "distribution": "normal"
        },
        "unit": "items",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "toy",
        "category": "HOUSEHOLD_ITEMS",
        "typicalValue": {
          "min": 1,
          "max": 30,
          "typical": 8,
          "distribution": "normal"
        },
        "unit": "items",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "sock",
        "category": "HOUSEHOLD_ITEMS",
        "typicalValue": {
          "min": 1,
          "max": 30,
          "typical": 8,
          "distribution": "normal"
        },
        "unit": "items",
        "attributes": {
          "quality": "standard"
        }
      }
    ],
    "culturalElements": [
      {
        "type": "custom",
        "value": "household chores",
        "explanation": "Daily home activities"
      }
    ],
    "realWorldConnection": "Organizing and counting household items",
    "yearAppropriate": [
      3
    ],
    "templates": [
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "COMPARISON"
        ],
        "template": "{character} needs to tidy {items}. How many items to put away?",
        "answerTemplate": "{character} needs to put away {result} items",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "items",
            "type": "item"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      }
    ]
  }
}
# Test E.10: CELEBRATIONS theme
{
  "success": true,
  "question": {
    "text": "William is planning a {celebration}. The supplies cost £30.00, £1.00. What is the total?",
    "options": [
      {
        "text": "£44.00",
        "value": 44,
        "index": 0
      },
      {
        "text": "54",
        "value": 54,
        "index": 1
      },
      {
        "text": "30",
        "value": 30,
        "index": 2
      },
      {
        "text": "29",
        "value": 29,
        "index": 3
      }
    ],
    "correctIndex": 0,
    "format": "DIRECT_CALCULATION",
    "difficulty": {
      "year": 3,
      "subLevel": 1,
      "displayName": "3.1",
      "cognitiveLoad": 30
    },
    "cognitiveLoad": 30,
    "curriculumTags": [
      "3N1a",
      "3N1b"
    ],
    "scenario": {
      "id": "celebrations-3-1759077176248",
      "theme": "CELEBRATIONS",
      "setting": {
        "location": "party venue",
        "timeContext": "celebration planning",
        "atmosphere": "festive"
      },
      "characters": [
        {
          "name": "William",
          "role": "party organizer"
        },
        {
          "name": "Ava",
          "role": "guest"
        }
      ],
      "items": [
        {
          "name": "balloon",
          "category": "PARTY_SUPPLIES",
          "typicalValue": {
            "min": 0.5,
            "max": 20,
            "typical": 5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "cake",
          "category": "PARTY_SUPPLIES",
          "typicalValue": {
            "min": 0.5,
            "max": 20,
            "typical": 5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "present",
          "category": "PARTY_SUPPLIES",
          "typicalValue": {
            "min": 0.5,
            "max": 20,
            "typical": 5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "decoration",
          "category": "PARTY_SUPPLIES",
          "typicalValue": {
            "min": 0.5,
            "max": 20,
            "typical": 5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "party hat",
          "category": "PARTY_SUPPLIES",
          "typicalValue": {
            "min": 0.5,
            "max": 20,
            "typical": 5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "candle",
          "category": "PARTY_SUPPLIES",
          "typicalValue": {
            "min": 0.5,
            "max": 20,
            "typical": 5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        }
      ],
      "culturalElements": [
        {
          "type": "currency",
          "value": "£",
          "explanation": "British pounds for party supplies"
        },
        {
          "type": "event",
          "value": "celebration",
          "explanation": "Special occasions and festivals"
        }
      ],
      "realWorldConnection": "Planning and budgeting for celebrations",
      "yearAppropriate": [
        3
      ],
      "templates": [
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "MULTI_STEP"
          ],
          "template": "{character} is planning a {celebration}. The supplies cost {prices}. What is the total?",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "celebration",
              "type": "event"
            },
            {
              "key": "prices",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        }
      ]
    },
    "distractors": [
      {
        "value": 29,
        "displayText": "29",
        "strategy": "WRONG_OPERATION",
        "reasoning": "Subtracted instead of adding"
      },
      {
        "value": 30,
        "displayText": "30",
        "strategy": "WRONG_OPERATION",
        "reasoning": "Multiplied instead of adding"
      },
      {
        "value": 54,
        "displayText": "54",
        "strategy": "PLACE_VALUE_ERROR",
        "reasoning": "Error in carrying to next column"
      }
    ],
    "enhancementStatus": {
      "level": "partial",
      "requestedFormat": "DIRECT_CALCULATION",
      "actualFormat": "DIRECT_CALCULATION",
      "featuresActive": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "featuresPending": [],
      "isFullyEnhanced": true
    },
    "mathOutput": {
      "operation": "ADDITION",
      "operand_1": 30,
      "operand_2": 1,
      "operand_3": 13,
      "result": 44
    },
    "generationTime": 1,
    "questionId": "q_1759077176249_9vozoi154",
    "generationSetup": {
      "controller_used": "DIRECT_CALCULATIONController",
      "format_requested": "DIRECT_CALCULATION",
      "format_actual": "DIRECT_CALCULATION",
      "scenario_theme": "CELEBRATIONS",
      "scenario_id": "celebrations-3-1759077176248",
      "scenario_selection_method": "requested",
      "distractor_strategies": [
        "WRONG_OPERATION",
        "WRONG_OPERATION",
        "PLACE_VALUE_ERROR"
      ],
      "distractor_count": 3,
      "theme_variety": false,
      "format_variety": false,
      "enhancement_level": "partial",
      "features_active": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "features_pending": [],
      "generation_time_ms": 1
    }
  },
  "metadata": {
    "format": "DIRECT_CALCULATION",
    "cognitive_load": 30,
    "curriculum_alignment": [
      "3N1a",
      "3N1b"
    ],
    "difficulty": "3.1",
    "scenario_theme": "CELEBRATIONS",
    "distractor_strategies": [
      "WRONG_OPERATION",
      "WRONG_OPERATION",
      "PLACE_VALUE_ERROR"
    ],
    "generation_time_ms": 1,
    "api_version": "2.0",
    "enhancement_status": "partial",
    "format_requested": "DIRECT_CALCULATION",
    "format_used": "DIRECT_CALCULATION",
    "features_active": [
      "enhanced_distractors",
      "rich_scenarios",
      "cognitive_load",
      "advanced_formats"
    ],
    "features_pending": []
  },
  "context": {
    "id": "celebrations-3-1759077176248",
    "theme": "CELEBRATIONS",
    "setting": {
      "location": "party venue",
      "timeContext": "celebration planning",
      "atmosphere": "festive"
    },
    "characters": [
      {
        "name": "William",
        "role": "party organizer"
      },
      {
        "name": "Ava",
        "role": "guest"
      }
    ],
    "items": [
      {
        "name": "balloon",
        "category": "PARTY_SUPPLIES",
        "typicalValue": {
          "min": 0.5,
          "max": 20,
          "typical": 5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "cake",
        "category": "PARTY_SUPPLIES",
        "typicalValue": {
          "min": 0.5,
          "max": 20,
          "typical": 5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "present",
        "category": "PARTY_SUPPLIES",
        "typicalValue": {
          "min": 0.5,
          "max": 20,
          "typical": 5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "decoration",
        "category": "PARTY_SUPPLIES",
        "typicalValue": {
          "min": 0.5,
          "max": 20,
          "typical": 5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "party hat",
        "category": "PARTY_SUPPLIES",
        "typicalValue": {
          "min": 0.5,
          "max": 20,
          "typical": 5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "candle",
        "category": "PARTY_SUPPLIES",
        "typicalValue": {
          "min": 0.5,
          "max": 20,
          "typical": 5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      }
    ],
    "culturalElements": [
      {
        "type": "currency",
        "value": "£",
        "explanation": "British pounds for party supplies"
      },
      {
        "type": "event",
        "value": "celebration",
        "explanation": "Special occasions and festivals"
      }
    ],
    "realWorldConnection": "Planning and budgeting for celebrations",
    "yearAppropriate": [
      3
    ],
    "templates": [
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "MULTI_STEP"
        ],
        "template": "{character} is planning a {celebration}. The supplies cost {prices}. What is the total?",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "celebration",
            "type": "event"
          },
          {
            "key": "prices",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      }
    ]
  }
}

--- SUITE F: EDGE CASE AND ERROR HANDLING TESTS ---
Testing invalid inputs and expected error responses...
# Test F.1: Request with a non-existent model_id
{
  "error": "Unsupported model_id: FOOBAR. Supported models: ADDITION, SUBTRACTION, MULTIPLICATION, DIVISION, PERCENTAGE, FRACTION, COUNTING, TIME_RATE, CONVERSION, COMPARISON, MULTI_STEP, LINEAR_EQUATION, UNIT_RATE, COIN_RECOGNITION, CHANGE_CALCULATION, MONEY_COMBINATIONS, MIXED_MONEY_UNITS, MONEY_FRACTIONS, MONEY_SCALING, SHAPE_RECOGNITION, SHAPE_PROPERTIES, ANGLE_MEASUREMENT, POSITION_DIRECTION, AREA_PERIMETER"
}
# Test F.2: Request with an invalid difficulty_level
{
  "error": "difficulty_level must be X.Y where X=1-6 and Y=1-4"
}
# Test F.3: Request with an invalid format_preference
{
  "error": "Invalid format_preference. Valid options: DIRECT_CALCULATION, COMPARISON, ESTIMATION, ORDERING, VALIDATION, MULTI_STEP, MISSING_VALUE, PATTERN_RECOGNITION"
}
# Test F.4: Request with a dedicated broken model (TEST_BROKEN)
{
  "error": "Unsupported model_id: TEST_BROKEN. Supported models: ADDITION, SUBTRACTION, MULTIPLICATION, DIVISION, PERCENTAGE, FRACTION, COUNTING, TIME_RATE, CONVERSION, COMPARISON, MULTI_STEP, LINEAR_EQUATION, UNIT_RATE, COIN_RECOGNITION, CHANGE_CALCULATION, MONEY_COMBINATIONS, MIXED_MONEY_UNITS, MONEY_FRACTIONS, MONEY_SCALING, SHAPE_RECOGNITION, SHAPE_PROPERTIES, ANGLE_MEASUREMENT, POSITION_DIRECTION, AREA_PERIMETER"
}
# Test F.5: Request with a quantity greater than 20
{
  "error": "quantity must be between 1 and 20"
}
# Test F.6: Request missing the required model_id field
{
  "error": "model_id is required"
}

--- SUITE G: BATCH GENERATION TESTS ---
Testing the ability to generate multiple questions in one request...
# Test G.1: Request a batch of 5 questions
{
  "success": true,
  "questions": [
    {
      "text": "Charlotte is subtracting £33.00 - £24.00. What is a reasonable estimate?",
      "options": [
        {
          "text": "5.3999999999999995",
          "value": 5.3999999999999995,
          "index": 0
        },
        {
          "text": "£9.00",
          "value": 9,
          "index": 1
        },
        {
          "text": "13.5",
          "value": 13.5,
          "index": 2
        },
        {
          "text": "9",
          "value": 9,
          "index": 3
        }
      ],
      "correctIndex": 1,
      "questionContent": {
        "fullText": "Charlotte is subtracting £33.00 - £24.00. What is a reasonable estimate?",
        "templateData": {
          "character": "Charlotte",
          "operation": "is subtracting £33.00 - £24.00",
          "exactValue": "9",
          "estimatedValue": "9"
        }
      },
      "format": "ESTIMATION",
      "difficulty": {
        "year": 3,
        "subLevel": 3,
        "displayName": "3.3",
        "cognitiveLoad": 40
      },
      "cognitiveLoad": 40,
      "curriculumTags": [
        "3N1c",
        "3N1d"
      ],
      "scenario": {
        "id": "shop-002-realistic-general",
        "theme": "SHOPPING",
        "setting": {
          "location": "local shop",
          "timeContext": "after school",
          "atmosphere": "friendly"
        },
        "characters": [
          {
            "name": "Charlotte",
            "role": "student"
          }
        ],
        "items": [
          {
            "name": "apple",
            "category": "FOOD_DRINK",
            "typicalValue": {
              "min": 0.2,
              "max": 0.5,
              "typical": 0.35,
              "distribution": "normal"
            },
            "unit": "£",
            "attributes": {
              "quality": "standard"
            }
          },
          {
            "name": "banana",
            "category": "FOOD_DRINK",
            "typicalValue": {
              "min": 0.15,
              "max": 0.4,
              "typical": 0.25,
              "distribution": "normal"
            },
            "unit": "£",
            "attributes": {
              "quality": "standard"
            }
          },
          {
            "name": "sandwich",
            "category": "FOOD_DRINK",
            "typicalValue": {
              "min": 2.5,
              "max": 6,
              "typical": 4,
              "distribution": "normal"
            },
            "unit": "£",
            "attributes": {
              "quality": "standard"
            }
          },
          {
            "name": "drink",
            "category": "FOOD_DRINK",
            "typicalValue": {
              "min": 0.8,
              "max": 2.5,
              "typical": 1.5,
              "distribution": "normal"
            },
            "unit": "£",
            "attributes": {
              "quality": "standard"
            }
          },
          {
            "name": "cake",
            "category": "FOOD_DRINK",
            "typicalValue": {
              "min": 1.5,
              "max": 4,
              "typical": 2.5,
              "distribution": "normal"
            },
            "unit": "£",
            "attributes": {
              "quality": "standard"
            }
          },
          {
            "name": "biscuit",
            "category": "FOOD_DRINK",
            "typicalValue": {
              "min": 0.8,
              "max": 2,
              "typical": 1.2,
              "distribution": "normal"
            },
            "unit": "£",
            "attributes": {
              "quality": "standard"
            }
          },
          {
            "name": "sweet",
            "category": "FOOD_DRINK",
            "typicalValue": {
              "min": 0.1,
              "max": 1,
              "typical": 0.5,
              "distribution": "normal"
            },
            "unit": "£",
            "attributes": {
              "quality": "standard"
            }
          },
          {
            "name": "chocolate",
            "category": "FOOD_DRINK",
            "typicalValue": {
              "min": 0.6,
              "max": 3,
              "typical": 1.5,
              "distribution": "normal"
            },
            "unit": "£",
            "attributes": {
              "quality": "standard"
            }
          },
          {
            "name": "pen",
            "category": "SCHOOL_SUPPLIES",
            "typicalValue": {
              "min": 0.5,
              "max": 2,
              "typical": 1,
              "distribution": "normal"
            },
            "unit": "£",
            "attributes": {
              "quality": "standard"
            }
          },
          {
            "name": "pencil",
            "category": "SCHOOL_SUPPLIES",
            "typicalValue": {
              "min": 0.2,
              "max": 1,
              "typical": 0.5,
              "distribution": "normal"
            },
            "unit": "£",
            "attributes": {
              "quality": "standard"
            }
          },
          {
            "name": "ruler",
            "category": "SCHOOL_SUPPLIES",
            "typicalValue": {
              "min": 0.8,
              "max": 2.5,
              "typical": 1.5,
              "distribution": "normal"
            },
            "unit": "£",
            "attributes": {
              "quality": "standard"
            }
          },
          {
            "name": "notebook",
            "category": "SCHOOL_SUPPLIES",
            "typicalValue": {
              "min": 1,
              "max": 4,
              "typical": 2,
              "distribution": "normal"
            },
            "unit": "£",
            "attributes": {
              "quality": "standard"
            }
          },
          {
            "name": "eraser",
            "category": "SCHOOL_SUPPLIES",
            "typicalValue": {
              "min": 0.3,
              "max": 1.5,
              "typical": 0.75,
              "distribution": "normal"
            },
            "unit": "£",
            "attributes": {
              "quality": "standard"
            }
          },
          {
            "name": "book",
            "category": "BOOKS_MEDIA",
            "typicalValue": {
              "min": 3,
              "max": 15,
              "typical": 8,
              "distribution": "normal"
            },
            "unit": "£",
            "attributes": {
              "quality": "standard"
            }
          },
          {
            "name": "comic",
            "category": "BOOKS_MEDIA",
            "typicalValue": {
              "min": 2,
              "max": 5,
              "typical": 3,
              "distribution": "normal"
            },
            "unit": "£",
            "attributes": {
              "quality": "standard"
            }
          },
          {
            "name": "magazine",
            "category": "BOOKS_MEDIA",
            "typicalValue": {
              "min": 2.5,
              "max": 6,
              "typical": 4,
              "distribution": "normal"
            },
            "unit": "£",
            "attributes": {
              "quality": "standard"
            }
          },
          {
            "name": "toy",
            "category": "TOYS_GAMES",
            "typicalValue": {
              "min": 5,
              "max": 25,
              "typical": 12,
              "distribution": "normal"
            },
            "unit": "£",
            "attributes": {
              "quality": "standard"
            }
          },
          {
            "name": "game",
            "category": "TOYS_GAMES",
            "typicalValue": {
              "min": 8,
              "max": 60,
              "typical": 25,
              "distribution": "normal"
            },
            "unit": "£",
            "attributes": {
              "quality": "standard"
            }
          },
          {
            "name": "puzzle",
            "category": "TOYS_GAMES",
            "typicalValue": {
              "min": 5,
              "max": 20,
              "typical": 12,
              "distribution": "normal"
            },
            "unit": "£",
            "attributes": {
              "quality": "standard"
            }
          },
          {
            "name": "sticker",
            "category": "TOYS_GAMES",
            "typicalValue": {
              "min": 0.2,
              "max": 2,
              "typical": 0.8,
              "distribution": "normal"
            },
            "unit": "£",
            "attributes": {
              "quality": "standard"
            }
          },
          {
            "name": "badge",
            "category": "TOYS_GAMES",
            "typicalValue": {
              "min": 0.5,
              "max": 3,
              "typical": 1.5,
              "distribution": "normal"
            },
            "unit": "£",
            "attributes": {
              "quality": "standard"
            }
          },
          {
            "name": "poster",
            "category": "BOOKS_MEDIA",
            "typicalValue": {
              "min": 2,
              "max": 8,
              "typical": 4,
              "distribution": "normal"
            },
            "unit": "£",
            "attributes": {
              "quality": "standard"
            }
          },
          {
            "name": "card",
            "category": "BOOKS_MEDIA",
            "typicalValue": {
              "min": 0.5,
              "max": 4,
              "typical": 2,
              "distribution": "normal"
            },
            "unit": "£",
            "attributes": {
              "quality": "standard"
            }
          }
        ],
        "culturalElements": [
          {
            "type": "currency",
            "value": "£",
            "explanation": "British pounds"
          },
          {
            "type": "location",
            "value": "UK local shop",
            "explanation": "Typical British corner shop"
          }
        ],
        "realWorldConnection": "Everyday shopping with realistic UK prices",
        "yearAppropriate": [
          1,
          2,
          3,
          4,
          5,
          6
        ],
        "templates": [
          {
            "formatCompatibility": [
              "DIRECT_CALCULATION",
              "MULTI_STEP"
            ],
            "modelCompatibility": [
              "ADDITION"
            ],
            "operandCount": 3,
            "template": "{character} buys a {item1} for {price1}, a {item2} for {price2}, and a {item3} for {price3}. What is the total cost?",
            "answerTemplate": "The total cost is {result}",
            "placeholders": [
              {
                "key": "character",
                "type": "character"
              },
              {
                "key": "item1",
                "type": "item"
              },
              {
                "key": "item2",
                "type": "item"
              },
              {
                "key": "item3",
                "type": "item"
              },
              {
                "key": "price1",
                "type": "value"
              },
              {
                "key": "price2",
                "type": "value"
              },
              {
                "key": "price3",
                "type": "value"
              },
              {
                "key": "result",
                "type": "value"
              }
            ]
          },
          {
            "formatCompatibility": [
              "DIRECT_CALCULATION",
              "MULTI_STEP"
            ],
            "modelCompatibility": [
              "ADDITION"
            ],
            "operandCount": 2,
            "template": "{character} buys a {item1} for {price1} and a {item2} for {price2}. What is the total cost?",
            "answerTemplate": "The total cost is {result}",
            "placeholders": [
              {
                "key": "character",
                "type": "character"
              },
              {
                "key": "item1",
                "type": "item"
              },
              {
                "key": "item2",
                "type": "item"
              },
              {
                "key": "price1",
                "type": "value"
              },
              {
                "key": "price2",
                "type": "value"
              },
              {
                "key": "result",
                "type": "value"
              }
            ]
          },
          {
            "formatCompatibility": [
              "DIRECT_CALCULATION"
            ],
            "modelCompatibility": [
              "SUBTRACTION",
              "CHANGE_CALCULATION"
            ],
            "template": "{character} buys a {item} for {price} and pays with {payment}. How much change does {character} get?",
            "answerTemplate": "{character} receives {result} in change",
            "placeholders": [
              {
                "key": "character",
                "type": "character"
              },
              {
                "key": "item",
                "type": "item"
              },
              {
                "key": "price",
                "type": "value"
              },
              {
                "key": "payment",
                "type": "value"
              },
              {
                "key": "result",
                "type": "value"
              }
            ]
          },
          {
            "formatCompatibility": [
              "DIRECT_CALCULATION"
            ],
            "modelCompatibility": [
              "MULTIPLICATION"
            ],
            "template": "{character} buys {quantity} {item} at {price} each. What is the total cost?",
            "answerTemplate": "The total cost is {result}",
            "placeholders": [
              {
                "key": "character",
                "type": "character"
              },
              {
                "key": "quantity",
                "type": "value"
              },
              {
                "key": "item",
                "type": "item"
              },
              {
                "key": "price",
                "type": "value"
              },
              {
                "key": "result",
                "type": "value"
              }
            ]
          },
          {
            "formatCompatibility": [
              "DIRECT_CALCULATION"
            ],
            "modelCompatibility": [
              "DIVISION"
            ],
            "template": "{character} has {total} to spend equally on {quantity} {item}. How much can {character} spend on each one?",
            "answerTemplate": "{character} can spend {result} on each {item}",
            "placeholders": [
              {
                "key": "character",
                "type": "character"
              },
              {
                "key": "total",
                "type": "value"
              },
              {
                "key": "quantity",
                "type": "value"
              },
              {
                "key": "item",
                "type": "item"
              },
              {
                "key": "result",
                "type": "value"
              }
            ]
          },
          {
            "formatCompatibility": [
              "DIRECT_CALCULATION",
              "COMPARISON",
              "ESTIMATION",
              "MULTI_STEP"
            ],
            "template": "{character} goes to the shop and buys {items}. How much does {character} spend in total?",
            "answerTemplate": "{character} spends {result} in total",
            "placeholders": [
              {
                "key": "character",
                "type": "character"
              },
              {
                "key": "items",
                "type": "item_list"
              },
              {
                "key": "result",
                "type": "value"
              }
            ]
          },
          {
            "formatCompatibility": [
              "ESTIMATION"
            ],
            "template": "Estimate: If {character} buys {items}, about how much will it cost?",
            "answerTemplate": "It will cost approximately {result}",
            "placeholders": [
              {
                "key": "character",
                "type": "character"
              },
              {
                "key": "items",
                "type": "item_list"
              },
              {
                "key": "result",
                "type": "value"
              }
            ]
          },
          {
            "formatCompatibility": [
              "VALIDATION"
            ],
            "template": "{character} calculated that {items} costs {amount}. Is this correct?",
            "answerTemplate": "{validation_result}",
            "placeholders": [
              {
                "key": "character",
                "type": "character"
              },
              {
                "key": "items",
                "type": "item_list"
              },
              {
                "key": "amount",
                "type": "value"
              },
              {
                "key": "validation_result",
                "type": "boolean"
              }
            ]
          }
        ]
      },
      "distractors": [
        {
          "value": 9,
          "strategy": "WRONG_OPERATION",
          "rationale": "Used exact calculation instead of estimation"
        },
        {
          "value": 13.5,
          "rationale": "Overestimated significantly"
        },
        {
          "value": 5.3999999999999995,
          "rationale": "Underestimated significantly"
        }
      ],
      "enhancementStatus": {
        "level": "full",
        "requestedFormat": "ESTIMATION",
        "actualFormat": "ESTIMATION",
        "featuresActive": [
          "enhanced_distractors",
          "rich_scenarios",
          "cognitive_load",
          "advanced_formats"
        ],
        "featuresPending": [],
        "isFullyEnhanced": true
      },
      "mathOutput": {
        "operation": "SUBTRACTION",
        "minuend": 33,
        "subtrahend": 24,
        "result": 9,
        "decimal_formatted": {
          "minuend": "33",
          "subtrahend": "24",
          "result": "9"
        },
        "exactValue": 9,
        "estimatedValue": 9
      },
      "generationTime": 1,
      "questionId": "q_1759077176615_rqob4uwni",
      "generationSetup": {
        "controller_used": "ESTIMATIONController",
        "format_requested": "ESTIMATION",
        "format_actual": "ESTIMATION",
        "scenario_theme": "SHOPPING",
        "scenario_id": "shop-002-realistic-general",
        "scenario_selection_method": "default",
        "distractor_strategies": [
          "WRONG_OPERATION",
          null,
          null
        ],
        "distractor_count": 3,
        "theme_variety": false,
        "format_variety": false,
        "enhancement_level": "full",
        "features_active": [
          "enhanced_distractors",
          "rich_scenarios",
          "cognitive_load",
          "advanced_formats"
        ],
        "features_pending": [],
        "generation_time_ms": 1
      }
    },
    {
      "text": "Sarah wants to buy books at the book fair. Calculate the total cost.",
      "options": [
        {
          "text": "6",
          "value": 6,
          "index": 0
        },
        {
          "text": "111",
          "value": 111,
          "index": 1
        },
        {
          "text": "£7.00",
          "value": 7,
          "index": 2
        },
        {
          "text": "8",
          "value": 8,
          "index": 3
        }
      ],
      "correctIndex": 2,
      "format": "DIRECT_CALCULATION",
      "difficulty": {
        "year": 3,
        "subLevel": 3,
        "displayName": "3.3",
        "cognitiveLoad": 40
      },
      "cognitiveLoad": 40,
      "curriculumTags": [
        "3N1c",
        "3N1d"
      ],
      "scenario": {
        "id": "shop-001-bookfair",
        "theme": "SHOPPING",
        "setting": {
          "location": "school book fair",
          "timeContext": "lunch break",
          "atmosphere": "busy"
        },
        "characters": [
          {
            "name": "Sarah",
            "role": "student"
          },
          {
            "name": "Mr. Johnson",
            "role": "teacher"
          }
        ],
        "items": [
          {
            "name": "book",
            "category": "BOOKS_MEDIA",
            "typicalValue": {
              "min": 3,
              "max": 12,
              "typical": 6.5,
              "distribution": "normal"
            },
            "unit": "£",
            "attributes": {
              "quality": "standard"
            }
          },
          {
            "name": "bookmark",
            "category": "SCHOOL_SUPPLIES",
            "typicalValue": {
              "min": 0.5,
              "max": 2,
              "typical": 1,
              "distribution": "normal"
            },
            "unit": "£",
            "attributes": {
              "quality": "standard"
            }
          }
        ],
        "culturalElements": [
          {
            "type": "currency",
            "value": "£",
            "explanation": "British pounds"
          },
          {
            "type": "event",
            "value": "book fair",
            "explanation": "School fundraising event"
          }
        ],
        "realWorldConnection": "School fundraising and reading promotion",
        "yearAppropriate": [
          2,
          3,
          4,
          5
        ],
        "templates": [
          {
            "formatCompatibility": [
              "DIRECT_CALCULATION",
              "COMPARISON"
            ],
            "template": "{character} wants to buy books at the book fair. Calculate the total cost.",
            "answerTemplate": "The total cost is {result}",
            "placeholders": [
              {
                "key": "character",
                "type": "character"
              },
              {
                "key": "result",
                "type": "value"
              }
            ]
          }
        ]
      },
      "distractors": [
        {
          "value": 111,
          "displayText": "111",
          "strategy": "WRONG_OPERATION",
          "reasoning": "Added instead of subtracting"
        },
        {
          "value": 8,
          "displayText": "8",
          "strategy": "CLOSE_VALUE",
          "reasoning": "Off by 1"
        },
        {
          "value": 6,
          "displayText": "6",
          "strategy": "CLOSE_VALUE",
          "reasoning": "Off by 1"
        }
      ],
      "enhancementStatus": {
        "level": "partial",
        "requestedFormat": "DIRECT_CALCULATION",
        "actualFormat": "DIRECT_CALCULATION",
        "featuresActive": [
          "enhanced_distractors",
          "rich_scenarios",
          "cognitive_load",
          "advanced_formats"
        ],
        "featuresPending": [],
        "isFullyEnhanced": true
      },
      "mathOutput": {
        "operation": "SUBTRACTION",
        "minuend": 59,
        "subtrahend": 52,
        "result": 7
      },
      "generationTime": 0,
      "questionId": "q_1759077176616_goxnlufq1",
      "generationSetup": {
        "controller_used": "DIRECT_CALCULATIONController",
        "format_requested": "DIRECT_CALCULATION",
        "format_actual": "DIRECT_CALCULATION",
        "scenario_theme": "SHOPPING",
        "scenario_id": "shop-001-bookfair",
        "scenario_selection_method": "default",
        "distractor_strategies": [
          "WRONG_OPERATION",
          "CLOSE_VALUE",
          "CLOSE_VALUE"
        ],
        "distractor_count": 3,
        "theme_variety": false,
        "format_variety": false,
        "enhancement_level": "partial",
        "features_active": [
          "enhanced_distractors",
          "rich_scenarios",
          "cognitive_load",
          "advanced_formats"
        ],
        "features_pending": [],
        "generation_time_ms": 0
      }
    },
    {
      "text": "Sarah wants to buy books at the book fair. Calculate the total cost.",
      "options": [
        {
          "text": "87",
          "value": 87,
          "index": 0
        },
        {
          "text": "£77.00",
          "value": 77,
          "index": 1
        },
        {
          "text": "103",
          "value": 103,
          "index": 2
        }
      ],
      "correctIndex": 1,
      "format": "DIRECT_CALCULATION",
      "difficulty": {
        "year": 3,
        "subLevel": 3,
        "displayName": "3.3",
        "cognitiveLoad": 40
      },
      "cognitiveLoad": 40,
      "curriculumTags": [
        "3N1c",
        "3N1d"
      ],
      "scenario": {
        "id": "shop-001-bookfair",
        "theme": "SHOPPING",
        "setting": {
          "location": "school book fair",
          "timeContext": "lunch break",
          "atmosphere": "busy"
        },
        "characters": [
          {
            "name": "Sarah",
            "role": "student"
          },
          {
            "name": "Mr. Johnson",
            "role": "teacher"
          }
        ],
        "items": [
          {
            "name": "book",
            "category": "BOOKS_MEDIA",
            "typicalValue": {
              "min": 3,
              "max": 12,
              "typical": 6.5,
              "distribution": "normal"
            },
            "unit": "£",
            "attributes": {
              "quality": "standard"
            }
          },
          {
            "name": "bookmark",
            "category": "SCHOOL_SUPPLIES",
            "typicalValue": {
              "min": 0.5,
              "max": 2,
              "typical": 1,
              "distribution": "normal"
            },
            "unit": "£",
            "attributes": {
              "quality": "standard"
            }
          }
        ],
        "culturalElements": [
          {
            "type": "currency",
            "value": "£",
            "explanation": "British pounds"
          },
          {
            "type": "event",
            "value": "book fair",
            "explanation": "School fundraising event"
          }
        ],
        "realWorldConnection": "School fundraising and reading promotion",
        "yearAppropriate": [
          2,
          3,
          4,
          5
        ],
        "templates": [
          {
            "formatCompatibility": [
              "DIRECT_CALCULATION",
              "COMPARISON"
            ],
            "template": "{character} wants to buy books at the book fair. Calculate the total cost.",
            "answerTemplate": "The total cost is {result}",
            "placeholders": [
              {
                "key": "character",
                "type": "character"
              },
              {
                "key": "result",
                "type": "value"
              }
            ]
          }
        ]
      },
      "distractors": [
        {
          "value": 103,
          "displayText": "103",
          "strategy": "WRONG_OPERATION",
          "reasoning": "Added instead of subtracting"
        },
        {
          "value": 87,
          "displayText": "87",
          "strategy": "PLACE_VALUE_ERROR",
          "reasoning": "Error in carrying to next column"
        }
      ],
      "enhancementStatus": {
        "level": "partial",
        "requestedFormat": "DIRECT_CALCULATION",
        "actualFormat": "DIRECT_CALCULATION",
        "featuresActive": [
          "enhanced_distractors",
          "rich_scenarios",
          "cognitive_load",
          "advanced_formats"
        ],
        "featuresPending": [],
        "isFullyEnhanced": true
      },
      "mathOutput": {
        "operation": "SUBTRACTION",
        "minuend": 90,
        "subtrahend": 13,
        "result": 77
      },
      "generationTime": 0,
      "questionId": "q_1759077176616_0ldudoxrg",
      "generationSetup": {
        "controller_used": "DIRECT_CALCULATIONController",
        "format_requested": "DIRECT_CALCULATION",
        "format_actual": "DIRECT_CALCULATION",
        "scenario_theme": "SHOPPING",
        "scenario_id": "shop-001-bookfair",
        "scenario_selection_method": "default",
        "distractor_strategies": [
          "WRONG_OPERATION",
          "PLACE_VALUE_ERROR"
        ],
        "distractor_count": 2,
        "theme_variety": false,
        "format_variety": false,
        "enhancement_level": "partial",
        "features_active": [
          "enhanced_distractors",
          "rich_scenarios",
          "cognitive_load",
          "advanced_formats"
        ],
        "features_pending": [],
        "generation_time_ms": 0
      }
    }
  ],
  "metadata": {
    "format": "ESTIMATION",
    "cognitive_load": 40,
    "curriculum_alignment": [
      "3N1c",
      "3N1d"
    ],
    "difficulty": "3.3",
    "scenario_theme": "SHOPPING",
    "distractor_strategies": [],
    "generation_time_ms": 109,
    "enhancement_status": "full",
    "format_used": "ESTIMATION",
    "features_active": [
      "enhanced_distractors",
      "rich_scenarios",
      "cognitive_load",
      "advanced_formats"
    ],
    "features_pending": [],
    "api_version": "2.0"
  },
  "batch_info": {
    "total_questions": 5,
    "avg_generation_time": 21.8,
    "success_rate": 0.6
  }
}

--- API TEST SUITE COMPLETE ---
