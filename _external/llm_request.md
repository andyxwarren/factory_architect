

--- START FILE: app\api\generate\route.ts ---
```typescript
import { NextRequest, NextResponse } from 'next/server';
import { generateMathQuestion, getModel } from '@/lib/math-engine';
import { StoryEngine } from '@/lib/story-engine/story.engine';
import { MoneyContextGenerator } from '@/lib/story-engine/contexts/money.context';
import { GenerateRequest, GeneratedQuestion } from '@/lib/types';

export async function POST(req: NextRequest) {
  try {
    const body: GenerateRequest = await req.json();
    const { model_id, difficulty_params, context_type = 'money', year_level = 4 } = body;

    // Validate model exists
    const modelIds = ['ADDITION', 'SUBTRACTION', 'MULTIPLICATION', 'DIVISION', 'PERCENTAGE', 
                     'FRACTION', 'COUNTING', 'TIME_RATE', 'CONVERSION', 'COMPARISON',
                     'MULTI_STEP', 'LINEAR_EQUATION', 'UNIT_RATE',
                     'COIN_RECOGNITION', 'CHANGE_CALCULATION', 'MONEY_COMBINATIONS',
                     'MIXED_MONEY_UNITS', 'MONEY_FRACTIONS', 'MONEY_SCALING'];
    if (!modelIds.includes(model_id)) {
      return NextResponse.json(
        { error: `Invalid model_id: ${model_id}` },
        { status: 400 }
      );
    }

    // Generate math output
    const mathOutput = generateMathQuestion(
      model_id as any,
      year_level,
      difficulty_params
    );

    // Generate context based on type
    let context;
    switch (context_type) {
      case 'money':
        context = MoneyContextGenerator.generate(model_id);
        break;
      default:
        context = MoneyContextGenerator.generate(model_id);
    }

    // Generate question and answer using Story Engine
    const storyEngine = new StoryEngine();
    const question = storyEngine.generateQuestion(mathOutput, context);
    const answer = storyEngine.generateAnswer(mathOutput, context);

    const response: GeneratedQuestion = {
      question,
      answer,
      math_output: mathOutput,
      context,
      metadata: {
        model_id,
        year_level,
        difficulty_params: difficulty_params || getModel(model_id as any).getDefaultParams(year_level),
        timestamp: new Date()
      }
    };

    return NextResponse.json(response);
  } catch (error) {
    console.error('Error generating question:', error);
    return NextResponse.json(
      { error: 'Failed to generate question', details: error instanceof Error ? error.message : 'Unknown error' },
      { status: 500 }
    );
  }
}

export async function GET() {
  return NextResponse.json({
    message: 'Question Generation API',
    endpoints: {
      POST: {
        description: 'Generate a question',
        body: {
          model_id: 'string (required) - ADDITION, SUBTRACTION, MULTIPLICATION, DIVISION, PERCENTAGE',
          year_level: 'number (optional) - 1 to 6',
          difficulty_params: 'object (optional) - Custom difficulty parameters',
          context_type: 'string (optional) - money, measurement, etc.'
        }
      }
    }
  });
}
```
--- END FILE: app\api\generate\route.ts ---

--- START FILE: app\globals.css ---
```css
@import "tailwindcss";

:root {
  --background: #ffffff;
  --foreground: #171717;
}

@theme inline {
  --color-background: var(--background);
  --color-foreground: var(--foreground);
  --font-sans: var(--font-geist-sans);
  --font-mono: var(--font-geist-mono);
}

@media (prefers-color-scheme: dark) {
  :root {
    --background: #0a0a0a;
    --foreground: #ededed;
  }
}

body {
  background: var(--background);
  color: var(--foreground);
  font-family: Arial, Helvetica, sans-serif;
}

```
--- END FILE: app\globals.css ---

--- START FILE: app\layout.tsx ---
```typescript
import type { Metadata } from "next";
import { Geist, Geist_Mono } from "next/font/google";
import "./globals.css";

const geistSans = Geist({
  variable: "--font-geist-sans",
  subsets: ["latin"],
});

const geistMono = Geist_Mono({
  variable: "--font-geist-mono",
  subsets: ["latin"],
});

export const metadata: Metadata = {
  title: "Create Next App",
  description: "Generated by create next app",
};

export default function RootLayout({
  children,
}: Readonly<{
  children: React.ReactNode;
}>) {
  return (
    <html lang="en">
      <body
        className={`${geistSans.variable} ${geistMono.variable} antialiased`}
      >
        {children}
      </body>
    </html>
  );
}

```
--- END FILE: app\layout.tsx ---

--- START FILE: app\page.tsx ---
```typescript
import Link from 'next/link';

export default function Home() {
  return (
    <div className="min-h-screen bg-gray-50">
      <div className="max-w-4xl mx-auto px-4 py-12">
        <header className="text-center mb-12">
          <h1 className="text-4xl font-bold text-gray-900 mb-4">
            Factory Architect
          </h1>
          <p className="text-xl text-gray-600 max-w-2xl mx-auto">
            Educational Mathematics Question Generator for UK National Curriculum
          </p>
        </header>

        <div className="grid md:grid-cols-2 gap-8 mb-12">
          <div className="bg-white rounded-lg shadow-md p-6">
            <h2 className="text-2xl font-semibold mb-4">Math Engine</h2>
            <p className="text-gray-600 mb-4">
              Pure mathematical models that operate on numbers and logical parameters.
              Each operation is atomic and separate from narrative context.
            </p>
            <ul className="text-sm text-gray-600 space-y-1">
              <li>✓ Addition - Summing arrays of values</li>
              <li>✓ Subtraction - Finding differences</li>
              <li>✓ Multiplication - Computing products</li>
              <li>✓ Division - Quotients and remainders</li>
              <li>✓ Percentage - Calculations and comparisons</li>
              <li>✓ Fraction - Finding fractions of amounts</li>
              <li>✓ Counting - Coin combinations and counting</li>
              <li>✓ Time Rate - Savings over time periods</li>
              <li>✓ Conversion - Unit conversions (£/p, m/cm)</li>
              <li>✓ Comparison - Value and rate comparisons</li>
              <li className="text-gray-400">○ Multi-Step - Operation sequences</li>
              <li className="text-gray-400">○ Linear Equations - y = mx + c</li>
              <li className="text-gray-400">○ Unit Rate - Rate calculations</li>
            </ul>
          </div>

          <div className="bg-white rounded-lg shadow-md p-6">
            <h2 className="text-2xl font-semibold mb-4">Story Engine</h2>
            <p className="text-gray-600 mb-4">
              Contextual layer that wraps mathematical output with real-world scenarios.
              Same math can be presented as money, measurements, or other contexts.
            </p>
            <ul className="text-sm text-gray-600 space-y-1">
              <li>✓ Money contexts - Shopping, change, savings</li>
              <li>✓ Dynamic question templates</li>
              <li>✓ Year-appropriate difficulty scaling</li>
              <li>✓ UK National Curriculum aligned</li>
              <li className="text-gray-400">○ Measurement contexts</li>
              <li className="text-gray-400">○ Time-based scenarios</li>
              <li className="text-gray-400">○ Multi-language support</li>
            </ul>
          </div>
        </div>

        <div className="bg-white rounded-lg shadow-md p-6 mb-8">
          <h2 className="text-2xl font-semibold mb-4">Key Features</h2>
          <div className="grid md:grid-cols-3 gap-6">
            <div>
              <h3 className="font-semibold text-lg mb-2">Separation of Concerns</h3>
              <p className="text-gray-600 text-sm">
                Mathematical logic completely separated from story context for maximum flexibility.
              </p>
            </div>
            <div>
              <h3 className="font-semibold text-lg mb-2">Difficulty Scaling</h3>
              <p className="text-gray-600 text-sm">
                Questions adapt to Years 1-6 with progressive complexity and appropriate parameters.
              </p>
            </div>
            <div>
              <h3 className="font-semibold text-lg mb-2">Context Flexibility</h3>
              <p className="text-gray-600 text-sm">
                Same mathematical output can be wrapped in different real-world scenarios.
              </p>
            </div>
          </div>
        </div>

        <div className="text-center">
          <Link 
            href="/test" 
            className="inline-block bg-blue-600 text-white px-8 py-3 rounded-lg text-lg font-semibold hover:bg-blue-700 transition-colors"
          >
            Try the Testing Interface
          </Link>
        </div>

        <div className="mt-12 bg-gray-100 rounded-lg p-6">
          <h2 className="text-xl font-semibold mb-4">API Usage</h2>
          <p className="text-gray-600 mb-4">
            Generate questions programmatically using our REST API:
          </p>
          <div className="bg-gray-800 text-green-400 p-4 rounded-md text-sm font-mono">
            <p className="mb-2">POST /api/generate</p>
            <p className="text-gray-300">
              {`{
  "model_id": "ADDITION",
  "year_level": 4,
  "context_type": "money"
}`}
            </p>
          </div>
        </div>
      </div>
    </div>
  );
}

```
--- END FILE: app\page.tsx ---

--- START FILE: app\test\page.tsx ---
```typescript
'use client';

import { useState, useEffect } from 'react';
import { GeneratedQuestion } from '@/lib/types';
import { MODEL_STATUS_REGISTRY, ModelStatus, getCompletionStats } from '@/lib/models/model-status';
import { curriculumParser, CurriculumFilter } from '@/lib/curriculum/curriculum-parser';
import { curriculumModelMapper } from '@/lib/curriculum/curriculum-model-mapping';

type FilterMode = 'model' | 'curriculum';

const YEARS = [1, 2, 3, 4, 5, 6];

export default function TestPage() {
  // Filter mode state
  const [filterMode, setFilterMode] = useState<FilterMode>('model');
  
  // Model-first filtering
  const [selectedModel, setSelectedModel] = useState('ADDITION');
  const [selectedYear, setSelectedYear] = useState(4);
  
  // Curriculum-first filtering
  const [selectedStrand, setSelectedStrand] = useState('');
  const [selectedSubstrand, setSelectedSubstrand] = useState('');
  const [selectedCurriculumYear, setSelectedCurriculumYear] = useState(1);
  const [curriculumFilter, setCurriculumFilter] = useState<CurriculumFilter | null>(null);
  const [suggestedModels, setSuggestedModels] = useState<string[]>([]);
  
  // Curriculum data
  const [strands, setStrands] = useState<string[]>([]);
  const [substrands, setSubstrands] = useState<string[]>([]);
  const [availableYears, setAvailableYears] = useState<number[]>([]);
  
  // Question state
  const [generatedQuestion, setGeneratedQuestion] = useState<GeneratedQuestion | null>(null);
  const [loading, setLoading] = useState(false);
  const [error, setError] = useState<string | null>(null);
  const [showAnswer, setShowAnswer] = useState(false);
  const [questionHistory, setQuestionHistory] = useState<GeneratedQuestion[]>([]);

  // Initialize curriculum data
  useEffect(() => {
    const allStrands = curriculumParser.getStrands();
    setStrands(allStrands);
    if (allStrands.length > 0 && !selectedStrand) {
      setSelectedStrand(allStrands[0]);
    }
  }, []);

  // Update substrands when strand changes
  useEffect(() => {
    if (selectedStrand) {
      const strandSubstrands = curriculumParser.getSubstrands(selectedStrand);
      setSubstrands(strandSubstrands);
      if (strandSubstrands.length > 0) {
        setSelectedSubstrand(strandSubstrands[0]);
      }
    }
  }, [selectedStrand]);

  // Update available years when substrand changes
  useEffect(() => {
    if (selectedStrand && selectedSubstrand) {
      const years = curriculumParser.getAvailableYears(selectedStrand, selectedSubstrand);
      setAvailableYears(years);
      if (years.length > 0) {
        setSelectedCurriculumYear(years[0]);
      }
    }
  }, [selectedStrand, selectedSubstrand]);

  // Update curriculum filter and suggested models
  useEffect(() => {
    if (selectedStrand && selectedSubstrand && selectedCurriculumYear) {
      const filter = curriculumParser.getCurriculumDescription(
        selectedStrand,
        selectedSubstrand,
        selectedCurriculumYear
      );
      setCurriculumFilter(filter);
      
      if (filter) {
        const suggested = curriculumModelMapper.getSuggestedModels(filter);
        setSuggestedModels(suggested);
      }
    }
  }, [selectedStrand, selectedSubstrand, selectedCurriculumYear]);

  const generateQuestion = async (modelId?: string, yearLevel?: number) => {
    const model = modelId || (filterMode === 'model' ? selectedModel : suggestedModels[0]);
    const year = yearLevel || (filterMode === 'model' ? selectedYear : selectedCurriculumYear);
    
    if (!model) {
      setError('No model selected or available');
      return;
    }

    setLoading(true);
    setError(null);
    setShowAnswer(false);

    try {
      const response = await fetch('/api/generate', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({
          model_id: model,
          year_level: year,
          context_type: 'money'
        }),
      });

      if (!response.ok) {
        throw new Error(`Failed to generate question: ${response.statusText}`);
      }

      const data: GeneratedQuestion = await response.json();
      setGeneratedQuestion(data);
      setQuestionHistory(prev => [data, ...prev.slice(0, 9)]);
    } catch (err) {
      setError(err instanceof Error ? err.message : 'An error occurred');
    } finally {
      setLoading(false);
    }
  };

  const getModelStatusBadge = (modelId: string) => {
    const modelInfo = MODEL_STATUS_REGISTRY[modelId];
    if (!modelInfo) return null;

    const statusColors = {
      [ModelStatus.COMPLETE]: 'bg-green-100 text-green-800 border-green-200',
      [ModelStatus.WIP]: 'bg-yellow-100 text-yellow-800 border-yellow-200',
      [ModelStatus.BROKEN]: 'bg-red-100 text-red-800 border-red-200',
      [ModelStatus.PLANNED]: 'bg-gray-100 text-gray-800 border-gray-200'
    };

    const statusLabels = {
      [ModelStatus.COMPLETE]: '✓',
      [ModelStatus.WIP]: 'WIP',
      [ModelStatus.BROKEN]: '⚠',
      [ModelStatus.PLANNED]: '○'
    };

    return (
      <span className={`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium border ${statusColors[modelInfo.status]}`}>
        {statusLabels[modelInfo.status]}
      </span>
    );
  };

  const getModelDisplayName = (modelId: string) => {
    const modelInfo = MODEL_STATUS_REGISTRY[modelId];
    return modelInfo ? modelInfo.name : modelId.replace('_', ' ');
  };

  const isModelDisabled = (modelId: string) => {
    const modelInfo = MODEL_STATUS_REGISTRY[modelId];
    return modelInfo?.status === ModelStatus.BROKEN;
  };

  const completionStats = getCompletionStats();

  return (
    <div className="min-h-screen bg-gray-50 py-8">
      <div className="max-w-6xl mx-auto px-4">
        {/* Header */}
        <div className="mb-8">
          <h1 className="text-3xl font-bold text-gray-900 mb-2">Mathematics Question Generator</h1>
          <div className="flex items-center gap-4 text-sm text-gray-600">
            <span>Total Models: {completionStats.total}</span>
            <span className="text-green-600">Complete: {completionStats.complete}</span>
            <span className="text-yellow-600">WIP: {completionStats.wip}</span>
            <span className="text-red-600">Broken: {completionStats.broken}</span>
            <span className="font-medium">{completionStats.completionPercentage}% Ready</span>
          </div>
        </div>

        <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
          {/* Controls Panel */}
          <div className="lg:col-span-1">
            <div className="bg-white rounded-lg shadow-sm border p-6">
              <h2 className="text-lg font-semibold mb-4">Question Generator</h2>
              
              {/* Filter Mode Toggle */}
              <div className="mb-6">
                <div className="flex bg-gray-100 rounded-lg p-1">
                  <button
                    onClick={() => setFilterMode('model')}
                    className={`flex-1 py-2 px-3 rounded-md text-sm font-medium transition-colors ${
                      filterMode === 'model' 
                        ? 'bg-white text-gray-900 shadow-sm' 
                        : 'text-gray-600 hover:text-gray-900'
                    }`}
                  >
                    Browse by Model
                  </button>
                  <button
                    onClick={() => setFilterMode('curriculum')}
                    className={`flex-1 py-2 px-3 rounded-md text-sm font-medium transition-colors ${
                      filterMode === 'curriculum' 
                        ? 'bg-white text-gray-900 shadow-sm' 
                        : 'text-gray-600 hover:text-gray-900'
                    }`}
                  >
                    Browse by Curriculum
                  </button>
                </div>
              </div>

              {/* Model-First Filtering */}
              {filterMode === 'model' && (
                <div className="space-y-4">
                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-2">
                      Mathematical Model
                    </label>
                    <select
                      value={selectedModel}
                      onChange={(e) => setSelectedModel(e.target.value)}
                      className="w-full p-2 border rounded-md bg-white"
                      disabled={loading}
                    >
                      {Object.keys(MODEL_STATUS_REGISTRY).map(modelId => (
                        <option key={modelId} value={modelId} disabled={isModelDisabled(modelId)}>
                          {getModelDisplayName(modelId)} {isModelDisabled(modelId) ? '(Broken)' : ''}
                        </option>
                      ))}
                    </select>
                    <div className="mt-2 flex items-center gap-2">
                      {getModelStatusBadge(selectedModel)}
                      {MODEL_STATUS_REGISTRY[selectedModel]?.knownIssues && (
                        <span className="text-xs text-gray-500">
                          Known issues: {MODEL_STATUS_REGISTRY[selectedModel]?.knownIssues?.length}
                        </span>
                      )}
                    </div>
                  </div>

                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-2">
                      Year Level
                    </label>
                    <select
                      value={selectedYear}
                      onChange={(e) => setSelectedYear(parseInt(e.target.value))}
                      className="w-full p-2 border rounded-md bg-white"
                      disabled={loading}
                    >
                      {YEARS.filter(year => 
                        MODEL_STATUS_REGISTRY[selectedModel]?.supportedYears.includes(year)
                      ).map(year => (
                        <option key={year} value={year}>Year {year}</option>
                      ))}
                    </select>
                  </div>

                  {MODEL_STATUS_REGISTRY[selectedModel] && (
                    <div className="mt-4 p-3 bg-gray-50 rounded-md text-sm">
                      <p className="font-medium">{MODEL_STATUS_REGISTRY[selectedModel].name}</p>
                      <p className="text-gray-600 mt-1">{MODEL_STATUS_REGISTRY[selectedModel].description}</p>
                      <p className="text-xs text-gray-500 mt-2">
                        Curriculum areas: {MODEL_STATUS_REGISTRY[selectedModel].curriculumAreas.join(', ')}
                      </p>
                    </div>
                  )}
                </div>
              )}

              {/* Curriculum-First Filtering */}
              {filterMode === 'curriculum' && (
                <div className="space-y-4">
                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-2">
                      Curriculum Strand
                    </label>
                    <select
                      value={selectedStrand}
                      onChange={(e) => setSelectedStrand(e.target.value)}
                      className="w-full p-2 border rounded-md bg-white"
                      disabled={loading}
                    >
                      {strands.map((strand, index) => (
                        <option key={`strand-${index}-${strand}`} value={strand}>{strand}</option>
                      ))}
                    </select>
                  </div>

                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-2">
                      Substrand
                    </label>
                    <select
                      value={selectedSubstrand}
                      onChange={(e) => setSelectedSubstrand(e.target.value)}
                      className="w-full p-2 border rounded-md bg-white"
                      disabled={loading}
                    >
                      {substrands.map((substrand, index) => (
                        <option key={`substrand-${index}-${substrand}`} value={substrand}>{substrand}</option>
                      ))}
                    </select>
                  </div>

                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-2">
                      Year Level
                    </label>
                    <select
                      value={selectedCurriculumYear}
                      onChange={(e) => setSelectedCurriculumYear(parseInt(e.target.value))}
                      className="w-full p-2 border rounded-md bg-white"
                      disabled={loading}
                    >
                      {availableYears.map((year, index) => (
                        <option key={`year-${index}-${year}`} value={year}>Year {year}</option>
                      ))}
                    </select>
                  </div>

                  {curriculumFilter && (
                    <div className="mt-4 p-3 bg-blue-50 rounded-md text-sm">
                      <p className="font-medium text-blue-900">UK Curriculum Requirement</p>
                      <p className="text-blue-800 mt-1">{curriculumFilter.description}</p>
                      <p className="text-xs text-blue-600 mt-2">
                        Reference: {curriculumFilter.contentDomainRef}
                      </p>
                    </div>
                  )}

                  {suggestedModels.length > 0 && (
                    <div className="mt-4">
                      <p className="text-sm font-medium text-gray-700 mb-2">Suggested Models</p>
                      <div className="flex flex-wrap gap-1">
                        {suggestedModels.map(modelId => (
                          <button
                            key={modelId}
                            onClick={() => generateQuestion(modelId, selectedCurriculumYear)}
                            disabled={loading || isModelDisabled(modelId)}
                            className={`px-2 py-1 text-xs rounded-md border flex items-center gap-1 ${
                              isModelDisabled(modelId)
                                ? 'bg-gray-100 text-gray-400 cursor-not-allowed'
                                : 'bg-white text-gray-700 hover:bg-gray-50'
                            }`}
                          >
                            {getModelDisplayName(modelId)}
                            {getModelStatusBadge(modelId)}
                          </button>
                        ))}
                      </div>
                    </div>
                  )}
                </div>
              )}

              {/* Generate Button */}
              <button
                onClick={() => generateQuestion()}
                disabled={loading || (filterMode === 'curriculum' && suggestedModels.length === 0) || (filterMode === 'model' && isModelDisabled(selectedModel))}
                className="w-full mt-6 bg-blue-600 text-white py-2 px-4 rounded-md hover:bg-blue-700 disabled:bg-gray-300 disabled:cursor-not-allowed"
              >
                {loading ? 'Generating...' : 'Generate Question'}
              </button>
            </div>
          </div>

          {/* Question Display */}
          <div className="lg:col-span-2">
            <div className="bg-white rounded-lg shadow-sm border p-6">
              <h2 className="text-lg font-semibold mb-4">Generated Question</h2>
              
              {error && (
                <div className="mb-4 p-3 bg-red-50 border border-red-200 rounded-md text-red-700">
                  {error}
                </div>
              )}

              {generatedQuestion && (
                <div>
                  <div className="mb-4 p-4 bg-gray-50 rounded-md">
                    <p className="text-lg font-medium">{generatedQuestion.question}</p>
                  </div>

                  <div className="flex items-center justify-between mb-4">
                    <button
                      onClick={() => setShowAnswer(!showAnswer)}
                      className="px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700"
                    >
                      {showAnswer ? 'Hide Answer' : 'Show Answer'}
                    </button>
                    
                    <div className="text-sm text-gray-500">
                      Model: {generatedQuestion.metadata.model_id} | Year: {generatedQuestion.metadata.year_level}
                    </div>
                  </div>

                  {showAnswer && (
                    <div className="mb-4 p-4 bg-green-50 border border-green-200 rounded-md">
                      <p className="text-lg font-semibold text-green-800">
                        Answer: {generatedQuestion.answer}
                      </p>
                    </div>
                  )}

                  <details className="mt-4">
                    <summary className="cursor-pointer text-sm font-medium text-gray-700 hover:text-gray-900">
                      Technical Details
                    </summary>
                    <pre className="mt-2 text-xs bg-gray-100 p-3 rounded-md overflow-auto">
                      {JSON.stringify(generatedQuestion, null, 2)}
                    </pre>
                  </details>
                </div>
              )}

              {!generatedQuestion && !loading && !error && (
                <div className="text-center py-12 text-gray-500">
                  <p>Select your preferences above and click "Generate Question" to start.</p>
                </div>
              )}

              {loading && (
                <div className="text-center py-12">
                  <div className="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"></div>
                  <p className="mt-2 text-gray-500">Generating your question...</p>
                </div>
              )}
            </div>

            {/* Question History */}
            {questionHistory.length > 0 && (
              <div className="mt-6 bg-white rounded-lg shadow-sm border p-6">
                <h3 className="text-lg font-semibold mb-4">Recent Questions</h3>
                <div className="space-y-3">
                  {questionHistory.slice(0, 5).map((q, index) => (
                    <div key={index} className="p-3 bg-gray-50 rounded-md">
                      <p className="text-sm">{q.question}</p>
                      <div className="mt-1 text-xs text-gray-500">
                        {q.metadata.model_id} | Year {q.metadata.year_level}
                      </div>
                    </div>
                  ))}
                </div>
              </div>
            )}
          </div>
        </div>
      </div>
    </div>
  );
}
```
--- END FILE: app\test\page.tsx ---

--- START FILE: CLAUDE.md ---
```markdown
# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

Factory Architect is a TypeScript-based educational question generator for UK National Curriculum Mathematics. The project implements a sophisticated two-engine architecture:

- **Math Engine**: Pure mathematical models that operate on numbers and logical parameters
- **Story Engine**: Contextual layer that wraps mathematical output with real-world scenarios

## Project Architecture

### Core Design Principles

1. **Separation of Concerns**: Mathematical logic is completely separated from narrative context
2. **Atomic Models**: Each mathematical operation (ADDITION, SUBTRACTION, MULTIPLICATION, DIVISION, etc.) is its own standalone model
3. **Difficulty Scaling**: Questions can be incrementally adjusted by manipulating numerical parameters
4. **Context Flexibility**: Same mathematical output can be wrapped with different story contexts (money, measurements, objects, etc.)

### Planned Directory Structure

```
src/
├── lib/
│   ├── math-engine/
│   │   ├── models/           # Individual mathematical models
│   │   ├── difficulty.ts     # Difficulty progression logic
│   │   └── index.ts         # Math engine exports
│   ├── story-engine/
│   │   ├── contexts/         # Story context libraries
│   │   ├── templates/        # Question templates
│   │   └── story.engine.ts   # Story rendering logic
│   ├── types.ts             # TypeScript interfaces
│   └── utils.ts             # Utility functions
├── app/
│   ├── api/
│   │   ├── generate/         # Question generation API
│   │   ├── test/            # Model testing API
│   │   └── models/          # Model information API
│   ├── test/                # Web UI for testing models
│   └── page.tsx             # Main dashboard
└── components/              # UI components
```

## Mathematical Models

The system implements these atomic mathematical models:

1. **ADDITION** - Summing arrays of numerical values
2. **SUBTRACTION** - Finding differences between values
3. **MULTIPLICATION** - Computing products
4. **DIVISION** - Dividing with quotients and remainders
5. **MULTI_STEP** - Sequencing multiple operations
6. **LINEAR_EQUATION** - Evaluating `y = mx + c` functions
7. **PERCENTAGE** - Percentage calculations and comparisons
8. **UNIT_RATE** - Rate calculations and value comparisons

Each model has:
- Difficulty parameters (max_value, decimal_places, etc.)
- Progression logic (Year 1-6 complexity scaling)
- JSON output contracts for the Story Engine
- Required context variables for story wrapping

## Key Implementation Notes

### Development Framework
- **Next.js** with TypeScript and Tailwind CSS
- **API Routes** for question generation and testing
- **Web Interface** for interactive model testing and parameter adjustment

### Testing Strategy
- Each mathematical model should have comprehensive unit tests
- Web interface provides real-time testing and parameter adjustment
- Batch testing capabilities for validation and performance analysis

### Context System
The project uses context libraries organized by theme:
- `money.context.ts` - Currency-based scenarios
- `length.context.ts` - Measurement scenarios  
- `weight.context.ts` - Mass/weight scenarios

### Curriculum Compliance
- Aligned with UK National Curriculum Framework (Years 1-6)
- Question difficulty scales according to year-level expectations
- Comprehensive coverage of mathematical strands and sub-strands

## Development Commands

This is a Next.js project. Common commands:

```bash
npm run dev      # Start development server
npm run build    # Build for production
npm run start    # Start production server
npm run lint     # Run ESLint
npm run test     # Run tests (when implemented)
```

## Testing Interface

Access the model testing interface at `/test` when running the development server. This provides:
- Interactive parameter controls for each mathematical model
- Real-time question generation and preview
- Batch testing with statistical analysis
- Export functionality for generated questions

## Key Files

- `context/national_curriculum_framework.json` - Complete UK maths curriculum data
- `context/example_questions.json` - Example questions by curriculum strand
- `context/factory_blueprint_*.md` - Architectural design documentation
- `context/implementation_next_steps.md` - Detailed implementation guide

## Development Workflow

1. Implement mathematical models in `src/lib/math-engine/models/`
2. Test models via the web interface at `/test`
3. Create context libraries for different story themes
4. Build story templates and rendering logic
5. Integrate with the main generation service

The project prioritizes educational accuracy, scalable question generation, and flexible difficulty progression to support diverse learning needs across UK primary mathematics education.
```
--- END FILE: CLAUDE.md ---

--- START FILE: context\example_questions.json ---
```json
{
  "compare_describe_and_order_measures": {
    "Year 1": [
      "Which is longer, a pencil or a classroom table?",
      "Which is heavier, a book or a feather?",
      "If you have a full glass of water and an empty glass of water, which has more?",
      "Who is taller, you or your teacher?",
      "Which animal is slower, a snail or a cheetah?",
      "Which is shorter, your finger or your leg?",
      "Hold a crayon in one hand and a bottle of water in the other. Which one is lighter?",
      "Look at two plant pots. Which one do you think can hold more soil?",
      "Which takes longer to do: brushing your teeth or eating your dinner?",
      "Is a giraffe taller or shorter than a cat?",
      "Which is heavier, a school bag full of books or an empty school bag?",
      "If you pour all the water from a small cup into a large bucket, which will look fuller?",
      "Is it quicker to walk to the end of the corridor or to hop?",
      "Which is longer, a car or a bus?",
      "Which is lighter, a balloon or an apple?",
      "Compare your lunchbox to a friend's. Which one is bigger?",
      "Who is the tallest person in your class? Who is the shortest?",
      "Order three friends by height, from shortest to tallest.",
      "Which is heavier, a potato or a bag of potatoes?",
      "Does a teaspoon hold more or less liquid than a mug?",
      "Which is faster, a running person or a person walking?",
      "Is a lamppost taller or shorter than a house?",
      "Put these in order of length, from shortest to longest: a paperclip, a pencil, a whiteboard.",
      "Which holds more water, a bathtub or a swimming pool?",
      "Which would take less time, singing a song or watching a film?",
      "Which container holds less: a water bottle or a paddling pool?",
      "Is a ruler longer or shorter than your arm?",
      "Which is heavier: a single grape or a bunch of grapes?",
      "Does it take a longer time to draw a picture or to write your name?",
      "Who is shorter: you or a baby?",
      "Which is lighter: a chair or a table?",
      "Does a bucket hold more or less than a teacup?",
      "Is it quicker to clap your hands once or to tie your shoelaces?",
      "Which animal is taller: a mouse or an elephant?",
      "Which is heavier: a feather pillow or a pile of bricks?",
      "Put these in order of time taken, from quickest to slowest: eating an apple, reading a book, blinking.",
      "Is a tree taller or shorter than a flower?",
      "Which holds more juice: a small carton or a large bottle?",
      "Which is lighter: a coin or a wallet full of coins?",
      "Is it slower to crawl or to run?",
      "Which is longer: a worm or a snake?",
      "Which is heavier: a single piece of paper or a whole notebook?",
      "Does a jug hold more or less water than a spoon?",
      "Who is taller: the school's headteacher or a student in Year 1?",
      "Which takes a shorter time: counting to 10 or counting to 100?",
      "Is a bus longer or shorter than a bicycle?",
      "Which is lighter: your school jumper or your winter coat?",
      "Compare the capacity of your water bottle and your lunch box. Which holds more?",
      "Order these from slowest to fastest: a tortoise, a person walking, a car on the motorway.",
      "Which is shorter: a pen or a crayon?"
    ],
    "Year 2": [
      "Order these lengths from shortest to longest: 15cm, 8cm, 21cm, 12cm.",
      "Use the symbols <, >, or = to compare the following: 500g ___ 1kg.",
      "A bottle holds 1 litre of juice. A glass holds 200ml. Which holds more?",
      "Put these masses in order from lightest to heaviest: 25g, 1kg, 50g, 250g.",
      "Circle the longest time: 1 hour, 30 minutes, 70 minutes, half an hour.",
      "Order these masses from heaviest to lightest: 1kg, 500g, 750g, 2kg.",
      "Use the symbols <, >, or = to compare: 1 litre ___ 1000ml.",
      "A snake is 50cm long. A lizard is 55cm long. Which is shorter?",
      "A jug contains 500ml of squash. A glass contains 250ml. Which contains less?",
      "Put these lengths in order from longest to shortest: 2m, 150cm, 1m, 210cm.",
      "Use the symbols <, >, or = to compare: 30cm ___ 25cm.",
      "A bag of apples weighs 1kg. A bag of grapes weighs 900g. Which is heavier?",
      "Circle the smallest capacity: 300ml, 1 litre, 200ml, 50ml.",
      "Order these heights: Ben is 125cm tall, Sarah is 119cm tall, Tom is 130cm tall.",
      "Use the symbols <, >, or = to compare: 100g ___ 1kg.",
      "A red ribbon is 45cm long. A blue ribbon is half a metre long. Which is longer?",
      "A bottle of pop is 2 litres. A carton of juice is 1 litre. How much more does the pop bottle hold?",
      "Arrange these weights in ascending order: 3kg, 300g, 1kg, 2500g.",
      "Which is longer, the school hall or the classroom?",
      "Use the symbols <, >, or = to compare: 75ml ___ 750ml.",
      "A pencil is 15cm long. A crayon is 9cm long. Which is shorter?",
      "Sam weighs 25kg. His dog weighs 30kg. Who is lighter?",
      "Order these capacities from smallest to largest: 1 litre, 50ml, 500ml, 2 litres.",
      "Use the symbols <, >, or = to compare: 1m 10cm ___ 120cm.",
      "Is a 30-minute cartoon longer or shorter than a 1-hour film?",
      "Use the symbols <, >, or = to compare: 25cm ___ a quarter of a metre.",
      "Put these capacities in descending order: 1 litre, 1200ml, 900ml, 1.5 litres.",
      "Which is heavier, 200g of feathers or 200g of stones? Use the = sign.",
      "Order these times from shortest to longest: 45 minutes, 1 hour, 25 minutes, half an hour.",
      "A rope is 2 metres long. Another rope is 180cm long. Which is longer?",
      "Use the symbols <, >, or = to compare: 750g ___ three quarters of a kilogram.",
      "A can holds 330ml. A bottle holds half a litre. Which holds more?",
      "Order these masses from lightest to heaviest: 500g, 5kg, 50g.",
      "Which is a shorter distance: 1km or 1200m?",
      "Use the symbols <, >, or = to compare: 90 minutes ___ 1.5 hours.",
      "A plant is 67cm tall. Another plant is 65cm tall. Which is shorter?",
      "A bag of flour weighs 1.5kg. A bag of sugar weighs 1500g. Compare their weights.",
      "Circle the largest volume: 2 litres, 2500ml, 2200ml.",
      "Order these children from shortest to tallest: Amy (1m 15cm), Leo (120cm), Sara (1m 5cm).",
      "Use the symbols <, >, or = to compare: 2 days ___ 48 hours.",
      "A plank is 3m long. A second plank is 305cm long. Which is shorter?",
      "A cat weighs 4kg. A puppy weighs 3500g. Which is heavier?",
      "Which holds less: a jug with 1 litre of water, or a bucket with 1500ml of water?",
      "Order these amounts of time from longest to shortest: 1 day, 25 hours, 1200 minutes.",
      "Use the symbols <, >, or = to compare: 199cm ___ 2m.",
      "A watermelon weighs 3kg. A pineapple weighs 2800g. Which is lighter?",
      "Put these volumes in order, starting with the smallest: 950ml, 1 litre, 0.9 litres.",
      "Which is longer: a 90-minute film or a film that lasts 1 hour and 20 minutes?",
      "Use the symbols <, >, or = to compare: 1500m ___ 1.5km."
    ],
    "Year 3": [
      "A pencil is 15cm long. A ruler is 30cm long. How much longer is the ruler?",
      "A bag of sugar weighs 1kg. A bag of flour weighs 750g. Which is lighter?",
      "A can of fizzy drink holds 330ml. A bottle of water holds 500ml. Which has a larger capacity?",
      "Convert 1.5kg to grams. Is this more or less than 1200g?",
      "Order these lengths from shortest to longest: 1m, 120cm, 95cm, 1m 10cm.",
      "Convert 250cm to metres. Is this longer or shorter than 2m?",
      "A pineapple weighs 1.2kg. An orange weighs 200g. Which is heavier?",
      "A swimming pool holds 5000 litres of water. A paddling pool holds 50,000ml. Which holds more?",
      "Order these masses: 1.5kg, 2000g, 1200g, 0.5kg.",
      "Use the symbols <, >, or = to compare: 35mm ___ 3cm.",
      "A running track is 400m long. A football pitch is 110m long. Which is shorter?",
      "A bag of flour is 1.5kg. A bag of sugar is 1kg 200g. Which is lighter?",
      "Compare these volumes: 1.2 litres ___ 1100ml.",
      "Arrange these lengths in descending order: 2km, 250m, 2.1km, 2050m.",
      "Is 4kg and 50g heavier or lighter than 4.5kg?",
      "Would a mug of tea be closer to 300ml or 3 litres?",
      "A piece of string is 2m 5cm long. Write this in centimetres.",
      "Order these weights from lightest to heaviest: 750g, 1.1kg, 0.9kg, 1050g.",
      "A journey is 5km long. Another journey is 500m long. Which is ten times longer?",
      "Use the symbols <, >, or = to compare: 750ml ___ 0.75 litres.",
      "A plank of wood is 3m long. A door is 195cm tall. Which is longer?",
      "Which is heavier: 3.5kg of feathers or 3kg of stones?",
      "A recipe needs 0.5 litres of milk. You have a 600ml carton. Do you have enough?",
      "Order these lengths: 10mm, 1cm, 0.1m, 1m.",
      "Is a weight of 2050g more or less than 2.5kg?",
      "A piece of ribbon is 1m 25cm long. Another is 130cm long. Which is longer?",
      "Compare the weights: 2kg 50g and 2500g.",
      "Which container has a larger capacity: a 1.5 litre bottle or a 1400ml jug?",
      "Arrange these measurements from shortest to longest: 25mm, 2cm, 0.02m.",
      "Is a mass of 990g greater or less than 1kg?",
      "A book is 23cm long. A shelf is 1m long. How many books could fit on the shelf?",
      "A parcel weighs 1.8kg. The maximum postage weight is 2kg. Is the parcel light enough?",
      "A recipe calls for 450ml of stock. You have a 0.5 litre carton. Is there enough?",
      "Order these lengths from longest to shortest: 300cm, 3.5m, 3m 20cm.",
      "Use the symbols <, >, or = to compare: 1001g ___ 1kg.",
      "Which holds more: three cans of 330ml or a 1 litre bottle?",
      "A child is 1m 10cm tall. To go on a ride, they must be 120cm tall. Are they tall enough?",
      "A bag of apples weighs 1.2kg. A bag of bananas weighs 1kg 250g. Which is heavier?",
      "A car's fuel tank holds 40 litres. A petrol can holds 5000ml. How many cans to fill the tank?",
      "Put these lengths in ascending order: 1.5km, 1600m, 1km 400m.",
      "Which is lighter: a 2.2kg bag of potatoes or a 2150g bag of potatoes?",
      "A watering can holds 5 litres. A bucket holds 8000ml. What is the difference in capacity?",
      "Compare the lengths: 99mm and 10cm.",
      "A box of cereal weighs 0.75kg. Is that more or less than 750g?",
      "Which is the larger volume: 2.5 litres or 2499ml?",
      "Order these from heaviest to lightest: 0.5kg, 50g, 5000g, 5.5kg.",
      "A bridge is 1km long. A train is 200m long. How many train lengths fit on the bridge?",
      "A bottle of medicine holds 150ml. A dose is 5ml. How many doses are in the bottle?",
      "Which length is the odd one out: 2.5m, 250cm, 2500mm, 25m?",
      "A shopping bag can hold 5kg. The shopping weighs 4800g. Will it hold?",
      "A fish tank needs 25 litres of water. You have a 2 litre jug. How many times must you fill it?"
    ],
    "Year 4": [
      "Which is a better value: 2 litres of milk for £1.50 or 500ml for 40p?",
      "An apple costs 35p. A banana costs 40p. Which is cheaper?",
      "Would you measure the distance to the next town in metres or kilometres?",
      "Compare these amounts using <, >, or =: £2.50 ___ 250p.",
      "Which is heavier, a bag of crisps (25g) or a bar of chocolate (100g)?",
      "A 1kg bag of carrots costs £1. A 750g bag of carrots costs 80p. Which is better value for money?",
      "A pack of 4 yoghurts costs £1.20. A single yoghurt costs 35p. Is it cheaper to buy four single yoghurts?",
      "Compare the distance from your school to your home, and from your school to the local shop. Which is further?",
      "Is it better to buy a 2-litre bottle of lemonade for £1.80 or two 1-litre bottles for 95p each?",
      "A monthly bus pass is £40. A single ticket is £2.50. If you make 20 journeys in a month, which is cheaper?",
      "Compare these prices using <, >, or =: £15.01 ___ 1510p.",
      "Would you measure the weight of a person in grams or kilograms?",
      "A car is 4.5m long. A parking space is 500cm long. Is the space long enough?",
      "A book costs £7.99. The same book costs 8 Euros. Given £1 is about 1.15 Euros, which is cheaper?",
      "Is a temperature of 25°C hotter or colder than 10°C?",
      "Compare the area of two classrooms. Which is larger?",
      "A box of cereal weighing 500g costs £2.00. A larger box weighing 750g costs £2.70. Which is the better buy per gram?",
      "Compare these amounts: 350p ___ £3.05.",
      "Which unit of measurement would be most appropriate to measure the capacity of a car's petrol tank?",
      "You have £10. Can you afford to buy a DVD for £7.50 and popcorn for £2.99?",
      "Which is a longer period of time: 3 weeks or 20 days?",
      "A fence is 1.8m tall. A wall is 170cm tall. Which is shorter?",
      "A job pays £10 per hour. Another job pays £75 for an 8-hour day. Which job pays more per hour?",
      "Compare the weight of your school bag in the morning and the afternoon. When is it heavier?",
      "Is it generally warmer in June or in December in the UK?",
      "A 500g jar of coffee costs £4.00. A 200g jar costs £2.00. Which is better value?",
      "Which is a greater amount: one thousand pence or ten pounds?",
      "Would you measure the length of a river in centimetres or kilometres?",
      "Compare the duration: a 1 hour 30 minute film vs a 100 minute film.",
      "A pack of 3 pens costs 99p. A single pen costs 35p. Which is cheaper per pen?",
      "Use <, >, or = to compare: 4500g ___ 4.5kg.",
      "A holiday in Spain costs €500. A holiday in Portugal costs £450. If £1 = €1.10, which holiday is cheaper?",
      "Which is the colder temperature: -5°C or -2°C?",
      "A 2 litre bottle of water costs £1.00. A 500ml bottle costs 30p. Which is better value per litre?",
      "Compare these amounts of money: £0.50 and 5p.",
      "Which is a longer distance: 2.5km or 2400m?",
      "A bag of 6 apples costs £1.20. A bag of 8 apples costs £1.68. Which is better value per apple?",
      "Use <, >, or = to compare: 90 seconds ___ 1.5 minutes.",
      "A book has a mass of 0.8kg. A laptop has a mass of 1200g. Which is heavier?",
      "Which is the better offer: 'Buy one get one free' on items costing £5, or a '3 for 2' offer on the same items?",
      "Compare the areas: a field that is 100m x 50m vs a field that is 80m x 60m.",
      "A train journey takes 2 hours 15 minutes. A car journey takes 140 minutes. Which is quicker?",
      "A 75cl bottle of juice costs £1.50. A 1 litre carton costs £1.80. Which is better value?",
      "Use <, >, or = to compare: £1,250 ___ one thousand two hundred and five pounds.",
      "Which is heavier: 1 tonne or 1001kg?",
      "A phone plan costs £10 a month for 1000 minutes. Another costs £12 for 1500 minutes. Which is cheaper per minute?",
      "Compare the lengths: 1 mile or 1.5 kilometres? (1 mile ≈ 1.6km)",
      "A 1kg tub of butter costs £5. A 250g block costs £1.30. Which is better value?",
      "Which is warmer: the average UK summer temperature (19°C) or a hot oven (200°C)?",
      "Use <, >, or = to compare: half a day ___ 10 hours."
    ]
  },
  "estimate_measure_and_read_scales": {
    "Year 1": [
      "How many building blocks long is your desk?",
      "Use a ruler to measure the length of your pencil in centimetres.",
      "Choose two objects in the classroom. Which do you estimate is heavier? Now use a balance scale to check.",
      "How many cups of water do you think it will take to fill a jug?",
      "Using a timer, how long does it take to write your name five times?",
      "How many of your hand spans does it take to measure the width of the door?",
      "Estimate how many pencils long the teacher's desk is, then check.",
      "Find an object you think is heavier than your shoe. Use a balance scale to compare them.",
      "Estimate how many small cubes will fit into a large box.",
      "Use a stopwatch. How many star jumps can you do in 30 seconds?",
      "Measure your height using a tape measure.",
      "Find an object in the classroom and record its length in centimetres.",
      "Estimate which holds more: a cup or a bucket.",
      "How many steps does it take to walk across the classroom?",
      "Measure the length of a book using paperclips.",
      "Estimate if your water bottle is full, half full, or empty.",
      "How long does it take for a sand timer to run out?",
      "Measure the weight of three different objects using a balance scale and put them in order.",
      "Estimate how many Lego bricks tall your chair is.",
      "Record the time it takes for a friend to run across the playground.",
      "Measure the width of a window in hand spans.",
      "Estimate how many glasses of water would fill a watering can.",
      "Find a leaf outside and measure its length with a ruler.",
      "Use a balance to find something that weighs the same as 10 connecting cubes.",
      "Record what time school starts and finishes by looking at the clock.",
      "How many steps long is the school corridor? Estimate first, then measure.",
      "Use non-standard units, like crayons, to measure the length of your table.",
      "Which do you estimate is heavier: a whiteboard pen or a pair of scissors? Use a balance to check.",
      "Estimate how many handfuls of sand would fill a bucket.",
      "Use a clock with a second hand to time how long you can stand on one leg.",
      "Measure the height of your friend using building blocks.",
      "Find three things in the classroom that are shorter than your ruler.",
      "Estimate which is lighter: an apple or a banana? Check with a balance scale.",
      "How many yoghurt pots of water do you think will fill a large bowl?",
      "Time how long it takes to sing 'Happy Birthday' three times.",
      "Measure your own foot using 1p coins lined up end to end.",
      "Record the length of a piece of string in centimetres.",
      "Find something in the room that you think has the same weight as your reading book.",
      "Estimate how many times you can write the number 8 in one minute.",
      "Use a ruler to measure the shortest side of a rectangular table.",
      "How many of your feet (heel to toe) is it from your desk to the door?",
      "Estimate the weight of an empty lunchbox, then weigh it with something heavy inside.",
      "Pour water from a full cup into an empty jug. Describe how full the jug is.",
      "Use a calendar to find out how many seconds there are in a minute.",
      "Measure the longest object in your pencil case.",
      "Which is heavier: a stack of 5 books or a single chair?",
      "Estimate how many little cups of rice would fill a big cup.",
      "How long does the school lunchtime last? Record the start and end times.",
      "Measure the distance around a hula hoop using a piece of string."
    ],
    "Year 2": [
      "What unit would you use to measure the length of the classroom? (cm or m)",
      "Read the weighing scale. How much does the bag of flour weigh in grams?",
      "The thermometer shows the temperature in the classroom. What is the temperature in degrees Celsius?",
      "How much water is in the measuring jug in millilitres?",
      "Estimate the height of your chair in centimetres, then measure it with a ruler.",
      "Estimate the weight of your reading book in grams, then use a scale to measure it.",
      "What is the temperature on the thermometer outside? Is it hot or cold?",
      "Measure the height of your friend in metres and centimetres.",
      "Read the scale on the measuring jug. How much juice is there in millilitres?",
      "Estimate the mass of an apple. Is it closer to 10g, 100g or 1kg?",
      "Use a ruler to draw a line that is exactly 12cm long.",
      "Read the weight on a kitchen scale. How many kilograms does the bag of sugar weigh?",
      "The weather forecast says it will be 15°C. What sort of clothes should you wear?",
      "Pour 200ml of water into a measuring jug.",
      "Estimate the length of the school hall in metres.",
      "Measure the perimeter of your table using a tape measure.",
      "What weight is the arrow pointing to on this scale? (Image of a scale needed).",
      "Look at the thermometer in the classroom. Record the temperature.",
      "How much liquid is in this beaker? (Image of a beaker with a scale needed).",
      "Estimate the capacity of your water bottle. Is it more or less than 1 litre?",
      "Measure the length and width of a piece of A4 paper in centimetres.",
      "Use a weighing scale to find out how many grams a pack of crisps weighs.",
      "What temperature does water freeze at?",
      "A recipe says to add 500ml of milk. Use a measuring jug to measure this amount.",
      "Estimate, then measure, the distance from your desk to the classroom door in metres.",
      "Choose the best unit to measure the weight of a pencil: grams or kilograms?",
      "Read the temperature from a weather app or thermometer for today. Is it hot, warm, or cold?",
      "A recipe requires 250ml of water. Shade the measuring jug to show this amount.",
      "Estimate the length of a car in metres. Then, if possible, find out the actual length.",
      "What would you use to measure the amount of water in a bath: millilitres or litres?",
      "Draw a line you estimate to be 15cm long. Check its length with a ruler.",
      "The scale shows 1.5kg. How many grams is this?",
      "The temperature in the desert can be 40°C. Is this hot or cold?",
      "How many 100ml glasses can you fill from a 1 litre bottle?",
      "Estimate the width of the school gate in metres.",
      "What standard unit would you use to measure your own height?",
      "Read the scale on a bag of potatoes. What is the mass in kg?",
      "A thermometer reads 22°C. Is this a likely temperature for an oven or a room?",
      "A measuring cylinder contains 75ml of liquid. Draw the line on a diagram.",
      "Estimate the mass of a pineapple in kilograms.",
      "Use a ruler to measure the height of a water bottle in centimetres.",
      "What does the 'g' stand for on a weighing scale?",
      "If the temperature is 0°C, what might you see outside?",
      "Estimate the capacity of a school milk carton in millilitres.",
      "Measure the length of your shoe in centimetres.",
      "Would a feather weigh more or less than 1 gram?",
      "Read the temperature on an oven dial. Is it measured in °C or ml?",
      "A jug has markings every 100ml. If the water level is on the third mark, how much water is there?",
      "Estimate the height of a door in metres.",
      "Choose the most sensible weight for a banana: 150g, 1.5kg, or 15g."
    ],
    "Year 3": [
      "Measure the length of the whiteboard in metres and centimetres.",
      "Find an object that weighs approximately 1kg. Use a digital scale to check your accuracy.",
      "How much water is in the measuring cylinder? Read the scale to the nearest millilitre.",
      "Draw a line that you estimate to be 8.5cm long. Measure it for accuracy.",
      "Read the weight shown on these bathroom scales in kilograms.",
      "Measure the perimeter of a regular pentagon with 5cm sides.",
      "A bag of flour weighs 1.5kg. What does the scale show in grams?",
      "Estimate the capacity of a large bucket. Is it closer to 1 litre, 10 litres, or 100 litres?",
      "Measure the thickness of a £1 coin in millimetres.",
      "Weigh a single grape. What is its mass in grams?",
      "Look at the markings on a ruler. How many millimetres are between the 2cm and 3cm mark?",
      "Use a tape measure to find the circumference of your head.",
      "Read the volume of liquid in a graduated cylinder, paying attention to the meniscus.",
      "Estimate the mass of a large dictionary.",
      "Measure the length of a football pitch in metres.",
      "A bottle of medicine says to take 5ml. Use a medicine spoon to measure this dose.",
      "Look at a set of kitchen scales. What is the interval between each marking?",
      "Draw a plan of your bedroom and measure its length and width.",
      "Find the total weight of 5 apples.",
      "Estimate, then measure, the volume of a lunchbox by filling it with water and pouring it into a measuring jug.",
      "Measure the length of your desk to the nearest millimetre.",
      "Estimate the mass of a bag of sugar in kg. Then read the actual mass.",
      "A measuring jug has 1 litre of water. 250ml is poured out. What does the scale read now?",
      "Draw a rectangle with a perimeter of 20cm. Measure the sides.",
      "Read the scale. The arrow is halfway between 1kg and 2kg. What is the weight?",
      "Measure the height of a classroom door in metres and centimetres.",
      "Find an object that you estimate weighs about 200g. Check your estimate.",
      "A beaker contains 450ml of liquid. If you add 100ml more, what will the new reading be?",
      "Estimate the length of your pencil in mm, then measure it.",
      "Use kitchen scales to measure out 375g of flour.",
      "Measure the perimeter of a square with sides of 7cm.",
      "Read the volume of milk in a 2-litre carton that is half full.",
      "Estimate the width of a window in centimetres.",
      "What is the mass of 1 litre of water? (Answer: 1kg).",
      "Measure the length of your arm from your elbow to your wrist in cm and mm.",
      "A scale shows 2kg and 300g. What is the total mass in grams?",
      "Estimate the capacity of a car's windscreen washer tank in litres.",
      "Draw a line that is exactly 125mm long using a ruler.",
      "Weigh a banana. Then weigh the peel. What is the mass of the part you eat?",
      "Measure the perimeter of an A4 sheet of paper.",
      "A recipe requires 750ml of stock. How would you measure this using a 500ml jug?",
      "Estimate the length of a whale in metres.",
      "Read a person's weight on a set of bathroom scales that shows 65.5kg.",
      "Measure the amount of water a sponge can soak up.",
      "What is the length of a standard 30cm ruler in millimetres?",
      "Estimate the weight of a can of baked beans.",
      "A rain gauge collected 12mm of rain. Show this on a diagram of a ruler.",
      "Measure the perimeter of a hexagon where each side is 4cm long.",
      "A measuring cylinder holds 100ml. What do the intervals of 10ml represent?",
      "Estimate the total mass of the books in your school bag."
    ],
    "Year 4": [
      "Estimate the total cost of a loaf of bread (£1.25), a pint of milk (60p) and a block of cheese (£2.50).",
      "A recipe needs 250g of flour. If you only have a 1kg bag, about what fraction of the bag will you use?",
      "If a journey starts at 2:15 pm and finishes at 3:00 pm, estimate how long it took.",
      "Estimate the length of your classroom. Would you measure it in metres or centimetres?",
      "Look at a map of your local area. Estimate the distance from your school to the nearest park.",
      "Estimate the total value of these coins in a picture: £1, 50p, 20p, 20p, 5p, 2p.",
      "A journey takes 40 minutes. If you leave at 8:30 am, estimate the arrival time.",
      "Estimate the weight of a bag of shopping. Would it be closer to 500g, 5kg, or 50kg?",
      "Look at the price of petrol per litre at a petrol station. Estimate the cost to fill a 40-litre tank.",
      "Estimate the area of your classroom floor in square metres.",
      "A menu has prices like £8.95, £12.50, and £4.99. Estimate the cost of a three-course meal.",
      "Estimate the height of a double-decker bus.",
      "If your pocket money is £5 a week, estimate how many weeks it would take to save for a £22 video game.",
      "Look at your electricity meter. Read the number shown.",
      "Estimate the amount of water you drink in a day in litres.",
      "Estimate the cost of posting a parcel based on its weight.",
      "A recipe needs 175g of sugar. Look at a bag of sugar and estimate how much this is.",
      "How long do you estimate it will take to run 100 metres?",
      "Estimate the total length of all the pencils in your pencil case.",
      "Look at a timetable for a TV channel. Estimate the total time spent on news programmes in one evening.",
      "Estimate the price of a weekly food shop for a family.",
      "How much time do you estimate you spend on homework each week?",
      "Estimate the weight of your school chair.",
      "A car's fuel gauge is halfway between full and empty. The tank holds 60 litres. Estimate how many litres are left.",
      "Estimate the temperature in the room right now.",
      "Estimate the total cost of a cinema ticket (£8.50), popcorn (£4.95), and a drink (£2.75).",
      "A jug holds 1 litre of water. You pour out what you think is 300ml. How can you check how accurate your estimate was?",
      "Estimate the perimeter of the school playground in metres.",
      "You have a £20 note. Estimate if you have enough to buy three items costing £5.99 each.",
      "Estimate the mass of a dog in kilograms.",
      "Read the departure board at a train station. If a train is due at 14:05 and it's now 13:50, about how long is the wait?",
      "Estimate the capacity of a bathtub in litres.",
      "A bill for a meal comes to £48.60. Estimate a 10% tip.",
      "Estimate the length of a football pitch. Is it closer to 10m, 100m, or 1km?",
      "Look at the prices in a supermarket catalogue. Estimate the cost of the ingredients for a simple meal.",
      "Estimate the weight of your desk in kilograms.",
      "A scale shows a parcel's weight is halfway between 2.5kg and 3kg. What is the estimated weight?",
      "Estimate how many millilitres of water are in a half-full 2-litre bottle.",
      "You need 2kg of apples. One apple weighs about 150g. Estimate how many apples you need.",
      "Estimate the total value of the coins in your teacher's purse or wallet (with permission!).",
      "Read a utility bill (gas, electric). What is the meter reading?",
      "Estimate the amount of liquid in a can of fizzy drink in ml.",
      "A recipe needs 1.2kg of meat for 6 people. Estimate how much meat would be needed for 3 people.",
      "Estimate the cost of a family holiday from a brochure.",
      "If a film is 135 minutes long, estimate its running time in hours and minutes.",
      "Estimate the mass of a car in tonnes.",
      "Read a nutrition label on a food packet. How many grams of sugar are there per 100g?",
      "Estimate the perimeter of a local park by walking around it and counting your steps.",
      "You have £5.00. Estimate the total cost of a sandwich (£2.80), crisps (85p), and a drink (£1.20).",
      "Estimate the temperature of a hot cup of tea."
    ]
  },
  "money": {
    "Year 1": [
      "What is the value of a 10p coin?",
      "Which is worth more, a 2p coin or a 5p coin?",
      "Can you name all the UK coins?",
      "If you have a 1p, 2p, and 5p coin, how much money do you have altogether?",
      "I have a coin that is silver and has seven sides. What coin is it?",
      "How many 1p coins do you need to make 5p?",
      "Can you find a coin that is brown? What is its value?",
      "I have two 10p coins. How much money do I have?",
      "Which note has the lowest value? (£5, £10, £20).",
      "Is a 50p coin worth more or less than a £1 coin?",
      "If I have three 2p coins, how much do I have?",
      "Name a coin that is gold and silver.",
      "What is the colour of a £10 note?",
      "How many 5p coins are worth the same as a 20p coin?",
      "I have a £2 coin and a £1 coin. How much money do I have?",
      "Find two coins that add up to 3p.",
      "What coin has 12 sides?",
      "How many 1p coins are in a £1 coin?",
      "If I have a 20p coin and a 5p coin, do I have more or less than 22p?",
      "Can you show me 8p using exactly three coins?",
      "Name all the silver coins.",
      "What is the value of a £20 note?",
      "If I have two 50p coins, how much money do I have?",
      "Find three coins that add up to 16p.",
      "Which is worth more: four 1p coins or one 5p coin?",
      "What coin is small, silver and round?",
      "How many 1p coins make 10p?",
      "If you have a 5p coin and a 2p coin, how much do you have?",
      "Which is worth less: a £5 note or a £10 note?",
      "Can you find two coins that have the same value?",
      "What is the biggest coin in size?",
      "I have a 10p coin and a 5p coin. How much money is that?",
      "Name a bank note that is orange.",
      "How many 2p coins make 10p?",
      "What is the total value of a 50p coin and a 10p coin?",
      "Find a coin that is worth 100 pennies.",
      "If I have four 1p coins, how much do I have?",
      "Which is worth more: a 50p coin or three 10p coins?",
      "What is the value of the coin with two colours?",
      "How many 5p coins make 15p?",
      "I have a 20p coin and a 2p coin. How much is that?",
      "Which coin is worth the most?",
      "Which bank note is worth the least?",
      "If I have a £1 coin and a 10p coin, do I have more than 105p?",
      "Show me 6p using the smallest number of coins.",
      "How much is a 1p, a 2p and another 1p coin altogether?",
      "What is the shape of a 20p coin?",
      "How many 10p coins are equal to a 50p coin?",
      "Can you add a 50p coin and a £1 coin?",
      "Which is worth less: a 2p coin or a 1p coin?"
    ],
    "Year 2": [
      "How many 10p coins make £1?",
      "If you buy a comic for 60p and pay with a £1 coin, how much change will you get?",
      "Sophie buys a cake for 35p and a drink for 25p. How much does she spend altogether?",
      "Write down two different ways to make 20p using coins.",
      "What do the symbols £ and p stand for?",
      "A pen costs 45p. Which coins could you use to pay for it exactly?",
      "You have £1 and spend 70p. How much change do you get?",
      "How much is two £5 notes and three £1 coins?",
      "Find the total of £2, 50p, and 5p.",
      "Show three ways to make 50p.",
      "If you save 10p every day for a week, how much will you have?",
      "An ice cream costs 85p. You pay with a £1 coin. What is your change?",
      "Which costs more, a comic for £1.50 or a book for £1.25?",
      "How many 20p coins do you need to make £2?",
      "Sarah has £5. She buys a magazine for £2.50. How much is left?",
      "Add these amounts: £3 and 40p + £1 and 20p.",
      "What is the difference between £10 and £6.50?",
      "A bus ticket is 90p. How much for two tickets?",
      "Can you buy a toy for £3.75 if you have a £5 note?",
      "I have three 50p coins and two 20p coins. How much money is that?",
      "How much more do I need to make £1 if I have 65p?",
      "A rubber costs 15p. A ruler costs 25p. How much for both?",
      "Find the value of one £10 note, one £5 note, and three £2 coins.",
      "If I share £2 equally between two people, how much do they get each?",
      "I buy a drink for 65p and crisps for 55p. How much have I spent?",
      "Tom has a 50p coin and three 10p coins. How much money does he have?",
      "A banana costs 30p. An apple costs 25p. How much for one of each?",
      "How can you make 75p using exactly three coins?",
      "I have £1 and buy a chocolate bar for 55p. What change will I receive?",
      "How many 5p coins are in 50p?",
      "Lily has two 20p coins and one 5p coin. Does she have enough to buy a comic for 40p?",
      "Find the total of a £1 coin, a 50p coin, and a 5p coin.",
      "Show £1.50 using the smallest number of coins.",
      "If I have three 20p coins, how much more do I need to make £1?",
      "A toy car costs £1.20. A toy boat costs £1.50. What is the difference in price?",
      "How many £2 coins are there in £10?",
      "Sam wants to buy a book for £5. He has saved £3.50. How much more does he need?",
      "Add together 45p and 35p.",
      "Can you make 37p using UK coins?",
      "I pay for a 70p item with a £2 coin. How much change do I get?",
      "What is the total of a £5 note and a £10 note?",
      "A pack of stickers costs 80p. How much would 2 packs cost?",
      "How would you write one pound and five pence using the £ symbol?",
      "If I have two 50p coins and I spend 80p, how much do I have left?",
      "Find three coins that total 26p.",
      "How many 50p coins make £3.00?",
      "Which is more money: four 20p coins or three 50p coins?",
      "A cup of juice is 40p. A biscuit is 15p. How much for both?",
      "What is double £1.25?",
      "Show how to make £2.35 using four coins."
    ],
    "Year 3": [
      "A computer game costs £15. You have saved £8.50. How much more do you need?",
      "Calculate the change from £10 for items costing £3.40 and £2.80.",
      "Three friends share the cost of a pizza that is £9.60. How much do they each pay?",
      "A cinema ticket costs £4.75. How much would it cost for a family of four?",
      "Find the total cost of a book at £6.99 and a pen at £1.25.",
      "How much is five £2 coins, three 50p coins, and seven 5p coins?",
      "I bought two items for £5.60. One cost £2.90. What did the other one cost?",
      "A weekly bus pass costs £12.50. How much would four weeks cost?",
      "A sandwich costs £2.80, a drink 95p, and a cake £1.50. What is the total?",
      "If I have a £20 note, can I buy three books that cost £6 each? What change will I get?",
      "Find half of £7.50.",
      "I have a mixture of 8 coins in my pocket worth 97p. What could they be?",
      "What is the difference in price between a £12.99 toy and a £17.50 toy?",
      "A school trip costs £14 per child. How much for 10 children?",
      "Find 1/4 of £20.",
      "I bought 5 pens for 40p each. How much did I spend in total?",
      "A meal costs £23.70. How much change is there from a £50 note?",
      "If I save £3 a week, how long will it take to save for a bike that costs £36?",
      "A DVD costs £8.99. A Blu-ray costs £11.49. How much more is the Blu-ray?",
      "Add up these amounts: £10.60, £5.80 and £3.20.",
      "A t-shirt costs £5.50 and a pair of shorts costs £4.75. How much do they cost altogether?",
      "A pack of pens costs £2.40. There are 6 pens in the pack. What is the cost per pen?",
      "A café sells coffee for £2.60 and tea for £1.90. How much more does the coffee cost?",
      "If I pay for a £2.80 magazine with a £5 note, how much change will I get?",
      "I buy a book for £4.80 and pay with a £10 note. What is my change?",
      "A football costs £8.25. A pump costs £3.99. What is the total cost?",
      "How much change would you get from a £10 note if you spent £6.35?",
      "If 4 children share £10 equally, how much does each child get?",
      "A swimming lesson costs £6.50. How much would 5 lessons cost?",
      "Find the sum of £12.45 and £7.80.",
      "I have £15. I buy a DVD for £8.99. How much money is left?",
      "A train ticket costs £22.50. How much would it cost for 3 people?",
      "Convert 350p into pounds and pence.",
      "A family meal costs £34.60. They pay with two £20 notes. What is their change?",
      "What is £10 minus £4.72?",
      "If I save £1.50 each week, how much will I save in 6 weeks?",
      "A jacket costs £25. It is in a sale with £5.50 off. What is the new price?",
      "Find the cost of 10 stamps if one stamp costs 65p.",
      "Add £3.45, £2.99 and £1.50 together.",
      "A book costs £7.49. How much change from £20?",
      "If a pack of 8 batteries costs £4.80, what does one battery cost?",
      "Subtract £2.80 from £5.00.",
      "A monthly magazine subscription is £4.25. What is the cost for a whole year?",
      "What is one third of £9.30?",
      "A comic is £1.25 and a magazine is £2.10. How much more is the magazine?",
      "How many 50p coins do you need to make £5.50?",
      "If you spend £1.75 and £2.50, what is the total spend?",
      "A toy car costs £3.75. How much would 3 cost?",
      "What is the difference between £20 and £11.65?",
      "If I have £8.40 and I divide it among 4 people, how much does each get?"
    ]
  },
  "telling_time_ordering_time_duration_and_units_of_time": {
    "Year 1": [
      "What time is it if the big hand is on the 12 and the little hand is on the 3?",
      "Draw the hands on a clock to show half past 4.",
      "What day comes after Tuesday?",
      "Put these in order: morning, afternoon, evening.",
      "Which month is your birthday in?",
      "Draw a clock showing 9 o'clock.",
      "If it is morning now, what part of the day comes next?",
      "Which season comes after summer?",
      "What day is it today? What day will it be tomorrow?",
      "Point to the hour hand on a clock. Point to the minute hand.",
      "Is playtime in the morning or the afternoon?",
      "How many days are in a week?",
      "The clock says 1 o'clock. What time will it be in one hour?",
      "What month comes before January?",
      "Show me half past 2 on a clock.",
      "Which day of the week is the first day of the school week?",
      "Name the four seasons.",
      "If a party starts at 3 o'clock and lasts for one hour, what time does it finish?",
      "What do you usually do in the evening?",
      "What is special about Saturday and Sunday?",
      "Draw a clock that shows the time you go to bed.",
      "Put these in order: breakfast, lunch, dinner.",
      "How many months are in a year?",
      "What time does school finish?",
      "If the time is half past 8, where is the big hand pointing?",
      "What time is it one hour after 7 o'clock?",
      "Show half past 11 on a clock face.",
      "What is the day before Saturday?",
      "Put these events in order: go to school, wake up, go to bed, eat dinner.",
      "Name a month in the season of winter.",
      "The little hand is pointing at the 6, the big hand is pointing at the 12. What time is it?",
      "If it is half past 9, where is the minute hand?",
      "What day of the week is your favourite?",
      "Which comes first, March or May?",
      "Draw a clock showing the time you have lunch.",
      "What time is it one hour before 2 o'clock?",
      "How many days are there from Monday to Friday?",
      "A TV show starts at 5 o'clock. Where are the hands on the clock?",
      "What is the last month of the year?",
      "Show half past six on a clock.",
      "Put these in order of a day: sunrise, sunset, midnight, noon.",
      "Which season has Christmas in it?",
      "If you go to the park at 4 o'clock, what will you do before that?",
      "What time is it when both hands point to the 12?",
      "Name the month that comes after August.",
      "Draw the hands on a clock to show half past one.",
      "What day is two days after Wednesday?",
      "Which takes longer: a school day or a weekend?",
      "If you wake up at 7 o'clock, is that in the morning or evening?",
      "Show 10 o'clock on a clock face."
    ],
    "Year 2": [
      "What time is quarter past 7? Show this on a clock face.",
      "A TV show starts at 5:00 and ends at 5:30. How long is the show?",
      "How many minutes are in an hour?",
      "If it is 10 o'clock now, what time will it be in 2 hours?",
      "A bus journey takes 45 minutes. If it starts at 9:00 am, what time does it finish?",
      "A programme starts at quarter to 4. What time is this in digital format?",
      "How many hours are there in a day?",
      "It is 6:15. What time will it be in 30 minutes?",
      "A school lesson is 50 minutes long. Does it last for more or less than an hour?",
      "Write the time 'twenty past three' in digital form.",
      "A bus leaves at 10:00 am and the journey is one hour long. What time does it arrive?",
      "How many seconds are in a minute?",
      "Draw the hands on a clock to show 7:25.",
      "A film starts at 3:00 pm and finishes at 4:15 pm. How long was the film?",
      "If it's half past 2 now, what time was it half an hour ago?",
      "How many full weeks are in a month?",
      "It takes 10 minutes to walk to school. If you leave at 8:20 am, what time do you arrive?",
      "What time is shown on the clock? (Image showing ten to five).",
      "Order these times from earliest to latest: 3:00 pm, 10:00 am, 5:00 pm, 12:00 pm (noon).",
      "How many hours are there in two days?",
      "What time is 15 minutes after 1:30?",
      "A cake needs to bake for 25 minutes. It goes in the oven at 11:10. When is it ready?",
      "Write 'five to nine' in two different ways.",
      "A football match is 90 minutes long. It starts at 1:00 pm. What time does it finish?",
      "How many times does the minute hand go all the way around the clock in one hour?",
      "What time is it 20 minutes before 3 o'clock?",
      "A swimming lesson is 40 minutes long. It ends at 11:00 am. What time did it start?",
      "How many minutes pass between 2:10 and 2:35?",
      "Draw the hands on a clock to show quarter to eight.",
      "A train journey takes half an hour. If it leaves at 1:15 pm, when does it arrive?",
      "How many hours are there from 9am to 2pm?",
      "A party starts at 2:00 pm and lasts for 2 hours. What time does it finish?",
      "Write the time 'ten past six' using numbers.",
      "It is now quarter past 4. What time will it be in 20 minutes?",
      "A bike ride took 55 minutes. Is that more or less than one hour?",
      "How many days are in a fortnight?",
      "A cake takes 30 minutes to cool down. It comes out of the oven at 12:00. When is it cool?",
      "Which is longer: 3 days or 70 hours?",
      "Show 5:50 on an analogue clock face.",
      "A lesson begins at 9:05 and ends at 9:55. How many minutes long is it?",
      "How many minutes are in a quarter of an hour?",
      "Lunchtime starts at 12:15 and ends at 1:00. How long is lunchtime?",
      "What time is it 25 minutes after 10:30 am?",
      "If today is the 10th of the month, what will the date be in one week?",
      "A film is 75 minutes long. How many hours and minutes is this?",
      "How many times does the hour hand go all the way around the clock in one day?",
      "A park opens at 9am and closes at 6pm. For how many hours is it open?",
      "Write 'twenty-five to seven' in digital format.",
      "It takes 5 minutes to boil a kettle. If I start at 8:50 am, what time will it be ready?"
    ],
    "Year 3": [
      "Write 4:45 pm in 24-hour clock format.",
      "How many days are there in March?",
      "A film is 90 minutes long. How many hours and minutes is this?",
      "If you go to bed at 8:30 pm and wake up at 7:00 am, how long have you slept for?",
      "Look at a calendar. What day of the week is the 15th of the current month?",
      "A train is due at 16:10. It is 15 minutes late. What time does it arrive?",
      "How many days are there in a leap year?",
      "What time is it 25 minutes after 7:50 am?",
      "A TV show lasts for 45 minutes and ends at 6:00 pm. What time did it start?",
      "Write quarter to three in the afternoon in 24-hour format.",
      "How many hours and minutes is 100 minutes?",
      "A car journey took 2 hours and 30 minutes. If the family arrived at 1:00 pm, what time did they set off?",
      "Which months have exactly 30 days?",
      "Show 19:30 on an analogue clock face.",
      "A boy goes on holiday for 3 weeks. How many days is he away?",
      "What is the time 12 hours after 3:00 am?",
      "I leave home at 8:15 am and arrive at school at 8:40 am. How long is my journey?",
      "How many seconds are in five minutes?",
      "It is 2:00 pm. You are going to a party at 4:30 pm. How long do you have to wait?",
      "A clock shows Roman numerals. What time is it if the hour hand points to VI and the minute hand points to XII?",
      "A flight from London to Rome takes 2 hours and 20 minutes. If it departs at 11:00, when does it land?",
      "How many days are there altogether in July and August?",
      "What is the date one week after the 25th of December?",
      "A swimming lesson starts at 9:05 am and finishes at 9:55 am. How long is the lesson?",
      "Convert 3 days into hours.",
      "A bus leaves at 13:45. The journey takes 50 minutes. What time does it arrive?",
      "How many seconds are there in 2.5 minutes?",
      "A film starts at 18:00 and is 110 minutes long. What time does it finish?",
      "What is the date 2 weeks before the 30th of April?",
      "Write 8:20 in the morning using a.m. or p.m.",
      "How many days are there in this year?",
      "A train journey begins at 10:25 and ends at 11:10. How long did it take?",
      "How many minutes are there from 9:50 am to 10:15 am?",
      "Write half past seven in the evening in 24-hour clock time.",
      "What time is it 3 hours and 15 minutes after 14:00?",
      "How many months are there from the start of May to the end of August?",
      "A cake takes 35 minutes to bake. It goes in the oven at 4:30 pm. When is it ready?",
      "How many hours are there in a week?",
      "A clock's minute hand is on the IX and the hour hand is just before the V. What time is it?",
      "A school sports day starts at 9:30 am and finishes at 2:15 pm. How long does it last?",
      "How many days are in February in a leap year?",
      "What time is 45 minutes before 12:30 pm?",
      "Convert 150 minutes into hours and minutes.",
      "A boy's birthday is in October. His sister's is 3 months later. What month is her birthday?",
      "Write 00:30 in 12-hour clock format, using a.m. or p.m.",
      "A car is parked from Monday 9:00 am to Tuesday 9:00 am. How many hours is that?",
      "How many seconds are in one hour?",
      "A play is 2 hours and 5 minutes long. How many minutes is that?",
      "If the time is 20:50, how many minutes is it until 9 pm?",
      "What is the time shown by the Roman numerals XI on a clock face?"
    ],
    "Year 4": [
      "A train leaves at 14:20 and arrives at 15:05. How long is the journey?",
      "How many seconds are in 3 minutes?",
      "Convert 2 and a half hours into minutes.",
      "How many weeks are in a year?",
      "Change 150 minutes into hours and minutes.",
      "A film starts at 18:30 and is 1 hour 45 minutes long. What time does it finish?",
      "How many days are in 5 years, assuming one is a leap year?",
      "Change 200 seconds into minutes and seconds.",
      "Write 2:35 am in 24-hour clock time.",
      "A school day starts at 8:50 am and finishes at 3:20 pm. How long is the school day?",
      "How many months are in 3 and a half years?",
      "Convert 5 hours and 20 minutes into minutes only.",
      "What is 72 hours in days?",
      "A family sets off on a journey at 09:00. They stop for a 45-minute break and arrive at their destination at 13:15. How long were they driving for?",
      "Write quarter past five in the evening on a 24-hour digital clock.",
      "How many weeks are there in 6 months?",
      "A train was scheduled to arrive at 11:45 but arrived at 12:10. How many minutes late was it?",
      "Convert 3.5 minutes to seconds.",
      "A worker's shift is from 22:00 to 06:00. How long is the shift?",
      "If your birthday is on the 5th of April, how many days is it until the 1st of May?",
      "Change 48 months into years.",
      "A student spends 1 hour on English homework and 40 minutes on maths. How long is this in total?",
      "Read the time on an analogue clock and write it in 12-hour and 24-hour digital format.",
      "How many hours and minutes are there from 10:30 am to 1:15 pm?",
      "A tap drips once every 30 seconds. How many times will it drip in 5 minutes?",
      "Convert 5 days into hours.",
      "A TV series has 6 episodes, each 45 minutes long. What is the total running time?",
      "How many seconds are in 1 hour and 10 minutes?",
      "Write 11:15 pm in 24-hour format.",
      "A flight departs at 10:00 and lands at 14:30. How long is the flight?",
      "How many complete weeks are there in 50 days?",
      "A recipe says to simmer a sauce for 1.5 hours. How many minutes is that?",
      "A bus arrives every 20 minutes. If one arrives at 9:10 am, what time is the next one?",
      "How many years and months is 30 months?",
      "A car journey takes 3 hours and 25 minutes. If it ends at 16:00, when did it start?",
      "Write midnight in 24-hour clock format.",
      "How many minutes are in 4.5 hours?",
      "A school has 6 lessons a day, each 50 minutes long. How long is spent in lessons in hours and minutes?",
      "Convert 42 days into weeks.",
      "A train journey takes 2 hours 50 minutes. How many minutes is this?",
      "What is the time 8 hours after 17:00?",
      "How many seconds are in a quarter of an hour?",
      "Convert 2 years and 3 months into months.",
      "A meeting starts at 11:30 and lasts for 90 minutes. What time does it finish?",
      "How many days are there from the 3rd of June to the 1st of July?",
      "Write 1 minute 45 seconds purely in seconds.",
      "It takes 25 minutes to get to the cinema. The film starts at 17:00. What is the latest you can leave?",
      "How many hours are in 360 minutes?",
      "A worker starts at 07:30 and finishes at 15:30. They have a 45 minute break. How long do they work for?",
      "Convert 10 weeks into days."
    ],
    "Year 5": [
      "A flight takes off at 09:40 and lands at 13:25. How long is the flight in hours and minutes?",
      "If a recipe says to bake a cake for 55 minutes and it goes in the oven at 11:30 am, what time should it come out?",
      "How many days are in 3 years, including one leap year?",
      "A car race lasts for 3 hours and 45 minutes. The race starts at 1:15 pm. What time does it finish?",
      "Convert 2.5 days into hours.",
      "A concert starts at 7:45 pm and lasts for 2 hours and 20 minutes. What time does it end?",
      "A runner completed a race in 150 minutes. How many hours and minutes is that?",
      "How many seconds are in half an hour?",
      "A bus runs every 12 minutes. If the first bus is at 6:30 am, what time is the fourth bus?",
      "A plane journey takes 6.5 hours. If it lands at 14:00, what time did it take off?",
      "How many hours are in a fortnight?",
      "A project is due in 3 weeks. You estimate it will take 30 hours to complete. How many hours a day do you need to work on it if you work 5 days a week?",
      "Convert 1.25 hours into minutes.",
      "The time is 15:50. How long is it until 7 pm?",
      "A train journey from Manchester to London takes 2 hours and 10 minutes. If you need to be in London by 11:30 am, what is the latest train you can catch?",
      "How many minutes are there in a day?",
      "A satellite orbits the Earth every 90 minutes. How many orbits does it complete in 24 hours?",
      "Convert 10,000 seconds into hours, minutes, and seconds.",
      "A meeting is scheduled for 10:00 am and lasts 75 minutes. There is then a 20-minute break before the next meeting. What time does the second meeting start?",
      "Your friend in New York is 5 hours behind you. If it is 6 pm in London, what time is it in New York?",
      "How many days old will you be on your 10th birthday (don't forget leap years!)?",
      "A car is parked from 9:30 am on Monday to 1:00 pm on Tuesday. How many hours has it been parked?",
      "The school holidays are 6 weeks long. How many hours is this?",
      "A recipe requires a dough to rise for 45 minutes, be kneaded for 10, and then rise again for 1 hour 15 minutes. What is the total time required?",
      "If a movie is 135 minutes long, what is its running time in hours and minutes?",
      "How many hours and minutes are there in 200 minutes?",
      "A train leaves at 08:55 and arrives at 11:40. How long did the journey take?",
      "Convert 3.5 weeks into days.",
      "A worker's shift is 8.5 hours long. How many minutes is this?",
      "What is the time 50 minutes before 1:20 pm?",
      "How many decades are in 250 years?",
      "A car is driven for 45 minutes every day. How many hours is this in a week?",
      "Convert 1000 hours into days and hours.",
      "A ferry sails at 23:15 and docks at 06:50 the next day. How long is the crossing?",
      "How many seconds are there in 1.75 minutes?",
      "A TV series has a total running time of 8 hours. If each episode is 40 minutes long, how many episodes are there?",
      "What is the time in Tokyo if it is 8 hours ahead of London and the time in London is 15:00?",
      "Convert 500 days into years, weeks, and days (assume a non-leap year).",
      "A battery lasts for 36 hours. How many days is this?",
      "How many minutes are there from 10:40 am on Tuesday to 1:10 pm on Tuesday?",
      "A historical period lasted for 150 years. How many decades is that?",
      "Convert 450 seconds into minutes and seconds.",
      "The summer holidays last for 44 days. How many weeks and days is this?",
      "A plane is delayed by 2 hours and 35 minutes. Its original departure time was 19:50. What is the new departure time?",
      "How many minutes are in 0.25 of an hour?",
      "A project takes 100 hours to complete. If a team of 4 people work on it, and each works for 5 hours a day, how many days will it take?",
      "Convert 3600 seconds into hours.",
      "A train was due at 16:30. It arrived 75 minutes late. What time did it arrive in 24-hour format?",
      "How many centuries are in a millennium?",
      "A person sleeps for 8 hours a night. How many hours do they sleep in a year?"
    ]
  },
  "convert_between_metric_units": {
    "Year 5": [
      "How many metres are in 3.5 kilometres?",
      "Convert 2500 grams into kilograms.",
      "A bottle contains 1.5 litres of water. How many millilitres is this?",
      "Change 45mm into centimetres.",
      "A piece of wood is 2.2 metres long. What is its length in centimetres?",
      "How many grams are in 4.5 kilograms?",
      "A ribbon is 1.8 metres long. How many centimetres is this?",
      "Convert 75mm into centimetres.",
      "A bucket holds 3.2 litres. What is its capacity in millilitres?",
      "A marathon is approximately 42 kilometres long. How many metres is this?",
      "Change 560cm into metres.",
      "A recipe uses 250g of butter. How many kilograms is this?",
      "A bottle of shampoo holds 0.4 litres. How many millilitres is this?",
      "A tower is 0.15km high. What is its height in metres?",
      "A small insect is 0.8cm long. How long is it in millimetres?",
      "Convert 1250ml to litres.",
      "An athlete runs 5000m. How many kilometres has he run?",
      "A bag of sweets weighs 0.125kg. What is the weight in grams?",
      "A fence panel is 180cm wide. What is its width in metres?",
      "A medicine dose is 5ml. A bottle contains 0.1 litres. How many doses are in the bottle?",
      "A room is 4.2m long. What is this measurement in centimetres?",
      "Change 3400g to kilograms.",
      "A journey is 3200m. How far is this in kilometres?",
      "Convert 2.75 litres into millilitres.",
      "A stack of paper is 4.5cm thick. What is the thickness in millimetres?",
      "A car travels 8km. How many metres is this?",
      "A bag of flour weighs 1.2kg. How many grams is this?",
      "A jug contains 750ml of juice. What is this in litres?",
      "Convert 1.5cm into millimetres.",
      "How many metres are in 250cm?",
      "A box weighs 3500g. What is its mass in kilograms?",
      "How many millilitres are in a 2-litre bottle of pop?",
      "A pencil is 15cm long. What is its length in millimetres?",
      "How many kilometres is 4500m?",
      "A recipe calls for 0.5kg of sugar. How many grams do you need?",
      "A swimming pool contains 50,000 litres of water. How many kilolitres is this?",
      "A piece of wire is 2.05m long. Write this length in centimetres.",
      "Convert 850g into kilograms.",
      "A can of soup holds 0.4 litres. How many millilitres is this?",
      "An ant is 6mm long. What is this in centimetres?",
      "A road is 12km long. What is this distance in metres?",
      "A baby weighs 4.1kg at birth. What is this weight in grams?",
      "Convert 325ml into litres.",
      "A door is 198cm high. What is its height in metres?",
      "A sheet of paper is 0.1mm thick. What is this in centimetres?",
      "A running track is 400m. How many laps is a 10km race?",
      "A baker uses 25g of yeast. What is this amount in kilograms?",
      "A fish tank holds 65 litres of water. A bucket holds 5000ml. How many buckets to fill the tank?",
      "A bridge has a weight limit of 7.5 tonnes. How many kilograms is this?",
      "A journey is 250km. How many metres is that?"
    ]
  },
  "convert_metric_imperial": {
    "Year 4": [
      "How many metres are there in a kilometre?",
      "How many minutes are in an hour?",
      "A road is 3km long. How many metres is that?",
      "A film is 120 minutes long. How many hours is that?",
      "A runner runs 5000m. How many kilometres has she run?",
      "A road is 5km long. How many metres is this?",
      "A lesson is 1 hour long. How many minutes is this?",
      "How many metres in 2.5 kilometres?",
      "A film lasts 90 minutes. How many hours and minutes is this?",
      "A runner does a 10km race. How many metres is this?",
      "How many minutes in 3 hours?",
      "Convert 1500m to km.",
      "Change 180 minutes to hours.",
      "A lorry drives 20km. How many metres did it travel?",
      "An exam is 2 hours long. How many minutes do the students have?",
      "A walk is 3000m long. What is this in km?",
      "A TV series is 6 hours long in total. How many minutes is that?",
      "Convert 7km into metres.",
      "How many hours in 240 minutes?",
      "A cyclist travels 15,000m. Convert this to km.",
      "How many minutes in a school day that lasts 6 hours?",
      "If you walk 1km to school and 1km back, how many metres do you walk in total?",
      "Change 30 minutes into a fraction of an hour.",
      "A bridge is 1.2km long. What is its length in metres?",
      "A meeting lasted 75 minutes. How much more than an hour was that?",
      "How many metres are in half a kilometre?",
      "A TV show is 45 minutes long. How much of an hour is this?",
      "A journey is 10km. How many metres is that?",
      "Convert 2 hours 30 minutes into minutes.",
      "A mountain is 3km high. What is its height in metres?",
      "How many hours in a day?",
      "Convert 7500m to kilometres and metres.",
      "A football match is 90 minutes long. How many hours is this?",
      "How many minutes are in 1.5 hours?",
      "A running race is 5km. How many metres do the athletes run?",
      "Change 240 seconds to minutes.",
      "A flight is 4 hours long. How many minutes is the plane in the air?",
      "A river is 8km long. What is this in metres?",
      "How many hours are there in 300 minutes?",
      "Convert 1km and 200m into metres.",
      "A school break is 15 minutes long. What fraction of an hour is this?",
      "How many metres in 1.1km?",
      "A worker's shift is 8 hours. How many minutes do they work?",
      "Change 2.5km into metres.",
      "How many hours and minutes is 100 minutes?",
      "A fence is 20m long. A field is 1km long. How many fences would fit along the field?",
      "Convert 360 minutes into hours.",
      "A film is 2.5 hours long. How many minutes is that?",
      "A cyclist rides for 20km. How many metres is this?",
      "How many seconds in 2 minutes?"
    ],
    "Year 5": [
      "If 1 inch is about 2.5 cm, how many centimetres are in 6 inches?",
      "A bag of sugar weighs 2.2 pounds (lbs). Approximately how many kilograms is this if 1 kg is about 2.2 lbs?",
      "A recipe requires 1 pint of milk. You have a 1-litre carton. Do you have enough? (1 litre ≈ 1.75 pints).",
      "A car is travelling at 50 miles per hour. Is it going faster or slower than a car travelling at 80 kilometres per hour? (5 miles ≈ 8 km).",
      "A man is 6 feet tall. Approximately what is his height in metres? (1 foot ≈ 30cm).",
      "The speed limit is 30 miles per hour. What is this approximately in kilometres per hour? (5 miles ≈ 8 km).",
      "A ruler is 12 inches long. Approximately how long is it in centimetres? (1 inch ≈ 2.5 cm).",
      "A boxer weighs 14 stone. If 1 stone is 14 pounds, what is his weight in pounds?",
      "A recipe asks for 4 ounces of flour. If 1 ounce is about 28g, how many grams do you need?",
      "A garden is 10 yards long. What is this in feet? (1 yard = 3 feet).",
      "A car has a 10-gallon petrol tank. Approximately how many litres is this? (1 gallon ≈ 4.5 litres).",
      "A door is 2 metres high. Is it taller than a man who is 6 feet tall? (1 foot ≈ 30cm).",
      "A bag of potatoes weighs 5 lbs. Approximately what is this in kg? (1 kg ≈ 2.2 lbs).",
      "I need 2 pints of milk. The shop only sells it in litres. Should I buy a 1-litre or 2-litre carton? (1 litre ≈ 1.75 pints).",
      "A road sign says the next town is 16km away. Approximately how many miles is this?",
      "A baby weighs 8 pounds at birth. What is this in ounces? (1 pound = 16 ounces).",
      "A marathon is about 26 miles. A local fun run is 10km. How many fun runs would equal the distance of a marathon?",
      "A table is 4 feet long. What is its length in inches?",
      "A vet weighs a dog and it is 15kg. Approximately what is its weight in pounds?",
      "An American tourist asks for a pint of beer. The barman serves him 500ml. Is this more or less than a pint?",
      "My waist measurement is 32 inches. What is this in cm?",
      "A bottle of perfume holds 50ml. What is this in fluid ounces? (1 fl oz ≈ 28ml).",
      "A plane flies at an altitude of 30,000 feet. What is this in miles? (1 mile = 5280 feet).",
      "A recipe requires the oven to be at 400°F. Your oven is in Celsius. What should you set it to?",
      "The USA measures distance in miles and the UK in miles, but most of Europe uses kilometres. Discuss the advantages of a single system.",
      "A baby weighs 7 pounds. Approximately how many grams is this? (1 pound ≈ 450g)",
      "A carton of juice holds 2 pints. Is this more or less than 1 litre?",
      "A road speed limit is 40 mph. What is this approximately in km/h?",
      "A piece of wood is 3 feet long. How many inches is that?",
      "A car's fuel efficiency is 50 miles per gallon. Approximately what is this in km per litre?",
      "A person is 5 feet 10 inches tall. What is their approximate height in centimetres?",
      "A bag of flour weighs 4 lbs. How many ounces is this?",
      "A US travel guide says a journey is 100 miles. Your car's odometer is in km. What distance should you look for?",
      "A recipe calls for 8 fluid ounces of cream. You have a 250ml pot. Is it enough?",
      "A parcel has a weight limit of 5kg. Your parcel weighs 10 lbs. Can you post it?",
      "The length of a football pitch is 100 yards. What is this in feet?",
      "A pint of milk costs 60p. A litre of milk costs £1. Which is better value if you need 2 litres?",
      "The distance to the moon is about 238,900 miles. What is this in km?",
      "A boxer needs to be under 12 stone to fight. He weighs 75kg. Does he qualify? (1 stone ≈ 6.35kg)",
      "A plank of wood is 2 inches thick. What is this in mm?",
      "A car is travelling at 100 km/h. Is it breaking the UK speed limit of 70 mph?",
      "A recipe from the US uses cups. 1 cup is about 240ml. How many ml in 3 cups?",
      "A farm is 50 acres in size. Is this bigger or smaller than 25 hectares? (1 hectare ≈ 2.5 acres)",
      "An athlete weighs 150 pounds. What is this in stone and pounds?",
      "A bottle of wine holds 75cl. A US bottle holds 25 fluid ounces. Which is larger?",
      "A mountain is 14,000 feet high. How high is this in metres?",
      "A car journey in France is 300km. Approximately how many miles is this?",
      "A steak weighs 8 ounces. What is this in grams?",
      "A garden hose is 50 feet long. Your garden is 15 metres long. Is the hose long enough?",
      "A fish tank holds 20 US gallons. How many litres is that approximately? (1 US gallon ≈ 3.8 litres)"
    ],
    "Year 6": [
      "The distance between two cities is 150 miles. What is this distance in kilometres? (5 miles ≈ 8 km).",
      "A suitcase weighs 23kg. Convert this weight to grams.",
      "A bottle holds 750ml of liquid. What is this in litres?",
      "A marathon is approximately 26 miles. How many kilometres is this?",
      "A car's petrol tank holds 50 litres. Approximately how many gallons is this? (1 gallon ≈ 4.5 litres).",
      "A car travels at an average speed of 40 mph. How long will it take to travel 100 miles?",
      "Convert 2.5kg into grams.",
      "A bottle contains 0.33 litres of water. What is this in millilitres?",
      "Change 1.75m into centimetres.",
      "The distance from London to Edinburgh is approximately 400 miles. What is this in km?",
      "A parcel weighs 3200g. Convert this to kg.",
      "A recipe needs 250ml of cream. The tub contains 0.5 litres. What fraction of the tub is used?",
      "Convert 5 feet and 10 inches into inches only. Then, convert this to cm.",
      "A swimmer swims 20 lengths of a 50m pool. How far is this in kilometres?",
      "A lorry has a maximum load weight of 7.5 tonnes. How many kilograms is this?",
      "Convert a speed of 60km/h into metres per minute.",
      "A piece of wood is 1.05m long. What is its length in millimetres?",
      "An athlete runs 100 metres in 10 seconds. What is their speed in km/h?",
      "A petrol tank holds 55 litres. If the car uses 8 litres per 100km, how far can it travel on a full tank?",
      "Change 4.5 litres into cm³. (1 litre = 1000 cm³).",
      "A map has a scale where 1cm represents 2km. The distance on the map is 8.5cm. What is the real distance?",
      "A baby weighs 3.45kg. What is this weight in grams?",
      "The Earth's circumference is approximately 24,901 miles. Convert this to kilometres.",
      "A medicine requires a dose of 2.5ml. How many doses can you get from a 0.25 litre bottle?",
      "Convert 1 square metre into square centimetres.",
      "A car is travelling at 50 mph. How many miles does it travel in 1 hour and 30 minutes?",
      "Convert 3.2km into metres.",
      "A jug holds 1.5 litres. 400ml is poured out. How much is left in litres?",
      "A person is 6 feet 2 inches tall. What is their approximate height in cm? (1 inch ≈ 2.54cm)",
      "The speed of light is approximately 300,000 km per second. How far does it travel in a minute?",
      "A field is 2.5 hectares. How many square metres is this? (1 hectare = 10,000 m²)",
      "Convert 0.75kg into grams.",
      "A journey of 200 miles starts with a full 12-gallon tank of petrol. The car does 40 miles per gallon. How much petrol is left at the end?",
      "Change 1 hour 45 minutes into a decimal of hours.",
      "A box has a volume of 2.5m³. How many litres can it hold? (1m³ = 1000 litres)",
      "Convert a speed of 30 metres per second into kilometres per hour.",
      "A parcel weighs 4.5 lbs. What is its approximate weight in kilograms? (1kg ≈ 2.2 lbs)",
      "A recipe needs 8 ounces of cheese. How many grams is this? (1 ounce ≈ 28.35g)",
      "The area of a room is 20 square yards. What is this in square feet? (1 yard = 3 feet)",
      "Convert 1.2 cubic metres into cubic centimetres.",
      "A flight from London to New York is approximately 3460 miles. How long would this take at an average speed of 550 mph?",
      "A medicine dosage is 5ml per 10kg of body weight. What is the dose for a person weighing 11 stone? (1 stone ≈ 6.35kg)",
      "Convert 25°C to Fahrenheit. F = (C * 9/5) + 32.",
      "A car travels 80km in 1 hour. How many metres does it travel in 1 second?",
      "The density of gold is 19.3 g/cm³. What is the mass of a gold bar with a volume of 100cm³?",
      "Convert 1 year into seconds.",
      "A pressure of 1 bar is approximately 14.5 psi. What is 30 psi in bar?",
      "The distance of a marathon (26.2 miles) is run by a top athlete in about 2 hours 5 minutes. What is their average speed in mph?",
      "A bottle contains 0.7 litres of liquid. What is this in millilitres?",
      "Convert 5 tonnes to kilograms."
    ]
  },
  "perimeter_area": {
    "Year 3": [
      "A square has sides of 5cm. What is its perimeter?",
      "A rectangle has a length of 8cm and a width of 4cm. What is its perimeter?",
      "Draw a shape with a perimeter of 12cm on squared paper.",
      "The school playground is a rectangle. One side is 20m long and the other is 15m long. What is the perimeter of the playground?",
      "If you walk all the way around a square park with sides of 50m, how far have you walked?",
      "The perimeter of a square is 20cm. How long is each side?",
      "Draw a rectangle with a perimeter of 14cm.",
      "A triangular field has sides of 30m, 40m, and 50m. What is its perimeter?",
      "Measure the perimeter of the cover of your reading book.",
      "An octagon has 8 equal sides of 3cm each. What is its perimeter?",
      "The school hall is a rectangle 30m long and 15m wide. What is its perimeter?",
      "I have a piece of string 25cm long. Can I use it to go all the way around a square with 6cm sides?",
      "Find the perimeter of a regular hexagon with sides of 10cm.",
      "The perimeter of a rectangle is 18cm. Its length is 6cm. What is its width?",
      "Walk around the edge of the school playground. You have just walked its perimeter.",
      "A farmer wants to put a fence around a field. The sides are 100m, 120m, 80m and 90m. How much fencing does he need?",
      "Measure the sides of a 50p coin and estimate its perimeter.",
      "Draw two different shapes that both have a perimeter of 16cm.",
      "The perimeter of an equilateral triangle is 21cm. How long is each side?",
      "A photo frame is 20cm long and 15cm wide. What is the total length of wood needed to make it?",
      "Find the perimeter of your classroom.",
      "A rectangle's perimeter is 22m. What could its length and width be?",
      "If I run around a square park twice and the side of the park is 100m, how far have I run?",
      "Measure the perimeter of a CD case.",
      "A garden is in the shape of a regular pentagon with sides of 8m. What is its perimeter?",
      "A triangle has sides of 6cm, 7cm and 8cm. What is its perimeter?",
      "Calculate the perimeter of a rectangle that is 10cm long and 5cm wide.",
      "A square garden has a perimeter of 24m. What is the length of one side?",
      "Measure the perimeter of a postcard.",
      "A five-sided shape has sides of 4cm, 5cm, 6cm, 4cm, and 5cm. What is the perimeter?",
      "A rectangular swimming pool is 25m long and 10m wide. What is its perimeter?",
      "The perimeter of a regular octagon is 40cm. How long is each side?",
      "Draw a shape on squared paper and calculate its perimeter by counting the squares around the edge.",
      "A book cover measures 20cm by 15cm. What is its perimeter?",
      "A farmer puts a fence around a square field. If one side is 120m, how much fencing is needed?",
      "An equilateral triangle has a perimeter of 30cm. What is the length of one side?",
      "A rectangular room is 5m long and 4m wide. What is the perimeter of the room?",
      "Find the perimeter of a hexagon with equal sides of 9cm.",
      "A shape has a perimeter of 18cm. All its sides are 3cm long. What is the shape?",
      "Measure the perimeter of the interactive whiteboard in your classroom.",
      "A rectangular photo has a length of 12cm and a width of 7cm. What is its perimeter?",
      "A square has a side length of 11m. What is its perimeter?",
      "A playground is a rectangle with a perimeter of 100m. If the length is 30m, what is the width?",
      "Calculate the perimeter of a triangle with sides 12cm, 15cm, and 17cm.",
      "A field has a perimeter of 200m. A farmer walks around it three times. How far does he walk?",
      "Draw an irregular shape and measure its perimeter.",
      "A rectangle has a perimeter of 26cm and a length of 8cm. Find its width.",
      "What is the perimeter of a regular pentagon with 6cm sides?",
      "Measure the perimeter of a tablet or phone screen.",
      "A dog lead is 2m long. If you use it to make a square on the ground, what is the perimeter?"
    ],
    "Year 4": [
      "Find the area of a rectangle with sides 6cm and 4cm by counting squares.",
      "Calculate the perimeter of a rectangle that is 12m long and 5m wide.",
      "A square has a perimeter of 24cm. What is the length of one of its sides?",
      "Draw a rectilinear shape on squared paper and find its area and perimeter.",
      "A farmer's field is 100m long and 50m wide. What is its perimeter?",
      "A square has an area of 25cm². What is the length of its side?",
      "A rectilinear shape is made of two rectangles. One is 3cm by 4cm, the other is 5cm by 2cm. What is the total area?",
      "Find the area of your classroom floor in square metres (by counting floor tiles or measuring).",
      "A swimming pool is 25m long and 10m wide. What is its perimeter?",
      "The area of a rectangle is 24m². What could its length and width be? Give two examples.",
      "On squared paper, draw a shape with an area of 15 squares and find its perimeter.",
      "A football pitch is 100m long and 60m wide. What is its area?",
      "Find the perimeter of an L-shaped room with given dimensions.",
      "A garden has an area of 30m². A patio with an area of 5m² is built in it. What is the area of the remaining garden?",
      "Draw a shape that has a perimeter of 20cm and an area of 9cm².",
      "The perimeter of a square is 32cm. What is its area?",
      "A window is made of 12 square panes of glass. Each pane is 20cm by 20cm. What is the total area of the window?",
      "Find the area of the letter 'T' drawn on 1cm squared paper.",
      "A wall is 5m long and 3m high. What is its area?",
      "A rug is 2m by 3m. Will it fit in a room with an area of 10m²?",
      "Calculate the perimeter of a cross shape made from 5 squares, each with a side of 3cm.",
      "Find the area of a photograph that is 6 inches by 4 inches.",
      "A farmer has 40m of fencing. What is the largest rectangular area he can enclose?",
      "A rectangle has a length of 9cm and a perimeter of 30cm. What is its area?",
      "Count the squares to find the approximate area of a circle drawn on squared paper.",
      "A rectangular garden is 15m long and 10m wide. What is its perimeter and area?",
      "Find the area of an L-shaped room by splitting it into two rectangles.",
      "The area of a square is 49cm². What is its perimeter?",
      "Draw a rectilinear shape with an area of 18 squares. What is its perimeter? Can you draw another with the same area but a different perimeter?",
      "A piece of paper is 30cm long and 20cm wide. What is its area?",
      "Calculate the perimeter of a rectilinear shape with sides of 8m, 5m, 3m, 2m, 5m and 3m.",
      "A floor is tiled with square tiles. If the floor is 10 tiles long and 8 tiles wide, what is the area in tiles?",
      "A rectangle has a perimeter of 28cm. Its width is 4cm. What is its length and area?",
      "Find the area of the letter 'H' on squared paper.",
      "A dog run is 12m long and 3m wide. What is its area?",
      "The perimeter of a rectangular field is 180m. The length is 50m. What is the width?",
      "Count the squares to find the area of an irregular shape like a leaf.",
      "A small patio is made of 30 square slabs, each 1m by 1m. What is the area of the patio?",
      "A square has a perimeter of 44cm. What is its area?",
      "A room is 6m by 4m. A rug in the room is 3m by 2m. What is the area of the floor not covered by the rug?",
      "Calculate the area of a composite shape made from a 5cm x 5cm square and a 3cm x 2cm rectangle.",
      "A school hall has a perimeter of 80m. It is 25m long. What is its width and area?",
      "Find the area of the letter 'E' drawn on 1cm grid paper.",
      "A rectangular vegetable patch is 8m long and has an area of 40m². What is its width?",
      "Calculate the perimeter of a 'plus' sign shape made from 5 identical squares of side 2cm.",
      "A swimming pool is 25m long and 12m wide. What is the area of the water's surface?",
      "A rectangle has an area of 36cm². What are the possible whole number lengths and widths?",
      "Find the area of a rectilinear shape by subtracting a missing part from a larger rectangle.",
      "The area of a square is 81m². What is the length of its side?",
      "A path is 10m long and 2m wide. What is its area?"
    ],
    "Year 5": [
      "A composite rectilinear shape is made from two rectangles. One is 5cm by 3cm and the other is 6cm by 4cm. What is the total area?",
      "Calculate the perimeter of an L-shaped room with given side lengths.",
      "The area of a square is 36cm². What is the length of one of its sides?",
      "Estimate the area of an irregular shape (like a leaf) by drawing it on squared paper and counting the squares.",
      "A rectangle has a perimeter of 30m. If its length is 10m, what is its width?",
      "Calculate the area of a rectangle with a length of 12m and a width of 7m.",
      "The perimeter of a regular hexagon is 48cm. What is the length of one side?",
      "A composite shape is formed by a 5m x 5m square and a 3m x 8m rectangle. Find its total area and perimeter.",
      "A rectangular field is 80m long and has a perimeter of 260m. What is its width?",
      "Draw an irregular shape and estimate its area by counting squares.",
      "The area of a rectangle is 45cm². Its width is 5cm. What is its length and perimeter?",
      "Compare the areas of two school playing fields. Which is larger?",
      "A room is 5.5m long and 4m wide. What is its area?",
      "A path 1m wide is built around a rectangular lawn that is 10m by 8m. What is the area of the path?",
      "A square has an area of 64m². What is its perimeter?",
      "Calculate the perimeter of a shape made of two equilateral triangles joined along one side, where each side is 6cm.",
      "A tablecloth measures 2m by 1.5m. What is its area?",
      "Estimate the area of your hand in cm².",
      "A rectangular swimming pool has an area of 250m². If it is 25m long, how wide is it?",
      "A small photo is 10cm by 15cm. It is enlarged so each side is doubled. What is the new area and perimeter?",
      "A garden is L-shaped. The lengths of the six sides are given. Calculate the perimeter and area.",
      "Find the area of a classroom with dimensions 7.2m by 8.5m.",
      "The perimeter of a rectangle is 34cm. Its area is 60cm². What are its dimensions?",
      "A piece of A4 paper is approximately 30cm by 21cm. What is its approximate area?",
      "A wall is 6m by 2.5m. A door in the wall is 2m by 0.8m. What is the area of the wall to be painted?",
      "Calculate the area of a rectangle that is 1.5m long and 0.8m wide.",
      "A square has a perimeter of 100cm. What is its area?",
      "A composite shape is made of a rectangle 10cm by 6cm, with a square of side 3cm removed from one corner. What is the area and perimeter of the new shape?",
      "Estimate the area of a puddle by drawing it on squared paper.",
      "A football pitch has an area of 7140m². It is 105m long. What is its width?",
      "The perimeter of a regular octagon is 64cm. What is the length of one side?",
      "Calculate the area of a room that is 4.5m by 3.5m.",
      "A rectangular garden is 20m long. Its area is 300m². Find the perimeter of the garden.",
      "A shape is made from three identical squares of side 5cm joined in a row. What is the perimeter of the shape?",
      "Estimate the area of a local park in square metres.",
      "The area of a square is 144cm². What is its perimeter?",
      "A rectangular swimming pool is 25m by 10m. It is surrounded by a path that is 2m wide. What is the area of the path?",
      "Calculate the perimeter of a composite rectilinear shape with given side lengths.",
      "A rectangle has an area of 0.5m². What could its dimensions be in cm?",
      "A farmer has a field that is 120m by 80m. What is its area in square metres?",
      "A window is 1.2m wide and 1.5m high. What is its area?",
      "The perimeter of a rectangular room is 18m. Its length is 5.5m. What is its area?",
      "A composite shape has an area of 50cm². It is made of two rectangles. One has an area of 20cm². What is the area of the second?",
      "Estimate the surface area of a large lake.",
      "A square piece of card has a perimeter of 60cm. What is its area?",
      "A kitchen floor is 5m by 3m. Floor tiles are 50cm by 50cm. How many tiles are needed?",
      "Calculate the perimeter and area of a T-shaped room.",
      "A rectangle has an area of 48cm² and a perimeter of 28cm. What are its dimensions?",
      "A wall is 7m long and 2.5m high. A window on the wall is 1.5m by 1m. What is the area of the brickwork?",
      "A regular pentagon has a perimeter of 75cm. How long is each side?"
    ],
    "Year 6": [
      "Calculate the area of a triangle with a base of 10cm and a height of 6cm.",
      "A parallelogram has a base of 8m and a perpendicular height of 5m. What is its area?",
      "A shape has an area of 20cm². Can you draw two different shapes (a rectangle and a triangle) that both have this area?",
      "The living room in a house is a rectangle 6m long and 4m wide. The hallway is a rectangle 5m long and 1.5m wide. What is the total area of both rooms?",
      "Recognise that a rectangle with a perimeter of 16cm could have sides of 4cm and 4cm (area 16cm²) or 6cm and 2cm (area 12cm²).",
      "A triangle has an area of 24cm² and a base of 8cm. What is its perpendicular height?",
      "Find the area of a parallelogram with a base of 12m and a height of 7m.",
      "Draw two different rectangles that both have a perimeter of 18cm. Which one has the larger area?",
      "Calculate the area of a right-angled triangle with sides 5cm, 12cm, and 13cm.",
      "The area of a parallelogram is 50m². Its height is 4m. What is the length of its base?",
      "A triangular sail has a base of 4m and a height of 5m. What is its area?",
      "A shape is made from a rectangle and a triangle. Calculate the total area.",
      "A garden is in the shape of a parallelogram. The base is 15m and the perpendicular distance between the parallel sides is 10m. What is the area of the garden?",
      "A rhombus can be split into two identical triangles. Find the area of a rhombus with given diagonal lengths.",
      "Compare the area of a square with side length 4cm and a triangle with base 8cm and height 4cm.",
      "A logo is designed using a triangle and a parallelogram. Find its total area.",
      "A field in the shape of a triangle has a base of 100m and a height of 60m. What is its area in square metres?",
      "Can a triangle have the same area as a parallelogram? Explain how.",
      "The two parallel sides of a trapezium are 10cm and 14cm, and the height is 6cm. Find its area.",
      "A rectangular room has an area of 24m². A triangular rug placed in the room has an area of 6m². What fraction of the floor is covered by the rug?",
      "Find the area of a composite shape made from three different triangles.",
      "A kite is made from two triangles. One has a height of 20cm and the other 40cm. Both have a base of 30cm. What is the total area?",
      "The perimeter of a rectangle is 28cm. The area of a triangle is 12cm². Can you determine if one is larger than the other?",
      "A plot of land is a parallelogram with a base of 50m. The area is 1000m². What is its perpendicular height?",
      "Explain why two shapes can have the same area but different perimeters.",
      "A right-angled triangle has a base of 7cm and a height of 8cm. What is its area?",
      "The area of a triangle is 30m². Its height is 6m. What is the length of its base?",
      "A parallelogram has an area of 45cm² and a base of 9cm. What is its perpendicular height?",
      "A rectangular garden is 12m by 8m. A triangular pond with a base of 4m and height of 3m is in the middle. What is the area of the grass?",
      "Draw a rectangle with a perimeter of 24cm and the largest possible area.",
      "A triangular piece of paper has a height of 15cm and a base of 10cm. What is its area?",
      "The area of a parallelogram is 72m². What could its base and height be? (Give two examples).",
      "A shape is made of a 10cm x 8cm rectangle with a triangle of base 8cm and height 5cm on top. What is the total area?",
      "True or false: If you double the sides of a rectangle, you double its area and its perimeter.",
      "Find the area of a triangle with a base of 2.5m and a height of 4m.",
      "A parallelogram has a perimeter of 30cm. Two of its sides are 10cm long. What are the lengths of the other two sides?",
      "A garden is a trapezium with parallel sides of 20m and 30m, and a height of 15m. What is its area?",
      "A shape with an area of 100cm² can have different perimeters. Give an example of two shapes.",
      "The side of a building is a triangle on top of a square. The square is 10m x 10m. The triangle has a base of 10m and a height of 6m. Find the total area.",
      "The area of a triangle is 18cm². Its base and height are equal. What is their length?",
      "Calculate the area of a parallelogram with a base of 1.5m and a height of 2m.",
      "A rectangular flag is 3m by 2m. It has a diagonal stripe that forms two triangles. What is the area of each triangle?",
      "A room is a rectangle (5m x 4m) with a triangular bay window (base 3m, height 1.5m). What is the total floor area?",
      "Why is the area of a triangle half of base times height?",
      "Find the area of a rhombus with diagonals of 10cm and 16cm.",
      "A rectangular field has an area of 1 hectare (10,000m²). It is 200m long. What is its perimeter?",
      "A triangle and a parallelogram have the same base and the same area. What is the relationship between their heights?",
      "The perimeter of a rectangle is the same as the perimeter of a 10cm side square. The rectangle is 12cm long. What is its area?",
      "Find the area of a composite shape by enclosing it in a larger rectangle and subtracting the missing parts."
    ]
  },
  "volume": {
    "Year 5": [
      "Using 1cm³ blocks, build a cuboid that is 3 blocks long, 2 blocks wide, and 2 blocks high. What is its volume?",
      "Estimate which of two containers has a greater capacity by pouring water from one to the other.",
      "If a box has a volume of 24cm³, what could its dimensions be?",
      "Look at a picture of a cuboid made from centimetre cubes. Can you work out its volume?",
      "Estimate the volume of your lunchbox.",
      "How many 1cm³ cubes would you need to make a 2cm by 3cm by 4cm cuboid?",
      "Estimate the capacity of a drinking glass in millilitres.",
      "If you have 100 centimetre cubes, what are the dimensions of three different cuboids you could make?",
      "A box is filled with 1cm³ cubes. It has 4 layers and each layer has 12 cubes. What is the volume?",
      "Look at a carton of juice. What is its volume/capacity as written on the label?",
      "Estimate the volume of your pencil case.",
      "A fish tank is a cuboid. You pour in 10 litres of water. What is the volume of the water in cm³?",
      "Build a shape with a volume of 18cm³ using interlocking cubes.",
      "Estimate, then measure, how many spoonfuls of rice it takes to fill a small container.",
      "A Rubik's cube is 3x3x3 small cubes. What is its volume in cubes?",
      "If a cuboid has a volume of 30cm³, what could its length, width and height be?",
      "Estimate the volume of a shoebox.",
      "Compare the capacity of a mug and a teacup. Which holds more?",
      "A box contains 16 smaller cubes. What could the arrangement of cubes be?",
      "A jug holds 1 litre of water. If you pour out 300ml, what volume of water is left?",
      "Build a cube with side lengths of 4cm using 1cm³ blocks. How many blocks did you use?",
      "Estimate the volume of a brick.",
      "If 500ml of water is poured into a 1-litre container, what percentage of the container is full?",
      "A pack of sugar cubes contains 48 cubes arranged in a cuboid shape. What could the dimensions of the pack be?",
      "Does a larger object always have a larger volume? Discuss (e.g., a beach ball vs a brick).",
      "A cuboid is made from 36 centimetre cubes. What could its length, width and height be?",
      "Estimate the capacity of a bathtub in litres.",
      "How many 1cm³ cubes are needed to make a cube with sides of 5cm?",
      "A shape is made of 5 layers of cubes. Each layer is a 3 by 4 rectangle. What is the volume?",
      "Estimate the volume of a can of baked beans in cm³.",
      "A box has a volume of 12 cubes. Sketch two possible cuboids with this volume.",
      "A swimming pool is half full. Its total capacity is 50,000 litres. What volume of water is in the pool?",
      "Build a shape with a volume of 20cm³. How many cubes did you use?",
      "Estimate the volume of your classroom in cubic metres.",
      "A box is 10cm long, 5cm wide, and 4cm high. How many 1cm³ cubes will it hold?",
      "If a cuboid has a volume of 40cm³, give two sets of possible dimensions (length, width, height).",
      "Estimate the capacity of a car's petrol tank in litres.",
      "A large cube is made from 27 small cubes. What are the dimensions of the large cube?",
      "A glass contains 250ml of water. A jug contains 1 litre. Estimate how many glasses you can fill from the jug.",
      "A box of chocolates has two layers. Each layer has 12 chocolates. If each chocolate is roughly a 2cm cube, estimate the volume of the box.",
      "A cuboid is built with 30 cubes. The base is 5 cubes long and 2 cubes wide. How high is it?",
      "Estimate the volume of a single Lego brick.",
      "A paddling pool takes 10 buckets of water to fill. If a bucket holds 5 litres, what is the capacity of the pool?",
      "A shape has a volume of 16cm³. Can it be a cube with whole number sides?",
      "Estimate the capacity of a cereal box in cm³.",
      "A tower is made from 1cm³ cubes. It is 8 cubes high, 3 cubes long, and 3 cubes wide. What is its volume?",
      "Which has a larger volume: a football or a rugby ball? How could you test your estimate?",
      "A box can hold 100 sugar cubes. If the box is 10 cubes long and 5 cubes wide, how many layers are there?",
      "Estimate the volume of water you drink in a day.",
      "A cuboid has a volume of 72cm³. Its length is 6cm and width is 4cm. How high is it?"
    ],
    "Year 6": [
      "Calculate the volume of a cuboid with a length of 8cm, a width of 5cm, and a height of 4cm.",
      "A cube has a side length of 6cm. What is its volume?",
      "A fish tank is 50cm long, 30cm wide, and 20cm high. What is its volume in cm³?",
      "How many 1cm³ cubes would you need to make a 3cm by 3cm by 3cm cube?",
      "A box has a volume of 60m³. If its length is 5m and its width is 4m, what is its height?",
      "A cereal box has dimensions of 20cm by 30cm by 5cm. What is its volume?",
      "Find the volume of a cube with edges of 10cm.",
      "A swimming pool is 25m long, 10m wide, and 2m deep. What volume of water does it hold in cubic metres?",
      "The volume of a cuboid is 72cm³. Its length is 6cm and its width is 3cm. What is its height?",
      "How many 1cm³ cubes can fit into a box that is 10cm by 5cm by 4cm?",
      "A concrete block has a volume of 8000cm³. What is this in litres?",
      "Compare the volume of a cube with 5cm sides and a cuboid measuring 4cm x 5cm x 6cm.",
      "An aquarium is 60cm long, 30cm wide, and 40cm high. If it is half full, what is the volume of the water?",
      "A lorry's container is 10m long, 2.5m wide, and 3m high. What is its volume?",
      "A small box has a volume of 100cm³. A large box has dimensions that are double the small box. What is the volume of the large box?",
      "A wooden beam is 2m long, 10cm wide, and 5cm thick. Find its volume in cm³.",
      "A storage unit has a volume of 30m³. What could its dimensions be?",
      "Calculate the volume of your classroom in cubic metres.",
      "A set of 4 identical books forms a stack that is 20cm long, 15cm wide and 12cm high. What is the volume of a single book?",
      "A cube has a volume of 125cm³. What is the length of one of its sides?",
      "A removal van has a storage space of 25m³. Can it fit the contents of a flat with a total volume of 22m³?",
      "A fish tank has a base area of 2000cm². If water is poured in to a depth of 30cm, what is the volume of the water?",
      "Convert 1 cubic metre (m³) into cubic centimetres (cm³).",
      "A block of cheese is a cuboid measuring 10cm x 8cm x 5cm. If a piece with a volume of 80cm³ is cut off, what is the volume of the remaining cheese?",
      "Estimate the volume of air in a bus.",
      "A cuboid has a length of 1.5m, a width of 0.5m, and a height of 1m. What is its volume in m³?",
      "What is the volume of a cube with a side length of 20mm?",
      "A shipping container is 12m long, 2.5m wide, and 3m high. What is its volume?",
      "The volume of a box is 200cm³. Its base is 10cm by 5cm. What is its height?",
      "How many 2cm x 2cm x 2cm cubes could fit into a 10cm x 10cm x 10cm box?",
      "A garden bed is 5m long, 1m wide, and 0.5m deep. What volume of soil is needed to fill it in cubic metres?",
      "A cube has a volume of 27m³. What is the length of one of its edges?",
      "A paddling pool is 2m long, 1.5m wide, and is filled to a depth of 0.4m. What is the volume of water in the pool?",
      "A box of tea bags is 14cm long, 7cm high, and 5cm wide. Calculate its volume.",
      "A lorry can carry a volume of 60m³. How many boxes with a volume of 1.5m³ can it carry?",
      "A room has a volume of 75m³. It is 5m long and 5m wide. How high is the ceiling?",
      "Calculate the volume of a cube with a side length of 0.5m. Give your answer in cm³.",
      "A block of ice measures 30cm by 20cm by 15cm. What is its volume?",
      "A fish tank has a volume of 90 litres. What could its dimensions be in cm? (1 litre = 1000cm³)",
      "A cube has a surface area of 54cm². What is its volume?",
      "A swimming pool is 50m long and 20m wide. If it holds 1500m³ of water, what is its average depth?",
      "What is the volume of a cuboid with dimensions 12mm, 2cm, and 0.5m? Give your answer in cm³.",
      "The volume of a large box is 1m³. The volume of a small box is 1cm³. How many small boxes fit in the large one?",
      "A water tank is 3m long, 2m wide and 1.5m high. It is 2/3 full. What is the volume of water in the tank?",
      "A cuboid has a volume of 300cm³. Its length is 10cm and its height is 5cm. What is its width?",
      "Estimate, then calculate, the volume of a refrigerator.",
      "A cube has a volume of 1000cm³. What is the area of one of its faces?",
      "A sandpit is 2.5m by 2m by 0.3m. What is the volume of sand it can hold?",
      "Two cuboids have the same volume. One is 4x5x6cm. The other has a base of 3x5cm. What is its height?",
      "Calculate the volume of air in your classroom in cubic metres."
    ]
  },
  "solve_problems_money_length_mass_weight_capacity_volume": {
    "Year 2": [
      "I have 50p. I buy an apple for 20p. How much money do I have left?",
      "A ribbon is 30cm long. I cut off 10cm. How much is left?",
      "A bag of sweets weighs 100g. I eat 30g. What is the weight of the sweets left in the bag?",
      "A cup holds 200ml of water. If I drink half of it, how much is left?",
      "Leo has £20. He buys two cinema tickets that cost £7 each. How much money does he have left?",
      "A pencil costs 15p. A rubber costs 10p. How much for both?",
      "My plant was 8cm tall. It grew 5cm more. How tall is it now?",
      "I have a 100g bag of crisps. I share it equally with a friend. How many grams do we get each?",
      "A bottle holds 500ml of water. I drink 100ml. How much is left?",
      "I have £1. A book costs 80p. Do I have enough money? How much change?",
      "A piece of string is 25cm long. I need a piece 30cm long. How much more do I need?",
      "An apple weighs 90g. A banana weighs 110g. What is their total weight?",
      "A cup holds 150ml. How much do two cups hold?",
      "A comic costs 75p. I pay with three 20p coins and three 5p coins. Is this correct?",
      "A tower of blocks is 40cm high. I add 3 more blocks that are each 2cm high. What is the new height?",
      "A cake weighs 500g. If I cut it into 10 equal slices, how much does each slice weigh?",
      "A car has 4 wheels. How many wheels on 5 cars?",
      "I have 60p. Sweets are 5p each. How many can I buy?",
      "My sunflower is 1m tall. My friend's is 85cm tall. What is the difference in height?",
      "A bag contains 1kg of sugar. I use half of it. How many grams are left?",
      "A bottle of lemonade holds 1 litre. A glass holds 200ml. How many full glasses can I pour?",
      "I buy stickers for 25p and a pen for 30p. How much change from £1?",
      "A running track is 100m long. How far is it to run around it three times?",
      "A dog weighs 12kg. A cat weighs 5kg. How much heavier is the dog?",
      "A jug of juice holds 800ml. I pour 250ml into a glass. How much is left in the jug?",
      "A toy car costs 70p. How much change do I get from a £1 coin?",
      "A snake is 45cm long. It grows another 15cm. How long is it now?",
      "A bag of apples weighs 1kg. I take out two apples weighing 100g each. What is the new weight?",
      "A bucket holds 10 litres of water. I use 3 litres to water the plants. How much is left?",
      "I have £2. I buy a magazine for £1.50. How much do I have left?",
      "A fence is 10m long. I add another 5m section. What is the total length?",
      "A box of cereal weighs 500g. The box itself weighs 50g. What is the weight of the cereal?",
      "A can of pop holds 330ml. How much do two cans hold?",
      "I save 20p every day for 5 days. How much have I saved?",
      "My desk is 80cm wide. My friend's desk is 70cm wide. What is the difference?",
      "A bag of flour weighs 1kg. A recipe needs 200g. How much is left?",
      "A jug has 600ml of juice. I share it equally between 3 glasses. How much is in each glass?",
      "A ticket to the zoo costs £10. How much for a family of four?",
      "A plant is 25cm tall. It needs to grow another 25cm to reach the window. How high is the window?",
      "A bag of carrots weighs 500g. A bag of potatoes weighs 1kg. What is the total weight?",
      "A bottle contains 1 litre of water. I pour it into 100ml cups. How many cups can I fill?",
      "A teddy costs £5. A doll costs £8. What is the total cost?",
      "A piece of wool is 1m long. I cut it in half. How many cm is each piece?",
      "I have 2kg of dog food. My dog eats 100g a day. How many days will the food last?",
      "A swimming pool is 25m long. I swim two lengths. How far have I swum?",
      "A bar of chocolate costs 65p. How much change from £1?",
      "A tower is 50cm high. I take off a 10cm block. How high is it now?",
      "A recipe needs 100g of butter. I have a 250g block. How much is left?",
      "A watering can holds 2 litres. It is half full. How many ml of water are in it?",
      "A film is 90 minutes long. A TV show is 30 minutes long. What is the difference in duration?"
    ],
    "Year 3": [
      "A t-shirt costs £5.50 and a pair of shorts costs £4.75. How much do they cost altogether?",
      "My journey to school is 2km. I have walked 800m. How much further do I have to go?",
      "A baker has 1kg of flour. He uses 450g to make a cake. How much flour is left?",
      "A bottle of juice contains 1 litre. I pour out a 250ml glass. How much is left in the bottle?",
      "If I pay for a £2.80 magazine with a £5 note, how much change will I get?",
      "A CD costs £7.99. A DVD costs £9.50. What is the total cost?",
      "A plank of wood is 3m long. I cut off a piece that is 120cm. How much is left in metres?",
      "A recipe needs 350g of flour from a 1kg bag. How much flour will be left in the bag?",
      "I have a 2-litre bottle of cola. I drink 400ml. How much is left?",
      "I buy a book for £4.80 and pay with a £10 note. What is my change?",
      "A fence is made of panels that are 1.8m long. How long would a fence with 10 panels be?",
      "A baker makes 2kg of dough. He divides it into 10 equal loaves. What is the weight of each loaf in grams?",
      "A car's petrol tank holds 50 litres. It currently contains 15 litres. How much is needed to fill it?",
      "Cinema tickets are £5.25 for adults and £3.50 for children. How much for one adult and two children?",
      "A snail crawls 35cm in one minute. How far will it crawl in 5 minutes?",
      "A box of 6 eggs weighs 300g. What is the approximate weight of one egg?",
      "A swimming pool contains 10,000 litres of water. 1,500 litres are drained. How much is left?",
      "A pack of pens costs £2.40. There are 6 pens in the pack. What is the cost per pen?",
      "The distance from my house to the park is 1.5km. How far is the round trip in metres?",
      "A watermelon weighs 2.5kg. A pineapple weighs 1.2kg. How much heavier is the watermelon?",
      "I need 1 litre of orange juice. I have one carton of 250ml and another of 400ml. How much more do I need?",
      "A café sells coffee for £2.60 and tea for £1.90. How much more does the coffee cost?",
      "A tower is 45m high. A nearby flagpole is 12.5m high. What is the difference in height?",
      "I need 1kg of potatoes. The bag I pick up weighs 1350g. How many grams do I need to remove?",
      "A bucket holds 10 litres. It has a hole and is losing 50ml every minute. How much will be left after 10 minutes?",
      "A football costs £9.50. A child has £7.80. How much more money do they need?",
      "A piece of rope is 5m long. 2m 50cm is cut off. How much is left?",
      "A bag of apples weighs 1.5kg. A bag of oranges weighs 1.2kg. What is the total weight?",
      "A recipe requires 300ml of milk. A carton holds 1 litre. How much milk is left after making the recipe?",
      "I have a £20 note. I buy a book for £8.99 and a magazine for £3.50. How much change do I get?",
      "A marathon is 26 miles long. A runner has completed 10 miles. How much further to go?",
      "A cake weighs 1.2kg. It is cut into 10 equal slices. What is the weight of one slice in grams?",
      "A bathtub holds 80 litres of water. A shower uses 35 litres. How much water is saved by having a shower?",
      "A train ticket for an adult is £12. A child's ticket is half price. What is the cost for two adults and one child?",
      "A room's perimeter is 18m. It is a rectangle with a length of 5m. What is the width?",
      "A box of cereal weighs 750g. A family eats 50g each day. How many days does the box last?",
      "A can of paint holds 2.5 litres. A wall needs 1.8 litres for one coat. Is there enough for two coats?",
      "I need £30 for a trip. I have saved £17.50. How much more do I need to save?",
      "A plank of wood is 2.4m long. It is cut into 3 equal pieces. How long is each piece in cm?",
      "A farmer has a 1 tonne bag of feed. He uses 50kg a day. How many days will it last?",
      "A bottle contains 1.5 litres of lemonade. It is shared equally among 6 children. How many ml does each child get?",
      "A film starts at 6:30 pm and lasts for 95 minutes. What time does it finish?",
      "A tree is 8m tall. It grows by 75cm in a year. How tall is it now?",
      "A bag of rice weighs 2kg. 600g is used. How much is left in the bag?",
      "A fish tank is filled with 35 litres of water. Its capacity is 50 litres. How much more water is needed to fill it?",
      "A comic costs £1.75. How much would 4 comics cost?",
      "The journey to school is 3km. How many metres is this?",
      "A recipe needs 0.5kg of flour. I have a 1kg bag. What fraction is left?",
      "A water butt holds 200 litres. After a rainstorm, it is 3/4 full. How many litres are in it?",
      "A football match lasts 90 minutes with a 15 minute half-time break. If it kicks off at 3:00 pm, what time does it end?"
    ],
    "Year 4": [
      "I buy three items costing £1.20, 75p, and £2.50. What is the total cost?",
      "A rectangular field has a perimeter of 120m. One side is 40m long. What is the length of the other side?",
      "A recipe for 4 people needs 500g of pasta. How much pasta would you need for 8 people?",
      "A swimming pool is 25m long. How many lengths do you need to swim to complete 1km?",
      "A bottle of lemonade holds 2 litres. How many 250ml glasses can be filled from it?",
      "A school trip costs £12.50 per child. How much will it cost for a class of 30 children?",
      "The perimeter of a rectangular field is 300m. If the length is 100m, what is the area of the field?",
      "A cake recipe for 6 people requires 300g of flour. How much flour is needed for 9 people?",
      "A family travels 150km. They stop for a break after 80km. What fraction of the journey is left?",
      "I bought 4 items costing 75p, £1.25, £2.10, and 90p. I paid with a £10 note. How much change did I get?",
      "A rectangular room measures 4m by 5m. Carpet costs £15 per square metre. How much will it cost to carpet the room?",
      "A runner runs 8 laps of a 400m track. How many kilometres has she run?",
      "A 2-litre bottle of squash is shared between 8 children. How many millilitres does each child get?",
      "A book has 300 pages. I have read 120 pages. What percentage of the book have I read?",
      "Three friends have lunch. The bills are £8.50, £10.20, and £7.70. They split the total cost equally. How much do they each pay?",
      "A wall measuring 6m by 3m needs two coats of paint. One litre of paint covers 9m². How many litres are needed?",
      "A car travels 10km on 1 litre of petrol. How much petrol is needed for a 250km journey?",
      "A pack of 8 biscuits weighs 200g. What is the weight of one biscuit?",
      "A film starts at 19:20 and finishes at 21:05. How long is the film?",
      "A shop has a sale with 25% off. How much would a £40 coat cost in the sale?",
      "Find the area of a garden that is 12.5m long and 8m wide.",
      "A box contains 48 chocolates. The box weighs 600g. If the box itself weighs 120g, what is the average weight of a chocolate?",
      "How many 300ml glasses can be filled from a 1.5-litre jug?",
      "A train journey costs £35. A railcard gives a 1/3 discount. What is the new price?",
      "A swimming pool is 25m long. To swim 1km, how many lengths are needed?",
      "A family needs £200 for a day out. They have £155.50. How much more do they need?",
      "A garden is a rectangle 10m long with a perimeter of 34m. What is its area?",
      "A recipe for 12 cupcakes needs 150g of sugar. How much sugar for 24 cupcakes?",
      "A car journey is 5km. How many metres is this?",
      "A 1 litre carton of juice costs £1.20. A 2 litre bottle costs £2.20. Which is better value?",
      "A school fair raises £546. The money is shared equally between 6 charities. How much does each charity receive?",
      "A room is 5m by 4m. A rug of 3m by 2m is placed on the floor. What area of floor is not covered?",
      "A cyclist travels at 15km per hour. How far do they travel in 2 hours?",
      "A pack of 6 yoghurts costs £1.80. What is the cost of one yoghurt?",
      "A flight leaves at 10:45 and is 2 hours 30 minutes long. What time does it arrive?",
      "A T-shirt costs £8.99. In a sale, it is half price. What is the sale price?",
      "A rectangular field has an area of 200m². Its length is 20m. What is its perimeter?",
      "A machine produces 120 toys per hour. How many toys does it produce in 8 hours?",
      "Convert 3.5kg to grams.",
      "A bottle of water holds 750ml. How many bottles would be needed to fill a 3-litre container?",
      "A school concert starts at 18:00 and lasts for 1 hour and 40 minutes. What time does it finish?",
      "A book costs £7.50. What is the cost of 5 books?",
      "A fence is made of panels 2m wide. How many panels for a fence 30m long?",
      "A bag of apples weighs 1.2kg. If there are 8 apples in the bag, what is the average weight of one apple?",
      "How many minutes are in 3.25 hours?",
      "A box of 12 pencils costs £2.40. A box of 8 crayons costs £1.84. Which is cheaper per item?",
      "The perimeter of a square is 36cm. What is its area?",
      "A recipe for 8 people requires 400ml of cream. How much cream is needed for 6 people?",
      "A journey is 40 miles. The car travels at 20 mph. How long does the journey take?",
      "A 2.5 litre bottle of paint is needed for a wall. The paint is sold in 1 litre tins. How many tins must be bought?"
    ],
    "Year 5": [
      "A jacket costs £45.50. In a sale, it is reduced by 20%. What is the new price?",
      "The distance from London to Paris is approximately 450km. A train travels at an average speed of 150km/h. How long will the journey take?",
      "A box of 8 apples weighs 1.2kg. What is the approximate weight of one apple in grams?",
      "A rectangular garden is 12m long and 8m wide. What is its area? If fencing costs £10 per metre, how much will it cost to fence the entire garden?",
      "A car's fuel tank has a capacity of 40 litres. If petrol costs £1.50 per litre, how much does it cost to fill the tank from empty?",
      "A car travels 300km and uses 25 litres of petrol. How many kilometres per litre does the car achieve?",
      "A garden measuring 15m by 20m needs to be seeded. One box of seed covers 50m². How many boxes are needed?",
      "A 2.5kg chicken needs to be cooked for 40 minutes per kg. How long should it be cooked for?",
      "A plank of wood is 5.2m long. A carpenter cuts it into 4 equal pieces. How long is each piece in centimetres?",
      "A taxi costs £3 plus £1.50 per mile. How much would a 6-mile journey cost?",
      "A rectangular fish tank is 80cm long, 40cm wide and 50cm high. What is its volume in litres?",
      "A recipe uses 150g sugar for every 250g of flour. If you use 750g of flour, how much sugar do you need?",
      "A runner's average speed is 12km/h. How far can they run in 2.5 hours?",
      "A phone contract costs £15 a month and includes 5GB of data. Extra data is £3 per GB. One month the bill is £24. How much extra data was used?",
      "A fence is built from panels 1.8m wide. How many panels are needed for a fence 27m long?",
      "A 5-litre container of paint is used to paint a wall with an area of 60m². How many millilitres of paint are used per square metre?",
      "A block of cheese weighing 1.2kg costs £9. What is the price per 100g?",
      "A cyclist travels 45km in 3 hours. What is their average speed in km/h?",
      "A water butt collects 5 litres of water every hour during a storm. If it has a capacity of 150 litres and was empty, how long would it take to fill?",
      "A shop sells T-shirts for £8 each or 3 for £20. How much do you save by buying 3 together?",
      "A room needs a new skirting board. The room is a rectangle 4.5m by 3.2m with a doorway 0.8m wide. What length of skirting board is needed?",
      "An empty suitcase weighs 2.8kg. After packing, it weighs 15.5kg. What is the mass of the contents?",
      "A machine fills 12 bottles of juice every minute. Each bottle holds 500ml. How many litres of juice does it bottle in an hour?",
      "A map has a scale of 1cm to 5km. A road on the map is 6.5cm long. What is the actual length of the road?",
      "You have a budget of £100 for a party. Venue hire is £45, food is £3.50 per person. What is the maximum number of people you can invite?",
      "A car is worth £8000. It loses 10% of its value in a year. What is it worth after a year?",
      "A train travels 200 miles in 2.5 hours. What is its average speed in mph?",
      "A recipe for 12 biscuits needs 200g of flour. You have 1kg of flour. How many biscuits can you make?",
      "The perimeter of a rectangular field is 240m. The length is twice the width. What are the dimensions?",
      "Petrol costs £1.45 per litre. A car's tank holds 50 litres. How much does it cost to fill the tank from empty?",
      "A cuboid has a volume of 120cm³. It is 10cm long and 4cm wide. What is its height?",
      "A recipe uses butter and sugar in the ratio 2:3. If you use 150g of sugar, how much butter do you need?",
      "An athlete runs 100m in 12.5 seconds. What is their speed in metres per second?",
      "A phone bill is £20 plus 10p per minute for calls outside the plan. If a person makes 30 minutes of extra calls, what is the bill?",
      "A fence is made of 15 panels, each 2.2m long. What is the total length of the fence?",
      "A 2 litre carton of orange juice costs £2.50. A 750ml bottle costs 90p. Which is better value per litre?",
      "A cheese costs £8.50 per kg. What is the cost of a 300g piece?",
      "A cyclist wants to travel 100km. They cycle at an average speed of 20km/h. How long will the journey take?",
      "A water tank is 80% full. Its capacity is 500 litres. How many litres are in the tank?",
      "A concert ticket costs £35. A booking fee of 5% is added. What is the total price?",
      "A composite L-shaped room needs a new carpet. The room's dimensions are given. Calculate the area of carpet needed.",
      "A parcel weighs 3.45kg. Postage costs £5 for the first kg and £1.50 for each additional kg. What is the postage cost?",
      "A machine prints 150 pages in 5 minutes. How many pages does it print per minute?",
      "A map scale is 1:50,000. The distance on the map is 4cm. What is the real distance in km?",
      "A budget for a project is £5000. 45% is spent on materials. How much money is left for labour?",
      "A car's value decreases by 15% from £12,000. What is its new value?",
      "An object travels at 60 mph. How many miles does it travel in 20 minutes?",
      "A bag contains red and blue sweets in the ratio 3:4. If there are 12 blue sweets, how many red sweets are there?",
      "The perimeter of an isosceles triangle is 30cm. The two equal sides are 12cm long. What is the length of the base?",
      "A builder mixes 1 part cement with 4 parts sand. If he has 20kg of sand, how much cement does he need?"
    ],
    "Year 6": [
      "A tin of beans weighs 450g. The tins are sold in packs of 4. What is the weight of 3 packs in kilograms?",
      "A room is 5m long, 4m wide, and 2.5m high. What is its volume?",
      "A recipe for a fruit smoothie requires 250ml of orange juice, 150ml of mango juice, and 100ml of pineapple juice. If you want to make 2 litres of the smoothie for a party, how much orange juice will you need?",
      "A map has a scale of 1:50,000. The distance between two towns on the map is 10cm. What is the actual distance in kilometres?",
      "A jug of squash is made by mixing 1 part concentrate to 4 parts water. If you use 300ml of concentrate, how much squash will you have in total, in litres?",
      "A car is travelling at 70 mph. How far will it travel in 2 hours and 30 minutes?",
      "The area of a triangular garden is 50m². Its base is 20m. What is its height?",
      "A currency exchange rate is £1 = €1.15. How many euros would you get for £250?",
      "A recipe for 12 cakes needs 200g flour, 150g sugar and 100g butter. How much of each ingredient is needed for 18 cakes?",
      "A 10kg bag of potatoes costs £4.50. A 2.5kg bag costs £1.20. Which is better value per kg?",
      "The volume of a cuboid is 240cm³. Its length is 10cm and its height is 8cm. What is its width?",
      "A map scale is 1:50,000. The distance between two towns on the map is 7cm. What is the actual distance in kilometres?",
      "A mobile phone costs £600, or a payment plan of £50 deposit plus 12 monthly payments of £50. How much more expensive is the payment plan?",
      "A train leaves at 09:45 and arrives at 12:15. It travels 150 miles. What is its average speed in miles per hour?",
      "A company makes a profit of £2.5 million. It has 50 employees and wants to give 10% of the profit as a bonus, shared equally. How much does each employee get?",
      "A parallelogram has an area of 48cm² and a base of 12cm. What is its perpendicular height?",
      "A builder mixes cement, sand and gravel in the ratio 1:2:4. If he uses 15kg of cement, how much sand and gravel does he need?",
      "A water tank in the shape of a cuboid is 2m x 1.5m x 1m. It is 75% full. How many litres of water are in the tank?",
      "A plane flies 800km in 1 hour 15 minutes. What is its average speed in km/h?",
      "Interest on savings is 2% per year. If you have £500 in a savings account, how much interest will you earn in one year?",
      "A cube has a volume of 64cm³. What is the area of one of its faces?",
      "Three builders can build a wall in 10 days. Assuming they work at the same rate, how long would it take 5 builders?",
      "The diameter of a circle is 10cm. What is its circumference?",
      "A recipe is in imperial units, asking for 2lbs of flour. Your scales are metric. How many grams do you need?",
      "A car depreciates in value by 20% in its first year. If it cost £15,000 new, what is its value after one year?",
      "A £80 coat is in a sale with 25% off. What is the sale price?",
      "The ratio of boys to girls in a school is 4:5. If there are 200 boys, how many girls are there?",
      "A car travels 30 miles on 1 gallon of petrol. Petrol costs £6.50 per gallon. How much does a 150-mile journey cost?",
      "The area of a circle is approximately 78.5cm². What is its radius? (A = πr²)",
      "A recipe for 6 people needs 300g of pasta. How much pasta is needed for 10 people?",
      "A cuboid has a volume of 0.5m³. How many litres is this?",
      "A map has a scale of 1 inch to 5 miles. The distance on the map is 3.5 inches. What is the real distance?",
      "A bank offers 1.5% annual interest. If you save £2000 for a year, how much interest do you earn?",
      "Two numbers are in the ratio 3:7. Their sum is 50. What are the numbers?",
      "The circumference of a wheel is 80cm. How many full rotations does it make over a distance of 1km?",
      "A shop buys a TV for £400 and sells it for a 30% profit. What is the selling price?",
      "The angles in a triangle are in the ratio 1:2:3. What are the sizes of the angles?",
      "A car is travelling at 30 metres per second. What is this speed in km/h?",
      "The volume of a cube is 216cm³. What is the length of one of its sides?",
      "An item costs £50 plus 20% VAT. What is the total price?",
      "The exchange rate is $1.25 to £1. How many pounds is $200?",
      "The area of a parallelogram is 60cm². Its base is 1.5 times its height. Find the base and height.",
      "A group of 5 people can paint a fence in 4 hours. How long would it take 2 people?",
      "The diameter of the Earth is approximately 12,742 km. What is its circumference?",
      "A company's shares are worth £2.50 each. They increase in value by 8%. What is the new price?",
      "In a survey of 120 people, the ratio of people who prefer tea to coffee is 3:2. How many people prefer tea?",
      "A car travels 210 miles in 3 hours and 30 minutes. What was its average speed?",
      "A cylinder has a volume of 314cm³. Its height is 10cm. What is the radius of its base? (V=πr²h)",
      "An investment of £1000 increases by 10% in the first year, and then the new amount increases by 10% in the second year. What is the final value?",
      "The scale on a model boat is 1:50. The model is 40cm long. What is the real length of the boat in metres?"
    ]
  }
}

```
--- END FILE: context\example_questions.json ---

--- START FILE: context\factory_blueprint_prompt.md ---
```markdown
You are an expert curriculum designer and senior software architect specializing in educational technology. You have a deep understanding of the UK National Curriculum for Mathematics and extensive experience designing logic for programmatic, abstract content generation.

**My Objective:**

I am building a TypeScript-based question generator. I need a comprehensive architectural blueprint for the **"Math Engine"** component. The core architectural principle is the strict **separation of mathematical logic from narrative context**.

**The Architectural Vision:**

*   The **Math Engine** must be a collection of pure, abstract, and **atomic mathematical models**. These models operate only on numbers and logical parameters. They are completely unaware of "money," "kilograms," or any other real-world context.
*   The **Story Engine** (a separate component) will consume the output from the Math Engine and apply contextual variables (like `currency_symbol`, `item_noun`, etc.) to create a final, human-readable word problem.
*   The difficulty of questions must be incrementally adjustable by manipulating the numerical parameters of each model.

**Your Mission:**

Your mission is to analyze the provided curriculum data and example questions to define a set of these atomic **Mathematical Models**. Your blueprint must be so clear and well-defined that a developer could implement it directly with minimal ambiguity.

**Core Instructions:**

For each abstract **Mathematical Model** you identify, you must provide the following:

1.  **`model_id`**: A unique, machine-friendly identifier (e.g., `ADDITION`, `SUBTRACTION`, `LINEAR_EQUATION`).
2.  **`core_mathematical_operation`**: A concise description of the pure mathematical skill the model represents (e.g., "Summing an array of numbers," "Evaluating a `y = mx + c` function").
3.  **`difficulty_parameters`**: The specific, named **numerical and logical variables** that the Math Engine would use to control the difficulty. This is the most critical part.
4.  **`progression_logic`**: A clear, tiered explanation of how to manipulate the `difficulty_parameters` to scale complexity from Year 1 to Year 6.
5.  **`json_output_contract`**: A clear example of the JSON data structure that this model should output. This serves as a "contract" for the Story Engine, showing the model's solution and key calculated values.
6.  **`required_context_variables`**: A list of the placeholder variables the Story Engine would need to provide to wrap the pure math in a story.
7.  **`example_mapping`**: Deconstruct one of the provided example questions, showing the `difficulty_parameters` passed to the Math Engine and the `context_variables` used by the Story Engine.

**Architectural Constraints (Please follow these strictly):**

*   **Atomicity is Key:** Each of the four basic arithmetic operations (`ADDITION`, `SUBTRACTION`, `MULTIPLICATION`, `DIVISION`) must be its own separate, atomic model. Do not bundle them into one "basic arithmetic" group.
*   **Create a `MULTI_STEP` Model:** Define a specific model for sequencing the atomic models. Its parameters should include a sequence of operations to perform (e.g., `[{model: 'MULTIPLICATION', params: {...}}, {model: 'SUBTRACTION', params: {...}}]`).
*   **Include `LINEAR_EQUATION`:** Ensure you define a distinct model for linear equations (`y = mx + c`), as seen in problems like taxi fares.
*   **Exclude Pre-Math Operations:** Do not create models for simple `VALUE_RECOGNITION` or `COMPARISON`. These can be considered utility functions within the Story Engine or other models. The focus must be on models that perform a **calculation**.

**Input Data:**

Here is the relevant curriculum information and the example questions you must use for your analysis.

**--- START OF RELEVANT CURRICULUM DATA (MEASUREMENT STRAND) ---**

```json
[
  {
    "Strand": "Measurement",
    "Substrand": "money",
    "Years": {
      "Year 1": "recognise and know the value of different denominations of coins and notes",
      "Year 2": "recognise and use symbols for pounds (£) and pence (p); combine amounts to make a particular value; find different combinations of coins that equal the same amounts of money",
      "Year 3": "Key stage 1 content domain"
    }
  },
  {
    "Strand": "Measurement",
    "Substrand": "solve problems (a, money; b, length; c, mass / weight; d, capacity / volume)",
    "Years": {
      "Year 2": "solve simple problems in a practical context involving addition and subtraction of money of the same unit, including giving change",
      "Year 3": "add and subtract amounts of money to give change, using both pounds (£) and pence (p) in practical contexts",
      "Year 4": "calculate different measures, including money in pounds and pence",
      "Year 5": "use all four operations to solve problems involving measures [money] using decimal notation, including scaling",
      "Year 6": "solve problems involving the calculation and conversion of units of measure, using decimal notation up to three decimal places where appropriate"
    }
  }
]
```

**--- END OF CURRICULUM DATA ---**

**--- START OF EXAMPLE MONEY QUESTIONS (Years 1-6) ---**

```
  "money": {
    "Year 1": [
      "What is the value of a 10p coin?",
      "Which is worth more, a 2p coin or a 5p coin?",
      "Can you name all the UK coins?",
      "If you have a 1p, 2p, and 5p coin, how much money do you have altogether?",
      "I have a coin that is silver and has seven sides. What coin is it?",
      "How many 1p coins do you need to make 5p?",
      "Can you find a coin that is brown? What is its value?",
      "I have two 10p coins. How much money do I have?",
      "Which note has the lowest value? (£5, £10, £20).",
      "Is a 50p coin worth more or less than a £1 coin?",
      "If I have three 2p coins, how much do I have?",
      "Name a coin that is gold and silver.",
      "What is the colour of a £10 note?",
      "How many 5p coins are worth the same as a 20p coin?",
      "I have a £2 coin and a £1 coin. How much money do I have?",
      "Find two coins that add up to 3p.",
      "What coin has 12 sides?",
      "How many 1p coins are in a £1 coin?",
      "If I have a 20p coin and a 5p coin, do I have more or less than 22p?",
      "Can you show me 8p using exactly three coins?",
      "Name all the silver coins.",
      "What is the value of a £20 note?",
      "If I have two 50p coins, how much money do I have?",
      "Find three coins that add up to 16p.",
      "Which is worth more: four 1p coins or one 5p coin?",
      "What coin is small, silver and round?",
      "How many 1p coins make 10p?",
      "If you have a 5p coin and a 2p coin, how much do you have?",
      "Which is worth less: a £5 note or a £10 note?",
      "Can you find two coins that have the same value?",
      "What is the biggest coin in size?",
      "I have a 10p coin and a 5p coin. How much money is that?",
      "Name a bank note that is orange.",
      "How many 2p coins make 10p?",
      "What is the total value of a 50p coin and a 10p coin?",
      "Find a coin that is worth 100 pennies.",
      "If I have four 1p coins, how much do I have?",
      "Which is worth more: a 50p coin or three 10p coins?",
      "What is the value of the coin with two colours?",
      "How many 5p coins make 15p?",
      "I have a 20p coin and a 2p coin. How much is that?",
      "Which coin is worth the most?",
      "Which bank note is worth the least?",
      "If I have a £1 coin and a 10p coin, do I have more than 105p?",
      "Show me 6p using the smallest number of coins.",
      "How much is a 1p, a 2p and another 1p coin altogether?",
      "What is the shape of a 20p coin?",
      "How many 10p coins are equal to a 50p coin?",
      "Can you add a 50p coin and a £1 coin?",
      "Which is worth less: a 2p coin or a 1p coin?"
    ],
    "Year 2": [
      "How many 10p coins make £1?",
      "If you buy a comic for 60p and pay with a £1 coin, how much change will you get?",
      "Sophie buys a cake for 35p and a drink for 25p. How much does she spend altogether?",
      "Write down two different ways to make 20p using coins.",
      "What do the symbols £ and p stand for?",
      "A pen costs 45p. Which coins could you use to pay for it exactly?",
      "You have £1 and spend 70p. How much change do you get?",
      "How much is two £5 notes and three £1 coins?",
      "Find the total of £2, 50p, and 5p.",
      "Show three ways to make 50p.",
      "If you save 10p every day for a week, how much will you have?",
      "An ice cream costs 85p. You pay with a £1 coin. What is your change?",
      "Which costs more, a comic for £1.50 or a book for £1.25?",
      "How many 20p coins do you need to make £2?",
      "Sarah has £5. She buys a magazine for £2.50. How much is left?",
      "Add these amounts: £3 and 40p + £1 and 20p.",
      "What is the difference between £10 and £6.50?",
      "A bus ticket is 90p. How much for two tickets?",
      "Can you buy a toy for £3.75 if you have a £5 note?",
      "I have three 50p coins and two 20p coins. How much money is that?",
      "How much more do I need to make £1 if I have 65p?",
      "A rubber costs 15p. A ruler costs 25p. How much for both?",
      "Find the value of one £10 note, one £5 note, and three £2 coins.",
      "If I share £2 equally between two people, how much do they get each?",
      "I buy a drink for 65p and crisps for 55p. How much have I spent?",
      "Tom has a 50p coin and three 10p coins. How much money does he have?",
      "A banana costs 30p. An apple costs 25p. How much for one of each?",
      "How can you make 75p using exactly three coins?",
      "I have £1 and buy a chocolate bar for 55p. What change will I receive?",
      "How many 5p coins are in 50p?",
      "Lily has two 20p coins and one 5p coin. Does she have enough to buy a comic for 40p?",
      "Find the total of a £1 coin, a 50p coin, and a 5p coin.",
      "Show £1.50 using the smallest number of coins.",
      "If I have three 20p coins, how much more do I need to make £1?",
      "A toy car costs £1.20. A toy boat costs £1.50. What is the difference in price?",
      "How many £2 coins are there in £10?",
      "Sam wants to buy a book for £5. He has saved £3.50. How much more does he need?",
      "Add together 45p and 35p.",
      "Can you make 37p using UK coins?",
      "I pay for a 70p item with a £2 coin. How much change do I get?",
      "What is the total of a £5 note and a £10 note?",
      "A pack of stickers costs 80p. How much would 2 packs cost?",
      "How would you write one pound and five pence using the £ symbol?",
      "If I have two 50p coins and I spend 80p, how much do I have left?",
      "Find three coins that total 26p.",
      "How many 50p coins make £3.00?",
      "Which is more money: four 20p coins or three 50p coins?",
      "A cup of juice is 40p. A biscuit is 15p. How much for both?",
      "What is double £1.25?",
      "Show how to make £2.35 using four coins."
    ],
    "Year 3": [
      "A computer game costs £15. You have saved £8.50. How much more do you need?",
      "Calculate the change from £10 for items costing £3.40 and £2.80.",
      "Three friends share the cost of a pizza that is £9.60. How much do they each pay?",
      "A cinema ticket costs £4.75. How much would it cost for a family of four?",
      "Find the total cost of a book at £6.99 and a pen at £1.25.",
      "How much is five £2 coins, three 50p coins, and seven 5p coins?",
      "I bought two items for £5.60. One cost £2.90. What did the other one cost?",
      "A weekly bus pass costs £12.50. How much would four weeks cost?",
      "A sandwich costs £2.80, a drink 95p, and a cake £1.50. What is the total?",
      "If I have a £20 note, can I buy three books that cost £6 each? What change will I get?",
      "Find half of £7.50.",
      "I have a mixture of 8 coins in my pocket worth 97p. What could they be?",
      "What is the difference in price between a £12.99 toy and a £17.50 toy?",
      "A school trip costs £14 per child. How much for 10 children?",
      "Find 1/4 of £20.",
      "I bought 5 pens for 40p each. How much did I spend in total?",
      "A meal costs £23.70. How much change is there from a £50 note?",
      "If I save £3 a week, how long will it take to save for a bike that costs £36?",
      "A DVD costs £8.99. A Blu-ray costs £11.49. How much more is the Blu-ray?",
      "Add up these amounts: £10.60, £5.80 and £3.20.",
      "A t-shirt costs £5.50 and a pair of shorts costs £4.75. How much do they cost altogether?",
      "A pack of pens costs £2.40. There are 6 pens in the pack. What is the cost per pen?",
      "A café sells coffee for £2.60 and tea for £1.90. How much more does the coffee cost?",
      "If I pay for a £2.80 magazine with a £5 note, how much change will I get?",
      "I buy a book for £4.80 and pay with a £10 note. What is my change?",
      "A football costs £8.25. A pump costs £3.99. What is the total cost?",
      "How much change would you get from a £10 note if you spent £6.35?",
      "If 4 children share £10 equally, how much does each child get?",
      "A swimming lesson costs £6.50. How much would 5 lessons cost?",
      "Find the sum of £12.45 and £7.80.",
      "I have £15. I buy a DVD for £8.99. How much money is left?",
      "A train ticket costs £22.50. How much would it cost for 3 people?",
      "Convert 350p into pounds and pence.",
      "A family meal costs £34.60. They pay with two £20 notes. What is their change?",
      "What is £10 minus £4.72?",
      "If I save £1.50 each week, how much will I save in 6 weeks?",
      "A jacket costs £25. It is in a sale with £5.50 off. What is the new price?",
      "Find the cost of 10 stamps if one stamp costs 65p.",
      "Add £3.45, £2.99 and £1.50 together.",
      "A book costs £7.49. How much change from £20?",
      "If a pack of 8 batteries costs £4.80, what does one battery cost?",
      "Subtract £2.80 from £5.00.",
      "A monthly magazine subscription is £4.25. What is the cost for a whole year?",
      "What is one third of £9.30?",
      "A comic is £1.25 and a magazine is £2.10. How much more is the magazine?",
      "How many 50p coins do you need to make £5.50?",
      "If you spend £1.75 and £2.50, what is the total spend?",
      "A toy car costs £3.75. How much would 3 cost?",
      "What is the difference between £20 and £11.65?",
      "If I have £8.40 and I divide it among 4 people, how much does each get?"
    ]
  },
```

**--- END OF EXAMPLE QUESTIONS ---**

**Required Output:**

Please present your findings as a clear, well-structured report. Use headings and subheadings for each **Mathematical Model**. The final blueprint should be a practical and robust guide for a TypeScript developer, free of redundancy and focused on creating a scalable and efficient Math Engine.
```
--- END FILE: context\factory_blueprint_prompt.md ---

--- START FILE: context\factory_blueprint_response.md ---
```markdown



### 2. The A+ Blueprint Response You Received

This is the final, developer-ready blueprint.

```text
# Math Engine Architecture Blueprint
## TypeScript-Based Question Generator for UK National Curriculum Mathematics

---

## Executive Summary

This blueprint defines a collection of **atomic mathematical models** that form the core of the Math Engine. Each model operates purely on numerical and logical parameters, with zero awareness of real-world context. The Story Engine will consume the mathematical outputs and apply contextual narratives.

---

## Core Mathematical Models

### 1. ADDITION Model

#### `model_id`: `ADDITION`

#### `core_mathematical_operation`
Summing an array of numerical values to produce a total.

#### `difficulty_parameters`
```typescript
{
  operand_count: number;        // Number of values to sum (2-10)
  max_value: number;            // Maximum value for any operand
  decimal_places: number;       // Number of decimal places (0-3)
  allow_carrying: boolean;      // Whether carrying is required
  value_constraints: {
    min: number;               // Minimum value for operands
    step: number;              // Step size for values (e.g., 0.01 for pence)
  }
}
```

#### `progression_logic`
- **Year 1-2**: `operand_count: 2-3`, `max_value: 20`, `decimal_places: 0`, `allow_carrying: false`
- **Year 3-4**: `operand_count: 2-4`, `max_value: 100`, `decimal_places: 2`, `allow_carrying: true`
- **Year 5-6**: `operand_count: 2-6`, `max_value: 1000`, `decimal_places: 2-3`, `allow_carrying: true`

#### `json_output_contract`
```json
{
  "operation": "ADDITION",
  "operands":,
  "result": 60,
  "intermediate_steps": [],
  "decimal_formatted": {
    "operands": ["0.35", "0.25"],
    "result": "0.60"
  }
}
```

#### `required_context_variables`
```typescript
{
  unit_type: string;           // "currency", "measurement", "count"
  unit_symbol: string;         // "£", "kg", ""
  item_descriptors: string[];  // ["cake", "drink"]
  action_verb: string;         // "buys", "collects", "earns"
}
```

---

### 2. SUBTRACTION Model

#### `model_id`: `SUBTRACTION`

#### `core_mathematical_operation`
Finding the difference between two numerical values.

#### `difficulty_parameters`
```typescript
{
  minuend_max: number;         // Maximum value for the minuend
  subtrahend_max: number;      // Maximum value for the subtrahend
  decimal_places: number;      // Number of decimal places (0-3)
  allow_borrowing: boolean;    // Whether borrowing is required
  ensure_positive: boolean;    // Ensures result is non-negative
  value_constraints: {
    step: number;             // Step size for values
  }
}
```

#### `progression_logic`
- **Year 1-2**: `minuend_max: 20`, `subtrahend_max: 10`, `decimal_places: 0`, `allow_borrowing: false`
- **Year 3-4**: `minuend_max: 100`, `subtrahend_max: 100`, `decimal_places: 2`, `allow_borrowing: true`
- **Year 5-6**: `minuend_max: 1000`, `subtrahend_max: 1000`, `decimal_places: 3`, `allow_borrowing: true`

#### `json_output_contract`
```json
{
  "operation": "SUBTRACTION",
  "minuend": 100,
  "subtrahend": 60,
  "result": 40,
  "decimal_formatted": {
    "minuend": "1.00",
    "subtrahend": "0.60",
    "result": "0.40"
  }
}
```

#### `required_context_variables`
```typescript
{
  scenario_type: string;       // "change", "difference", "remaining"
  initial_context: string;     // "pays with", "has saved", "original price"
  removal_context: string;     // "costs", "spent", "reduced by"
}
```
---

### 3. MULTIPLICATION Model

#### `model_id`: `MULTIPLICATION`

#### `core_mathematical_operation`
Computing the product of two or more numerical values.

#### `difficulty_parameters`
```typescript
{
  multiplicand_max: number;    // Maximum value for multiplicand
  multiplier_max: number;      // Maximum value for multiplier
  decimal_places: number;      // Decimal places in operands (0-3)
  operand_count: number;       // Number of values to multiply (2-4)
  use_fractions: boolean;      // Allow fractional multipliers
}
```

#### `progression_logic`
- **Year 1-2**: `multiplicand_max: 10`, `multiplier_max: 5`, `decimal_places: 0`
- **Year 3-4**: `multiplicand_max: 100`, `multiplier_max: 10`, `decimal_places: 2`
- **Year 5-6**: `multiplicand_max: 1000`, `multiplier_max: 100`, `decimal_places: 3`

#### `json_output_contract`
```json
{
  "operation": "MULTIPLICATION",
  "multiplicand": 4.75,
  "multiplier": 4,
  "result": 19.00,
  "factors": [4.75, 4],
  "decimal_formatted": {
    "result": "19.00"
  }
}
```

#### `required_context_variables`
```typescript
{
  quantity_type: string;       // "groups", "items_per_unit", "rate"
  unit_descriptor: string;     // "tickets", "family members", "pens per pack"
}
```
---

### 4. DIVISION Model

#### `model_id`: `DIVISION`

#### `core_mathematical_operation`
Dividing a dividend by a divisor to find quotient and optionally remainder.

#### `difficulty_parameters`
```typescript
{
  dividend_max: number;        // Maximum value for dividend
  divisor_max: number;         // Maximum value for divisor
  decimal_places: number;      // Decimal places in result (0-3)
  allow_remainder: boolean;    // Whether to include remainders
  ensure_whole: boolean;       // Ensure result is whole number
}
```

#### `progression_logic`
- **Year 1-2**: `dividend_max: 20`, `divisor_max: 5`, `ensure_whole: true`
- **Year 3-4**: `dividend_max: 100`, `divisor_max: 10`, `decimal_places: 2`
- **Year 5-6**: `dividend_max: 1000`, `divisor_max: 100`, `decimal_places: 3`

#### `json_output_contract`
```json
{
  "operation": "DIVISION",
  "dividend": 9.60,
  "divisor": 3,
  "quotient": 3.20,
  "remainder": 0,
  "decimal_formatted": {
    "quotient": "3.20"
  }
}
```

#### `required_context_variables`
```typescript
{
  division_type: string;       // "sharing", "grouping", "rate"
  share_context: string;       // "equally between", "per unit", "each gets"
}
```
---

### 5. MULTI_STEP Model

#### `model_id`: `MULTI_STEP`

#### `core_mathematical_operation`
Executing a sequence of mathematical operations in a specified order.

#### `difficulty_parameters`
```typescript
{
  operation_sequence: Array<{
    model: string;             // "ADDITION", "SUBTRACTION", etc.
    params: object;            // Parameters for the specific model
    use_previous_result: boolean; // Use result from previous step
  }>;
  max_steps: number;           // Maximum number of operations (2-5)
  intermediate_visibility: boolean; // Show intermediate results
}
```

#### `progression_logic`
- **Year 1-2**: `max_steps: 2`, simple addition/subtraction chains
- **Year 3-4**: `max_steps: 3`, mixed operations including multiplication
- **Year 5-6**: `max_steps: 5`, complex chains with all operations

#### `json_output_contract`
```json
{
  "operation": "MULTI_STEP",
  "steps": [
    {
      "step": 1,
      "operation": "MULTIPLICATION",
      "inputs":,
      "result": 18
    },
    {
      "step": 2,
      "operation": "SUBTRACTION",
      "inputs":,
      "result": 2
    }
  ],
  "final_result": 2,
  "intermediate_results":
}
```

#### `required_context_variables`
```typescript
{
  scenario_sequence: string[]; // ["buying books", "calculating change"]
  connecting_phrases: string[]; // ["then", "after that", "finally"]
}
```
---

### 6. LINEAR_EQUATION Model

#### `model_id`: `LINEAR_EQUATION`

#### `core_mathematical_operation`
Evaluating a linear function of the form `y = mx + c` for a given input value.

#### `difficulty_parameters`
```typescript
{
  slope_max: number;           // Maximum value for slope (m)
  intercept_max: number;       // Maximum value for y-intercept (c)
  input_max: number;           // Maximum input value (x)
  decimal_places: number;      // Decimal places in coefficients
  allow_negative_slope: boolean; // Allow negative slopes
}
```

#### `progression_logic`
- **Year 3-4**: Simple patterns with whole number slopes
- **Year 5-6**: Decimal slopes and intercepts, real-world applications

#### `json_output_contract`
```json
{
  "operation": "LINEAR_EQUATION",
  "equation": {
    "slope": 1.50,
    "intercept": 3.00,
    "formatted": "y = 1.50x + 3.00"
  },
  "input": 6,
  "output": 12.00,
  "calculation_steps": {
    "mx": 9.00,
    "mx_plus_c": 12.00
  }
}
```

#### `required_context_variables`
```typescript
{
  rate_context: string;        // "per mile", "per hour", "per item"
  fixed_context: string;       // "base fee", "starting amount"
  variable_context: string;    // "distance", "time", "quantity"
}
```
---

### 7. PERCENTAGE Model

#### `model_id`: `PERCENTAGE`

#### `core_mathematical_operation`
Calculating percentages of values, percentage increases/decreases, or finding percentage relationships.

#### `difficulty_parameters`
```typescript
{
  base_value_max: number;      // Maximum base value
  percentage_values: number[]; // Allowed percentage values [10, 20, 25, 50, etc.]
  operation_type: string;      // "of", "increase", "decrease", "reverse"
  decimal_places: number;      // Decimal places in result
}
```

#### `progression_logic`
- **Year 4**: Simple percentages (10%, 50%, 100%)
- **Year 5**: Common percentages (25%, 75%), finding percentages
- **Year 6**: Any percentage, increases/decreases, reverse calculations

#### `json_output_contract`
```json
{
  "operation": "PERCENTAGE",
  "operation_type": "decrease",
  "base_value": 45.50,
  "percentage": 20,
  "percentage_amount": 9.10,
  "result": 36.40
}
```

#### `required_context_variables`
```typescript
{
  percentage_context: string;  // "discount", "interest", "tax", "increase"
  value_descriptor: string;    // "original price", "savings", "population"
}
```
---

### 8. UNIT_RATE Model

#### `model_id`: `UNIT_RATE`

#### `core_mathematical_operation`
Calculating and comparing rates to determine unit costs or best value.

#### `difficulty_parameters`
```typescript
{
  total_value_max: number;     // Maximum total value
  quantity_max: number;        // Maximum quantity
  decimal_places: number;      // Decimal places
  comparison_count: number;    // Number of rates to compare (1-4)
}
```

#### `progression_logic`
- **Year 3-4**: Simple unit rates with whole numbers
- **Year 5-6**: Complex comparisons with decimals

#### `json_output_contract`
```json
{
  "operation": "UNIT_RATE",
  "calculations": [
    {
      "total": 2.40,
      "quantity": 6,
      "unit_rate": 0.40
    }
  ],
  "best_value_index": 0
}
```

#### `required_context_variables`
```typescript
{
  quantity_unit: string;       // "pens", "litres", "kilometres"
  value_unit: string;          // "pounds", "pence"
  comparison_phrase: string;   // "better value", "cheaper option"
}
```
```
--- END FILE: context\factory_blueprint_response.md ---

--- START FILE: context\implementation_next_steps.md ---
```markdown
### 3. Recommended Next Steps for Implementation

This blueprint is your architectural guide. Here’s a step-by-step plan to turn it into a working application:

#### **Phase 1: Project Setup and Type Definition**

1.  **Create a New TypeScript Project:** Set up your project environment (`npm init`, `tsc --init`, etc.).
2.  **Define the Core Interfaces:** In a dedicated file (e.g., `types.ts`), define the TypeScript interfaces for your models. This is your "single source of truth" for data structures. Use the `difficulty_parameters` and `json_output_contract` sections from the blueprint as your guide.
    ```typescript
    // In types.ts
    export interface AdditionDifficultyParams {
      operand_count: number;
      max_value: number;
      // ...etc.
    }

    export interface AdditionOutput {
      operation: "ADDITION";
      operands: number[];
      result: number;
      // ...etc.
    }
    ```
3.  **Define a Generic Model Interface:** Create a generic interface that all your models will adhere to. This ensures consistency.
    ```typescript
    // In types.ts
    export interface IMathModel<TParams, TOutput> {
      model_id: string;
      generate(params: TParams): TOutput;
    }
    ```

#### **Phase 2: Build the Math Engine**

1.  **Implement Atomic Models First:** Create a separate file for each of the core atomic models (e.g., `addition.model.ts`, `subtraction.model.ts`). Implement each as a class that adheres to the `IMathModel` interface.
    ```typescript
    // In addition.model.ts
    import { IMathModel, AdditionDifficultyParams, AdditionOutput } from './types';

    export class AdditionModel implements IMathModel<AdditionDifficultyParams, AdditionOutput> {
      public readonly model_id = "ADDITION";

      public generate(params: AdditionDifficultyParams): AdditionOutput {
        // 1. Generate random operands based on difficulty params (max_value, etc.)
        // 2. Perform the addition calculation.
        // 3. Format the numbers into the JSON output contract.
        // 4. Return the structured output.
      }
    }
    ```
2.  **Focus on the `generate` Method:** The core logic lives here. This method will take the difficulty parameters, generate random numbers that fit those constraints, perform the calculation, and return the result in the specified JSON format.
3.  **Unit Test Each Model:** As you build each model, write unit tests for it. Test that it produces the correct output and handles edge cases (e.g., division by zero). This is critical for ensuring your Math Engine is reliable.

#### **Phase 3: Build the Difficulty and Story Engines**

1.  **Create a `DifficultyPreset` Module:** This module will contain the `progression_logic`. It can be a simple function or class that returns the correct `difficulty_parameters` for a given model and year group.
    ```typescript
    // In difficulty.ts
    export function getDifficultyParams(model_id: string, year: number): object {
      if (model_id === "ADDITION" && year <= 2) {
        return { operand_count: 2, max_value: 20, decimal_places: 0, ... };
      }
      // ... more rules
    }
    ```
2.  **Create a `StoryEngine` Module:** This module's job is to "render" the question. It will take the JSON output from a Math Engine model and a set of context variables.
3.  **Develop Context Libraries:** Create libraries of context variables. You can have separate files for different themes (e.g., `money_context.ts`, `length_context.ts`).
    ```typescript
    // In money_context.ts
    export const shoppingContext = {
      unit_type: "currency",
      unit_symbol: "£",
      item_descriptors: ["book", "pen", "comic", "magazine"],
      action_verb: "buys"
    };
    ```
4.  **Create Question Templates:** The Story Engine will use template literals or a templating library to combine the math output and the context variables into a final question string.
    ```typescript
    // In story.engine.ts
    function renderAdditionQuestion(mathOutput: AdditionOutput, context: any): string {
      return `If ${context.person} ${context.action_verb} a ${context.item_descriptors[0]} for ${mathOutput.decimal_formatted.operands[0]} and a ${context.item_descriptors[1]} for ${mathOutput.decimal_formatted.operands[1]}, how much is that?`;
    }
    ```

#### **Phase 4: Orchestration and Generation**

1.  **Create a Main Generator Service:** This service will be the top-level orchestrator. It will be responsible for the end-to-end process:
    *   Take a request (e.g., "Generate 100 Year 4 Money Addition questions").
    *   Call the `DifficultyPreset` module to get the correct parameters.
    *   Call the appropriate Math Engine model with those parameters to get the structured math output.
    *   Select a relevant context from your context library.
    *   Pass the math output and context to the Story Engine to render the final question.
    *   Save the question, its answer, and any metadata (like the `model_id` and year level) to your database.
2.  **Generate Your Question Lists:** Run this generator service in a script to pre-curate the large lists of questions you need for your application.

---

## **Next.js TypeScript Tailwind Project Setup**

### **Phase 5: Project Structure and Setup**

1.  **Initialize Next.js Project with TypeScript:**
    ```bash
    npx create-next-app@latest factory-architect --typescript --tailwind --eslint --app
    cd factory-architect
    ```

2.  **Project Structure:**
    ```
    factory-architect/
    ├── src/
    │   ├── app/
    │   │   ├── api/
    │   │   │   ├── generate/
    │   │   │   │   └── route.ts          # API endpoint for question generation
    │   │   │   ├── test/
    │   │   │   │   └── route.ts          # API endpoint for testing models
    │   │   │   └── models/
    │   │   │       └── route.ts          # API endpoint for model info
    │   │   ├── test/
    │   │   │   └── page.tsx              # Web UI for testing
    │   │   ├── layout.tsx
    │   │   └── page.tsx                  # Main dashboard
    │   ├── components/
    │   │   ├── ui/                       # Reusable UI components
    │   │   ├── TestInterface.tsx         # Main testing interface
    │   │   ├── ModelSelector.tsx         # Model selection component
    │   │   ├── ParameterControls.tsx     # Difficulty parameter controls
    │   │   └── QuestionDisplay.tsx       # Generated question display
    │   ├── lib/
    │   │   ├── math-engine/
    │   │   │   ├── models/
    │   │   │   │   ├── addition.model.ts
    │   │   │   │   ├── subtraction.model.ts
    │   │   │   │   ├── multiplication.model.ts
    │   │   │   │   ├── division.model.ts
    │   │   │   │   └── linear-equation.model.ts
    │   │   │   ├── difficulty.ts         # Difficulty presets
    │   │   │   └── index.ts             # Math engine exports
    │   │   ├── story-engine/
    │   │   │   ├── contexts/
    │   │   │   │   ├── money.context.ts
    │   │   │   │   ├── length.context.ts
    │   │   │   │   └── weight.context.ts
    │   │   │   ├── templates/
    │   │   │   │   └── question.templates.ts
    │   │   │   └── story.engine.ts
    │   │   ├── types.ts                  # TypeScript interfaces
    │   │   └── utils.ts                  # Utility functions
    │   └── styles/
    │       └── globals.css
    ├── package.json
    ├── tailwind.config.js
    ├── tsconfig.json
    └── README.md
    ```

3.  **Additional Dependencies:**
    ```bash
    npm install @radix-ui/react-select @radix-ui/react-slider @radix-ui/react-tabs
    npm install lucide-react class-variance-authority clsx tailwind-merge
    npm install @types/node
    ```

### **Phase 6: Web UI for Testing Model Question Generation**

#### **6.1 Testing Interface Components**

1.  **Main Test Page (`src/app/test/page.tsx`):**
    - Interactive dashboard for testing all math models
    - Real-time parameter adjustment
    - Instant question generation and preview
    - Export functionality for generated questions

2.  **Model Selector Component:**
    ```typescript
    interface ModelSelectorProps {
      selectedModel: string;
      onModelChange: (model: string) => void;
      availableModels: string[];
    }
    ```

3.  **Parameter Controls Component:**
    ```typescript
    interface ParameterControlsProps {
      modelId: string;
      parameters: Record<string, any>;
      onParameterChange: (key: string, value: any) => void;
    }
    ```

4.  **Question Display Component:**
    ```typescript
    interface QuestionDisplayProps {
      question: string;
      answer: string | number;
      mathOutput: any;
      context: any;
      metadata: {
        model_id: string;
        year_level: number;
        difficulty_params: Record<string, any>;
      };
    }
    ```

#### **6.2 API Routes for Testing**

1.  **Generate Question API (`/api/generate`):**
    ```typescript
    // POST /api/generate
    interface GenerateRequest {
      model_id: string;
      difficulty_params: Record<string, any>;
      context_type?: string;
      year_level?: number;
    }

    interface GenerateResponse {
      question: string;
      answer: string | number;
      math_output: any;
      context: any;
      metadata: any;
    }
    ```

2.  **Test Model API (`/api/test`):**
    ```typescript
    // POST /api/test
    interface TestRequest {
      model_id: string;
      test_count: number;
      difficulty_params: Record<string, any>;
    }

    interface TestResponse {
      results: Array<{
        question: string;
        answer: string | number;
        generation_time_ms: number;
      }>;
      statistics: {
        avg_generation_time: number;
        success_rate: number;
        unique_questions: number;
      };
    }
    ```

3.  **Model Info API (`/api/models`):**
    ```typescript
    // GET /api/models
    interface ModelInfo {
      model_id: string;
      description: string;
      difficulty_parameters: Array<{
        name: string;
        type: 'number' | 'boolean' | 'string';
        min?: number;
        max?: number;
        default: any;
        description: string;
      }>;
      supported_year_levels: number[];
      context_types: string[];
    }
    ```

#### **6.3 Testing Features**

1.  **Interactive Parameter Testing:**
    - Sliders for numerical parameters (max_value, operand_count, etc.)
    - Toggles for boolean parameters (allow_negatives, require_carrying, etc.)
    - Dropdowns for categorical parameters (context_type, year_level)
    - Real-time validation and parameter constraints

2.  **Batch Testing:**
    - Generate multiple questions with same parameters
    - Statistical analysis of generated content
    - Duplicate detection and uniqueness metrics
    - Performance benchmarking

3.  **Visual Question Preview:**
    - Formatted question display
    - Answer revelation toggle
    - Mathematical working steps (where applicable)
    - Context variable highlighting

4.  **Export and Save:**
    - Export generated questions as JSON/CSV
    - Save parameter presets for reuse
    - Share test configurations via URL parameters
    - Download question banks for offline use

#### **6.4 Advanced Testing Tools**

1.  **Difficulty Progression Tester:**
    - Visualize how questions change across year levels
    - Compare difficulty curves between models
    - Identify gaps in progression logic

2.  **Context Integration Tester:**
    - Test all context types with each model
    - Verify template rendering accuracy
    - Check for grammatical correctness

3.  **Performance Monitor:**
    - Track generation speed per model
    - Memory usage analysis
    - Concurrent generation testing

### **Phase 7: Development Workflow**

1.  **Development Server:**
    ```bash
    npm run dev
    ```
    Access testing interface at `http://localhost:3000/test`

2.  **Testing Workflow:**
    - Select a mathematical model from the dropdown
    - Adjust difficulty parameters using interactive controls
    - Generate single questions for immediate feedback
    - Run batch tests for comprehensive validation
    - Export successful configurations for production use

3.  **Model Development Cycle:**
    - Implement new model in `src/lib/math-engine/models/`
    - Add model to the registry in `src/lib/math-engine/index.ts`
    - Test via web interface with various parameter combinations
    - Refine based on generated output quality
    - Document parameter ranges and constraints

### **Phase 8: Production Deployment**

1.  **Build and Deploy:**
    ```bash
    npm run build
    npm start
    ```

2.  **Environment Configuration:**
    - Set up environment variables for API keys
    - Configure database connections (if needed)
    - Set up logging and monitoring

3.  **Testing in Production:**
    - Smoke tests for all models
    - Performance benchmarking
    - User acceptance testing with educators
```
--- END FILE: context\implementation_next_steps.md ---

--- START FILE: context\national_curriculum_framework.json ---
```json
[
  {
    "Strand": "Number and place value",
    "Substrand": "counting (in multiples)",
    "Content domain reference": "N1",
    "Years": {
      "Year 1": "count to and across 100, forwards and backwards, beginning with 0 or 1, or from any given number; count in multiples of twos, fives and tens",
      "Year 2": "count in steps of 2, 3, and 5 from 0, and in tens from any number, forward or backward",
      "Year 3": "count from 0 in multiples of 4, 8, 50 and 100",
      "Year 4": "count in multiples of 6, 7, 9, 25 and 1,000",
      "Year 5": "count forwards or backwards in steps of powers of 10 for any given number up to 1,000,000",
      "Year 6": ""
    }
  },
  {
    "Strand": "Number and place value",
    "Substrand": "read, write, order and compare numbers",
    "Content domain reference": "N2",
    "Years": {
      "Year 1": "count, read and write numbers to 100 in numerals; given a number, identify one more and one less; read and write numbers from 1 to 20 in numerals and words",
      "Year 2": "read and write numbers to at least 100 in numerals and in words; compare and order numbers from 0 up to 100; use <, > and = signs",
      "Year 3": "compare and order numbers up to 1,000; read and write numbers to 1,000 in numerals and in words; find 10 or 100 more or less than a given number",
      "Year 4": "order and compare numbers beyond 1,000; find 1,000 more or less than a given number",
      "Year 5": "read, write, order and compare numbers to at least 1,000,000",
      "Year 6": "read, write, order and compare numbers up to 10,000,000"
    }
  },
  {
    "Strand": "Number and place value",
    "Substrand": "place value; roman numerals",
    "Content domain reference": "N3",
    "Years": {
      "Year 1": "",
      "Year 2": "recognise the place value of each digit in a two-digit number (tens, ones)",
      "Year 3": "recognise the place value of each digit in a three-digit number (hundreds, tens, ones)",
      "Year 4": "recognise the place value of each digit in a four-digit number (thousands, hundreds, tens and ones); read Roman numerals to 100 (I to C) and know that over time, the numeral system changed to include the concept of zero and place value",
      "Year 5": "determine the value of each digit in numbers up to 1,000,000; read Roman numerals to 1,000 (M) and recognise years written in Roman numerals",
      "Year 6": "determine the value of each digit in numbers up to 10,000,000"
    }
  },
  {
    "Strand": "Number and place value",
    "Substrand": "identify, represent and estimate; rounding",
    "Content domain reference": "N4",
    "Years": {
      "Year 1": "identify and represent numbers using objects and pictorial representations including the number line, and use the language of: equal to, more than, less than (fewer), most, least",
      "Year 2": "identify, represent and estimate numbers using different representations, including the number line",
      "Year 3": "identify, represent and estimate numbers using different representations",
      "Year 4": "identify, represent and estimate numbers using different representations; round any number to the nearest 10, 100 or 1,000",
      "Year 5": "round any number up to 1,000,000 to the nearest 10, 100, 1,000, 10,000 and 100,000",
      "Year 6": "round any whole number to a required degree of accuracy"
    }
  },
  {
    "Strand": "Number and place value",
    "Substrand": "negative numbers",
    "Content domain reference": "N5",
    "Years": {
      "Year 1": "",
      "Year 2": "",
      "Year 3": "",
      "Year 4": "count backwards through zero to include negative numbers",
      "Year 5": "interpret negative numbers in context, count forwards and backwards with positive and negative whole numbers, including through zero",
      "Year 6": "use negative numbers in context, and calculate intervals across zero"
    }
  },
  {
    "Strand": "Number and place value",
    "Substrand": "number problems",
    "Content domain reference": "N6",
    "Years": {
      "Year 1": "",
      "Year 2": "use place value and number facts to solve problems",
      "Year 3": "solve number problems and practical problems involving 3N1-3N4",
      "Year 4": "solve number and practical problems that involve 4N1-4N5 and with increasingly large positive numbers",
      "Year 5": "solve number problems and practical problems that involve 5N1-5N5",
      "Year 6": "solve number problems and practical problems that involve 6N2-6N5"
    }
  },
  {
    "Strand": "Addition, subtraction, multiplication and division (calculations)",
    "Substrand": "add / subtract mentally",
    "Content domain reference": "C1",
    "Years": {
      "Year 1": "represent and use number bonds and related subtraction facts within 20",
      "Year 2": "recall and use addition and subtraction facts to 20 fluently, and derive and use related facts up to 100",
      "Year 3": "add and subtract numbers mentally, including: a three-digit number and ones, a three-digit number and tens, a three-digit number and hundreds",
      "Year 4": "",
      "Year 5": "add and subtract numbers mentally with increasingly large numbers",
      "Year 6": ""
    }
  },
  {
    "Strand": "Addition, subtraction, multiplication and division (calculations)",
    "Substrand": "add / subtract using written methods",
    "Content domain reference": "C2",
    "Years": {
      "Year 1": "add and subtract one-digit and two-digit numbers to 20, including zero; read, write and interpret mathematical statements involving addition (+), subtraction (–) and equals (=) signs",
      "Year 2": "add and subtract numbers using concrete objects, pictorial representations, and mentally, including: a two-digit number and ones, a two-digit number and tens, two two-digit numbers, adding three one-digit numbers",
      "Year 3": "add and subtract numbers with up to three digits, using formal written methods of columnar addition and subtraction",
      "Year 4": "add and subtract numbers with up to 4 digits using the formal written methods of columnar addition and subtraction where appropriate",
      "Year 5": "add and subtract whole numbers with more than 4 digits, including using formal written methods (columnar addition and subtraction)",
      "Year 6": ""
    }
  },
  {
    "Strand": "Addition, subtraction, multiplication and division (calculations)",
    "Substrand": "estimate, use inverses and check",
    "Content domain reference": "C3",
    "Years": {
      "Year 1": "",
      "Year 2": "recognise and use the inverse relationship between addition and subtraction and use this to check calculations and missing number problems",
      "Year 3": "estimate the answer to a calculation and use inverse operations to check answers",
      "Year 4": "estimate and use inverse operations to check answers to a calculation",
      "Year 5": "use rounding to check answers to calculations and determine, in the context of a problem, levels of accuracy",
      "Year 6": "use estimation to check answers to calculations and determine, in the context of a problem, an appropriate degree of accuracy"
    }
  },
  {
    "Strand": "Addition, subtraction, multiplication and division (calculations)",
    "Substrand": "add / subtract to solve problems",
    "Content domain reference": "C4",
    "Years": {
      "Year 1": "solve one-step problems that involve addition and subtraction, using concrete objects and pictorial representations, and missing number problems such as 7 = _ – 9",
      "Year 2": "solve problems with addition and subtraction: using concrete objects and pictorial representations, including those involving numbers, quantities and measures; applying their increasing knowledge of mental and written methods",
      "Year 3": "solve problems, including missing number problems, using number facts, place value, and more complex addition and subtraction",
      "Year 4": "solve addition and subtraction two-step problems in contexts, deciding which operations and methods to use and why",
      "Year 5": "solve addition and subtraction multi-step problems in contexts, deciding which operations and methods to use and why",
      "Year 6": "solve addition and subtraction multi-step problems in contexts, deciding which operations and methods to use and why"
    }
  },
  {
    "Strand": "Addition, subtraction, multiplication and division (calculations)",
    "Substrand": "properties of number (multiples, factors, primes, squares and cubes)",
    "Content domain reference": "C5",
    "Years": {
      "Year 1": "",
      "Year 2": "",
      "Year 3": "",
      "Year 4": "",
      "Year 5": "identify multiples and factors, including finding all factor pairs of a number and common factors of two numbers; know and use the vocabulary of prime numbers, prime factors and composite (non-prime) numbers; establish whether a number up to 100 is prime and recall prime numbers up to 19; recognise and use square numbers and cube numbers, and the notation for squared (²) and cubed (³)",
      "Year 6": "identify common factors, common multiples and prime numbers"
    }
  },
  {
    "Strand": "Addition, subtraction, multiplication and division (calculations)",
    "Substrand": "multiply / divide mentally",
    "Content domain reference": "C6",
    "Years": {
      "Year 1": "",
      "Year 2": "recall and use multiplication and division facts for the 2, 5 and 10 multiplication tables, including recognising odd and even numbers",
      "Year 3": "recall and use multiplication and division facts for the 3, 4 and 8 multiplication tables",
      "Year 4": "recall multiplication and division facts for multiplication tables up to 12 x 12; use place value, known and derived facts to multiply and divide mentally, including: multiplying by 0 and 1, dividing by 1, multiplying together three numbers; recognise and use factor pairs and commutativity in mental calculations",
      "Year 5": "multiply and divide numbers mentally drawing upon known facts; multiply and divide whole numbers and those involving decimals by 10, 100 and 1,000",
      "Year 6": "perform mental calculations, including with mixed operations and large numbers"
    }
  },
  {
    "Strand": "Addition, subtraction, multiplication and division (calculations)",
    "Substrand": "multiply / divide using written methods",
    "Content domain reference": "C7",
    "Years": {
      "Year 1": "",
      "Year 2": "calculate mathematical statements for multiplication and division within the multiplication tables and write them using the multiplication (×), division (÷) and equals (=) signs",
      "Year 3": "write and calculate mathematical statements for multiplication and division using the multiplication tables that pupils know, including for two-digit numbers times one-digit numbers, using mental and progressing to formal written methods",
      "Year 4": "multiply two-digit and three-digit numbers by a one-digit number using formal written layout",
      "Year 5": "multiply numbers up to 4 digits by a one- or two-digit number using a formal written method, including long multiplication for two-digit numbers; divide numbers up to 4 digits by a one-digit number using the formal written method of short division and interpret remainders appropriately for the context",
      "Year 6": "multiply multi-digit numbers up to 4 digits by a two-digit whole number using the formal written method of long multiplication; divide numbers up to 4 digits by a two-digit whole number using the formal written method of long division, and interpret remainders as whole number remainders, fractions, or by rounding, as appropriate for the context; divide numbers up to 4 digits by a two-digit number using the formal written method of short division where appropriate, interpreting remainders according to the context"
    }
  },
  {
    "Strand": "Addition, subtraction, multiplication and division (calculations)",
    "Substrand": "solve problems (commutative, associative, distributive and all four operations)",
    "Content domain reference": "C8",
    "Years": {
      "Year 1": "solve one-step problems involving multiplication and division, by calculating the answer using concrete objects, pictorial representations and arrays with the support of the teacher",
      "Year 2": "solve problems involving multiplication and division, using materials, arrays, repeated addition, mental methods, and multiplication and division facts, including problems in contexts; show that addition of two numbers can be done in any order (commutative) and subtraction of one number from another cannot; show that multiplication of two numbers can be done in any order (commutative) and division of one number by another cannot",
      "Year 3": "solve problems, including missing number problems, involving multiplication and division, including integer scaling problems and correspondence problems in which n objects are connected to m objects",
      "Year 4": "solve problems involving multiplying and adding, including using the distributive law to multiply two-digit numbers by one digit, integer scaling problems and harder correspondence problems such as n objects are connected to m objects",
      "Year 5": "solve problems involving multiplication and division including using their knowledge of factors and multiples, squares and cubes; solve problems involving addition, subtraction, multiplication and division and a combination of these, including understanding the meaning of the equals sign; solve problems involving multiplication and division including scaling by simple fractions and problems involving simple rates",
      "Year 6": "solve problems involving addition, subtraction, multiplication and division"
    }
  },
  {
    "Strand": "Addition, subtraction, multiplication and division (calculations)",
    "Substrand": "order of operations",
    "Content domain reference": "C9",
    "Years": {
      "Year 1": "",
      "Year 2": "",
      "Year 3": "",
      "Year 4": "",
      "Year 5": "",
      "Year 6": "use their knowledge of the order of operations to carry out calculations involving the four operations"
    }
  },
  {
    "Strand": "Fractions, decimals and percentages",
    "Substrand": "recognise, find, write, name and count fractions",
    "Content domain reference": "F1",
    "Years": {
      "Year 1": "recognise, find and name a half as one of two equal parts of an object, shape or quantity; recognise, find and name a quarter as one of four equal parts of an object, shape or quantity",
      "Year 2": "recognise, find, name and write fractions ⅓, ¼, ²⁄₄ and ¾ of a length, shape, set of objects or quantity; write simple fractions, for example, ½ of 6 = 3",
      "Year 3": "count up and down in tenths, recognise that tenths arise from dividing an object into 10 equal parts and in dividing one-digit numbers or quantities by 10; recognise, find and write fractions of a discrete set of objects: unit fractions and non-unit fractions with small denominators; recognise and use fractions as numbers: unit fractions and non-unit fractions with small denominators",
      "Year 4": "count up and down in hundredths; recognise that hundredths arise when dividing an object by a hundred and dividing tenths by ten",
      "Year 5": "",
      "Year 6": ""
    }
  },
  {
    "Strand": "Fractions, decimals and percentages",
    "Substrand": "equivalent fractions",
    "Content domain reference": "F2",
    "Years": {
      "Year 1": "",
      "Year 2": "recognise the equivalence of ²⁄₄ and ½",
      "Year 3": "recognise and show, using diagrams, equivalent fractions with small denominators",
      "Year 4": "recognise and show, using diagrams, families of common equivalent fractions",
      "Year 5": "recognise mixed numbers and improper fractions and convert from one form to the other; write mathematical statements >1 as a mixed number [e.g. ⅖ + ⅘ = ⁶⁄₅ = 1⅕]; identify name and write equivalent fractions of a given fraction, represented visually, including tenths and hundredths",
      "Year 6": "use common factors to simplify fractions; use common multiples to express fractions in the same denomination"
    }
  },
  {
    "Strand": "Fractions, decimals and percentages",
    "Substrand": "comparing and ordering fractions",
    "Content domain reference": "F3",
    "Years": {
      "Year 1": "",
      "Year 2": "",
      "Year 3": "compare and order unit fractions and fractions with the same denominators",
      "Year 4": "",
      "Year 5": "compare and order fractions whose denominators are all multiples of the same number",
      "Year 6": "compare and order fractions, including fractions > 1"
    }
  },
  {
    "Strand": "Fractions, decimals and percentages",
    "Substrand": "add / subtract fractions",
    "Content domain reference": "F4",
    "Years": {
      "Year 1": "",
      "Year 2": "",
      "Year 3": "add and subtract fractions with the same denominator within one whole [e.g. ⅚ + ⅚ = ⁶⁄₇]",
      "Year 4": "add and subtract fractions with the same denominator",
      "Year 5": "add and subtract fractions with the same denominator and denominators that are multiples of the same number",
      "Year 6": "add and subtract fractions with different denominators and mixed numbers, using the concept of equivalent fractions"
    }
  },
  {
    "Strand": "Fractions, decimals and percentages",
    "Substrand": "multiply / divide fractions",
    "Content domain reference": "F5",
    "Years": {
      "Year 1": "",
      "Year 2": "",
      "Year 3": "",
      "Year 4": "",
      "Year 5": "multiply proper fractions and mixed numbers by whole numbers, supported by materials and diagrams",
      "Year 6": "multiply simple pairs of proper fractions, writing the answer in its simplest form [e.g. ¼ x ½ = ⅛]; divide proper fractions by whole numbers [e.g. ⅓ ÷ 2 = ⅙]"
    }
  },
  {
    "Strand": "Fractions, decimals and percentages",
    "Substrand": "fractions / decimals equivalence",
    "Content domain reference": "F6",
    "Years": {
      "Year 1": "",
      "Year 2": "",
      "Year 3": "",
      "Year 4": "recognise and write decimal equivalents to ¼, ½, ¾; recognise and write decimal equivalents of any number of tenths or hundredths",
      "Year 5": "read and write decimal numbers as fractions [e.g. 0.71 = ⁷¹⁄₁₀₀]; recognise and use thousandths and relate them to tenths, hundredths and decimal equivalents",
      "Year 6": "associate a fraction with division to calculate decimal fraction equivalents (e.g. 0.375) for a simple fraction [e.g. ⅜]"
    }
  },
  {
    "Strand": "Fractions, decimals and percentages",
    "Substrand": "rounding decimals",
    "Content domain reference": "F7",
    "Years": {
      "Year 1": "",
      "Year 2": "",
      "Year 3": "",
      "Year 4": "round decimals with one decimal place to the nearest whole number",
      "Year 5": "round decimals with two decimal places to the nearest whole number and to one decimal place",
      "Year 6": ""
    }
  },
  {
    "Strand": "Fractions, decimals and percentages",
    "Substrand": "compare and order decimals",
    "Content domain reference": "F8",
    "Years": {
      "Year 1": "",
      "Year 2": "",
      "Year 3": "",
      "Year 4": "compare numbers with the same number of decimal places up to two decimal places",
      "Year 5": "read, write, order and compare numbers with up to three decimal places",
      "Year 6": ""
    }
  },
  {
    "Strand": "Fractions, decimals and percentages",
    "Substrand": "multiply / divide decimals",
    "Content domain reference": "F9",
    "Years": {
      "Year 1": "",
      "Year 2": "",
      "Year 3": "",
      "Year 4": "find the effect of dividing a one- or two-digit number by 10 and 100, identifying the value of the digits in the answer as ones, tenths and hundredths",
      "Year 5": "",
      "Year 6": "identify the value of each digit to three decimal places and multiply and divide numbers by 10, 100 and 1,000 giving answers up to three decimal places; multiply one-digit numbers with up to two-decimal places by whole numbers; use written division methods in cases where the answer has up to two-decimal places"
    }
  },
  {
    "Strand": "Fractions, decimals and percentages",
    "Substrand": "solve problems with fractions and decimals",
    "Content domain reference": "F10",
    "Years": {
      "Year 1": "",
      "Year 2": "",
      "Year 3": "solve problems that involve 3F1-3F4",
      "Year 4": "solve problems involving increasingly harder fractions to calculate quantities and fractions to divide quantities, including non-unit fractions where the answer is a whole number; solve simple measure and money problems involving fractions and decimals to two decimal places",
      "Year 5": "solve problems involving numbers up to three decimal places",
      "Year 6": "solve problems which require answers to be rounded to specified degrees of accuracy"
    }
  },
  {
    "Strand": "Fractions, decimals and percentages",
    "Substrand": "fractions / decimal / percentage equivalence",
    "Content domain reference": "F11",
    "Years": {
      "Year 1": "",
      "Year 2": "",
      "Year 3": "",
      "Year 4": "",
      "Year 5": "recognise the per cent symbol (%) and understand that per cent relates to 'number of parts per hundred'; write percentages as a fraction with denominator hundred, and as a decimal",
      "Year 6": "recall and use equivalences between simple fractions, decimals and percentages, including in different contexts"
    }
  },
  {
    "Strand": "Fractions, decimals and percentages",
    "Substrand": "solve problems with percentages",
    "Content domain reference": "F12",
    "Years": {
      "Year 1": "",
      "Year 2": "",
      "Year 3": "",
      "Year 4": "",
      "Year 5": "solve problems that require knowing percentage and decimal equivalents of ½, ¼, ⅕, ⅖, ⅘ and those fractions with a denominator of a multiple of 10 or 25",
      "Year 6": ""
    }
  },
  {
    "Strand": "Ratio and proportion",
    "Substrand": "relative sizes, similarity",
    "Content domain reference": "R1",
    "Years": {
      "Year 1": "",
      "Year 2": "",
      "Year 3": "",
      "Year 4": "",
      "Year 5": "",
      "Year 6": "solve problems involving the relative sizes of two quantities, where missing values can be found by using integer multiplication and division facts"
    }
  },
  {
    "Strand": "Ratio and proportion",
    "Substrand": "use of percentages for comparison",
    "Content domain reference": "R2",
    "Years": {
      "Year 1": "",
      "Year 2": "",
      "Year 3": "",
      "Year 4": "",
      "Year 5": "",
      "Year 6": "solve problems involving the calculation of percentages [e.g. of measures such as 15% of 360] and the use of percentages for comparison"
    }
  },
  {
    "Strand": "Ratio and proportion",
    "Substrand": "scale factors",
    "Content domain reference": "R3",
    "Years": {
      "Year 1": "",
      "Year 2": "",
      "Year 3": "",
      "Year 4": "",
      "Year 5": "",
      "Year 6": "solve problem involving similar shapes where the scale factor is known or can be found"
    }
  },
  {
    "Strand": "Ratio and proportion",
    "Substrand": "unequal sharing and grouping",
    "Content domain reference": "R4",
    "Years": {
      "Year 1": "",
      "Year 2": "",
      "Year 3": "",
      "Year 4": "",
      "Year 5": "",
      "Year 6": "solve problems involving unequal sharing and grouping using knowledge of fractions and multiples"
    }
  },
  {
    "Strand": "Algebra",
    "Substrand": "missing number problems expressed in algebra",
    "Content domain reference": "A1",
    "Years": {
      "Year 1": "",
      "Year 2": "",
      "Year 3": "",
      "Year 4": "",
      "Year 5": "",
      "Year 6": "express missing number problems algebraically"
    }
  },
  {
    "Strand": "Algebra",
    "Substrand": "simple formulae expressed in words",
    "Content domain reference": "A2",
    "Years": {
      "Year 1": "",
      "Year 2": "",
      "Year 3": "",
      "Year 4": "",
      "Year 5": "",
      "Year 6": "use simple formulae"
    }
  },
  {
    "Strand": "Algebra",
    "Substrand": "generate and describe linear number sequences",
    "Content domain reference": "A3",
    "Years": {
      "Year 1": "",
      "Year 2": "",
      "Year 3": "",
      "Year 4": "",
      "Year 5": "",
      "Year 6": "generate and describe linear number sequences"
    }
  },
  {
    "Strand": "Algebra",
    "Substrand": "number sentences involving two unknowns",
    "Content domain reference": "A4",
    "Years": {
      "Year 1": "",
      "Year 2": "",
      "Year 3": "",
      "Year 4": "",
      "Year 5": "",
      "Year 6": "find pairs of numbers that satisfy an equation with two unknowns"
    }
  },
  {
    "Strand": "Algebra",
    "Substrand": "enumerate all possibilities of combinations of two variables",
    "Content domain reference": "A5",
    "Years": {
      "Year 1": "",
      "Year 2": "",
      "Year 3": "",
      "Year 4": "",
      "Year 5": "",
      "Year 6": "enumerate possibilities of combinations of two variables"
    }
  },
  {
    "Strand": "Measurement",
    "Substrand": "compare, describe and order measures",
    "Content domain reference": "M1",
    "Years": {
      "Year 1": "compare, describe and solve practical problems for: lengths and heights (e.g. long/short, taller/shorter); mass/weight (e.g. heavy/light, heavier than); capacity and volume (e.g. full/empty, more than/less than); time (e.g. quicker, slower)",
      "Year 2": "compare and order lengths, mass, volume/capacity and record the results using >, < and =",
      "Year 3": "compare lengths (m/cm/mm); compare mass (kg/g); compare volume/capacity (l/ml)",
      "Year 4": "compare different measures, including money in pounds and pence",
      "Year 5": "",
      "Year 6": ""
    }
  },
  {
    "Strand": "Measurement",
    "Substrand": "estimate, measure and read scales",
    "Content domain reference": "M2",
    "Years": {
      "Year 1": "measure and begin to record: lengths and heights; mass/weight; capacity and volume; time (hours, minutes, seconds)",
      "Year 2": "choose and use appropriate standard units to estimate and measure: length/height (m/cm); mass (kg/g); temperature (°C); capacity (litres/ml) to the nearest appropriate unit, using rulers, scales, thermometers and measuring vessels",
      "Year 3": "measure lengths (m/cm/mm); measure mass (kg/g); measure volume / capacity (l/ml)",
      "Year 4": "estimate different measures, including money in pounds and pence",
      "Year 5": "",
      "Year 6": ""
    }
  },
  {
    "Strand": "Measurement",
    "Substrand": "money",
    "Content domain reference": "M3",
    "Years": {
      "Year 1": "recognise and know the value of different denominations of coins and notes",
      "Year 2": "recognise and use symbols for pounds (£) and pence (p); combine amounts to make a particular value; find different combinations of coins that equal the same amounts of money",
      "Year 3": "Key stage 1 content domain",
      "Year 4": "",
      "Year 5": "",
      "Year 6": ""
    }
  },
  {
    "Strand": "Measurement",
    "Substrand": "telling time, ordering time, duration and units of time",
    "Content domain reference": "M4",
    "Years": {
      "Year 1": "tell the time to the hour and half past the hour and draw the hands on a clock face to show these times; sequence events in chronological order using language (e.g. before, after, next); recognise and use language relating to dates, including days of the week, weeks, months and years",
      "Year 2": "tell and write the time to five minutes, including quarter past/to the hour and draw the hands on a clock face to show these times; compare and sequence intervals of time; know the number of minutes in an hour and the number of hours in a day",
      "Year 3": "tell and write the time from an analogue clock; 12-hour clocks; tell and write the time from an analogue clock; 24-hour clocks; tell and write the time from an analogue clock, including using Roman numerals from I to XII; estimate and read time with increasing accuracy to the nearest minute; record and compare time in terms of seconds, minutes and hours; use vocabulary such as o'clock / a.m. / p.m., morning, afternoon, noon and midnight; know the number of seconds in a minute and the number of days in each month, year and leap year; compare durations of events, [e.g. to calculate the time taken by particular events or tasks]",
      "Year 4": "read, write and convert time between analogue and digital 12-hour clocks; read, write and convert time between analogue and digital 24-hour clocks; solve problems involving converting from hours to minutes; minutes to seconds; years to months; weeks to days",
      "Year 5": "solve problems involving converting between units of time",
      "Year 6": ""
    }
  },
  {
    "Strand": "Measurement",
    "Substrand": "convert between metric units",
    "Content domain reference": "M5",
    "Years": {
      "Year 1": "",
      "Year 2": "",
      "Year 3": "",
      "Year 4": "",
      "Year 5": "convert between different units of metric measure [e.g. kilometre and metre; centimetre and metre; centimetre and millimetre; gram and kilogram; litre and millilitre]",
      "Year 6": ""
    }
  },
  {
    "Strand": "Measurement",
    "Substrand": "convert metric / imperial",
    "Content domain reference": "M6",
    "Years": {
      "Year 1": "",
      "Year 2": "",
      "Year 3": "",
      "Year 4": "convert between different units of measurement [e.g. kilometre to metre; hour to minute]",
      "Year 5": "understand and use approximate equivalences between metric units and common imperial units such as inches, pounds and pints",
      "Year 6": "use, read, write and convert between standard units, converting measurements of length, mass, volume and time from a smaller unit of measure to a larger unit, and vice versa, using decimal notation of up to three decimal places; convert between miles and kilometres"
    }
  },
  {
    "Strand": "Measurement",
    "Substrand": "perimeter, area",
    "Content domain reference": "M7",
    "Years": {
      "Year 1": "",
      "Year 2": "",
      "Year 3": "measure the perimeter of simple 2-D shapes",
      "Year 4": "measure and calculate the perimeter of a rectilinear figure (including squares) in centimetres and metres; find the area of rectilinear shapes by counting squares",
      "Year 5": "measure and calculate the perimeter of composite rectilinear shapes in centimetres and metres; calculate and compare the area of rectangles (including squares), and including using standard units, square centimetres (cm²) and square metres (m²) and estimate the area of irregular shapes",
      "Year 6": "recognise that shapes with the same areas can have different perimeters and vice versa; calculate the area of parallelograms and triangles; recognise when it is possible to use the formulae for the area of shapes"
    }
  },
  {
    "Strand": "Measurement",
    "Substrand": "volume",
    "Content domain reference": "M8",
    "Years": {
      "Year 1": "",
      "Year 2": "",
      "Year 3": "",
      "Year 4": "",
      "Year 5": "estimate volume [e.g. using 1 cm³ blocks to build cuboids (including cubes)] and capacity [e.g. using water]",
      "Year 6": "calculate, estimate and compare volume of cubes and cuboids using standard units, including centimetre cubed (cm³) and cubic metres (m³), and extending to other units [e.g. mm³ and km³]; recognise when it is possible to use the formulae for the volume of shapes"
    }
  },
  {
    "Strand": "Measurement",
    "Substrand": "solve problems (a, money; b, length; c, mass / weight; d, capacity / volume)",
    "Content domain reference": "M9",
    "Years": {
      "Year 1": "",
      "Year 2": "solve simple problems in a practical context involving addition and subtraction of money of the same unit, including giving change",
      "Year 3": "add and subtract amounts of money to give change, using both pounds (£) and pence (p) in practical contexts; add and subtract lengths (m/cm/mm); add and subtract mass (kg/g); add and subtract volume / capacity (l/ml)",
      "Year 4": "calculate different measures, including money in pounds and pence",
      "Year 5": "use all four operations to solve problems involving measures [money] using decimal notation, including scaling; use all four operations to solve problems involving measure [e.g. length] using decimal notation, including scaling; use all four operations to solve problems involving measure [e.g. mass] using decimal notation, including scaling; use all four operations to solve problems involving measure [e.g. volume] using decimal notation, including scaling",
      "Year 6": "solve problems involving the calculation and conversion of units of measure, using decimal notation up to three decimal places where appropriate"
    }
  },
  {
    "Strand": "Geometry – properties of shapes",
    "Substrand": "recognise and name common shapes",
    "Content domain reference": "G1",
    "Years": {
      "Year 1": "recognise and name common 2-D shapes (e.g. rectangles, squares, circles, triangles); recognise and name common 3-D shapes (e.g. cuboids, cubes, pyramids, spheres)",
      "Year 2": "compare and sort common 2-D and 3-D shapes and everyday objects",
      "Year 3": "Within key stage 1 content domain",
      "Year 4": "",
      "Year 5": "",
      "Year 6": ""
    }
  },
  {
    "Strand": "Geometry – properties of shapes",
    "Substrand": "describe properties and classify shapes",
    "Content domain reference": "G2",
    "Years": {
      "Year 1": "",
      "Year 2": "identify and describe the properties of 2-D shapes, including the number of sides and line symmetry in a vertical line; identify and describe the properties of 3-D shapes, including the number of edges, vertices and faces",
      "Year 3": "identify horizontal, vertical lines and pairs of perpendicular and parallel lines",
      "Year 4": "compare and classify geometric shapes, including quadrilaterals and triangles based on their properties and sizes; identify lines of symmetry in 2-D shapes presented in different orientations; complete a simple symmetric figure with respect to a specific line of symmetry",
      "Year 5": "use the properties of rectangles to deduce related facts and find missing lengths and angles; distinguish between regular and irregular polygons based on reasoning about equal sides and angles",
      "Year 6": "compare and classify geometric shapes based on their properties and sizes; describe simple 3-D shapes"
    }
  },
  {
    "Strand": "Geometry – properties of shapes",
    "Substrand": "draw and make shapes and relate 2-D to 3-D shapes (including nets)",
    "Content domain reference": "G3",
    "Years": {
      "Year 1": "",
      "Year 2": "identify 2-D shapes on the surface of 3-D shapes (e.g. a circle on a cylinder and a triangle on a pyramid)",
      "Year 3": "draw 2-D shapes; make 3-D shapes using modelling materials; recognise 3-D shapes in different orientations and describe them",
      "Year 4": "",
      "Year 5": "identify 3-D shapes including cubes and other cuboids, from 2-D representations",
      "Year 6": "draw 2-D shapes using given dimensions and angles; recognise and build simple 3-D shapes, including making nets"
    }
  },
  {
    "Strand": "Geometry – properties of shapes",
    "Substrand": "angles – measuring and properties",
    "Content domain reference": "G4",
    "Years": {
      "Year 1": "",
      "Year 2": "",
      "Year 3": "recognise that angles are a property of shape or a description of a turn; identify right angles, recognise that two right angles make a half-turn, three make three quarters of a turn and four a complete turn; identify whether angles are greater than or less than a right angle",
      "Year 4": "identify acute and obtuse angles and compare and order angles up to two right angles by size",
      "Year 5": "know angles are measured in degrees: estimate and compare acute, obtuse and reflex angles; identify: angles at a point and one whole turn (total 360°), angles at a point on a straight line and ½ a turn (total 180°), other multiples of 90°; draw given angles and measure them in degrees (°)",
      "Year 6": "find unknown angles in any triangles, quadrilaterals and regular polygons; recognise angles where they meet at a point, are on a straight line, or are vertically opposite, and find missing angles"
    }
  },
  {
    "Strand": "Geometry – properties of shapes",
    "Substrand": "circles",
    "Content domain reference": "G5",
    "Years": {
      "Year 1": "",
      "Year 2": "",
      "Year 3": "",
      "Year 4": "",
      "Year 5": "",
      "Year 6": "illustrate and name parts of circles, including radius, diameter and circumference and know that the diameter is twice the radius"
    }
  },
  {
    "Strand": "Geometry - position and direction",
    "Substrand": "patterns",
    "Content domain reference": "P1",
    "Years": {
      "Year 1": "",
      "Year 2": "order and arrange combinations of mathematical objects in patterns and sequences",
      "Year 3": "Within key stage 1 content domain",
      "Year 4": "",
      "Year 5": "",
      "Year 6": ""
    }
  },
  {
    "Strand": "Geometry - position and direction",
    "Substrand": "describe position, direction and movement",
    "Content domain reference": "P2",
    "Years": {
      "Year 1": "describe position, direction and movement, including half, quarter and three-quarter turns",
      "Year 2": "use mathematical vocabulary to describe position, direction and movement, including movement in a straight line and distinguishing between rotation as a turn and in terms of right angles for quarter, half and three-quarter turns (clockwise and anti-clockwise)",
      "Year 3": "",
      "Year 4": "describe movements between positions as translations of a given unit to the left / right and up / down",
      "Year 5": "identify, describe and represent the position of a shape following a reflection or translation, using the appropriate language, and know that the shape has not changed",
      "Year 6": "draw and translate simple shapes on the co-ordinate plane, and reflect them in the axes"
    }
  },
  {
    "Strand": "Geometry - position and direction",
    "Substrand": "co-ordinates",
    "Content domain reference": "P3",
    "Years": {
      "Year 1": "",
      "Year 2": "",
      "Year 3": "",
      "Year 4": "describe positions on a 2-D grid as co-ordinates in the first quadrant; plot specified points and draw sides to complete a given polygon",
      "Year 5": "",
      "Year 6": "describe positions on the full co-ordinate grid (all four quadrants)"
    }
  },
  {
    "Strand": "Statistics",
    "Substrand": "interpret and represent data",
    "Content domain reference": "S1",
    "Years": {
      "Year 1": "",
      "Year 2": "interpret and construct simple pictograms, tally charts, block diagrams and simple tables",
      "Year 3": "interpret and present data using bar charts, pictograms and tables",
      "Year 4": "interpret and present discrete and continuous data using appropriate graphical methods, including bar charts and time graphs",
      "Year 5": "complete, read and interpret information in tables, including timetables",
      "Year 6": "interpret and construct pie charts and line graphs and use these to solve problems"
    }
  },
  {
    "Strand": "Statistics",
    "Substrand": "solve problems involving data",
    "Content domain reference": "S2",
    "Years": {
      "Year 1": "",
      "Year 2": "ask and answer simple questions by counting the number of objects in each category and sorting the categories by quantity; ask and answer questions about totalling and comparing categorical data",
      "Year 3": "solve one-step and two-step questions [e.g. 'How many more?' and 'How many fewer?'] using information presented in scaled bar charts, pictograms and tables",
      "Year 4": "solve comparison, sum and difference problems using information presented in bar charts, pictograms, tables and other graphs",
      "Year 5": "solve comparison, sum and difference problems using information presented in a line graph",
      "Year 6": ""
    }
  },
  {
    "Strand": "Statistics",
    "Substrand": "mean average",
    "Content domain reference": "S3",
    "Years": {
      "Year 1": "",
      "Year 2": "",
      "Year 3": "",
      "Year 4": "",
      "Year 5": "",
      "Year 6": "calculate and interpret the mean as an average"
    }
  }
]
```
--- END FILE: context\national_curriculum_framework.json ---

--- START FILE: context\readme.md ---
```markdown
# Context Folder Guide

This is a simple guide to the files in the context folder:

## File Descriptions

**National Curriculum Framework** - Summarises the UK maths curriculum for key stages 1 and 2.

**Example Questions.json** - Contains example questions for each of the sub-strands in the national curriculum framework. This is used to collate example questions for each sub-strand. The questions in this file have been sourced from reputable and trusted educational websites in the UK.

**Factory Blueprint Prompt** - An example prompt used with a large language model to design and build a question factory which can be used to algorithmically generate questions for a curriculum item and vary the difficulty as needed. This would be used to create a pre-curated bank of questions which gradually get more difficult as the user progresses through the curriculum.

**Factory Blueprint Response** - An example response from using the factory blueprint prompt with a high-quality thinking large language model.

**Implementation Next Steps** - My thoughts on how to build this out so that I can create an application with a simple UI to create and test question generation for a specific strand or sub-strand from the UK maths curriculum.

## Project Goal

My goal is to create a flexible way to generate questions where I can subtly alter the difficulty by changing different parameters and then add a story layer to the results. This means that when students read the questions, the maths could actually be related to pounds, sea shells, or other objects - so the maths and the story are applied in two separate layers.
```
--- END FILE: context\readme.md ---

--- START FILE: eslint.config.mjs ---
```javascript
import { dirname } from "path";
import { fileURLToPath } from "url";
import { FlatCompat } from "@eslint/eslintrc";

const __filename = fileURLToPath(import.meta.url);
const __dirname = dirname(__filename);

const compat = new FlatCompat({
  baseDirectory: __dirname,
});

const eslintConfig = [
  ...compat.extends("next/core-web-vitals", "next/typescript"),
  {
    ignores: [
      "node_modules/**",
      ".next/**",
      "out/**",
      "build/**",
      "next-env.d.ts",
    ],
  },
];

export default eslintConfig;

```
--- END FILE: eslint.config.mjs ---

--- START FILE: Factory_Architect_User_Guide.md ---
```markdown
# Factory Architect: Complete User Guide
*Educational Mathematics Question Generator for UK National Curriculum*

---

## What is Factory Architect?

Factory Architect is an intelligent question generator that creates unlimited, unique mathematics problems for UK primary school children (Years 1-6). Think of it as having a highly skilled mathematics teacher who can instantly create perfectly tailored questions for any child at any level - but one who never gets tired and can generate thousands of questions in seconds.

---

## How Does It Work? (The Simple Version)

Imagine you have two expert assistants working together:

### 🧮 **The Mathematics Expert (Math Engine)**
- Knows exactly how to create every type of calculation
- Understands what makes problems harder or easier
- Can adjust difficulty perfectly for each year group
- Works with pure numbers and mathematical concepts

### 📖 **The Story Writer (Story Engine)** 
- Takes those mathematical calculations
- Wraps them in real-world scenarios children understand
- Makes abstract maths feel practical and relevant
- Uses familiar contexts like shopping, sharing, and measuring

**Result**: Instead of seeing "47 + 23 = ?", a child might see "Sarah has £47 in her savings account. Her grandmother gives her £23 more. How much does Sarah have now?"

---

## The Two-Engine Architecture Explained

### Why Two Separate Engines?

This separation is powerful because:

**Math Engine Benefits:**
- Creates mathematically perfect problems every time
- Ensures proper difficulty progression
- Maintains educational accuracy
- Can be used with any story context

**Story Engine Benefits:**  
- Makes maths feel relevant and engaging
- Uses age-appropriate language and scenarios
- Can present the same calculation in multiple ways
- Adapts to different cultural contexts

**Example**: The calculation "24 ÷ 6 = 4" could become:
- Money context: "24 sweets cost £6. How much does each sweet cost?"
- Sharing context: "24 children need to form 6 equal groups. How many children in each group?"
- Measurement context: "A 24-metre rope is cut into 6 equal pieces. How long is each piece?"

---

## Complete Mathematics Coverage

Factory Architect covers **19 different types** of mathematical problems:

### Basic Operations (Years 1-6)
1. **Addition** - Adding numbers together
2. **Subtraction** - Finding differences between numbers  
3. **Multiplication** - Times tables and repeated addition
4. **Division** - Sharing and grouping equally

### Advanced Calculations (Years 3-6)
5. **Percentages** - Finding percentages of amounts
6. **Fractions** - Working with parts of wholes
7. **Time & Rate** - Calculating over time periods
8. **Conversions** - Changing between units (metres/cm, £/pence)
9. **Comparisons** - Which is better value? Which is bigger?
10. **Multi-Step** - Problems requiring several calculations
11. **Linear Equations** - Basic algebra concepts
12. **Unit Rates** - Cost per item, speed per hour, etc.

### Money-Specific Skills (Years 1-6)
13. **Coin Recognition** - Identifying coins and notes
14. **Change Calculation** - Working out change from purchases
15. **Money Combinations** - Different ways to make the same amount
16. **Mixed Money Units** - Working with pounds and pence together
17. **Money Fractions** - Fractional amounts of money
18. **Money Scaling** - Proportional money problems
19. **Counting** - Coin counting and combinations

---

## UK National Curriculum Alignment

### Year-by-Year Progression

**Years 1-2 (Ages 5-7):**
- Simple addition and subtraction
- Recognising coins and notes
- Basic money problems
- Counting in different steps

**Years 3-4 (Ages 7-9):**
- Multiplication and division
- Fractions of amounts
- Mixed pounds and pence
- Change calculation
- Harder problem-solving

**Years 5-6 (Ages 9-11):**
- Complex multi-step problems
- Percentages and scaling
- Advanced fractions
- Rate problems
- Real-world applications

### Automatic Difficulty Scaling

The system automatically adjusts:
- **Number sizes** (Year 1: numbers to 20, Year 6: numbers to millions)
- **Decimal places** (Year 2: whole numbers, Year 5: 2 decimal places)
- **Problem complexity** (Year 1: single step, Year 6: multiple steps)
- **Mathematical concepts** (Year 1: basic addition, Year 6: algebra)

---

## How Questions Are Generated

### Step 1: Choose the Mathematics
The system selects:
- Which type of calculation (addition, multiplication, etc.)
- What year level difficulty
- Specific mathematical parameters

### Step 2: Generate the Calculation  
The Math Engine creates:
- Appropriate numbers for the year group
- Correct mathematical relationships
- Proper difficulty level

### Step 3: Add the Story Context
The Story Engine:
- Chooses a relevant scenario (shopping, sharing, etc.)
- Writes the question in child-friendly language
- Ensures the context makes sense

### Step 4: Create the Complete Question
Final result includes:
- The story problem
- The correct answer
- All working steps
- Technical details for teachers

---

## Question Quality Features

### Educational Accuracy
- Every question follows UK National Curriculum requirements exactly
- Proper mathematical progression between year groups
- Age-appropriate vocabulary and contexts

### Infinite Variety
- No two questions are exactly the same
- Endless practice without repetition
- Fresh problems every time

### Real-World Relevance
- Uses scenarios children understand
- Practical applications of mathematics
- Engaging contexts that motivate learning

### Perfect Difficulty Matching
- Automatically adjusts to year level
- Can be fine-tuned for individual needs
- Smooth progression from easy to challenging

---

## How Teachers Can Use It

### For Lesson Planning
- Generate exactly the right questions for today's topic
- Create homework sets tailored to each child's level  
- Prepare extra practice for children who need it

### For Assessment
- Create unique test papers instantly
- Generate different versions of the same assessment
- Track which mathematical skills need more work

### For Differentiation
- Easy questions for children who struggle
- Challenging problems for high achievers
- Same mathematical concept, different difficulty levels

### For Practice
- Endless practice questions
- No need to search for suitable problems
- Always fresh, never repetitive

---

## How Parents Can Use It

### Homework Support
- Generate extra practice when children need it
- Find questions at exactly the right level
- Help children who want more challenge

### Understanding Progression
- See what your child should be learning
- Understand how maths skills build up
- Support learning at home effectively

### Building Confidence
- Start with easier questions to build success
- Gradually increase difficulty
- Celebrate progress step by step

---

## The Technology Behind It (Simplified)

### Web-Based System
- Works on any computer, tablet, or phone
- No software to install
- Always up-to-date automatically

### Instant Generation
- Questions appear in seconds
- No waiting or loading delays  
- Unlimited usage

### Quality Assured
- Every calculation is mathematically correct
- All questions follow curriculum standards
- Consistent quality every time

### User-Friendly Interface
- Simple controls anyone can use
- Clear, easy-to-read questions
- Professional presentation

---

## Benefits for Learning

### For Children
- **Engagement**: Interesting stories make maths feel relevant
- **Confidence**: Perfect difficulty matching builds success
- **Variety**: Never boring, always fresh problems
- **Understanding**: Real contexts help mathematical concepts click

### For Educators  
- **Time-Saving**: No more searching for suitable questions
- **Flexibility**: Generate exactly what you need, when you need it
- **Quality**: Professional, curriculum-aligned content
- **Differentiation**: Easy to match individual needs

### For Schools
- **Consistency**: Same high standards across all classes
- **Efficiency**: One resource covers all mathematical topics
- **Cost-Effective**: Unlimited questions for all teachers
- **Future-Proof**: Automatically stays current with curriculum changes

---

## Getting Started

### For Teachers
1. Choose the mathematical topic you're teaching
2. Select the appropriate year group
3. Generate questions instantly
4. Use in lessons, homework, or assessments

### For Parents
1. Identify what your child is learning in school
2. Select that topic and year level
3. Generate practice questions
4. Work through them together

### For Curriculum Leaders
1. Explore the full range of mathematical coverage
2. See how topics progress through the years
3. Use for planning and resource development
4. Share with teaching teams

---

## The Future of Mathematics Education

Factory Architect represents a new approach to mathematics resources:

**Traditional Approach:**
- Fixed sets of questions in textbooks
- Same problems used repeatedly
- One size fits all
- Limited variety

**Factory Architect Approach:**
- Unlimited unique questions
- Perfect difficulty matching
- Infinite variety and practice
- Always engaging and relevant

This shift from static resources to intelligent generation means:
- Children never get bored with repetitive questions
- Every practice session is fresh and engaging
- Teachers have unlimited flexibility in their planning
- Parents can always find appropriate support materials

---

## Summary

Factory Architect transforms mathematics education by combining:
- **Perfect mathematical accuracy** with **engaging storytelling**
- **Unlimited question variety** with **precise difficulty control**  
- **Complete curriculum coverage** with **individual flexibility**
- **Professional quality** with **effortless ease of use**

The result is a powerful tool that makes mathematics more engaging for children, more manageable for teachers, and more supportive for parents - while maintaining the highest educational standards throughout.

Whether you're planning lessons, setting homework, supporting struggling learners, or challenging high achievers, Factory Architect provides exactly the right mathematical questions at exactly the right level, every time.
```
--- END FILE: Factory_Architect_User_Guide.md ---

--- START FILE: FACTORY_ARCHITECTURE_FLOW_CHART.md ---
```markdown
# Factory Architect: Visual Architecture Flow Chart
## Question Generation System Overview

**Document Version:** 1.0  
**Last Updated:** September 5, 2025  

---

## Executive Summary

This document provides a comprehensive visual mapping of how Factory Architect's mathematical models are orchestrated to generate educational questions. The system follows a **two-engine architecture** that separates mathematical computation from narrative storytelling.

---

## 🏗️ High-Level Architecture Flow

```
┌─────────────────┐    ┌──────────────────┐    ┌─────────────────┐
│   USER REQUEST  │ ───▶│  API ENDPOINT    │ ───▶│  FINAL QUESTION │
│                 │    │  /api/generate   │    │  WITH ANSWER    │
└─────────────────┘    └──────────────────┘    └─────────────────┘
         │                       │                       ▲
         │                       ▼                       │
         │              ┌──────────────────┐              │
         │              │  ORCHESTRATION   │              │
         │              │     LAYER        │              │
         │              └──────────────────┘              │
         │                       │                       │
         │                       ▼                       │
         │              ┌──────────────────┐              │
         │              │   MATH ENGINE    │              │
         │              │   (Pure Logic)   │              │
         │              └──────────────────┘              │
         │                       │                       │
         │                       ▼                       │
         │              ┌──────────────────┐              │
         │              │   STORY ENGINE   │              │
         │              │ (Narrative Wrap) │              │
         │              └──────────────────┘              │
         │                       │                       │
         └───────────────────────┴───────────────────────┘
```

---

## 📊 Detailed System Flow Diagram

### Phase 1: Request Processing
```
┌──────────────────────────────────────────────────────────────┐
│                    API REQUEST PROCESSING                     │
├──────────────────────────────────────────────────────────────┤
│                                                              │
│  User/Test Interface                                         │
│  ┌─────────────────┐                                         │
│  │   POST Request  │ ──────┐                                 │
│  │   {             │       │                                 │
│  │   model_id,     │       │                                 │
│  │   year_level,   │       ▼                                 │
│  │   context_type, │  ┌─────────────────┐                   │
│  │   difficulty_   │  │  VALIDATION     │                   │
│  │   params        │  │  - Check model  │                   │
│  │   }             │  │    exists       │                   │
│  └─────────────────┘  │  - Validate     │                   │
│                       │    parameters   │                   │
│                       └─────────────────┘                   │
│                                │                            │
│                                ▼                            │
│                       ┌─────────────────┐                   │
│                       │   ROUTE TO      │                   │
│                       │  MATH ENGINE    │                   │
│                       └─────────────────┘                   │
└──────────────────────────────────────────────────────────────┘
```

### Phase 2: Math Engine Processing
```
┌────────────────────────────────────────────────────────────────┐
│                      MATH ENGINE LAYER                        │
├────────────────────────────────────────────────────────────────┤
│                                                                │
│  ┌─────────────────┐           ┌─────────────────┐             │
│  │  MODEL REGISTRY │           │ DIFFICULTY      │             │
│  │  [18 Models]    │ ─────────▶│ PRESET SYSTEM   │             │
│  │                 │           │                 │             │
│  │ • ADDITION      │           │ Year 1-6        │             │
│  │ • SUBTRACTION   │           │ Parameters      │             │
│  │ • MULTIPLICATION│           │ • max_value     │             │
│  │ • DIVISION      │           │ • decimal_places│             │
│  │ • PERCENTAGE    │           │ • min_value     │             │
│  │ • FRACTION      │           │ • operations    │             │
│  │ • ... (13 more) │           │                 │             │
│  └─────────────────┘           └─────────────────┘             │
│           │                            │                       │
│           ▼                            ▼                       │
│  ┌─────────────────────────────────────────────┐               │
│  │          INDIVIDUAL MODEL EXECUTION          │               │
│  │                                             │               │
│  │  Example: ADDITION Model                    │               │
│  │  ┌─────────────────────────────────────┐    │               │
│  │  │ 1. Generate random operands         │    │               │
│  │  │ 2. Apply year-level constraints     │    │               │
│  │  │ 3. Perform mathematical operation   │    │               │
│  │  │ 4. Format outputs (decimal, whole)  │    │               │
│  │  │ 5. Create structured result object  │    │               │
│  │  └─────────────────────────────────────┘    │               │
│  └─────────────────────────────────────────────┘               │
│                           │                                    │
│                           ▼                                    │
│  ┌─────────────────────────────────────────────┐               │
│  │          MATH OUTPUT STRUCTURE              │               │
│  │                                             │               │
│  │  {                                          │               │
│  │    operation: "ADDITION",                   │               │
│  │    operands: [12, 8],                       │               │
│  │    result: 20,                              │               │
│  │    decimal_formatted: {                     │               │
│  │      operands: ["12.00", "8.00"],           │               │
│  │      result: "20.00"                        │               │
│  │    },                                       │               │
│  │    difficulty_level: 3,                     │               │
│  │    working: [...steps...]                   │               │
│  │  }                                          │               │
│  └─────────────────────────────────────────────┘               │
└────────────────────────────────────────────────────────────────┘
```

### Phase 3: Story Engine Processing
```
┌──────────────────────────────────────────────────────────────────┐
│                      STORY ENGINE LAYER                         │
├──────────────────────────────────────────────────────────────────┤
│                                                                  │
│  Math Output           Context Generator                         │
│  ┌─────────────────┐   ┌─────────────────┐                      │
│  │ Pure Numbers    │──▶│  MONEY CONTEXT  │                      │
│  │ & Operations    │   │                 │                      │
│  │                 │   │ • Random person │                      │
│  │ result: 20      │   │ • Shop scenario │                      │
│  │ operands:[12,8] │   │ • Item types    │                      │
│  │ operation: ADD  │   │ • Currency: £   │                      │
│  └─────────────────┘   └─────────────────┘                      │
│          │                       │                              │
│          └───────────┬───────────┘                              │
│                      ▼                                          │
│  ┌─────────────────────────────────────────────┐                │
│  │          STORY ENGINE PROCESSOR             │                │
│  │                                             │                │
│  │  1. Match Operation to Template             │                │
│  │     - isAdditionOutput() ──▶ Template A    │                │
│  │     - isSubtractionOutput() ──▶ Template B │                │
│  │     - etc.                                  │                │
│  │                                             │                │
│  │  2. Inject Context Variables                │                │
│  │     - Replace {person} with "Sarah"         │                │
│  │     - Replace {items} with ["apple","pen"]  │                │
│  │     - Format money with £ symbol            │                │
│  │                                             │                │
│  │  3. Generate Question Text                  │                │
│  │  4. Generate Answer Text                    │                │
│  └─────────────────────────────────────────────┘                │
│                      │                                          │
│                      ▼                                          │
│  ┌─────────────────────────────────────────────┐                │
│  │            STORY OUTPUT                     │                │
│  │                                             │                │
│  │  Question: "Sarah goes to the shop and     │                │
│  │  buys an apple for £12.00 and a pen for    │                │
│  │  £8.00. How much does Sarah spend in       │                │
│  │  total?"                                    │                │
│  │                                             │                │
│  │  Answer: "£20.00"                           │                │
│  └─────────────────────────────────────────────┘                │
└──────────────────────────────────────────────────────────────────┘
```

### Phase 4: Response Assembly
```
┌────────────────────────────────────────────────────────────────┐
│                    RESPONSE ASSEMBLY                           │
├────────────────────────────────────────────────────────────────┤
│                                                                │
│  Story Output + Math Output + Metadata                        │
│  ┌─────────────┐ ┌─────────────┐ ┌─────────────┐              │
│  │ question:   │ │ math_output:│ │ metadata:   │              │
│  │ "Sarah..."  │ │ {operands,  │ │ {model_id,  │              │
│  │             │ │  result,    │ │  year_level,│              │
│  │ answer:     │ │  working}   │ │  timestamp} │              │
│  │ "£20.00"    │ │             │ │             │              │
│  └─────────────┘ └─────────────┘ └─────────────┘              │
│                                │                              │
│                                ▼                              │
│              ┌─────────────────────────────────────┐          │
│              │        FINAL JSON RESPONSE          │          │
│              │                                     │          │
│              │  {                                  │          │
│              │    "question": "Sarah goes to...",  │          │
│              │    "answer": "£20.00",              │          │
│              │    "math_output": {...},            │          │
│              │    "context": {...},                │          │
│              │    "metadata": {...}                │          │
│              │  }                                  │          │
│              └─────────────────────────────────────┘          │
│                                │                              │
│                                ▼                              │
│              ┌─────────────────────────────────────┐          │
│              │       RETURN TO USER/UI             │          │
│              └─────────────────────────────────────┘          │
└────────────────────────────────────────────────────────────────┘
```

---

## 🔄 Component Interaction Map

### File System Mapping
```
📁 Factory Architect Root
│
├── 🌐 API Layer (app/api/generate/route.ts)
│   │
│   ├──▶ 🧮 Math Engine (lib/math-engine/)
│   │   │
│   │   ├── 📋 index.ts (Model Registry & Orchestrator)
│   │   │   ├── mathModels{} ──▶ 18 Model Instances
│   │   │   ├── getModel() ──▶ Retrieve Specific Model
│   │   │   └── generateMathQuestion() ──▶ Execute Model
│   │   │
│   │   ├── 📁 models/ (Individual Model Files)
│   │   │   ├── addition.model.ts
│   │   │   ├── subtraction.model.ts
│   │   │   ├── multiplication.model.ts
│   │   │   ├── division.model.ts
│   │   │   ├── ... (14 more models)
│   │   │   └── money-scaling.model.ts
│   │   │
│   │   └── 📊 difficulty.ts (Year-Level Presets)
│   │
│   └──▶ 📚 Story Engine (lib/story-engine/)
│       │
│       ├── 📝 story.engine.ts (Main Story Processor)
│       │   ├── generateQuestion() ──▶ Text Generation
│       │   ├── generateAnswer() ──▶ Answer Formatting
│       │   └── Operation Type Matching ──▶ Template Selection
│       │
│       └── 📁 contexts/ (Story Context Generators)
│           └── money.context.ts ──▶ Money Scenarios
│
├── 🧪 Testing Interface (app/test/page.tsx)
│   ├── Model Selection UI
│   ├── Parameter Controls
│   ├── Real-time Generation
│   └── Question Preview
│
├── 📊 Status Tracking (lib/models/model-status.ts)
│   └── MODEL_STATUS_REGISTRY ──▶ Completion Tracking
│
└── 🎯 Curriculum Integration (lib/curriculum/)
    ├── curriculum-parser.ts ──▶ UK Curriculum Data
    ├── curriculum-model-mapping.ts ──▶ Curriculum ↔ Model Links
    └── national_curriculum_framework.json ──▶ Raw Curriculum Data
```

---

## ⚙️ Individual Model Architecture

### Model Structure Pattern
All 18 mathematical models follow this standardized interface:

```typescript
┌─────────────────────────────────────────────────────────────────┐
│                    INDIVIDUAL MODEL STRUCTURE                  │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  export class ExampleModel implements MathModel {               │
│                                                                 │
│    // 1. DIFFICULTY PARAMETERS                                  │
│    getDefaultParams(year: number) {                             │
│      return DifficultyPresets.getPreset('EXAMPLE', year);       │
│    }                                                            │
│                                                                 │
│    // 2. CORE GENERATION LOGIC                                  │
│    generate(params: ExampleParams): ExampleOutput {             │
│      ┌─────────────────────────────────────────┐               │
│      │  Step 1: Generate Random Values        │               │
│      │  - Use params.max_value                 │               │
│      │  - Apply year-level constraints         │               │
│      │  - Ensure educational appropriateness   │               │
│      └─────────────────────────────────────────┘               │
│                            │                                   │
│      ┌─────────────────────▼───────────────────┐               │
│      │  Step 2: Perform Mathematics            │               │
│      │  - Execute core operation               │               │
│      │  - Handle edge cases                    │               │
│      │  - Generate working steps               │               │
│      └─────────────────────────────────────────┘               │
│                            │                                   │
│      ┌─────────────────────▼───────────────────┐               │
│      │  Step 3: Format Outputs                 │               │
│      │  - Create decimal representations       │               │
│      │  - Generate multiple answer formats     │               │
│      │  - Structure return object              │               │
│      └─────────────────────────────────────────┘               │
│                            │                                   │
│                            ▼                                   │
│      return {                                                  │
│        operation: 'EXAMPLE',                                   │
│        inputs: [...],                                          │
│        result: number,                                         │
│        decimal_formatted: {...},                               │
│        working: [...],                                         │
│        difficulty_level: number                                │
│      };                                                        │
│    }                                                           │
│  }                                                             │
└─────────────────────────────────────────────────────────────────┘
```

### Example Model Flow: ADDITION
```
INPUT PARAMETERS          PROCESSING STEPS              OUTPUT STRUCTURE
┌─────────────────┐       ┌─────────────────┐          ┌─────────────────┐
│ {               │       │ 1. Generate     │          │ {               │
│   max_value: 50,│  ────▶│    Random Nums  │ ────────▶│   operation:    │
│   min_value: 1, │       │    [12, 8]      │          │   "ADDITION",   │
│   decimal_      │       │                 │          │   operands:     │
│   places: 0,    │       │ 2. Add Numbers  │          │   [12, 8],      │
│   operands: 2   │       │    12 + 8 = 20  │          │   result: 20,   │
│ }               │       │                 │          │   working: [    │
└─────────────────┘       │ 3. Format       │          │     "12 + 8",   │
                          │    "12.00" +    │          │     "= 20"      │
                          │    "8.00" =     │          │   ],            │
                          │    "20.00"      │          │   decimal_      │
                          └─────────────────┘          │   formatted: {  │
                                                       │     operands:   │
                                                       │     ["12.00",   │
                                                       │      "8.00"],   │
                                                       │     result:     │
                                                       │     "20.00"     │
                                                       │   }             │
                                                       │ }               │
                                                       └─────────────────┘
```

---

## 🎭 Story Engine Template System

### Template Matching Logic
```
┌─────────────────────────────────────────────────────────────────┐
│                    STORY TEMPLATE SELECTION                     │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  Math Output Analysis:                                          │
│  ┌─────────────────┐      ┌─────────────────┐                  │
│  │ operation:      │ ────▶│ Template Router │                  │
│  │ "ADDITION"      │      │                 │                  │
│  └─────────────────┘      │ if isAddition() │                  │
│                           │   return        │                  │
│                           │   generateAdd   │                  │
│  ┌─────────────────┐      │   Question()    │                  │
│  │ context:        │ ────▶│                 │                  │
│  │ {               │      │ Templates:      │                  │
│  │   unit_type:    │      │ • Shopping      │                  │
│  │   "currency",   │      │ • Generic Math  │                  │
│  │   person:       │      │ • Measurement   │                  │
│  │   "Sarah"       │      │ • Time-based    │                  │
│  │ }               │      └─────────────────┘                  │
│  └─────────────────┘               │                           │
│                                    ▼                           │
│  ┌─────────────────────────────────────────────┐               │
│  │           TEMPLATE EXECUTION                │               │
│  │                                             │               │
│  │  Currency + Addition = Shopping Template:   │               │
│  │                                             │               │
│  │  `${person} goes to the shop and buys      │               │
│  │   ${purchases.join(', ')}. How much does   │               │
│  │   ${person} spend in total?`               │               │
│  │                                             │               │
│  │  Variable Substitution:                     │               │
│  │  • person ──▶ "Sarah"                       │               │
│  │  • purchases ──▶ ["apple for £12", "pen    │               │
│  │                   for £8"]                  │               │
│  │                                             │               │
│  │  Result:                                    │               │
│  │  "Sarah goes to the shop and buys an       │               │
│  │   apple for £12.00 and a pen for £8.00.    │               │
│  │   How much does Sarah spend in total?"      │               │
│  └─────────────────────────────────────────────┘               │
└─────────────────────────────────────────────────────────────────┘
```

### Context Generation System
```
┌─────────────────────────────────────────────────────────────────┐
│                     CONTEXT GENERATION                         │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  MoneyContextGenerator.generate("ADDITION"):                    │
│                                                                 │
│  ┌─────────────────┐    ┌─────────────────┐                    │
│  │ Random Elements │    │  Context Object │                    │
│  │                 │    │                 │                    │
│  │ • Person: from  │───▶│ {               │                    │
│  │   ["Sarah",     │    │   unit_type:    │                    │
│  │    "Tom",       │    │   "currency",   │                    │
│  │    "Emma"]      │    │   unit_symbol:  │                    │
│  │                 │    │   "£",          │                    │
│  │ • Items: from   │    │   person:       │                    │
│  │   ["apple",     │    │   "Sarah",      │                    │
│  │    "pen",       │    │   item_         │                    │
│  │    "book"]      │    │   descriptors:  │                    │
│  │                 │    │   ["apple",     │                    │
│  │ • Scenario:     │    │    "pen"],      │                    │
│  │   "shopping"    │    │   scenario_     │                    │
│  └─────────────────┘    │   type:         │                    │
│                         │   "shopping"    │                    │
│                         │ }               │                    │
│                         └─────────────────┘                    │
└─────────────────────────────────────────────────────────────────┘
```

---

## 🔧 Testing and Development Flow

### Web Interface Integration (`/test`)
```
┌─────────────────────────────────────────────────────────────────┐
│                      TESTING INTERFACE                         │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  User Interaction:                                              │
│  ┌─────────────────┐    ┌─────────────────┐                    │
│  │ 1. Select Model │───▶│ 2. Choose Year  │                    │
│  │   "ADDITION"    │    │    Level: 4     │                    │
│  └─────────────────┘    └─────────────────┘                    │
│           │                       │                            │
│           ▼                       ▼                            │
│  ┌─────────────────┐    ┌─────────────────┐                    │
│  │ 3. Adjust       │    │ 4. Generate     │                    │
│  │   Parameters    │───▶│   Question      │                    │
│  │   max_value: 50 │    │                 │                    │
│  └─────────────────┘    └─────────────────┘                    │
│                                   │                            │
│                                   ▼                            │
│  ┌─────────────────────────────────────────────┐               │
│  │           API CALL TO /api/generate         │               │
│  │                                             │               │
│  │  POST {                                     │               │
│  │    model_id: "ADDITION",                    │               │
│  │    year_level: 4,                           │               │
│  │    difficulty_params: {                     │               │
│  │      max_value: 50,                         │               │
│  │      min_value: 1,                          │               │
│  │      decimal_places: 0                      │               │
│  │    },                                       │               │
│  │    context_type: "money"                    │               │
│  │  }                                          │               │
│  └─────────────────────────────────────────────┘               │
│                                   │                            │
│                                   ▼                            │
│  ┌─────────────────────────────────────────────┐               │
│  │              UI DISPLAY                     │               │
│  │                                             │               │
│  │  Question: "Sarah goes to the shop..."      │               │
│  │  Answer: "£20.00" (Hidden until revealed)   │               │
│  │  Debug Info: Math output, context, timing   │               │
│  │  History: Previous 5 generated questions    │               │
│  └─────────────────────────────────────────────┘               │
└─────────────────────────────────────────────────────────────────┘
```

---

## 🎯 Model Status Integration

### Registry-Based Status Tracking
```
┌─────────────────────────────────────────────────────────────────┐
│                    MODEL STATUS SYSTEM                         │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  MODEL_STATUS_REGISTRY (lib/models/model-status.ts):           │
│                                                                 │
│  ┌─────────────────┐    ┌─────────────────┐                    │
│  │ ADDITION: {     │    │ Status Icons:   │                    │
│  │   status:       │───▶│ ✅ COMPLETE     │                    │
│  │   "complete",   │    │ 🚧 WIP          │                    │
│  │   years: [1-6], │    │ ❌ BROKEN       │                    │
│  │   curriculum:   │    │ 📋 PLANNED      │                    │
│  │   [...areas]    │    └─────────────────┘                    │
│  │ }               │                                           │
│  └─────────────────┘    ┌─────────────────┐                    │
│           │             │ Testing UI      │                    │
│           └────────────▶│ Shows status    │                    │
│                         │ per model       │                    │
│                         │ Color coding    │                    │
│                         │ Issue tracking  │                    │
│                         └─────────────────┘                    │
│                                                                 │
│  Integration Points:                                            │
│  • Test Interface ──▶ Filters by status                        │
│  • API Validation ──▶ Blocks broken models (optional)          │
│  • Documentation ──▶ Auto-generates status reports             │
│  • CI/CD Pipeline ──▶ Tracks completion progress               │
└─────────────────────────────────────────────────────────────────┘
```

---

## 🚀 Curriculum Integration Flow

### UK National Curriculum Mapping
```
┌─────────────────────────────────────────────────────────────────┐
│                    CURRICULUM INTEGRATION                       │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  Data Flow:                                                     │
│                                                                 │
│  ┌─────────────────┐    ┌─────────────────┐                    │
│  │ Raw Curriculum  │───▶│ Curriculum      │                    │
│  │ JSON Data       │    │ Parser          │                    │
│  │                 │    │                 │                    │
│  │ 174 distinct    │    │ • getStrands()  │                    │
│  │ requirements    │    │ • getSubstrands │                    │
│  │ across 9        │    │ • getYearContent│                    │
│  │ strands         │    │ • searchBy      │                    │
│  │                 │    │   Keywords()    │                    │
│  └─────────────────┘    └─────────────────┘                    │
│                                   │                            │
│                                   ▼                            │
│  ┌─────────────────┐    ┌─────────────────┐                    │
│  │ Model-Curriculum│───▶│ Test Interface  │                    │
│  │ Mapping         │    │ Curriculum Mode │                    │
│  │                 │    │                 │                    │
│  │ • Direct maps   │    │ 1. Select       │                    │
│  │ • Keyword maps  │    │    Strand       │                    │
│  │ • Suggested     │    │ 2. Pick         │                    │
│  │   models per    │    │    Substrand    │                    │
│  │   curriculum    │    │ 3. Choose Year  │                    │
│  │   area          │    │ 4. Get suggested│                    │
│  └─────────────────┘    │    models       │                    │
│                         │ 5. Generate     │                    │
│                         │    aligned      │                    │
│                         │    questions    │                    │
│                         └─────────────────┘                    │
└─────────────────────────────────────────────────────────────────┘
```

---

## 🔧 Development and Extension Guidelines

### Adding a New Model
```
┌─────────────────────────────────────────────────────────────────┐
│                    NEW MODEL CREATION FLOW                     │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  Step 1: Create Model File                                      │
│  ┌─────────────────────────────────────────────────────────────┐ │
│  │ lib/math-engine/models/your-model.model.ts                 │ │
│  │                                                             │ │
│  │ • Implement MathModel interface                             │ │
│  │ • Define parameter types                                    │ │
│  │ • Create generate() method                                  │ │
│  │ • Add getDefaultParams() method                             │ │
│  │ • Follow naming conventions                                 │ │
│  └─────────────────────────────────────────────────────────────┘ │
│                                │                                │
│                                ▼                                │
│  Step 2: Register Model                                         │
│  ┌─────────────────────────────────────────────────────────────┐ │
│  │ lib/math-engine/index.ts                                    │ │
│  │                                                             │ │
│  │ • Import your model                                         │ │
│  │ • Add to mathModels registry                                │ │
│  │ • Export model class                                        │ │
│  └─────────────────────────────────────────────────────────────┘ │
│                                │                                │
│                                ▼                                │
│  Step 3: Add Story Templates                                    │
│  ┌─────────────────────────────────────────────────────────────┐ │
│  │ lib/story-engine/story.engine.ts                            │ │
│  │                                                             │ │
│  │ • Add operation detection                                   │ │
│  │ • Create question generation method                         │ │
│  │ • Create answer generation method                           │ │
│  │ • Handle different context types                            │ │
│  └─────────────────────────────────────────────────────────────┘ │
│                                │                                │
│                                ▼                                │
│  Step 4: Update Status Registry                                 │
│  ┌─────────────────────────────────────────────────────────────┐ │
│  │ lib/models/model-status.ts                                  │ │
│  │                                                             │ │
│  │ • Add model entry to MODEL_STATUS_REGISTRY                  │ │
│  │ • Define curriculum areas                                   │ │
│  │ • Set initial status (WIP)                                  │ │
│  │ • Add supported years                                       │ │
│  └─────────────────────────────────────────────────────────────┘ │
│                                │                                │
│                                ▼                                │
│  Step 5: Test and Validate                                      │
│  ┌─────────────────────────────────────────────────────────────┐ │
│  │ Use /test interface to:                                     │ │
│  │                                                             │ │
│  │ • Test model generation                                     │ │
│  │ • Validate parameters                                       │ │
│  │ • Check question quality                                    │ │
│  │ • Verify curriculum alignment                               │ │
│  │ • Update status to COMPLETE                                 │ │
│  └─────────────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────────┘
```

---

## 📋 Key Integration Points Summary

| **Component** | **File** | **Primary Function** | **Integration** |
|---------------|----------|---------------------|-----------------|
| **API Layer** | `app/api/generate/route.ts` | Request handling | Orchestrates entire flow |
| **Math Engine** | `lib/math-engine/index.ts` | Model registry | Routes to specific models |
| **Individual Models** | `lib/math-engine/models/*.ts` | Number generation | Pure mathematical logic |
| **Story Engine** | `lib/story-engine/story.engine.ts` | Text generation | Wraps math in narratives |
| **Context System** | `lib/story-engine/contexts/*.ts` | Scenario creation | Provides story variables |
| **Test Interface** | `app/test/page.tsx` | Development UI | Real-time model testing |
| **Status Registry** | `lib/models/model-status.ts` | Completion tracking | Progress monitoring |
| **Curriculum Data** | `context/national_curriculum_framework.json` | UK standards | Educational alignment |
| **Curriculum Parser** | `lib/curriculum/curriculum-parser.ts` | Data processing | Structured access to standards |
| **Curriculum Mapping** | `lib/curriculum/curriculum-model-mapping.ts` | Model suggestions | Links models to standards |

---

## 🎯 Quick Navigation Links

- **API Endpoint:** [`app/api/generate/route.ts`](app/api/generate/route.ts)
- **Math Engine:** [`lib/math-engine/index.ts`](lib/math-engine/index.ts)  
- **Story Engine:** [`lib/story-engine/story.engine.ts`](lib/story-engine/story.engine.ts)
- **Test Interface:** [`app/test/page.tsx`](app/test/page.tsx)
- **Model Registry:** [`lib/models/model-status.ts`](lib/models/model-status.ts)
- **Implementation Guide:** [`FACTORY_MODEL_IMPLEMENTATION_GUIDE.md`](FACTORY_MODEL_IMPLEMENTATION_GUIDE.md)

---

*This flow chart provides a complete technical overview of how Factory Architect's modular architecture creates contextual mathematical questions through the separation of mathematical logic and narrative storytelling.*
```
--- END FILE: FACTORY_ARCHITECTURE_FLOW_CHART.md ---

--- START FILE: FACTORY_MODEL_IMPLEMENTATION_GUIDE.md ---
```markdown
# Factory Model Implementation Guide
## UK National Curriculum Mathematics Coverage Analysis

**Document Version:** 1.0  
**Last Updated:** September 5, 2025  
**Total Curriculum Requirements:** 174 distinct Strand+Substrand+Year combinations  

---

## Executive Summary

This guide provides a comprehensive analysis of mathematical model implementation progress against UK National Curriculum requirements. Factory Architect currently implements **18 mathematical models** covering a subset of the **174 total curriculum requirements** across 9 curriculum strands and 56 substrands.

### Current Implementation Status
- **✅ COMPLETE Models:** 11 (61% of implemented models)
- **🚧 WORK IN PROGRESS:** 6 (33% of implemented models)  
- **❌ BROKEN Models:** 2 (11% of implemented models)
- **📋 PLANNED Models:** 0

---

## Part 1: Mathematical Model View

### ✅ COMPLETE Models (11)

#### Core Arithmetic Operations
1. **ADDITION** ✅
   - **Status:** Complete | **Years:** 1-6 | **Last Tested:** 2024-09-04
   - **File:** [`lib/math-engine/models/addition.model.ts`](lib/math-engine/models/addition.model.ts)
   - **Registry:** [`lib/models/model-status.ts:26-35`](lib/models/model-status.ts#L26-L35)
   - **Curriculum Coverage:** Addition, subtraction, multiplication and division (calculations)
   - **Notes:** Fully functional with decimal support and carrying

2. **SUBTRACTION** ✅
   - **Status:** Complete | **Years:** 1-6 | **Last Tested:** 2024-09-04
   - **File:** [`lib/math-engine/models/subtraction.model.ts`](lib/math-engine/models/subtraction.model.ts)
   - **Registry:** [`lib/models/model-status.ts:37-46`](lib/models/model-status.ts#L37-L46)
   - **Curriculum Coverage:** Addition, subtraction, multiplication and division (calculations)
   - **Notes:** Fully functional with borrowing and decimal support

3. **MULTIPLICATION** ✅
   - **Status:** Complete | **Years:** 2-6 | **Last Tested:** 2024-09-04
   - **File:** [`lib/math-engine/models/multiplication.model.ts`](lib/math-engine/models/multiplication.model.ts)
   - **Registry:** [`lib/models/model-status.ts:48-57`](lib/models/model-status.ts#L48-L57)
   - **Curriculum Coverage:** Addition, subtraction, multiplication and division (calculations)
   - **Notes:** Supports times tables and complex multiplication

4. **DIVISION** ✅
   - **Status:** Complete | **Years:** 3-6 | **Last Tested:** 2024-09-04
   - **File:** [`lib/math-engine/models/division.model.ts`](lib/math-engine/models/division.model.ts)
   - **Registry:** [`lib/models/model-status.ts:59-68`](lib/models/model-status.ts#L59-L68)
   - **Curriculum Coverage:** Addition, subtraction, multiplication and division (calculations)
   - **Notes:** Handles remainders and decimal division

#### Advanced Mathematical Operations
5. **PERCENTAGE** ✅
   - **Status:** Complete | **Years:** 4-6 | **Last Tested:** 2024-09-04
   - **File:** [`lib/math-engine/models/percentage.model.ts`](lib/math-engine/models/percentage.model.ts)
   - **Registry:** [`lib/models/model-status.ts:70-79`](lib/models/model-status.ts#L70-L79)
   - **Curriculum Coverage:** Fractions (including decimals and percentages)
   - **Notes:** Percentage of amounts, increases, decreases

6. **FRACTION** ✅
   - **Status:** Complete | **Years:** 3-6 | **Last Tested:** 2024-09-04
   - **File:** [`lib/math-engine/models/fraction.model.ts`](lib/math-engine/models/fraction.model.ts)
   - **Registry:** [`lib/models/model-status.ts:82-91`](lib/models/model-status.ts#L82-L91)
   - **Curriculum Coverage:** Fractions (including decimals and percentages)
   - **Notes:** Common fractions with practical applications

7. **MULTI_STEP** ✅
   - **Status:** Complete | **Years:** 4-6 | **Last Tested:** 2024-09-04
   - **File:** [`lib/math-engine/models/multi-step.model.ts`](lib/math-engine/models/multi-step.model.ts)
   - **Registry:** [`lib/models/model-status.ts:138-147`](lib/models/model-status.ts#L138-L147)
   - **Curriculum Coverage:** Addition, subtraction, multiplication and division (calculations)
   - **Notes:** Chains multiple operations successfully

#### Practical Applications
8. **COUNTING** ✅
   - **Status:** Complete | **Years:** 1-4 | **Last Tested:** 2024-09-04
   - **File:** [`lib/math-engine/models/counting.model.ts`](lib/math-engine/models/counting.model.ts)
   - **Registry:** [`lib/models/model-status.ts:93-102`](lib/models/model-status.ts#L93-L102)
   - **Curriculum Coverage:** Number and place value, Measurement
   - **Notes:** UK coin denominations with optimal combinations

9. **TIME_RATE** ✅
   - **Status:** Complete | **Years:** 3-6 | **Last Tested:** 2024-09-04
   - **File:** [`lib/math-engine/models/time-rate.model.ts`](lib/math-engine/models/time-rate.model.ts)
   - **Registry:** [`lib/models/model-status.ts:104-113`](lib/models/model-status.ts#L104-L113)
   - **Curriculum Coverage:** Measurement
   - **Notes:** Savings over time and rate calculations

10. **CONVERSION** ✅
    - **Status:** Complete | **Years:** 3-6 | **Last Tested:** 2024-09-04
    - **File:** [`lib/math-engine/models/conversion.model.ts`](lib/math-engine/models/conversion.model.ts)
    - **Registry:** [`lib/models/model-status.ts:115-124`](lib/models/model-status.ts#L115-L124)
    - **Curriculum Coverage:** Measurement
    - **Notes:** Common UK unit conversions

11. **COMPARISON** ✅
    - **Status:** Complete | **Years:** 4-6 | **Last Tested:** 2024-09-04
    - **File:** [`lib/math-engine/models/comparison.model.ts`](lib/math-engine/models/comparison.model.ts)
    - **Registry:** [`lib/models/model-status.ts:126-135`](lib/models/model-status.ts#L126-L135)
    - **Curriculum Coverage:** Addition, subtraction, multiplication and division (calculations), Measurement
    - **Notes:** Value comparison with reasoning

---

### 🚧 WORK IN PROGRESS Models (6)

#### Money-Based Models (All Need Testing)
12. **COIN_RECOGNITION** 🚧
    - **Status:** WIP | **Years:** 1-3 | **Last Tested:** 2024-09-04
    - **File:** [`lib/math-engine/models/coin-recognition.model.ts`](lib/math-engine/models/coin-recognition.model.ts)
    - **Registry:** [`lib/models/model-status.ts:180-189`](lib/models/model-status.ts#L180-L189)
    - **Curriculum Coverage:** Measurement
    - **Issues:** API timeout issues - needs testing
    - **Priority:** HIGH - Foundation money skills

13. **CHANGE_CALCULATION** 🚧
    - **Status:** WIP | **Years:** 2-5 | **Last Tested:** 2024-09-04
    - **File:** [`lib/math-engine/models/change-calculation.model.ts`](lib/math-engine/models/change-calculation.model.ts)
    - **Registry:** [`lib/models/model-status.ts:191-200`](lib/models/model-status.ts#L191-L200)
    - **Curriculum Coverage:** Measurement
    - **Issues:** API timeout issues - needs testing
    - **Priority:** HIGH - Essential money skills

14. **MONEY_COMBINATIONS** 🚧
    - **Status:** WIP | **Years:** 2-4 | **Last Tested:** 2024-09-04
    - **File:** [`lib/math-engine/models/money-combinations.model.ts`](lib/math-engine/models/money-combinations.model.ts)
    - **Registry:** [`lib/models/model-status.ts:202-211`](lib/models/model-status.ts#L202-L211)
    - **Curriculum Coverage:** Measurement
    - **Issues:** API timeout issues - needs testing
    - **Priority:** MEDIUM - Different ways to make amounts

15. **MIXED_MONEY_UNITS** 🚧
    - **Status:** WIP | **Years:** 3-5 | **Last Tested:** 2024-09-04
    - **File:** [`lib/math-engine/models/mixed-money-units.model.ts`](lib/math-engine/models/mixed-money-units.model.ts)
    - **Registry:** [`lib/models/model-status.ts:213-222`](lib/models/model-status.ts#L213-L222)
    - **Curriculum Coverage:** Measurement
    - **Issues:** API timeout issues - needs testing
    - **Priority:** HIGH - Pounds and pence together

16. **MONEY_FRACTIONS** 🚧
    - **Status:** WIP | **Years:** 4-6 | **Last Tested:** 2024-09-04
    - **File:** [`lib/math-engine/models/money-fractions.model.ts`](lib/math-engine/models/money-fractions.model.ts)
    - **Registry:** [`lib/models/model-status.ts:224-233`](lib/models/model-status.ts#L224-L233)
    - **Curriculum Coverage:** Fractions (including decimals and percentages), Measurement
    - **Issues:** API timeout issues - needs testing
    - **Priority:** MEDIUM - Fractional money amounts

17. **MONEY_SCALING** 🚧
    - **Status:** WIP | **Years:** 5-6 | **Last Tested:** 2024-09-04
    - **File:** [`lib/math-engine/models/money-scaling.model.ts`](lib/math-engine/models/money-scaling.model.ts)
    - **Registry:** [`lib/models/model-status.ts:235-244`](lib/models/model-status.ts#L235-L244)
    - **Curriculum Coverage:** Ratio and proportion, Measurement
    - **Issues:** API timeout issues - needs testing
    - **Priority:** LOW - Advanced proportional problems

---

### ❌ BROKEN Models (2)

18. **LINEAR_EQUATION** ❌
    - **Status:** BROKEN | **Years:** 5-6 | **Last Tested:** 2024-09-04
    - **File:** [`lib/math-engine/models/linear-equation.model.ts`](lib/math-engine/models/linear-equation.model.ts)
    - **Registry:** [`lib/models/model-status.ts:149-162`](lib/models/model-status.ts#L149-L162)
    - **Curriculum Coverage:** Algebra
    - **Issues:** 
      - API requests timeout due to infinite loops
      - generateRandomNumber parameter order issues
      - Needs debugging of slope generation logic
    - **Priority:** HIGH - Year 6 algebra requirements

19. **UNIT_RATE** ❌
    - **Status:** BROKEN | **Years:** 5-6 | **Last Tested:** 2024-09-04
    - **File:** [`lib/math-engine/models/unit-rate.model.ts`](lib/math-engine/models/unit-rate.model.ts)
    - **Registry:** [`lib/models/model-status.ts:164-177`](lib/models/model-status.ts#L164-L177)
    - **Curriculum Coverage:** Ratio and proportion
    - **Issues:**
      - API requests timeout due to infinite loops
      - generateRandomNumber parameter order issues  
      - Target quantity generation problems
    - **Priority:** HIGH - Year 6 ratio and proportion

---

## Part 2: Curriculum View

**Data Sources:**
- **Curriculum Data:** [`context/national_curriculum_framework.json`](context/national_curriculum_framework.json)
- **Model Mapping:** [`lib/curriculum/curriculum-model-mapping.ts`](lib/curriculum/curriculum-model-mapping.ts)
- **Curriculum Parser:** [`lib/curriculum/curriculum-parser.ts`](lib/curriculum/curriculum-parser.ts)
- **Model Status Registry:** [`lib/models/model-status.ts`](lib/models/model-status.ts)

### Curriculum Coverage Analysis

| **Curriculum Strand** | **Substrands** | **Year-Requirements** | **Models Available** | **Coverage Status** |
|------------------------|----------------|----------------------|---------------------|-------------------|
| Number and place value | 6 | 30 | 3 models | 🟡 PARTIAL |
| Addition, subtraction, multiplication and division (calculations) | 9 | 44 | 5 models | 🟢 GOOD |
| Fractions, decimals and percentages | 12 | 39 | 3 models | 🟡 PARTIAL |
| Ratio and proportion | 4 | 4 | 2 models* | 🔴 BROKEN |
| Algebra | 5 | 5 | 1 model* | 🔴 BROKEN |
| Measurement | 9 | 31 | 9 models | 🟢 EXCELLENT |
| Geometry – properties of shapes | 5 | 19 | 0 models | 🔴 MISSING |
| Geometry - position and direction | 3 | 9 | 0 models | 🔴 MISSING |
| Statistics | 3 | 10 | 0 models | 🔴 MISSING |

*Models are implemented but currently broken

---

### 🔴 CRITICAL GAPS - Missing Curriculum Areas

#### Geometry – Properties of Shapes (0 models, 19 requirements)
**📋 NEEDED MODELS:**
- **SHAPE_RECOGNITION** - Years 1-3 (recognise and name common shapes)
  - *File to create:* `lib/math-engine/models/shape-recognition.model.ts`
- **SHAPE_PROPERTIES** - Years 2-6 (describe properties and classify shapes) 
  - *File to create:* `lib/math-engine/models/shape-properties.model.ts`
- **SHAPE_CONSTRUCTION** - Years 2-3, 5-6 (draw and make shapes, relate 2-D to 3-D)
  - *File to create:* `lib/math-engine/models/shape-construction.model.ts`
- **ANGLE_MEASUREMENT** - Years 3-6 (angles – measuring and properties)
  - *File to create:* `lib/math-engine/models/angle-measurement.model.ts`
- **CIRCLE_PROPERTIES** - Year 6 (circles)
  - *File to create:* `lib/math-engine/models/circle-properties.model.ts`

#### Geometry – Position and Direction (0 models, 9 requirements)
**📋 NEEDED MODELS:**
- **PATTERN_RECOGNITION** - Years 2-3 (patterns)
  - *File to create:* `lib/math-engine/models/pattern-recognition.model.ts`
- **POSITION_DIRECTION** - Years 1-2, 4-6 (describe position, direction and movement)
  - *File to create:* `lib/math-engine/models/position-direction.model.ts`
- **COORDINATE_SYSTEM** - Years 4, 6 (co-ordinates)
  - *File to create:* `lib/math-engine/models/coordinate-system.model.ts`

#### Statistics (0 models, 10 requirements)
**📋 NEEDED MODELS:**
- **DATA_INTERPRETATION** - Years 2-6 (interpret and represent data)
  - *File to create:* `lib/math-engine/models/data-interpretation.model.ts`
- **DATA_PROBLEMS** - Years 2-5 (solve problems involving data)
  - *File to create:* `lib/math-engine/models/data-problems.model.ts`
- **MEAN_AVERAGE** - Year 6 (mean average)
  - *File to create:* `lib/math-engine/models/mean-average.model.ts`

---

### 🟡 PARTIAL COVERAGE - Needs Expansion

#### Number and Place Value (Limited models for 30 requirements)
**📋 NEEDED MODELS:**
- **PLACE_VALUE** - Years 2-6 (place value; roman numerals)
  - *File to create:* `lib/math-engine/models/place-value.model.ts`
- **NUMBER_ESTIMATION** - Years 1-6 (identify, represent and estimate; rounding)
  - *File to create:* `lib/math-engine/models/number-estimation.model.ts`
- **NEGATIVE_NUMBERS** - Years 4-6 (negative numbers)
  - *File to create:* `lib/math-engine/models/negative-numbers.model.ts`
- **NUMBER_SEQUENCES** - Years 1-6 (number problems)
  - *File to create:* `lib/math-engine/models/number-sequences.model.ts`

#### Fractions, Decimals and Percentages (Limited models for 39 requirements)
**📋 NEEDED MODELS:**
- **FRACTION_OPERATIONS** - Years 1-6 (comprehensive fraction operations)
  - *File to create:* `lib/math-engine/models/fraction-operations.model.ts`
- **DECIMAL_OPERATIONS** - Years 4-6 (decimal-specific operations)
  - *File to create:* `lib/math-engine/models/decimal-operations.model.ts`
- **FRACTION_DECIMAL_CONVERSION** - Years 4-6 (conversions and equivalence)
  - *File to create:* `lib/math-engine/models/fraction-decimal-conversion.model.ts`

---

## Part 3: Implementation Priorities

### 🚨 IMMEDIATE PRIORITIES (Next Sprint)

1. **Fix Broken Models**
   - ❌ **LINEAR_EQUATION** - Debug infinite loops and parameter issues
     - *Debug file:* [`lib/math-engine/models/linear-equation.model.ts`](lib/math-engine/models/linear-equation.model.ts)
   - ❌ **UNIT_RATE** - Fix timeout and generation problems
     - *Debug file:* [`lib/math-engine/models/unit-rate.model.ts`](lib/math-engine/models/unit-rate.model.ts)

2. **Complete Money Models Testing**  
   - 🚧 **COIN_RECOGNITION** - Test and resolve API timeouts
     - *Test using:* [Web interface `/test`](app/test/page.tsx) with model selection
   - 🚧 **CHANGE_CALCULATION** - Test and resolve API timeouts
     - *Test using:* [Web interface `/test`](app/test/page.tsx) with model selection
   - 🚧 **MIXED_MONEY_UNITS** - Test and resolve API timeouts
     - *Test using:* [Web interface `/test`](app/test/page.tsx) with model selection

### 🎯 SHORT-TERM GOALS (Next 2-3 Sprints)

3. **Foundation Geometry Models**
   - 📋 **SHAPE_RECOGNITION** - Critical for Years 1-3
   - 📋 **SHAPE_PROPERTIES** - Essential for Years 2-6
   - 📋 **POSITION_DIRECTION** - Basic spatial awareness

4. **Advanced Number Operations**
   - 📋 **PLACE_VALUE** - Year 2-6 place value concepts
   - 📋 **NUMBER_ESTIMATION** - Rounding and estimation skills

### 🚀 MEDIUM-TERM GOALS (Next 3-6 Sprints)

5. **Complete Statistics Coverage**
   - 📋 **DATA_INTERPRETATION** - Years 2-6 data handling
   - 📋 **DATA_PROBLEMS** - Problem-solving with data

6. **Advanced Geometry**
   - 📋 **ANGLE_MEASUREMENT** - Years 3-6 angle concepts
   - 📋 **COORDINATE_SYSTEM** - Years 4, 6 coordinate geometry

### 🌟 LONG-TERM VISION (6+ Sprints)

7. **Complete Curriculum Coverage**
   - Achieve 100% coverage of all 174 curriculum requirements
   - Advanced geometry and measurement models
   - Comprehensive assessment and reporting tools

---

## Part 4: Model Development Guidelines

### Development Standards
1. **Model Structure:** Follow atomic model design principles
2. **Year Scaling:** Implement progressive difficulty 1-6
3. **Testing:** Comprehensive unit tests before marking complete
4. **Documentation:** Clear model documentation and examples
5. **API Stability:** Robust error handling and timeout prevention

### Quality Gates
- ✅ **COMPLETE:** Full functionality, tested, documented
- 🚧 **WIP:** Implemented but needs testing/refinement
- ❌ **BROKEN:** Implemented but has known issues
- 📋 **PLANNED:** Identified need, not yet implemented

### Testing Protocol
1. **Web interface testing** at [`/test`](app/test/page.tsx) 
2. **Parameter validation** across year levels
3. **Edge case handling** 
4. **Performance benchmarking**
5. **Curriculum alignment verification** using [`lib/curriculum/curriculum-parser.ts`](lib/curriculum/curriculum-parser.ts)

### Key Development Files
- **Model Templates:** Use existing models as templates (e.g., [`lib/math-engine/models/addition.model.ts`](lib/math-engine/models/addition.model.ts))
- **Type Definitions:** [`lib/types.ts`](lib/types.ts)
- **API Routes:** [`app/api/generate/route.ts`](app/api/generate/route.ts)
- **Test Interface:** [`app/test/page.tsx`](app/test/page.tsx)
- **Model Registry:** [`lib/models/model-status.ts`](lib/models/model-status.ts) - *Update when adding new models*

---

## Conclusion

Factory Architect has a solid foundation with **11 complete models** covering core arithmetic and practical applications. The main priorities are:

1. **Fixing broken models** (2 models) - Critical for Year 6 algebra and ratios
2. **Completing money models** (6 WIP models) - Essential practical skills  
3. **Building geometry models** (8-10 new models needed) - Major curriculum gap
4. **Adding statistics models** (3 new models needed) - Data handling skills

**Target:** Achieve 90%+ curriculum coverage within 12 months through systematic model development and testing.

---

## Quick Reference Links

### Core Development Files
- **Project Instructions:** [`CLAUDE.md`](CLAUDE.md)
- **Implementation Guide:** [`FACTORY_MODEL_IMPLEMENTATION_GUIDE.md`](FACTORY_MODEL_IMPLEMENTATION_GUIDE.md) *(this file)*
- **Model Status Registry:** [`lib/models/model-status.ts`](lib/models/model-status.ts)
- **Curriculum Data:** [`context/national_curriculum_framework.json`](context/national_curriculum_framework.json)

### Testing & Development
- **Test Interface:** [`app/test/page.tsx`](app/test/page.tsx) - Access at `localhost:3000/test`
- **API Generation:** [`app/api/generate/route.ts`](app/api/generate/route.ts)
- **Type Definitions:** [`lib/types.ts`](lib/types.ts)

### Model Examples (Use as Templates)
- **Simple Model:** [`lib/math-engine/models/addition.model.ts`](lib/math-engine/models/addition.model.ts)
- **Complex Model:** [`lib/math-engine/models/multi-step.model.ts`](lib/math-engine/models/multi-step.model.ts)
- **Money Model:** [`lib/math-engine/models/coin-recognition.model.ts`](lib/math-engine/models/coin-recognition.model.ts)

*This document should be updated after each model completion or major testing cycle.*
```
--- END FILE: FACTORY_MODEL_IMPLEMENTATION_GUIDE.md ---

--- START FILE: lib\curriculum\curriculum-model-mapping.ts ---
```typescript
import { CurriculumFilter } from './curriculum-parser';
import { MODEL_STATUS_REGISTRY, ModelStatusInfo } from '../models/model-status';

/**
 * Maps curriculum areas to appropriate mathematical models
 */
export interface CurriculumModelMapping {
  strand: string;
  substrand: string;
  year: number;
  suggestedModels: string[];
  primaryModel?: string; // Most relevant model for this curriculum area
}

/**
 * Intelligent mapping between curriculum requirements and mathematical models
 */
class CurriculumModelMapper {
  
  /**
   * Get suggested models for a specific curriculum filter
   */
  getSuggestedModels(filter: CurriculumFilter): string[] {
    const { strand, substrand, year, description } = filter;
    const suggestedModels: Set<string> = new Set();

    // Direct mapping based on strand and substrand patterns
    const mappings = this.getDirectMappings();
    
    // Find matching mappings
    mappings.forEach(mapping => {
      if (this.matchesMapping(mapping, strand, substrand, year)) {
        mapping.models.forEach(model => suggestedModels.add(model));
      }
    });

    // Keyword-based mapping from description
    const keywordModels = this.getModelsByKeywords(description, year);
    keywordModels.forEach(model => suggestedModels.add(model));

    // Filter by year appropriateness and model availability
    return Array.from(suggestedModels).filter(modelId => {
      const modelInfo = MODEL_STATUS_REGISTRY[modelId];
      return modelInfo && modelInfo.supportedYears.includes(year);
    });
  }

  /**
   * Get the primary (most relevant) model for a curriculum area
   */
  getPrimaryModel(filter: CurriculumFilter): string | null {
    const suggested = this.getSuggestedModels(filter);
    if (suggested.length === 0) return null;

    // Priority order for primary model selection
    const priorityOrder = [
      'ADDITION', 'SUBTRACTION', 'MULTIPLICATION', 'DIVISION',
      'COIN_RECOGNITION', 'CHANGE_CALCULATION', 'MONEY_COMBINATIONS',
      'FRACTION', 'PERCENTAGE', 'COUNTING', 'TIME_RATE',
      'CONVERSION', 'COMPARISON', 'MIXED_MONEY_UNITS',
      'MONEY_FRACTIONS', 'MONEY_SCALING', 'MULTI_STEP',
      'LINEAR_EQUATION', 'UNIT_RATE'
    ];

    // Return first match from priority order
    for (const modelId of priorityOrder) {
      if (suggested.includes(modelId)) {
        return modelId;
      }
    }

    return suggested[0];
  }

  /**
   * Direct mappings between curriculum areas and models
   */
  private getDirectMappings(): Array<{
    strand?: string;
    substrand?: string;
    yearRange?: [number, number];
    models: string[];
  }> {
    return [
      // Number and place value
      {
        strand: 'Number and place value',
        substrand: 'counting (in multiples)',
        yearRange: [1, 6],
        models: ['COUNTING', 'ADDITION', 'MULTIPLICATION']
      },
      {
        strand: 'Number and place value',
        substrand: 'read, write, order and compare numbers',
        yearRange: [1, 6],
        models: ['COMPARISON', 'ADDITION', 'SUBTRACTION']
      },

      // Addition, subtraction, multiplication and division
      {
        strand: 'Addition, subtraction, multiplication and division (calculations)',
        substrand: 'add / subtract mentally',
        models: ['ADDITION', 'SUBTRACTION']
      },
      {
        strand: 'Addition, subtraction, multiplication and division (calculations)',
        substrand: 'add / subtract using written methods',
        models: ['ADDITION', 'SUBTRACTION', 'MULTI_STEP']
      },
      {
        strand: 'Addition, subtraction, multiplication and division (calculations)',
        substrand: 'multiply / divide mentally',
        models: ['MULTIPLICATION', 'DIVISION']
      },
      {
        strand: 'Addition, subtraction, multiplication and division (calculations)',
        substrand: 'multiply / divide using written methods',
        models: ['MULTIPLICATION', 'DIVISION', 'MULTI_STEP']
      },

      // Fractions
      {
        strand: 'Fractions (including decimals and percentages)',
        substrand: 'fractions',
        models: ['FRACTION', 'MONEY_FRACTIONS']
      },
      {
        strand: 'Fractions (including decimals and percentages)',
        substrand: 'decimals',
        models: ['CONVERSION', 'MIXED_MONEY_UNITS', 'PERCENTAGE']
      },
      {
        strand: 'Fractions (including decimals and percentages)',
        substrand: 'percentages',
        models: ['PERCENTAGE', 'MONEY_SCALING']
      },

      // Measurement - Money
      {
        strand: 'Measurement',
        substrand: 'money',
        models: ['COIN_RECOGNITION', 'CHANGE_CALCULATION', 'MONEY_COMBINATIONS', 'MIXED_MONEY_UNITS', 'MONEY_FRACTIONS', 'MONEY_SCALING']
      },

      // Measurement - Other
      {
        strand: 'Measurement',
        substrand: 'solve problems (a, money; b, length; c, mass / weight; d, capacity / volume)',
        models: ['CHANGE_CALCULATION', 'CONVERSION', 'MULTI_STEP', 'COMPARISON']
      },

      // Ratio and proportion
      {
        strand: 'Ratio and proportion',
        models: ['UNIT_RATE', 'MONEY_SCALING', 'COMPARISON']
      },

      // Algebra
      {
        strand: 'Algebra',
        models: ['LINEAR_EQUATION', 'MULTI_STEP']
      }
    ];
  }

  /**
   * Get models based on keywords in curriculum description
   */
  private getModelsByKeywords(description: string, year: number): string[] {
    const lowerDesc = description.toLowerCase();
    const models: string[] = [];

    // Keywords mapping
    const keywordMappings = [
      { keywords: ['add', 'adding', 'addition', 'sum', 'total', 'altogether'], models: ['ADDITION'] },
      { keywords: ['subtract', 'subtraction', 'minus', 'take away', 'difference'], models: ['SUBTRACTION'] },
      { keywords: ['multiply', 'multiplication', 'times', 'groups of'], models: ['MULTIPLICATION'] },
      { keywords: ['divide', 'division', 'share', 'sharing', 'split'], models: ['DIVISION'] },
      { keywords: ['fraction', 'half', 'quarter', 'third'], models: ['FRACTION', 'MONEY_FRACTIONS'] },
      { keywords: ['percent', 'percentage', '%'], models: ['PERCENTAGE'] },
      { keywords: ['money', 'pounds', 'pence', 'coin', 'note', 'change'], models: ['COIN_RECOGNITION', 'CHANGE_CALCULATION', 'MONEY_COMBINATIONS'] },
      { keywords: ['count', 'counting'], models: ['COUNTING'] },
      { keywords: ['compare', 'order', 'greater', 'less', 'equal'], models: ['COMPARISON'] },
      { keywords: ['measure', 'measurement', 'convert'], models: ['CONVERSION'] },
      { keywords: ['time', 'rate'], models: ['TIME_RATE'] },
      { keywords: ['problem', 'solve'], models: ['MULTI_STEP'] }
    ];

    keywordMappings.forEach(mapping => {
      if (mapping.keywords.some(keyword => lowerDesc.includes(keyword))) {
        mapping.models.forEach(model => {
          const modelInfo = MODEL_STATUS_REGISTRY[model];
          if (modelInfo && modelInfo.supportedYears.includes(year)) {
            models.push(model);
          }
        });
      }
    });

    return [...new Set(models)];
  }

  /**
   * Check if a mapping matches the given criteria
   */
  private matchesMapping(
    mapping: { strand?: string; substrand?: string; yearRange?: [number, number] },
    strand: string,
    substrand: string,
    year: number
  ): boolean {
    // Check strand match
    if (mapping.strand && !strand.toLowerCase().includes(mapping.strand.toLowerCase())) {
      return false;
    }

    // Check substrand match
    if (mapping.substrand && !substrand.toLowerCase().includes(mapping.substrand.toLowerCase())) {
      return false;
    }

    // Check year range
    if (mapping.yearRange) {
      const [minYear, maxYear] = mapping.yearRange;
      if (year < minYear || year > maxYear) {
        return false;
      }
    }

    return true;
  }

  /**
   * Get all models that could be relevant for a curriculum area
   */
  getAllRelevantModels(strand: string): string[] {
    const relevantModels: Set<string> = new Set();
    
    Object.values(MODEL_STATUS_REGISTRY).forEach(model => {
      if (model.curriculumAreas.some(area => 
        area.toLowerCase().includes(strand.toLowerCase()) ||
        strand.toLowerCase().includes(area.toLowerCase())
      )) {
        relevantModels.add(model.id);
      }
    });

    return Array.from(relevantModels);
  }
}

export const curriculumModelMapper = new CurriculumModelMapper();
```
--- END FILE: lib\curriculum\curriculum-model-mapping.ts ---

--- START FILE: lib\curriculum\curriculum-parser.ts ---
```typescript
// Import curriculum data - adjust path as needed
const curriculumData = require('../../context/national_curriculum_framework.json');

export interface CurriculumEntry {
  Strand: string;
  Substrand: string;
  "Content domain reference": string;
  Years: {
    [yearKey: string]: string;
  };
}

export interface CurriculumFilter {
  strand: string;
  substrand: string;
  year: number;
  description: string;
  contentDomainRef: string;
}

export interface ParsedCurriculum {
  strands: string[];
  substrands: { [strand: string]: string[] };
  yearDescriptions: { [key: string]: string };
}

class CurriculumParser {
  private data: CurriculumEntry[];

  constructor() {
    this.data = curriculumData as CurriculumEntry[];
  }

  /**
   * Get all unique strands
   */
  getStrands(): string[] {
    const strands = [...new Set(this.data.map(item => item.Strand))];
    return strands.sort();
  }

  /**
   * Get all substrands for a given strand
   */
  getSubstrands(strand: string): string[] {
    const substrands = this.data
      .filter(item => item.Strand === strand)
      .map(item => item.Substrand);
    return [...new Set(substrands)].sort();
  }

  /**
   * Get available years for a strand/substrand combination
   */
  getAvailableYears(strand: string, substrand: string): number[] {
    const entry = this.data.find(
      item => item.Strand === strand && item.Substrand === substrand
    );
    
    if (!entry) return [];
    
    const years: number[] = [];
    Object.keys(entry.Years).forEach(yearKey => {
      const yearNum = parseInt(yearKey.replace('Year ', ''));
      if (entry.Years[yearKey].trim() !== '') {
        years.push(yearNum);
      }
    });
    
    return years.sort((a, b) => a - b);
  }

  /**
   * Get curriculum description for specific strand/substrand/year
   */
  getCurriculumDescription(strand: string, substrand: string, year: number): CurriculumFilter | null {
    const entry = this.data.find(
      item => item.Strand === strand && item.Substrand === substrand
    );
    
    if (!entry) return null;
    
    const yearKey = `Year ${year}`;
    const description = entry.Years[yearKey];
    
    if (!description || description.trim() === '') return null;
    
    return {
      strand,
      substrand,
      year,
      description: description.trim(),
      contentDomainRef: entry["Content domain reference"]
    };
  }

  /**
   * Get all curriculum entries for easy browsing
   */
  getAllEntries(): CurriculumEntry[] {
    return this.data;
  }

  /**
   * Search curriculum by keywords
   */
  searchCurriculum(searchTerm: string): CurriculumFilter[] {
    const results: CurriculumFilter[] = [];
    const term = searchTerm.toLowerCase();
    
    this.data.forEach(entry => {
      Object.keys(entry.Years).forEach(yearKey => {
        const description = entry.Years[yearKey];
        if (description.toLowerCase().includes(term)) {
          const year = parseInt(yearKey.replace('Year ', ''));
          results.push({
            strand: entry.Strand,
            substrand: entry.Substrand,
            year,
            description: description.trim(),
            contentDomainRef: entry["Content domain reference"]
          });
        }
      });
    });
    
    return results;
  }

  /**
   * Get related curriculum entries (same strand, different substrands)
   */
  getRelatedEntries(strand: string, currentSubstrand?: string): string[] {
    return this.data
      .filter(item => item.Strand === strand && item.Substrand !== currentSubstrand)
      .map(item => item.Substrand);
  }
}

export const curriculumParser = new CurriculumParser();
```
--- END FILE: lib\curriculum\curriculum-parser.ts ---

--- START FILE: lib\math-engine\difficulty.ts ---
```typescript
import {
  AdditionDifficultyParams,
  SubtractionDifficultyParams,
  MultiplicationDifficultyParams,
  DivisionDifficultyParams,
  PercentageDifficultyParams
} from '@/lib/types';

type DifficultyParams = 
  | AdditionDifficultyParams
  | SubtractionDifficultyParams
  | MultiplicationDifficultyParams
  | DivisionDifficultyParams
  | PercentageDifficultyParams;

export class DifficultyPresets {
  static getPreset(modelId: string, year: number): DifficultyParams {
    switch (modelId) {
      case 'ADDITION':
        return this.getAdditionPreset(year);
      case 'SUBTRACTION':
        return this.getSubtractionPreset(year);
      case 'MULTIPLICATION':
        return this.getMultiplicationPreset(year);
      case 'DIVISION':
        return this.getDivisionPreset(year);
      case 'PERCENTAGE':
        return this.getPercentagePreset(year);
      default:
        throw new Error(`Unknown model: ${modelId}`);
    }
  }

  private static getAdditionPreset(year: number): AdditionDifficultyParams {
    const presets: Record<number, AdditionDifficultyParams> = {
      1: {
        operand_count: 2,
        max_value: 10,
        decimal_places: 0,
        allow_carrying: false,
        value_constraints: { min: 1, step: 1 }
      },
      2: {
        operand_count: 2,
        max_value: 20,
        decimal_places: 0,
        allow_carrying: false,
        value_constraints: { min: 1, step: 1 }
      },
      3: {
        operand_count: 3,
        max_value: 100,
        decimal_places: 0,
        allow_carrying: true,
        value_constraints: { min: 1, step: 1 }
      },
      4: {
        operand_count: 3,
        max_value: 100,
        decimal_places: 2,
        allow_carrying: true,
        value_constraints: { min: 0.01, step: 0.01 }
      },
      5: {
        operand_count: 4,
        max_value: 1000,
        decimal_places: 2,
        allow_carrying: true,
        value_constraints: { min: 0.01, step: 0.01 }
      },
      6: {
        operand_count: 5,
        max_value: 10000,
        decimal_places: 3,
        allow_carrying: true,
        value_constraints: { min: 0.001, step: 0.001 }
      }
    };
    return presets[year] || presets[6];
  }

  private static getSubtractionPreset(year: number): SubtractionDifficultyParams {
    const presets: Record<number, SubtractionDifficultyParams> = {
      1: {
        minuend_max: 10,
        subtrahend_max: 10,
        decimal_places: 0,
        allow_borrowing: false,
        ensure_positive: true,
        value_constraints: { step: 1 }
      },
      2: {
        minuend_max: 20,
        subtrahend_max: 20,
        decimal_places: 0,
        allow_borrowing: false,
        ensure_positive: true,
        value_constraints: { step: 1 }
      },
      3: {
        minuend_max: 100,
        subtrahend_max: 100,
        decimal_places: 0,
        allow_borrowing: true,
        ensure_positive: true,
        value_constraints: { step: 1 }
      },
      4: {
        minuend_max: 100,
        subtrahend_max: 100,
        decimal_places: 2,
        allow_borrowing: true,
        ensure_positive: true,
        value_constraints: { step: 0.01 }
      },
      5: {
        minuend_max: 1000,
        subtrahend_max: 1000,
        decimal_places: 2,
        allow_borrowing: true,
        ensure_positive: true,
        value_constraints: { step: 0.01 }
      },
      6: {
        minuend_max: 10000,
        subtrahend_max: 10000,
        decimal_places: 3,
        allow_borrowing: true,
        ensure_positive: true,
        value_constraints: { step: 0.001 }
      }
    };
    return presets[year] || presets[6];
  }

  private static getMultiplicationPreset(year: number): MultiplicationDifficultyParams {
    const presets: Record<number, MultiplicationDifficultyParams> = {
      1: {
        multiplicand_max: 5,
        multiplier_max: 2,
        decimal_places: 0,
        operand_count: 2,
        use_fractions: false
      },
      2: {
        multiplicand_max: 10,
        multiplier_max: 5,
        decimal_places: 0,
        operand_count: 2,
        use_fractions: false
      },
      3: {
        multiplicand_max: 10,
        multiplier_max: 10,
        decimal_places: 0,
        operand_count: 2,
        use_fractions: false
      },
      4: {
        multiplicand_max: 100,
        multiplier_max: 10,
        decimal_places: 0,
        operand_count: 2,
        use_fractions: false
      },
      5: {
        multiplicand_max: 100,
        multiplier_max: 100,
        decimal_places: 2,
        operand_count: 2,
        use_fractions: false
      },
      6: {
        multiplicand_max: 1000,
        multiplier_max: 100,
        decimal_places: 3,
        operand_count: 3,
        use_fractions: true
      }
    };
    return presets[year] || presets[6];
  }

  private static getDivisionPreset(year: number): DivisionDifficultyParams {
    const presets: Record<number, DivisionDifficultyParams> = {
      1: {
        dividend_max: 10,
        divisor_max: 2,
        decimal_places: 0,
        allow_remainder: false,
        ensure_whole: true
      },
      2: {
        dividend_max: 20,
        divisor_max: 5,
        decimal_places: 0,
        allow_remainder: false,
        ensure_whole: true
      },
      3: {
        dividend_max: 100,
        divisor_max: 10,
        decimal_places: 0,
        allow_remainder: false,
        ensure_whole: true
      },
      4: {
        dividend_max: 100,
        divisor_max: 10,
        decimal_places: 0,
        allow_remainder: true,
        ensure_whole: false
      },
      5: {
        dividend_max: 1000,
        divisor_max: 100,
        decimal_places: 2,
        allow_remainder: true,
        ensure_whole: false
      },
      6: {
        dividend_max: 10000,
        divisor_max: 100,
        decimal_places: 3,
        allow_remainder: true,
        ensure_whole: false
      }
    };
    return presets[year] || presets[6];
  }

  private static getPercentagePreset(year: number): PercentageDifficultyParams {
    const presets: Record<number, PercentageDifficultyParams> = {
      4: {
        base_value_max: 100,
        percentage_values: [10, 50, 100],
        operation_type: "of",
        decimal_places: 0
      },
      5: {
        base_value_max: 200,
        percentage_values: [10, 20, 25, 50, 75],
        operation_type: "of",
        decimal_places: 2
      },
      6: {
        base_value_max: 500,
        percentage_values: [5, 10, 15, 20, 25, 30, 40, 50, 75],
        operation_type: "decrease",
        decimal_places: 2
      }
    };
    return presets[year] || presets[6];
  }
}
```
--- END FILE: lib\math-engine\difficulty.ts ---

--- START FILE: lib\math-engine\index.ts ---
```typescript
import { AdditionModel } from './models/addition.model';
import { SubtractionModel } from './models/subtraction.model';
import { MultiplicationModel } from './models/multiplication.model';
import { DivisionModel } from './models/division.model';
import { PercentageModel } from './models/percentage.model';
import { FractionModel } from './models/fraction.model';
import { CountingModel } from './models/counting.model';
import { TimeRateModel } from './models/time-rate.model';
import { ConversionModel } from './models/conversion.model';
import { ComparisonModel } from './models/comparison.model';
import { MultiStepModel } from './models/multi-step.model';
import { LinearEquationModel } from './models/linear-equation.model';
import { UnitRateModel } from './models/unit-rate.model';
import { CoinRecognitionModel } from './models/coin-recognition.model';
import { ChangeCalculationModel } from './models/change-calculation.model';
import { MoneyCombinationsModel } from './models/money-combinations.model';
import { MixedMoneyUnitsModel } from './models/mixed-money-units.model';
import { MoneyFractionsModel } from './models/money-fractions.model';
import { MoneyScalingModel } from './models/money-scaling.model';
import { DifficultyPresets } from './difficulty';

// Model Registry
export const mathModels = {
  ADDITION: new AdditionModel(),
  SUBTRACTION: new SubtractionModel(),
  MULTIPLICATION: new MultiplicationModel(),
  DIVISION: new DivisionModel(),
  PERCENTAGE: new PercentageModel(),
  FRACTION: new FractionModel(),
  COUNTING: new CountingModel(),
  TIME_RATE: new TimeRateModel(),
  CONVERSION: new ConversionModel(),
  COMPARISON: new ComparisonModel(),
  MULTI_STEP: new MultiStepModel(),
  LINEAR_EQUATION: new LinearEquationModel(),
  UNIT_RATE: new UnitRateModel(),
  COIN_RECOGNITION: new CoinRecognitionModel(),
  CHANGE_CALCULATION: new ChangeCalculationModel(),
  MONEY_COMBINATIONS: new MoneyCombinationsModel(),
  MIXED_MONEY_UNITS: new MixedMoneyUnitsModel(),
  MONEY_FRACTIONS: new MoneyFractionsModel(),
  MONEY_SCALING: new MoneyScalingModel()
};

export type ModelId = keyof typeof mathModels;

// Get a specific model
export function getModel(modelId: ModelId) {
  const model = mathModels[modelId];
  if (!model) {
    throw new Error(`Model ${modelId} not found`);
  }
  return model;
}

// Get all available models
export function getAllModels() {
  return Object.keys(mathModels);
}

// Generate a question using a specific model
export function generateMathQuestion(
  modelId: ModelId,
  year?: number,
  customParams?: any
) {
  const model = getModel(modelId);
  const params = customParams || model.getDefaultParams(year || 4);
  return model.generate(params);
}

// Export components
export { DifficultyPresets };
export * from './models/addition.model';
export * from './models/subtraction.model';
export * from './models/multiplication.model';
export * from './models/division.model';
export * from './models/percentage.model';
```
--- END FILE: lib\math-engine\index.ts ---

--- START FILE: lib\math-engine\models\addition.model.ts ---
```typescript
import {
  IMathModel,
  AdditionDifficultyParams,
  AdditionOutput,
  DecimalFormatted
} from '@/lib/types';
import {
  generateRandomNumber,
  formatDecimal,
  requiresCarrying,
  ensureUnique
} from '@/lib/utils';

export class AdditionModel implements IMathModel<AdditionDifficultyParams, AdditionOutput> {
  public readonly model_id = "ADDITION";

  generate(params: AdditionDifficultyParams): AdditionOutput {
    const operands = this.generateOperands(params);
    const result = this.calculateSum(operands);
    const intermediateSteps = this.calculateIntermediateSteps(operands);
    const decimalFormatted = this.formatOutput(operands, result, params.decimal_places);

    return {
      operation: "ADDITION",
      operands,
      result,
      intermediate_steps: intermediateSteps,
      decimal_formatted: decimalFormatted
    };
  }

  getDefaultParams(year: number): AdditionDifficultyParams {
    if (year <= 2) {
      return {
        operand_count: 2,
        max_value: 20,
        decimal_places: 0,
        allow_carrying: false,
        value_constraints: {
          min: 1,
          step: 1
        }
      };
    } else if (year <= 4) {
      return {
        operand_count: 3,
        max_value: 100,
        decimal_places: year === 4 ? 2 : 0,
        allow_carrying: true,
        value_constraints: {
          min: 1,
          step: year === 4 ? 0.01 : 1
        }
      };
    } else {
      return {
        operand_count: 4,
        max_value: 1000,
        decimal_places: 2,
        allow_carrying: true,
        value_constraints: {
          min: 1,
          step: 0.01
        }
      };
    }
  }

  private generateOperands(params: AdditionDifficultyParams): number[] {
    const operands: number[] = [];
    let attempts = 0;
    const maxAttempts = 50;

    while (attempts < maxAttempts) {
      const tempOperands: number[] = [];
      
      for (let i = 0; i < params.operand_count; i++) {
        const value = generateRandomNumber(
          params.max_value,
          params.decimal_places,
          params.value_constraints.min,
          params.value_constraints.step
        );
        tempOperands.push(value);
      }

      // Check carrying requirement
      if (params.allow_carrying || !requiresCarrying(tempOperands)) {
        return tempOperands;
      }

      attempts++;
    }

    // Fallback: return operands regardless of carrying requirement
    return ensureUnique(
      () => generateRandomNumber(
        params.max_value,
        params.decimal_places,
        params.value_constraints.min,
        params.value_constraints.step
      ),
      params.operand_count
    );
  }

  private calculateSum(operands: number[]): number {
    const sum = operands.reduce((acc, val) => acc + val, 0);
    // Handle floating point precision
    return Math.round(sum * 1000) / 1000;
  }

  private calculateIntermediateSteps(operands: number[]): number[] {
    const steps: number[] = [];
    let runningSum = 0;
    
    for (let i = 0; i < operands.length - 1; i++) {
      runningSum += operands[i];
      steps.push(Math.round(runningSum * 1000) / 1000);
    }
    
    return steps;
  }

  private formatOutput(
    operands: number[],
    result: number,
    decimalPlaces: number
  ): DecimalFormatted {
    return {
      operands: operands.map(op => formatDecimal(op, decimalPlaces)),
      result: formatDecimal(result, decimalPlaces)
    };
  }
}
```
--- END FILE: lib\math-engine\models\addition.model.ts ---

--- START FILE: lib\math-engine\models\change-calculation.model.ts ---
```typescript
import {
  IMathModel,
  ChangeCalculationDifficultyParams,
  ChangeCalculationOutput
} from '@/lib/types';
import {
  randomChoice,
  generateRandomNumber
} from '@/lib/utils';

export class ChangeCalculationModel implements IMathModel<ChangeCalculationDifficultyParams, ChangeCalculationOutput> {
  public readonly model_id = "CHANGE_CALCULATION";

  private static readonly COMMON_PAYMENTS = [
    100, 200, 500, 1000, 2000, 5000 // 1p, 2p, 5p, £1, £2, £5 etc in pence
  ];

  private static readonly UK_DENOMINATIONS = [1, 2, 5, 10, 20, 50, 100, 200, 500, 1000, 2000, 5000];

  generate(params: ChangeCalculationDifficultyParams): ChangeCalculationOutput {
    const problemType = this.selectProblemType(params);
    
    switch (problemType) {
      case 'simple_change':
        return this.generateSimpleChangeProblem(params);
      case 'exact_payment':
        return this.generateExactPaymentProblem(params);
      case 'multiple_items':
        return this.generateMultipleItemsProblem(params);
      case 'change_breakdown':
        return this.generateChangeBreakdownProblem(params);
      default:
        return this.generateSimpleChangeProblem(params);
    }
  }

  getDefaultParams(year: number): ChangeCalculationDifficultyParams {
    if (year <= 2) {
      return {
        max_item_cost: 50, // Up to 50p
        payment_methods: [100, 200, 500], // £1, £2, £5
        decimal_places: 0,
        problem_types: ['simple_change', 'exact_payment'],
        include_breakdown: false,
        max_items: 1,
        allow_overpayment: true
      };
    } else if (year <= 3) {
      return {
        max_item_cost: 500, // Up to £5
        payment_methods: [100, 200, 500, 1000, 2000], // £1-£20
        decimal_places: 2,
        problem_types: ['simple_change', 'multiple_items', 'change_breakdown'],
        include_breakdown: true,
        max_items: 3,
        allow_overpayment: true
      };
    } else {
      return {
        max_item_cost: 2000, // Up to £20
        payment_methods: [500, 1000, 2000, 5000], // £5-£50
        decimal_places: 2,
        problem_types: ['simple_change', 'multiple_items', 'change_breakdown', 'exact_payment'],
        include_breakdown: true,
        max_items: 5,
        allow_overpayment: true
      };
    }
  }

  private selectProblemType(params: ChangeCalculationDifficultyParams): string {
    return randomChoice(params.problem_types);
  }

  private generateSimpleChangeProblem(params: ChangeCalculationDifficultyParams): ChangeCalculationOutput {
    // Generate a simple single-item purchase with change
    const itemCost = this.generateItemCost(params);
    const paymentAmount = this.selectPaymentAmount(params, itemCost);
    const changeAmount = paymentAmount - itemCost;

    const changeBreakdown = params.include_breakdown ? 
      this.calculateOptimalChange(changeAmount) : [];

    return {
      operation: "CHANGE_CALCULATION",
      problem_type: 'simple_change',
      items: [{ name: 'item', cost: itemCost, quantity: 1 }],
      total_cost: itemCost,
      payment_amount: paymentAmount,
      change_amount: changeAmount,
      change_breakdown: changeBreakdown,
      payment_description: this.formatPaymentDescription(paymentAmount)
    };
  }

  private generateExactPaymentProblem(params: ChangeCalculationDifficultyParams): ChangeCalculationOutput {
    // Generate a problem where exact payment is needed
    const itemCost = this.generateItemCost(params);
    const paymentAmount = itemCost; // Exact payment
    const changeAmount = 0;

    return {
      operation: "CHANGE_CALCULATION",
      problem_type: 'exact_payment',
      items: [{ name: 'item', cost: itemCost, quantity: 1 }],
      total_cost: itemCost,
      payment_amount: paymentAmount,
      change_amount: changeAmount,
      change_breakdown: [],
      payment_description: this.formatPaymentDescription(paymentAmount)
    };
  }

  private generateMultipleItemsProblem(params: ChangeCalculationDifficultyParams): ChangeCalculationOutput {
    // Generate multiple items with total and change
    const itemCount = generateRandomNumber(Math.min(params.max_items, 4), 0, 2);
    const items: Array<{ name: string; cost: number; quantity: number }> = [];
    let totalCost = 0;

    for (let i = 0; i < itemCount; i++) {
      const cost = this.generateItemCost(params, 0.7); // Slightly smaller items for multiple
      const quantity = 1;
      items.push({
        name: this.getItemName(i),
        cost,
        quantity
      });
      totalCost += cost * quantity;
    }

    const paymentAmount = this.selectPaymentAmount(params, totalCost);
    const changeAmount = paymentAmount - totalCost;
    const changeBreakdown = params.include_breakdown ? 
      this.calculateOptimalChange(changeAmount) : [];

    return {
      operation: "CHANGE_CALCULATION",
      problem_type: 'multiple_items',
      items,
      total_cost: totalCost,
      payment_amount: paymentAmount,
      change_amount: changeAmount,
      change_breakdown: changeBreakdown,
      payment_description: this.formatPaymentDescription(paymentAmount)
    };
  }

  private generateChangeBreakdownProblem(params: ChangeCalculationDifficultyParams): ChangeCalculationOutput {
    // Focus on breaking down change into denominations
    const itemCost = this.generateItemCost(params, 0.6); // Smaller cost to ensure meaningful change
    const paymentAmount = this.selectPaymentAmount(params, itemCost, true); // Force larger payment
    const changeAmount = paymentAmount - itemCost;
    
    const changeBreakdown = this.calculateOptimalChange(changeAmount);

    return {
      operation: "CHANGE_CALCULATION",
      problem_type: 'change_breakdown',
      items: [{ name: 'item', cost: itemCost, quantity: 1 }],
      total_cost: itemCost,
      payment_amount: paymentAmount,
      change_amount: changeAmount,
      change_breakdown: changeBreakdown,
      payment_description: this.formatPaymentDescription(paymentAmount)
    };
  }

  private generateItemCost(params: ChangeCalculationDifficultyParams, multiplier: number = 1): number {
    const maxCost = Math.floor(params.max_item_cost * multiplier);
    let cost = generateRandomNumber(maxCost, params.decimal_places, 5); // Minimum 5p
    
    // Round to appropriate increment based on decimal places
    if (params.decimal_places === 0) {
      cost = Math.round(cost / 5) * 5; // Round to nearest 5p
    } else {
      cost = Math.round(cost * 100) / 100; // Round to nearest penny
    }
    
    return cost;
  }

  private selectPaymentAmount(
    params: ChangeCalculationDifficultyParams, 
    itemCost: number, 
    forceChange: boolean = false
  ): number {
    const availablePayments = params.payment_methods.filter(p => p > itemCost);
    
    if (availablePayments.length === 0 || (!forceChange && Math.random() < 0.2)) {
      // Sometimes allow exact payment or use next denomination up
      const nextUp = ChangeCalculationModel.COMMON_PAYMENTS.find(p => p > itemCost);
      return nextUp || itemCost * 1.5;
    }
    
    return randomChoice(availablePayments);
  }

  private calculateOptimalChange(changeAmount: number): Array<{ denomination: number; count: number; formatted: string }> {
    if (changeAmount <= 0) return [];

    const breakdown: Array<{ denomination: number; count: number; formatted: string }> = [];
    let remaining = Math.round(changeAmount); // Work in pence

    // Use greedy algorithm with UK denominations (in pence)
    const denominations = [5000, 2000, 1000, 500, 200, 100, 50, 20, 10, 5, 2, 1];
    
    for (const denom of denominations) {
      if (remaining >= denom) {
        const count = Math.floor(remaining / denom);
        breakdown.push({
          denomination: denom,
          count,
          formatted: this.formatDenomination(denom)
        });
        remaining -= count * denom;
      }
    }

    return breakdown;
  }

  private formatPaymentDescription(amount: number): string {
    if (amount >= 500) {
      const pounds = Math.floor(amount / 100);
      return `£${pounds} note`;
    } else if (amount >= 100) {
      const pounds = amount / 100;
      return `£${pounds} coin`;
    } else {
      return `${amount}p coin`;
    }
  }

  private formatDenomination(denominationInPence: number): string {
    if (denominationInPence >= 100) {
      const pounds = denominationInPence / 100;
      return `£${pounds}`;
    }
    return `${denominationInPence}p`;
  }

  private getItemName(index: number): string {
    const items = ['apple', 'book', 'pencil', 'rubber', 'sweet', 'toy', 'sticker', 'card'];
    return items[index % items.length];
  }
}
```
--- END FILE: lib\math-engine\models\change-calculation.model.ts ---

--- START FILE: lib\math-engine\models\coin-recognition.model.ts ---
```typescript
import {
  IMathModel,
  CoinRecognitionDifficultyParams,
  CoinRecognitionOutput
} from '@/lib/types';
import {
  randomChoice,
  generateRandomNumber
} from '@/lib/utils';

export class CoinRecognitionModel implements IMathModel<CoinRecognitionDifficultyParams, CoinRecognitionOutput> {
  public readonly model_id = "COIN_RECOGNITION";

  private static readonly UK_COINS = {
    1: { name: 'penny', plural: 'pennies', format: '1p' },
    2: { name: 'two pence', plural: 'two pence coins', format: '2p' },
    5: { name: 'five pence', plural: 'five pence coins', format: '5p' },
    10: { name: 'ten pence', plural: 'ten pence coins', format: '10p' },
    20: { name: 'twenty pence', plural: 'twenty pence coins', format: '20p' },
    50: { name: 'fifty pence', plural: 'fifty pence coins', format: '50p' }
  };

  private static readonly UK_NOTES = {
    500: { name: 'five pound note', plural: 'five pound notes', format: '£5' },
    1000: { name: 'ten pound note', plural: 'ten pound notes', format: '£10' },
    2000: { name: 'twenty pound note', plural: 'twenty pound notes', format: '£20' },
    5000: { name: 'fifty pound note', plural: 'fifty pound notes', format: '£50' }
  };

  generate(params: CoinRecognitionDifficultyParams): CoinRecognitionOutput {
    const problemType = this.selectProblemType(params);
    const denominations = this.getAvailableDenominations(params);
    
    switch (problemType) {
      case 'identify_value':
        return this.generateIdentifyValueProblem(params, denominations);
      case 'identify_name':
        return this.generateIdentifyNameProblem(params, denominations);
      case 'count_collection':
        return this.generateCountCollectionProblem(params, denominations);
      case 'compare_values':
        return this.generateCompareValuesProblem(params, denominations);
      default:
        return this.generateIdentifyValueProblem(params, denominations);
    }
  }

  getDefaultParams(year: number): CoinRecognitionDifficultyParams {
    if (year <= 1) {
      return {
        include_coins: [1, 2, 5, 10],
        include_notes: [],
        problem_types: ['identify_value', 'identify_name'],
        max_coin_count: 3,
        allow_mixed_denominations: false,
        include_combinations: false
      };
    } else if (year <= 2) {
      return {
        include_coins: [1, 2, 5, 10, 20],
        include_notes: [500], // £5 note
        problem_types: ['identify_value', 'count_collection', 'compare_values'],
        max_coin_count: 5,
        allow_mixed_denominations: true,
        include_combinations: false
      };
    } else {
      return {
        include_coins: [1, 2, 5, 10, 20, 50],
        include_notes: [500, 1000, 2000], // £5, £10, £20
        problem_types: ['identify_value', 'count_collection', 'compare_values'],
        max_coin_count: 8,
        allow_mixed_denominations: true,
        include_combinations: true
      };
    }
  }

  private selectProblemType(params: CoinRecognitionDifficultyParams): string {
    return randomChoice(params.problem_types);
  }

  private getAvailableDenominations(params: CoinRecognitionDifficultyParams): number[] {
    return [...params.include_coins, ...params.include_notes];
  }

  private generateIdentifyValueProblem(
    params: CoinRecognitionDifficultyParams, 
    denominations: number[]
  ): CoinRecognitionOutput {
    const denomination = randomChoice(denominations);
    const isNote = denomination >= 500;
    const coinData = isNote ? 
      CoinRecognitionModel.UK_NOTES[denomination as keyof typeof CoinRecognitionModel.UK_NOTES] :
      CoinRecognitionModel.UK_COINS[denomination as keyof typeof CoinRecognitionModel.UK_COINS];

    return {
      operation: "COIN_RECOGNITION",
      problem_type: 'identify_value',
      target_denomination: denomination,
      denomination_name: coinData.name,
      formatted_value: coinData.format,
      is_note: isNote,
      collection: [{ denomination, count: 1 }],
      total_value: denomination,
      answer_type: 'value'
    };
  }

  private generateIdentifyNameProblem(
    params: CoinRecognitionDifficultyParams, 
    denominations: number[]
  ): CoinRecognitionOutput {
    const denomination = randomChoice(denominations);
    const isNote = denomination >= 500;
    const coinData = isNote ? 
      CoinRecognitionModel.UK_NOTES[denomination as keyof typeof CoinRecognitionModel.UK_NOTES] :
      CoinRecognitionModel.UK_COINS[denomination as keyof typeof CoinRecognitionModel.UK_COINS];

    return {
      operation: "COIN_RECOGNITION",
      problem_type: 'identify_name',
      target_denomination: denomination,
      denomination_name: coinData.name,
      formatted_value: coinData.format,
      is_note: isNote,
      collection: [{ denomination, count: 1 }],
      total_value: denomination,
      answer_type: 'name'
    };
  }

  private generateCountCollectionProblem(
    params: CoinRecognitionDifficultyParams, 
    denominations: number[]
  ): CoinRecognitionOutput {
    const collection: Array<{ denomination: number; count: number }> = [];
    let totalValue = 0;

    if (params.allow_mixed_denominations) {
      // Use 2-3 different denominations
      const selectedDenoms = this.selectMultipleDenominations(denominations, 2, 3);
      
      for (const denom of selectedDenoms) {
        const count = generateRandomNumber(3, 0, 1);
        if (count > 0) {
          collection.push({ denomination: denom, count });
          totalValue += denom * count;
        }
      }
    } else {
      // Use only one denomination
      const denomination = randomChoice(denominations.filter(d => d < 500)); // Prefer coins for counting
      const count = generateRandomNumber(Math.min(params.max_coin_count, 5), 0, 2);
      collection.push({ denomination, count });
      totalValue = denomination * count;
    }

    return {
      operation: "COIN_RECOGNITION",
      problem_type: 'count_collection',
      collection,
      total_value: totalValue,
      answer_type: 'total_value'
    };
  }

  private generateCompareValuesProblem(
    params: CoinRecognitionDifficultyParams, 
    denominations: number[]
  ): CoinRecognitionOutput {
    // Generate two different amounts to compare
    const denom1 = randomChoice(denominations);
    const denom2 = randomChoice(denominations.filter(d => d !== denom1));

    const collection = [
      { denomination: denom1, count: 1 },
      { denomination: denom2, count: 1 }
    ];

    const comparison_result = denom1 > denom2 ? 'first_greater' : 
                             denom1 < denom2 ? 'second_greater' : 'equal';

    return {
      operation: "COIN_RECOGNITION",
      problem_type: 'compare_values',
      collection,
      total_value: Math.max(denom1, denom2),
      comparison_result,
      answer_type: 'comparison'
    };
  }

  private selectMultipleDenominations(available: number[], min: number, max: number): number[] {
    const count = generateRandomNumber(max, 0, min);
    const selected: number[] = [];
    const remaining = [...available];

    for (let i = 0; i < count && remaining.length > 0; i++) {
      const index = Math.floor(Math.random() * remaining.length);
      selected.push(remaining[index]);
      remaining.splice(index, 1);
    }

    return selected;
  }

  getDenominationName(denomination: number): string {
    if (denomination >= 500) {
      return CoinRecognitionModel.UK_NOTES[denomination as keyof typeof CoinRecognitionModel.UK_NOTES]?.name || 'unknown';
    }
    return CoinRecognitionModel.UK_COINS[denomination as keyof typeof CoinRecognitionModel.UK_COINS]?.name || 'unknown';
  }

  formatDenomination(denomination: number): string {
    if (denomination >= 500) {
      return CoinRecognitionModel.UK_NOTES[denomination as keyof typeof CoinRecognitionModel.UK_NOTES]?.format || `£${denomination/100}`;
    }
    return CoinRecognitionModel.UK_COINS[denomination as keyof typeof CoinRecognitionModel.UK_COINS]?.format || `${denomination}p`;
  }
}
```
--- END FILE: lib\math-engine\models\coin-recognition.model.ts ---

--- START FILE: lib\math-engine\models\comparison.model.ts ---
```typescript
import {
  IMathModel,
  ComparisonDifficultyParams,
  ComparisonOutput,
  ComparisonOption
} from '@/lib/types';
import {
  generateRandomNumber,
  randomChoice
} from '@/lib/utils';

export class ComparisonModel implements IMathModel<ComparisonDifficultyParams, ComparisonOutput> {
  public readonly model_id = "COMPARISON";

  generate(params: ComparisonDifficultyParams): ComparisonOutput {
    const options = this.generateOptions(params);
    const analysis = this.analyzeOptions(options, params);

    return {
      operation: "COMPARISON",
      options,
      comparison_type: params.comparison_type,
      winner_index: analysis.winner_index,
      difference: analysis.difference,
      explanation: analysis.explanation
    };
  }

  getDefaultParams(year: number): ComparisonDifficultyParams {
    if (year <= 2) {
      return {
        value_count: 2,
        value_max: 50,
        comparison_type: "direct",
        decimal_places: 0,
        include_calculation: false
      };
    } else if (year <= 4) {
      return {
        value_count: 2,
        value_max: 200,
        comparison_type: randomChoice(["direct", "unit_rate"]),
        decimal_places: 2,
        include_calculation: true
      };
    } else {
      return {
        value_count: randomChoice([2, 3]),
        value_max: 1000,
        comparison_type: randomChoice(["direct", "unit_rate", "better_value"]),
        decimal_places: 2,
        include_calculation: true
      };
    }
  }

  private generateOptions(params: ComparisonDifficultyParams): ComparisonOption[] {
    const options: ComparisonOption[] = [];

    for (let i = 0; i < params.value_count; i++) {
      const option = this.generateSingleOption(params, i);
      options.push(option);
    }

    return options;
  }

  private generateSingleOption(params: ComparisonDifficultyParams, index: number): ComparisonOption {
    const value = generateRandomNumber(
      params.value_max,
      params.decimal_places,
      1,
      params.decimal_places > 0 ? 0.01 : 1
    );

    const option: ComparisonOption = {
      value,
      description: this.generateDescription(value, params.comparison_type, index)
    };

    if (params.comparison_type === "unit_rate" || params.comparison_type === "better_value") {
      option.quantity = this.generateQuantity(params);
      option.unit_rate = this.calculateUnitRate(value, option.quantity);
    }

    return option;
  }

  private generateQuantity(params: ComparisonDifficultyParams): number {
    // Generate reasonable quantities for unit rate calculations
    const quantities = [100, 250, 500, 750, 1000, 1500, 2000];
    return randomChoice(quantities.filter(q => q <= params.value_max * 10));
  }

  private calculateUnitRate(totalValue: number, quantity: number): number {
    const rate = totalValue / quantity;
    return Math.round(rate * 1000) / 1000; // Round to 3 decimal places
  }

  private generateDescription(value: number, comparisonType: string, index: number): string {
    const letters = ['A', 'B', 'C', 'D'];
    const letter = letters[index] || `Option ${index + 1}`;

    switch (comparisonType) {
      case "direct":
        return `${letter}: £${value.toFixed(2)}`;
      
      case "unit_rate":
      case "better_value":
        return `${letter}: £${value.toFixed(2)}`;
      
      default:
        return `${letter}: £${value.toFixed(2)}`;
    }
  }

  private analyzeOptions(options: ComparisonOption[], params: ComparisonDifficultyParams): {
    winner_index: number;
    difference?: number;
    explanation: string;
  } {
    switch (params.comparison_type) {
      case "direct":
        return this.analyzeDirectComparison(options, params);
      
      case "unit_rate":
      case "better_value":
        return this.analyzeUnitRateComparison(options, params);
      
      default:
        return this.analyzeDirectComparison(options, params);
    }
  }

  private analyzeDirectComparison(options: ComparisonOption[], params: ComparisonDifficultyParams): {
    winner_index: number;
    difference?: number;
    explanation: string;
  } {
    // Find the option with the highest value
    let maxValue = options[0].value;
    let maxIndex = 0;

    options.forEach((option, index) => {
      if (option.value > maxValue) {
        maxValue = option.value;
        maxIndex = index;
      }
    });

    // Calculate difference from the second highest
    const sortedValues = options.map(o => o.value).sort((a, b) => b - a);
    const difference = sortedValues[0] - sortedValues[1];

    const explanation = params.include_calculation
      ? `Option ${String.fromCharCode(65 + maxIndex)} has the highest value at £${maxValue.toFixed(2)}, which is £${difference.toFixed(2)} more than the next highest.`
      : `Option ${String.fromCharCode(65 + maxIndex)} is worth more.`;

    return {
      winner_index: maxIndex,
      difference: Math.round(difference * 100) / 100,
      explanation
    };
  }

  private analyzeUnitRateComparison(options: ComparisonOption[], params: ComparisonDifficultyParams): {
    winner_index: number;
    difference?: number;
    explanation: string;
  } {
    // Find the option with the best unit rate (lowest cost per unit)
    let bestRate = options[0].unit_rate || Infinity;
    let bestIndex = 0;

    options.forEach((option, index) => {
      const rate = option.unit_rate || Infinity;
      if (rate < bestRate) {
        bestRate = rate;
        bestIndex = index;
      }
    });

    // Calculate rate difference
    const sortedRates = options
      .map(o => o.unit_rate || Infinity)
      .filter(r => r !== Infinity)
      .sort((a, b) => a - b);
    
    const difference = sortedRates.length > 1 ? sortedRates[1] - sortedRates[0] : 0;

    const bestOption = options[bestIndex];
    const explanation = params.include_calculation
      ? `Option ${String.fromCharCode(65 + bestIndex)} offers the best value at £${bestRate.toFixed(3)} per unit (£${bestOption.value.toFixed(2)} for ${bestOption.quantity} units).`
      : `Option ${String.fromCharCode(65 + bestIndex)} is better value.`;

    return {
      winner_index: bestIndex,
      difference: Math.round(difference * 1000) / 1000,
      explanation
    };
  }

  // Helper method to format comparison for display
  static formatComparison(option: ComparisonOption, includeRate: boolean = false): string {
    let formatted = `£${option.value.toFixed(2)}`;
    
    if (option.quantity && includeRate) {
      formatted += ` for ${option.quantity} units`;
      if (option.unit_rate) {
        formatted += ` (£${option.unit_rate.toFixed(3)} per unit)`;
      }
    }
    
    return formatted;
  }
}
```
--- END FILE: lib\math-engine\models\comparison.model.ts ---

--- START FILE: lib\math-engine\models\conversion.model.ts ---
```typescript
import {
  IMathModel,
  ConversionDifficultyParams,
  ConversionOutput
} from '@/lib/types';
import {
  generateRandomNumber,
  randomChoice
} from '@/lib/utils';

export class ConversionModel implements IMathModel<ConversionDifficultyParams, ConversionOutput> {
  public readonly model_id = "CONVERSION";

  private static readonly COMMON_CONVERSIONS = [
    { from_unit: "pence", to_unit: "pounds", conversion_factor: 0.01 },
    { from_unit: "pounds", to_unit: "pence", conversion_factor: 100 },
    { from_unit: "grams", to_unit: "kilograms", conversion_factor: 0.001 },
    { from_unit: "kilograms", to_unit: "grams", conversion_factor: 1000 },
    { from_unit: "millilitres", to_unit: "litres", conversion_factor: 0.001 },
    { from_unit: "litres", to_unit: "millilitres", conversion_factor: 1000 },
    { from_unit: "millimetres", to_unit: "centimetres", conversion_factor: 0.1 },
    { from_unit: "centimetres", to_unit: "millimetres", conversion_factor: 10 },
    { from_unit: "centimetres", to_unit: "metres", conversion_factor: 0.01 },
    { from_unit: "metres", to_unit: "centimetres", conversion_factor: 100 },
    { from_unit: "metres", to_unit: "kilometres", conversion_factor: 0.001 },
    { from_unit: "kilometres", to_unit: "metres", conversion_factor: 1000 }
  ];

  generate(params: ConversionDifficultyParams): ConversionOutput {
    const conversion = this.selectConversion(params);
    const originalValue = this.generateValue(params, conversion);
    const convertedValue = this.performConversion(originalValue, conversion.conversion_factor);

    return {
      operation: "CONVERSION",
      original_value: originalValue,
      original_unit: conversion.from_unit,
      converted_value: convertedValue,
      converted_unit: conversion.to_unit,
      conversion_factor: conversion.conversion_factor,
      formatted_original: this.formatValue(originalValue, conversion.from_unit, params.decimal_places),
      formatted_converted: this.formatValue(convertedValue, conversion.to_unit, params.decimal_places)
    };
  }

  getDefaultParams(year: number): ConversionDifficultyParams {
    if (year <= 2) {
      return {
        value_max: 100,
        conversion_types: [
          { from_unit: "pence", to_unit: "pounds", conversion_factor: 0.01 }
        ],
        decimal_places: 2
      };
    } else if (year <= 4) {
      return {
        value_max: 1000,
        conversion_types: [
          { from_unit: "pence", to_unit: "pounds", conversion_factor: 0.01 },
          { from_unit: "pounds", to_unit: "pence", conversion_factor: 100 },
          { from_unit: "centimetres", to_unit: "metres", conversion_factor: 0.01 },
          { from_unit: "metres", to_unit: "centimetres", conversion_factor: 100 }
        ],
        decimal_places: 2
      };
    } else {
      return {
        value_max: 10000,
        conversion_types: ConversionModel.COMMON_CONVERSIONS,
        decimal_places: 3
      };
    }
  }

  private selectConversion(params: ConversionDifficultyParams): {
    from_unit: string;
    to_unit: string;
    conversion_factor: number;
  } {
    return randomChoice(params.conversion_types);
  }

  private generateValue(
    params: ConversionDifficultyParams,
    conversion: { from_unit: string; to_unit: string; conversion_factor: number }
  ): number {
    // Adjust max value based on conversion to avoid extreme results
    let adjustedMax = params.value_max;
    
    if (conversion.conversion_factor > 10) {
      // For conversions that multiply (e.g., pounds to pence), use smaller input values
      adjustedMax = Math.min(adjustedMax, 100);
    }

    return generateRandomNumber(
      adjustedMax,
      conversion.from_unit === "pounds" ? 2 : 0, // Use decimals for pounds
      1,
      0.01
    );
  }

  private performConversion(value: number, factor: number): number {
    const result = value * factor;
    // Round to avoid floating point precision issues
    return Math.round(result * 1000) / 1000;
  }

  private formatValue(value: number, unit: string, decimalPlaces: number): string {
    // Special formatting for currency
    if (unit === "pounds") {
      return `£${value.toFixed(2)}`;
    } else if (unit === "pence") {
      return `${Math.round(value)}p`;
    }
    
    // Standard formatting for other units
    const formattedValue = value % 1 === 0 ? value.toString() : value.toFixed(decimalPlaces);
    return `${formattedValue} ${unit}`;
  }

  // Helper method to get unit abbreviations
  static getUnitAbbreviation(unit: string): string {
    const abbreviations: { [key: string]: string } = {
      pounds: "£",
      pence: "p",
      kilograms: "kg",
      grams: "g",
      litres: "l",
      millilitres: "ml",
      metres: "m",
      centimetres: "cm",
      millimetres: "mm",
      kilometres: "km"
    };
    
    return abbreviations[unit] || unit;
  }

  // Helper method to determine if result should be whole number
  static shouldBeWholeNumber(unit: string): boolean {
    return ["pence", "grams", "millilitres", "millimetres", "centimetres"].includes(unit);
  }
}
```
--- END FILE: lib\math-engine\models\conversion.model.ts ---

--- START FILE: lib\math-engine\models\counting.model.ts ---
```typescript
import {
  IMathModel,
  CountingDifficultyParams,
  CountingOutput
} from '@/lib/types';
import {
  randomChoice
} from '@/lib/utils';

export class CountingModel implements IMathModel<CountingDifficultyParams, CountingOutput> {
  public readonly model_id = "COUNTING";

  // UK coin denominations in pence
  private static readonly UK_DENOMINATIONS = [1, 2, 5, 10, 20, 50, 100, 200];

  generate(params: CountingDifficultyParams): CountingOutput {
    const solutions = this.findSolutions(params);
    const selectedSolution = this.selectBestSolution(solutions, params);

    return {
      operation: "COUNTING",
      target_value: params.target_value,
      solutions: selectedSolution.solution,
      total_coins: selectedSolution.total_coins,
      is_minimum_solution: selectedSolution.is_minimum
    };
  }

  getDefaultParams(year: number): CountingDifficultyParams {
    if (year <= 2) {
      return {
        target_value: 50, // 50p or less
        allowed_denominations: [1, 2, 5, 10], // Basic coins
        solution_type: "exact",
        max_coins: 10
      };
    } else if (year <= 4) {
      return {
        target_value: 100, // £1 or less
        allowed_denominations: [1, 2, 5, 10, 20, 50], 
        solution_type: "minimum",
        max_coins: 15
      };
    } else {
      return {
        target_value: 500, // £5 or less
        allowed_denominations: [1, 2, 5, 10, 20, 50, 100, 200],
        solution_type: "multiple",
        max_coins: 20
      };
    }
  }

  private findSolutions(params: CountingDifficultyParams): Array<{
    solution: Array<{ denomination: number; count: number }>;
    total_coins: number;
    is_minimum: boolean;
  }> {
    const solutions: Array<{
      solution: Array<{ denomination: number; count: number }>;
      total_coins: number;
      is_minimum: boolean;
    }> = [];

    // Find minimum coin solution using greedy algorithm
    const minSolution = this.findMinimumCoinSolution(params);
    if (minSolution) {
      solutions.push({ ...minSolution, is_minimum: true });
    }

    // Find alternative solutions if requested
    if (params.solution_type === "multiple") {
      const alternatives = this.findAlternativeSolutions(params, 3);
      solutions.push(...alternatives.map(alt => ({ ...alt, is_minimum: false })));
    }

    return solutions;
  }

  private findMinimumCoinSolution(params: CountingDifficultyParams): {
    solution: Array<{ denomination: number; count: number }>;
    total_coins: number;
  } | null {
    const denominations = [...params.allowed_denominations].sort((a, b) => b - a);
    let remainingValue = params.target_value;
    const solution: Array<{ denomination: number; count: number }> = [];
    let totalCoins = 0;

    for (const denom of denominations) {
      if (remainingValue >= denom) {
        const count = Math.floor(remainingValue / denom);
        if (count > 0 && totalCoins + count <= params.max_coins) {
          solution.push({ denomination: denom, count });
          remainingValue -= denom * count;
          totalCoins += count;
        }
      }
    }

    // Check if we found an exact solution
    if (remainingValue === 0 && totalCoins <= params.max_coins) {
      return { solution, total_coins: totalCoins };
    }

    return null;
  }

  private findAlternativeSolutions(
    params: CountingDifficultyParams,
    maxAlternatives: number
  ): Array<{
    solution: Array<{ denomination: number; count: number }>;
    total_coins: number;
  }> {
    const alternatives: Array<{
      solution: Array<{ denomination: number; count: number }>;
      total_coins: number;
    }> = [];

    // Generate alternative solutions by varying coin usage
    const denominations = params.allowed_denominations.sort((a, b) => b - a);
    
    for (let attempt = 0; attempt < maxAlternatives * 3 && alternatives.length < maxAlternatives; attempt++) {
      const solution = this.generateAlternativeSolution(params, denominations);
      if (solution && !this.isDuplicateSolution(solution, alternatives)) {
        alternatives.push(solution);
      }
    }

    return alternatives;
  }

  private generateAlternativeSolution(
    params: CountingDifficultyParams,
    denominations: number[]
  ): {
    solution: Array<{ denomination: number; count: number }>;
    total_coins: number;
  } | null {
    let remainingValue = params.target_value;
    const solution: Array<{ denomination: number; count: number }> = [];
    let totalCoins = 0;

    // Randomly vary the approach by sometimes using smaller denominations
    for (let i = 0; i < denominations.length; i++) {
      const denom = denominations[i];
      
      if (remainingValue >= denom) {
        const maxCount = Math.floor(remainingValue / denom);
        const remainingCoinBudget = params.max_coins - totalCoins;
        
        // Sometimes use fewer large denominations to create variation
        const useAlternative = Math.random() < 0.4 && i < denominations.length - 1;
        const count = useAlternative 
          ? Math.max(0, Math.floor(maxCount * Math.random()))
          : Math.min(maxCount, remainingCoinBudget);

        if (count > 0) {
          solution.push({ denomination: denom, count });
          remainingValue -= denom * count;
          totalCoins += count;
        }
      }
    }

    if (remainingValue === 0 && totalCoins <= params.max_coins) {
      return { solution, total_coins: totalCoins };
    }

    return null;
  }

  private isDuplicateSolution(
    newSolution: { solution: Array<{ denomination: number; count: number }> },
    existing: Array<{ solution: Array<{ denomination: number; count: number }> }>
  ): boolean {
    return existing.some(existing => 
      this.areSolutionsEqual(newSolution.solution, existing.solution)
    );
  }

  private areSolutionsEqual(
    sol1: Array<{ denomination: number; count: number }>,
    sol2: Array<{ denomination: number; count: number }>
  ): boolean {
    if (sol1.length !== sol2.length) return false;
    
    const sorted1 = [...sol1].sort((a, b) => a.denomination - b.denomination);
    const sorted2 = [...sol2].sort((a, b) => a.denomination - b.denomination);
    
    return sorted1.every((coin, index) => 
      coin.denomination === sorted2[index].denomination &&
      coin.count === sorted2[index].count
    );
  }

  private selectBestSolution(
    solutions: Array<{
      solution: Array<{ denomination: number; count: number }>;
      total_coins: number;
      is_minimum: boolean;
    }>,
    params: CountingDifficultyParams
  ): {
    solution: Array<{ denomination: number; count: number }>;
    total_coins: number;
    is_minimum: boolean;
  } {
    if (solutions.length === 0) {
      // Fallback solution
      return {
        solution: [{ denomination: 1, count: params.target_value }],
        total_coins: params.target_value,
        is_minimum: false
      };
    }

    // For "minimum" type, prefer the solution with fewest coins
    if (params.solution_type === "minimum") {
      return solutions.reduce((best, current) => 
        current.total_coins < best.total_coins ? current : best
      );
    }

    // For other types, return a random valid solution
    return randomChoice(solutions);
  }
}
```
--- END FILE: lib\math-engine\models\counting.model.ts ---

--- START FILE: lib\math-engine\models\division.model.ts ---
```typescript
import {
  IMathModel,
  DivisionDifficultyParams,
  DivisionOutput,
  DecimalFormatted
} from '@/lib/types';
import {
  generateRandomNumber,
  formatDecimal,
  randomInt
} from '@/lib/utils';

export class DivisionModel implements IMathModel<DivisionDifficultyParams, DivisionOutput> {
  public readonly model_id = "DIVISION";

  generate(params: DivisionDifficultyParams): DivisionOutput {
    const { dividend, divisor } = this.generateOperands(params);
    const { quotient, remainder } = this.calculateDivision(dividend, divisor, params);
    const decimalFormatted = this.formatOutput(dividend, divisor, quotient, params.decimal_places);

    return {
      operation: "DIVISION",
      dividend,
      divisor,
      quotient,
      remainder,
      decimal_formatted: decimalFormatted
    };
  }

  getDefaultParams(year: number): DivisionDifficultyParams {
    if (year <= 2) {
      return {
        dividend_max: 20,
        divisor_max: 5,
        decimal_places: 0,
        allow_remainder: false,
        ensure_whole: true
      };
    } else if (year <= 4) {
      return {
        dividend_max: 100,
        divisor_max: 10,
        decimal_places: year === 4 ? 2 : 0,
        allow_remainder: year === 4,
        ensure_whole: year === 3
      };
    } else {
      return {
        dividend_max: 1000,
        divisor_max: 100,
        decimal_places: 3,
        allow_remainder: true,
        ensure_whole: false
      };
    }
  }

  private generateOperands(params: DivisionDifficultyParams): { dividend: number; divisor: number } {
    if (params.ensure_whole) {
      // Generate divisor first, then create dividend as multiple
      const divisor = randomInt(2, params.divisor_max);
      const multiplier = randomInt(1, Math.floor(params.dividend_max / divisor));
      const dividend = divisor * multiplier;
      
      return { dividend, divisor };
    } else {
      // Generate random dividend and divisor
      let dividend = generateRandomNumber(
        params.dividend_max,
        params.decimal_places,
        1,
        params.decimal_places > 0 ? 0.01 : 1
      );
      
      let divisor = generateRandomNumber(
        params.divisor_max,
        0, // Divisor typically whole number
        1,
        1
      );

      // Ensure divisor is not zero
      if (divisor === 0) {
        divisor = 1;
      }

      // If no remainder allowed and decimals are 0, adjust dividend
      if (!params.allow_remainder && params.decimal_places === 0) {
        dividend = Math.floor(dividend / divisor) * divisor;
      }

      return { dividend, divisor };
    }
  }

  private calculateDivision(
    dividend: number,
    divisor: number,
    params: DivisionDifficultyParams
  ): { quotient: number; remainder: number } {
    if (params.decimal_places > 0) {
      const quotient = dividend / divisor;
      return {
        quotient: Math.round(quotient * Math.pow(10, params.decimal_places)) / Math.pow(10, params.decimal_places),
        remainder: 0
      };
    } else {
      const quotient = Math.floor(dividend / divisor);
      const remainder = params.allow_remainder ? dividend % divisor : 0;
      return { quotient, remainder };
    }
  }

  private formatOutput(
    dividend: number,
    divisor: number,
    quotient: number,
    decimalPlaces: number
  ): DecimalFormatted {
    return {
      operands: [
        formatDecimal(dividend, decimalPlaces),
        formatDecimal(divisor, 0)
      ],
      quotient: formatDecimal(quotient, decimalPlaces),
      result: formatDecimal(quotient, decimalPlaces)
    };
  }
}
```
--- END FILE: lib\math-engine\models\division.model.ts ---

--- START FILE: lib\math-engine\models\fraction.model.ts ---
```typescript
import {
  IMathModel,
  FractionDifficultyParams,
  FractionOutput
} from '@/lib/types';
import {
  generateRandomNumber,
  randomChoice
} from '@/lib/utils';

export class FractionModel implements IMathModel<FractionDifficultyParams, FractionOutput> {
  public readonly model_id = "FRACTION";

  generate(params: FractionDifficultyParams): FractionOutput {
    const wholeValue = this.generateWholeValue(params);
    const fraction = this.selectFraction(params, wholeValue);
    const result = this.calculateFraction(wholeValue, fraction, params);

    return {
      operation: "FRACTION",
      whole_value: wholeValue,
      fraction: {
        numerator: fraction.numerator,
        denominator: fraction.denominator,
        formatted: `${fraction.numerator}/${fraction.denominator}`
      },
      result: result.final_result,
      calculation_steps: {
        division_result: result.division_result,
        final_result: result.final_result
      }
    };
  }

  getDefaultParams(year: number): FractionDifficultyParams {
    if (year <= 2) {
      return {
        whole_value_max: 20,
        fraction_types: [
          { numerator: 1, denominator: 2 }
        ],
        decimal_places: 0,
        ensure_whole_result: true
      };
    } else if (year <= 4) {
      return {
        whole_value_max: 100,
        fraction_types: [
          { numerator: 1, denominator: 2 },
          { numerator: 1, denominator: 3 },
          { numerator: 1, denominator: 4 },
          { numerator: 3, denominator: 4 }
        ],
        decimal_places: 2,
        ensure_whole_result: false
      };
    } else {
      return {
        whole_value_max: 1000,
        fraction_types: [
          { numerator: 1, denominator: 2 },
          { numerator: 1, denominator: 3 },
          { numerator: 2, denominator: 3 },
          { numerator: 1, denominator: 4 },
          { numerator: 3, denominator: 4 },
          { numerator: 1, denominator: 5 },
          { numerator: 2, denominator: 5 },
          { numerator: 3, denominator: 5 },
          { numerator: 4, denominator: 5 }
        ],
        decimal_places: 2,
        ensure_whole_result: false
      };
    }
  }

  private generateWholeValue(params: FractionDifficultyParams): number {
    if (params.ensure_whole_result) {
      // Generate values that will result in whole numbers for common fractions
      const fraction = randomChoice(params.fraction_types);
      const multiplier = Math.floor(Math.random() * 10) + 1;
      return fraction.denominator * multiplier;
    } else {
      return generateRandomNumber(
        params.whole_value_max,
        params.decimal_places,
        1,
        params.decimal_places > 0 ? 0.01 : 1
      );
    }
  }

  private selectFraction(
    params: FractionDifficultyParams,
    wholeValue: number
  ): { numerator: number; denominator: number } {
    if (params.ensure_whole_result) {
      // Filter fractions that will give whole results
      const validFractions = params.fraction_types.filter(f => 
        (wholeValue * f.numerator) % f.denominator === 0
      );
      return validFractions.length > 0 
        ? randomChoice(validFractions)
        : params.fraction_types[0];
    }
    
    return randomChoice(params.fraction_types);
  }

  private calculateFraction(
    wholeValue: number,
    fraction: { numerator: number; denominator: number },
    params: FractionDifficultyParams
  ): { division_result: number; final_result: number } {
    const division_result = wholeValue / fraction.denominator;
    const final_result = division_result * fraction.numerator;
    
    // Round to specified decimal places
    const factor = Math.pow(10, params.decimal_places);
    
    return {
      division_result: Math.round(division_result * factor) / factor,
      final_result: Math.round(final_result * factor) / factor
    };
  }
}
```
--- END FILE: lib\math-engine\models\fraction.model.ts ---

--- START FILE: lib\math-engine\models\linear-equation.model.ts ---
```typescript
import {
  IMathModel,
  LinearEquationDifficultyParams,
  LinearEquationOutput
} from '@/lib/types';
import {
  randomChoice,
  generateRandomNumber
} from '@/lib/utils';

export class LinearEquationModel implements IMathModel<LinearEquationDifficultyParams, LinearEquationOutput> {
  public readonly model_id = "LINEAR_EQUATION";

  generate(params: LinearEquationDifficultyParams): LinearEquationOutput {
    const m = this.generateSlope(params);
    const c = this.generateIntercept(params);
    
    // Generate x values for evaluation
    const xValues = this.generateXValues(params);
    
    // Calculate corresponding y values
    const evaluations = xValues.map(x => ({
      x,
      y: this.evaluateEquation(m, c, x, params)
    }));

    // Generate coordinate pairs for the equation
    const coordinates = evaluations.map(evaluation => ({ x: evaluation.x, y: evaluation.y }));

    // Determine the problem type
    const problemType = this.selectProblemType(params);
    
    return {
      operation: "LINEAR_EQUATION",
      slope: m,
      intercept: c,
      equation: this.formatEquation(m, c),
      problem_type: problemType,
      x_values: xValues,
      evaluations,
      coordinates,
      target_x: problemType === 'solve_for_x' ? randomChoice(xValues) : undefined,
      target_y: problemType === 'solve_for_y' ? randomChoice(evaluations).y : undefined
    };
  }

  getDefaultParams(year: number): LinearEquationDifficultyParams {
    if (year <= 3) {
      // Simple linear patterns
      return {
        slope_range: { min: 1, max: 3 },
        intercept_range: { min: 0, max: 5 },
        x_range: { min: 0, max: 10 },
        decimal_places: 0,
        allow_negative_slope: false,
        allow_negative_intercept: false,
        problem_types: ['evaluate', 'complete_table'],
        x_value_count: 3
      };
    } else if (year <= 4) {
      return {
        slope_range: { min: 1, max: 5 },
        intercept_range: { min: -5, max: 10 },
        x_range: { min: 0, max: 15 },
        decimal_places: 1,
        allow_negative_slope: false,
        allow_negative_intercept: true,
        problem_types: ['evaluate', 'complete_table', 'solve_for_y'],
        x_value_count: 4
      };
    } else {
      return {
        slope_range: { min: -5, max: 5 },
        intercept_range: { min: -10, max: 10 },
        x_range: { min: -10, max: 20 },
        decimal_places: 2,
        allow_negative_slope: true,
        allow_negative_intercept: true,
        problem_types: ['evaluate', 'complete_table', 'solve_for_y', 'solve_for_x'],
        x_value_count: 5
      };
    }
  }

  private generateSlope(params: LinearEquationDifficultyParams): number {
    let slope: number;
    let attempts = 0;
    
    do {
      slope = generateRandomNumber(
        params.slope_range.max,
        params.decimal_places,
        params.slope_range.min
      );
      attempts++;
      
      // Safety valve to prevent infinite loops
      if (attempts > 100) {
        slope = params.slope_range.min + 1; // Safe fallback
        break;
      }
    } while (
      slope === 0 || // Avoid horizontal lines
      (!params.allow_negative_slope && slope < 0)
    );

    return slope;
  }

  private generateIntercept(params: LinearEquationDifficultyParams): number {
    let intercept = generateRandomNumber(
      params.intercept_range.max,
      params.decimal_places,
      params.intercept_range.min
    );

    if (!params.allow_negative_intercept && intercept < 0) {
      intercept = Math.abs(intercept);
    }

    return intercept;
  }

  private generateXValues(params: LinearEquationDifficultyParams): number[] {
    const xValues: number[] = [];
    const usedValues = new Set<number>();
    let attempts = 0;

    while (xValues.length < params.x_value_count) {
      const x = generateRandomNumber(
        params.x_range.max,
        0, // X values are typically integers
        params.x_range.min
      );

      if (!usedValues.has(x)) {
        xValues.push(x);
        usedValues.add(x);
      }
      
      attempts++;
      // Safety valve - if we can't generate enough unique values, just fill with sequential values
      if (attempts > 1000) {
        while (xValues.length < params.x_value_count) {
          let nextX = params.x_range.min + xValues.length;
          if (nextX > params.x_range.max) {
            break;
          }
          if (!usedValues.has(nextX)) {
            xValues.push(nextX);
            usedValues.add(nextX);
          }
        }
        break;
      }
    }

    return xValues.sort((a, b) => a - b);
  }

  private evaluateEquation(
    m: number, 
    c: number, 
    x: number, 
    params: LinearEquationDifficultyParams
  ): number {
    const y = m * x + c;
    return Math.round(y * Math.pow(10, params.decimal_places)) / Math.pow(10, params.decimal_places);
  }

  private selectProblemType(params: LinearEquationDifficultyParams): string {
    return randomChoice(params.problem_types);
  }

  private formatEquation(m: number, c: number): string {
    // Handle special cases for slope
    let slopeStr = '';
    if (m === 1) {
      slopeStr = '';
    } else if (m === -1) {
      slopeStr = '-';
    } else {
      slopeStr = m.toString();
    }

    // Handle intercept
    let interceptStr = '';
    if (c > 0) {
      interceptStr = ` + ${c}`;
    } else if (c < 0) {
      interceptStr = ` - ${Math.abs(c)}`;
    }
    // If c = 0, no intercept term

    // Build equation
    if (slopeStr === '' && interceptStr === '') {
      return 'y = x';
    } else if (slopeStr === '' && interceptStr !== '') {
      return `y = x${interceptStr}`;
    } else if (slopeStr !== '' && interceptStr === '') {
      return `y = ${slopeStr}x`;
    } else {
      return `y = ${slopeStr}x${interceptStr}`;
    }
  }
}
```
--- END FILE: lib\math-engine\models\linear-equation.model.ts ---

--- START FILE: lib\math-engine\models\mixed-money-units.model.ts ---
```typescript
import {
  IMathModel,
  MixedMoneyUnitsDifficultyParams,
  MixedMoneyUnitsOutput
} from '@/lib/types';
import {
  randomChoice,
  generateRandomNumber
} from '@/lib/utils';

export class MixedMoneyUnitsModel implements IMathModel<MixedMoneyUnitsDifficultyParams, MixedMoneyUnitsOutput> {
  public readonly model_id = "MIXED_MONEY_UNITS";

  generate(params: MixedMoneyUnitsDifficultyParams): MixedMoneyUnitsOutput {
    const problemType = this.selectProblemType(params);
    
    switch (problemType) {
      case 'convert_units':
        return this.generateConvertUnitsProblem(params);
      case 'add_mixed_units':
        return this.generateAddMixedUnitsProblem(params);
      case 'subtract_mixed_units':
        return this.generateSubtractMixedUnitsProblem(params);
      case 'compare_mixed_amounts':
        return this.generateCompareMixedAmountsProblem(params);
      default:
        return this.generateConvertUnitsProblem(params);
    }
  }

  getDefaultParams(year: number): MixedMoneyUnitsDifficultyParams {
    if (year <= 2) {
      return {
        pounds_range: { min: 1, max: 5 },
        pence_range: { min: 1, max: 99 },
        problem_types: ['convert_units', 'add_mixed_units'],
        decimal_places: 0,
        allow_complex_operations: false,
        include_comparisons: false,
        max_operands: 2
      };
    } else if (year <= 3) {
      return {
        pounds_range: { min: 1, max: 20 },
        pence_range: { min: 1, max: 99 },
        problem_types: ['convert_units', 'add_mixed_units', 'subtract_mixed_units'],
        decimal_places: 2,
        allow_complex_operations: true,
        include_comparisons: true,
        max_operands: 3
      };
    } else {
      return {
        pounds_range: { min: 1, max: 100 },
        pence_range: { min: 1, max: 99 },
        problem_types: ['convert_units', 'add_mixed_units', 'subtract_mixed_units', 'compare_mixed_amounts'],
        decimal_places: 2,
        allow_complex_operations: true,
        include_comparisons: true,
        max_operands: 4
      };
    }
  }

  private selectProblemType(params: MixedMoneyUnitsDifficultyParams): string {
    return randomChoice(params.problem_types);
  }

  private generateConvertUnitsProblem(params: MixedMoneyUnitsDifficultyParams): MixedMoneyUnitsOutput {
    const conversionType = randomChoice(['pounds_to_pence', 'pence_to_pounds', 'mixed_to_decimal']);
    
    let sourceAmount: { pounds: number; pence: number };
    let targetFormat: string;
    let result: number;

    switch (conversionType) {
      case 'pounds_to_pence':
        sourceAmount = { 
          pounds: generateRandomNumber(params.pounds_range.max, 0, params.pounds_range.min), 
          pence: 0 
        };
        targetFormat = 'pence';
        result = sourceAmount.pounds * 100;
        break;
      
      case 'pence_to_pounds':
        const totalPence = generateRandomNumber(params.pence_range.max + 200, 0, 100); // Ensure > 100p
        sourceAmount = { pounds: 0, pence: totalPence };
        targetFormat = 'pounds_decimal';
        result = totalPence / 100;
        break;
      
      case 'mixed_to_decimal':
      default:
        sourceAmount = {
          pounds: generateRandomNumber(params.pounds_range.max, 0, params.pounds_range.min),
          pence: generateRandomNumber(params.pence_range.max, 0, params.pence_range.min)
        };
        targetFormat = 'decimal';
        result = sourceAmount.pounds + (sourceAmount.pence / 100);
        break;
    }

    return {
      operation: "MIXED_MONEY_UNITS",
      problem_type: 'convert_units',
      source_amount: sourceAmount,
      target_format: targetFormat,
      result: result,
      formatted_source: this.formatMixedAmount(sourceAmount),
      formatted_result: this.formatResult(result, targetFormat),
      conversion_type: conversionType
    };
  }

  private generateAddMixedUnitsProblem(params: MixedMoneyUnitsDifficultyParams): MixedMoneyUnitsOutput {
    const operandCount = generateRandomNumber(params.max_operands, 0, 2);
    const operands: Array<{ pounds: number; pence: number }> = [];
    
    for (let i = 0; i < operandCount; i++) {
      operands.push({
        pounds: generateRandomNumber(params.pounds_range.max, 0, params.pounds_range.min),
        pence: generateRandomNumber(params.pence_range.max, 0, params.pence_range.min)
      });
    }

    const result = this.addMixedAmounts(operands);

    return {
      operation: "MIXED_MONEY_UNITS",
      problem_type: 'add_mixed_units',
      operands: operands,
      result: result.total_decimal,
      result_mixed: result,
      formatted_operands: operands.map(op => this.formatMixedAmount(op)),
      formatted_result: this.formatMixedAmount(result)
    };
  }

  private generateSubtractMixedUnitsProblem(params: MixedMoneyUnitsDifficultyParams): MixedMoneyUnitsOutput {
    // Generate minuend and subtrahend
    const minuend = {
      pounds: generateRandomNumber(params.pounds_range.max, 0, params.pounds_range.min + 2),
      pence: generateRandomNumber(params.pence_range.max, 0, params.pence_range.min)
    };

    const subtrahend = {
      pounds: generateRandomNumber(Math.min(minuend.pounds, params.pounds_range.max - 1), 0, params.pounds_range.min),
      pence: generateRandomNumber(params.pence_range.max, 0, params.pence_range.min)
    };

    // Ensure positive result
    const minuendDecimal = minuend.pounds + (minuend.pence / 100);
    const subtrahendDecimal = subtrahend.pounds + (subtrahend.pence / 100);
    
    if (minuendDecimal < subtrahendDecimal) {
      // Swap to ensure positive result
      const temp = { ...minuend };
      minuend.pounds = subtrahend.pounds + 1;
      minuend.pence = subtrahend.pence;
      subtrahend.pounds = temp.pounds;
      subtrahend.pence = temp.pence;
    }

    const result = this.subtractMixedAmounts(minuend, subtrahend);

    return {
      operation: "MIXED_MONEY_UNITS",
      problem_type: 'subtract_mixed_units',
      minuend: minuend,
      subtrahend: subtrahend,
      result: result.total_decimal,
      result_mixed: result,
      formatted_minuend: this.formatMixedAmount(minuend),
      formatted_subtrahend: this.formatMixedAmount(subtrahend),
      formatted_result: this.formatMixedAmount(result),
      requires_borrowing: minuend.pence < subtrahend.pence
    };
  }

  private generateCompareMixedAmountsProblem(params: MixedMoneyUnitsDifficultyParams): MixedMoneyUnitsOutput {
    const amount1 = {
      pounds: generateRandomNumber(params.pounds_range.max, 0, params.pounds_range.min),
      pence: generateRandomNumber(params.pence_range.max, 0, params.pence_range.min)
    };

    const amount2 = {
      pounds: generateRandomNumber(params.pounds_range.max, 0, params.pounds_range.min),
      pence: generateRandomNumber(params.pence_range.max, 0, params.pence_range.min)
    };

    const decimal1 = amount1.pounds + (amount1.pence / 100);
    const decimal2 = amount2.pounds + (amount2.pence / 100);
    
    const comparison = decimal1 > decimal2 ? 'greater' : 
                      decimal1 < decimal2 ? 'less' : 'equal';

    return {
      operation: "MIXED_MONEY_UNITS",
      problem_type: 'compare_mixed_amounts',
      amount1: amount1,
      amount2: amount2,
      comparison_result: comparison,
      difference: Math.abs(decimal1 - decimal2),
      formatted_amount1: this.formatMixedAmount(amount1),
      formatted_amount2: this.formatMixedAmount(amount2),
      formatted_difference: this.formatDecimalAmount(Math.abs(decimal1 - decimal2))
    };
  }

  private addMixedAmounts(amounts: Array<{ pounds: number; pence: number }>): { pounds: number; pence: number; total_decimal: number } {
    let totalPounds = 0;
    let totalPence = 0;

    for (const amount of amounts) {
      totalPounds += amount.pounds;
      totalPence += amount.pence;
    }

    // Handle pence overflow
    const extraPounds = Math.floor(totalPence / 100);
    totalPounds += extraPounds;
    totalPence = totalPence % 100;

    return {
      pounds: totalPounds,
      pence: totalPence,
      total_decimal: totalPounds + (totalPence / 100)
    };
  }

  private subtractMixedAmounts(
    minuend: { pounds: number; pence: number }, 
    subtrahend: { pounds: number; pence: number }
  ): { pounds: number; pence: number; total_decimal: number } {
    let resultPounds = minuend.pounds - subtrahend.pounds;
    let resultPence = minuend.pence - subtrahend.pence;

    // Handle borrowing
    if (resultPence < 0) {
      resultPence += 100;
      resultPounds -= 1;
    }

    return {
      pounds: Math.max(0, resultPounds),
      pence: Math.max(0, resultPence),
      total_decimal: Math.max(0, resultPounds + (resultPence / 100))
    };
  }

  private formatMixedAmount(amount: { pounds: number; pence: number }): string {
    if (amount.pounds === 0 && amount.pence > 0) {
      return `${amount.pence}p`;
    }
    if (amount.pence === 0 && amount.pounds > 0) {
      return `£${amount.pounds}`;
    }
    if (amount.pounds > 0 && amount.pence > 0) {
      return `£${amount.pounds} and ${amount.pence}p`;
    }
    return '£0';
  }

  private formatDecimalAmount(amount: number): string {
    return `£${amount.toFixed(2)}`;
  }

  private formatResult(result: number, targetFormat: string): string {
    switch (targetFormat) {
      case 'pence':
        return `${result}p`;
      case 'pounds_decimal':
        return `£${result.toFixed(2)}`;
      case 'decimal':
        return `£${result.toFixed(2)}`;
      default:
        return `£${result.toFixed(2)}`;
    }
  }

  // Helper method to convert mixed amount to decimal
  toDecimal(amount: { pounds: number; pence: number }): number {
    return amount.pounds + (amount.pence / 100);
  }

  // Helper method to convert decimal to mixed amount
  fromDecimal(decimal: number): { pounds: number; pence: number } {
    const pounds = Math.floor(decimal);
    const pence = Math.round((decimal - pounds) * 100);
    
    return { pounds, pence };
  }
}
```
--- END FILE: lib\math-engine\models\mixed-money-units.model.ts ---

--- START FILE: lib\math-engine\models\money-combinations.model.ts ---
```typescript
import {
  IMathModel,
  MoneyCombinationsDifficultyParams,
  MoneyCombinationsOutput
} from '@/lib/types';
import {
  randomChoice,
  generateRandomNumber
} from '@/lib/utils';

export class MoneyCombinationsModel implements IMathModel<MoneyCombinationsDifficultyParams, MoneyCombinationsOutput> {
  public readonly model_id = "MONEY_COMBINATIONS";

  private static readonly UK_DENOMINATIONS = [1, 2, 5, 10, 20, 50, 100, 200]; // In pence

  generate(params: MoneyCombinationsDifficultyParams): MoneyCombinationsOutput {
    const problemType = this.selectProblemType(params);
    
    switch (problemType) {
      case 'find_combinations':
        return this.generateFindCombinationsProblem(params);
      case 'make_amount':
        return this.generateMakeAmountProblem(params);
      case 'equivalent_amounts':
        return this.generateEquivalentAmountsProblem(params);
      case 'compare_combinations':
        return this.generateCompareCombinationsProblem(params);
      default:
        return this.generateFindCombinationsProblem(params);
    }
  }

  getDefaultParams(year: number): MoneyCombinationsDifficultyParams {
    if (year <= 2) {
      return {
        target_amount_range: { min: 5, max: 20 }, // 5p to 20p
        available_denominations: [1, 2, 5, 10],
        problem_types: ['find_combinations', 'make_amount'],
        max_combinations: 3,
        allow_notes: false,
        require_exact_combinations: true,
        decimal_places: 0
      };
    } else if (year <= 3) {
      return {
        target_amount_range: { min: 10, max: 100 }, // 10p to £1
        available_denominations: [1, 2, 5, 10, 20, 50, 100],
        problem_types: ['find_combinations', 'make_amount', 'equivalent_amounts'],
        max_combinations: 4,
        allow_notes: false,
        require_exact_combinations: true,
        decimal_places: 0
      };
    } else {
      return {
        target_amount_range: { min: 25, max: 500 }, // 25p to £5
        available_denominations: [1, 2, 5, 10, 20, 50, 100, 200],
        problem_types: ['find_combinations', 'equivalent_amounts', 'compare_combinations'],
        max_combinations: 5,
        allow_notes: true,
        require_exact_combinations: false,
        decimal_places: 2
      };
    }
  }

  private selectProblemType(params: MoneyCombinationsDifficultyParams): string {
    return randomChoice(params.problem_types);
  }

  private generateFindCombinationsProblem(params: MoneyCombinationsDifficultyParams): MoneyCombinationsOutput {
    const targetAmount = this.generateTargetAmount(params);
    const combinations = this.findAllCombinations(targetAmount, params);
    
    // Limit to max combinations for display
    const displayCombinations = combinations.slice(0, params.max_combinations);

    return {
      operation: "MONEY_COMBINATIONS",
      problem_type: 'find_combinations',
      target_amount: targetAmount,
      available_denominations: params.available_denominations,
      combinations: displayCombinations,
      total_combinations: combinations.length,
      formatted_target: this.formatAmount(targetAmount)
    };
  }

  private generateMakeAmountProblem(params: MoneyCombinationsDifficultyParams): MoneyCombinationsOutput {
    const targetAmount = this.generateTargetAmount(params);
    const combinations = this.findAllCombinations(targetAmount, params);
    
    // Choose one specific combination to present
    const selectedCombination = randomChoice(combinations);

    return {
      operation: "MONEY_COMBINATIONS",
      problem_type: 'make_amount',
      target_amount: targetAmount,
      available_denominations: params.available_denominations,
      combinations: [selectedCombination],
      total_combinations: combinations.length,
      formatted_target: this.formatAmount(targetAmount),
      specific_combination: selectedCombination
    };
  }

  private generateEquivalentAmountsProblem(params: MoneyCombinationsDifficultyParams): MoneyCombinationsOutput {
    const targetAmount = this.generateTargetAmount(params);
    const combinations = this.findAllCombinations(targetAmount, params);
    
    // Show 2-3 different ways to make the same amount
    const equivalentCombinations = combinations.slice(0, 3);

    return {
      operation: "MONEY_COMBINATIONS",
      problem_type: 'equivalent_amounts',
      target_amount: targetAmount,
      available_denominations: params.available_denominations,
      combinations: equivalentCombinations,
      total_combinations: combinations.length,
      formatted_target: this.formatAmount(targetAmount)
    };
  }

  private generateCompareCombinationsProblem(params: MoneyCombinationsDifficultyParams): MoneyCombinationsOutput {
    const targetAmount = this.generateTargetAmount(params);
    const combinations = this.findAllCombinations(targetAmount, params);
    
    // Compare combinations by coin count or other criteria
    const sortedByCount = [...combinations].sort((a, b) => {
      const countA = a.reduce((sum, coin) => sum + coin.count, 0);
      const countB = b.reduce((sum, coin) => sum + coin.count, 0);
      return countA - countB;
    });

    const comparisonCombinations = sortedByCount.slice(0, 2);

    return {
      operation: "MONEY_COMBINATIONS",
      problem_type: 'compare_combinations',
      target_amount: targetAmount,
      available_denominations: params.available_denominations,
      combinations: comparisonCombinations,
      total_combinations: combinations.length,
      formatted_target: this.formatAmount(targetAmount),
      comparison_criteria: 'fewest_coins'
    };
  }

  private generateTargetAmount(params: MoneyCombinationsDifficultyParams): number {
    let amount = generateRandomNumber(
      params.target_amount_range.max,
      params.decimal_places,
      params.target_amount_range.min
    );

    // Ensure the amount can be made with available denominations
    if (params.require_exact_combinations) {
      // Round to a value that can be made with available coins
      const minDenom = Math.min(...params.available_denominations);
      amount = Math.round(amount / minDenom) * minDenom;
    }

    return amount;
  }

  private findAllCombinations(
    targetAmount: number, 
    params: MoneyCombinationsDifficultyParams
  ): Array<Array<{ denomination: number; count: number; formatted: string }>> {
    const denominations = [...params.available_denominations].sort((a, b) => b - a);
    const combinations: Array<Array<{ denomination: number; count: number; formatted: string }>> = [];
    
    this.findCombinationsRecursive(
      Math.round(targetAmount), // Work in pence
      denominations,
      [],
      combinations,
      0
    );

    // Limit combinations to prevent excessive computation
    return combinations.slice(0, 10);
  }

  private findCombinationsRecursive(
    remaining: number,
    denominations: number[],
    currentCombination: Array<{ denomination: number; count: number }>,
    allCombinations: Array<Array<{ denomination: number; count: number; formatted: string }>>,
    denomIndex: number
  ): void {
    if (remaining === 0) {
      // Found a valid combination
      const formattedCombination = currentCombination
        .filter(coin => coin.count > 0)
        .map(coin => ({
          ...coin,
          formatted: this.formatDenomination(coin.denomination)
        }));
      
      if (formattedCombination.length > 0) {
        allCombinations.push(formattedCombination);
      }
      return;
    }

    if (denomIndex >= denominations.length || remaining < 0) {
      return;
    }

    const denom = denominations[denomIndex];
    const maxCount = Math.floor(remaining / denom);

    // Try different counts of this denomination
    for (let count = maxCount; count >= 0; count--) {
      const newCombination = [
        ...currentCombination,
        { denomination: denom, count }
      ];

      this.findCombinationsRecursive(
        remaining - (count * denom),
        denominations,
        newCombination,
        allCombinations,
        denomIndex + 1
      );
    }
  }

  private formatAmount(amount: number): string {
    if (amount >= 100) {
      const pounds = Math.floor(amount / 100);
      const pence = amount % 100;
      if (pence === 0) {
        return `£${pounds}`;
      }
      return `£${pounds}.${pence.toString().padStart(2, '0')}`;
    }
    return `${amount}p`;
  }

  private formatDenomination(denominationInPence: number): string {
    if (denominationInPence >= 100) {
      const pounds = denominationInPence / 100;
      return `£${pounds}`;
    }
    return `${denominationInPence}p`;
  }

  // Helper method to get the most efficient combination (fewest coins)
  getMostEfficientCombination(
    targetAmount: number, 
    params: MoneyCombinationsDifficultyParams
  ): Array<{ denomination: number; count: number; formatted: string }> {
    const combinations = this.findAllCombinations(targetAmount, params);
    
    if (combinations.length === 0) return [];

    // Find combination with fewest total coins
    return combinations.reduce((best, current) => {
      const bestCount = best.reduce((sum, coin) => sum + coin.count, 0);
      const currentCount = current.reduce((sum, coin) => sum + coin.count, 0);
      return currentCount < bestCount ? current : best;
    });
  }
}
```
--- END FILE: lib\math-engine\models\money-combinations.model.ts ---

--- START FILE: lib\math-engine\models\money-fractions.model.ts ---
```typescript
import {
  IMathModel,
  MoneyFractionsDifficultyParams,
  MoneyFractionsOutput
} from '@/lib/types';
import {
  randomChoice,
  generateRandomNumber
} from '@/lib/utils';

export class MoneyFractionsModel implements IMathModel<MoneyFractionsDifficultyParams, MoneyFractionsOutput> {
  public readonly model_id = "MONEY_FRACTIONS";

  private static readonly COMMON_FRACTIONS = [
    { numerator: 1, denominator: 2, decimal: 0.5, name: 'half' },
    { numerator: 1, denominator: 3, decimal: 0.333333, name: 'third' },
    { numerator: 1, denominator: 4, decimal: 0.25, name: 'quarter' },
    { numerator: 1, denominator: 5, decimal: 0.2, name: 'fifth' },
    { numerator: 1, denominator: 10, decimal: 0.1, name: 'tenth' },
    { numerator: 2, denominator: 3, decimal: 0.666667, name: 'two thirds' },
    { numerator: 3, denominator: 4, decimal: 0.75, name: 'three quarters' },
    { numerator: 2, denominator: 5, decimal: 0.4, name: 'two fifths' },
    { numerator: 3, denominator: 5, decimal: 0.6, name: 'three fifths' },
    { numerator: 4, denominator: 5, decimal: 0.8, name: 'four fifths' }
  ];

  generate(params: MoneyFractionsDifficultyParams): MoneyFractionsOutput {
    const problemType = this.selectProblemType(params);
    
    switch (problemType) {
      case 'fraction_of_amount':
        return this.generateFractionOfAmountProblem(params);
      case 'find_whole_from_fraction':
        return this.generateFindWholeFromFractionProblem(params);
      case 'compare_fractional_amounts':
        return this.generateCompareFractionalAmountsProblem(params);
      case 'add_fractional_money':
        return this.generateAddFractionalMoneyProblem(params);
      default:
        return this.generateFractionOfAmountProblem(params);
    }
  }

  getDefaultParams(year: number): MoneyFractionsDifficultyParams {
    if (year <= 3) {
      return {
        amount_range: { min: 4, max: 20 }, // £4 to £20 - easily divisible amounts
        allowed_fractions: [
          { numerator: 1, denominator: 2 },
          { numerator: 1, denominator: 4 }
        ],
        problem_types: ['fraction_of_amount'],
        decimal_places: 2,
        ensure_whole_results: true,
        include_word_problems: true,
        max_fraction_complexity: 4
      };
    } else if (year <= 4) {
      return {
        amount_range: { min: 6, max: 50 },
        allowed_fractions: [
          { numerator: 1, denominator: 2 },
          { numerator: 1, denominator: 3 },
          { numerator: 1, denominator: 4 },
          { numerator: 1, denominator: 5 },
          { numerator: 3, denominator: 4 }
        ],
        problem_types: ['fraction_of_amount', 'find_whole_from_fraction'],
        decimal_places: 2,
        ensure_whole_results: false,
        include_word_problems: true,
        max_fraction_complexity: 5
      };
    } else {
      return {
        amount_range: { min: 10, max: 100 },
        allowed_fractions: [
          { numerator: 1, denominator: 2 },
          { numerator: 1, denominator: 3 },
          { numerator: 1, denominator: 4 },
          { numerator: 1, denominator: 5 },
          { numerator: 1, denominator: 10 },
          { numerator: 2, denominator: 3 },
          { numerator: 3, denominator: 4 },
          { numerator: 2, denominator: 5 },
          { numerator: 3, denominator: 5 }
        ],
        problem_types: ['fraction_of_amount', 'find_whole_from_fraction', 'compare_fractional_amounts', 'add_fractional_money'],
        decimal_places: 2,
        ensure_whole_results: false,
        include_word_problems: true,
        max_fraction_complexity: 10
      };
    }
  }

  private selectProblemType(params: MoneyFractionsDifficultyParams): string {
    return randomChoice(params.problem_types);
  }

  private generateFractionOfAmountProblem(params: MoneyFractionsDifficultyParams): MoneyFractionsOutput {
    const fraction = this.selectFraction(params);
    const wholeAmount = this.generateWholeAmount(params, fraction);
    const result = this.calculateFractionOfAmount(wholeAmount, fraction, params);

    return {
      operation: "MONEY_FRACTIONS",
      problem_type: 'fraction_of_amount',
      whole_amount: wholeAmount,
      fraction: fraction,
      result: result,
      formatted_whole: this.formatMoneyAmount(wholeAmount),
      formatted_fraction: this.formatFraction(fraction),
      formatted_result: this.formatMoneyAmount(result),
      fraction_name: this.getFractionName(fraction),
      calculation_steps: this.getCalculationSteps(wholeAmount, fraction, result)
    };
  }

  private generateFindWholeFromFractionProblem(params: MoneyFractionsDifficultyParams): MoneyFractionsOutput {
    const fraction = this.selectFraction(params);
    const wholeAmount = this.generateWholeAmount(params, fraction);
    const fractionalAmount = this.calculateFractionOfAmount(wholeAmount, fraction, params);

    return {
      operation: "MONEY_FRACTIONS",
      problem_type: 'find_whole_from_fraction',
      whole_amount: wholeAmount,
      fraction: fraction,
      fractional_amount: fractionalAmount,
      result: wholeAmount,
      formatted_whole: this.formatMoneyAmount(wholeAmount),
      formatted_fraction: this.formatFraction(fraction),
      formatted_fractional_amount: this.formatMoneyAmount(fractionalAmount),
      formatted_result: this.formatMoneyAmount(wholeAmount),
      fraction_name: this.getFractionName(fraction)
    };
  }

  private generateCompareFractionalAmountsProblem(params: MoneyFractionsDifficultyParams): MoneyFractionsOutput {
    const baseAmount = this.generateWholeAmount(params);
    const fraction1 = this.selectFraction(params);
    const fraction2 = this.selectFraction(params, [fraction1]);

    const amount1 = this.calculateFractionOfAmount(baseAmount, fraction1, params);
    const amount2 = this.calculateFractionOfAmount(baseAmount, fraction2, params);

    const comparison = amount1 > amount2 ? 'first_greater' : 
                      amount1 < amount2 ? 'second_greater' : 'equal';

    return {
      operation: "MONEY_FRACTIONS",
      problem_type: 'compare_fractional_amounts',
      base_amount: baseAmount,
      fraction1: fraction1,
      fraction2: fraction2,
      amount1: amount1,
      amount2: amount2,
      comparison_result: comparison,
      formatted_base: this.formatMoneyAmount(baseAmount),
      formatted_fraction1: this.formatFraction(fraction1),
      formatted_fraction2: this.formatFraction(fraction2),
      formatted_amount1: this.formatMoneyAmount(amount1),
      formatted_amount2: this.formatMoneyAmount(amount2)
    };
  }

  private generateAddFractionalMoneyProblem(params: MoneyFractionsDifficultyParams): MoneyFractionsOutput {
    const baseAmount = this.generateWholeAmount(params);
    const fraction1 = this.selectFraction(params);
    const fraction2 = this.selectFraction(params);

    const amount1 = this.calculateFractionOfAmount(baseAmount, fraction1, params);
    const amount2 = this.calculateFractionOfAmount(baseAmount, fraction2, params);
    const result = amount1 + amount2;

    return {
      operation: "MONEY_FRACTIONS",
      problem_type: 'add_fractional_money',
      base_amount: baseAmount,
      fraction1: fraction1,
      fraction2: fraction2,
      amount1: amount1,
      amount2: amount2,
      result: result,
      formatted_base: this.formatMoneyAmount(baseAmount),
      formatted_fraction1: this.formatFraction(fraction1),
      formatted_fraction2: this.formatFraction(fraction2),
      formatted_amount1: this.formatMoneyAmount(amount1),
      formatted_amount2: this.formatMoneyAmount(amount2),
      formatted_result: this.formatMoneyAmount(result)
    };
  }

  private selectFraction(
    params: MoneyFractionsDifficultyParams, 
    exclude: Array<{ numerator: number; denominator: number }> = []
  ): { numerator: number; denominator: number } {
    const available = params.allowed_fractions.filter(f => 
      !exclude.some(ex => ex.numerator === f.numerator && ex.denominator === f.denominator)
    );
    
    return available.length > 0 ? randomChoice(available) : params.allowed_fractions[0];
  }

  private generateWholeAmount(
    params: MoneyFractionsDifficultyParams, 
    fraction?: { numerator: number; denominator: number }
  ): number {
    let amount = generateRandomNumber(
      params.amount_range.max,
      params.decimal_places,
      params.amount_range.min
    );

    // If we need whole results and have a fraction, ensure divisibility
    if (params.ensure_whole_results && fraction) {
      // Make sure the amount is divisible by the denominator
      const remainder = amount % fraction.denominator;
      if (remainder !== 0) {
        amount += (fraction.denominator - remainder);
      }
      
      // Ensure it's still within range
      if (amount > params.amount_range.max) {
        amount = params.amount_range.max - (params.amount_range.max % fraction.denominator);
      }
    }

    return amount;
  }

  private calculateFractionOfAmount(
    amount: number, 
    fraction: { numerator: number; denominator: number },
    params: MoneyFractionsDifficultyParams
  ): number {
    const result = (amount * fraction.numerator) / fraction.denominator;
    return Math.round(result * Math.pow(10, params.decimal_places)) / Math.pow(10, params.decimal_places);
  }

  private formatMoneyAmount(amount: number): string {
    if (amount >= 100) {
      return `£${(amount / 100).toFixed(2)}`;
    }
    return `${amount}p`;
  }

  private formatFraction(fraction: { numerator: number; denominator: number }): string {
    return `${fraction.numerator}/${fraction.denominator}`;
  }

  private getFractionName(fraction: { numerator: number; denominator: number }): string {
    const commonFraction = MoneyFractionsModel.COMMON_FRACTIONS.find(f => 
      f.numerator === fraction.numerator && f.denominator === fraction.denominator
    );
    
    return commonFraction ? commonFraction.name : this.formatFraction(fraction);
  }

  private getCalculationSteps(
    wholeAmount: number, 
    fraction: { numerator: number; denominator: number },
    result: number
  ): Array<{ step: string; calculation: string; result: string }> {
    const steps: Array<{ step: string; calculation: string; result: string }> = [];

    if (fraction.denominator !== 1) {
      steps.push({
        step: `Divide by ${fraction.denominator}`,
        calculation: `${this.formatMoneyAmount(wholeAmount)} ÷ ${fraction.denominator}`,
        result: this.formatMoneyAmount(wholeAmount / fraction.denominator)
      });
    }

    if (fraction.numerator !== 1) {
      steps.push({
        step: `Multiply by ${fraction.numerator}`,
        calculation: `${this.formatMoneyAmount(wholeAmount / fraction.denominator)} × ${fraction.numerator}`,
        result: this.formatMoneyAmount(result)
      });
    }

    return steps;
  }

  // Helper method to check if fraction results in whole money amount
  isWholeFraction(amount: number, fraction: { numerator: number; denominator: number }): boolean {
    const result = (amount * fraction.numerator) / fraction.denominator;
    return result === Math.floor(result);
  }

  // Helper method to find suitable amounts for a given fraction
  findSuitableAmounts(
    fraction: { numerator: number; denominator: number },
    range: { min: number; max: number },
    count: number = 5
  ): number[] {
    const amounts: number[] = [];
    
    for (let i = range.min; i <= range.max && amounts.length < count; i++) {
      if (i % fraction.denominator === 0) {
        amounts.push(i);
      }
    }
    
    return amounts;
  }
}
```
--- END FILE: lib\math-engine\models\money-fractions.model.ts ---

--- START FILE: lib\math-engine\models\money-scaling.model.ts ---
```typescript
import {
  IMathModel,
  MoneyScalingDifficultyParams,
  MoneyScalingOutput
} from '@/lib/types';
import {
  randomChoice,
  generateRandomNumber
} from '@/lib/utils';

export class MoneyScalingModel implements IMathModel<MoneyScalingDifficultyParams, MoneyScalingOutput> {
  public readonly model_id = "MONEY_SCALING";

  generate(params: MoneyScalingDifficultyParams): MoneyScalingOutput {
    const problemType = this.selectProblemType(params);
    
    switch (problemType) {
      case 'scale_up':
        return this.generateScaleUpProblem(params);
      case 'scale_down':
        return this.generateScaleDownProblem(params);
      case 'proportional_reasoning':
        return this.generateProportionalReasoningProblem(params);
      case 'rate_problems':
        return this.generateRateProblem(params);
      default:
        return this.generateScaleUpProblem(params);
    }
  }

  getDefaultParams(year: number): MoneyScalingDifficultyParams {
    if (year <= 3) {
      return {
        base_amount_range: { min: 5, max: 50 },
        scale_factor_range: { min: 2, max: 5 },
        problem_types: ['scale_up', 'scale_down'],
        decimal_places: 2,
        include_fractional_scaling: false,
        allow_complex_ratios: false,
        context_types: ['shopping', 'bulk_buying']
      };
    } else if (year <= 4) {
      return {
        base_amount_range: { min: 10, max: 100 },
        scale_factor_range: { min: 2, max: 10 },
        problem_types: ['scale_up', 'scale_down', 'proportional_reasoning'],
        decimal_places: 2,
        include_fractional_scaling: true,
        allow_complex_ratios: false,
        context_types: ['shopping', 'bulk_buying', 'recipe_scaling', 'group_activities']
      };
    } else {
      return {
        base_amount_range: { min: 10, max: 500 },
        scale_factor_range: { min: 1.5, max: 20 },
        problem_types: ['scale_up', 'scale_down', 'proportional_reasoning', 'rate_problems'],
        decimal_places: 2,
        include_fractional_scaling: true,
        allow_complex_ratios: true,
        context_types: ['shopping', 'bulk_buying', 'recipe_scaling', 'group_activities', 'business', 'savings']
      };
    }
  }

  private selectProblemType(params: MoneyScalingDifficultyParams): string {
    return randomChoice(params.problem_types);
  }

  private generateScaleUpProblem(params: MoneyScalingDifficultyParams): MoneyScalingOutput {
    const baseAmount = this.generateBaseAmount(params);
    const scaleFactor = this.generateScaleFactor(params);
    const scaledAmount = this.calculateScaledAmount(baseAmount, scaleFactor, params);
    
    const context = this.generateContext(params, 'scale_up');

    return {
      operation: "MONEY_SCALING",
      problem_type: 'scale_up',
      base_amount: baseAmount,
      scale_factor: scaleFactor,
      scaled_amount: scaledAmount,
      context: context,
      formatted_base: this.formatMoneyAmount(baseAmount),
      formatted_scaled: this.formatMoneyAmount(scaledAmount),
      formatted_scale_factor: this.formatScaleFactor(scaleFactor),
      calculation: `${this.formatMoneyAmount(baseAmount)} × ${this.formatScaleFactor(scaleFactor)} = ${this.formatMoneyAmount(scaledAmount)}`
    };
  }

  private generateScaleDownProblem(params: MoneyScalingDifficultyParams): MoneyScalingOutput {
    const scaleFactor = this.generateScaleFactor(params);
    const baseAmount = this.generateBaseAmount(params);
    const originalAmount = this.calculateScaledAmount(baseAmount, scaleFactor, params);
    
    const context = this.generateContext(params, 'scale_down');

    return {
      operation: "MONEY_SCALING",
      problem_type: 'scale_down',
      base_amount: baseAmount,
      scale_factor: 1 / scaleFactor,
      original_amount: originalAmount,
      scaled_amount: baseAmount,
      context: context,
      formatted_base: this.formatMoneyAmount(baseAmount),
      formatted_original: this.formatMoneyAmount(originalAmount),
      formatted_scale_factor: this.formatScaleFactor(1 / scaleFactor),
      calculation: `${this.formatMoneyAmount(originalAmount)} ÷ ${this.formatScaleFactor(scaleFactor)} = ${this.formatMoneyAmount(baseAmount)}`
    };
  }

  private generateProportionalReasoningProblem(params: MoneyScalingDifficultyParams): MoneyScalingOutput {
    const baseQuantity = generateRandomNumber(10, 0, 2);
    const baseAmount = this.generateBaseAmount(params);
    const newQuantity = generateRandomNumber(20, 0, baseQuantity + 1);
    
    const unitCost = baseAmount / baseQuantity;
    const newAmount = unitCost * newQuantity;
    
    const context = this.generateProportionalContext(params);

    return {
      operation: "MONEY_SCALING",
      problem_type: 'proportional_reasoning',
      base_quantity: baseQuantity,
      base_amount: baseAmount,
      new_quantity: newQuantity,
      new_amount: Math.round(newAmount * 100) / 100,
      unit_cost: Math.round(unitCost * 100) / 100,
      context: context,
      formatted_base: this.formatMoneyAmount(baseAmount),
      formatted_new: this.formatMoneyAmount(Math.round(newAmount * 100) / 100),
      formatted_unit_cost: this.formatMoneyAmount(Math.round(unitCost * 100) / 100),
      calculation: `${baseQuantity} items cost ${this.formatMoneyAmount(baseAmount)}, so ${newQuantity} items cost ${this.formatMoneyAmount(Math.round(newAmount * 100) / 100)}`
    };
  }

  private generateRateProblem(params: MoneyScalingDifficultyParams): MoneyScalingOutput {
    const timeUnit = randomChoice(['hour', 'day', 'week']);
    const rate = this.generateBaseAmount(params);
    const timeAmount = generateRandomNumber(10, 0, 2);
    
    const totalAmount = this.calculateScaledAmount(rate, timeAmount, params);
    
    const context = this.generateRateContext(params, timeUnit);

    return {
      operation: "MONEY_SCALING",
      problem_type: 'rate_problems',
      rate: rate,
      time_amount: timeAmount,
      time_unit: timeUnit,
      total_amount: totalAmount,
      context: context,
      formatted_rate: this.formatMoneyAmount(rate),
      formatted_total: this.formatMoneyAmount(totalAmount),
      calculation: `${this.formatMoneyAmount(rate)} per ${timeUnit} × ${timeAmount} ${timeUnit}s = ${this.formatMoneyAmount(totalAmount)}`
    };
  }

  private generateBaseAmount(params: MoneyScalingDifficultyParams): number {
    return generateRandomNumber(
      params.base_amount_range.max,
      params.decimal_places,
      params.base_amount_range.min
    );
  }

  private generateScaleFactor(params: MoneyScalingDifficultyParams): number {
    let factor = generateRandomNumber(
      params.scale_factor_range.max,
      params.include_fractional_scaling ? 1 : 0,
      params.scale_factor_range.min
    );

    // For fractional scaling, sometimes use common fractions
    if (params.include_fractional_scaling && Math.random() < 0.3) {
      const commonFractions = [0.5, 0.25, 0.75, 1.5, 2.5, 3.5];
      factor = randomChoice(commonFractions.filter(f => 
        f >= params.scale_factor_range.min && f <= params.scale_factor_range.max
      ));
    }

    return factor;
  }

  private calculateScaledAmount(baseAmount: number, scaleFactor: number, params: MoneyScalingDifficultyParams): number {
    const result = baseAmount * scaleFactor;
    return Math.round(result * Math.pow(10, params.decimal_places)) / Math.pow(10, params.decimal_places);
  }

  private generateContext(params: MoneyScalingDifficultyParams, problemType: string): string {
    const contextType = randomChoice(params.context_types);
    
    switch (contextType) {
      case 'shopping':
        return problemType === 'scale_up' ? 
          'buying multiple items at the store' : 
          'calculating individual item cost from bulk purchase';
      
      case 'bulk_buying':
        return problemType === 'scale_up' ? 
          'ordering in larger quantities' : 
          'finding single unit cost from bulk price';
      
      case 'recipe_scaling':
        return problemType === 'scale_up' ? 
          'making a bigger batch of the recipe' : 
          'reducing recipe portion size';
      
      case 'group_activities':
        return problemType === 'scale_up' ? 
          'calculating costs for more people' : 
          'finding cost per person';
      
      case 'business':
        return problemType === 'scale_up' ? 
          'increasing production volume' : 
          'calculating unit production costs';
      
      case 'savings':
        return problemType === 'scale_up' ? 
          'saving for longer periods' : 
          'calculating daily saving amounts';
      
      default:
        return 'general scaling calculation';
    }
  }

  private generateProportionalContext(params: MoneyScalingDifficultyParams): string {
    const contexts = [
      'comparing different package sizes',
      'calculating costs for different group sizes',
      'finding the better value deal',
      'determining unit pricing',
      'scaling recipe costs'
    ];
    
    return randomChoice(contexts);
  }

  private generateRateContext(params: MoneyScalingDifficultyParams, timeUnit: string): string {
    const contexts = {
      hour: ['hourly wage calculation', 'parking fee calculation', 'rental cost calculation'],
      day: ['daily expense planning', 'vacation budget calculation', 'subscription cost calculation'],
      week: ['weekly allowance calculation', 'weekly shopping budget', 'weekly activity costs']
    };
    
    return randomChoice(contexts[timeUnit as keyof typeof contexts] || contexts.hour);
  }

  private formatMoneyAmount(amount: number): string {
    if (amount >= 100) {
      return `£${(amount / 100).toFixed(2)}`;
    }
    return `${amount}p`;
  }

  private formatScaleFactor(factor: number): string {
    if (factor === Math.floor(factor)) {
      return factor.toString();
    }
    return factor.toFixed(1);
  }

  // Helper method to find good scaling combinations
  findReasonableScalings(
    baseAmount: number, 
    params: MoneyScalingDifficultyParams
  ): Array<{ factor: number; result: number }> {
    const scalings: Array<{ factor: number; result: number }> = [];
    
    for (let factor = params.scale_factor_range.min; factor <= params.scale_factor_range.max; factor += 0.5) {
      const result = this.calculateScaledAmount(baseAmount, factor, params);
      
      // Check if result is reasonable (not too complex decimals)
      if (result < 1000 && (result === Math.floor(result) || result.toFixed(2) === result.toString())) {
        scalings.push({ factor, result });
      }
    }
    
    return scalings;
  }

  // Helper method to determine if scaling results in "nice" numbers
  isNiceScaling(baseAmount: number, scaleFactor: number): boolean {
    const result = baseAmount * scaleFactor;
    
    // Check if result is a whole number or has at most 2 decimal places
    const rounded = Math.round(result * 100) / 100;
    return Math.abs(result - rounded) < 0.001;
  }
}
```
--- END FILE: lib\math-engine\models\money-scaling.model.ts ---

--- START FILE: lib\math-engine\models\multi-step.model.ts ---
```typescript
import {
  IMathModel,
  MultiStepDifficultyParams,
  MultiStepOutput,
  StepResult
} from '@/lib/types';
import {
  randomChoice,
  generateRandomNumber
} from '@/lib/utils';
import { getModel } from '../index';

export class MultiStepModel implements IMathModel<MultiStepDifficultyParams, MultiStepOutput> {
  public readonly model_id = "MULTI_STEP";

  generate(params: MultiStepDifficultyParams): MultiStepOutput {
    const steps = this.executeSequence(params);
    const finalResult = steps.length > 0 ? steps[steps.length - 1].result : 0;
    const intermediateResults = steps.slice(0, -1).map(step => step.result);

    return {
      operation: "MULTI_STEP",
      steps,
      final_result: finalResult,
      intermediate_results: intermediateResults
    };
  }

  getDefaultParams(year: number): MultiStepDifficultyParams {
    if (year <= 2) {
      return {
        operation_sequence: [
          {
            model: "ADDITION",
            params: { operand_count: 2, max_value: 10, decimal_places: 0, allow_carrying: false, value_constraints: { min: 1, step: 1 } },
            use_previous_result: false
          },
          {
            model: "SUBTRACTION", 
            params: { minuend_max: 20, subtrahend_max: 10, decimal_places: 0, allow_borrowing: false, ensure_positive: true, value_constraints: { step: 1 } },
            use_previous_result: true
          }
        ],
        max_steps: 2,
        intermediate_visibility: true
      };
    } else if (year <= 4) {
      return {
        operation_sequence: [
          {
            model: "MULTIPLICATION",
            params: { multiplicand_max: 10, multiplier_max: 5, decimal_places: year === 4 ? 2 : 0, operand_count: 2, use_fractions: false },
            use_previous_result: false
          },
          {
            model: "ADDITION",
            params: { operand_count: 2, max_value: 50, decimal_places: year === 4 ? 2 : 0, allow_carrying: true, value_constraints: { min: 1, step: year === 4 ? 0.01 : 1 } },
            use_previous_result: true
          },
          {
            model: "SUBTRACTION",
            params: { minuend_max: 100, subtrahend_max: 50, decimal_places: year === 4 ? 2 : 0, allow_borrowing: true, ensure_positive: true, value_constraints: { step: year === 4 ? 0.01 : 1 } },
            use_previous_result: true
          }
        ],
        max_steps: 3,
        intermediate_visibility: true
      };
    } else {
      return {
        operation_sequence: [
          {
            model: "MULTIPLICATION",
            params: { multiplicand_max: 20, multiplier_max: 10, decimal_places: 2, operand_count: 2, use_fractions: false },
            use_previous_result: false
          },
          {
            model: "ADDITION",
            params: { operand_count: 2, max_value: 100, decimal_places: 2, allow_carrying: true, value_constraints: { min: 1, step: 0.01 } },
            use_previous_result: true
          },
          {
            model: "SUBTRACTION", 
            params: { minuend_max: 200, subtrahend_max: 100, decimal_places: 2, allow_borrowing: true, ensure_positive: true, value_constraints: { step: 0.01 } },
            use_previous_result: true
          },
          {
            model: "DIVISION",
            params: { dividend_max: 100, divisor_max: 10, decimal_places: 2, allow_remainder: false, ensure_whole: false },
            use_previous_result: true
          }
        ],
        max_steps: 4,
        intermediate_visibility: true
      };
    }
  }

  private executeSequence(params: MultiStepDifficultyParams): StepResult[] {
    const steps: StepResult[] = [];
    let previousResult: number | null = null;

    const sequence = params.operation_sequence.slice(0, params.max_steps);

    for (let i = 0; i < sequence.length; i++) {
      const operation = sequence[i];
      
      try {
        const model = this.getModelSafe(operation.model);
        if (!model) {
          console.warn(`Model ${operation.model} not found, skipping step ${i + 1}`);
          continue;
        }

        // Modify parameters if using previous result
        let adjustedParams = { ...operation.params };
        if (operation.use_previous_result && previousResult !== null) {
          adjustedParams = this.adjustParamsForPreviousResult(
            operation.model, 
            adjustedParams, 
            previousResult
          );
        }

        const result = model.generate(adjustedParams);
        const stepResult = this.extractStepResult(i + 1, operation.model, result, previousResult);
        
        steps.push(stepResult);
        previousResult = stepResult.result;

      } catch (error) {
        console.warn(`Error in step ${i + 1} (${operation.model}):`, error);
        // Continue with fallback result
        const fallbackResult = previousResult || 10;
        steps.push({
          step: i + 1,
          operation: operation.model,
          inputs: [fallbackResult],
          result: fallbackResult
        });
        previousResult = fallbackResult;
      }
    }

    return steps;
  }

  private getModelSafe(modelId: string): any {
    try {
      return getModel(modelId as any);
    } catch {
      return null;
    }
  }

  private adjustParamsForPreviousResult(
    modelId: string, 
    params: any, 
    previousResult: number
  ): any {
    const roundedResult = Math.round(previousResult * 100) / 100;
    
    switch (modelId) {
      case 'ADDITION':
        // Use previous result as one of the operands
        return {
          ...params,
          operand_count: 2,
          // Generate one additional operand
          fixed_operand: roundedResult
        };
      
      case 'SUBTRACTION':
        // Use previous result as minuend or create a subtraction from it
        return {
          ...params,
          minuend_max: Math.max(roundedResult + 20, params.minuend_max),
          fixed_minuend: roundedResult
        };
      
      case 'MULTIPLICATION':
        // Use previous result as multiplicand
        return {
          ...params,
          multiplier_max: Math.min(params.multiplier_max, 10), // Keep multiplier reasonable
          fixed_multiplicand: roundedResult
        };
      
      case 'DIVISION':
        // Use previous result as dividend
        return {
          ...params,
          fixed_dividend: roundedResult,
          divisor_max: Math.min(Math.max(Math.floor(roundedResult / 2), 2), 10)
        };
      
      default:
        return params;
    }
  }

  private extractStepResult(
    stepNumber: number, 
    operation: string, 
    modelResult: any,
    previousInput: number | null
  ): StepResult {
    let inputs: number[] = [];
    let result: number = 0;

    switch (operation) {
      case 'ADDITION':
        inputs = modelResult.operands || [];
        result = modelResult.result || 0;
        break;
      
      case 'SUBTRACTION':
        inputs = [modelResult.minuend || 0, modelResult.subtrahend || 0];
        result = modelResult.result || 0;
        break;
      
      case 'MULTIPLICATION':
        inputs = [modelResult.multiplicand || 0, modelResult.multiplier || 0];
        result = modelResult.result || 0;
        break;
      
      case 'DIVISION':
        inputs = [modelResult.dividend || 0, modelResult.divisor || 0];
        result = modelResult.quotient || 0;
        break;
      
      default:
        inputs = previousInput !== null ? [previousInput] : [];
        result = modelResult.result || modelResult.final_result || 0;
    }

    return {
      step: stepNumber,
      operation,
      inputs,
      result: Math.round(result * 100) / 100
    };
  }
}
```
--- END FILE: lib\math-engine\models\multi-step.model.ts ---

--- START FILE: lib\math-engine\models\multiplication.model.ts ---
```typescript
import {
  IMathModel,
  MultiplicationDifficultyParams,
  MultiplicationOutput,
  DecimalFormatted
} from '@/lib/types';
import {
  generateRandomNumber,
  formatDecimal
} from '@/lib/utils';

export class MultiplicationModel implements IMathModel<MultiplicationDifficultyParams, MultiplicationOutput> {
  public readonly model_id = "MULTIPLICATION";

  generate(params: MultiplicationDifficultyParams): MultiplicationOutput {
    const factors = this.generateFactors(params);
    const result = this.calculateProduct(factors);
    const decimalFormatted = this.formatOutput(factors, result, params.decimal_places);

    return {
      operation: "MULTIPLICATION",
      multiplicand: factors[0],
      multiplier: factors.length > 1 ? factors[1] : 1,
      result,
      factors,
      decimal_formatted: decimalFormatted
    };
  }

  getDefaultParams(year: number): MultiplicationDifficultyParams {
    if (year <= 2) {
      return {
        multiplicand_max: 10,
        multiplier_max: 5,
        decimal_places: 0,
        operand_count: 2,
        use_fractions: false
      };
    } else if (year <= 4) {
      return {
        multiplicand_max: 100,
        multiplier_max: 10,
        decimal_places: year === 4 ? 2 : 0,
        operand_count: 2,
        use_fractions: false
      };
    } else {
      return {
        multiplicand_max: 1000,
        multiplier_max: 100,
        decimal_places: 3,
        operand_count: year === 6 ? 3 : 2,
        use_fractions: year === 6
      };
    }
  }

  private generateFactors(params: MultiplicationDifficultyParams): number[] {
    const factors: number[] = [];
    
    // Generate multiplicand
    factors.push(generateRandomNumber(
      params.multiplicand_max,
      params.use_fractions ? params.decimal_places : 0,
      1,
      params.use_fractions ? 0.01 : 1
    ));

    // Generate multiplier(s)
    for (let i = 1; i < params.operand_count; i++) {
      const max = i === 1 ? params.multiplier_max : 10; // Additional factors are smaller
      factors.push(generateRandomNumber(
        max,
        params.use_fractions && i === 1 ? params.decimal_places : 0,
        1,
        params.use_fractions && i === 1 ? 0.01 : 1
      ));
    }

    return factors;
  }

  private calculateProduct(factors: number[]): number {
    const product = factors.reduce((acc, val) => acc * val, 1);
    // Handle floating point precision
    return Math.round(product * 1000) / 1000;
  }

  private formatOutput(
    factors: number[],
    result: number,
    decimalPlaces: number
  ): DecimalFormatted {
    return {
      operands: factors.map(f => formatDecimal(f, decimalPlaces)),
      result: formatDecimal(result, decimalPlaces)
    };
  }
}
```
--- END FILE: lib\math-engine\models\multiplication.model.ts ---

--- START FILE: lib\math-engine\models\percentage.model.ts ---
```typescript
import {
  IMathModel,
  PercentageDifficultyParams,
  PercentageOutput
} from '@/lib/types';
import {
  generateRandomNumber,
  randomChoice
} from '@/lib/utils';

export class PercentageModel implements IMathModel<PercentageDifficultyParams, PercentageOutput> {
  public readonly model_id = "PERCENTAGE";

  generate(params: PercentageDifficultyParams): PercentageOutput {
    const baseValue = this.generateBaseValue(params);
    const percentage = this.selectPercentage(params);
    const { percentageAmount, result } = this.calculatePercentage(
      baseValue,
      percentage,
      params.operation_type
    );

    return {
      operation: "PERCENTAGE",
      operation_type: params.operation_type,
      base_value: baseValue,
      percentage,
      percentage_amount: percentageAmount,
      result
    };
  }

  getDefaultParams(year: number): PercentageDifficultyParams {
    if (year <= 4) {
      return {
        base_value_max: 100,
        percentage_values: [10, 50, 100],
        operation_type: "of",
        decimal_places: 0
      };
    } else if (year === 5) {
      return {
        base_value_max: 200,
        percentage_values: [10, 20, 25, 50, 75],
        operation_type: randomChoice(["of", "increase", "decrease"]),
        decimal_places: 2
      };
    } else {
      return {
        base_value_max: 500,
        percentage_values: [5, 10, 15, 20, 25, 30, 40, 50, 60, 75, 80],
        operation_type: randomChoice(["of", "increase", "decrease", "reverse"]),
        decimal_places: 2
      };
    }
  }

  private generateBaseValue(params: PercentageDifficultyParams): number {
    return generateRandomNumber(
      params.base_value_max,
      params.decimal_places,
      10,
      params.decimal_places > 0 ? 0.01 : 1
    );
  }

  private selectPercentage(params: PercentageDifficultyParams): number {
    return randomChoice(params.percentage_values);
  }

  private calculatePercentage(
    baseValue: number,
    percentage: number,
    operationType: string
  ): { percentageAmount: number; result: number } {
    const percentageAmount = (baseValue * percentage) / 100;
    let result: number;

    switch (operationType) {
      case "of":
        result = percentageAmount;
        break;
      case "increase":
        result = baseValue + percentageAmount;
        break;
      case "decrease":
        result = baseValue - percentageAmount;
        break;
      case "reverse":
        // Find original value before percentage was applied
        result = (baseValue * 100) / (100 - percentage);
        break;
      default:
        result = percentageAmount;
    }

    return {
      percentageAmount: Math.round(percentageAmount * 100) / 100,
      result: Math.round(result * 100) / 100
    };
  }
}
```
--- END FILE: lib\math-engine\models\percentage.model.ts ---

--- START FILE: lib\math-engine\models\subtraction.model.ts ---
```typescript
import {
  IMathModel,
  SubtractionDifficultyParams,
  SubtractionOutput,
  DecimalFormatted
} from '@/lib/types';
import {
  generateRandomNumber,
  formatDecimal,
  requiresBorrowing
} from '@/lib/utils';

export class SubtractionModel implements IMathModel<SubtractionDifficultyParams, SubtractionOutput> {
  public readonly model_id = "SUBTRACTION";

  generate(params: SubtractionDifficultyParams): SubtractionOutput {
    const { minuend, subtrahend } = this.generateOperands(params);
    const result = this.calculateDifference(minuend, subtrahend);
    const decimalFormatted = this.formatOutput(minuend, subtrahend, result, params.decimal_places);

    return {
      operation: "SUBTRACTION",
      minuend,
      subtrahend,
      result,
      decimal_formatted: decimalFormatted
    };
  }

  getDefaultParams(year: number): SubtractionDifficultyParams {
    if (year <= 2) {
      return {
        minuend_max: 20,
        subtrahend_max: 10,
        decimal_places: 0,
        allow_borrowing: false,
        ensure_positive: true,
        value_constraints: {
          step: 1
        }
      };
    } else if (year <= 4) {
      return {
        minuend_max: 100,
        subtrahend_max: 100,
        decimal_places: year === 4 ? 2 : 0,
        allow_borrowing: true,
        ensure_positive: true,
        value_constraints: {
          step: year === 4 ? 0.01 : 1
        }
      };
    } else {
      return {
        minuend_max: 1000,
        subtrahend_max: 1000,
        decimal_places: 3,
        allow_borrowing: true,
        ensure_positive: true,
        value_constraints: {
          step: 0.001
        }
      };
    }
  }

  private generateOperands(params: SubtractionDifficultyParams): { minuend: number; subtrahend: number } {
    let attempts = 0;
    const maxAttempts = 50;

    while (attempts < maxAttempts) {
      let minuend = generateRandomNumber(
        params.minuend_max,
        params.decimal_places,
        1,
        params.value_constraints.step
      );
      
      let subtrahend = generateRandomNumber(
        params.subtrahend_max,
        params.decimal_places,
        1,
        params.value_constraints.step
      );

      // Ensure positive result if required
      if (params.ensure_positive && subtrahend > minuend) {
        [minuend, subtrahend] = [subtrahend, minuend];
      }

      // Check borrowing requirement
      const needsBorrowing = requiresBorrowing(minuend, subtrahend);
      
      if (params.allow_borrowing || !needsBorrowing) {
        return { minuend, subtrahend };
      }

      attempts++;
    }

    // Fallback: ensure positive result
    let minuend = generateRandomNumber(
      params.minuend_max,
      params.decimal_places,
      1,
      params.value_constraints.step
    );
    
    let subtrahend = generateRandomNumber(
      Math.min(params.subtrahend_max, minuend),
      params.decimal_places,
      1,
      params.value_constraints.step
    );

    if (params.ensure_positive && subtrahend > minuend) {
      [minuend, subtrahend] = [subtrahend, minuend];
    }

    return { minuend, subtrahend };
  }

  private calculateDifference(minuend: number, subtrahend: number): number {
    const difference = minuend - subtrahend;
    // Handle floating point precision
    return Math.round(difference * 1000) / 1000;
  }

  private formatOutput(
    minuend: number,
    subtrahend: number,
    result: number,
    decimalPlaces: number
  ): DecimalFormatted {
    return {
      minuend: formatDecimal(minuend, decimalPlaces),
      subtrahend: formatDecimal(subtrahend, decimalPlaces),
      result: formatDecimal(result, decimalPlaces)
    };
  }
}
```
--- END FILE: lib\math-engine\models\subtraction.model.ts ---

--- START FILE: lib\math-engine\models\time-rate.model.ts ---
```typescript
import {
  IMathModel,
  TimeRateDifficultyParams,
  TimeRateOutput
} from '@/lib/types';
import {
  generateRandomNumber,
  randomChoice
} from '@/lib/utils';

export class TimeRateModel implements IMathModel<TimeRateDifficultyParams, TimeRateOutput> {
  public readonly model_id = "TIME_RATE";

  private static readonly PERIOD_MULTIPLIERS = {
    day: 1,
    week: 7,
    month: 30,
    year: 365
  };

  generate(params: TimeRateDifficultyParams): TimeRateOutput {
    const rate = this.generateRate(params);
    const calculation = this.generateCalculation(params, rate);

    return {
      operation: "TIME_RATE",
      rate: {
        value: rate.value,
        period: rate.period
      },
      calculation: {
        periods: calculation.periods,
        total_value: calculation.total_value
      },
      problem_type: params.problem_type
    };
  }

  getDefaultParams(year: number): TimeRateDifficultyParams {
    if (year <= 2) {
      return {
        rate_value_max: 10,
        rate_period: "day",
        target_value_max: 50,
        decimal_places: 0,
        problem_type: "total_after_time"
      };
    } else if (year <= 4) {
      return {
        rate_value_max: 50,
        rate_period: randomChoice(["day", "week"]),
        target_value_max: 200,
        decimal_places: 2,
        problem_type: randomChoice(["time_to_target", "total_after_time"])
      };
    } else {
      return {
        rate_value_max: 100,
        rate_period: randomChoice(["week", "month", "year"]),
        target_value_max: 1000,
        decimal_places: 2,
        problem_type: randomChoice(["time_to_target", "total_after_time", "rate_calculation"])
      };
    }
  }

  private generateRate(params: TimeRateDifficultyParams): {
    value: number;
    period: string;
  } {
    const value = generateRandomNumber(
      params.rate_value_max,
      params.decimal_places,
      0.01,
      params.decimal_places > 0 ? 0.01 : 1
    );

    return {
      value,
      period: params.rate_period
    };
  }

  private generateCalculation(
    params: TimeRateDifficultyParams,
    rate: { value: number; period: string }
  ): { periods: number; total_value: number } {
    switch (params.problem_type) {
      case "time_to_target":
        return this.calculateTimeToTarget(params, rate);
      
      case "total_after_time":
        return this.calculateTotalAfterTime(params, rate);
      
      case "rate_calculation":
        return this.calculateRateFromTotal(params, rate);
      
      default:
        return this.calculateTotalAfterTime(params, rate);
    }
  }

  private calculateTimeToTarget(
    params: TimeRateDifficultyParams,
    rate: { value: number; period: string }
  ): { periods: number; total_value: number } {
    // Generate a target value and calculate time needed
    const targetValue = generateRandomNumber(
      params.target_value_max,
      params.decimal_places,
      rate.value,
      params.decimal_places > 0 ? 0.01 : 1
    );

    const periods = Math.ceil(targetValue / rate.value);
    
    return {
      periods,
      total_value: targetValue
    };
  }

  private calculateTotalAfterTime(
    params: TimeRateDifficultyParams,
    rate: { value: number; period: string }
  ): { periods: number; total_value: number } {
    // Generate a time period and calculate total
    const maxPeriods = Math.floor(params.target_value_max / rate.value);
    const periods = Math.max(1, Math.floor(Math.random() * Math.min(maxPeriods, 52)) + 1);
    
    const totalValue = periods * rate.value;
    
    return {
      periods,
      total_value: Math.round(totalValue * 100) / 100
    };
  }

  private calculateRateFromTotal(
    params: TimeRateDifficultyParams,
    rate: { value: number; period: string }
  ): { periods: number; total_value: number } {
    // Generate total and periods, calculate rate (rate is given in this case)
    const periods = Math.floor(Math.random() * 20) + 2;
    const totalValue = periods * rate.value;
    
    return {
      periods,
      total_value: Math.round(totalValue * 100) / 100
    };
  }

  // Helper method to get period display name
  static getPeriodDisplayName(period: string, count: number = 1): string {
    const names = {
      day: count === 1 ? 'day' : 'days',
      week: count === 1 ? 'week' : 'weeks',
      month: count === 1 ? 'month' : 'months',
      year: count === 1 ? 'year' : 'years'
    };
    
    return names[period as keyof typeof names] || period;
  }

  // Helper method to convert between periods
  static convertPeriods(
    fromPeriod: string,
    toPeriod: string,
    value: number
  ): number {
    const fromDays = TimeRateModel.PERIOD_MULTIPLIERS[fromPeriod as keyof typeof TimeRateModel.PERIOD_MULTIPLIERS];
    const toDays = TimeRateModel.PERIOD_MULTIPLIERS[toPeriod as keyof typeof TimeRateModel.PERIOD_MULTIPLIERS];
    
    if (!fromDays || !toDays) return value;
    
    return Math.round((value * fromDays / toDays) * 100) / 100;
  }
}
```
--- END FILE: lib\math-engine\models\time-rate.model.ts ---

--- START FILE: lib\math-engine\models\unit-rate.model.ts ---
```typescript
import {
  IMathModel,
  UnitRateDifficultyParams,
  UnitRateOutput
} from '@/lib/types';
import {
  randomChoice,
  generateRandomNumber
} from '@/lib/utils';

export class UnitRateModel implements IMathModel<UnitRateDifficultyParams, UnitRateOutput> {
  public readonly model_id = "UNIT_RATE";

  private static readonly RATE_CONTEXTS = {
    speed: { unit: 'km/h', items: ['car', 'bike', 'bus', 'train'] },
    cost: { unit: '£/item', items: ['apple', 'book', 'pencil', 'toy'] },
    production: { unit: 'items/hour', items: ['widget', 'cake', 'bottle', 'box'] },
    consumption: { unit: 'litres/100km', items: ['car', 'van', 'truck', 'motorbike'] },
    wage: { unit: '£/hour', items: ['job', 'work', 'position', 'role'] }
  };

  generate(params: UnitRateDifficultyParams): UnitRateOutput {
    const context = randomChoice(Object.keys(UnitRateModel.RATE_CONTEXTS));
    const contextData = UnitRateModel.RATE_CONTEXTS[context as keyof typeof UnitRateModel.RATE_CONTEXTS];
    
    const item = randomChoice(contextData.items);
    const baseQuantity = this.generateBaseQuantity(params);
    const baseRate = this.generateBaseRate(params);
    const unitRate = this.calculateUnitRate(baseRate, baseQuantity, params);
    
    // Generate target quantity for scaling
    const targetQuantity = this.generateTargetQuantity(params, baseQuantity);
    const scaledValue = this.calculateScaledValue(unitRate, targetQuantity, params);

    // Determine problem type
    const problemType = this.selectProblemType(params);

    return {
      operation: "UNIT_RATE",
      context,
      item,
      unit: contextData.unit,
      base_quantity: baseQuantity,
      base_rate: baseRate,
      unit_rate: unitRate,
      target_quantity: targetQuantity,
      scaled_value: scaledValue,
      problem_type: problemType,
      comparison_rates: this.generateComparisonRates(params, context, unitRate)
    };
  }

  getDefaultParams(year: number): UnitRateDifficultyParams {
    if (year <= 3) {
      return {
        base_quantity_range: { min: 2, max: 10 },
        base_rate_range: { min: 10, max: 50 },
        target_quantity_range: { min: 1, max: 20 },
        decimal_places: 0,
        allow_complex_rates: false,
        problem_types: ['find_unit_rate', 'scale_up'],
        include_comparisons: false,
        comparison_count: 0
      };
    } else if (year <= 4) {
      return {
        base_quantity_range: { min: 2, max: 20 },
        base_rate_range: { min: 5, max: 100 },
        target_quantity_range: { min: 1, max: 50 },
        decimal_places: 1,
        allow_complex_rates: false,
        problem_types: ['find_unit_rate', 'scale_up', 'scale_down'],
        include_comparisons: true,
        comparison_count: 2
      };
    } else {
      return {
        base_quantity_range: { min: 2, max: 50 },
        base_rate_range: { min: 1, max: 200 },
        target_quantity_range: { min: 1, max: 100 },
        decimal_places: 2,
        allow_complex_rates: true,
        problem_types: ['find_unit_rate', 'scale_up', 'scale_down', 'compare_rates', 'best_value'],
        include_comparisons: true,
        comparison_count: 3
      };
    }
  }

  private generateBaseQuantity(params: UnitRateDifficultyParams): number {
    return generateRandomNumber(
      params.base_quantity_range.max,
      0, // Quantities are typically whole numbers
      params.base_quantity_range.min
    );
  }

  private generateBaseRate(params: UnitRateDifficultyParams): number {
    return generateRandomNumber(
      params.base_rate_range.max,
      params.decimal_places,
      params.base_rate_range.min
    );
  }

  private generateTargetQuantity(params: UnitRateDifficultyParams, baseQuantity: number): number {
    let targetQuantity: number;
    let attempts = 0;
    
    do {
      targetQuantity = generateRandomNumber(
        params.target_quantity_range.max,
        0,
        params.target_quantity_range.min
      );
      attempts++;
      
      // Safety valve to prevent infinite loops
      if (attempts > 100) {
        targetQuantity = baseQuantity + 1; // Safe fallback
        if (targetQuantity > params.target_quantity_range.max) {
          targetQuantity = Math.max(params.target_quantity_range.min, baseQuantity - 1);
        }
        break;
      }
    } while (targetQuantity === baseQuantity); // Ensure different from base

    return targetQuantity;
  }

  private calculateUnitRate(baseRate: number, baseQuantity: number, params: UnitRateDifficultyParams): number {
    const rate = baseRate / baseQuantity;
    return Math.round(rate * Math.pow(10, params.decimal_places)) / Math.pow(10, params.decimal_places);
  }

  private calculateScaledValue(unitRate: number, targetQuantity: number, params: UnitRateDifficultyParams): number {
    const value = unitRate * targetQuantity;
    return Math.round(value * Math.pow(10, params.decimal_places)) / Math.pow(10, params.decimal_places);
  }

  private selectProblemType(params: UnitRateDifficultyParams): string {
    return randomChoice(params.problem_types);
  }

  private generateComparisonRates(
    params: UnitRateDifficultyParams, 
    context: string, 
    baseUnitRate: number
  ): Array<{ quantity: number; rate: number; unit_rate: number; better: boolean }> {
    if (!params.include_comparisons || params.comparison_count === 0) {
      return [];
    }

    const comparisons: Array<{ quantity: number; rate: number; unit_rate: number; better: boolean }> = [];
    
    for (let i = 0; i < params.comparison_count; i++) {
      const quantity = generateRandomNumber(
        params.base_quantity_range.max,
        0,
        params.base_quantity_range.min
      );
      
      // Generate a rate that creates either better or worse unit rate
      const isBetter = Math.random() > 0.5;
      const rateMultiplier = isBetter ? 
        generateRandomNumber(0.95, 2, 0.7) : // Better unit rate (lower cost or higher value)
        generateRandomNumber(1.4, 2, 1.05);  // Worse unit rate

      const rate = Math.round(baseUnitRate * quantity * rateMultiplier * Math.pow(10, params.decimal_places)) / Math.pow(10, params.decimal_places);
      const unitRate = this.calculateUnitRate(rate, quantity, params);
      
      // Determine if this is better based on context
      let better: boolean;
      if (context === 'cost') {
        better = unitRate < baseUnitRate; // Lower cost per unit is better
      } else if (context === 'consumption') {
        better = unitRate < baseUnitRate; // Lower consumption is better
      } else {
        better = unitRate > baseUnitRate; // Higher rate is generally better
      }

      comparisons.push({
        quantity,
        rate,
        unit_rate: unitRate,
        better
      });
    }

    return comparisons;
  }
}
```
--- END FILE: lib\math-engine\models\unit-rate.model.ts ---

--- START FILE: lib\models\model-status.ts ---
```typescript
export enum ModelStatus {
  COMPLETE = 'complete',
  WIP = 'wip',
  BROKEN = 'broken',
  PLANNED = 'planned'
}

export interface ModelStatusInfo {
  id: string;
  name: string;
  status: ModelStatus;
  description: string;
  curriculumAreas: string[];
  supportedYears: number[];
  lastTested?: string;
  knownIssues?: string[];
  completionNotes?: string;
}

/**
 * Central tracking of all mathematical model completion status
 * Based on implementation and testing results
 */
export const MODEL_STATUS_REGISTRY: { [modelId: string]: ModelStatusInfo } = {
  // Core Mathematical Models - Fully Working
  'ADDITION': {
    id: 'ADDITION',
    name: 'Addition',
    status: ModelStatus.COMPLETE,
    description: 'Adding numbers together with various difficulty levels',
    curriculumAreas: ['Addition, subtraction, multiplication and division (calculations)'],
    supportedYears: [1, 2, 3, 4, 5, 6],
    lastTested: '2024-09-04',
    completionNotes: 'Fully functional with decimal support and carrying'
  },

  'SUBTRACTION': {
    id: 'SUBTRACTION',
    name: 'Subtraction',
    status: ModelStatus.COMPLETE,
    description: 'Subtracting numbers with borrowing support',
    curriculumAreas: ['Addition, subtraction, multiplication and division (calculations)'],
    supportedYears: [1, 2, 3, 4, 5, 6],
    lastTested: '2024-09-04',
    completionNotes: 'Fully functional with borrowing and decimal support'
  },

  'MULTIPLICATION': {
    id: 'MULTIPLICATION',
    name: 'Multiplication',
    status: ModelStatus.COMPLETE,
    description: 'Times tables and multiplication problems',
    curriculumAreas: ['Addition, subtraction, multiplication and division (calculations)'],
    supportedYears: [2, 3, 4, 5, 6],
    lastTested: '2024-09-04',
    completionNotes: 'Supports times tables and complex multiplication'
  },

  'DIVISION': {
    id: 'DIVISION',
    name: 'Division',
    status: ModelStatus.COMPLETE,
    description: 'Division with quotients and remainders',
    curriculumAreas: ['Addition, subtraction, multiplication and division (calculations)'],
    supportedYears: [3, 4, 5, 6],
    lastTested: '2024-09-04',
    completionNotes: 'Handles remainders and decimal division'
  },

  'PERCENTAGE': {
    id: 'PERCENTAGE',
    name: 'Percentages',
    status: ModelStatus.COMPLETE,
    description: 'Percentage calculations and comparisons',
    curriculumAreas: ['Fractions (including decimals and percentages)'],
    supportedYears: [4, 5, 6],
    lastTested: '2024-09-04',
    completionNotes: 'Percentage of amounts, increases, decreases'
  },

  // Extended Mathematical Models - Working
  'FRACTION': {
    id: 'FRACTION',
    name: 'Fractions',
    status: ModelStatus.COMPLETE,
    description: 'Fraction calculations and conversions',
    curriculumAreas: ['Fractions (including decimals and percentages)'],
    supportedYears: [3, 4, 5, 6],
    lastTested: '2024-09-04',
    completionNotes: 'Common fractions with practical applications'
  },

  'COUNTING': {
    id: 'COUNTING',
    name: 'Counting & Coins',
    status: ModelStatus.COMPLETE,
    description: 'Coin counting and combinations',
    curriculumAreas: ['Number and place value', 'Measurement'],
    supportedYears: [1, 2, 3, 4],
    lastTested: '2024-09-04',
    completionNotes: 'UK coin denominations with optimal combinations'
  },

  'TIME_RATE': {
    id: 'TIME_RATE',
    name: 'Time & Rate',
    status: ModelStatus.COMPLETE,
    description: 'Time-based calculations and rates',
    curriculumAreas: ['Measurement'],
    supportedYears: [3, 4, 5, 6],
    lastTested: '2024-09-04',
    completionNotes: 'Savings over time and rate calculations'
  },

  'CONVERSION': {
    id: 'CONVERSION',
    name: 'Unit Conversion',
    status: ModelStatus.COMPLETE,
    description: 'Converting between different units',
    curriculumAreas: ['Measurement'],
    supportedYears: [3, 4, 5, 6],
    lastTested: '2024-09-04',
    completionNotes: 'Common UK unit conversions'
  },

  'COMPARISON': {
    id: 'COMPARISON',
    name: 'Comparisons',
    status: ModelStatus.COMPLETE,
    description: 'Comparing values and determining best deals',
    curriculumAreas: ['Addition, subtraction, multiplication and division (calculations)', 'Measurement'],
    supportedYears: [4, 5, 6],
    lastTested: '2024-09-04',
    completionNotes: 'Value comparison with reasoning'
  },

  // Advanced Models - Implementation Issues
  'MULTI_STEP': {
    id: 'MULTI_STEP',
    name: 'Multi-Step Problems',
    status: ModelStatus.COMPLETE,
    description: 'Problems requiring multiple calculations',
    curriculumAreas: ['Addition, subtraction, multiplication and division (calculations)'],
    supportedYears: [4, 5, 6],
    lastTested: '2024-09-04',
    completionNotes: 'Chains multiple operations successfully'
  },

  'LINEAR_EQUATION': {
    id: 'LINEAR_EQUATION',
    name: 'Linear Equations',
    status: ModelStatus.BROKEN,
    description: 'Basic algebra and linear relationships',
    curriculumAreas: ['Algebra'],
    supportedYears: [5, 6],
    lastTested: '2024-09-04',
    knownIssues: [
      'API requests timeout due to infinite loops',
      'generateRandomNumber parameter order issues',
      'Needs debugging of slope generation logic'
    ]
  },

  'UNIT_RATE': {
    id: 'UNIT_RATE',
    name: 'Unit Rates',
    status: ModelStatus.BROKEN,
    description: 'Rate calculations and value comparisons',
    curriculumAreas: ['Ratio and proportion'],
    supportedYears: [5, 6],
    lastTested: '2024-09-04',
    knownIssues: [
      'API requests timeout due to infinite loops',
      'generateRandomNumber parameter order issues',
      'Target quantity generation problems'
    ]
  },

  // Money Models - Newly Implemented
  'COIN_RECOGNITION': {
    id: 'COIN_RECOGNITION',
    name: 'Coin Recognition',
    status: ModelStatus.WIP,
    description: 'Identifying UK coins and notes',
    curriculumAreas: ['Measurement'],
    supportedYears: [1, 2, 3],
    lastTested: '2024-09-04',
    knownIssues: ['API timeout issues - needs testing']
  },

  'CHANGE_CALCULATION': {
    id: 'CHANGE_CALCULATION',
    name: 'Change Calculation',
    status: ModelStatus.WIP,
    description: 'Calculating change from purchases',
    curriculumAreas: ['Measurement'],
    supportedYears: [2, 3, 4, 5],
    lastTested: '2024-09-04',
    knownIssues: ['API timeout issues - needs testing']
  },

  'MONEY_COMBINATIONS': {
    id: 'MONEY_COMBINATIONS',
    name: 'Money Combinations',
    status: ModelStatus.WIP,
    description: 'Different ways to make the same amount',
    curriculumAreas: ['Measurement'],
    supportedYears: [2, 3, 4],
    lastTested: '2024-09-04',
    knownIssues: ['API timeout issues - needs testing']
  },

  'MIXED_MONEY_UNITS': {
    id: 'MIXED_MONEY_UNITS',
    name: 'Mixed Money Units',
    status: ModelStatus.WIP,
    description: 'Working with pounds and pence together',
    curriculumAreas: ['Measurement'],
    supportedYears: [3, 4, 5],
    lastTested: '2024-09-04',
    knownIssues: ['API timeout issues - needs testing']
  },

  'MONEY_FRACTIONS': {
    id: 'MONEY_FRACTIONS',
    name: 'Money Fractions',
    status: ModelStatus.WIP,
    description: 'Fractional amounts of money',
    curriculumAreas: ['Fractions (including decimals and percentages)', 'Measurement'],
    supportedYears: [4, 5, 6],
    lastTested: '2024-09-04',
    knownIssues: ['API timeout issues - needs testing']
  },

  'MONEY_SCALING': {
    id: 'MONEY_SCALING',
    name: 'Money Scaling',
    status: ModelStatus.WIP,
    description: 'Proportional money problems',
    curriculumAreas: ['Ratio and proportion', 'Measurement'],
    supportedYears: [5, 6],
    lastTested: '2024-09-04',
    knownIssues: ['API timeout issues - needs testing']
  }
};

/**
 * Get models by status
 */
export function getModelsByStatus(status: ModelStatus): ModelStatusInfo[] {
  return Object.values(MODEL_STATUS_REGISTRY).filter(model => model.status === status);
}

/**
 * Get models by year support
 */
export function getModelsByYear(year: number): ModelStatusInfo[] {
  return Object.values(MODEL_STATUS_REGISTRY).filter(
    model => model.supportedYears.includes(year)
  );
}

/**
 * Get models by curriculum area
 */
export function getModelsByCurriculumArea(area: string): ModelStatusInfo[] {
  return Object.values(MODEL_STATUS_REGISTRY).filter(
    model => model.curriculumAreas.some(currArea => 
      currArea.toLowerCase().includes(area.toLowerCase())
    )
  );
}

/**
 * Get completion summary statistics
 */
export function getCompletionStats() {
  const models = Object.values(MODEL_STATUS_REGISTRY);
  const total = models.length;
  const complete = models.filter(m => m.status === ModelStatus.COMPLETE).length;
  const wip = models.filter(m => m.status === ModelStatus.WIP).length;
  const broken = models.filter(m => m.status === ModelStatus.BROKEN).length;
  const planned = models.filter(m => m.status === ModelStatus.PLANNED).length;

  return {
    total,
    complete,
    wip,
    broken,
    planned,
    completionPercentage: Math.round((complete / total) * 100)
  };
}
```
--- END FILE: lib\models\model-status.ts ---

--- START FILE: lib\story-engine\contexts\money.context.ts ---
```typescript
import { StoryContext } from '@/lib/types';
import { randomChoice, getRandomName, MONEY_ITEMS } from '@/lib/utils';

export interface MoneyContext extends StoryContext {
  currency: string;
  currency_symbol: string;
  person: string;
  items: string[];
  shop_type?: string;
  payment_method?: string;
}

export class MoneyContextGenerator {
  private static readonly SHOP_TYPES = [
    'shop', 'store', 'market', 'bakery', 'bookshop', 
    'toy shop', 'sweet shop', 'stationery shop'
  ];

  private static readonly PAYMENT_METHODS = [
    'pays with', 'gives the shopkeeper', 'hands over'
  ];

  private static readonly ACTION_VERBS = {
    addition: ['buys', 'purchases', 'gets', 'picks up'],
    subtraction: ['spends', 'pays', 'gives'],
    multiplication: ['buys', 'orders', 'purchases'],
    division: ['shares', 'splits', 'divides equally']
  };

  static generate(operation: string): MoneyContext {
    const person = getRandomName();
    const itemCount = operation === 'ADDITION' ? randomChoice([2, 3, 4]) : 1;
    const items = this.selectItems(itemCount);
    
    return {
      unit_type: 'currency',
      unit_symbol: '£',
      currency: 'pounds',
      currency_symbol: '£',
      person,
      items,
      item_descriptors: items,
      shop_type: randomChoice(this.SHOP_TYPES),
      payment_method: randomChoice(this.PAYMENT_METHODS),
      action_verb: this.getActionVerb(operation),
      scenario_type: this.getScenarioType(operation)
    };
  }

  private static selectItems(count: number): string[] {
    const selected: string[] = [];
    const available = [...MONEY_ITEMS];
    
    for (let i = 0; i < count && available.length > 0; i++) {
      const index = Math.floor(Math.random() * available.length);
      selected.push(available[index]);
      available.splice(index, 1);
    }
    
    return selected;
  }

  private static getActionVerb(operation: string): string {
    const verbs = this.ACTION_VERBS[operation.toLowerCase()] || this.ACTION_VERBS.addition;
    return randomChoice(verbs);
  }

  private static getScenarioType(operation: string): string {
    switch (operation) {
      case 'SUBTRACTION':
        return randomChoice(['change', 'spending', 'saving']);
      case 'DIVISION':
        return 'sharing';
      case 'MULTIPLICATION':
        return 'bulk_purchase';
      case 'PERCENTAGE':
        return 'discount';
      default:
        return 'purchase';
    }
  }

  static formatMoney(value: number, includeSymbol: boolean = true): string {
    const formatted = value.toFixed(2);
    
    // Handle pence only (values less than 1)
    if (value < 1) {
      const pence = Math.round(value * 100);
      return includeSymbol ? `${pence}p` : `${pence} pence`;
    }
    
    // Handle pounds and pence
    const pounds = Math.floor(value);
    const pence = Math.round((value - pounds) * 100);
    
    if (pence === 0) {
      return includeSymbol ? `£${pounds}` : `${pounds} pound${pounds !== 1 ? 's' : ''}`;
    }
    
    if (includeSymbol) {
      return `£${formatted}`;
    }
    
    return `${pounds} pound${pounds !== 1 ? 's' : ''} and ${pence} pence`;
  }

  static generateChangeScenario(): {
    payment_amount: number;
    tendered_amount: number;
    payment_description: string;
  } {
    const payment = randomChoice([5, 10, 20, 50]);
    const costPercentage = randomChoice([0.3, 0.4, 0.5, 0.6, 0.7, 0.8]);
    const cost = Math.round(payment * costPercentage * 100) / 100;
    
    return {
      payment_amount: cost,
      tendered_amount: payment,
      payment_description: `a £${payment} note`
    };
  }
}
```
--- END FILE: lib\story-engine\contexts\money.context.ts ---

--- START FILE: lib\story-engine\story.engine.ts ---
```typescript
import {
  StoryContext,
  AdditionOutput,
  SubtractionOutput,
  MultiplicationOutput,
  DivisionOutput,
  PercentageOutput,
  FractionOutput,
  CountingOutput,
  TimeRateOutput,
  ConversionOutput,
  ComparisonOutput,
  MultiStepOutput,
  LinearEquationOutput,
  UnitRateOutput,
  isAdditionOutput,
  isSubtractionOutput,
  isMultiplicationOutput,
  isDivisionOutput
} from '@/lib/types';
import { MoneyContextGenerator } from './contexts/money.context';

export class StoryEngine {
  generateQuestion(mathOutput: any, context: StoryContext): string {
    if (isAdditionOutput(mathOutput)) {
      return this.generateAdditionQuestion(mathOutput, context);
    }
    if (isSubtractionOutput(mathOutput)) {
      return this.generateSubtractionQuestion(mathOutput, context);
    }
    if (isMultiplicationOutput(mathOutput)) {
      return this.generateMultiplicationQuestion(mathOutput, context);
    }
    if (isDivisionOutput(mathOutput)) {
      return this.generateDivisionQuestion(mathOutput, context);
    }
    if (mathOutput.operation === 'PERCENTAGE') {
      return this.generatePercentageQuestion(mathOutput as PercentageOutput, context);
    }
    if (mathOutput.operation === 'FRACTION') {
      return this.generateFractionQuestion(mathOutput as FractionOutput, context);
    }
    if (mathOutput.operation === 'COUNTING') {
      return this.generateCountingQuestion(mathOutput as CountingOutput, context);
    }
    if (mathOutput.operation === 'TIME_RATE') {
      return this.generateTimeRateQuestion(mathOutput as TimeRateOutput, context);
    }
    if (mathOutput.operation === 'CONVERSION') {
      return this.generateConversionQuestion(mathOutput as ConversionOutput, context);
    }
    if (mathOutput.operation === 'COMPARISON') {
      return this.generateComparisonQuestion(mathOutput as ComparisonOutput, context);
    }
    if (mathOutput.operation === 'MULTI_STEP') {
      return this.generateMultiStepQuestion(mathOutput as MultiStepOutput, context);
    }
    if (mathOutput.operation === 'LINEAR_EQUATION') {
      return this.generateLinearEquationQuestion(mathOutput as LinearEquationOutput, context);
    }
    if (mathOutput.operation === 'UNIT_RATE') {
      return this.generateUnitRateQuestion(mathOutput as UnitRateOutput, context);
    }
    
    return "Question generation not yet implemented for this model.";
  }

  private generateAdditionQuestion(output: AdditionOutput, context: StoryContext): string {
    const person = context.person || 'Sarah';
    const items = context.item_descriptors || ['item'];
    const symbol = context.unit_symbol || '£';
    
    if (context.unit_type === 'currency' && items.length >= output.operands.length) {
      // Shopping scenario
      const purchases = output.operands.map((value, i) => 
        `a ${items[i]} for ${MoneyContextGenerator.formatMoney(value)}`
      ).join(', ');
      
      return `${person} goes to the shop and buys ${purchases}. How much does ${person} spend in total?`;
    }
    
    // Generic addition
    const values = output.decimal_formatted.operands?.join(', ') || output.operands.join(', ');
    return `Calculate: ${values}. What is the total?`;
  }

  private generateSubtractionQuestion(output: SubtractionOutput, context: StoryContext): string {
    const person = context.person || 'Tom';
    const symbol = context.unit_symbol || '£';
    
    if (context.scenario_type === 'change' && context.unit_type === 'currency') {
      const item = context.item_descriptors?.[0] || 'item';
      return `${person} buys a ${item} for ${MoneyContextGenerator.formatMoney(output.subtrahend)}. ` +
             `${person} pays with ${MoneyContextGenerator.formatMoney(output.minuend)}. ` +
             `How much change does ${person} receive?`;
    }
    
    if (context.scenario_type === 'spending' && context.unit_type === 'currency') {
      return `${person} has ${MoneyContextGenerator.formatMoney(output.minuend)}. ` +
             `${person} spends ${MoneyContextGenerator.formatMoney(output.subtrahend)}. ` +
             `How much money does ${person} have left?`;
    }
    
    // Generic subtraction
    return `What is ${output.decimal_formatted.minuend} minus ${output.decimal_formatted.subtrahend}?`;
  }

  private generateMultiplicationQuestion(output: MultiplicationOutput, context: StoryContext): string {
    const person = context.person || 'Emma';
    const symbol = context.unit_symbol || '£';
    
    if (context.unit_type === 'currency') {
      const item = context.item_descriptors?.[0] || 'ticket';
      const quantity = Math.round(output.multiplier);
      
      return `${person} buys ${quantity} ${item}${quantity > 1 ? 's' : ''}. ` +
             `Each ${item} costs ${MoneyContextGenerator.formatMoney(output.multiplicand)}. ` +
             `How much does ${person} pay in total?`;
    }
    
    // Generic multiplication
    return `What is ${output.decimal_formatted.operands?.[0]} × ${output.decimal_formatted.operands?.[1]}?`;
  }

  private generateDivisionQuestion(output: DivisionOutput, context: StoryContext): string {
    const person = context.person || 'James';
    
    if (context.scenario_type === 'sharing' && context.unit_type === 'currency') {
      const friends = Math.round(output.divisor);
      return `${friends} friends want to share ${MoneyContextGenerator.formatMoney(output.dividend)} equally. ` +
             `How much does each person get?`;
    }
    
    if (context.unit_type === 'currency') {
      const item = context.item_descriptors?.[0] || 'pen';
      const pack_size = Math.round(output.divisor);
      
      return `A pack of ${pack_size} ${item}s costs ${MoneyContextGenerator.formatMoney(output.dividend)}. ` +
             `What is the cost of one ${item}?`;
    }
    
    // Generic division
    const question = `What is ${output.decimal_formatted.operands?.[0]} ÷ ${output.decimal_formatted.operands?.[1]}?`;
    if (output.remainder > 0) {
      return `${question} (Give your answer as a quotient and remainder)`;
    }
    return question;
  }

  private generatePercentageQuestion(output: PercentageOutput, context: StoryContext): string {
    const person = context.person || 'Lucy';
    
    if (context.unit_type === 'currency') {
      const item = context.item_descriptors?.[0] || 'jacket';
      
      switch (output.operation_type) {
        case 'decrease':
          return `A ${item} costs ${MoneyContextGenerator.formatMoney(output.base_value)}. ` +
                 `In a sale, it is reduced by ${output.percentage}%. What is the new price?`;
        
        case 'increase':
          return `${person} has ${MoneyContextGenerator.formatMoney(output.base_value)} in savings. ` +
                 `The bank pays ${output.percentage}% interest. ` +
                 `How much will ${person} have after the interest is added?`;
        
        case 'of':
          return `${person} wants to save ${output.percentage}% of ${MoneyContextGenerator.formatMoney(output.base_value)}. ` +
                 `How much should ${person} save?`;
        
        default:
          return `What is ${output.percentage}% of ${MoneyContextGenerator.formatMoney(output.base_value)}?`;
      }
    }
    
    // Generic percentage
    return `Calculate ${output.percentage}% of ${output.base_value}.`;
  }

  private generateFractionQuestion(output: FractionOutput, context: StoryContext): string {
    const person = context.person || 'Emma';
    const amount = context.unit_type === 'currency' 
      ? MoneyContextGenerator.formatMoney(output.whole_value)
      : String(output.whole_value);
    
    const fractionText = output.fraction.formatted === "1/2" ? "half" : 
                        output.fraction.formatted === "1/3" ? "one third" :
                        output.fraction.formatted === "1/4" ? "one quarter" :
                        output.fraction.formatted === "3/4" ? "three quarters" :
                        output.fraction.formatted;

    if (context.unit_type === 'currency') {
      return `${person} wants to save ${fractionText} of ${amount}. How much should ${person} save?`;
    }
    
    return `What is ${fractionText} of ${amount}?`;
  }

  private generateCountingQuestion(output: CountingOutput, context: StoryContext): string {
    const targetAmount = MoneyContextGenerator.formatMoney(output.target_value / 100);
    
    if (output.solutions.length === 1 && output.is_minimum_solution) {
      return `How many coins do you need to make ${targetAmount} using the smallest number of coins?`;
    } else if (output.solutions.length === 1) {
      const coinType = this.getCoinName(output.solutions[0].denomination);
      return `How many ${coinType} coins do you need to make ${targetAmount}?`;
    } else {
      return `Show two different ways to make ${targetAmount} using coins.`;
    }
  }

  private generateTimeRateQuestion(output: TimeRateOutput, context: StoryContext): string {
    const person = context.person || 'Tom';
    const rateAmount = MoneyContextGenerator.formatMoney(output.rate.value);
    const periodName = this.getPeriodName(output.rate.period, output.calculation.periods);
    
    switch (output.problem_type) {
      case "time_to_target":
        const targetAmount = MoneyContextGenerator.formatMoney(output.calculation.total_value);
        return `${person} saves ${rateAmount} every ${output.rate.period}. How many ${output.rate.period}s will it take to save ${targetAmount}?`;
      
      case "total_after_time":
        return `If ${person} saves ${rateAmount} every ${output.rate.period} for ${output.calculation.periods} ${periodName}, how much will ${person} have saved?`;
      
      case "rate_calculation":
        const totalSaved = MoneyContextGenerator.formatMoney(output.calculation.total_value);
        return `${person} saved ${totalSaved} over ${output.calculation.periods} ${periodName}. How much did ${person} save each ${output.rate.period}?`;
      
      default:
        return `Calculate the savings over time.`;
    }
  }

  private generateConversionQuestion(output: ConversionOutput, context: StoryContext): string {
    if (output.original_unit === "pence" && output.converted_unit === "pounds") {
      return `Convert ${output.original_value}p into pounds and pence.`;
    } else if (output.original_unit === "pounds" && output.converted_unit === "pence") {
      return `How many pence are there in ${MoneyContextGenerator.formatMoney(output.original_value)}?`;
    } else {
      return `Convert ${output.formatted_original} to ${output.converted_unit}.`;
    }
  }

  private generateComparisonQuestion(output: ComparisonOutput, context: StoryContext): string {
    const options = output.options.map((option, index) => {
      const letter = String.fromCharCode(65 + index);
      if (option.quantity && output.comparison_type === "better_value") {
        return `${letter}: ${MoneyContextGenerator.formatMoney(option.value)} for ${option.quantity}ml`;
      } else {
        return `${letter}: ${MoneyContextGenerator.formatMoney(option.value)}`;
      }
    }).join(', ');

    switch (output.comparison_type) {
      case "direct":
        return `Which is worth more? ${options}`;
      
      case "unit_rate":
      case "better_value":
        return `Which is better value? ${options}`;
      
      default:
        return `Compare these options: ${options}`;
    }
  }

  private getCoinName(denomination: number): string {
    const names: { [key: number]: string } = {
      1: "1p", 2: "2p", 5: "5p", 10: "10p", 
      20: "20p", 50: "50p", 100: "£1", 200: "£2"
    };
    return names[denomination] || `${denomination}p`;
  }

  private getPeriodName(period: string, count: number = 1): string {
    const names = {
      day: count === 1 ? 'day' : 'days',
      week: count === 1 ? 'week' : 'weeks',
      month: count === 1 ? 'month' : 'months',
      year: count === 1 ? 'year' : 'years'
    };
    return names[period as keyof typeof names] || period;
  }

  generateAnswer(mathOutput: any, context: StoryContext): string {
    if (context.unit_type === 'currency') {
      let value: number;
      
      if (isAdditionOutput(mathOutput) || isSubtractionOutput(mathOutput)) {
        value = mathOutput.result;
      } else if (isMultiplicationOutput(mathOutput)) {
        value = mathOutput.result;
      } else if (isDivisionOutput(mathOutput)) {
        value = mathOutput.quotient;
        if (mathOutput.remainder > 0) {
          return `${MoneyContextGenerator.formatMoney(value)} with ${MoneyContextGenerator.formatMoney(mathOutput.remainder)} remaining`;
        }
      } else if (mathOutput.operation === 'PERCENTAGE') {
        value = mathOutput.result;
      } else if (mathOutput.operation === 'FRACTION') {
        value = mathOutput.result;
      } else if (mathOutput.operation === 'TIME_RATE') {
        if (mathOutput.problem_type === 'time_to_target') {
          return `${mathOutput.calculation.periods} ${this.getPeriodName(mathOutput.rate.period, mathOutput.calculation.periods)}`;
        }
        value = mathOutput.calculation.total_value;
      } else if (mathOutput.operation === 'COUNTING') {
        const coins = mathOutput.solutions.map((s: any) => 
          `${s.count} × ${this.getCoinName(s.denomination)}`
        ).join(', ');
        return `${coins} (${mathOutput.total_coins} coins total)`;
      } else if (mathOutput.operation === 'CONVERSION') {
        return mathOutput.formatted_converted;
      } else if (mathOutput.operation === 'COMPARISON') {
        const winner = String.fromCharCode(65 + mathOutput.winner_index);
        return `${winner} is ${mathOutput.comparison_type === 'direct' ? 'worth more' : 'better value'}`;
      } else if (mathOutput.operation === 'MULTI_STEP') {
        value = mathOutput.final_result;
      } else if (mathOutput.operation === 'LINEAR_EQUATION') {
        if (mathOutput.problem_type === 'solve_for_x') {
          return `x = ${mathOutput.target_x}`;
        } else if (mathOutput.problem_type === 'solve_for_y') {
          return `y = ${mathOutput.target_y}`;
        } else {
          return mathOutput.equation;
        }
      } else if (mathOutput.operation === 'UNIT_RATE') {
        if (mathOutput.problem_type === 'find_unit_rate') {
          return `${MoneyContextGenerator.formatMoney(mathOutput.unit_rate)} per ${mathOutput.item}`;
        } else if (mathOutput.problem_type === 'compare_rates') {
          const better = mathOutput.comparison_rates.find((r: any) => r.better);
          return better ? `Option with ${better.quantity} ${mathOutput.item}s is better` : 'Base option is better';
        }
        value = mathOutput.scaled_value;
      } else {
        value = mathOutput.result || mathOutput.final_result || 0;
      }
      
      return MoneyContextGenerator.formatMoney(value);
    }
    
    // Generic answer
    if (mathOutput.result !== undefined) {
      return String(mathOutput.result);
    }
    if (mathOutput.quotient !== undefined) {
      if (mathOutput.remainder > 0) {
        return `${mathOutput.quotient} remainder ${mathOutput.remainder}`;
      }
      return String(mathOutput.quotient);
    }
    
    return String(mathOutput.final_result || 0);
  }

  private generateMultiStepQuestion(output: MultiStepOutput, context: StoryContext): string {
    const person = context.person || 'Sarah';
    const symbol = context.unit_symbol || '£';
    
    const steps = output.steps.map((step, index) => {
      const stepNum = index + 1;
      if (step.operation === 'ADDITION') {
        return `adds ${symbol}${step.inputs.slice(1).join(' + ' + symbol)}`;
      } else if (step.operation === 'SUBTRACTION') {
        return `subtracts ${symbol}${step.inputs[1]}`;
      } else if (step.operation === 'MULTIPLICATION') {
        return `multiplies by ${step.inputs[1]}`;
      } else if (step.operation === 'DIVISION') {
        return `divides by ${step.inputs[1]}`;
      }
      return `performs ${step.operation.toLowerCase()}`;
    });

    const firstStep = output.steps[0];
    let questionText = `${person} starts with ${symbol}${firstStep.inputs[0]}`;
    
    if (steps.length > 1) {
      questionText += `, then ${steps.slice(1).join(', then ')}`;
    }
    
    questionText += '. How much does she have now?';
    
    return questionText;
  }

  private generateLinearEquationQuestion(output: LinearEquationOutput, context: StoryContext): string {
    if (output.problem_type === 'evaluate') {
      return `Using the equation ${output.equation}, what is the value of y when x = ${output.x_values[0]}?`;
    } else if (output.problem_type === 'complete_table') {
      return `Using the equation ${output.equation}, complete the table for x values: ${output.x_values.join(', ')}.`;
    } else if (output.problem_type === 'solve_for_y') {
      return `Using the equation ${output.equation}, find the value of y when x = ${output.target_x}.`;
    } else if (output.problem_type === 'solve_for_x') {
      return `Using the equation ${output.equation}, find the value of x when y = ${output.target_y}.`;
    }
    
    return `Work with the linear equation: ${output.equation}`;
  }

  private generateUnitRateQuestion(output: UnitRateOutput, context: StoryContext): string {
    const symbol = context.unit_symbol || '£';
    
    if (output.problem_type === 'find_unit_rate') {
      return `If ${output.base_quantity} ${output.item}s cost ${symbol}${output.base_rate}, what is the cost per ${output.item}?`;
    } else if (output.problem_type === 'scale_up' || output.problem_type === 'scale_down') {
      return `If ${output.base_quantity} ${output.item}s cost ${symbol}${output.base_rate}, how much would ${output.target_quantity} ${output.item}s cost?`;
    } else if (output.problem_type === 'compare_rates') {
      let question = `Compare these options for buying ${output.item}s:\n`;
      question += `Option A: ${output.base_quantity} for ${symbol}${output.base_rate}\n`;
      output.comparison_rates.forEach((rate, index) => {
        const letter = String.fromCharCode(66 + index); // B, C, D...
        question += `Option ${letter}: ${rate.quantity} for ${symbol}${rate.rate}\n`;
      });
      question += 'Which offers the best value per item?';
      return question;
    } else if (output.problem_type === 'best_value') {
      return `Which is the better deal: ${output.base_quantity} ${output.item}s for ${symbol}${output.base_rate}, or ${output.comparison_rates[0]?.quantity} ${output.item}s for ${symbol}${output.comparison_rates[0]?.rate}?`;
    }
    
    return `Calculate the rate for ${output.item}s at ${symbol}${output.unit_rate} per ${output.item}.`;
  }
}
```
--- END FILE: lib\story-engine\story.engine.ts ---

--- START FILE: lib\types.ts ---
```typescript
// Core TypeScript interfaces for the Question Factory system

// Generic Math Model Interface
export interface IMathModel<TParams, TOutput> {
  model_id: string;
  generate(params: TParams): TOutput;
  getDefaultParams(year: number): TParams;
}

// Base interfaces
export interface ValueConstraints {
  min: number;
  step: number;
}

export interface DecimalFormatted {
  operands?: string[];
  result: string;
  minuend?: string;
  subtrahend?: string;
  quotient?: string;
}

// ADDITION Model
export interface AdditionDifficultyParams {
  operand_count: number;        // Number of values to sum (2-10)
  max_value: number;            // Maximum value for any operand
  decimal_places: number;       // Number of decimal places (0-3)
  allow_carrying: boolean;      // Whether carrying is required
  value_constraints: ValueConstraints;
}

export interface AdditionOutput {
  operation: "ADDITION";
  operands: number[];
  result: number;
  intermediate_steps: number[];
  decimal_formatted: DecimalFormatted;
}

// SUBTRACTION Model
export interface SubtractionDifficultyParams {
  minuend_max: number;          // Maximum value for the minuend
  subtrahend_max: number;       // Maximum value for the subtrahend
  decimal_places: number;       // Number of decimal places (0-3)
  allow_borrowing: boolean;    // Whether borrowing is required
  ensure_positive: boolean;    // Ensures result is non-negative
  value_constraints: {
    step: number;               // Step size for values
  };
}

export interface SubtractionOutput {
  operation: "SUBTRACTION";
  minuend: number;
  subtrahend: number;
  result: number;
  decimal_formatted: DecimalFormatted;
}

// MULTIPLICATION Model
export interface MultiplicationDifficultyParams {
  multiplicand_max: number;     // Maximum value for multiplicand
  multiplier_max: number;       // Maximum value for multiplier
  decimal_places: number;       // Decimal places in operands (0-3)
  operand_count: number;        // Number of values to multiply (2-4)
  use_fractions: boolean;       // Allow fractional multipliers
}

export interface MultiplicationOutput {
  operation: "MULTIPLICATION";
  multiplicand: number;
  multiplier: number;
  result: number;
  factors: number[];
  decimal_formatted: DecimalFormatted;
}

// DIVISION Model
export interface DivisionDifficultyParams {
  dividend_max: number;         // Maximum value for dividend
  divisor_max: number;          // Maximum value for divisor
  decimal_places: number;       // Decimal places in result (0-3)
  allow_remainder: boolean;     // Whether to include remainders
  ensure_whole: boolean;        // Ensure result is whole number
}

export interface DivisionOutput {
  operation: "DIVISION";
  dividend: number;
  divisor: number;
  quotient: number;
  remainder: number;
  decimal_formatted: DecimalFormatted;
}

// MULTI_STEP Model
export interface MultiStepOperation {
  model: string;                // "ADDITION", "SUBTRACTION", etc.
  params: any;                  // Parameters for the specific model
  use_previous_result: boolean; // Use result from previous step
}

export interface MultiStepDifficultyParams {
  operation_sequence: MultiStepOperation[];
  max_steps: number;            // Maximum number of operations (2-5)
  intermediate_visibility: boolean; // Show intermediate results
}

export interface StepResult {
  step: number;
  operation: string;
  inputs: number[];
  result: number;
}

export interface MultiStepOutput {
  operation: "MULTI_STEP";
  steps: StepResult[];
  final_result: number;
  intermediate_results: number[];
}

// LINEAR_EQUATION Model
export interface LinearEquationDifficultyParams {
  slope_max: number;            // Maximum value for slope (m)
  intercept_max: number;        // Maximum value for y-intercept (c)
  input_max: number;            // Maximum input value (x)
  decimal_places: number;       // Decimal places in coefficients
  allow_negative_slope: boolean; // Allow negative slopes
}

export interface LinearEquationOutput {
  operation: "LINEAR_EQUATION";
  equation: {
    slope: number;
    intercept: number;
    formatted: string;
  };
  input: number;
  output: number;
  calculation_steps: {
    mx: number;
    mx_plus_c: number;
  };
}

// PERCENTAGE Model
export interface PercentageDifficultyParams {
  base_value_max: number;       // Maximum base value
  percentage_values: number[];  // Allowed percentage values [10, 20, 25, 50, etc.]
  operation_type: "of" | "increase" | "decrease" | "reverse";
  decimal_places: number;       // Decimal places in result
}

export interface PercentageOutput {
  operation: "PERCENTAGE";
  operation_type: string;
  base_value: number;
  percentage: number;
  percentage_amount: number;
  result: number;
}

// UNIT_RATE Model
export interface UnitRateDifficultyParams {
  total_value_max: number;      // Maximum total value
  quantity_max: number;         // Maximum quantity
  decimal_places: number;       // Decimal places
  comparison_count: number;     // Number of rates to compare (1-4)
}

export interface UnitRateCalculation {
  total: number;
  quantity: number;
  unit_rate: number;
}

export interface UnitRateOutput {
  operation: "UNIT_RATE";
  calculations: UnitRateCalculation[];
  best_value_index: number;
}

// FRACTION Model
export interface FractionDifficultyParams {
  whole_value_max: number;       // Maximum whole value to find fraction of
  fraction_types: Array<{        // Allowed fractions
    numerator: number;
    denominator: number;
  }>;
  decimal_places: number;        // Decimal places in result
  ensure_whole_result: boolean;  // Ensure result is whole number when possible
}

export interface FractionOutput {
  operation: "FRACTION";
  whole_value: number;
  fraction: {
    numerator: number;
    denominator: number;
    formatted: string;           // "1/2", "3/4", etc.
  };
  result: number;
  calculation_steps: {
    division_result: number;
    final_result: number;
  };
}

// COUNTING Model
export interface CountingDifficultyParams {
  target_value: number;          // Target amount to make
  allowed_denominations: number[]; // Coins/notes allowed
  solution_type: "exact" | "minimum" | "multiple"; // Type of counting problem
  max_coins: number;             // Maximum coins to use
}

export interface CountingOutput {
  operation: "COUNTING";
  target_value: number;
  solutions: Array<{
    denomination: number;
    count: number;
  }>;
  total_coins: number;
  is_minimum_solution: boolean;
}

// TIME_RATE Model  
export interface TimeRateDifficultyParams {
  rate_value_max: number;        // Maximum rate value
  rate_period: "day" | "week" | "month" | "year"; // Time period
  target_value_max: number;      // Maximum target value
  decimal_places: number;        // Decimal places
  problem_type: "time_to_target" | "total_after_time" | "rate_calculation";
}

export interface TimeRateOutput {
  operation: "TIME_RATE";
  rate: {
    value: number;
    period: string;
  };
  calculation: {
    periods: number;
    total_value: number;
  };
  problem_type: string;
}

// CONVERSION Model
export interface ConversionDifficultyParams {
  value_max: number;             // Maximum value to convert
  conversion_types: Array<{      // Available conversions
    from_unit: string;
    to_unit: string;
    conversion_factor: number;
  }>;
  decimal_places: number;        // Decimal places in result
}

export interface ConversionOutput {
  operation: "CONVERSION";
  original_value: number;
  original_unit: string;
  converted_value: number;
  converted_unit: string;
  conversion_factor: number;
  formatted_original: string;
  formatted_converted: string;
}

// COMPARISON Model
export interface ComparisonDifficultyParams {
  value_count: number;           // Number of values to compare (2-4)
  value_max: number;             // Maximum value
  comparison_type: "direct" | "unit_rate" | "better_value";
  decimal_places: number;        // Decimal places
  include_calculation: boolean;  // Whether to show calculation steps
}

export interface ComparisonOption {
  value: number;
  quantity?: number;
  unit_rate?: number;
  description: string;
}

export interface ComparisonOutput {
  operation: "COMPARISON";
  options: ComparisonOption[];
  comparison_type: string;
  winner_index: number;
  difference?: number;
  explanation: string;
}

// Story Engine Context Types
export interface StoryContext {
  unit_type: string;            // "currency", "measurement", "count"
  unit_symbol: string;          // "£", "kg", ""
  item_descriptors?: string[];  // ["cake", "drink"]
  action_verb?: string;         // "buys", "collects", "earns"
  scenario_type?: string;       // "change", "difference", "remaining"
  initial_context?: string;     // "pays with", "has saved"
  removal_context?: string;     // "costs", "spent"
  quantity_type?: string;       // "groups", "items_per_unit"
  unit_descriptor?: string;     // "tickets", "pens per pack"
  person?: string;              // "Sarah", "Tom", etc.
}

// Question Generation Types
export interface GenerateRequest {
  model_id: string;
  difficulty_params?: any;
  context_type?: string;
  year_level?: number;
}

export interface GeneratedQuestion {
  question: string;
  answer: string | number;
  math_output: any;
  context: StoryContext;
  metadata: {
    model_id: string;
    year_level: number;
    difficulty_params: any;
    timestamp: Date;
  };
}

// Model Information Types
export interface ModelParameter {
  name: string;
  type: 'number' | 'boolean' | 'string' | 'array';
  min?: number;
  max?: number;
  default: any;
  description: string;
}

export interface ModelInfo {
  model_id: string;
  description: string;
  difficulty_parameters: ModelParameter[];
  supported_year_levels: number[];
  context_types: string[];
}

// Test Types
export interface TestRequest {
  model_id: string;
  test_count: number;
  difficulty_params: any;
}

export interface TestResult {
  question: string;
  answer: string | number;
  generation_time_ms: number;
}

export interface TestResponse {
  results: TestResult[];
  statistics: {
    avg_generation_time: number;
    success_rate: number;
    unique_questions: number;
    total_time_ms: number;
  };
}

// Export Request Types
export interface ExportRequest {
  questions: GeneratedQuestion[];
  format: 'json' | 'csv';
  include_metadata: boolean;
}

// Type guards
export function isAdditionOutput(output: any): output is AdditionOutput {
  return output.operation === "ADDITION";
}

export function isSubtractionOutput(output: any): output is SubtractionOutput {
  return output.operation === "SUBTRACTION";
}

export function isMultiplicationOutput(output: any): output is MultiplicationOutput {
  return output.operation === "MULTIPLICATION";
}

export function isDivisionOutput(output: any): output is DivisionOutput {
  return output.operation === "DIVISION";
}

// Money Models - UK National Curriculum Specific

// COIN_RECOGNITION Model
export interface CoinRecognitionDifficultyParams {
  include_coins: number[];          // Which coin denominations to include (in pence)
  include_notes: number[];          // Which note denominations to include (in pence)
  problem_types: string[];          // Types of problems: identify_value, identify_name, count_collection, compare_values
  max_coin_count: number;           // Maximum number of coins in a collection
  allow_mixed_denominations: boolean; // Whether to mix different coin types
  include_combinations: boolean;    // Whether to include combination problems
}

export interface CoinRecognitionOutput {
  operation: "COIN_RECOGNITION";
  problem_type: string;
  target_denomination?: number;
  denomination_name?: string;
  formatted_value?: string;
  is_note?: boolean;
  collection: Array<{ denomination: number; count: number }>;
  total_value: number;
  answer_type: string;
  comparison_result?: string;
}

// CHANGE_CALCULATION Model
export interface ChangeCalculationDifficultyParams {
  max_item_cost: number;            // Maximum cost of individual items
  payment_methods: number[];        // Available payment denominations
  decimal_places: number;           // Number of decimal places
  problem_types: string[];          // Types: simple_change, exact_payment, multiple_items, change_breakdown
  include_breakdown: boolean;       // Whether to break down change into denominations
  max_items: number;                // Maximum number of items in a transaction
  allow_overpayment: boolean;       // Whether to allow overpayment scenarios
}

export interface ChangeCalculationOutput {
  operation: "CHANGE_CALCULATION";
  problem_type: string;
  items: Array<{ name: string; cost: number; quantity: number }>;
  total_cost: number;
  payment_amount: number;
  change_amount: number;
  change_breakdown: Array<{ denomination: number; count: number; formatted: string }>;
  payment_description: string;
}

// MONEY_COMBINATIONS Model
export interface MoneyCombinationsDifficultyParams {
  target_amount_range: { min: number; max: number };
  available_denominations: number[];
  problem_types: string[];          // Types: find_combinations, make_amount, equivalent_amounts, compare_combinations
  max_combinations: number;
  allow_notes: boolean;
  require_exact_combinations: boolean;
  decimal_places: number;
}

export interface MoneyCombinationsOutput {
  operation: "MONEY_COMBINATIONS";
  problem_type: string;
  target_amount: number;
  available_denominations: number[];
  combinations: Array<Array<{ denomination: number; count: number; formatted: string }>>;
  total_combinations: number;
  formatted_target: string;
  specific_combination?: Array<{ denomination: number; count: number; formatted: string }>;
  comparison_criteria?: string;
}

// MIXED_MONEY_UNITS Model
export interface MixedMoneyUnitsDifficultyParams {
  pounds_range: { min: number; max: number };
  pence_range: { min: number; max: number };
  problem_types: string[];          // Types: convert_units, add_mixed_units, subtract_mixed_units, compare_mixed_amounts
  decimal_places: number;
  allow_complex_operations: boolean;
  include_comparisons: boolean;
  max_operands: number;
}

export interface MixedMoneyUnitsOutput {
  operation: "MIXED_MONEY_UNITS";
  problem_type: string;
  source_amount?: { pounds: number; pence: number };
  target_format?: string;
  result: number;
  result_mixed?: { pounds: number; pence: number; total_decimal: number };
  operands?: Array<{ pounds: number; pence: number }>;
  minuend?: { pounds: number; pence: number };
  subtrahend?: { pounds: number; pence: number };
  amount1?: { pounds: number; pence: number };
  amount2?: { pounds: number; pence: number };
  comparison_result?: string;
  difference?: number;
  formatted_source?: string;
  formatted_result?: string;
  formatted_operands?: string[];
  formatted_minuend?: string;
  formatted_subtrahend?: string;
  formatted_amount1?: string;
  formatted_amount2?: string;
  formatted_difference?: string;
  conversion_type?: string;
  requires_borrowing?: boolean;
}

// MONEY_FRACTIONS Model
export interface MoneyFractionsDifficultyParams {
  amount_range: { min: number; max: number };
  allowed_fractions: Array<{ numerator: number; denominator: number }>;
  problem_types: string[];          // Types: fraction_of_amount, find_whole_from_fraction, compare_fractional_amounts, add_fractional_money
  decimal_places: number;
  ensure_whole_results: boolean;
  include_word_problems: boolean;
  max_fraction_complexity: number;
}

export interface MoneyFractionsOutput {
  operation: "MONEY_FRACTIONS";
  problem_type: string;
  whole_amount?: number;
  base_amount?: number;
  fraction?: { numerator: number; denominator: number };
  fraction1?: { numerator: number; denominator: number };
  fraction2?: { numerator: number; denominator: number };
  result: number;
  fractional_amount?: number;
  amount1?: number;
  amount2?: number;
  comparison_result?: string;
  formatted_whole?: string;
  formatted_base?: string;
  formatted_fraction?: string;
  formatted_fraction1?: string;
  formatted_fraction2?: string;
  formatted_result?: string;
  formatted_fractional_amount?: string;
  formatted_amount1?: string;
  formatted_amount2?: string;
  fraction_name?: string;
  calculation_steps?: Array<{ step: string; calculation: string; result: string }>;
}

// MONEY_SCALING Model
export interface MoneyScalingDifficultyParams {
  base_amount_range: { min: number; max: number };
  scale_factor_range: { min: number; max: number };
  problem_types: string[];          // Types: scale_up, scale_down, proportional_reasoning, rate_problems
  decimal_places: number;
  include_fractional_scaling: boolean;
  allow_complex_ratios: boolean;
  context_types: string[];
}

export interface MoneyScalingOutput {
  operation: "MONEY_SCALING";
  problem_type: string;
  base_amount?: number;
  scale_factor?: number;
  scaled_amount?: number;
  original_amount?: number;
  base_quantity?: number;
  new_quantity?: number;
  new_amount?: number;
  unit_cost?: number;
  rate?: number;
  time_amount?: number;
  time_unit?: string;
  total_amount?: number;
  context: string;
  formatted_base?: string;
  formatted_scaled?: string;
  formatted_original?: string;
  formatted_new?: string;
  formatted_scale_factor?: string;
  formatted_unit_cost?: string;
  formatted_rate?: string;
  formatted_total?: string;
  calculation?: string;
}
```
--- END FILE: lib\types.ts ---

--- START FILE: lib\utils.ts ---
```typescript
import { type ClassValue, clsx } from "clsx";
import { twMerge } from "tailwind-merge";

export function cn(...inputs: ClassValue[]) {
  return twMerge(clsx(inputs));
}

// Number formatting utilities
export function formatDecimal(value: number, places: number): string {
  return value.toFixed(places);
}

export function formatCurrency(value: number): string {
  return formatDecimal(value, 2);
}

// Random number generation utilities
export function randomInt(min: number, max: number): number {
  return Math.floor(Math.random() * (max - min + 1)) + min;
}

export function randomFloat(min: number, max: number, decimalPlaces: number): number {
  const factor = Math.pow(10, decimalPlaces);
  return Math.round((Math.random() * (max - min) + min) * factor) / factor;
}

export function randomChoice<T>(array: T[]): T {
  return array[Math.floor(Math.random() * array.length)];
}

export function randomSample<T>(array: T[], count: number): T[] {
  const shuffled = [...array].sort(() => 0.5 - Math.random());
  return shuffled.slice(0, count);
}

// Generate random numbers with constraints
export function generateRandomNumber(
  max: number,
  decimalPlaces: number = 0,
  min: number = 0,
  step: number = 1
): number {
  if (decimalPlaces === 0) {
    const steps = Math.floor((max - min) / step);
    return min + randomInt(0, steps) * step;
  } else {
    let value = randomFloat(min, max, decimalPlaces);
    // Round to nearest step
    if (step !== 1) {
      value = Math.round(value / step) * step;
    }
    return parseFloat(value.toFixed(decimalPlaces));
  }
}

// Generate array of random numbers
export function generateRandomNumbers(
  count: number,
  max: number,
  decimalPlaces: number = 0,
  min: number = 0,
  step: number = 1
): number[] {
  const numbers: number[] = [];
  for (let i = 0; i < count; i++) {
    numbers.push(generateRandomNumber(max, decimalPlaces, min, step));
  }
  return numbers;
}

// Check if carrying is required for addition
export function requiresCarrying(operands: number[]): boolean {
  let carry = 0;
  const maxLength = Math.max(...operands.map(n => n.toString().length));
  
  for (let position = 0; position < maxLength; position++) {
    let sum = carry;
    for (const operand of operands) {
      const digit = Math.floor((operand / Math.pow(10, position)) % 10);
      sum += digit;
    }
    if (sum >= 10) {
      return true;
    }
    carry = Math.floor(sum / 10);
  }
  return false;
}

// Check if borrowing is required for subtraction
export function requiresBorrowing(minuend: number, subtrahend: number): boolean {
  const minStr = minuend.toString().replace('.', '');
  const subStr = subtrahend.toString().replace('.', '');
  const maxLength = Math.max(minStr.length, subStr.length);
  
  for (let i = 0; i < maxLength; i++) {
    const minDigit = parseInt(minStr[minStr.length - 1 - i] || '0');
    const subDigit = parseInt(subStr[subStr.length - 1 - i] || '0');
    if (minDigit < subDigit) {
      return true;
    }
  }
  return false;
}

// Ensure unique values in array
export function ensureUnique(generator: () => number, count: number, maxAttempts: number = 100): number[] {
  const values = new Set<number>();
  let attempts = 0;
  
  while (values.size < count && attempts < maxAttempts) {
    values.add(generator());
    attempts++;
  }
  
  if (values.size < count) {
    throw new Error(`Could not generate ${count} unique values`);
  }
  
  return Array.from(values);
}

// Name generation for story contexts
export const PERSON_NAMES = [
  "Sarah", "Tom", "Emma", "James", "Sophie", "Oliver", "Lucy", "Harry",
  "Grace", "Jack", "Lily", "William", "Emily", "Daniel", "Mia", "Alex",
  "Chloe", "Ben", "Katie", "Sam", "Amy", "Luke", "Hannah", "Ryan"
];

export function getRandomName(): string {
  return randomChoice(PERSON_NAMES);
}

// Common item descriptors for different contexts
export const MONEY_ITEMS = [
  "book", "pen", "pencil", "ruler", "notebook", "eraser", "comic", "magazine",
  "toy", "game", "puzzle", "sticker", "badge", "poster", "card", "sweet",
  "chocolate", "apple", "banana", "sandwich", "drink", "cake", "biscuit"
];

export const LENGTH_ITEMS = [
  "rope", "ribbon", "string", "wire", "fabric", "paper", "wood", "metal",
  "road", "path", "track", "fence", "wall", "garden", "field", "playground"
];

export const WEIGHT_ITEMS = [
  "flour", "sugar", "rice", "pasta", "potatoes", "apples", "oranges", "bananas",
  "cheese", "butter", "meat", "fish", "vegetables", "fruit", "sand", "stones"
];

// Validation utilities
export function validateDifficultyParams(params: any, model_id: string): boolean {
  if (!params || typeof params !== 'object') {
    return false;
  }
  
  // Basic validation - could be extended per model
  switch (model_id) {
    case 'ADDITION':
      return params.operand_count >= 2 && params.operand_count <= 10 &&
             params.max_value > 0 && params.decimal_places >= 0 && params.decimal_places <= 3;
    case 'SUBTRACTION':
      return params.minuend_max > 0 && params.subtrahend_max > 0 &&
             params.decimal_places >= 0 && params.decimal_places <= 3;
    case 'MULTIPLICATION':
      return params.multiplicand_max > 0 && params.multiplier_max > 0 &&
             params.decimal_places >= 0 && params.decimal_places <= 3;
    case 'DIVISION':
      return params.dividend_max > 0 && params.divisor_max > 0 &&
             params.decimal_places >= 0 && params.decimal_places <= 3;
    default:
      return true;
  }
}

// Question uniqueness check
export function isQuestionUnique(
  newQuestion: string,
  existingQuestions: string[],
  threshold: number = 0.9
): boolean {
  // Simple check - could be enhanced with better similarity algorithms
  return !existingQuestions.includes(newQuestion);
}

// Performance timing utility
export function measureTime<T>(fn: () => T): [T, number] {
  const start = performance.now();
  const result = fn();
  const end = performance.now();
  return [result, end - start];
}

// Statistics calculation
export function calculateStatistics(values: number[]): {
  min: number;
  max: number;
  mean: number;
  median: number;
} {
  if (values.length === 0) {
    return { min: 0, max: 0, mean: 0, median: 0 };
  }
  
  const sorted = [...values].sort((a, b) => a - b);
  const sum = values.reduce((a, b) => a + b, 0);
  
  return {
    min: sorted[0],
    max: sorted[sorted.length - 1],
    mean: sum / values.length,
    median: sorted.length % 2 === 0
      ? (sorted[sorted.length / 2 - 1] + sorted[sorted.length / 2]) / 2
      : sorted[Math.floor(sorted.length / 2)]
  };
}
```
--- END FILE: lib\utils.ts ---

--- START FILE: next.config.ts ---
```typescript
import type { NextConfig } from "next";

const nextConfig: NextConfig = {
  /* config options here */
};

export default nextConfig;

```
--- END FILE: next.config.ts ---

--- START FILE: package.json ---
```json
{
  "name": "factory-architect",
  "version": "0.1.0",
  "private": true,
  "scripts": {
    "dev": "next dev",
    "build": "next build",
    "start": "next start",
    "lint": "eslint"
  },
  "dependencies": {
    "@radix-ui/react-label": "^2.1.7",
    "@radix-ui/react-select": "^2.2.6",
    "@radix-ui/react-slider": "^1.3.6",
    "@radix-ui/react-switch": "^1.2.6",
    "@radix-ui/react-tabs": "^1.1.13",
    "class-variance-authority": "^0.7.1",
    "clsx": "^2.1.1",
    "lucide-react": "^0.542.0",
    "next": "15.5.2",
    "react": "19.1.0",
    "react-dom": "19.1.0",
    "tailwind-merge": "^3.3.1"
  },
  "devDependencies": {
    "@eslint/eslintrc": "^3",
    "@tailwindcss/postcss": "^4",
    "@types/node": "^20",
    "@types/react": "^19",
    "@types/react-dom": "^19",
    "eslint": "^9",
    "eslint-config-next": "15.5.2",
    "tailwindcss": "^4",
    "typescript": "^5"
  }
}

```
--- END FILE: package.json ---

--- START FILE: postcss.config.mjs ---
```javascript
const config = {
  plugins: ["@tailwindcss/postcss"],
};

export default config;

```
--- END FILE: postcss.config.mjs ---

--- START FILE: README.md ---
```markdown
This is a [Next.js](https://nextjs.org) project bootstrapped with [`create-next-app`](https://nextjs.org/docs/app/api-reference/cli/create-next-app).

## Getting Started

First, run the development server:

```bash
npm run dev
# or
yarn dev
# or
pnpm dev
# or
bun dev
```

Open [http://localhost:3000](http://localhost:3000) with your browser to see the result.

You can start editing the page by modifying `app/page.tsx`. The page auto-updates as you edit the file.

This project uses [`next/font`](https://nextjs.org/docs/app/building-your-application/optimizing/fonts) to automatically optimize and load [Geist](https://vercel.com/font), a new font family for Vercel.

## Learn More

To learn more about Next.js, take a look at the following resources:

- [Next.js Documentation](https://nextjs.org/docs) - learn about Next.js features and API.
- [Learn Next.js](https://nextjs.org/learn) - an interactive Next.js tutorial.

You can check out [the Next.js GitHub repository](https://github.com/vercel/next.js) - your feedback and contributions are welcome!

## Deploy on Vercel

The easiest way to deploy your Next.js app is to use the [Vercel Platform](https://vercel.com/new?utm_medium=default-template&filter=next.js&utm_source=create-next-app&utm_campaign=create-next-app-readme) from the creators of Next.js.

Check out our [Next.js deployment documentation](https://nextjs.org/docs/app/building-your-application/deploying) for more details.

```
--- END FILE: README.md ---

--- START FILE: STUDENT_INTERFACE_PROJECT_PROPOSAL.md ---
```markdown
# Factory Architect Student Interface Project Proposal
## Interactive Mathematics Learning Platform

**Project Version:** 1.0  
**Document Date:** September 6, 2025  
**Project Scope:** Student-facing interactive mathematics learning interface  

---

## 📖 Executive Summary

### What We're Building (Non-Technical)

Factory Architect currently generates mathematical questions perfectly, but students can only see them as text. We're proposing to build an **interactive student interface** that makes answering these questions as easy as using a touchscreen phone or tablet.

**The Vision:**
- Students see engaging math problems (like "Sarah buys an apple for £2.50 and a pen for £1.20. How much does she spend?")
- Instead of writing answers on paper, they use **interactive tools** like:
  - Touch-friendly number buttons (like a calculator)
  - Drag-and-drop coin images to make money amounts
  - Large A/B/C buttons for multiple choice questions
  - Visual fraction builders and percentage sliders

**Why This Matters:**
- **Accessibility**: Makes math accessible to students with different learning needs
- **Engagement**: Interactive elements keep students focused and motivated
- **Immediate Feedback**: Students know instantly if they're right or wrong
- **Differentiation**: Automatic difficulty adjustment based on student performance
- **Data Insights**: Teachers can see exactly where students struggle

### What We're Building (Technical)

We're extending the existing Factory Architect system with a new **student-facing frontend** that:

1. **Consumes existing math engine output** - Reuses all 18 mathematical models
2. **Provides model-appropriate input interfaces** - Different UI components for different question types
3. **Validates answers programmatically** - Uses the math engine's structured output for instant checking
4. **Tracks student progress** - Session management and performance analytics
5. **Scales to classroom deployment** - Multi-student support with teacher oversight

**Technical Architecture:**
- **Frontend**: React/Next.js components with TypeScript
- **Backend**: Extends existing API routes for session management
- **Data Flow**: Question generation → UI presentation → Answer validation → Progress tracking
- **Integration**: Seamless connection with existing curriculum mapping and model status systems

---

## 🎯 Project Goals

### Primary Objectives
1. **Transform passive text questions into interactive experiences**
2. **Reduce cognitive load** by providing intuitive input methods
3. **Increase engagement** through visual feedback and gamification elements
4. **Provide immediate assessment** without teacher intervention
5. **Generate actionable data** about student understanding

### Success Metrics
- Students can answer questions 40% faster than traditional pen/paper
- 90% of students prefer the interactive interface over text-only questions  
- Teachers report more detailed insights into student understanding
- System handles 30+ concurrent students without performance issues

---

## 🧠 User Experience Design

### Student Journey (Non-Technical)

**Getting Started:**
1. Student opens the practice page on their device (tablet, laptop, or phone)
2. System shows them a friendly math problem in story format
3. Interactive tools appear based on the question type

**Answering Questions:**

**For Basic Math** (like 12 + 8):
- Large number buttons appear (like a calculator)
- Student taps numbers to build their answer
- Green checkmark when correct, gentle animation if incorrect

**For Money Questions** (like making £1.50 with coins):
- Visual coins appear on screen (1p, 2p, 5p, 10p, 20p, 50p, £1, £2)
- Student drags coins into a "purse" area
- Running total shows as they add coins
- System celebrates when they reach the exact amount

**For Choice Questions** (like "Which is better value?"):
- Large A, B, C buttons with the options
- Visual comparisons (bars, charts) help students see differences
- One-tap selection with immediate feedback

**Progress and Motivation:**
- Progress bar shows completion through a set of questions
- Streak counter for consecutive correct answers
- Gentle encouragement and celebration animations
- Optional timer for self-challenge (not pressure)

### Teacher Experience (Non-Technical)

**Classroom Dashboard:**
- Real-time view of all student progress
- Quick identification of students who need help
- Insights into which question types cause the most difficulty
- Ability to adjust difficulty for individual students or the whole class

**Data Insights:**
- Which curriculum areas need more practice
- Common mistake patterns across the class
- Individual student growth over time
- Recommendations for targeted intervention

---

## 🔧 Technical Architecture

### System Overview

```
Existing Factory Architect System:
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   Math Engine   │───▶│  Story Engine   │───▶│  JSON Output    │
│  (18 Models)    │    │  (Narratives)   │    │  (Questions)    │
└─────────────────┘    └─────────────────┘    └─────────────────┘

New Student Interface System:
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│  JSON Output    │───▶│ Student UI      │───▶│ Answer Checker  │
│  (Questions)    │    │ Components      │    │ & Validation    │
└─────────────────┘    └─────────────────┘    └─────────────────┘
                               │                        │
                               ▼                        ▼
                     ┌─────────────────┐    ┌─────────────────┐
                     │  Progress       │    │  Session        │
                     │  Tracking       │    │  Management     │
                     └─────────────────┘    └─────────────────┘
```

### Core Components

#### 1. Answer Input System

**Purpose**: Model-aware input components that adapt to question type

**Technical Implementation**:
```typescript
interface AnswerInputProps {
  questionData: GeneratedQuestion;
  onAnswer: (answer: StudentAnswer) => void;
  onValidate: (isCorrect: boolean, feedback: string) => void;
}

// Component automatically detects model type and renders appropriate interface
const AnswerInput: React.FC<AnswerInputProps> = ({ questionData }) => {
  switch(questionData.metadata.model_id) {
    case 'ADDITION':
    case 'SUBTRACTION':
    case 'MULTIPLICATION':
    case 'DIVISION':
      return <NumericInput />;
    case 'COIN_RECOGNITION':
    case 'COUNTING':
      return <CoinSelector />;
    case 'COMPARISON':
      return <MultipleChoice options={questionData.math_output.options} />;
    // ... other models
  }
};
```

#### 2. Answer Validation Service

**Purpose**: Programmatic answer checking using existing math engine output

**Technical Implementation**:
```typescript
class AnswerValidator {
  validate(studentAnswer: any, correctAnswer: any, modelId: string): ValidationResult {
    switch(modelId) {
      case 'ADDITION':
        return this.validateNumeric(studentAnswer, correctAnswer.result);
      case 'COUNTING':
        return this.validateCoinCombination(studentAnswer, correctAnswer.solutions);
      case 'COMPARISON':
        return this.validateSelection(studentAnswer, correctAnswer.winner_index);
      // ... specialized validation for each model
    }
  }

  private validateNumeric(student: number, correct: number): ValidationResult {
    const isExact = Math.abs(student - correct) < 0.01;
    const isClose = Math.abs(student - correct) < 0.1;
    
    return {
      isCorrect: isExact,
      feedback: isExact ? "Correct!" : isClose ? "Very close! Check your calculation." : "Try again.",
      partialCredit: isClose ? 0.8 : 0
    };
  }
}
```

#### 3. UI Component Library

**NumberPad Component**:
- Large touch-friendly buttons (0-9)
- Decimal point button
- Clear and backspace functionality
- Submit button with validation
- Visual feedback for button presses

**CoinSelector Component**:
- High-quality images of UK coins and notes
- Drag-and-drop or counter-based selection
- Real-time total calculation
- Visual representation of coin combinations
- Optimal solution hints for COUNTING model

**MultipleChoice Component**:
- Large A/B/C/D buttons with option text
- Visual highlighting on selection
- Support for images or charts within options
- Instant feedback on selection

#### 4. Session Management

**Purpose**: Track student progress and manage learning sessions

**Technical Implementation**:
```typescript
interface StudentSession {
  sessionId: string;
  studentId?: string;
  startTime: Date;
  questions: Array<{
    questionId: string;
    modelId: string;
    yearLevel: number;
    attempts: Array<{
      answer: any;
      timestamp: Date;
      isCorrect: boolean;
      timeToAnswer: number;
    }>;
  }>;
  currentStreak: number;
  totalScore: number;
}

class SessionManager {
  createSession(): StudentSession;
  recordAnswer(sessionId: string, questionId: string, answer: any): void;
  getProgress(sessionId: string): ProgressStats;
  adjustDifficulty(sessionId: string): DifficultyAdjustment;
}
```

### File Structure

```
app/
├── student/                          # Student-facing pages
│   ├── practice/
│   │   └── page.tsx                 # Main practice interface
│   ├── components/
│   │   ├── AnswerInput.tsx          # Main input orchestrator
│   │   ├── NumberPad.tsx            # Basic arithmetic input
│   │   ├── CoinSelector.tsx         # Money question input
│   │   ├── MultipleChoice.tsx       # Selection input
│   │   ├── Calculator.tsx           # Enhanced numeric input
│   │   ├── ProgressBar.tsx          # Session progress
│   │   ├── FeedbackAnimation.tsx    # Answer feedback
│   │   └── QuestionDisplay.tsx      # Question presentation
│   ├── lib/
│   │   ├── answer-validator.ts      # Answer checking logic
│   │   ├── session-manager.ts       # Progress tracking
│   │   ├── difficulty-adjuster.ts   # Adaptive difficulty
│   │   └── student-types.ts         # Student-specific types
│   └── api/
│       ├── session/route.ts         # Session management API
│       ├── validate/route.ts        # Answer validation API
│       └── progress/route.ts        # Progress tracking API
├── teacher/                          # Teacher dashboard (future)
│   ├── dashboard/
│   │   └── page.tsx                 # Class overview
│   └── components/
│       ├── StudentProgress.tsx      # Individual progress
│       └── ClassInsights.tsx        # Aggregated analytics
```

---

## 🎨 User Interface Components

### Component Design Philosophy

**Accessibility First**:
- Large touch targets (minimum 44px)
- High contrast colors
- Screen reader compatibility
- Keyboard navigation support
- Scalable fonts

**Age-Appropriate Design**:
- **Years 1-2**: Extra large buttons, basic colors, simple animations
- **Years 3-4**: More sophisticated interactions, visual aids
- **Years 5-6**: Advanced tools, smaller interface elements

### Detailed Component Specifications

#### NumberPad Component

**Purpose**: Universal numeric input for arithmetic questions

**Features**:
- Grid layout: 3×4 button arrangement (1-9, 0, decimal, clear)
- Large buttons with clear labels
- Audio feedback on button press (optional)
- Visual highlight on press
- Display area showing current input
- Validation on submit

**Visual Design**:
```
┌─────────────────────────┐
│     12.45               │  ← Current Input Display
├─────────────────────────┤
│  [1]  [2]  [3]         │
│  [4]  [5]  [6]         │
│  [7]  [8]  [9]         │
│  [C]  [0]  [.]         │
│  [    Submit    ]      │  ← Large submit button
└─────────────────────────┘
```

#### CoinSelector Component

**Purpose**: Intuitive money input for all money-related models

**Features**:
- Visual coin images with denominations
- Multiple interaction modes:
  - **Drag & Drop**: Drag coins to collection area
  - **Counter Mode**: +/- buttons for each denomination
  - **Grid Selection**: Tap to select multiple coins
- Running total display
- Coin optimization suggestions
- Visual feedback for correct amounts

**Visual Design**:
```
Available Coins:
┌─────────────────────────────────────────────────┐
│ [1p] [2p] [5p] [10p] [20p] [50p] [£1] [£2]      │
│  +/-  +/-  +/-  +/-   +/-   +/-   +/-   +/-     │
└─────────────────────────────────────────────────┘

Your Collection:        Total: £1.50
┌─────────────────────────────────────────────────┐
│  [£1] [20p] [20p] [10p]                         │
│  (Coins selected appear here)                   │
└─────────────────────────────────────────────────┘
```

#### MultipleChoice Component

**Purpose**: Selection input for comparison and choice questions

**Features**:
- Large, clearly labeled option buttons
- Visual comparison aids (bars, charts)
- Instant selection feedback
- Support for images within options
- Randomized option order
- Highlight selected choice

**Visual Design**:
```
Which is better value?

┌─────────────────────────────────────┐
│  A: £5.00 for 250ml    ████████     │  ← Visual bars
│  B: £3.50 for 200ml    ██████       │     for comparison
│  C: £4.00 for 180ml    █████        │
└─────────────────────────────────────┘

[     A     ] [     B     ] [     C     ]
   Large touch-friendly selection buttons
```

### Feedback and Animation System

**Correct Answer Feedback**:
- Green checkmark animation
- Positive sound effect
- Brief celebration (confetti, sparkle)
- Progress bar advancement
- Streak counter increment

**Incorrect Answer Feedback**:
- Gentle shake animation
- Orange highlight (not red - less intimidating)
- Encouraging message: "Try again!" or "Close! Check your work"
- Hint system activation after multiple attempts
- No penalty to streak counter immediately

**Progress Indicators**:
- Session progress: "Question 3 of 10"
- Streak counter: "5 in a row! 🔥"
- Time spent (optional): "2 minutes"
- Points/score (optional): "85 points"

---

## 📈 Implementation Roadmap

### Phase 1: Foundation (Weeks 1-3)
**Goal**: Build core infrastructure and basic input components

**Technical Deliverables**:
- Student interface routing (`/student/practice`)
- Base component architecture
- Answer validation service
- Session management system
- NumberPad component with validation

**Non-Technical Deliverables**:
- Students can answer basic arithmetic questions with on-screen number buttons
- Immediate feedback for correct/incorrect answers
- Simple progress tracking

**Success Criteria**:
- ADDITION, SUBTRACTION, MULTIPLICATION, DIVISION models fully functional
- Students can complete 10-question session
- Answer validation matches math engine output 100%

### Phase 2: Money Interface (Weeks 4-6)
**Goal**: Implement interactive money question interface

**Technical Deliverables**:
- CoinSelector component with drag-and-drop
- UK coin denomination support
- Money formatting and validation
- COUNTING model optimization features

**Non-Technical Deliverables**:
- Students can make money amounts by selecting coins
- Visual coin counting with running totals
- Smart hints for optimal coin combinations

**Success Criteria**:
- All 6 money models (COIN_RECOGNITION, CHANGE_CALCULATION, etc.) functional
- Students complete money questions 50% faster than traditional methods
- 95% accuracy in coin combination validation

### Phase 3: Enhanced Components (Weeks 7-9)
**Goal**: Complete remaining model interfaces and add visual enhancements

**Technical Deliverables**:
- MultipleChoice component for COMPARISON model
- Fraction visualization tools
- Percentage sliders and calculators
- Multi-step question progressive interface

**Non-Technical Deliverables**:
- Students can answer all 18 model types interactively
- Visual aids help students understand fractions and percentages
- Step-by-step guidance for complex problems

**Success Criteria**:
- 100% model coverage with appropriate UI components
- Student engagement metrics show 80% preference over text-only
- Complex models (MULTI_STEP, LINEAR_EQUATION) show improved comprehension

### Phase 4: Polish and Analytics (Weeks 10-12)
**Goal**: Add advanced features, analytics, and classroom management

**Technical Deliverables**:
- Teacher dashboard for progress monitoring
- Advanced analytics and reporting
- Difficulty auto-adjustment algorithms
- Performance optimization

**Non-Technical Deliverables**:
- Teachers can monitor multiple students in real-time
- Detailed insights into student understanding
- Automatic difficulty adjustment keeps students challenged but not frustrated
- System ready for classroom deployment

**Success Criteria**:
- Support for 30+ concurrent students
- Teacher dashboard provides actionable insights
- Students show measurable improvement in mathematics assessments

### Phase 5: Deployment and Scaling (Weeks 13-16)
**Goal**: Classroom deployment, user testing, and refinement

**Technical Deliverables**:
- Production deployment infrastructure
- User authentication and class management
- Data export and integration capabilities
- Mobile responsiveness optimization

**Non-Technical Deliverables**:
- Pilot program with 3-5 classrooms
- Teacher training materials
- Student tutorial system
- Performance benchmarking against traditional methods

**Success Criteria**:
- Successful deployment in pilot classrooms
- Positive feedback from teachers and students
- Measurable improvement in student outcomes
- Scalable architecture proven for larger deployments

---

## 💰 Resource Requirements

### Development Team
- **1 Frontend Developer** (React/TypeScript specialist)
- **1 UI/UX Designer** (child-focused interface design)
- **0.5 Backend Developer** (API extension and session management)
- **0.25 QA Tester** (accessibility and cross-device testing)

### Infrastructure
- **Hosting**: Upgrade current hosting for increased concurrent users
- **CDN**: Asset delivery for coin images and animations
- **Analytics**: Basic usage tracking and performance monitoring
- **Testing Devices**: Tablets and touch devices for user testing

### Timeline
- **Total Duration**: 16 weeks (4 months)
- **MVP Delivery**: Week 9 (basic functionality complete)
- **Beta Release**: Week 12 (ready for limited testing)
- **Production Launch**: Week 16 (full classroom deployment)

---

## 🎯 Success Metrics and KPIs

### Student Engagement Metrics
- **Answer Speed**: 40% improvement over pen-and-paper methods
- **Session Completion**: 90% of students complete practice sessions
- **Preference Survey**: 80% prefer interactive interface
- **Time on Task**: Increased focused learning time
- **Error Recovery**: Reduced frustration with immediate feedback

### Educational Impact Metrics
- **Accuracy Improvement**: 15% increase in correct answers
- **Concept Retention**: Better performance on follow-up assessments
- **Skill Progression**: Faster advancement through difficulty levels
- **Mistake Pattern Analysis**: Clear identification of common errors
- **Curriculum Coverage**: Comprehensive tracking across all 9 UK curriculum strands

### Technical Performance Metrics
- **Response Time**: <200ms for answer validation
- **Concurrent Users**: Support for 30+ students simultaneously
- **Uptime**: 99.5% availability during school hours
- **Cross-Device Compatibility**: Functional on tablets, laptops, phones
- **Accessibility Compliance**: WCAG 2.1 AA standards

### Teacher Utility Metrics
- **Dashboard Usage**: 80% of teachers actively use progress monitoring
- **Insight Actionability**: Teachers report actionable data from analytics
- **Time Savings**: Reduced time spent on manual checking and progress tracking
- **Differentiation Support**: Better ability to support diverse learners
- **Curriculum Alignment**: Clear mapping to assessment objectives

---

## 🔒 Technical Considerations

### Security and Privacy
- **Data Protection**: GDPR compliant student data handling
- **Session Security**: Secure session management without persistent student identification
- **Local Storage**: Minimize data collection, prioritize local storage
- **Access Control**: School-based access management
- **Audit Trail**: Teacher-accessible logs of student activity

### Performance and Scalability
- **Component Optimization**: React.memo and useMemo for expensive renders
- **Asset Optimization**: Compressed images and lazy loading
- **Caching Strategy**: Intelligent caching for repeated question types
- **Load Balancing**: Horizontal scaling for classroom deployment
- **Offline Support**: Basic offline functionality for unreliable connections

### Accessibility and Inclusion
- **Motor Impairments**: Large touch targets, alternative input methods
- **Visual Impairments**: High contrast mode, screen reader support
- **Cognitive Load**: Clear visual hierarchy, reduced distractions
- **Language Support**: Interface localization capabilities
- **Device Flexibility**: Responsive design for various screen sizes

### Integration and Maintenance
- **API Compatibility**: Seamless integration with existing math engine
- **Version Management**: Backward compatibility with model updates
- **Monitoring**: Real-time performance and error tracking
- **Update Deployment**: Zero-downtime updates during school hours
- **Documentation**: Comprehensive technical and user documentation

---

## 🚀 Next Steps

### Immediate Actions (Week 1)
1. **Stakeholder Approval**: Review and approve project proposal
2. **Team Assembly**: Recruit frontend developer and UI/UX designer
3. **Technical Setup**: Extend existing development environment
4. **Design Research**: Study best practices for educational interfaces
5. **Prototype Development**: Create basic NumberPad component proof-of-concept

### Milestone Decision Points
- **Week 3**: Core infrastructure review - proceed to Phase 2?
- **Week 6**: Money interface completion - user testing results acceptable?
- **Week 9**: MVP demonstration - ready for expanded development?
- **Week 12**: Beta release approval - proceed to pilot program?
- **Week 16**: Production launch decision - scale to full deployment?

---

## 📚 Appendices

### Appendix A: Model-to-UI Mapping Matrix

| Model ID | Question Type | Input Method | Validation Type | Estimated Dev Time |
|----------|--------------|--------------|----------------|-------------------|
| ADDITION | Arithmetic | NumberPad | Numeric exact | 2 days |
| SUBTRACTION | Arithmetic | NumberPad | Numeric exact | 2 days |
| MULTIPLICATION | Arithmetic | NumberPad | Numeric exact | 2 days |
| DIVISION | Arithmetic | NumberPad + Remainder | Numeric + remainder | 3 days |
| PERCENTAGE | Calculation | NumberPad + Slider | Numeric exact | 4 days |
| FRACTION | Calculation | NumberPad + Visual | Numeric exact | 5 days |
| COUNTING | Money/Coins | CoinSelector | Combination match | 6 days |
| COMPARISON | Multiple Choice | Choice Buttons | Index match | 3 days |
| MULTI_STEP | Progressive | Multi-stage UI | Sequence validation | 8 days |
| LINEAR_EQUATION | Algebra | NumberPad + Graph | Variable solution | 6 days |
| UNIT_RATE | Calculation | NumberPad | Rate calculation | 4 days |
| COIN_RECOGNITION | Money | CoinSelector | Denomination match | 5 days |
| CHANGE_CALCULATION | Money | CoinSelector | Money calculation | 5 days |
| MONEY_COMBINATIONS | Money | CoinSelector | Multiple solutions | 6 days |
| MIXED_MONEY_UNITS | Money | Dual Input | Money conversion | 5 days |
| MONEY_FRACTIONS | Money + Fraction | NumberPad + Visual | Fractional money | 6 days |
| MONEY_SCALING | Money + Ratio | NumberPad | Proportional calc | 5 days |
| TIME_RATE | Time/Rate | Dropdown + Number | Time calculation | 4 days |
| CONVERSION | Unit Convert | Dropdown + Number | Unit validation | 4 days |

### Appendix B: Component Hierarchy

```
StudentInterface
├── QuestionDisplay
│   ├── StoryText
│   ├── VisualAids
│   └── ContextImages
├── AnswerInput (dynamic)
│   ├── NumberPad
│   ├── CoinSelector
│   ├── MultipleChoice
│   ├── Calculator
│   └── FractionBuilder
├── FeedbackSystem
│   ├── CorrectAnimation
│   ├── IncorrectFeedback
│   └── HintSystem
└── ProgressTracking
    ├── SessionProgress
    ├── StreakCounter
    └── ScoreDisplay
```

### Appendix C: Key Files Reference

- **Project Proposal**: [`STUDENT_INTERFACE_PROJECT_PROPOSAL.md`](STUDENT_INTERFACE_PROJECT_PROPOSAL.md) *(this file)*
- **Implementation Guide**: [`FACTORY_MODEL_IMPLEMENTATION_GUIDE.md`](FACTORY_MODEL_IMPLEMENTATION_GUIDE.md)
- **Architecture Flow**: [`FACTORY_ARCHITECTURE_FLOW_CHART.md`](FACTORY_ARCHITECTURE_FLOW_CHART.md)
- **Math Engine**: [`lib/math-engine/index.ts`](lib/math-engine/index.ts)
- **Test Interface**: [`app/test/page.tsx`](app/test/page.tsx)
- **Model Registry**: [`lib/models/model-status.ts`](lib/models/model-status.ts)

---

*This project proposal outlines a comprehensive plan to transform Factory Architect from a question generation system into a complete interactive learning platform. The proposed student interface will make mathematics more accessible, engaging, and effective for UK primary school students while providing valuable insights for teachers.*

<function_calls>
<invoke name="TodoWrite">
<parameter name="todos">[{"content": "Create project overview section with non-technical summary", "status": "completed", "activeForm": "Creating project overview section with non-technical summary"}, {"content": "Document technical architecture and implementation details", "status": "completed", "activeForm": "Documenting technical architecture and implementation details"}, {"content": "Define user interface components and interactions", "status": "completed", "activeForm": "Defining user interface components and interactions"}, {"content": "Add implementation timeline and milestones", "status": "in_progress", "activeForm": "Adding implementation timeline and milestones"}]
```
--- END FILE: STUDENT_INTERFACE_PROJECT_PROPOSAL.md ---

--- START FILE: tsconfig.json ---
```json
{
  "compilerOptions": {
    "target": "ES2017",
    "lib": ["dom", "dom.iterable", "esnext"],
    "allowJs": true,
    "skipLibCheck": true,
    "strict": true,
    "noEmit": true,
    "esModuleInterop": true,
    "module": "esnext",
    "moduleResolution": "bundler",
    "resolveJsonModule": true,
    "isolatedModules": true,
    "jsx": "preserve",
    "incremental": true,
    "plugins": [
      {
        "name": "next"
      }
    ],
    "paths": {
      "@/*": ["./*"]
    }
  },
  "include": ["next-env.d.ts", "**/*.ts", "**/*.tsx", ".next/types/**/*.ts"],
  "exclude": ["node_modules"]
}

```
--- END FILE: tsconfig.json ---

