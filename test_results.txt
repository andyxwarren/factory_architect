--- SUITE A: SMOKE TESTS ---
Running basic tests to ensure the API is online and responsive...
# Test A.1: Basic ADDITION request
{
  "success": true,
  "question": {
    "text": "Charlotte buys a apple for 28p and a banana for 15p. What is the total cost?",
    "options": [
      {
        "text": "43p",
        "value": 0.43,
        "index": 0
      },
      {
        "text": "2.43",
        "value": 2.43,
        "index": 1
      },
      {
        "text": "12",
        "value": 12,
        "index": 2
      },
      {
        "text": "1.43",
        "value": 1.43,
        "index": 3
      }
    ],
    "correctIndex": 0,
    "format": "DIRECT_CALCULATION",
    "difficulty": {
      "year": 1,
      "subLevel": 1,
      "displayName": "1.1",
      "cognitiveLoad": 10
    },
    "cognitiveLoad": 10,
    "curriculumTags": [
      "1N1a",
      "1N1b"
    ],
    "scenario": {
      "id": "shop-002-realistic-general",
      "theme": "SHOPPING",
      "setting": {
        "location": "local shop",
        "timeContext": "after school",
        "atmosphere": "friendly"
      },
      "characters": [
        {
          "name": "Charlotte",
          "role": "student"
        }
      ],
      "items": [
        {
          "name": "apple",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.2,
            "max": 0.5,
            "typical": 0.35,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "banana",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.15,
            "max": 0.4,
            "typical": 0.25,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "sandwich",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 2.5,
            "max": 6,
            "typical": 4,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "drink",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.8,
            "max": 2.5,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "cake",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 1.5,
            "max": 4,
            "typical": 2.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "biscuit",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.8,
            "max": 2,
            "typical": 1.2,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "sweet",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.1,
            "max": 1,
            "typical": 0.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "chocolate",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.6,
            "max": 3,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "pen",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.5,
            "max": 2,
            "typical": 1,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "pencil",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.2,
            "max": 1,
            "typical": 0.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "ruler",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.8,
            "max": 2.5,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "notebook",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 1,
            "max": 4,
            "typical": 2,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "eraser",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.3,
            "max": 1.5,
            "typical": 0.75,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "book",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 3,
            "max": 15,
            "typical": 8,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "comic",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 2,
            "max": 5,
            "typical": 3,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "magazine",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 2.5,
            "max": 6,
            "typical": 4,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "toy",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 5,
            "max": 25,
            "typical": 12,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "game",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 8,
            "max": 60,
            "typical": 25,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "puzzle",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 5,
            "max": 20,
            "typical": 12,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "sticker",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 0.2,
            "max": 2,
            "typical": 0.8,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "badge",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 0.5,
            "max": 3,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "poster",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 2,
            "max": 8,
            "typical": 4,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "card",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 0.5,
            "max": 4,
            "typical": 2,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        }
      ],
      "culturalElements": [
        {
          "type": "currency",
          "value": "£",
          "explanation": "British pounds"
        },
        {
          "type": "location",
          "value": "UK local shop",
          "explanation": "Typical British corner shop"
        }
      ],
      "realWorldConnection": "Everyday shopping with realistic UK prices",
      "yearAppropriate": [
        1,
        2,
        3,
        4,
        5,
        6
      ],
      "templates": [
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "MULTI_STEP"
          ],
          "modelCompatibility": [
            "ADDITION"
          ],
          "operandCount": 3,
          "template": "{character} buys a {item1} for {price1}, a {item2} for {price2}, and a {item3} for {price3}. What is the total cost?",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item1",
              "type": "item"
            },
            {
              "key": "item2",
              "type": "item"
            },
            {
              "key": "item3",
              "type": "item"
            },
            {
              "key": "price1",
              "type": "value"
            },
            {
              "key": "price2",
              "type": "value"
            },
            {
              "key": "price3",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "MULTI_STEP"
          ],
          "modelCompatibility": [
            "ADDITION"
          ],
          "operandCount": 2,
          "template": "{character} buys a {item1} for {price1} and a {item2} for {price2}. What is the total cost?",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item1",
              "type": "item"
            },
            {
              "key": "item2",
              "type": "item"
            },
            {
              "key": "price1",
              "type": "value"
            },
            {
              "key": "price2",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION"
          ],
          "modelCompatibility": [
            "SUBTRACTION",
            "CHANGE_CALCULATION"
          ],
          "template": "{character} buys a {item} for {price} and pays with {payment}. How much change does {character} get?",
          "answerTemplate": "{character} receives {result} in change",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "price",
              "type": "value"
            },
            {
              "key": "payment",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION"
          ],
          "modelCompatibility": [
            "MULTIPLICATION"
          ],
          "template": "{character} buys {quantity} {item} at {price} each. What is the total cost?",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "quantity",
              "type": "value"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "price",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION"
          ],
          "modelCompatibility": [
            "DIVISION"
          ],
          "template": "{character} has {total} to spend equally on {quantity} {item}. How much can {character} spend on each one?",
          "answerTemplate": "{character} can spend {result} on each {item}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "total",
              "type": "value"
            },
            {
              "key": "quantity",
              "type": "value"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "COMPARISON",
            "ESTIMATION",
            "MULTI_STEP"
          ],
          "template": "{character} goes to the shop and buys {items}. How much does {character} spend in total?",
          "answerTemplate": "{character} spends {result} in total",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "items",
              "type": "item_list"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "ESTIMATION"
          ],
          "template": "Estimate: If {character} buys {items}, about how much will it cost?",
          "answerTemplate": "It will cost approximately {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "items",
              "type": "item_list"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "VALIDATION"
          ],
          "template": "{character} calculated that {items} costs {amount}. Is this correct?",
          "answerTemplate": "{validation_result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "items",
              "type": "item_list"
            },
            {
              "key": "amount",
              "type": "value"
            },
            {
              "key": "validation_result",
              "type": "boolean"
            }
          ]
        }
      ]
    },
    "distractors": [
      {
        "value": 12,
        "displayText": "12",
        "strategy": "WRONG_OPERATION",
        "reasoning": "Multiplied instead of adding"
      },
      {
        "value": 1.43,
        "displayText": "1.43",
        "strategy": "CLOSE_VALUE",
        "reasoning": "Off by 1"
      },
      {
        "value": 2.43,
        "displayText": "2.43",
        "strategy": "CLOSE_VALUE",
        "reasoning": "Off by 2"
      }
    ],
    "enhancementStatus": {
      "level": "partial",
      "requestedFormat": "DIRECT_CALCULATION",
      "actualFormat": "DIRECT_CALCULATION",
      "featuresActive": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "featuresPending": [],
      "isFullyEnhanced": true
    },
    "mathOutput": {
      "operation": "ADDITION",
      "operand_1": 0.28,
      "operand_2": 0.15,
      "result": 0.43
    },
    "generationTime": 3,
    "questionId": "q_1759079324633_n4eo4tiz1",
    "generationSetup": {
      "controller_used": "DIRECT_CALCULATIONController",
      "format_requested": "DIRECT_CALCULATION",
      "format_actual": "DIRECT_CALCULATION",
      "scenario_theme": "SHOPPING",
      "scenario_id": "shop-002-realistic-general",
      "scenario_selection_method": "default",
      "distractor_strategies": [
        "WRONG_OPERATION",
        "CLOSE_VALUE",
        "CLOSE_VALUE"
      ],
      "distractor_count": 3,
      "theme_variety": false,
      "format_variety": false,
      "enhancement_level": "partial",
      "features_active": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "features_pending": [],
      "generation_time_ms": 3
    }
  },
  "metadata": {
    "format": "DIRECT_CALCULATION",
    "cognitive_load": 10,
    "curriculum_alignment": [
      "1N1a",
      "1N1b"
    ],
    "difficulty": "1.1",
    "scenario_theme": "SHOPPING",
    "distractor_strategies": [
      "WRONG_OPERATION",
      "CLOSE_VALUE",
      "CLOSE_VALUE"
    ],
    "generation_time_ms": 3,
    "api_version": "2.0",
    "enhancement_status": "partial",
    "format_requested": "DIRECT_CALCULATION",
    "format_used": "DIRECT_CALCULATION",
    "features_active": [
      "enhanced_distractors",
      "rich_scenarios",
      "cognitive_load",
      "advanced_formats"
    ],
    "features_pending": []
  },
  "context": {
    "id": "shop-002-realistic-general",
    "theme": "SHOPPING",
    "setting": {
      "location": "local shop",
      "timeContext": "after school",
      "atmosphere": "friendly"
    },
    "characters": [
      {
        "name": "Charlotte",
        "role": "student"
      }
    ],
    "items": [
      {
        "name": "apple",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.2,
          "max": 0.5,
          "typical": 0.35,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "banana",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.15,
          "max": 0.4,
          "typical": 0.25,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "sandwich",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 2.5,
          "max": 6,
          "typical": 4,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "drink",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.8,
          "max": 2.5,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "cake",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 1.5,
          "max": 4,
          "typical": 2.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "biscuit",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.8,
          "max": 2,
          "typical": 1.2,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "sweet",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.1,
          "max": 1,
          "typical": 0.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "chocolate",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.6,
          "max": 3,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "pen",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.5,
          "max": 2,
          "typical": 1,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "pencil",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.2,
          "max": 1,
          "typical": 0.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "ruler",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.8,
          "max": 2.5,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "notebook",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 1,
          "max": 4,
          "typical": 2,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "eraser",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.3,
          "max": 1.5,
          "typical": 0.75,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "book",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 3,
          "max": 15,
          "typical": 8,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "comic",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 2,
          "max": 5,
          "typical": 3,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "magazine",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 2.5,
          "max": 6,
          "typical": 4,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "toy",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 5,
          "max": 25,
          "typical": 12,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "game",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 8,
          "max": 60,
          "typical": 25,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "puzzle",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 5,
          "max": 20,
          "typical": 12,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "sticker",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 0.2,
          "max": 2,
          "typical": 0.8,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "badge",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 0.5,
          "max": 3,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "poster",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 2,
          "max": 8,
          "typical": 4,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "card",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 0.5,
          "max": 4,
          "typical": 2,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      }
    ],
    "culturalElements": [
      {
        "type": "currency",
        "value": "£",
        "explanation": "British pounds"
      },
      {
        "type": "location",
        "value": "UK local shop",
        "explanation": "Typical British corner shop"
      }
    ],
    "realWorldConnection": "Everyday shopping with realistic UK prices",
    "yearAppropriate": [
      1,
      2,
      3,
      4,
      5,
      6
    ],
    "templates": [
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "MULTI_STEP"
        ],
        "modelCompatibility": [
          "ADDITION"
        ],
        "operandCount": 3,
        "template": "{character} buys a {item1} for {price1}, a {item2} for {price2}, and a {item3} for {price3}. What is the total cost?",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item1",
            "type": "item"
          },
          {
            "key": "item2",
            "type": "item"
          },
          {
            "key": "item3",
            "type": "item"
          },
          {
            "key": "price1",
            "type": "value"
          },
          {
            "key": "price2",
            "type": "value"
          },
          {
            "key": "price3",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "MULTI_STEP"
        ],
        "modelCompatibility": [
          "ADDITION"
        ],
        "operandCount": 2,
        "template": "{character} buys a {item1} for {price1} and a {item2} for {price2}. What is the total cost?",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item1",
            "type": "item"
          },
          {
            "key": "item2",
            "type": "item"
          },
          {
            "key": "price1",
            "type": "value"
          },
          {
            "key": "price2",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION"
        ],
        "modelCompatibility": [
          "SUBTRACTION",
          "CHANGE_CALCULATION"
        ],
        "template": "{character} buys a {item} for {price} and pays with {payment}. How much change does {character} get?",
        "answerTemplate": "{character} receives {result} in change",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "price",
            "type": "value"
          },
          {
            "key": "payment",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION"
        ],
        "modelCompatibility": [
          "MULTIPLICATION"
        ],
        "template": "{character} buys {quantity} {item} at {price} each. What is the total cost?",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "quantity",
            "type": "value"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "price",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION"
        ],
        "modelCompatibility": [
          "DIVISION"
        ],
        "template": "{character} has {total} to spend equally on {quantity} {item}. How much can {character} spend on each one?",
        "answerTemplate": "{character} can spend {result} on each {item}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "total",
            "type": "value"
          },
          {
            "key": "quantity",
            "type": "value"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "COMPARISON",
          "ESTIMATION",
          "MULTI_STEP"
        ],
        "template": "{character} goes to the shop and buys {items}. How much does {character} spend in total?",
        "answerTemplate": "{character} spends {result} in total",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "items",
            "type": "item_list"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "ESTIMATION"
        ],
        "template": "Estimate: If {character} buys {items}, about how much will it cost?",
        "answerTemplate": "It will cost approximately {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "items",
            "type": "item_list"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "VALIDATION"
        ],
        "template": "{character} calculated that {items} costs {amount}. Is this correct?",
        "answerTemplate": "{validation_result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "items",
            "type": "item_list"
          },
          {
            "key": "amount",
            "type": "value"
          },
          {
            "key": "validation_result",
            "type": "boolean"
          }
        ]
      }
    ]
  }
}
# Test A.2: Basic SUBTRACTION request
{
  "success": true,
  "question": {
    "text": "Charlotte buys a apple for 48p and pays with £50. How much change does Charlotte get?",
    "options": [
      {
        "text": "10",
        "value": 10,
        "index": 0
      },
      {
        "text": "£49.52",
        "value": 49.52,
        "index": 1
      },
      {
        "text": "59.52",
        "value": 59.52,
        "index": 2
      }
    ],
    "correctIndex": 1,
    "format": "DIRECT_CALCULATION",
    "difficulty": {
      "year": 1,
      "subLevel": 2,
      "displayName": "1.2",
      "cognitiveLoad": 15
    },
    "cognitiveLoad": 15,
    "curriculumTags": [
      "1N1c",
      "1N1d"
    ],
    "scenario": {
      "id": "shop-002-realistic-general",
      "theme": "SHOPPING",
      "setting": {
        "location": "local shop",
        "timeContext": "after school",
        "atmosphere": "friendly"
      },
      "characters": [
        {
          "name": "Charlotte",
          "role": "student"
        }
      ],
      "items": [
        {
          "name": "apple",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.2,
            "max": 0.5,
            "typical": 0.35,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "banana",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.15,
            "max": 0.4,
            "typical": 0.25,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "sandwich",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 2.5,
            "max": 6,
            "typical": 4,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "drink",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.8,
            "max": 2.5,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "cake",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 1.5,
            "max": 4,
            "typical": 2.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "biscuit",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.8,
            "max": 2,
            "typical": 1.2,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "sweet",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.1,
            "max": 1,
            "typical": 0.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "chocolate",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.6,
            "max": 3,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "pen",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.5,
            "max": 2,
            "typical": 1,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "pencil",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.2,
            "max": 1,
            "typical": 0.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "ruler",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.8,
            "max": 2.5,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "notebook",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 1,
            "max": 4,
            "typical": 2,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "eraser",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.3,
            "max": 1.5,
            "typical": 0.75,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "book",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 3,
            "max": 15,
            "typical": 8,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "comic",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 2,
            "max": 5,
            "typical": 3,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "magazine",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 2.5,
            "max": 6,
            "typical": 4,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "toy",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 5,
            "max": 25,
            "typical": 12,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "game",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 8,
            "max": 60,
            "typical": 25,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "puzzle",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 5,
            "max": 20,
            "typical": 12,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "sticker",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 0.2,
            "max": 2,
            "typical": 0.8,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "badge",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 0.5,
            "max": 3,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "poster",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 2,
            "max": 8,
            "typical": 4,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "card",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 0.5,
            "max": 4,
            "typical": 2,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        }
      ],
      "culturalElements": [
        {
          "type": "currency",
          "value": "£",
          "explanation": "British pounds"
        },
        {
          "type": "location",
          "value": "UK local shop",
          "explanation": "Typical British corner shop"
        }
      ],
      "realWorldConnection": "Everyday shopping with realistic UK prices",
      "yearAppropriate": [
        1,
        2,
        3,
        4,
        5,
        6
      ],
      "templates": [
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "MULTI_STEP"
          ],
          "modelCompatibility": [
            "ADDITION"
          ],
          "operandCount": 3,
          "template": "{character} buys a {item1} for {price1}, a {item2} for {price2}, and a {item3} for {price3}. What is the total cost?",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item1",
              "type": "item"
            },
            {
              "key": "item2",
              "type": "item"
            },
            {
              "key": "item3",
              "type": "item"
            },
            {
              "key": "price1",
              "type": "value"
            },
            {
              "key": "price2",
              "type": "value"
            },
            {
              "key": "price3",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "MULTI_STEP"
          ],
          "modelCompatibility": [
            "ADDITION"
          ],
          "operandCount": 2,
          "template": "{character} buys a {item1} for {price1} and a {item2} for {price2}. What is the total cost?",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item1",
              "type": "item"
            },
            {
              "key": "item2",
              "type": "item"
            },
            {
              "key": "price1",
              "type": "value"
            },
            {
              "key": "price2",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION"
          ],
          "modelCompatibility": [
            "SUBTRACTION",
            "CHANGE_CALCULATION"
          ],
          "template": "{character} buys a {item} for {price} and pays with {payment}. How much change does {character} get?",
          "answerTemplate": "{character} receives {result} in change",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "price",
              "type": "value"
            },
            {
              "key": "payment",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION"
          ],
          "modelCompatibility": [
            "MULTIPLICATION"
          ],
          "template": "{character} buys {quantity} {item} at {price} each. What is the total cost?",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "quantity",
              "type": "value"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "price",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION"
          ],
          "modelCompatibility": [
            "DIVISION"
          ],
          "template": "{character} has {total} to spend equally on {quantity} {item}. How much can {character} spend on each one?",
          "answerTemplate": "{character} can spend {result} on each {item}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "total",
              "type": "value"
            },
            {
              "key": "quantity",
              "type": "value"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "COMPARISON",
            "ESTIMATION",
            "MULTI_STEP"
          ],
          "template": "{character} goes to the shop and buys {items}. How much does {character} spend in total?",
          "answerTemplate": "{character} spends {result} in total",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "items",
              "type": "item_list"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "ESTIMATION"
          ],
          "template": "Estimate: If {character} buys {items}, about how much will it cost?",
          "answerTemplate": "It will cost approximately {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "items",
              "type": "item_list"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "VALIDATION"
          ],
          "template": "{character} calculated that {items} costs {amount}. Is this correct?",
          "answerTemplate": "{validation_result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "items",
              "type": "item_list"
            },
            {
              "key": "amount",
              "type": "value"
            },
            {
              "key": "validation_result",
              "type": "boolean"
            }
          ]
        }
      ]
    },
    "distractors": [
      {
        "value": 10,
        "displayText": "10",
        "strategy": "WRONG_OPERATION",
        "reasoning": "Added instead of subtracting"
      },
      {
        "value": 59.52,
        "displayText": "59.52",
        "strategy": "PLACE_VALUE_ERROR",
        "reasoning": "Error in carrying to next column"
      }
    ],
    "enhancementStatus": {
      "level": "partial",
      "requestedFormat": "DIRECT_CALCULATION",
      "actualFormat": "DIRECT_CALCULATION",
      "featuresActive": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "featuresPending": [],
      "isFullyEnhanced": true
    },
    "mathOutput": {
      "operation": "SUBTRACTION",
      "subtrahend": 0.48,
      "minuend": 50,
      "result": 49.52
    },
    "generationTime": 1,
    "questionId": "q_1759079324678_wzwmznm97",
    "generationSetup": {
      "controller_used": "DIRECT_CALCULATIONController",
      "format_requested": "DIRECT_CALCULATION",
      "format_actual": "DIRECT_CALCULATION",
      "scenario_theme": "SHOPPING",
      "scenario_id": "shop-002-realistic-general",
      "scenario_selection_method": "default",
      "distractor_strategies": [
        "WRONG_OPERATION",
        "PLACE_VALUE_ERROR"
      ],
      "distractor_count": 2,
      "theme_variety": false,
      "format_variety": false,
      "enhancement_level": "partial",
      "features_active": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "features_pending": [],
      "generation_time_ms": 1
    }
  },
  "metadata": {
    "format": "DIRECT_CALCULATION",
    "cognitive_load": 15,
    "curriculum_alignment": [
      "1N1c",
      "1N1d"
    ],
    "difficulty": "1.2",
    "scenario_theme": "SHOPPING",
    "distractor_strategies": [
      "WRONG_OPERATION",
      "PLACE_VALUE_ERROR"
    ],
    "generation_time_ms": 1,
    "api_version": "2.0",
    "enhancement_status": "partial",
    "format_requested": "DIRECT_CALCULATION",
    "format_used": "DIRECT_CALCULATION",
    "features_active": [
      "enhanced_distractors",
      "rich_scenarios",
      "cognitive_load",
      "advanced_formats"
    ],
    "features_pending": []
  },
  "context": {
    "id": "shop-002-realistic-general",
    "theme": "SHOPPING",
    "setting": {
      "location": "local shop",
      "timeContext": "after school",
      "atmosphere": "friendly"
    },
    "characters": [
      {
        "name": "Charlotte",
        "role": "student"
      }
    ],
    "items": [
      {
        "name": "apple",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.2,
          "max": 0.5,
          "typical": 0.35,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "banana",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.15,
          "max": 0.4,
          "typical": 0.25,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "sandwich",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 2.5,
          "max": 6,
          "typical": 4,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "drink",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.8,
          "max": 2.5,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "cake",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 1.5,
          "max": 4,
          "typical": 2.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "biscuit",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.8,
          "max": 2,
          "typical": 1.2,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "sweet",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.1,
          "max": 1,
          "typical": 0.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "chocolate",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.6,
          "max": 3,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "pen",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.5,
          "max": 2,
          "typical": 1,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "pencil",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.2,
          "max": 1,
          "typical": 0.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "ruler",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.8,
          "max": 2.5,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "notebook",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 1,
          "max": 4,
          "typical": 2,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "eraser",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.3,
          "max": 1.5,
          "typical": 0.75,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "book",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 3,
          "max": 15,
          "typical": 8,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "comic",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 2,
          "max": 5,
          "typical": 3,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "magazine",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 2.5,
          "max": 6,
          "typical": 4,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "toy",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 5,
          "max": 25,
          "typical": 12,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "game",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 8,
          "max": 60,
          "typical": 25,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "puzzle",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 5,
          "max": 20,
          "typical": 12,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "sticker",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 0.2,
          "max": 2,
          "typical": 0.8,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "badge",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 0.5,
          "max": 3,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "poster",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 2,
          "max": 8,
          "typical": 4,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "card",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 0.5,
          "max": 4,
          "typical": 2,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      }
    ],
    "culturalElements": [
      {
        "type": "currency",
        "value": "£",
        "explanation": "British pounds"
      },
      {
        "type": "location",
        "value": "UK local shop",
        "explanation": "Typical British corner shop"
      }
    ],
    "realWorldConnection": "Everyday shopping with realistic UK prices",
    "yearAppropriate": [
      1,
      2,
      3,
      4,
      5,
      6
    ],
    "templates": [
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "MULTI_STEP"
        ],
        "modelCompatibility": [
          "ADDITION"
        ],
        "operandCount": 3,
        "template": "{character} buys a {item1} for {price1}, a {item2} for {price2}, and a {item3} for {price3}. What is the total cost?",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item1",
            "type": "item"
          },
          {
            "key": "item2",
            "type": "item"
          },
          {
            "key": "item3",
            "type": "item"
          },
          {
            "key": "price1",
            "type": "value"
          },
          {
            "key": "price2",
            "type": "value"
          },
          {
            "key": "price3",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "MULTI_STEP"
        ],
        "modelCompatibility": [
          "ADDITION"
        ],
        "operandCount": 2,
        "template": "{character} buys a {item1} for {price1} and a {item2} for {price2}. What is the total cost?",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item1",
            "type": "item"
          },
          {
            "key": "item2",
            "type": "item"
          },
          {
            "key": "price1",
            "type": "value"
          },
          {
            "key": "price2",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION"
        ],
        "modelCompatibility": [
          "SUBTRACTION",
          "CHANGE_CALCULATION"
        ],
        "template": "{character} buys a {item} for {price} and pays with {payment}. How much change does {character} get?",
        "answerTemplate": "{character} receives {result} in change",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "price",
            "type": "value"
          },
          {
            "key": "payment",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION"
        ],
        "modelCompatibility": [
          "MULTIPLICATION"
        ],
        "template": "{character} buys {quantity} {item} at {price} each. What is the total cost?",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "quantity",
            "type": "value"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "price",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION"
        ],
        "modelCompatibility": [
          "DIVISION"
        ],
        "template": "{character} has {total} to spend equally on {quantity} {item}. How much can {character} spend on each one?",
        "answerTemplate": "{character} can spend {result} on each {item}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "total",
            "type": "value"
          },
          {
            "key": "quantity",
            "type": "value"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "COMPARISON",
          "ESTIMATION",
          "MULTI_STEP"
        ],
        "template": "{character} goes to the shop and buys {items}. How much does {character} spend in total?",
        "answerTemplate": "{character} spends {result} in total",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "items",
            "type": "item_list"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "ESTIMATION"
        ],
        "template": "Estimate: If {character} buys {items}, about how much will it cost?",
        "answerTemplate": "It will cost approximately {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "items",
            "type": "item_list"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "VALIDATION"
        ],
        "template": "{character} calculated that {items} costs {amount}. Is this correct?",
        "answerTemplate": "{validation_result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "items",
            "type": "item_list"
          },
          {
            "key": "amount",
            "type": "value"
          },
          {
            "key": "validation_result",
            "type": "boolean"
          }
        ]
      }
    ]
  }
}

--- SUITE B: MODEL COVERAGE TESTS ---
Testing every mathematical model to ensure basic generation and catch crashes...
# Test B.1: ADDITION model
{
  "success": true,
  "question": {
    "text": "Sarah wants to buy books at the book fair. Calculate the total cost.",
    "options": [
      {
        "text": "20.78",
        "value": 20.78,
        "index": 0
      },
      {
        "text": "3750",
        "value": 3750,
        "index": 1
      },
      {
        "text": "95",
        "value": 95,
        "index": 2
      },
      {
        "text": "£10.78",
        "value": 10.78,
        "index": 3
      }
    ],
    "correctIndex": 3,
    "format": "DIRECT_CALCULATION",
    "difficulty": {
      "year": 4,
      "subLevel": 1,
      "displayName": "4.1",
      "cognitiveLoad": 40
    },
    "cognitiveLoad": 40,
    "curriculumTags": [
      "4N1a",
      "4N1b"
    ],
    "scenario": {
      "id": "shop-001-bookfair",
      "theme": "SHOPPING",
      "setting": {
        "location": "school book fair",
        "timeContext": "lunch break",
        "atmosphere": "busy"
      },
      "characters": [
        {
          "name": "Sarah",
          "role": "student"
        },
        {
          "name": "Mr. Johnson",
          "role": "teacher"
        }
      ],
      "items": [
        {
          "name": "book",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 3,
            "max": 12,
            "typical": 6.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "bookmark",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.5,
            "max": 2,
            "typical": 1,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        }
      ],
      "culturalElements": [
        {
          "type": "currency",
          "value": "£",
          "explanation": "British pounds"
        },
        {
          "type": "event",
          "value": "book fair",
          "explanation": "School fundraising event"
        }
      ],
      "realWorldConnection": "School fundraising and reading promotion",
      "yearAppropriate": [
        2,
        3,
        4,
        5
      ],
      "templates": [
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "COMPARISON"
          ],
          "template": "{character} wants to buy books at the book fair. Calculate the total cost.",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        }
      ]
    },
    "distractors": [
      {
        "value": 95,
        "displayText": "95",
        "strategy": "WRONG_OPERATION",
        "reasoning": "Subtracted instead of adding"
      },
      {
        "value": 3750,
        "displayText": "3750",
        "strategy": "WRONG_OPERATION",
        "reasoning": "Multiplied instead of adding"
      },
      {
        "value": 20.78,
        "displayText": "20.78",
        "strategy": "PLACE_VALUE_ERROR",
        "reasoning": "Error in carrying to next column"
      }
    ],
    "enhancementStatus": {
      "level": "partial",
      "requestedFormat": "DIRECT_CALCULATION",
      "actualFormat": "DIRECT_CALCULATION",
      "featuresActive": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "featuresPending": [],
      "isFullyEnhanced": true
    },
    "mathOutput": {
      "operation": "ADDITION",
      "operand_1": 4.82,
      "operand_2": 1.54,
      "operand_3": 4.42,
      "result": 10.78
    },
    "generationTime": 1,
    "questionId": "q_1759079324719_u5ta5tdrt",
    "generationSetup": {
      "controller_used": "DIRECT_CALCULATIONController",
      "format_requested": "DIRECT_CALCULATION",
      "format_actual": "DIRECT_CALCULATION",
      "scenario_theme": "SHOPPING",
      "scenario_id": "shop-001-bookfair",
      "scenario_selection_method": "default",
      "distractor_strategies": [
        "WRONG_OPERATION",
        "WRONG_OPERATION",
        "PLACE_VALUE_ERROR"
      ],
      "distractor_count": 3,
      "theme_variety": false,
      "format_variety": false,
      "enhancement_level": "partial",
      "features_active": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "features_pending": [],
      "generation_time_ms": 1
    }
  },
  "metadata": {
    "format": "DIRECT_CALCULATION",
    "cognitive_load": 40,
    "curriculum_alignment": [
      "4N1a",
      "4N1b"
    ],
    "difficulty": "4.1",
    "scenario_theme": "SHOPPING",
    "distractor_strategies": [
      "WRONG_OPERATION",
      "WRONG_OPERATION",
      "PLACE_VALUE_ERROR"
    ],
    "generation_time_ms": 1,
    "api_version": "2.0",
    "enhancement_status": "partial",
    "format_requested": "DIRECT_CALCULATION",
    "format_used": "DIRECT_CALCULATION",
    "features_active": [
      "enhanced_distractors",
      "rich_scenarios",
      "cognitive_load",
      "advanced_formats"
    ],
    "features_pending": []
  },
  "context": {
    "id": "shop-001-bookfair",
    "theme": "SHOPPING",
    "setting": {
      "location": "school book fair",
      "timeContext": "lunch break",
      "atmosphere": "busy"
    },
    "characters": [
      {
        "name": "Sarah",
        "role": "student"
      },
      {
        "name": "Mr. Johnson",
        "role": "teacher"
      }
    ],
    "items": [
      {
        "name": "book",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 3,
          "max": 12,
          "typical": 6.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "bookmark",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.5,
          "max": 2,
          "typical": 1,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      }
    ],
    "culturalElements": [
      {
        "type": "currency",
        "value": "£",
        "explanation": "British pounds"
      },
      {
        "type": "event",
        "value": "book fair",
        "explanation": "School fundraising event"
      }
    ],
    "realWorldConnection": "School fundraising and reading promotion",
    "yearAppropriate": [
      2,
      3,
      4,
      5
    ],
    "templates": [
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "COMPARISON"
        ],
        "template": "{character} wants to buy books at the book fair. Calculate the total cost.",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      }
    ]
  }
}
# Test B.2: SUBTRACTION model
{
  "success": true,
  "question": {
    "text": "Sarah wants to buy books at the book fair. Calculate the total cost.",
    "options": [
      {
        "text": "£2.00",
        "value": 2,
        "index": 0
      },
      {
        "text": "161",
        "value": 161,
        "index": 1
      },
      {
        "text": "3",
        "value": 3,
        "index": 2
      },
      {
        "text": "1",
        "value": 1,
        "index": 3
      }
    ],
    "correctIndex": 0,
    "format": "DIRECT_CALCULATION",
    "difficulty": {
      "year": 4,
      "subLevel": 1,
      "displayName": "4.1",
      "cognitiveLoad": 40
    },
    "cognitiveLoad": 40,
    "curriculumTags": [
      "4N1c",
      "4N1d"
    ],
    "scenario": {
      "id": "shop-001-bookfair",
      "theme": "SHOPPING",
      "setting": {
        "location": "school book fair",
        "timeContext": "lunch break",
        "atmosphere": "busy"
      },
      "characters": [
        {
          "name": "Sarah",
          "role": "student"
        },
        {
          "name": "Mr. Johnson",
          "role": "teacher"
        }
      ],
      "items": [
        {
          "name": "book",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 3,
            "max": 12,
            "typical": 6.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "bookmark",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.5,
            "max": 2,
            "typical": 1,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        }
      ],
      "culturalElements": [
        {
          "type": "currency",
          "value": "£",
          "explanation": "British pounds"
        },
        {
          "type": "event",
          "value": "book fair",
          "explanation": "School fundraising event"
        }
      ],
      "realWorldConnection": "School fundraising and reading promotion",
      "yearAppropriate": [
        2,
        3,
        4,
        5
      ],
      "templates": [
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "COMPARISON"
          ],
          "template": "{character} wants to buy books at the book fair. Calculate the total cost.",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        }
      ]
    },
    "distractors": [
      {
        "value": 161,
        "displayText": "161",
        "strategy": "WRONG_OPERATION",
        "reasoning": "Added instead of subtracting"
      },
      {
        "value": 3,
        "displayText": "3",
        "strategy": "CLOSE_VALUE",
        "reasoning": "Off by 1"
      },
      {
        "value": 1,
        "displayText": "1",
        "strategy": "CLOSE_VALUE",
        "reasoning": "Off by 1"
      }
    ],
    "enhancementStatus": {
      "level": "partial",
      "requestedFormat": "DIRECT_CALCULATION",
      "actualFormat": "DIRECT_CALCULATION",
      "featuresActive": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "featuresPending": [],
      "isFullyEnhanced": true
    },
    "mathOutput": {
      "operation": "SUBTRACTION",
      "subtrahend": 8,
      "minuend": 10,
      "result": 2
    },
    "generationTime": 1,
    "questionId": "q_1759079324761_mab5a40je",
    "generationSetup": {
      "controller_used": "DIRECT_CALCULATIONController",
      "format_requested": "DIRECT_CALCULATION",
      "format_actual": "DIRECT_CALCULATION",
      "scenario_theme": "SHOPPING",
      "scenario_id": "shop-001-bookfair",
      "scenario_selection_method": "default",
      "distractor_strategies": [
        "WRONG_OPERATION",
        "CLOSE_VALUE",
        "CLOSE_VALUE"
      ],
      "distractor_count": 3,
      "theme_variety": false,
      "format_variety": false,
      "enhancement_level": "partial",
      "features_active": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "features_pending": [],
      "generation_time_ms": 1
    }
  },
  "metadata": {
    "format": "DIRECT_CALCULATION",
    "cognitive_load": 40,
    "curriculum_alignment": [
      "4N1c",
      "4N1d"
    ],
    "difficulty": "4.1",
    "scenario_theme": "SHOPPING",
    "distractor_strategies": [
      "WRONG_OPERATION",
      "CLOSE_VALUE",
      "CLOSE_VALUE"
    ],
    "generation_time_ms": 1,
    "api_version": "2.0",
    "enhancement_status": "partial",
    "format_requested": "DIRECT_CALCULATION",
    "format_used": "DIRECT_CALCULATION",
    "features_active": [
      "enhanced_distractors",
      "rich_scenarios",
      "cognitive_load",
      "advanced_formats"
    ],
    "features_pending": []
  },
  "context": {
    "id": "shop-001-bookfair",
    "theme": "SHOPPING",
    "setting": {
      "location": "school book fair",
      "timeContext": "lunch break",
      "atmosphere": "busy"
    },
    "characters": [
      {
        "name": "Sarah",
        "role": "student"
      },
      {
        "name": "Mr. Johnson",
        "role": "teacher"
      }
    ],
    "items": [
      {
        "name": "book",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 3,
          "max": 12,
          "typical": 6.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "bookmark",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.5,
          "max": 2,
          "typical": 1,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      }
    ],
    "culturalElements": [
      {
        "type": "currency",
        "value": "£",
        "explanation": "British pounds"
      },
      {
        "type": "event",
        "value": "book fair",
        "explanation": "School fundraising event"
      }
    ],
    "realWorldConnection": "School fundraising and reading promotion",
    "yearAppropriate": [
      2,
      3,
      4,
      5
    ],
    "templates": [
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "COMPARISON"
        ],
        "template": "{character} wants to buy books at the book fair. Calculate the total cost.",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      }
    ]
  }
}
# Test B.3: MULTIPLICATION model
{
  "success": true,
  "question": {
    "text": "Sarah wants to buy books at the book fair. Calculate the total cost.",
    "options": [
      {
        "text": "£20.48",
        "value": 20.48,
        "index": 0
      },
      {
        "text": "30.48",
        "value": 30.48,
        "index": 1
      },
      {
        "text": "15",
        "value": 15,
        "index": 2
      },
      {
        "text": "11",
        "value": 11,
        "index": 3
      }
    ],
    "correctIndex": 0,
    "format": "DIRECT_CALCULATION",
    "difficulty": {
      "year": 4,
      "subLevel": 1,
      "displayName": "4.1",
      "cognitiveLoad": 40
    },
    "cognitiveLoad": 40,
    "curriculumTags": [
      "4N1a"
    ],
    "scenario": {
      "id": "shop-001-bookfair",
      "theme": "SHOPPING",
      "setting": {
        "location": "school book fair",
        "timeContext": "lunch break",
        "atmosphere": "busy"
      },
      "characters": [
        {
          "name": "Sarah",
          "role": "student"
        },
        {
          "name": "Mr. Johnson",
          "role": "teacher"
        }
      ],
      "items": [
        {
          "name": "book",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 3,
            "max": 12,
            "typical": 6.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "bookmark",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.5,
            "max": 2,
            "typical": 1,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        }
      ],
      "culturalElements": [
        {
          "type": "currency",
          "value": "£",
          "explanation": "British pounds"
        },
        {
          "type": "event",
          "value": "book fair",
          "explanation": "School fundraising event"
        }
      ],
      "realWorldConnection": "School fundraising and reading promotion",
      "yearAppropriate": [
        2,
        3,
        4,
        5
      ],
      "templates": [
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "COMPARISON"
          ],
          "template": "{character} wants to buy books at the book fair. Calculate the total cost.",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        }
      ]
    },
    "distractors": [
      {
        "value": 15,
        "displayText": "15",
        "strategy": "WRONG_OPERATION",
        "reasoning": "Added instead of multiplying"
      },
      {
        "value": 11,
        "displayText": "11",
        "strategy": "WRONG_OPERATION",
        "reasoning": "Subtracted instead of multiplying"
      },
      {
        "value": 30.48,
        "displayText": "30.48",
        "strategy": "PLACE_VALUE_ERROR",
        "reasoning": "Error in carrying to next column"
      }
    ],
    "enhancementStatus": {
      "level": "partial",
      "requestedFormat": "DIRECT_CALCULATION",
      "actualFormat": "DIRECT_CALCULATION",
      "featuresActive": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "featuresPending": [],
      "isFullyEnhanced": true
    },
    "mathOutput": {
      "operation": "MULTIPLICATION",
      "multiplier": 2,
      "multiplicand": 10.24,
      "result": 20.48
    },
    "generationTime": 0,
    "questionId": "q_1759079324801_fipy3ee23",
    "generationSetup": {
      "controller_used": "DIRECT_CALCULATIONController",
      "format_requested": "DIRECT_CALCULATION",
      "format_actual": "DIRECT_CALCULATION",
      "scenario_theme": "SHOPPING",
      "scenario_id": "shop-001-bookfair",
      "scenario_selection_method": "default",
      "distractor_strategies": [
        "WRONG_OPERATION",
        "WRONG_OPERATION",
        "PLACE_VALUE_ERROR"
      ],
      "distractor_count": 3,
      "theme_variety": false,
      "format_variety": false,
      "enhancement_level": "partial",
      "features_active": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "features_pending": [],
      "generation_time_ms": 0
    }
  },
  "metadata": {
    "format": "DIRECT_CALCULATION",
    "cognitive_load": 40,
    "curriculum_alignment": [
      "4N1a"
    ],
    "difficulty": "4.1",
    "scenario_theme": "SHOPPING",
    "distractor_strategies": [
      "WRONG_OPERATION",
      "WRONG_OPERATION",
      "PLACE_VALUE_ERROR"
    ],
    "generation_time_ms": 0,
    "api_version": "2.0",
    "enhancement_status": "partial",
    "format_requested": "DIRECT_CALCULATION",
    "format_used": "DIRECT_CALCULATION",
    "features_active": [
      "enhanced_distractors",
      "rich_scenarios",
      "cognitive_load",
      "advanced_formats"
    ],
    "features_pending": []
  },
  "context": {
    "id": "shop-001-bookfair",
    "theme": "SHOPPING",
    "setting": {
      "location": "school book fair",
      "timeContext": "lunch break",
      "atmosphere": "busy"
    },
    "characters": [
      {
        "name": "Sarah",
        "role": "student"
      },
      {
        "name": "Mr. Johnson",
        "role": "teacher"
      }
    ],
    "items": [
      {
        "name": "book",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 3,
          "max": 12,
          "typical": 6.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "bookmark",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.5,
          "max": 2,
          "typical": 1,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      }
    ],
    "culturalElements": [
      {
        "type": "currency",
        "value": "£",
        "explanation": "British pounds"
      },
      {
        "type": "event",
        "value": "book fair",
        "explanation": "School fundraising event"
      }
    ],
    "realWorldConnection": "School fundraising and reading promotion",
    "yearAppropriate": [
      2,
      3,
      4,
      5
    ],
    "templates": [
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "COMPARISON"
        ],
        "template": "{character} wants to buy books at the book fair. Calculate the total cost.",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      }
    ]
  }
}
# Test B.4: DIVISION model
{
  "success": true,
  "question": {
    "text": "Sarah wants to buy books at the book fair. Calculate the total cost.",
    "options": [
      {
        "text": "6.58",
        "value": 6.58,
        "index": 0
      },
      {
        "text": "£5.58",
        "value": 5.58,
        "index": 1
      },
      {
        "text": "88",
        "value": 88,
        "index": 2
      },
      {
        "text": "4.58",
        "value": 4.58,
        "index": 3
      }
    ],
    "correctIndex": 1,
    "format": "DIRECT_CALCULATION",
    "difficulty": {
      "year": 4,
      "subLevel": 1,
      "displayName": "4.1",
      "cognitiveLoad": 40
    },
    "cognitiveLoad": 40,
    "curriculumTags": [
      "4N1a"
    ],
    "scenario": {
      "id": "shop-001-bookfair",
      "theme": "SHOPPING",
      "setting": {
        "location": "school book fair",
        "timeContext": "lunch break",
        "atmosphere": "busy"
      },
      "characters": [
        {
          "name": "Sarah",
          "role": "student"
        },
        {
          "name": "Mr. Johnson",
          "role": "teacher"
        }
      ],
      "items": [
        {
          "name": "book",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 3,
            "max": 12,
            "typical": 6.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "bookmark",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.5,
            "max": 2,
            "typical": 1,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        }
      ],
      "culturalElements": [
        {
          "type": "currency",
          "value": "£",
          "explanation": "British pounds"
        },
        {
          "type": "event",
          "value": "book fair",
          "explanation": "School fundraising event"
        }
      ],
      "realWorldConnection": "School fundraising and reading promotion",
      "yearAppropriate": [
        2,
        3,
        4,
        5
      ],
      "templates": [
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "COMPARISON"
          ],
          "template": "{character} wants to buy books at the book fair. Calculate the total cost.",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        }
      ]
    },
    "distractors": [
      {
        "value": 88,
        "displayText": "88",
        "strategy": "WRONG_OPERATION",
        "reasoning": "Subtracted instead of dividing"
      },
      {
        "value": 6.58,
        "displayText": "6.58",
        "strategy": "CLOSE_VALUE",
        "reasoning": "Off by 1"
      },
      {
        "value": 4.58,
        "displayText": "4.58",
        "strategy": "CLOSE_VALUE",
        "reasoning": "Off by 1"
      }
    ],
    "enhancementStatus": {
      "level": "partial",
      "requestedFormat": "DIRECT_CALCULATION",
      "actualFormat": "DIRECT_CALCULATION",
      "featuresActive": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "featuresPending": [],
      "isFullyEnhanced": true
    },
    "mathOutput": {
      "operation": "DIVISION",
      "divisor": 2,
      "dividend": 11.16,
      "quotient": 5.58,
      "remainder": 0
    },
    "generationTime": 1,
    "questionId": "q_1759079324843_9sleadh6g",
    "generationSetup": {
      "controller_used": "DIRECT_CALCULATIONController",
      "format_requested": "DIRECT_CALCULATION",
      "format_actual": "DIRECT_CALCULATION",
      "scenario_theme": "SHOPPING",
      "scenario_id": "shop-001-bookfair",
      "scenario_selection_method": "default",
      "distractor_strategies": [
        "WRONG_OPERATION",
        "CLOSE_VALUE",
        "CLOSE_VALUE"
      ],
      "distractor_count": 3,
      "theme_variety": false,
      "format_variety": false,
      "enhancement_level": "partial",
      "features_active": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "features_pending": [],
      "generation_time_ms": 1
    }
  },
  "metadata": {
    "format": "DIRECT_CALCULATION",
    "cognitive_load": 40,
    "curriculum_alignment": [
      "4N1a"
    ],
    "difficulty": "4.1",
    "scenario_theme": "SHOPPING",
    "distractor_strategies": [
      "WRONG_OPERATION",
      "CLOSE_VALUE",
      "CLOSE_VALUE"
    ],
    "generation_time_ms": 1,
    "api_version": "2.0",
    "enhancement_status": "partial",
    "format_requested": "DIRECT_CALCULATION",
    "format_used": "DIRECT_CALCULATION",
    "features_active": [
      "enhanced_distractors",
      "rich_scenarios",
      "cognitive_load",
      "advanced_formats"
    ],
    "features_pending": []
  },
  "context": {
    "id": "shop-001-bookfair",
    "theme": "SHOPPING",
    "setting": {
      "location": "school book fair",
      "timeContext": "lunch break",
      "atmosphere": "busy"
    },
    "characters": [
      {
        "name": "Sarah",
        "role": "student"
      },
      {
        "name": "Mr. Johnson",
        "role": "teacher"
      }
    ],
    "items": [
      {
        "name": "book",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 3,
          "max": 12,
          "typical": 6.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "bookmark",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.5,
          "max": 2,
          "typical": 1,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      }
    ],
    "culturalElements": [
      {
        "type": "currency",
        "value": "£",
        "explanation": "British pounds"
      },
      {
        "type": "event",
        "value": "book fair",
        "explanation": "School fundraising event"
      }
    ],
    "realWorldConnection": "School fundraising and reading promotion",
    "yearAppropriate": [
      2,
      3,
      4,
      5
    ],
    "templates": [
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "COMPARISON"
        ],
        "template": "{character} wants to buy books at the book fair. Calculate the total cost.",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      }
    ]
  }
}
# Test B.5: PERCENTAGE model
{
  "success": true,
  "question": {
    "text": "Sarah wants to buy books at the book fair. Calculate the total cost.",
    "options": [
      {
        "text": "7.5",
        "value": 7.5,
        "index": 0
      },
      {
        "text": "5.5",
        "value": 5.5,
        "index": 1
      },
      {
        "text": "£6.50",
        "value": 6.5,
        "index": 2
      },
      {
        "value": 6.146256646953652,
        "text": "£6.15",
        "isCorrect": false
      }
    ],
    "correctIndex": 2,
    "format": "DIRECT_CALCULATION",
    "difficulty": {
      "year": 4,
      "subLevel": 1,
      "displayName": "4.1",
      "cognitiveLoad": 40
    },
    "cognitiveLoad": 40,
    "curriculumTags": [
      "4N1a"
    ],
    "scenario": {
      "id": "shop-001-bookfair",
      "theme": "SHOPPING",
      "setting": {
        "location": "school book fair",
        "timeContext": "lunch break",
        "atmosphere": "busy"
      },
      "characters": [
        {
          "name": "Sarah",
          "role": "student"
        },
        {
          "name": "Mr. Johnson",
          "role": "teacher"
        }
      ],
      "items": [
        {
          "name": "book",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 3,
            "max": 12,
            "typical": 6.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "bookmark",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.5,
            "max": 2,
            "typical": 1,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        }
      ],
      "culturalElements": [
        {
          "type": "currency",
          "value": "£",
          "explanation": "British pounds"
        },
        {
          "type": "event",
          "value": "book fair",
          "explanation": "School fundraising event"
        }
      ],
      "realWorldConnection": "School fundraising and reading promotion",
      "yearAppropriate": [
        2,
        3,
        4,
        5
      ],
      "templates": [
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "COMPARISON"
          ],
          "template": "{character} wants to buy books at the book fair. Calculate the total cost.",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        }
      ]
    },
    "distractors": [
      {
        "value": null,
        "displayText": "NaN",
        "strategy": "UNIT_CONFUSION",
        "reasoning": "Multiplied by percentage without converting to decimal"
      },
      {
        "value": 7.5,
        "displayText": "7.5",
        "strategy": "CLOSE_VALUE",
        "reasoning": "Off by 1"
      },
      {
        "value": 5.5,
        "displayText": "5.5",
        "strategy": "CLOSE_VALUE",
        "reasoning": "Off by 1"
      }
    ],
    "enhancementStatus": {
      "level": "partial",
      "requestedFormat": "DIRECT_CALCULATION",
      "actualFormat": "DIRECT_CALCULATION",
      "featuresActive": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "featuresPending": [],
      "isFullyEnhanced": true
    },
    "mathOutput": {
      "operation": "PERCENTAGE",
      "base_value": 13,
      "percentage": 50,
      "result": 6.5
    },
    "generationTime": 1,
    "questionId": "q_1759079324886_2whys159s",
    "generationSetup": {
      "controller_used": "DIRECT_CALCULATIONController",
      "format_requested": "DIRECT_CALCULATION",
      "format_actual": "DIRECT_CALCULATION",
      "scenario_theme": "SHOPPING",
      "scenario_id": "shop-001-bookfair",
      "scenario_selection_method": "default",
      "distractor_strategies": [
        "UNIT_CONFUSION",
        "CLOSE_VALUE",
        "CLOSE_VALUE"
      ],
      "distractor_count": 3,
      "theme_variety": false,
      "format_variety": false,
      "enhancement_level": "partial",
      "features_active": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "features_pending": [],
      "generation_time_ms": 1
    }
  },
  "metadata": {
    "format": "DIRECT_CALCULATION",
    "cognitive_load": 40,
    "curriculum_alignment": [
      "4N1a"
    ],
    "difficulty": "4.1",
    "scenario_theme": "SHOPPING",
    "distractor_strategies": [
      "UNIT_CONFUSION",
      "CLOSE_VALUE",
      "CLOSE_VALUE"
    ],
    "generation_time_ms": 1,
    "api_version": "2.0",
    "enhancement_status": "partial",
    "format_requested": "DIRECT_CALCULATION",
    "format_used": "DIRECT_CALCULATION",
    "features_active": [
      "enhanced_distractors",
      "rich_scenarios",
      "cognitive_load",
      "advanced_formats"
    ],
    "features_pending": []
  },
  "context": {
    "id": "shop-001-bookfair",
    "theme": "SHOPPING",
    "setting": {
      "location": "school book fair",
      "timeContext": "lunch break",
      "atmosphere": "busy"
    },
    "characters": [
      {
        "name": "Sarah",
        "role": "student"
      },
      {
        "name": "Mr. Johnson",
        "role": "teacher"
      }
    ],
    "items": [
      {
        "name": "book",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 3,
          "max": 12,
          "typical": 6.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "bookmark",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.5,
          "max": 2,
          "typical": 1,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      }
    ],
    "culturalElements": [
      {
        "type": "currency",
        "value": "£",
        "explanation": "British pounds"
      },
      {
        "type": "event",
        "value": "book fair",
        "explanation": "School fundraising event"
      }
    ],
    "realWorldConnection": "School fundraising and reading promotion",
    "yearAppropriate": [
      2,
      3,
      4,
      5
    ],
    "templates": [
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "COMPARISON"
        ],
        "template": "{character} wants to buy books at the book fair. Calculate the total cost.",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      }
    ]
  }
}
# Test B.6: FRACTION model
{
  "success": true,
  "question": {
    "text": "Harper buys a item for £27.75. How much does it cost?",
    "options": [
      {
        "text": "29.75",
        "value": 29.75,
        "index": 0
      },
      {
        "text": "£27.75",
        "value": 27.75,
        "index": 1
      }
    ],
    "correctIndex": 1,
    "format": "DIRECT_CALCULATION",
    "difficulty": {
      "year": 4,
      "subLevel": 1,
      "displayName": "4.1",
      "cognitiveLoad": 40
    },
    "cognitiveLoad": 40,
    "curriculumTags": [
      "4N1a"
    ],
    "scenario": {
      "id": "default-4-1759079325004",
      "theme": "SHOPPING",
      "setting": {
        "location": "shop",
        "timeContext": "afternoon",
        "atmosphere": "friendly"
      },
      "characters": [
        {
          "name": "Harper",
          "role": "student"
        }
      ],
      "items": [
        {
          "name": "item",
          "category": "HOUSEHOLD_ITEMS",
          "typicalValue": {
            "min": 1,
            "max": 10,
            "typical": 5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        }
      ],
      "culturalElements": [
        {
          "type": "currency",
          "value": "£",
          "explanation": "British pounds"
        }
      ],
      "realWorldConnection": "Basic shopping calculations",
      "yearAppropriate": [
        4
      ],
      "templates": [
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION"
          ],
          "template": "{character} buys a {item} for {price}. How much does it cost?",
          "answerTemplate": "It costs {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "price",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        }
      ]
    },
    "distractors": [
      {
        "value": 29.75,
        "displayText": "29.75",
        "strategy": "CLOSE_VALUE",
        "reasoning": "Off by 2"
      }
    ],
    "enhancementStatus": {
      "level": "partial",
      "requestedFormat": "DIRECT_CALCULATION",
      "actualFormat": "DIRECT_CALCULATION",
      "featuresActive": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "featuresPending": [],
      "isFullyEnhanced": true
    },
    "mathOutput": {
      "operation": "FRACTION",
      "whole_value": 37,
      "numerator": 3,
      "denominator": 4,
      "result": 27.75
    },
    "generationTime": 1,
    "questionId": "q_1759079325004_vsxx9v0cr",
    "generationSetup": {
      "controller_used": "DIRECT_CALCULATIONController",
      "format_requested": "DIRECT_CALCULATION",
      "format_actual": "DIRECT_CALCULATION",
      "scenario_theme": "SHOPPING",
      "scenario_id": "default-4-1759079325004",
      "scenario_selection_method": "default",
      "distractor_strategies": [
        "CLOSE_VALUE"
      ],
      "distractor_count": 1,
      "theme_variety": false,
      "format_variety": false,
      "enhancement_level": "partial",
      "features_active": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "features_pending": [],
      "generation_time_ms": 1
    }
  },
  "metadata": {
    "format": "DIRECT_CALCULATION",
    "cognitive_load": 40,
    "curriculum_alignment": [
      "4N1a"
    ],
    "difficulty": "4.1",
    "scenario_theme": "SHOPPING",
    "distractor_strategies": [
      "CLOSE_VALUE"
    ],
    "generation_time_ms": 1,
    "api_version": "2.0",
    "enhancement_status": "partial",
    "format_requested": "DIRECT_CALCULATION",
    "format_used": "DIRECT_CALCULATION",
    "features_active": [
      "enhanced_distractors",
      "rich_scenarios",
      "cognitive_load",
      "advanced_formats"
    ],
    "features_pending": []
  },
  "context": {
    "id": "default-4-1759079325004",
    "theme": "SHOPPING",
    "setting": {
      "location": "shop",
      "timeContext": "afternoon",
      "atmosphere": "friendly"
    },
    "characters": [
      {
        "name": "Harper",
        "role": "student"
      }
    ],
    "items": [
      {
        "name": "item",
        "category": "HOUSEHOLD_ITEMS",
        "typicalValue": {
          "min": 1,
          "max": 10,
          "typical": 5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      }
    ],
    "culturalElements": [
      {
        "type": "currency",
        "value": "£",
        "explanation": "British pounds"
      }
    ],
    "realWorldConnection": "Basic shopping calculations",
    "yearAppropriate": [
      4
    ],
    "templates": [
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION"
        ],
        "template": "{character} buys a {item} for {price}. How much does it cost?",
        "answerTemplate": "It costs {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "price",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      }
    ]
  }
}
# Test B.7: COUNTING model
{
  "success": true,
  "question": {
    "text": "Madison buys a item for £5. How much does it cost?",
    "options": [
      {
        "value": 0,
        "text": "0p",
        "isCorrect": true
      }
    ],
    "correctIndex": 0,
    "format": "DIRECT_CALCULATION",
    "difficulty": {
      "year": 4,
      "subLevel": 1,
      "displayName": "4.1",
      "cognitiveLoad": 40
    },
    "cognitiveLoad": 40,
    "curriculumTags": [
      "4N1a"
    ],
    "scenario": {
      "id": "default-4-1759079325102",
      "theme": "SHOPPING",
      "setting": {
        "location": "shop",
        "timeContext": "afternoon",
        "atmosphere": "friendly"
      },
      "characters": [
        {
          "name": "Madison",
          "role": "student"
        }
      ],
      "items": [
        {
          "name": "item",
          "category": "HOUSEHOLD_ITEMS",
          "typicalValue": {
            "min": 1,
            "max": 10,
            "typical": 5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        }
      ],
      "culturalElements": [
        {
          "type": "currency",
          "value": "£",
          "explanation": "British pounds"
        }
      ],
      "realWorldConnection": "Basic shopping calculations",
      "yearAppropriate": [
        4
      ],
      "templates": [
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION"
          ],
          "template": "{character} buys a {item} for {price}. How much does it cost?",
          "answerTemplate": "It costs {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "price",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        }
      ]
    },
    "distractors": [],
    "enhancementStatus": {
      "level": "partial",
      "requestedFormat": "DIRECT_CALCULATION",
      "actualFormat": "DIRECT_CALCULATION",
      "featuresActive": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "featuresPending": [],
      "isFullyEnhanced": true
    },
    "mathOutput": {
      "operation": "COUNTING"
    },
    "generationTime": 1,
    "questionId": "q_1759079325102_i9mzxyxu3",
    "generationSetup": {
      "controller_used": "DIRECT_CALCULATIONController",
      "format_requested": "DIRECT_CALCULATION",
      "format_actual": "DIRECT_CALCULATION",
      "scenario_theme": "SHOPPING",
      "scenario_id": "default-4-1759079325102",
      "scenario_selection_method": "default",
      "distractor_strategies": [],
      "distractor_count": 0,
      "theme_variety": false,
      "format_variety": false,
      "enhancement_level": "partial",
      "features_active": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "features_pending": [],
      "generation_time_ms": 1
    }
  },
  "metadata": {
    "format": "DIRECT_CALCULATION",
    "cognitive_load": 40,
    "curriculum_alignment": [
      "4N1a"
    ],
    "difficulty": "4.1",
    "scenario_theme": "SHOPPING",
    "distractor_strategies": [],
    "generation_time_ms": 1,
    "api_version": "2.0",
    "enhancement_status": "partial",
    "format_requested": "DIRECT_CALCULATION",
    "format_used": "DIRECT_CALCULATION",
    "features_active": [
      "enhanced_distractors",
      "rich_scenarios",
      "cognitive_load",
      "advanced_formats"
    ],
    "features_pending": []
  },
  "context": {
    "id": "default-4-1759079325102",
    "theme": "SHOPPING",
    "setting": {
      "location": "shop",
      "timeContext": "afternoon",
      "atmosphere": "friendly"
    },
    "characters": [
      {
        "name": "Madison",
        "role": "student"
      }
    ],
    "items": [
      {
        "name": "item",
        "category": "HOUSEHOLD_ITEMS",
        "typicalValue": {
          "min": 1,
          "max": 10,
          "typical": 5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      }
    ],
    "culturalElements": [
      {
        "type": "currency",
        "value": "£",
        "explanation": "British pounds"
      }
    ],
    "realWorldConnection": "Basic shopping calculations",
    "yearAppropriate": [
      4
    ],
    "templates": [
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION"
        ],
        "template": "{character} buys a {item} for {price}. How much does it cost?",
        "answerTemplate": "It costs {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "price",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      }
    ]
  }
}
# Test B.8: TIME_RATE model
{
  "success": true,
  "question": {
    "text": "Ethan buys a item for £5. How much does it cost?",
    "options": [
      {
        "value": 0,
        "text": "0p",
        "isCorrect": true
      }
    ],
    "correctIndex": 0,
    "format": "DIRECT_CALCULATION",
    "difficulty": {
      "year": 4,
      "subLevel": 1,
      "displayName": "4.1",
      "cognitiveLoad": 40
    },
    "cognitiveLoad": 40,
    "curriculumTags": [
      "4N1a"
    ],
    "scenario": {
      "id": "default-4-1759079325223",
      "theme": "SHOPPING",
      "setting": {
        "location": "shop",
        "timeContext": "afternoon",
        "atmosphere": "friendly"
      },
      "characters": [
        {
          "name": "Ethan",
          "role": "student"
        }
      ],
      "items": [
        {
          "name": "item",
          "category": "HOUSEHOLD_ITEMS",
          "typicalValue": {
            "min": 1,
            "max": 10,
            "typical": 5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        }
      ],
      "culturalElements": [
        {
          "type": "currency",
          "value": "£",
          "explanation": "British pounds"
        }
      ],
      "realWorldConnection": "Basic shopping calculations",
      "yearAppropriate": [
        4
      ],
      "templates": [
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION"
          ],
          "template": "{character} buys a {item} for {price}. How much does it cost?",
          "answerTemplate": "It costs {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "price",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        }
      ]
    },
    "distractors": [],
    "enhancementStatus": {
      "level": "partial",
      "requestedFormat": "DIRECT_CALCULATION",
      "actualFormat": "DIRECT_CALCULATION",
      "featuresActive": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "featuresPending": [],
      "isFullyEnhanced": true
    },
    "mathOutput": {
      "operation": "TIME_RATE",
      "rate": {
        "value": 6,
        "period": "week"
      }
    },
    "generationTime": 1,
    "questionId": "q_1759079325224_youcd5ogi",
    "generationSetup": {
      "controller_used": "DIRECT_CALCULATIONController",
      "format_requested": "DIRECT_CALCULATION",
      "format_actual": "DIRECT_CALCULATION",
      "scenario_theme": "SHOPPING",
      "scenario_id": "default-4-1759079325223",
      "scenario_selection_method": "default",
      "distractor_strategies": [],
      "distractor_count": 0,
      "theme_variety": false,
      "format_variety": false,
      "enhancement_level": "partial",
      "features_active": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "features_pending": [],
      "generation_time_ms": 1
    }
  },
  "metadata": {
    "format": "DIRECT_CALCULATION",
    "cognitive_load": 40,
    "curriculum_alignment": [
      "4N1a"
    ],
    "difficulty": "4.1",
    "scenario_theme": "SHOPPING",
    "distractor_strategies": [],
    "generation_time_ms": 1,
    "api_version": "2.0",
    "enhancement_status": "partial",
    "format_requested": "DIRECT_CALCULATION",
    "format_used": "DIRECT_CALCULATION",
    "features_active": [
      "enhanced_distractors",
      "rich_scenarios",
      "cognitive_load",
      "advanced_formats"
    ],
    "features_pending": []
  },
  "context": {
    "id": "default-4-1759079325223",
    "theme": "SHOPPING",
    "setting": {
      "location": "shop",
      "timeContext": "afternoon",
      "atmosphere": "friendly"
    },
    "characters": [
      {
        "name": "Ethan",
        "role": "student"
      }
    ],
    "items": [
      {
        "name": "item",
        "category": "HOUSEHOLD_ITEMS",
        "typicalValue": {
          "min": 1,
          "max": 10,
          "typical": 5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      }
    ],
    "culturalElements": [
      {
        "type": "currency",
        "value": "£",
        "explanation": "British pounds"
      }
    ],
    "realWorldConnection": "Basic shopping calculations",
    "yearAppropriate": [
      4
    ],
    "templates": [
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION"
        ],
        "template": "{character} buys a {item} for {price}. How much does it cost?",
        "answerTemplate": "It costs {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "price",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      }
    ]
  }
}
# Test B.9: CONVERSION model
{
  "success": true,
  "question": {
    "text": "Abigail buys a item for £5. How much does it cost?",
    "options": [
      {
        "value": 0,
        "text": "0p",
        "isCorrect": true
      }
    ],
    "correctIndex": 0,
    "format": "DIRECT_CALCULATION",
    "difficulty": {
      "year": 4,
      "subLevel": 1,
      "displayName": "4.1",
      "cognitiveLoad": 40
    },
    "cognitiveLoad": 40,
    "curriculumTags": [
      "4N1a"
    ],
    "scenario": {
      "id": "default-4-1759079325332",
      "theme": "SHOPPING",
      "setting": {
        "location": "shop",
        "timeContext": "afternoon",
        "atmosphere": "friendly"
      },
      "characters": [
        {
          "name": "Abigail",
          "role": "student"
        }
      ],
      "items": [
        {
          "name": "item",
          "category": "HOUSEHOLD_ITEMS",
          "typicalValue": {
            "min": 1,
            "max": 10,
            "typical": 5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        }
      ],
      "culturalElements": [
        {
          "type": "currency",
          "value": "£",
          "explanation": "British pounds"
        }
      ],
      "realWorldConnection": "Basic shopping calculations",
      "yearAppropriate": [
        4
      ],
      "templates": [
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION"
          ],
          "template": "{character} buys a {item} for {price}. How much does it cost?",
          "answerTemplate": "It costs {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "price",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        }
      ]
    },
    "distractors": [],
    "enhancementStatus": {
      "level": "partial",
      "requestedFormat": "DIRECT_CALCULATION",
      "actualFormat": "DIRECT_CALCULATION",
      "featuresActive": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "featuresPending": [],
      "isFullyEnhanced": true
    },
    "mathOutput": {
      "operation": "CONVERSION",
      "original_value": 82,
      "converted_value": 0.82,
      "conversion_factor": 0.01
    },
    "generationTime": 0,
    "questionId": "q_1759079325332_u75gzzin3",
    "generationSetup": {
      "controller_used": "DIRECT_CALCULATIONController",
      "format_requested": "DIRECT_CALCULATION",
      "format_actual": "DIRECT_CALCULATION",
      "scenario_theme": "SHOPPING",
      "scenario_id": "default-4-1759079325332",
      "scenario_selection_method": "default",
      "distractor_strategies": [],
      "distractor_count": 0,
      "theme_variety": false,
      "format_variety": false,
      "enhancement_level": "partial",
      "features_active": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "features_pending": [],
      "generation_time_ms": 0
    }
  },
  "metadata": {
    "format": "DIRECT_CALCULATION",
    "cognitive_load": 40,
    "curriculum_alignment": [
      "4N1a"
    ],
    "difficulty": "4.1",
    "scenario_theme": "SHOPPING",
    "distractor_strategies": [],
    "generation_time_ms": 1,
    "api_version": "2.0",
    "enhancement_status": "partial",
    "format_requested": "DIRECT_CALCULATION",
    "format_used": "DIRECT_CALCULATION",
    "features_active": [
      "enhanced_distractors",
      "rich_scenarios",
      "cognitive_load",
      "advanced_formats"
    ],
    "features_pending": []
  },
  "context": {
    "id": "default-4-1759079325332",
    "theme": "SHOPPING",
    "setting": {
      "location": "shop",
      "timeContext": "afternoon",
      "atmosphere": "friendly"
    },
    "characters": [
      {
        "name": "Abigail",
        "role": "student"
      }
    ],
    "items": [
      {
        "name": "item",
        "category": "HOUSEHOLD_ITEMS",
        "typicalValue": {
          "min": 1,
          "max": 10,
          "typical": 5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      }
    ],
    "culturalElements": [
      {
        "type": "currency",
        "value": "£",
        "explanation": "British pounds"
      }
    ],
    "realWorldConnection": "Basic shopping calculations",
    "yearAppropriate": [
      4
    ],
    "templates": [
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION"
        ],
        "template": "{character} buys a {item} for {price}. How much does it cost?",
        "answerTemplate": "It costs {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "price",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      }
    ]
  }
}
# Test B.10: COMPARISON model
{
  "success": true,
  "question": {
    "text": "Charlotte is comparing options to find the best value.\n\nOption A: £6.00\nOption B: £59.00\n\nWhich option offers better value?",
    "options": [
      {
        "text": "Both options are equally good value",
        "value": -1,
        "index": 0
      },
      {
        "text": "B is better value",
        "value": 1,
        "index": 1
      },
      {
        "text": "A is better value",
        "value": 0,
        "index": 2
      },
      {
        "text": "B saves you £106.00",
        "value": 1,
        "index": 3
      }
    ],
    "correctIndex": 1,
    "questionContent": {
      "fullText": "Charlotte is comparing options to find the best value.\n\nOption A: £6.00\nOption B: £59.00\n\nWhich option offers better value?",
      "templateData": {
        "character": "Charlotte",
        "optionA": "£6.00",
        "optionB": "£59.00",
        "context": "general",
        "comparisonType": "direct"
      }
    },
    "format": "COMPARISON",
    "difficulty": {
      "year": 4,
      "subLevel": 1,
      "displayName": "4.1",
      "cognitiveLoad": 40
    },
    "cognitiveLoad": 40,
    "curriculumTags": [
      "4N1a"
    ],
    "scenario": {
      "id": "shop-002-realistic-general",
      "theme": "SHOPPING",
      "setting": {
        "location": "local shop",
        "timeContext": "after school",
        "atmosphere": "friendly"
      },
      "characters": [
        {
          "name": "Charlotte",
          "role": "student"
        }
      ],
      "items": [
        {
          "name": "apple",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.2,
            "max": 0.5,
            "typical": 0.35,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "banana",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.15,
            "max": 0.4,
            "typical": 0.25,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "sandwich",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 2.5,
            "max": 6,
            "typical": 4,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "drink",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.8,
            "max": 2.5,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "cake",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 1.5,
            "max": 4,
            "typical": 2.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "biscuit",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.8,
            "max": 2,
            "typical": 1.2,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "sweet",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.1,
            "max": 1,
            "typical": 0.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "chocolate",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.6,
            "max": 3,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "pen",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.5,
            "max": 2,
            "typical": 1,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "pencil",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.2,
            "max": 1,
            "typical": 0.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "ruler",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.8,
            "max": 2.5,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "notebook",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 1,
            "max": 4,
            "typical": 2,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "eraser",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.3,
            "max": 1.5,
            "typical": 0.75,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "book",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 3,
            "max": 15,
            "typical": 8,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "comic",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 2,
            "max": 5,
            "typical": 3,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "magazine",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 2.5,
            "max": 6,
            "typical": 4,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "toy",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 5,
            "max": 25,
            "typical": 12,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "game",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 8,
            "max": 60,
            "typical": 25,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "puzzle",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 5,
            "max": 20,
            "typical": 12,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "sticker",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 0.2,
            "max": 2,
            "typical": 0.8,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "badge",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 0.5,
            "max": 3,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "poster",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 2,
            "max": 8,
            "typical": 4,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "card",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 0.5,
            "max": 4,
            "typical": 2,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        }
      ],
      "culturalElements": [
        {
          "type": "currency",
          "value": "£",
          "explanation": "British pounds"
        },
        {
          "type": "location",
          "value": "UK local shop",
          "explanation": "Typical British corner shop"
        }
      ],
      "realWorldConnection": "Everyday shopping with realistic UK prices",
      "yearAppropriate": [
        1,
        2,
        3,
        4,
        5,
        6
      ],
      "templates": [
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "MULTI_STEP"
          ],
          "modelCompatibility": [
            "ADDITION"
          ],
          "operandCount": 3,
          "template": "{character} buys a {item1} for {price1}, a {item2} for {price2}, and a {item3} for {price3}. What is the total cost?",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item1",
              "type": "item"
            },
            {
              "key": "item2",
              "type": "item"
            },
            {
              "key": "item3",
              "type": "item"
            },
            {
              "key": "price1",
              "type": "value"
            },
            {
              "key": "price2",
              "type": "value"
            },
            {
              "key": "price3",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "MULTI_STEP"
          ],
          "modelCompatibility": [
            "ADDITION"
          ],
          "operandCount": 2,
          "template": "{character} buys a {item1} for {price1} and a {item2} for {price2}. What is the total cost?",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item1",
              "type": "item"
            },
            {
              "key": "item2",
              "type": "item"
            },
            {
              "key": "price1",
              "type": "value"
            },
            {
              "key": "price2",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION"
          ],
          "modelCompatibility": [
            "SUBTRACTION",
            "CHANGE_CALCULATION"
          ],
          "template": "{character} buys a {item} for {price} and pays with {payment}. How much change does {character} get?",
          "answerTemplate": "{character} receives {result} in change",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "price",
              "type": "value"
            },
            {
              "key": "payment",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION"
          ],
          "modelCompatibility": [
            "MULTIPLICATION"
          ],
          "template": "{character} buys {quantity} {item} at {price} each. What is the total cost?",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "quantity",
              "type": "value"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "price",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION"
          ],
          "modelCompatibility": [
            "DIVISION"
          ],
          "template": "{character} has {total} to spend equally on {quantity} {item}. How much can {character} spend on each one?",
          "answerTemplate": "{character} can spend {result} on each {item}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "total",
              "type": "value"
            },
            {
              "key": "quantity",
              "type": "value"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "COMPARISON",
            "ESTIMATION",
            "MULTI_STEP"
          ],
          "template": "{character} goes to the shop and buys {items}. How much does {character} spend in total?",
          "answerTemplate": "{character} spends {result} in total",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "items",
              "type": "item_list"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "ESTIMATION"
          ],
          "template": "Estimate: If {character} buys {items}, about how much will it cost?",
          "answerTemplate": "It will cost approximately {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "items",
              "type": "item_list"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "VALIDATION"
          ],
          "template": "{character} calculated that {items} costs {amount}. Is this correct?",
          "answerTemplate": "{validation_result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "items",
              "type": "item_list"
            },
            {
              "key": "amount",
              "type": "value"
            },
            {
              "key": "validation_result",
              "type": "boolean"
            }
          ]
        }
      ]
    },
    "distractors": [
      {
        "value": 0,
        "displayText": "A is better value",
        "strategy": "REVERSED_COMPARISON",
        "reasoning": "Selected the option with lower value"
      },
      {
        "value": -1,
        "displayText": "Both options are equally good value",
        "strategy": "WRONG_SELECTION",
        "reasoning": "Failed to calculate the difference correctly"
      },
      {
        "value": 1,
        "displayText": "B saves you £106.00",
        "strategy": "CALCULATION_ERROR",
        "reasoning": "Arithmetic error in calculating the difference"
      }
    ],
    "enhancementStatus": {
      "level": "full",
      "requestedFormat": "COMPARISON",
      "actualFormat": "COMPARISON",
      "featuresActive": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "featuresPending": [],
      "isFullyEnhanced": true
    },
    "mathOutput": {
      "operation": "COMPARISON",
      "option_1_value": 6,
      "option_2_value": 59
    },
    "generationTime": 1,
    "questionId": "q_1759079325449_o9pfbjhx5",
    "generationSetup": {
      "controller_used": "COMPARISONController",
      "format_requested": "COMPARISON",
      "format_actual": "COMPARISON",
      "scenario_theme": "SHOPPING",
      "scenario_id": "shop-002-realistic-general",
      "scenario_selection_method": "default",
      "distractor_strategies": [
        "REVERSED_COMPARISON",
        "WRONG_SELECTION",
        "CALCULATION_ERROR"
      ],
      "distractor_count": 3,
      "theme_variety": false,
      "format_variety": false,
      "enhancement_level": "full",
      "features_active": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "features_pending": [],
      "generation_time_ms": 1
    }
  },
  "metadata": {
    "format": "COMPARISON",
    "cognitive_load": 40,
    "curriculum_alignment": [
      "4N1a"
    ],
    "difficulty": "4.1",
    "scenario_theme": "SHOPPING",
    "distractor_strategies": [
      "REVERSED_COMPARISON",
      "WRONG_SELECTION",
      "CALCULATION_ERROR"
    ],
    "generation_time_ms": 1,
    "api_version": "2.0",
    "enhancement_status": "full",
    "format_requested": "COMPARISON",
    "format_used": "COMPARISON",
    "features_active": [
      "enhanced_distractors",
      "rich_scenarios",
      "cognitive_load",
      "advanced_formats"
    ],
    "features_pending": []
  },
  "context": {
    "id": "shop-002-realistic-general",
    "theme": "SHOPPING",
    "setting": {
      "location": "local shop",
      "timeContext": "after school",
      "atmosphere": "friendly"
    },
    "characters": [
      {
        "name": "Charlotte",
        "role": "student"
      }
    ],
    "items": [
      {
        "name": "apple",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.2,
          "max": 0.5,
          "typical": 0.35,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "banana",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.15,
          "max": 0.4,
          "typical": 0.25,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "sandwich",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 2.5,
          "max": 6,
          "typical": 4,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "drink",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.8,
          "max": 2.5,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "cake",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 1.5,
          "max": 4,
          "typical": 2.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "biscuit",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.8,
          "max": 2,
          "typical": 1.2,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "sweet",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.1,
          "max": 1,
          "typical": 0.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "chocolate",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.6,
          "max": 3,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "pen",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.5,
          "max": 2,
          "typical": 1,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "pencil",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.2,
          "max": 1,
          "typical": 0.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "ruler",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.8,
          "max": 2.5,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "notebook",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 1,
          "max": 4,
          "typical": 2,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "eraser",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.3,
          "max": 1.5,
          "typical": 0.75,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "book",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 3,
          "max": 15,
          "typical": 8,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "comic",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 2,
          "max": 5,
          "typical": 3,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "magazine",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 2.5,
          "max": 6,
          "typical": 4,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "toy",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 5,
          "max": 25,
          "typical": 12,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "game",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 8,
          "max": 60,
          "typical": 25,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "puzzle",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 5,
          "max": 20,
          "typical": 12,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "sticker",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 0.2,
          "max": 2,
          "typical": 0.8,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "badge",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 0.5,
          "max": 3,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "poster",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 2,
          "max": 8,
          "typical": 4,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "card",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 0.5,
          "max": 4,
          "typical": 2,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      }
    ],
    "culturalElements": [
      {
        "type": "currency",
        "value": "£",
        "explanation": "British pounds"
      },
      {
        "type": "location",
        "value": "UK local shop",
        "explanation": "Typical British corner shop"
      }
    ],
    "realWorldConnection": "Everyday shopping with realistic UK prices",
    "yearAppropriate": [
      1,
      2,
      3,
      4,
      5,
      6
    ],
    "templates": [
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "MULTI_STEP"
        ],
        "modelCompatibility": [
          "ADDITION"
        ],
        "operandCount": 3,
        "template": "{character} buys a {item1} for {price1}, a {item2} for {price2}, and a {item3} for {price3}. What is the total cost?",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item1",
            "type": "item"
          },
          {
            "key": "item2",
            "type": "item"
          },
          {
            "key": "item3",
            "type": "item"
          },
          {
            "key": "price1",
            "type": "value"
          },
          {
            "key": "price2",
            "type": "value"
          },
          {
            "key": "price3",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "MULTI_STEP"
        ],
        "modelCompatibility": [
          "ADDITION"
        ],
        "operandCount": 2,
        "template": "{character} buys a {item1} for {price1} and a {item2} for {price2}. What is the total cost?",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item1",
            "type": "item"
          },
          {
            "key": "item2",
            "type": "item"
          },
          {
            "key": "price1",
            "type": "value"
          },
          {
            "key": "price2",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION"
        ],
        "modelCompatibility": [
          "SUBTRACTION",
          "CHANGE_CALCULATION"
        ],
        "template": "{character} buys a {item} for {price} and pays with {payment}. How much change does {character} get?",
        "answerTemplate": "{character} receives {result} in change",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "price",
            "type": "value"
          },
          {
            "key": "payment",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION"
        ],
        "modelCompatibility": [
          "MULTIPLICATION"
        ],
        "template": "{character} buys {quantity} {item} at {price} each. What is the total cost?",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "quantity",
            "type": "value"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "price",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION"
        ],
        "modelCompatibility": [
          "DIVISION"
        ],
        "template": "{character} has {total} to spend equally on {quantity} {item}. How much can {character} spend on each one?",
        "answerTemplate": "{character} can spend {result} on each {item}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "total",
            "type": "value"
          },
          {
            "key": "quantity",
            "type": "value"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "COMPARISON",
          "ESTIMATION",
          "MULTI_STEP"
        ],
        "template": "{character} goes to the shop and buys {items}. How much does {character} spend in total?",
        "answerTemplate": "{character} spends {result} in total",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "items",
            "type": "item_list"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "ESTIMATION"
        ],
        "template": "Estimate: If {character} buys {items}, about how much will it cost?",
        "answerTemplate": "It will cost approximately {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "items",
            "type": "item_list"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "VALIDATION"
        ],
        "template": "{character} calculated that {items} costs {amount}. Is this correct?",
        "answerTemplate": "{validation_result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "items",
            "type": "item_list"
          },
          {
            "key": "amount",
            "type": "value"
          },
          {
            "key": "validation_result",
            "type": "boolean"
          }
        ]
      }
    ]
  }
}
# Test B.11: MULTI_STEP model
{
  "success": true,
  "question": {
    "text": "Sarah wants to buy books at the book fair. Calculate the total cost.",
    "options": [
      {
        "text": "£31.00",
        "value": 31,
        "index": 0
      },
      {
        "text": "33",
        "value": 33,
        "index": 1
      }
    ],
    "correctIndex": 0,
    "format": "DIRECT_CALCULATION",
    "difficulty": {
      "year": 4,
      "subLevel": 1,
      "displayName": "4.1",
      "cognitiveLoad": 40
    },
    "cognitiveLoad": 40,
    "curriculumTags": [
      "4N1a"
    ],
    "scenario": {
      "id": "shop-001-bookfair",
      "theme": "SHOPPING",
      "setting": {
        "location": "school book fair",
        "timeContext": "lunch break",
        "atmosphere": "busy"
      },
      "characters": [
        {
          "name": "Sarah",
          "role": "student"
        },
        {
          "name": "Mr. Johnson",
          "role": "teacher"
        }
      ],
      "items": [
        {
          "name": "book",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 3,
            "max": 12,
            "typical": 6.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "bookmark",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.5,
            "max": 2,
            "typical": 1,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        }
      ],
      "culturalElements": [
        {
          "type": "currency",
          "value": "£",
          "explanation": "British pounds"
        },
        {
          "type": "event",
          "value": "book fair",
          "explanation": "School fundraising event"
        }
      ],
      "realWorldConnection": "School fundraising and reading promotion",
      "yearAppropriate": [
        2,
        3,
        4,
        5
      ],
      "templates": [
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "COMPARISON"
          ],
          "template": "{character} wants to buy books at the book fair. Calculate the total cost.",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        }
      ]
    },
    "distractors": [
      {
        "value": 33,
        "displayText": "33",
        "strategy": "CLOSE_VALUE",
        "reasoning": "Off by 2"
      }
    ],
    "enhancementStatus": {
      "level": "partial",
      "requestedFormat": "DIRECT_CALCULATION",
      "actualFormat": "DIRECT_CALCULATION",
      "featuresActive": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "featuresPending": [],
      "isFullyEnhanced": true
    },
    "mathOutput": {
      "operation": "MULTI_STEP",
      "step_1_result": 12,
      "step_2_result": 46,
      "step_3_result": 31
    },
    "generationTime": 0,
    "questionId": "q_1759079325554_nttxke837",
    "generationSetup": {
      "controller_used": "DIRECT_CALCULATIONController",
      "format_requested": "DIRECT_CALCULATION",
      "format_actual": "DIRECT_CALCULATION",
      "scenario_theme": "SHOPPING",
      "scenario_id": "shop-001-bookfair",
      "scenario_selection_method": "default",
      "distractor_strategies": [
        "CLOSE_VALUE"
      ],
      "distractor_count": 1,
      "theme_variety": false,
      "format_variety": false,
      "enhancement_level": "partial",
      "features_active": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "features_pending": [],
      "generation_time_ms": 0
    }
  },
  "metadata": {
    "format": "DIRECT_CALCULATION",
    "cognitive_load": 40,
    "curriculum_alignment": [
      "4N1a"
    ],
    "difficulty": "4.1",
    "scenario_theme": "SHOPPING",
    "distractor_strategies": [
      "CLOSE_VALUE"
    ],
    "generation_time_ms": 0,
    "api_version": "2.0",
    "enhancement_status": "partial",
    "format_requested": "DIRECT_CALCULATION",
    "format_used": "DIRECT_CALCULATION",
    "features_active": [
      "enhanced_distractors",
      "rich_scenarios",
      "cognitive_load",
      "advanced_formats"
    ],
    "features_pending": []
  },
  "context": {
    "id": "shop-001-bookfair",
    "theme": "SHOPPING",
    "setting": {
      "location": "school book fair",
      "timeContext": "lunch break",
      "atmosphere": "busy"
    },
    "characters": [
      {
        "name": "Sarah",
        "role": "student"
      },
      {
        "name": "Mr. Johnson",
        "role": "teacher"
      }
    ],
    "items": [
      {
        "name": "book",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 3,
          "max": 12,
          "typical": 6.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "bookmark",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.5,
          "max": 2,
          "typical": 1,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      }
    ],
    "culturalElements": [
      {
        "type": "currency",
        "value": "£",
        "explanation": "British pounds"
      },
      {
        "type": "event",
        "value": "book fair",
        "explanation": "School fundraising event"
      }
    ],
    "realWorldConnection": "School fundraising and reading promotion",
    "yearAppropriate": [
      2,
      3,
      4,
      5
    ],
    "templates": [
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "COMPARISON"
        ],
        "template": "{character} wants to buy books at the book fair. Calculate the total cost.",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      }
    ]
  }
}
# Test B.12: LINEAR_EQUATION model
{
  "success": true,
  "question": {
    "text": "Sarah wants to buy books at the book fair. Calculate the total cost.",
    "options": [
      {
        "value": 0,
        "text": "0p",
        "isCorrect": true
      }
    ],
    "correctIndex": 0,
    "format": "DIRECT_CALCULATION",
    "difficulty": {
      "year": 4,
      "subLevel": 1,
      "displayName": "4.1",
      "cognitiveLoad": 40
    },
    "cognitiveLoad": 40,
    "curriculumTags": [
      "4N1a"
    ],
    "scenario": {
      "id": "shop-001-bookfair",
      "theme": "SHOPPING",
      "setting": {
        "location": "school book fair",
        "timeContext": "lunch break",
        "atmosphere": "busy"
      },
      "characters": [
        {
          "name": "Sarah",
          "role": "student"
        },
        {
          "name": "Mr. Johnson",
          "role": "teacher"
        }
      ],
      "items": [
        {
          "name": "book",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 3,
            "max": 12,
            "typical": 6.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "bookmark",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.5,
            "max": 2,
            "typical": 1,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        }
      ],
      "culturalElements": [
        {
          "type": "currency",
          "value": "£",
          "explanation": "British pounds"
        },
        {
          "type": "event",
          "value": "book fair",
          "explanation": "School fundraising event"
        }
      ],
      "realWorldConnection": "School fundraising and reading promotion",
      "yearAppropriate": [
        2,
        3,
        4,
        5
      ],
      "templates": [
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "COMPARISON"
          ],
          "template": "{character} wants to buy books at the book fair. Calculate the total cost.",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        }
      ]
    },
    "distractors": [],
    "enhancementStatus": {
      "level": "partial",
      "requestedFormat": "DIRECT_CALCULATION",
      "actualFormat": "DIRECT_CALCULATION",
      "featuresActive": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "featuresPending": [],
      "isFullyEnhanced": true
    },
    "mathOutput": {
      "operation": "LINEAR_EQUATION",
      "slope": 3,
      "intercept": 4
    },
    "generationTime": 0,
    "questionId": "q_1759079325654_p160s5m30",
    "generationSetup": {
      "controller_used": "DIRECT_CALCULATIONController",
      "format_requested": "DIRECT_CALCULATION",
      "format_actual": "DIRECT_CALCULATION",
      "scenario_theme": "SHOPPING",
      "scenario_id": "shop-001-bookfair",
      "scenario_selection_method": "default",
      "distractor_strategies": [],
      "distractor_count": 0,
      "theme_variety": false,
      "format_variety": false,
      "enhancement_level": "partial",
      "features_active": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "features_pending": [],
      "generation_time_ms": 0
    }
  },
  "metadata": {
    "format": "DIRECT_CALCULATION",
    "cognitive_load": 40,
    "curriculum_alignment": [
      "4N1a"
    ],
    "difficulty": "4.1",
    "scenario_theme": "SHOPPING",
    "distractor_strategies": [],
    "generation_time_ms": 0,
    "api_version": "2.0",
    "enhancement_status": "partial",
    "format_requested": "DIRECT_CALCULATION",
    "format_used": "DIRECT_CALCULATION",
    "features_active": [
      "enhanced_distractors",
      "rich_scenarios",
      "cognitive_load",
      "advanced_formats"
    ],
    "features_pending": []
  },
  "context": {
    "id": "shop-001-bookfair",
    "theme": "SHOPPING",
    "setting": {
      "location": "school book fair",
      "timeContext": "lunch break",
      "atmosphere": "busy"
    },
    "characters": [
      {
        "name": "Sarah",
        "role": "student"
      },
      {
        "name": "Mr. Johnson",
        "role": "teacher"
      }
    ],
    "items": [
      {
        "name": "book",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 3,
          "max": 12,
          "typical": 6.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "bookmark",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.5,
          "max": 2,
          "typical": 1,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      }
    ],
    "culturalElements": [
      {
        "type": "currency",
        "value": "£",
        "explanation": "British pounds"
      },
      {
        "type": "event",
        "value": "book fair",
        "explanation": "School fundraising event"
      }
    ],
    "realWorldConnection": "School fundraising and reading promotion",
    "yearAppropriate": [
      2,
      3,
      4,
      5
    ],
    "templates": [
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "COMPARISON"
        ],
        "template": "{character} wants to buy books at the book fair. Calculate the total cost.",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      }
    ]
  }
}
# Test B.13: UNIT_RATE model
{
  "success": true,
  "question": {
    "text": "Sarah wants to buy books at the book fair. Calculate the total cost.",
    "options": [
      {
        "value": 0,
        "text": "0p",
        "isCorrect": true
      }
    ],
    "correctIndex": 0,
    "format": "DIRECT_CALCULATION",
    "difficulty": {
      "year": 4,
      "subLevel": 1,
      "displayName": "4.1",
      "cognitiveLoad": 40
    },
    "cognitiveLoad": 40,
    "curriculumTags": [
      "4N1a"
    ],
    "scenario": {
      "id": "shop-001-bookfair",
      "theme": "SHOPPING",
      "setting": {
        "location": "school book fair",
        "timeContext": "lunch break",
        "atmosphere": "busy"
      },
      "characters": [
        {
          "name": "Sarah",
          "role": "student"
        },
        {
          "name": "Mr. Johnson",
          "role": "teacher"
        }
      ],
      "items": [
        {
          "name": "book",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 3,
            "max": 12,
            "typical": 6.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "bookmark",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.5,
            "max": 2,
            "typical": 1,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        }
      ],
      "culturalElements": [
        {
          "type": "currency",
          "value": "£",
          "explanation": "British pounds"
        },
        {
          "type": "event",
          "value": "book fair",
          "explanation": "School fundraising event"
        }
      ],
      "realWorldConnection": "School fundraising and reading promotion",
      "yearAppropriate": [
        2,
        3,
        4,
        5
      ],
      "templates": [
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "COMPARISON"
          ],
          "template": "{character} wants to buy books at the book fair. Calculate the total cost.",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        }
      ]
    },
    "distractors": [],
    "enhancementStatus": {
      "level": "partial",
      "requestedFormat": "DIRECT_CALCULATION",
      "actualFormat": "DIRECT_CALCULATION",
      "featuresActive": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "featuresPending": [],
      "isFullyEnhanced": true
    },
    "mathOutput": {
      "operation": "UNIT_RATE"
    },
    "generationTime": 1,
    "questionId": "q_1759079325771_qzw373qnp",
    "generationSetup": {
      "controller_used": "DIRECT_CALCULATIONController",
      "format_requested": "DIRECT_CALCULATION",
      "format_actual": "DIRECT_CALCULATION",
      "scenario_theme": "SHOPPING",
      "scenario_id": "shop-001-bookfair",
      "scenario_selection_method": "default",
      "distractor_strategies": [],
      "distractor_count": 0,
      "theme_variety": false,
      "format_variety": false,
      "enhancement_level": "partial",
      "features_active": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "features_pending": [],
      "generation_time_ms": 1
    }
  },
  "metadata": {
    "format": "DIRECT_CALCULATION",
    "cognitive_load": 40,
    "curriculum_alignment": [
      "4N1a"
    ],
    "difficulty": "4.1",
    "scenario_theme": "SHOPPING",
    "distractor_strategies": [],
    "generation_time_ms": 1,
    "api_version": "2.0",
    "enhancement_status": "partial",
    "format_requested": "DIRECT_CALCULATION",
    "format_used": "DIRECT_CALCULATION",
    "features_active": [
      "enhanced_distractors",
      "rich_scenarios",
      "cognitive_load",
      "advanced_formats"
    ],
    "features_pending": []
  },
  "context": {
    "id": "shop-001-bookfair",
    "theme": "SHOPPING",
    "setting": {
      "location": "school book fair",
      "timeContext": "lunch break",
      "atmosphere": "busy"
    },
    "characters": [
      {
        "name": "Sarah",
        "role": "student"
      },
      {
        "name": "Mr. Johnson",
        "role": "teacher"
      }
    ],
    "items": [
      {
        "name": "book",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 3,
          "max": 12,
          "typical": 6.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "bookmark",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.5,
          "max": 2,
          "typical": 1,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      }
    ],
    "culturalElements": [
      {
        "type": "currency",
        "value": "£",
        "explanation": "British pounds"
      },
      {
        "type": "event",
        "value": "book fair",
        "explanation": "School fundraising event"
      }
    ],
    "realWorldConnection": "School fundraising and reading promotion",
    "yearAppropriate": [
      2,
      3,
      4,
      5
    ],
    "templates": [
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "COMPARISON"
        ],
        "template": "{character} wants to buy books at the book fair. Calculate the total cost.",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      }
    ]
  }
}
# Test B.14: COIN_RECOGNITION model
{
  "success": true,
  "question": {
    "text": "Sarah wants to buy books at the book fair. Calculate the total cost.",
    "options": [
      {
        "value": 0,
        "text": "0p",
        "isCorrect": true
      }
    ],
    "correctIndex": 0,
    "format": "DIRECT_CALCULATION",
    "difficulty": {
      "year": 4,
      "subLevel": 1,
      "displayName": "4.1",
      "cognitiveLoad": 40
    },
    "cognitiveLoad": 40,
    "curriculumTags": [
      "4N1a"
    ],
    "scenario": {
      "id": "shop-001-bookfair",
      "theme": "SHOPPING",
      "setting": {
        "location": "school book fair",
        "timeContext": "lunch break",
        "atmosphere": "busy"
      },
      "characters": [
        {
          "name": "Sarah",
          "role": "student"
        },
        {
          "name": "Mr. Johnson",
          "role": "teacher"
        }
      ],
      "items": [
        {
          "name": "book",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 3,
            "max": 12,
            "typical": 6.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "bookmark",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.5,
            "max": 2,
            "typical": 1,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        }
      ],
      "culturalElements": [
        {
          "type": "currency",
          "value": "£",
          "explanation": "British pounds"
        },
        {
          "type": "event",
          "value": "book fair",
          "explanation": "School fundraising event"
        }
      ],
      "realWorldConnection": "School fundraising and reading promotion",
      "yearAppropriate": [
        2,
        3,
        4,
        5
      ],
      "templates": [
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "COMPARISON"
          ],
          "template": "{character} wants to buy books at the book fair. Calculate the total cost.",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        }
      ]
    },
    "distractors": [],
    "enhancementStatus": {
      "level": "partial",
      "requestedFormat": "DIRECT_CALCULATION",
      "actualFormat": "DIRECT_CALCULATION",
      "featuresActive": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "featuresPending": [],
      "isFullyEnhanced": true
    },
    "mathOutput": {
      "operation": "COIN_RECOGNITION",
      "total_value": 2000
    },
    "generationTime": 1,
    "questionId": "q_1759079325927_oa5xo33sq",
    "generationSetup": {
      "controller_used": "DIRECT_CALCULATIONController",
      "format_requested": "DIRECT_CALCULATION",
      "format_actual": "DIRECT_CALCULATION",
      "scenario_theme": "SHOPPING",
      "scenario_id": "shop-001-bookfair",
      "scenario_selection_method": "default",
      "distractor_strategies": [],
      "distractor_count": 0,
      "theme_variety": false,
      "format_variety": false,
      "enhancement_level": "partial",
      "features_active": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "features_pending": [],
      "generation_time_ms": 1
    }
  },
  "metadata": {
    "format": "DIRECT_CALCULATION",
    "cognitive_load": 40,
    "curriculum_alignment": [
      "4N1a"
    ],
    "difficulty": "4.1",
    "scenario_theme": "SHOPPING",
    "distractor_strategies": [],
    "generation_time_ms": 1,
    "api_version": "2.0",
    "enhancement_status": "partial",
    "format_requested": "DIRECT_CALCULATION",
    "format_used": "DIRECT_CALCULATION",
    "features_active": [
      "enhanced_distractors",
      "rich_scenarios",
      "cognitive_load",
      "advanced_formats"
    ],
    "features_pending": []
  },
  "context": {
    "id": "shop-001-bookfair",
    "theme": "SHOPPING",
    "setting": {
      "location": "school book fair",
      "timeContext": "lunch break",
      "atmosphere": "busy"
    },
    "characters": [
      {
        "name": "Sarah",
        "role": "student"
      },
      {
        "name": "Mr. Johnson",
        "role": "teacher"
      }
    ],
    "items": [
      {
        "name": "book",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 3,
          "max": 12,
          "typical": 6.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "bookmark",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.5,
          "max": 2,
          "typical": 1,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      }
    ],
    "culturalElements": [
      {
        "type": "currency",
        "value": "£",
        "explanation": "British pounds"
      },
      {
        "type": "event",
        "value": "book fair",
        "explanation": "School fundraising event"
      }
    ],
    "realWorldConnection": "School fundraising and reading promotion",
    "yearAppropriate": [
      2,
      3,
      4,
      5
    ],
    "templates": [
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "COMPARISON"
        ],
        "template": "{character} wants to buy books at the book fair. Calculate the total cost.",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      }
    ]
  }
}
# Test B.15: CHANGE_CALCULATION model
{
  "success": true,
  "question": {
    "text": "Sarah wants to buy books at the book fair. Calculate the total cost.",
    "options": [
      {
        "value": 0,
        "text": "0p",
        "isCorrect": true
      }
    ],
    "correctIndex": 0,
    "format": "DIRECT_CALCULATION",
    "difficulty": {
      "year": 4,
      "subLevel": 1,
      "displayName": "4.1",
      "cognitiveLoad": 40
    },
    "cognitiveLoad": 40,
    "curriculumTags": [
      "4N1a"
    ],
    "scenario": {
      "id": "shop-001-bookfair",
      "theme": "SHOPPING",
      "setting": {
        "location": "school book fair",
        "timeContext": "lunch break",
        "atmosphere": "busy"
      },
      "characters": [
        {
          "name": "Sarah",
          "role": "student"
        },
        {
          "name": "Mr. Johnson",
          "role": "teacher"
        }
      ],
      "items": [
        {
          "name": "book",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 3,
            "max": 12,
            "typical": 6.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "bookmark",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.5,
            "max": 2,
            "typical": 1,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        }
      ],
      "culturalElements": [
        {
          "type": "currency",
          "value": "£",
          "explanation": "British pounds"
        },
        {
          "type": "event",
          "value": "book fair",
          "explanation": "School fundraising event"
        }
      ],
      "realWorldConnection": "School fundraising and reading promotion",
      "yearAppropriate": [
        2,
        3,
        4,
        5
      ],
      "templates": [
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "COMPARISON"
          ],
          "template": "{character} wants to buy books at the book fair. Calculate the total cost.",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        }
      ]
    },
    "distractors": [],
    "enhancementStatus": {
      "level": "partial",
      "requestedFormat": "DIRECT_CALCULATION",
      "actualFormat": "DIRECT_CALCULATION",
      "featuresActive": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "featuresPending": [],
      "isFullyEnhanced": true
    },
    "mathOutput": {
      "operation": "CHANGE_CALCULATION"
    },
    "generationTime": 0,
    "questionId": "q_1759079326046_5yeaq9dv4",
    "generationSetup": {
      "controller_used": "DIRECT_CALCULATIONController",
      "format_requested": "DIRECT_CALCULATION",
      "format_actual": "DIRECT_CALCULATION",
      "scenario_theme": "SHOPPING",
      "scenario_id": "shop-001-bookfair",
      "scenario_selection_method": "default",
      "distractor_strategies": [],
      "distractor_count": 0,
      "theme_variety": false,
      "format_variety": false,
      "enhancement_level": "partial",
      "features_active": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "features_pending": [],
      "generation_time_ms": 0
    }
  },
  "metadata": {
    "format": "DIRECT_CALCULATION",
    "cognitive_load": 40,
    "curriculum_alignment": [
      "4N1a"
    ],
    "difficulty": "4.1",
    "scenario_theme": "SHOPPING",
    "distractor_strategies": [],
    "generation_time_ms": 1,
    "api_version": "2.0",
    "enhancement_status": "partial",
    "format_requested": "DIRECT_CALCULATION",
    "format_used": "DIRECT_CALCULATION",
    "features_active": [
      "enhanced_distractors",
      "rich_scenarios",
      "cognitive_load",
      "advanced_formats"
    ],
    "features_pending": []
  },
  "context": {
    "id": "shop-001-bookfair",
    "theme": "SHOPPING",
    "setting": {
      "location": "school book fair",
      "timeContext": "lunch break",
      "atmosphere": "busy"
    },
    "characters": [
      {
        "name": "Sarah",
        "role": "student"
      },
      {
        "name": "Mr. Johnson",
        "role": "teacher"
      }
    ],
    "items": [
      {
        "name": "book",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 3,
          "max": 12,
          "typical": 6.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "bookmark",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.5,
          "max": 2,
          "typical": 1,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      }
    ],
    "culturalElements": [
      {
        "type": "currency",
        "value": "£",
        "explanation": "British pounds"
      },
      {
        "type": "event",
        "value": "book fair",
        "explanation": "School fundraising event"
      }
    ],
    "realWorldConnection": "School fundraising and reading promotion",
    "yearAppropriate": [
      2,
      3,
      4,
      5
    ],
    "templates": [
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "COMPARISON"
        ],
        "template": "{character} wants to buy books at the book fair. Calculate the total cost.",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      }
    ]
  }
}
# Test B.16: MONEY_COMBINATIONS model
{
  "success": true,
  "question": {
    "text": "Charlotte goes to the shop and buys apple, banana, sandwich, drink, cake, biscuit, sweet, chocolate, pen, pencil, ruler, notebook, eraser, book, comic, magazine, toy, game, puzzle, sticker, badge, poster, card. How much does Charlotte spend in total?",
    "options": [
      {
        "value": 0,
        "text": "0p",
        "isCorrect": true
      }
    ],
    "correctIndex": 0,
    "format": "DIRECT_CALCULATION",
    "difficulty": {
      "year": 4,
      "subLevel": 1,
      "displayName": "4.1",
      "cognitiveLoad": 40
    },
    "cognitiveLoad": 40,
    "curriculumTags": [
      "4N1a"
    ],
    "scenario": {
      "id": "shop-002-realistic-general",
      "theme": "SHOPPING",
      "setting": {
        "location": "local shop",
        "timeContext": "after school",
        "atmosphere": "friendly"
      },
      "characters": [
        {
          "name": "Charlotte",
          "role": "student"
        }
      ],
      "items": [
        {
          "name": "apple",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.2,
            "max": 0.5,
            "typical": 0.35,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "banana",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.15,
            "max": 0.4,
            "typical": 0.25,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "sandwich",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 2.5,
            "max": 6,
            "typical": 4,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "drink",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.8,
            "max": 2.5,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "cake",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 1.5,
            "max": 4,
            "typical": 2.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "biscuit",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.8,
            "max": 2,
            "typical": 1.2,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "sweet",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.1,
            "max": 1,
            "typical": 0.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "chocolate",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.6,
            "max": 3,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "pen",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.5,
            "max": 2,
            "typical": 1,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "pencil",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.2,
            "max": 1,
            "typical": 0.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "ruler",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.8,
            "max": 2.5,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "notebook",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 1,
            "max": 4,
            "typical": 2,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "eraser",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.3,
            "max": 1.5,
            "typical": 0.75,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "book",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 3,
            "max": 15,
            "typical": 8,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "comic",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 2,
            "max": 5,
            "typical": 3,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "magazine",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 2.5,
            "max": 6,
            "typical": 4,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "toy",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 5,
            "max": 25,
            "typical": 12,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "game",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 8,
            "max": 60,
            "typical": 25,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "puzzle",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 5,
            "max": 20,
            "typical": 12,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "sticker",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 0.2,
            "max": 2,
            "typical": 0.8,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "badge",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 0.5,
            "max": 3,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "poster",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 2,
            "max": 8,
            "typical": 4,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "card",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 0.5,
            "max": 4,
            "typical": 2,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        }
      ],
      "culturalElements": [
        {
          "type": "currency",
          "value": "£",
          "explanation": "British pounds"
        },
        {
          "type": "location",
          "value": "UK local shop",
          "explanation": "Typical British corner shop"
        }
      ],
      "realWorldConnection": "Everyday shopping with realistic UK prices",
      "yearAppropriate": [
        1,
        2,
        3,
        4,
        5,
        6
      ],
      "templates": [
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "MULTI_STEP"
          ],
          "modelCompatibility": [
            "ADDITION"
          ],
          "operandCount": 3,
          "template": "{character} buys a {item1} for {price1}, a {item2} for {price2}, and a {item3} for {price3}. What is the total cost?",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item1",
              "type": "item"
            },
            {
              "key": "item2",
              "type": "item"
            },
            {
              "key": "item3",
              "type": "item"
            },
            {
              "key": "price1",
              "type": "value"
            },
            {
              "key": "price2",
              "type": "value"
            },
            {
              "key": "price3",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "MULTI_STEP"
          ],
          "modelCompatibility": [
            "ADDITION"
          ],
          "operandCount": 2,
          "template": "{character} buys a {item1} for {price1} and a {item2} for {price2}. What is the total cost?",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item1",
              "type": "item"
            },
            {
              "key": "item2",
              "type": "item"
            },
            {
              "key": "price1",
              "type": "value"
            },
            {
              "key": "price2",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION"
          ],
          "modelCompatibility": [
            "SUBTRACTION",
            "CHANGE_CALCULATION"
          ],
          "template": "{character} buys a {item} for {price} and pays with {payment}. How much change does {character} get?",
          "answerTemplate": "{character} receives {result} in change",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "price",
              "type": "value"
            },
            {
              "key": "payment",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION"
          ],
          "modelCompatibility": [
            "MULTIPLICATION"
          ],
          "template": "{character} buys {quantity} {item} at {price} each. What is the total cost?",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "quantity",
              "type": "value"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "price",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION"
          ],
          "modelCompatibility": [
            "DIVISION"
          ],
          "template": "{character} has {total} to spend equally on {quantity} {item}. How much can {character} spend on each one?",
          "answerTemplate": "{character} can spend {result} on each {item}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "total",
              "type": "value"
            },
            {
              "key": "quantity",
              "type": "value"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "COMPARISON",
            "ESTIMATION",
            "MULTI_STEP"
          ],
          "template": "{character} goes to the shop and buys {items}. How much does {character} spend in total?",
          "answerTemplate": "{character} spends {result} in total",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "items",
              "type": "item_list"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "ESTIMATION"
          ],
          "template": "Estimate: If {character} buys {items}, about how much will it cost?",
          "answerTemplate": "It will cost approximately {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "items",
              "type": "item_list"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "VALIDATION"
          ],
          "template": "{character} calculated that {items} costs {amount}. Is this correct?",
          "answerTemplate": "{validation_result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "items",
              "type": "item_list"
            },
            {
              "key": "amount",
              "type": "value"
            },
            {
              "key": "validation_result",
              "type": "boolean"
            }
          ]
        }
      ]
    },
    "distractors": [],
    "enhancementStatus": {
      "level": "partial",
      "requestedFormat": "DIRECT_CALCULATION",
      "actualFormat": "DIRECT_CALCULATION",
      "featuresActive": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "featuresPending": [],
      "isFullyEnhanced": true
    },
    "mathOutput": {
      "operation": "MONEY_COMBINATIONS",
      "target_amount": 273,
      "combination_count": 2
    },
    "generationTime": 1120,
    "questionId": "q_1759079327271_m7fhlttrv",
    "generationSetup": {
      "controller_used": "DIRECT_CALCULATIONController",
      "format_requested": "DIRECT_CALCULATION",
      "format_actual": "DIRECT_CALCULATION",
      "scenario_theme": "SHOPPING",
      "scenario_id": "shop-002-realistic-general",
      "scenario_selection_method": "default",
      "distractor_strategies": [],
      "distractor_count": 0,
      "theme_variety": false,
      "format_variety": false,
      "enhancement_level": "partial",
      "features_active": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "features_pending": [],
      "generation_time_ms": 1120
    }
  },
  "metadata": {
    "format": "DIRECT_CALCULATION",
    "cognitive_load": 40,
    "curriculum_alignment": [
      "4N1a"
    ],
    "difficulty": "4.1",
    "scenario_theme": "SHOPPING",
    "distractor_strategies": [],
    "generation_time_ms": 1120,
    "api_version": "2.0",
    "enhancement_status": "partial",
    "format_requested": "DIRECT_CALCULATION",
    "format_used": "DIRECT_CALCULATION",
    "features_active": [
      "enhanced_distractors",
      "rich_scenarios",
      "cognitive_load",
      "advanced_formats"
    ],
    "features_pending": []
  },
  "context": {
    "id": "shop-002-realistic-general",
    "theme": "SHOPPING",
    "setting": {
      "location": "local shop",
      "timeContext": "after school",
      "atmosphere": "friendly"
    },
    "characters": [
      {
        "name": "Charlotte",
        "role": "student"
      }
    ],
    "items": [
      {
        "name": "apple",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.2,
          "max": 0.5,
          "typical": 0.35,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "banana",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.15,
          "max": 0.4,
          "typical": 0.25,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "sandwich",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 2.5,
          "max": 6,
          "typical": 4,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "drink",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.8,
          "max": 2.5,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "cake",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 1.5,
          "max": 4,
          "typical": 2.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "biscuit",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.8,
          "max": 2,
          "typical": 1.2,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "sweet",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.1,
          "max": 1,
          "typical": 0.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "chocolate",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.6,
          "max": 3,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "pen",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.5,
          "max": 2,
          "typical": 1,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "pencil",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.2,
          "max": 1,
          "typical": 0.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "ruler",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.8,
          "max": 2.5,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "notebook",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 1,
          "max": 4,
          "typical": 2,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "eraser",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.3,
          "max": 1.5,
          "typical": 0.75,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "book",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 3,
          "max": 15,
          "typical": 8,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "comic",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 2,
          "max": 5,
          "typical": 3,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "magazine",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 2.5,
          "max": 6,
          "typical": 4,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "toy",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 5,
          "max": 25,
          "typical": 12,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "game",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 8,
          "max": 60,
          "typical": 25,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "puzzle",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 5,
          "max": 20,
          "typical": 12,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "sticker",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 0.2,
          "max": 2,
          "typical": 0.8,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "badge",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 0.5,
          "max": 3,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "poster",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 2,
          "max": 8,
          "typical": 4,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "card",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 0.5,
          "max": 4,
          "typical": 2,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      }
    ],
    "culturalElements": [
      {
        "type": "currency",
        "value": "£",
        "explanation": "British pounds"
      },
      {
        "type": "location",
        "value": "UK local shop",
        "explanation": "Typical British corner shop"
      }
    ],
    "realWorldConnection": "Everyday shopping with realistic UK prices",
    "yearAppropriate": [
      1,
      2,
      3,
      4,
      5,
      6
    ],
    "templates": [
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "MULTI_STEP"
        ],
        "modelCompatibility": [
          "ADDITION"
        ],
        "operandCount": 3,
        "template": "{character} buys a {item1} for {price1}, a {item2} for {price2}, and a {item3} for {price3}. What is the total cost?",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item1",
            "type": "item"
          },
          {
            "key": "item2",
            "type": "item"
          },
          {
            "key": "item3",
            "type": "item"
          },
          {
            "key": "price1",
            "type": "value"
          },
          {
            "key": "price2",
            "type": "value"
          },
          {
            "key": "price3",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "MULTI_STEP"
        ],
        "modelCompatibility": [
          "ADDITION"
        ],
        "operandCount": 2,
        "template": "{character} buys a {item1} for {price1} and a {item2} for {price2}. What is the total cost?",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item1",
            "type": "item"
          },
          {
            "key": "item2",
            "type": "item"
          },
          {
            "key": "price1",
            "type": "value"
          },
          {
            "key": "price2",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION"
        ],
        "modelCompatibility": [
          "SUBTRACTION",
          "CHANGE_CALCULATION"
        ],
        "template": "{character} buys a {item} for {price} and pays with {payment}. How much change does {character} get?",
        "answerTemplate": "{character} receives {result} in change",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "price",
            "type": "value"
          },
          {
            "key": "payment",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION"
        ],
        "modelCompatibility": [
          "MULTIPLICATION"
        ],
        "template": "{character} buys {quantity} {item} at {price} each. What is the total cost?",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "quantity",
            "type": "value"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "price",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION"
        ],
        "modelCompatibility": [
          "DIVISION"
        ],
        "template": "{character} has {total} to spend equally on {quantity} {item}. How much can {character} spend on each one?",
        "answerTemplate": "{character} can spend {result} on each {item}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "total",
            "type": "value"
          },
          {
            "key": "quantity",
            "type": "value"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "COMPARISON",
          "ESTIMATION",
          "MULTI_STEP"
        ],
        "template": "{character} goes to the shop and buys {items}. How much does {character} spend in total?",
        "answerTemplate": "{character} spends {result} in total",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "items",
            "type": "item_list"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "ESTIMATION"
        ],
        "template": "Estimate: If {character} buys {items}, about how much will it cost?",
        "answerTemplate": "It will cost approximately {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "items",
            "type": "item_list"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "VALIDATION"
        ],
        "template": "{character} calculated that {items} costs {amount}. Is this correct?",
        "answerTemplate": "{validation_result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "items",
            "type": "item_list"
          },
          {
            "key": "amount",
            "type": "value"
          },
          {
            "key": "validation_result",
            "type": "boolean"
          }
        ]
      }
    ]
  }
}
# Test B.17: MIXED_MONEY_UNITS model
{
  "success": true,
  "question": {
    "text": "Charlotte goes to the shop and buys apple, banana, sandwich, drink, cake, biscuit, sweet, chocolate, pen, pencil, ruler, notebook, eraser, book, comic, magazine, toy, game, puzzle, sticker, badge, poster, card. How much does Charlotte spend in total?",
    "options": [
      {
        "value": 0,
        "text": "0p",
        "isCorrect": true
      }
    ],
    "correctIndex": 0,
    "format": "DIRECT_CALCULATION",
    "difficulty": {
      "year": 4,
      "subLevel": 1,
      "displayName": "4.1",
      "cognitiveLoad": 40
    },
    "cognitiveLoad": 40,
    "curriculumTags": [
      "4N1a"
    ],
    "scenario": {
      "id": "shop-002-realistic-general",
      "theme": "SHOPPING",
      "setting": {
        "location": "local shop",
        "timeContext": "after school",
        "atmosphere": "friendly"
      },
      "characters": [
        {
          "name": "Charlotte",
          "role": "student"
        }
      ],
      "items": [
        {
          "name": "apple",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.2,
            "max": 0.5,
            "typical": 0.35,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "banana",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.15,
            "max": 0.4,
            "typical": 0.25,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "sandwich",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 2.5,
            "max": 6,
            "typical": 4,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "drink",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.8,
            "max": 2.5,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "cake",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 1.5,
            "max": 4,
            "typical": 2.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "biscuit",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.8,
            "max": 2,
            "typical": 1.2,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "sweet",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.1,
            "max": 1,
            "typical": 0.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "chocolate",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.6,
            "max": 3,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "pen",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.5,
            "max": 2,
            "typical": 1,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "pencil",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.2,
            "max": 1,
            "typical": 0.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "ruler",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.8,
            "max": 2.5,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "notebook",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 1,
            "max": 4,
            "typical": 2,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "eraser",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.3,
            "max": 1.5,
            "typical": 0.75,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "book",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 3,
            "max": 15,
            "typical": 8,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "comic",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 2,
            "max": 5,
            "typical": 3,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "magazine",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 2.5,
            "max": 6,
            "typical": 4,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "toy",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 5,
            "max": 25,
            "typical": 12,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "game",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 8,
            "max": 60,
            "typical": 25,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "puzzle",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 5,
            "max": 20,
            "typical": 12,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "sticker",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 0.2,
            "max": 2,
            "typical": 0.8,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "badge",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 0.5,
            "max": 3,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "poster",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 2,
            "max": 8,
            "typical": 4,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "card",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 0.5,
            "max": 4,
            "typical": 2,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        }
      ],
      "culturalElements": [
        {
          "type": "currency",
          "value": "£",
          "explanation": "British pounds"
        },
        {
          "type": "location",
          "value": "UK local shop",
          "explanation": "Typical British corner shop"
        }
      ],
      "realWorldConnection": "Everyday shopping with realistic UK prices",
      "yearAppropriate": [
        1,
        2,
        3,
        4,
        5,
        6
      ],
      "templates": [
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "MULTI_STEP"
          ],
          "modelCompatibility": [
            "ADDITION"
          ],
          "operandCount": 3,
          "template": "{character} buys a {item1} for {price1}, a {item2} for {price2}, and a {item3} for {price3}. What is the total cost?",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item1",
              "type": "item"
            },
            {
              "key": "item2",
              "type": "item"
            },
            {
              "key": "item3",
              "type": "item"
            },
            {
              "key": "price1",
              "type": "value"
            },
            {
              "key": "price2",
              "type": "value"
            },
            {
              "key": "price3",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "MULTI_STEP"
          ],
          "modelCompatibility": [
            "ADDITION"
          ],
          "operandCount": 2,
          "template": "{character} buys a {item1} for {price1} and a {item2} for {price2}. What is the total cost?",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item1",
              "type": "item"
            },
            {
              "key": "item2",
              "type": "item"
            },
            {
              "key": "price1",
              "type": "value"
            },
            {
              "key": "price2",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION"
          ],
          "modelCompatibility": [
            "SUBTRACTION",
            "CHANGE_CALCULATION"
          ],
          "template": "{character} buys a {item} for {price} and pays with {payment}. How much change does {character} get?",
          "answerTemplate": "{character} receives {result} in change",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "price",
              "type": "value"
            },
            {
              "key": "payment",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION"
          ],
          "modelCompatibility": [
            "MULTIPLICATION"
          ],
          "template": "{character} buys {quantity} {item} at {price} each. What is the total cost?",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "quantity",
              "type": "value"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "price",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION"
          ],
          "modelCompatibility": [
            "DIVISION"
          ],
          "template": "{character} has {total} to spend equally on {quantity} {item}. How much can {character} spend on each one?",
          "answerTemplate": "{character} can spend {result} on each {item}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "total",
              "type": "value"
            },
            {
              "key": "quantity",
              "type": "value"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "COMPARISON",
            "ESTIMATION",
            "MULTI_STEP"
          ],
          "template": "{character} goes to the shop and buys {items}. How much does {character} spend in total?",
          "answerTemplate": "{character} spends {result} in total",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "items",
              "type": "item_list"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "ESTIMATION"
          ],
          "template": "Estimate: If {character} buys {items}, about how much will it cost?",
          "answerTemplate": "It will cost approximately {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "items",
              "type": "item_list"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "VALIDATION"
          ],
          "template": "{character} calculated that {items} costs {amount}. Is this correct?",
          "answerTemplate": "{validation_result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "items",
              "type": "item_list"
            },
            {
              "key": "amount",
              "type": "value"
            },
            {
              "key": "validation_result",
              "type": "boolean"
            }
          ]
        }
      ]
    },
    "distractors": [],
    "enhancementStatus": {
      "level": "partial",
      "requestedFormat": "DIRECT_CALCULATION",
      "actualFormat": "DIRECT_CALCULATION",
      "featuresActive": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "featuresPending": [],
      "isFullyEnhanced": true
    },
    "mathOutput": {
      "operation": "MIXED_MONEY_UNITS"
    },
    "generationTime": 0,
    "questionId": "q_1759079327378_37dfg8n3h",
    "generationSetup": {
      "controller_used": "DIRECT_CALCULATIONController",
      "format_requested": "DIRECT_CALCULATION",
      "format_actual": "DIRECT_CALCULATION",
      "scenario_theme": "SHOPPING",
      "scenario_id": "shop-002-realistic-general",
      "scenario_selection_method": "default",
      "distractor_strategies": [],
      "distractor_count": 0,
      "theme_variety": false,
      "format_variety": false,
      "enhancement_level": "partial",
      "features_active": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "features_pending": [],
      "generation_time_ms": 0
    }
  },
  "metadata": {
    "format": "DIRECT_CALCULATION",
    "cognitive_load": 40,
    "curriculum_alignment": [
      "4N1a"
    ],
    "difficulty": "4.1",
    "scenario_theme": "SHOPPING",
    "distractor_strategies": [],
    "generation_time_ms": 1,
    "api_version": "2.0",
    "enhancement_status": "partial",
    "format_requested": "DIRECT_CALCULATION",
    "format_used": "DIRECT_CALCULATION",
    "features_active": [
      "enhanced_distractors",
      "rich_scenarios",
      "cognitive_load",
      "advanced_formats"
    ],
    "features_pending": []
  },
  "context": {
    "id": "shop-002-realistic-general",
    "theme": "SHOPPING",
    "setting": {
      "location": "local shop",
      "timeContext": "after school",
      "atmosphere": "friendly"
    },
    "characters": [
      {
        "name": "Charlotte",
        "role": "student"
      }
    ],
    "items": [
      {
        "name": "apple",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.2,
          "max": 0.5,
          "typical": 0.35,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "banana",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.15,
          "max": 0.4,
          "typical": 0.25,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "sandwich",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 2.5,
          "max": 6,
          "typical": 4,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "drink",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.8,
          "max": 2.5,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "cake",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 1.5,
          "max": 4,
          "typical": 2.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "biscuit",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.8,
          "max": 2,
          "typical": 1.2,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "sweet",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.1,
          "max": 1,
          "typical": 0.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "chocolate",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.6,
          "max": 3,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "pen",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.5,
          "max": 2,
          "typical": 1,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "pencil",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.2,
          "max": 1,
          "typical": 0.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "ruler",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.8,
          "max": 2.5,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "notebook",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 1,
          "max": 4,
          "typical": 2,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "eraser",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.3,
          "max": 1.5,
          "typical": 0.75,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "book",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 3,
          "max": 15,
          "typical": 8,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "comic",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 2,
          "max": 5,
          "typical": 3,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "magazine",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 2.5,
          "max": 6,
          "typical": 4,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "toy",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 5,
          "max": 25,
          "typical": 12,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "game",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 8,
          "max": 60,
          "typical": 25,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "puzzle",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 5,
          "max": 20,
          "typical": 12,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "sticker",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 0.2,
          "max": 2,
          "typical": 0.8,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "badge",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 0.5,
          "max": 3,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "poster",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 2,
          "max": 8,
          "typical": 4,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "card",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 0.5,
          "max": 4,
          "typical": 2,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      }
    ],
    "culturalElements": [
      {
        "type": "currency",
        "value": "£",
        "explanation": "British pounds"
      },
      {
        "type": "location",
        "value": "UK local shop",
        "explanation": "Typical British corner shop"
      }
    ],
    "realWorldConnection": "Everyday shopping with realistic UK prices",
    "yearAppropriate": [
      1,
      2,
      3,
      4,
      5,
      6
    ],
    "templates": [
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "MULTI_STEP"
        ],
        "modelCompatibility": [
          "ADDITION"
        ],
        "operandCount": 3,
        "template": "{character} buys a {item1} for {price1}, a {item2} for {price2}, and a {item3} for {price3}. What is the total cost?",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item1",
            "type": "item"
          },
          {
            "key": "item2",
            "type": "item"
          },
          {
            "key": "item3",
            "type": "item"
          },
          {
            "key": "price1",
            "type": "value"
          },
          {
            "key": "price2",
            "type": "value"
          },
          {
            "key": "price3",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "MULTI_STEP"
        ],
        "modelCompatibility": [
          "ADDITION"
        ],
        "operandCount": 2,
        "template": "{character} buys a {item1} for {price1} and a {item2} for {price2}. What is the total cost?",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item1",
            "type": "item"
          },
          {
            "key": "item2",
            "type": "item"
          },
          {
            "key": "price1",
            "type": "value"
          },
          {
            "key": "price2",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION"
        ],
        "modelCompatibility": [
          "SUBTRACTION",
          "CHANGE_CALCULATION"
        ],
        "template": "{character} buys a {item} for {price} and pays with {payment}. How much change does {character} get?",
        "answerTemplate": "{character} receives {result} in change",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "price",
            "type": "value"
          },
          {
            "key": "payment",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION"
        ],
        "modelCompatibility": [
          "MULTIPLICATION"
        ],
        "template": "{character} buys {quantity} {item} at {price} each. What is the total cost?",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "quantity",
            "type": "value"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "price",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION"
        ],
        "modelCompatibility": [
          "DIVISION"
        ],
        "template": "{character} has {total} to spend equally on {quantity} {item}. How much can {character} spend on each one?",
        "answerTemplate": "{character} can spend {result} on each {item}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "total",
            "type": "value"
          },
          {
            "key": "quantity",
            "type": "value"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "COMPARISON",
          "ESTIMATION",
          "MULTI_STEP"
        ],
        "template": "{character} goes to the shop and buys {items}. How much does {character} spend in total?",
        "answerTemplate": "{character} spends {result} in total",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "items",
            "type": "item_list"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "ESTIMATION"
        ],
        "template": "Estimate: If {character} buys {items}, about how much will it cost?",
        "answerTemplate": "It will cost approximately {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "items",
            "type": "item_list"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "VALIDATION"
        ],
        "template": "{character} calculated that {items} costs {amount}. Is this correct?",
        "answerTemplate": "{validation_result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "items",
            "type": "item_list"
          },
          {
            "key": "amount",
            "type": "value"
          },
          {
            "key": "validation_result",
            "type": "boolean"
          }
        ]
      }
    ]
  }
}
# Test B.18: MONEY_FRACTIONS model
{
  "success": true,
  "question": {
    "text": "Charlotte goes to the shop and buys apple, banana, sandwich, drink, cake, biscuit, sweet, chocolate, pen, pencil, ruler, notebook, eraser, book, comic, magazine, toy, game, puzzle, sticker, badge, poster, card. How much does Charlotte spend in total?",
    "options": [
      {
        "text": "13.25",
        "value": 13.25,
        "index": 0
      },
      {
        "text": "£12.25",
        "value": 12.25,
        "index": 1
      },
      {
        "text": "11.25",
        "value": 11.25,
        "index": 2
      }
    ],
    "correctIndex": 1,
    "format": "DIRECT_CALCULATION",
    "difficulty": {
      "year": 4,
      "subLevel": 1,
      "displayName": "4.1",
      "cognitiveLoad": 40
    },
    "cognitiveLoad": 40,
    "curriculumTags": [
      "4N1a"
    ],
    "scenario": {
      "id": "shop-002-realistic-general",
      "theme": "SHOPPING",
      "setting": {
        "location": "local shop",
        "timeContext": "after school",
        "atmosphere": "friendly"
      },
      "characters": [
        {
          "name": "Charlotte",
          "role": "student"
        }
      ],
      "items": [
        {
          "name": "apple",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.2,
            "max": 0.5,
            "typical": 0.35,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "banana",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.15,
            "max": 0.4,
            "typical": 0.25,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "sandwich",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 2.5,
            "max": 6,
            "typical": 4,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "drink",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.8,
            "max": 2.5,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "cake",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 1.5,
            "max": 4,
            "typical": 2.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "biscuit",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.8,
            "max": 2,
            "typical": 1.2,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "sweet",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.1,
            "max": 1,
            "typical": 0.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "chocolate",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.6,
            "max": 3,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "pen",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.5,
            "max": 2,
            "typical": 1,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "pencil",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.2,
            "max": 1,
            "typical": 0.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "ruler",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.8,
            "max": 2.5,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "notebook",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 1,
            "max": 4,
            "typical": 2,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "eraser",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.3,
            "max": 1.5,
            "typical": 0.75,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "book",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 3,
            "max": 15,
            "typical": 8,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "comic",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 2,
            "max": 5,
            "typical": 3,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "magazine",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 2.5,
            "max": 6,
            "typical": 4,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "toy",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 5,
            "max": 25,
            "typical": 12,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "game",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 8,
            "max": 60,
            "typical": 25,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "puzzle",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 5,
            "max": 20,
            "typical": 12,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "sticker",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 0.2,
            "max": 2,
            "typical": 0.8,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "badge",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 0.5,
            "max": 3,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "poster",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 2,
            "max": 8,
            "typical": 4,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "card",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 0.5,
            "max": 4,
            "typical": 2,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        }
      ],
      "culturalElements": [
        {
          "type": "currency",
          "value": "£",
          "explanation": "British pounds"
        },
        {
          "type": "location",
          "value": "UK local shop",
          "explanation": "Typical British corner shop"
        }
      ],
      "realWorldConnection": "Everyday shopping with realistic UK prices",
      "yearAppropriate": [
        1,
        2,
        3,
        4,
        5,
        6
      ],
      "templates": [
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "MULTI_STEP"
          ],
          "modelCompatibility": [
            "ADDITION"
          ],
          "operandCount": 3,
          "template": "{character} buys a {item1} for {price1}, a {item2} for {price2}, and a {item3} for {price3}. What is the total cost?",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item1",
              "type": "item"
            },
            {
              "key": "item2",
              "type": "item"
            },
            {
              "key": "item3",
              "type": "item"
            },
            {
              "key": "price1",
              "type": "value"
            },
            {
              "key": "price2",
              "type": "value"
            },
            {
              "key": "price3",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "MULTI_STEP"
          ],
          "modelCompatibility": [
            "ADDITION"
          ],
          "operandCount": 2,
          "template": "{character} buys a {item1} for {price1} and a {item2} for {price2}. What is the total cost?",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item1",
              "type": "item"
            },
            {
              "key": "item2",
              "type": "item"
            },
            {
              "key": "price1",
              "type": "value"
            },
            {
              "key": "price2",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION"
          ],
          "modelCompatibility": [
            "SUBTRACTION",
            "CHANGE_CALCULATION"
          ],
          "template": "{character} buys a {item} for {price} and pays with {payment}. How much change does {character} get?",
          "answerTemplate": "{character} receives {result} in change",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "price",
              "type": "value"
            },
            {
              "key": "payment",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION"
          ],
          "modelCompatibility": [
            "MULTIPLICATION"
          ],
          "template": "{character} buys {quantity} {item} at {price} each. What is the total cost?",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "quantity",
              "type": "value"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "price",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION"
          ],
          "modelCompatibility": [
            "DIVISION"
          ],
          "template": "{character} has {total} to spend equally on {quantity} {item}. How much can {character} spend on each one?",
          "answerTemplate": "{character} can spend {result} on each {item}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "total",
              "type": "value"
            },
            {
              "key": "quantity",
              "type": "value"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "COMPARISON",
            "ESTIMATION",
            "MULTI_STEP"
          ],
          "template": "{character} goes to the shop and buys {items}. How much does {character} spend in total?",
          "answerTemplate": "{character} spends {result} in total",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "items",
              "type": "item_list"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "ESTIMATION"
          ],
          "template": "Estimate: If {character} buys {items}, about how much will it cost?",
          "answerTemplate": "It will cost approximately {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "items",
              "type": "item_list"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "VALIDATION"
          ],
          "template": "{character} calculated that {items} costs {amount}. Is this correct?",
          "answerTemplate": "{validation_result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "items",
              "type": "item_list"
            },
            {
              "key": "amount",
              "type": "value"
            },
            {
              "key": "validation_result",
              "type": "boolean"
            }
          ]
        }
      ]
    },
    "distractors": [
      {
        "value": 13.25,
        "displayText": "13.25",
        "strategy": "CLOSE_VALUE",
        "reasoning": "Off by 1"
      },
      {
        "value": 11.25,
        "displayText": "11.25",
        "strategy": "CLOSE_VALUE",
        "reasoning": "Off by 1"
      }
    ],
    "enhancementStatus": {
      "level": "partial",
      "requestedFormat": "DIRECT_CALCULATION",
      "actualFormat": "DIRECT_CALCULATION",
      "featuresActive": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "featuresPending": [],
      "isFullyEnhanced": true
    },
    "mathOutput": {
      "operation": "MONEY_FRACTIONS",
      "result": 12.25
    },
    "generationTime": 1,
    "questionId": "q_1759079327475_bx6whtlan",
    "generationSetup": {
      "controller_used": "DIRECT_CALCULATIONController",
      "format_requested": "DIRECT_CALCULATION",
      "format_actual": "DIRECT_CALCULATION",
      "scenario_theme": "SHOPPING",
      "scenario_id": "shop-002-realistic-general",
      "scenario_selection_method": "default",
      "distractor_strategies": [
        "CLOSE_VALUE",
        "CLOSE_VALUE"
      ],
      "distractor_count": 2,
      "theme_variety": false,
      "format_variety": false,
      "enhancement_level": "partial",
      "features_active": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "features_pending": [],
      "generation_time_ms": 1
    }
  },
  "metadata": {
    "format": "DIRECT_CALCULATION",
    "cognitive_load": 40,
    "curriculum_alignment": [
      "4N1a"
    ],
    "difficulty": "4.1",
    "scenario_theme": "SHOPPING",
    "distractor_strategies": [
      "CLOSE_VALUE",
      "CLOSE_VALUE"
    ],
    "generation_time_ms": 1,
    "api_version": "2.0",
    "enhancement_status": "partial",
    "format_requested": "DIRECT_CALCULATION",
    "format_used": "DIRECT_CALCULATION",
    "features_active": [
      "enhanced_distractors",
      "rich_scenarios",
      "cognitive_load",
      "advanced_formats"
    ],
    "features_pending": []
  },
  "context": {
    "id": "shop-002-realistic-general",
    "theme": "SHOPPING",
    "setting": {
      "location": "local shop",
      "timeContext": "after school",
      "atmosphere": "friendly"
    },
    "characters": [
      {
        "name": "Charlotte",
        "role": "student"
      }
    ],
    "items": [
      {
        "name": "apple",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.2,
          "max": 0.5,
          "typical": 0.35,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "banana",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.15,
          "max": 0.4,
          "typical": 0.25,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "sandwich",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 2.5,
          "max": 6,
          "typical": 4,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "drink",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.8,
          "max": 2.5,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "cake",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 1.5,
          "max": 4,
          "typical": 2.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "biscuit",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.8,
          "max": 2,
          "typical": 1.2,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "sweet",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.1,
          "max": 1,
          "typical": 0.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "chocolate",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.6,
          "max": 3,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "pen",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.5,
          "max": 2,
          "typical": 1,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "pencil",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.2,
          "max": 1,
          "typical": 0.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "ruler",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.8,
          "max": 2.5,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "notebook",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 1,
          "max": 4,
          "typical": 2,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "eraser",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.3,
          "max": 1.5,
          "typical": 0.75,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "book",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 3,
          "max": 15,
          "typical": 8,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "comic",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 2,
          "max": 5,
          "typical": 3,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "magazine",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 2.5,
          "max": 6,
          "typical": 4,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "toy",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 5,
          "max": 25,
          "typical": 12,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "game",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 8,
          "max": 60,
          "typical": 25,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "puzzle",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 5,
          "max": 20,
          "typical": 12,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "sticker",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 0.2,
          "max": 2,
          "typical": 0.8,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "badge",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 0.5,
          "max": 3,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "poster",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 2,
          "max": 8,
          "typical": 4,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "card",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 0.5,
          "max": 4,
          "typical": 2,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      }
    ],
    "culturalElements": [
      {
        "type": "currency",
        "value": "£",
        "explanation": "British pounds"
      },
      {
        "type": "location",
        "value": "UK local shop",
        "explanation": "Typical British corner shop"
      }
    ],
    "realWorldConnection": "Everyday shopping with realistic UK prices",
    "yearAppropriate": [
      1,
      2,
      3,
      4,
      5,
      6
    ],
    "templates": [
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "MULTI_STEP"
        ],
        "modelCompatibility": [
          "ADDITION"
        ],
        "operandCount": 3,
        "template": "{character} buys a {item1} for {price1}, a {item2} for {price2}, and a {item3} for {price3}. What is the total cost?",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item1",
            "type": "item"
          },
          {
            "key": "item2",
            "type": "item"
          },
          {
            "key": "item3",
            "type": "item"
          },
          {
            "key": "price1",
            "type": "value"
          },
          {
            "key": "price2",
            "type": "value"
          },
          {
            "key": "price3",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "MULTI_STEP"
        ],
        "modelCompatibility": [
          "ADDITION"
        ],
        "operandCount": 2,
        "template": "{character} buys a {item1} for {price1} and a {item2} for {price2}. What is the total cost?",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item1",
            "type": "item"
          },
          {
            "key": "item2",
            "type": "item"
          },
          {
            "key": "price1",
            "type": "value"
          },
          {
            "key": "price2",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION"
        ],
        "modelCompatibility": [
          "SUBTRACTION",
          "CHANGE_CALCULATION"
        ],
        "template": "{character} buys a {item} for {price} and pays with {payment}. How much change does {character} get?",
        "answerTemplate": "{character} receives {result} in change",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "price",
            "type": "value"
          },
          {
            "key": "payment",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION"
        ],
        "modelCompatibility": [
          "MULTIPLICATION"
        ],
        "template": "{character} buys {quantity} {item} at {price} each. What is the total cost?",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "quantity",
            "type": "value"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "price",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION"
        ],
        "modelCompatibility": [
          "DIVISION"
        ],
        "template": "{character} has {total} to spend equally on {quantity} {item}. How much can {character} spend on each one?",
        "answerTemplate": "{character} can spend {result} on each {item}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "total",
            "type": "value"
          },
          {
            "key": "quantity",
            "type": "value"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "COMPARISON",
          "ESTIMATION",
          "MULTI_STEP"
        ],
        "template": "{character} goes to the shop and buys {items}. How much does {character} spend in total?",
        "answerTemplate": "{character} spends {result} in total",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "items",
            "type": "item_list"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "ESTIMATION"
        ],
        "template": "Estimate: If {character} buys {items}, about how much will it cost?",
        "answerTemplate": "It will cost approximately {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "items",
            "type": "item_list"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "VALIDATION"
        ],
        "template": "{character} calculated that {items} costs {amount}. Is this correct?",
        "answerTemplate": "{validation_result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "items",
            "type": "item_list"
          },
          {
            "key": "amount",
            "type": "value"
          },
          {
            "key": "validation_result",
            "type": "boolean"
          }
        ]
      }
    ]
  }
}
# Test B.19: MONEY_SCALING model
{
  "success": true,
  "question": {
    "text": "Sarah wants to buy books at the book fair. Calculate the total cost.",
    "options": [
      {
        "value": 0,
        "text": "0p",
        "isCorrect": true
      }
    ],
    "correctIndex": 0,
    "format": "DIRECT_CALCULATION",
    "difficulty": {
      "year": 4,
      "subLevel": 1,
      "displayName": "4.1",
      "cognitiveLoad": 40
    },
    "cognitiveLoad": 40,
    "curriculumTags": [
      "4N1a"
    ],
    "scenario": {
      "id": "shop-001-bookfair",
      "theme": "SHOPPING",
      "setting": {
        "location": "school book fair",
        "timeContext": "lunch break",
        "atmosphere": "busy"
      },
      "characters": [
        {
          "name": "Sarah",
          "role": "student"
        },
        {
          "name": "Mr. Johnson",
          "role": "teacher"
        }
      ],
      "items": [
        {
          "name": "book",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 3,
            "max": 12,
            "typical": 6.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "bookmark",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.5,
            "max": 2,
            "typical": 1,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        }
      ],
      "culturalElements": [
        {
          "type": "currency",
          "value": "£",
          "explanation": "British pounds"
        },
        {
          "type": "event",
          "value": "book fair",
          "explanation": "School fundraising event"
        }
      ],
      "realWorldConnection": "School fundraising and reading promotion",
      "yearAppropriate": [
        2,
        3,
        4,
        5
      ],
      "templates": [
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "COMPARISON"
          ],
          "template": "{character} wants to buy books at the book fair. Calculate the total cost.",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        }
      ]
    },
    "distractors": [],
    "enhancementStatus": {
      "level": "partial",
      "requestedFormat": "DIRECT_CALCULATION",
      "actualFormat": "DIRECT_CALCULATION",
      "featuresActive": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "featuresPending": [],
      "isFullyEnhanced": true
    },
    "mathOutput": {
      "operation": "MONEY_SCALING",
      "base_amount": 85
    },
    "generationTime": 1,
    "questionId": "q_1759079327574_gb1ns49io",
    "generationSetup": {
      "controller_used": "DIRECT_CALCULATIONController",
      "format_requested": "DIRECT_CALCULATION",
      "format_actual": "DIRECT_CALCULATION",
      "scenario_theme": "SHOPPING",
      "scenario_id": "shop-001-bookfair",
      "scenario_selection_method": "default",
      "distractor_strategies": [],
      "distractor_count": 0,
      "theme_variety": false,
      "format_variety": false,
      "enhancement_level": "partial",
      "features_active": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "features_pending": [],
      "generation_time_ms": 1
    }
  },
  "metadata": {
    "format": "DIRECT_CALCULATION",
    "cognitive_load": 40,
    "curriculum_alignment": [
      "4N1a"
    ],
    "difficulty": "4.1",
    "scenario_theme": "SHOPPING",
    "distractor_strategies": [],
    "generation_time_ms": 1,
    "api_version": "2.0",
    "enhancement_status": "partial",
    "format_requested": "DIRECT_CALCULATION",
    "format_used": "DIRECT_CALCULATION",
    "features_active": [
      "enhanced_distractors",
      "rich_scenarios",
      "cognitive_load",
      "advanced_formats"
    ],
    "features_pending": []
  },
  "context": {
    "id": "shop-001-bookfair",
    "theme": "SHOPPING",
    "setting": {
      "location": "school book fair",
      "timeContext": "lunch break",
      "atmosphere": "busy"
    },
    "characters": [
      {
        "name": "Sarah",
        "role": "student"
      },
      {
        "name": "Mr. Johnson",
        "role": "teacher"
      }
    ],
    "items": [
      {
        "name": "book",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 3,
          "max": 12,
          "typical": 6.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "bookmark",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.5,
          "max": 2,
          "typical": 1,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      }
    ],
    "culturalElements": [
      {
        "type": "currency",
        "value": "£",
        "explanation": "British pounds"
      },
      {
        "type": "event",
        "value": "book fair",
        "explanation": "School fundraising event"
      }
    ],
    "realWorldConnection": "School fundraising and reading promotion",
    "yearAppropriate": [
      2,
      3,
      4,
      5
    ],
    "templates": [
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "COMPARISON"
        ],
        "template": "{character} wants to buy books at the book fair. Calculate the total cost.",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      }
    ]
  }
}
# Test B.20: SHAPE_RECOGNITION model
{
  "success": true,
  "question": {
    "text": "Madison buys a item for £5. How much does it cost?",
    "options": [
      {
        "value": 0,
        "text": "0p",
        "isCorrect": true
      }
    ],
    "correctIndex": 0,
    "format": "DIRECT_CALCULATION",
    "difficulty": {
      "year": 4,
      "subLevel": 1,
      "displayName": "4.1",
      "cognitiveLoad": 40
    },
    "cognitiveLoad": 40,
    "curriculumTags": [
      "4N1a"
    ],
    "scenario": {
      "id": "default-4-1759079327671",
      "theme": "SHOPPING",
      "setting": {
        "location": "shop",
        "timeContext": "afternoon",
        "atmosphere": "friendly"
      },
      "characters": [
        {
          "name": "Madison",
          "role": "student"
        }
      ],
      "items": [
        {
          "name": "item",
          "category": "HOUSEHOLD_ITEMS",
          "typicalValue": {
            "min": 1,
            "max": 10,
            "typical": 5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        }
      ],
      "culturalElements": [
        {
          "type": "currency",
          "value": "£",
          "explanation": "British pounds"
        }
      ],
      "realWorldConnection": "Basic shopping calculations",
      "yearAppropriate": [
        4
      ],
      "templates": [
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION"
          ],
          "template": "{character} buys a {item} for {price}. How much does it cost?",
          "answerTemplate": "It costs {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "price",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        }
      ]
    },
    "distractors": [],
    "enhancementStatus": {
      "level": "partial",
      "requestedFormat": "DIRECT_CALCULATION",
      "actualFormat": "DIRECT_CALCULATION",
      "featuresActive": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "featuresPending": [],
      "isFullyEnhanced": true
    },
    "mathOutput": {
      "operation": "SHAPE_RECOGNITION"
    },
    "generationTime": 1,
    "questionId": "q_1759079327671_y7jx15d0i",
    "generationSetup": {
      "controller_used": "DIRECT_CALCULATIONController",
      "format_requested": "DIRECT_CALCULATION",
      "format_actual": "DIRECT_CALCULATION",
      "scenario_theme": "SHOPPING",
      "scenario_id": "default-4-1759079327671",
      "scenario_selection_method": "default",
      "distractor_strategies": [],
      "distractor_count": 0,
      "theme_variety": false,
      "format_variety": false,
      "enhancement_level": "partial",
      "features_active": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "features_pending": [],
      "generation_time_ms": 1
    }
  },
  "metadata": {
    "format": "DIRECT_CALCULATION",
    "cognitive_load": 40,
    "curriculum_alignment": [
      "4N1a"
    ],
    "difficulty": "4.1",
    "scenario_theme": "SHOPPING",
    "distractor_strategies": [],
    "generation_time_ms": 1,
    "api_version": "2.0",
    "enhancement_status": "partial",
    "format_requested": "DIRECT_CALCULATION",
    "format_used": "DIRECT_CALCULATION",
    "features_active": [
      "enhanced_distractors",
      "rich_scenarios",
      "cognitive_load",
      "advanced_formats"
    ],
    "features_pending": []
  },
  "context": {
    "id": "default-4-1759079327671",
    "theme": "SHOPPING",
    "setting": {
      "location": "shop",
      "timeContext": "afternoon",
      "atmosphere": "friendly"
    },
    "characters": [
      {
        "name": "Madison",
        "role": "student"
      }
    ],
    "items": [
      {
        "name": "item",
        "category": "HOUSEHOLD_ITEMS",
        "typicalValue": {
          "min": 1,
          "max": 10,
          "typical": 5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      }
    ],
    "culturalElements": [
      {
        "type": "currency",
        "value": "£",
        "explanation": "British pounds"
      }
    ],
    "realWorldConnection": "Basic shopping calculations",
    "yearAppropriate": [
      4
    ],
    "templates": [
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION"
        ],
        "template": "{character} buys a {item} for {price}. How much does it cost?",
        "answerTemplate": "It costs {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "price",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      }
    ]
  }
}
# Test B.21: SHAPE_PROPERTIES model
{
  "success": true,
  "question": {
    "text": "Elizabeth buys a item for £5. How much does it cost?",
    "options": [
      {
        "value": 0,
        "text": "0p",
        "isCorrect": true
      }
    ],
    "correctIndex": 0,
    "format": "DIRECT_CALCULATION",
    "difficulty": {
      "year": 4,
      "subLevel": 1,
      "displayName": "4.1",
      "cognitiveLoad": 40
    },
    "cognitiveLoad": 40,
    "curriculumTags": [
      "4N1a"
    ],
    "scenario": {
      "id": "default-4-1759079327767",
      "theme": "SHOPPING",
      "setting": {
        "location": "shop",
        "timeContext": "afternoon",
        "atmosphere": "friendly"
      },
      "characters": [
        {
          "name": "Elizabeth",
          "role": "student"
        }
      ],
      "items": [
        {
          "name": "item",
          "category": "HOUSEHOLD_ITEMS",
          "typicalValue": {
            "min": 1,
            "max": 10,
            "typical": 5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        }
      ],
      "culturalElements": [
        {
          "type": "currency",
          "value": "£",
          "explanation": "British pounds"
        }
      ],
      "realWorldConnection": "Basic shopping calculations",
      "yearAppropriate": [
        4
      ],
      "templates": [
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION"
          ],
          "template": "{character} buys a {item} for {price}. How much does it cost?",
          "answerTemplate": "It costs {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "price",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        }
      ]
    },
    "distractors": [],
    "enhancementStatus": {
      "level": "partial",
      "requestedFormat": "DIRECT_CALCULATION",
      "actualFormat": "DIRECT_CALCULATION",
      "featuresActive": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "featuresPending": [],
      "isFullyEnhanced": true
    },
    "mathOutput": {
      "operation": "SHAPE_PROPERTIES"
    },
    "generationTime": 0,
    "questionId": "q_1759079327767_ooo99z3ad",
    "generationSetup": {
      "controller_used": "DIRECT_CALCULATIONController",
      "format_requested": "DIRECT_CALCULATION",
      "format_actual": "DIRECT_CALCULATION",
      "scenario_theme": "SHOPPING",
      "scenario_id": "default-4-1759079327767",
      "scenario_selection_method": "default",
      "distractor_strategies": [],
      "distractor_count": 0,
      "theme_variety": false,
      "format_variety": false,
      "enhancement_level": "partial",
      "features_active": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "features_pending": [],
      "generation_time_ms": 0
    }
  },
  "metadata": {
    "format": "DIRECT_CALCULATION",
    "cognitive_load": 40,
    "curriculum_alignment": [
      "4N1a"
    ],
    "difficulty": "4.1",
    "scenario_theme": "SHOPPING",
    "distractor_strategies": [],
    "generation_time_ms": 1,
    "api_version": "2.0",
    "enhancement_status": "partial",
    "format_requested": "DIRECT_CALCULATION",
    "format_used": "DIRECT_CALCULATION",
    "features_active": [
      "enhanced_distractors",
      "rich_scenarios",
      "cognitive_load",
      "advanced_formats"
    ],
    "features_pending": []
  },
  "context": {
    "id": "default-4-1759079327767",
    "theme": "SHOPPING",
    "setting": {
      "location": "shop",
      "timeContext": "afternoon",
      "atmosphere": "friendly"
    },
    "characters": [
      {
        "name": "Elizabeth",
        "role": "student"
      }
    ],
    "items": [
      {
        "name": "item",
        "category": "HOUSEHOLD_ITEMS",
        "typicalValue": {
          "min": 1,
          "max": 10,
          "typical": 5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      }
    ],
    "culturalElements": [
      {
        "type": "currency",
        "value": "£",
        "explanation": "British pounds"
      }
    ],
    "realWorldConnection": "Basic shopping calculations",
    "yearAppropriate": [
      4
    ],
    "templates": [
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION"
        ],
        "template": "{character} buys a {item} for {price}. How much does it cost?",
        "answerTemplate": "It costs {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "price",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      }
    ]
  }
}
# Test B.22: ANGLE_MEASUREMENT model
{
  "success": true,
  "question": {
    "text": "Amelia buys a item for £5. How much does it cost?",
    "options": [
      {
        "value": 0,
        "text": "0p",
        "isCorrect": true
      }
    ],
    "correctIndex": 0,
    "format": "DIRECT_CALCULATION",
    "difficulty": {
      "year": 4,
      "subLevel": 1,
      "displayName": "4.1",
      "cognitiveLoad": 40
    },
    "cognitiveLoad": 40,
    "curriculumTags": [
      "4N1a"
    ],
    "scenario": {
      "id": "default-4-1759079327865",
      "theme": "SHOPPING",
      "setting": {
        "location": "shop",
        "timeContext": "afternoon",
        "atmosphere": "friendly"
      },
      "characters": [
        {
          "name": "Amelia",
          "role": "student"
        }
      ],
      "items": [
        {
          "name": "item",
          "category": "HOUSEHOLD_ITEMS",
          "typicalValue": {
            "min": 1,
            "max": 10,
            "typical": 5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        }
      ],
      "culturalElements": [
        {
          "type": "currency",
          "value": "£",
          "explanation": "British pounds"
        }
      ],
      "realWorldConnection": "Basic shopping calculations",
      "yearAppropriate": [
        4
      ],
      "templates": [
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION"
          ],
          "template": "{character} buys a {item} for {price}. How much does it cost?",
          "answerTemplate": "It costs {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "price",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        }
      ]
    },
    "distractors": [],
    "enhancementStatus": {
      "level": "partial",
      "requestedFormat": "DIRECT_CALCULATION",
      "actualFormat": "DIRECT_CALCULATION",
      "featuresActive": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "featuresPending": [],
      "isFullyEnhanced": true
    },
    "mathOutput": {
      "operation": "ANGLE_MEASUREMENT",
      "angle_degrees": 120,
      "angle_type": "obtuse"
    },
    "generationTime": 1,
    "questionId": "q_1759079327866_c05axg2wf",
    "generationSetup": {
      "controller_used": "DIRECT_CALCULATIONController",
      "format_requested": "DIRECT_CALCULATION",
      "format_actual": "DIRECT_CALCULATION",
      "scenario_theme": "SHOPPING",
      "scenario_id": "default-4-1759079327865",
      "scenario_selection_method": "default",
      "distractor_strategies": [],
      "distractor_count": 0,
      "theme_variety": false,
      "format_variety": false,
      "enhancement_level": "partial",
      "features_active": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "features_pending": [],
      "generation_time_ms": 1
    }
  },
  "metadata": {
    "format": "DIRECT_CALCULATION",
    "cognitive_load": 40,
    "curriculum_alignment": [
      "4N1a"
    ],
    "difficulty": "4.1",
    "scenario_theme": "SHOPPING",
    "distractor_strategies": [],
    "generation_time_ms": 1,
    "api_version": "2.0",
    "enhancement_status": "partial",
    "format_requested": "DIRECT_CALCULATION",
    "format_used": "DIRECT_CALCULATION",
    "features_active": [
      "enhanced_distractors",
      "rich_scenarios",
      "cognitive_load",
      "advanced_formats"
    ],
    "features_pending": []
  },
  "context": {
    "id": "default-4-1759079327865",
    "theme": "SHOPPING",
    "setting": {
      "location": "shop",
      "timeContext": "afternoon",
      "atmosphere": "friendly"
    },
    "characters": [
      {
        "name": "Amelia",
        "role": "student"
      }
    ],
    "items": [
      {
        "name": "item",
        "category": "HOUSEHOLD_ITEMS",
        "typicalValue": {
          "min": 1,
          "max": 10,
          "typical": 5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      }
    ],
    "culturalElements": [
      {
        "type": "currency",
        "value": "£",
        "explanation": "British pounds"
      }
    ],
    "realWorldConnection": "Basic shopping calculations",
    "yearAppropriate": [
      4
    ],
    "templates": [
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION"
        ],
        "template": "{character} buys a {item} for {price}. How much does it cost?",
        "answerTemplate": "It costs {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "price",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      }
    ]
  }
}
# Test B.23: POSITION_DIRECTION model
{
  "success": true,
  "question": {
    "text": "Abigail buys a item for £5. How much does it cost?",
    "options": [
      {
        "value": 0,
        "text": "0p",
        "isCorrect": true
      }
    ],
    "correctIndex": 0,
    "format": "DIRECT_CALCULATION",
    "difficulty": {
      "year": 4,
      "subLevel": 1,
      "displayName": "4.1",
      "cognitiveLoad": 40
    },
    "cognitiveLoad": 40,
    "curriculumTags": [
      "4N1a"
    ],
    "scenario": {
      "id": "default-4-1759079327962",
      "theme": "SHOPPING",
      "setting": {
        "location": "shop",
        "timeContext": "afternoon",
        "atmosphere": "friendly"
      },
      "characters": [
        {
          "name": "Abigail",
          "role": "student"
        }
      ],
      "items": [
        {
          "name": "item",
          "category": "HOUSEHOLD_ITEMS",
          "typicalValue": {
            "min": 1,
            "max": 10,
            "typical": 5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        }
      ],
      "culturalElements": [
        {
          "type": "currency",
          "value": "£",
          "explanation": "British pounds"
        }
      ],
      "realWorldConnection": "Basic shopping calculations",
      "yearAppropriate": [
        4
      ],
      "templates": [
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION"
          ],
          "template": "{character} buys a {item} for {price}. How much does it cost?",
          "answerTemplate": "It costs {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "price",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        }
      ]
    },
    "distractors": [],
    "enhancementStatus": {
      "level": "partial",
      "requestedFormat": "DIRECT_CALCULATION",
      "actualFormat": "DIRECT_CALCULATION",
      "featuresActive": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "featuresPending": [],
      "isFullyEnhanced": true
    },
    "mathOutput": {
      "operation": "POSITION_DIRECTION"
    },
    "generationTime": 1,
    "questionId": "q_1759079327962_9bjbyf1tb",
    "generationSetup": {
      "controller_used": "DIRECT_CALCULATIONController",
      "format_requested": "DIRECT_CALCULATION",
      "format_actual": "DIRECT_CALCULATION",
      "scenario_theme": "SHOPPING",
      "scenario_id": "default-4-1759079327962",
      "scenario_selection_method": "default",
      "distractor_strategies": [],
      "distractor_count": 0,
      "theme_variety": false,
      "format_variety": false,
      "enhancement_level": "partial",
      "features_active": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "features_pending": [],
      "generation_time_ms": 1
    }
  },
  "metadata": {
    "format": "DIRECT_CALCULATION",
    "cognitive_load": 40,
    "curriculum_alignment": [
      "4N1a"
    ],
    "difficulty": "4.1",
    "scenario_theme": "SHOPPING",
    "distractor_strategies": [],
    "generation_time_ms": 1,
    "api_version": "2.0",
    "enhancement_status": "partial",
    "format_requested": "DIRECT_CALCULATION",
    "format_used": "DIRECT_CALCULATION",
    "features_active": [
      "enhanced_distractors",
      "rich_scenarios",
      "cognitive_load",
      "advanced_formats"
    ],
    "features_pending": []
  },
  "context": {
    "id": "default-4-1759079327962",
    "theme": "SHOPPING",
    "setting": {
      "location": "shop",
      "timeContext": "afternoon",
      "atmosphere": "friendly"
    },
    "characters": [
      {
        "name": "Abigail",
        "role": "student"
      }
    ],
    "items": [
      {
        "name": "item",
        "category": "HOUSEHOLD_ITEMS",
        "typicalValue": {
          "min": 1,
          "max": 10,
          "typical": 5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      }
    ],
    "culturalElements": [
      {
        "type": "currency",
        "value": "£",
        "explanation": "British pounds"
      }
    ],
    "realWorldConnection": "Basic shopping calculations",
    "yearAppropriate": [
      4
    ],
    "templates": [
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION"
        ],
        "template": "{character} buys a {item} for {price}. How much does it cost?",
        "answerTemplate": "It costs {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "price",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      }
    ]
  }
}
# Test B.24: AREA_PERIMETER model
{
  "success": true,
  "question": {
    "text": "Daniel buys a item for £5. How much does it cost?",
    "options": [
      {
        "value": 0,
        "text": "0p",
        "isCorrect": true
      }
    ],
    "correctIndex": 0,
    "format": "DIRECT_CALCULATION",
    "difficulty": {
      "year": 4,
      "subLevel": 1,
      "displayName": "4.1",
      "cognitiveLoad": 40
    },
    "cognitiveLoad": 40,
    "curriculumTags": [
      "4N1a"
    ],
    "scenario": {
      "id": "default-4-1759079328063",
      "theme": "SHOPPING",
      "setting": {
        "location": "shop",
        "timeContext": "afternoon",
        "atmosphere": "friendly"
      },
      "characters": [
        {
          "name": "Daniel",
          "role": "student"
        }
      ],
      "items": [
        {
          "name": "item",
          "category": "HOUSEHOLD_ITEMS",
          "typicalValue": {
            "min": 1,
            "max": 10,
            "typical": 5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        }
      ],
      "culturalElements": [
        {
          "type": "currency",
          "value": "£",
          "explanation": "British pounds"
        }
      ],
      "realWorldConnection": "Basic shopping calculations",
      "yearAppropriate": [
        4
      ],
      "templates": [
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION"
          ],
          "template": "{character} buys a {item} for {price}. How much does it cost?",
          "answerTemplate": "It costs {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "price",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        }
      ]
    },
    "distractors": [],
    "enhancementStatus": {
      "level": "partial",
      "requestedFormat": "DIRECT_CALCULATION",
      "actualFormat": "DIRECT_CALCULATION",
      "featuresActive": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "featuresPending": [],
      "isFullyEnhanced": true
    },
    "mathOutput": {
      "operation": "AREA_PERIMETER"
    },
    "generationTime": 0,
    "questionId": "q_1759079328063_gwnrtucxv",
    "generationSetup": {
      "controller_used": "DIRECT_CALCULATIONController",
      "format_requested": "DIRECT_CALCULATION",
      "format_actual": "DIRECT_CALCULATION",
      "scenario_theme": "SHOPPING",
      "scenario_id": "default-4-1759079328063",
      "scenario_selection_method": "default",
      "distractor_strategies": [],
      "distractor_count": 0,
      "theme_variety": false,
      "format_variety": false,
      "enhancement_level": "partial",
      "features_active": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "features_pending": [],
      "generation_time_ms": 0
    }
  },
  "metadata": {
    "format": "DIRECT_CALCULATION",
    "cognitive_load": 40,
    "curriculum_alignment": [
      "4N1a"
    ],
    "difficulty": "4.1",
    "scenario_theme": "SHOPPING",
    "distractor_strategies": [],
    "generation_time_ms": 0,
    "api_version": "2.0",
    "enhancement_status": "partial",
    "format_requested": "DIRECT_CALCULATION",
    "format_used": "DIRECT_CALCULATION",
    "features_active": [
      "enhanced_distractors",
      "rich_scenarios",
      "cognitive_load",
      "advanced_formats"
    ],
    "features_pending": []
  },
  "context": {
    "id": "default-4-1759079328063",
    "theme": "SHOPPING",
    "setting": {
      "location": "shop",
      "timeContext": "afternoon",
      "atmosphere": "friendly"
    },
    "characters": [
      {
        "name": "Daniel",
        "role": "student"
      }
    ],
    "items": [
      {
        "name": "item",
        "category": "HOUSEHOLD_ITEMS",
        "typicalValue": {
          "min": 1,
          "max": 10,
          "typical": 5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      }
    ],
    "culturalElements": [
      {
        "type": "currency",
        "value": "£",
        "explanation": "British pounds"
      }
    ],
    "realWorldConnection": "Basic shopping calculations",
    "yearAppropriate": [
      4
    ],
    "templates": [
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION"
        ],
        "template": "{character} buys a {item} for {price}. How much does it cost?",
        "answerTemplate": "It costs {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "price",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      }
    ]
  }
}

--- SUITE C: FORMAT COVERAGE TESTS ---
Testing every question format using the ADDITION model...
# Test C.1: DIRECT_CALCULATION format
{
  "success": true,
  "question": {
    "text": "Sarah wants to buy books at the book fair. Calculate the total cost.",
    "options": [
      {
        "text": "£16.05",
        "value": 16.05,
        "index": 0
      },
      {
        "text": "26.05",
        "value": 26.05,
        "index": 1
      },
      {
        "text": "867",
        "value": 867,
        "index": 2
      },
      {
        "text": "10548",
        "value": 10548,
        "index": 3
      }
    ],
    "correctIndex": 0,
    "format": "DIRECT_CALCULATION",
    "difficulty": {
      "year": 5,
      "subLevel": 3,
      "displayName": "5.3",
      "cognitiveLoad": 60
    },
    "cognitiveLoad": 60,
    "curriculumTags": [
      "5N1a",
      "5N1b"
    ],
    "scenario": {
      "id": "shop-001-bookfair",
      "theme": "SHOPPING",
      "setting": {
        "location": "school book fair",
        "timeContext": "lunch break",
        "atmosphere": "busy"
      },
      "characters": [
        {
          "name": "Sarah",
          "role": "student"
        },
        {
          "name": "Mr. Johnson",
          "role": "teacher"
        }
      ],
      "items": [
        {
          "name": "book",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 3,
            "max": 12,
            "typical": 6.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "bookmark",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.5,
            "max": 2,
            "typical": 1,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        }
      ],
      "culturalElements": [
        {
          "type": "currency",
          "value": "£",
          "explanation": "British pounds"
        },
        {
          "type": "event",
          "value": "book fair",
          "explanation": "School fundraising event"
        }
      ],
      "realWorldConnection": "School fundraising and reading promotion",
      "yearAppropriate": [
        2,
        3,
        4,
        5
      ],
      "templates": [
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "COMPARISON"
          ],
          "template": "{character} wants to buy books at the book fair. Calculate the total cost.",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        }
      ]
    },
    "distractors": [
      {
        "value": 867,
        "displayText": "867",
        "strategy": "WRONG_OPERATION",
        "reasoning": "Subtracted instead of adding"
      },
      {
        "value": 10548,
        "displayText": "10548",
        "strategy": "WRONG_OPERATION",
        "reasoning": "Multiplied instead of adding"
      },
      {
        "value": 26.05,
        "displayText": "26.05",
        "strategy": "PLACE_VALUE_ERROR",
        "reasoning": "Error in carrying to next column"
      }
    ],
    "enhancementStatus": {
      "level": "partial",
      "requestedFormat": "DIRECT_CALCULATION",
      "actualFormat": "DIRECT_CALCULATION",
      "featuresActive": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "featuresPending": [],
      "isFullyEnhanced": true
    },
    "mathOutput": {
      "operation": "ADDITION",
      "operand_1": 6.53,
      "operand_2": 1.72,
      "operand_3": 5.28,
      "operand_4": 2.52,
      "result": 16.05
    },
    "generationTime": 0,
    "questionId": "q_1759079328165_pi0x5uoir",
    "generationSetup": {
      "controller_used": "DIRECT_CALCULATIONController",
      "format_requested": "DIRECT_CALCULATION",
      "format_actual": "DIRECT_CALCULATION",
      "scenario_theme": "SHOPPING",
      "scenario_id": "shop-001-bookfair",
      "scenario_selection_method": "default",
      "distractor_strategies": [
        "WRONG_OPERATION",
        "WRONG_OPERATION",
        "PLACE_VALUE_ERROR"
      ],
      "distractor_count": 3,
      "theme_variety": false,
      "format_variety": false,
      "enhancement_level": "partial",
      "features_active": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "features_pending": [],
      "generation_time_ms": 0
    }
  },
  "metadata": {
    "format": "DIRECT_CALCULATION",
    "cognitive_load": 60,
    "curriculum_alignment": [
      "5N1a",
      "5N1b"
    ],
    "difficulty": "5.3",
    "scenario_theme": "SHOPPING",
    "distractor_strategies": [
      "WRONG_OPERATION",
      "WRONG_OPERATION",
      "PLACE_VALUE_ERROR"
    ],
    "generation_time_ms": 0,
    "api_version": "2.0",
    "enhancement_status": "partial",
    "format_requested": "DIRECT_CALCULATION",
    "format_used": "DIRECT_CALCULATION",
    "features_active": [
      "enhanced_distractors",
      "rich_scenarios",
      "cognitive_load",
      "advanced_formats"
    ],
    "features_pending": []
  },
  "context": {
    "id": "shop-001-bookfair",
    "theme": "SHOPPING",
    "setting": {
      "location": "school book fair",
      "timeContext": "lunch break",
      "atmosphere": "busy"
    },
    "characters": [
      {
        "name": "Sarah",
        "role": "student"
      },
      {
        "name": "Mr. Johnson",
        "role": "teacher"
      }
    ],
    "items": [
      {
        "name": "book",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 3,
          "max": 12,
          "typical": 6.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "bookmark",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.5,
          "max": 2,
          "typical": 1,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      }
    ],
    "culturalElements": [
      {
        "type": "currency",
        "value": "£",
        "explanation": "British pounds"
      },
      {
        "type": "event",
        "value": "book fair",
        "explanation": "School fundraising event"
      }
    ],
    "realWorldConnection": "School fundraising and reading promotion",
    "yearAppropriate": [
      2,
      3,
      4,
      5
    ],
    "templates": [
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "COMPARISON"
        ],
        "template": "{character} wants to buy books at the book fair. Calculate the total cost.",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      }
    ]
  }
}
# Test C.2: COMPARISON format
{
  "success": true,
  "question": {
    "text": "Sarah is comparing options to find the best value.\n\nOption A: A: 428 + 554 + 791 + 770 = 2543\nOption B: B: 567 + 125 + 752 = 1444\n\nWhich calculation gives the higher result?",
    "options": [
      {
        "text": "Both options are equally good value",
        "value": -1,
        "index": 0
      },
      {
        "text": "Option B is better value",
        "value": 1,
        "index": 1
      },
      {
        "text": "Option A saves you £2198.00",
        "value": 0,
        "index": 2
      },
      {
        "text": "Option A is better value",
        "value": 0,
        "index": 3
      }
    ],
    "correctIndex": 2,
    "questionContent": {
      "fullText": "Sarah is comparing options to find the best value.\n\nOption A: A: 428 + 554 + 791 + 770 = 2543\nOption B: B: 567 + 125 + 752 = 1444\n\nWhich calculation gives the higher result?",
      "templateData": {
        "character": "Sarah",
        "optionA": "A: 428 + 554 + 791 + 770 = 2543",
        "optionB": "B: 567 + 125 + 752 = 1444",
        "context": "addition",
        "comparisonType": "calculated_value"
      }
    },
    "format": "COMPARISON",
    "difficulty": {
      "year": 5,
      "subLevel": 3,
      "displayName": "5.3",
      "cognitiveLoad": 60
    },
    "cognitiveLoad": 60,
    "curriculumTags": [
      "5N1a",
      "5N1b"
    ],
    "scenario": {
      "id": "shop-001-bookfair",
      "theme": "SHOPPING",
      "setting": {
        "location": "school book fair",
        "timeContext": "lunch break",
        "atmosphere": "busy"
      },
      "characters": [
        {
          "name": "Sarah",
          "role": "student"
        },
        {
          "name": "Mr. Johnson",
          "role": "teacher"
        }
      ],
      "items": [
        {
          "name": "book",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 3,
            "max": 12,
            "typical": 6.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "bookmark",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.5,
            "max": 2,
            "typical": 1,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        }
      ],
      "culturalElements": [
        {
          "type": "currency",
          "value": "£",
          "explanation": "British pounds"
        },
        {
          "type": "event",
          "value": "book fair",
          "explanation": "School fundraising event"
        }
      ],
      "realWorldConnection": "School fundraising and reading promotion",
      "yearAppropriate": [
        2,
        3,
        4,
        5
      ],
      "templates": [
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "COMPARISON"
          ],
          "template": "{character} wants to buy books at the book fair. Calculate the total cost.",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        }
      ]
    },
    "distractors": [
      {
        "value": 1,
        "displayText": "Option B is better value",
        "strategy": "REVERSED_COMPARISON",
        "reasoning": "Selected the option with lower value"
      },
      {
        "value": -1,
        "displayText": "Both options are equally good value",
        "strategy": "WRONG_SELECTION",
        "reasoning": "Failed to calculate the difference correctly"
      },
      {
        "value": 0,
        "displayText": "Option A saves you £2198.00",
        "strategy": "CALCULATION_ERROR",
        "reasoning": "Arithmetic error in calculating the difference"
      }
    ],
    "enhancementStatus": {
      "level": "full",
      "requestedFormat": "COMPARISON",
      "actualFormat": "COMPARISON",
      "featuresActive": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "featuresPending": [],
      "isFullyEnhanced": true
    },
    "mathOutput": {
      "operation": "ADDITION",
      "option_1_value": 2543,
      "option_2_value": 1444
    },
    "generationTime": 1,
    "questionId": "q_1759079328263_zlwfiagjc",
    "generationSetup": {
      "controller_used": "COMPARISONController",
      "format_requested": "COMPARISON",
      "format_actual": "COMPARISON",
      "scenario_theme": "SHOPPING",
      "scenario_id": "shop-001-bookfair",
      "scenario_selection_method": "default",
      "distractor_strategies": [
        "REVERSED_COMPARISON",
        "WRONG_SELECTION",
        "CALCULATION_ERROR"
      ],
      "distractor_count": 3,
      "theme_variety": false,
      "format_variety": false,
      "enhancement_level": "full",
      "features_active": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "features_pending": [],
      "generation_time_ms": 1
    }
  },
  "metadata": {
    "format": "COMPARISON",
    "cognitive_load": 60,
    "curriculum_alignment": [
      "5N1a",
      "5N1b"
    ],
    "difficulty": "5.3",
    "scenario_theme": "SHOPPING",
    "distractor_strategies": [
      "REVERSED_COMPARISON",
      "WRONG_SELECTION",
      "CALCULATION_ERROR"
    ],
    "generation_time_ms": 1,
    "api_version": "2.0",
    "enhancement_status": "full",
    "format_requested": "COMPARISON",
    "format_used": "COMPARISON",
    "features_active": [
      "enhanced_distractors",
      "rich_scenarios",
      "cognitive_load",
      "advanced_formats"
    ],
    "features_pending": []
  },
  "context": {
    "id": "shop-001-bookfair",
    "theme": "SHOPPING",
    "setting": {
      "location": "school book fair",
      "timeContext": "lunch break",
      "atmosphere": "busy"
    },
    "characters": [
      {
        "name": "Sarah",
        "role": "student"
      },
      {
        "name": "Mr. Johnson",
        "role": "teacher"
      }
    ],
    "items": [
      {
        "name": "book",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 3,
          "max": 12,
          "typical": 6.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "bookmark",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.5,
          "max": 2,
          "typical": 1,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      }
    ],
    "culturalElements": [
      {
        "type": "currency",
        "value": "£",
        "explanation": "British pounds"
      },
      {
        "type": "event",
        "value": "book fair",
        "explanation": "School fundraising event"
      }
    ],
    "realWorldConnection": "School fundraising and reading promotion",
    "yearAppropriate": [
      2,
      3,
      4,
      5
    ],
    "templates": [
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "COMPARISON"
        ],
        "template": "{character} wants to buy books at the book fair. Calculate the total cost.",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      }
    ]
  }
}
# Test C.3: ESTIMATION format
{
  "success": true,
  "question": {
    "text": "Sarah is adding £80.00 + £796.00 + £954.00 + £176.00. Round the result to the nearest hundreds.",
    "options": [
      {
        "text": "2010",
        "value": 2010,
        "index": 0
      },
      {
        "text": "£2000.00",
        "value": 2000,
        "index": 1
      },
      {
        "text": "2100",
        "value": 2100,
        "index": 2
      },
      {
        "text": "2000",
        "value": 2000,
        "index": 3
      }
    ],
    "correctIndex": 1,
    "questionContent": {
      "fullText": "Sarah is adding £80.00 + £796.00 + £954.00 + £176.00. Round the result to the nearest hundreds.",
      "templateData": {
        "character": "Sarah",
        "operation": "is adding £80.00 + £796.00 + £954.00 + £176.00",
        "roundingPlace": "hundreds",
        "exactValue": "2006",
        "roundedValue": "2000"
      }
    },
    "format": "ESTIMATION",
    "difficulty": {
      "year": 5,
      "subLevel": 3,
      "displayName": "5.3",
      "cognitiveLoad": 60
    },
    "cognitiveLoad": 60,
    "curriculumTags": [
      "5N1a",
      "5N1b"
    ],
    "scenario": {
      "id": "shop-001-bookfair",
      "theme": "SHOPPING",
      "setting": {
        "location": "school book fair",
        "timeContext": "lunch break",
        "atmosphere": "busy"
      },
      "characters": [
        {
          "name": "Sarah",
          "role": "student"
        },
        {
          "name": "Mr. Johnson",
          "role": "teacher"
        }
      ],
      "items": [
        {
          "name": "book",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 3,
            "max": 12,
            "typical": 6.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "bookmark",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.5,
            "max": 2,
            "typical": 1,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        }
      ],
      "culturalElements": [
        {
          "type": "currency",
          "value": "£",
          "explanation": "British pounds"
        },
        {
          "type": "event",
          "value": "book fair",
          "explanation": "School fundraising event"
        }
      ],
      "realWorldConnection": "School fundraising and reading promotion",
      "yearAppropriate": [
        2,
        3,
        4,
        5
      ],
      "templates": [
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "COMPARISON"
          ],
          "template": "{character} wants to buy books at the book fair. Calculate the total cost.",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        }
      ]
    },
    "distractors": [
      {
        "value": 2010,
        "strategy": "WRONG_OPERATION",
        "rationale": "Rounded to wrong place value"
      },
      {
        "value": 2000,
        "rationale": "Truncated instead of rounded"
      },
      {
        "value": 2100,
        "rationale": "Always rounded up"
      }
    ],
    "enhancementStatus": {
      "level": "full",
      "requestedFormat": "ESTIMATION",
      "actualFormat": "ESTIMATION",
      "featuresActive": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "featuresPending": [],
      "isFullyEnhanced": true
    },
    "mathOutput": {
      "operation": "ADDITION",
      "operands": [
        80,
        796,
        954,
        176
      ],
      "result": 2006,
      "intermediate_steps": [
        80,
        876,
        1830
      ],
      "decimal_formatted": {
        "operands": [
          "80",
          "796",
          "954",
          "176"
        ],
        "result": "2006"
      },
      "exactValue": 2006,
      "roundedValue": 2000
    },
    "generationTime": 0,
    "questionId": "q_1759079328358_d4o62sb4a",
    "generationSetup": {
      "controller_used": "ESTIMATIONController",
      "format_requested": "ESTIMATION",
      "format_actual": "ESTIMATION",
      "scenario_theme": "SHOPPING",
      "scenario_id": "shop-001-bookfair",
      "scenario_selection_method": "default",
      "distractor_strategies": [
        "WRONG_OPERATION",
        null,
        null
      ],
      "distractor_count": 3,
      "theme_variety": false,
      "format_variety": false,
      "enhancement_level": "full",
      "features_active": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "features_pending": [],
      "generation_time_ms": 0
    }
  },
  "metadata": {
    "format": "ESTIMATION",
    "cognitive_load": 60,
    "curriculum_alignment": [
      "5N1a",
      "5N1b"
    ],
    "difficulty": "5.3",
    "scenario_theme": "SHOPPING",
    "distractor_strategies": [
      "WRONG_OPERATION",
      null,
      null
    ],
    "generation_time_ms": 0,
    "api_version": "2.0",
    "enhancement_status": "full",
    "format_requested": "ESTIMATION",
    "format_used": "ESTIMATION",
    "features_active": [
      "enhanced_distractors",
      "rich_scenarios",
      "cognitive_load",
      "advanced_formats"
    ],
    "features_pending": []
  },
  "context": {
    "id": "shop-001-bookfair",
    "theme": "SHOPPING",
    "setting": {
      "location": "school book fair",
      "timeContext": "lunch break",
      "atmosphere": "busy"
    },
    "characters": [
      {
        "name": "Sarah",
        "role": "student"
      },
      {
        "name": "Mr. Johnson",
        "role": "teacher"
      }
    ],
    "items": [
      {
        "name": "book",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 3,
          "max": 12,
          "typical": 6.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "bookmark",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.5,
          "max": 2,
          "typical": 1,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      }
    ],
    "culturalElements": [
      {
        "type": "currency",
        "value": "£",
        "explanation": "British pounds"
      },
      {
        "type": "event",
        "value": "book fair",
        "explanation": "School fundraising event"
      }
    ],
    "realWorldConnection": "School fundraising and reading promotion",
    "yearAppropriate": [
      2,
      3,
      4,
      5
    ],
    "templates": [
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "COMPARISON"
        ],
        "template": "{character} wants to buy books at the book fair. Calculate the total cost.",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      }
    ]
  }
}
# Test C.4: ORDERING format
{
  "success": true,
  "question": {
    "text": "Charlotte is comparing prices: 132, 761.2, 544, 631.2, 452, 322 pence. Arrange these prices from smallest to largest.",
    "options": [
      {
        "value": null,
        "text": "NaNp",
        "isCorrect": true
      },
      {
        "value": null,
        "text": "NaNp",
        "isCorrect": false
      },
      {
        "value": null,
        "text": "NaNp",
        "isCorrect": false
      },
      {
        "value": null,
        "text": "NaNp",
        "isCorrect": false
      }
    ],
    "correctIndex": 1,
    "questionContent": {
      "fullText": "Charlotte is comparing prices: 132, 761.2, 544, 631.2, 452, 322 pence. Arrange these prices from smallest to largest."
    },
    "format": "ORDERING",
    "difficulty": {
      "year": 5,
      "subLevel": 3,
      "displayName": "5.3",
      "cognitiveLoad": 60
    },
    "cognitiveLoad": 60,
    "curriculumTags": [
      "5N1a",
      "5N1b"
    ],
    "scenario": {
      "id": "shop-002-realistic-general",
      "theme": "SHOPPING",
      "setting": {
        "location": "local shop",
        "timeContext": "after school",
        "atmosphere": "friendly"
      },
      "characters": [
        {
          "name": "Charlotte",
          "role": "student"
        }
      ],
      "items": [
        {
          "name": "apple",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.2,
            "max": 0.5,
            "typical": 0.35,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "banana",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.15,
            "max": 0.4,
            "typical": 0.25,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "sandwich",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 2.5,
            "max": 6,
            "typical": 4,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "drink",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.8,
            "max": 2.5,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "cake",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 1.5,
            "max": 4,
            "typical": 2.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "biscuit",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.8,
            "max": 2,
            "typical": 1.2,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "sweet",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.1,
            "max": 1,
            "typical": 0.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "chocolate",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.6,
            "max": 3,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "pen",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.5,
            "max": 2,
            "typical": 1,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "pencil",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.2,
            "max": 1,
            "typical": 0.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "ruler",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.8,
            "max": 2.5,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "notebook",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 1,
            "max": 4,
            "typical": 2,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "eraser",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.3,
            "max": 1.5,
            "typical": 0.75,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "book",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 3,
            "max": 15,
            "typical": 8,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "comic",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 2,
            "max": 5,
            "typical": 3,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "magazine",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 2.5,
            "max": 6,
            "typical": 4,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "toy",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 5,
            "max": 25,
            "typical": 12,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "game",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 8,
            "max": 60,
            "typical": 25,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "puzzle",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 5,
            "max": 20,
            "typical": 12,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "sticker",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 0.2,
            "max": 2,
            "typical": 0.8,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "badge",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 0.5,
            "max": 3,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "poster",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 2,
            "max": 8,
            "typical": 4,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "card",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 0.5,
            "max": 4,
            "typical": 2,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        }
      ],
      "culturalElements": [
        {
          "type": "currency",
          "value": "£",
          "explanation": "British pounds"
        },
        {
          "type": "location",
          "value": "UK local shop",
          "explanation": "Typical British corner shop"
        }
      ],
      "realWorldConnection": "Everyday shopping with realistic UK prices",
      "yearAppropriate": [
        1,
        2,
        3,
        4,
        5,
        6
      ],
      "templates": [
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "MULTI_STEP"
          ],
          "modelCompatibility": [
            "ADDITION"
          ],
          "operandCount": 3,
          "template": "{character} buys a {item1} for {price1}, a {item2} for {price2}, and a {item3} for {price3}. What is the total cost?",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item1",
              "type": "item"
            },
            {
              "key": "item2",
              "type": "item"
            },
            {
              "key": "item3",
              "type": "item"
            },
            {
              "key": "price1",
              "type": "value"
            },
            {
              "key": "price2",
              "type": "value"
            },
            {
              "key": "price3",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "MULTI_STEP"
          ],
          "modelCompatibility": [
            "ADDITION"
          ],
          "operandCount": 2,
          "template": "{character} buys a {item1} for {price1} and a {item2} for {price2}. What is the total cost?",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item1",
              "type": "item"
            },
            {
              "key": "item2",
              "type": "item"
            },
            {
              "key": "price1",
              "type": "value"
            },
            {
              "key": "price2",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION"
          ],
          "modelCompatibility": [
            "SUBTRACTION",
            "CHANGE_CALCULATION"
          ],
          "template": "{character} buys a {item} for {price} and pays with {payment}. How much change does {character} get?",
          "answerTemplate": "{character} receives {result} in change",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "price",
              "type": "value"
            },
            {
              "key": "payment",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION"
          ],
          "modelCompatibility": [
            "MULTIPLICATION"
          ],
          "template": "{character} buys {quantity} {item} at {price} each. What is the total cost?",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "quantity",
              "type": "value"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "price",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION"
          ],
          "modelCompatibility": [
            "DIVISION"
          ],
          "template": "{character} has {total} to spend equally on {quantity} {item}. How much can {character} spend on each one?",
          "answerTemplate": "{character} can spend {result} on each {item}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "total",
              "type": "value"
            },
            {
              "key": "quantity",
              "type": "value"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "COMPARISON",
            "ESTIMATION",
            "MULTI_STEP"
          ],
          "template": "{character} goes to the shop and buys {items}. How much does {character} spend in total?",
          "answerTemplate": "{character} spends {result} in total",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "items",
              "type": "item_list"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "ESTIMATION"
          ],
          "template": "Estimate: If {character} buys {items}, about how much will it cost?",
          "answerTemplate": "It will cost approximately {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "items",
              "type": "item_list"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "VALIDATION"
          ],
          "template": "{character} calculated that {items} costs {amount}. Is this correct?",
          "answerTemplate": "{validation_result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "items",
              "type": "item_list"
            },
            {
              "key": "amount",
              "type": "value"
            },
            {
              "key": "validation_result",
              "type": "boolean"
            }
          ]
        }
      ]
    },
    "distractors": [
      {
        "value": [
          761.2,
          631.2,
          544,
          452,
          322,
          132
        ],
        "rationale": "Ordered in opposite direction"
      },
      {
        "value": [
          132,
          322,
          452,
          544,
          761.2,
          631.2
        ],
        "rationale": "Partially correct ordering"
      },
      {
        "value": [
          132,
          761.2,
          544,
          631.2,
          452,
          322
        ],
        "rationale": "Original unsorted order"
      }
    ],
    "enhancementStatus": {
      "level": "full",
      "requestedFormat": "ORDERING",
      "actualFormat": "ORDERING",
      "featuresActive": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "featuresPending": [],
      "isFullyEnhanced": true
    },
    "mathOutput": {
      "operation": "ADDITION",
      "operands": [
        221,
        219,
        546,
        374
      ],
      "result": 1360,
      "intermediate_steps": [
        221,
        440,
        986
      ],
      "decimal_formatted": {
        "operands": [
          "221",
          "219",
          "546",
          "374"
        ],
        "result": "1360"
      }
    },
    "generationTime": 1,
    "questionId": "q_1759079328462_iunca77zx",
    "generationSetup": {
      "controller_used": "ORDERINGController",
      "format_requested": "ORDERING",
      "format_actual": "ORDERING",
      "scenario_theme": "SHOPPING",
      "scenario_id": "shop-002-realistic-general",
      "scenario_selection_method": "default",
      "distractor_strategies": [
        null,
        null,
        null
      ],
      "distractor_count": 3,
      "theme_variety": false,
      "format_variety": false,
      "enhancement_level": "full",
      "features_active": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "features_pending": [],
      "generation_time_ms": 1
    }
  },
  "metadata": {
    "format": "ORDERING",
    "cognitive_load": 60,
    "curriculum_alignment": [
      "5N1a",
      "5N1b"
    ],
    "difficulty": "5.3",
    "scenario_theme": "SHOPPING",
    "distractor_strategies": [
      null,
      null,
      null
    ],
    "generation_time_ms": 2,
    "api_version": "2.0",
    "enhancement_status": "full",
    "format_requested": "ORDERING",
    "format_used": "ORDERING",
    "features_active": [
      "enhanced_distractors",
      "rich_scenarios",
      "cognitive_load",
      "advanced_formats"
    ],
    "features_pending": []
  },
  "context": {
    "id": "shop-002-realistic-general",
    "theme": "SHOPPING",
    "setting": {
      "location": "local shop",
      "timeContext": "after school",
      "atmosphere": "friendly"
    },
    "characters": [
      {
        "name": "Charlotte",
        "role": "student"
      }
    ],
    "items": [
      {
        "name": "apple",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.2,
          "max": 0.5,
          "typical": 0.35,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "banana",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.15,
          "max": 0.4,
          "typical": 0.25,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "sandwich",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 2.5,
          "max": 6,
          "typical": 4,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "drink",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.8,
          "max": 2.5,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "cake",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 1.5,
          "max": 4,
          "typical": 2.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "biscuit",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.8,
          "max": 2,
          "typical": 1.2,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "sweet",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.1,
          "max": 1,
          "typical": 0.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "chocolate",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.6,
          "max": 3,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "pen",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.5,
          "max": 2,
          "typical": 1,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "pencil",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.2,
          "max": 1,
          "typical": 0.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "ruler",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.8,
          "max": 2.5,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "notebook",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 1,
          "max": 4,
          "typical": 2,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "eraser",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.3,
          "max": 1.5,
          "typical": 0.75,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "book",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 3,
          "max": 15,
          "typical": 8,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "comic",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 2,
          "max": 5,
          "typical": 3,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "magazine",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 2.5,
          "max": 6,
          "typical": 4,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "toy",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 5,
          "max": 25,
          "typical": 12,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "game",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 8,
          "max": 60,
          "typical": 25,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "puzzle",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 5,
          "max": 20,
          "typical": 12,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "sticker",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 0.2,
          "max": 2,
          "typical": 0.8,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "badge",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 0.5,
          "max": 3,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "poster",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 2,
          "max": 8,
          "typical": 4,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "card",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 0.5,
          "max": 4,
          "typical": 2,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      }
    ],
    "culturalElements": [
      {
        "type": "currency",
        "value": "£",
        "explanation": "British pounds"
      },
      {
        "type": "location",
        "value": "UK local shop",
        "explanation": "Typical British corner shop"
      }
    ],
    "realWorldConnection": "Everyday shopping with realistic UK prices",
    "yearAppropriate": [
      1,
      2,
      3,
      4,
      5,
      6
    ],
    "templates": [
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "MULTI_STEP"
        ],
        "modelCompatibility": [
          "ADDITION"
        ],
        "operandCount": 3,
        "template": "{character} buys a {item1} for {price1}, a {item2} for {price2}, and a {item3} for {price3}. What is the total cost?",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item1",
            "type": "item"
          },
          {
            "key": "item2",
            "type": "item"
          },
          {
            "key": "item3",
            "type": "item"
          },
          {
            "key": "price1",
            "type": "value"
          },
          {
            "key": "price2",
            "type": "value"
          },
          {
            "key": "price3",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "MULTI_STEP"
        ],
        "modelCompatibility": [
          "ADDITION"
        ],
        "operandCount": 2,
        "template": "{character} buys a {item1} for {price1} and a {item2} for {price2}. What is the total cost?",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item1",
            "type": "item"
          },
          {
            "key": "item2",
            "type": "item"
          },
          {
            "key": "price1",
            "type": "value"
          },
          {
            "key": "price2",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION"
        ],
        "modelCompatibility": [
          "SUBTRACTION",
          "CHANGE_CALCULATION"
        ],
        "template": "{character} buys a {item} for {price} and pays with {payment}. How much change does {character} get?",
        "answerTemplate": "{character} receives {result} in change",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "price",
            "type": "value"
          },
          {
            "key": "payment",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION"
        ],
        "modelCompatibility": [
          "MULTIPLICATION"
        ],
        "template": "{character} buys {quantity} {item} at {price} each. What is the total cost?",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "quantity",
            "type": "value"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "price",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION"
        ],
        "modelCompatibility": [
          "DIVISION"
        ],
        "template": "{character} has {total} to spend equally on {quantity} {item}. How much can {character} spend on each one?",
        "answerTemplate": "{character} can spend {result} on each {item}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "total",
            "type": "value"
          },
          {
            "key": "quantity",
            "type": "value"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "COMPARISON",
          "ESTIMATION",
          "MULTI_STEP"
        ],
        "template": "{character} goes to the shop and buys {items}. How much does {character} spend in total?",
        "answerTemplate": "{character} spends {result} in total",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "items",
            "type": "item_list"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "ESTIMATION"
        ],
        "template": "Estimate: If {character} buys {items}, about how much will it cost?",
        "answerTemplate": "It will cost approximately {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "items",
            "type": "item_list"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "VALIDATION"
        ],
        "template": "{character} calculated that {items} costs {amount}. Is this correct?",
        "answerTemplate": "{validation_result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "items",
            "type": "item_list"
          },
          {
            "key": "amount",
            "type": "value"
          },
          {
            "key": "validation_result",
            "type": "boolean"
          }
        ]
      }
    ]
  }
}
# Test C.5: VALIDATION format
{
  "success": true,
  "question": {
    "text": "Sarah made an error in their calculation:\\nStep 1: 102 + 528 + 444 + 539\\nStep 2: = -426\\n\\nWhich step contains the error?",
    "options": [
      {
        "value": null,
        "text": "NaNp",
        "isCorrect": true
      },
      {
        "value": null,
        "text": "NaNp",
        "isCorrect": false
      }
    ],
    "correctIndex": 0,
    "questionContent": {
      "fullText": "Sarah made an error in their calculation:\\nStep 1: 102 + 528 + 444 + 539\\nStep 2: = -426\\n\\nWhich step contains the error?"
    },
    "format": "VALIDATION",
    "difficulty": {
      "year": 5,
      "subLevel": 3,
      "displayName": "5.3",
      "cognitiveLoad": 60
    },
    "cognitiveLoad": 60,
    "curriculumTags": [
      "5N1a",
      "5N1b"
    ],
    "scenario": {
      "id": "shop-001-bookfair",
      "theme": "SHOPPING",
      "setting": {
        "location": "school book fair",
        "timeContext": "lunch break",
        "atmosphere": "busy"
      },
      "characters": [
        {
          "name": "Sarah",
          "role": "student"
        },
        {
          "name": "Mr. Johnson",
          "role": "teacher"
        }
      ],
      "items": [
        {
          "name": "book",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 3,
            "max": 12,
            "typical": 6.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "bookmark",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.5,
            "max": 2,
            "typical": 1,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        }
      ],
      "culturalElements": [
        {
          "type": "currency",
          "value": "£",
          "explanation": "British pounds"
        },
        {
          "type": "event",
          "value": "book fair",
          "explanation": "School fundraising event"
        }
      ],
      "realWorldConnection": "School fundraising and reading promotion",
      "yearAppropriate": [
        2,
        3,
        4,
        5
      ],
      "templates": [
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "COMPARISON"
          ],
          "template": "{character} wants to buy books at the book fair. Calculate the total cost.",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        }
      ]
    },
    "distractors": [
      {
        "value": "Step 1",
        "rationale": "Incorrectly identified step 1 as containing the error"
      }
    ],
    "enhancementStatus": {
      "level": "full",
      "requestedFormat": "VALIDATION",
      "actualFormat": "VALIDATION",
      "featuresActive": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "featuresPending": [],
      "isFullyEnhanced": true
    },
    "mathOutput": {
      "operation": "ADDITION",
      "operands": [
        102,
        528,
        444,
        539
      ],
      "result": 1613,
      "intermediate_steps": [
        102,
        630,
        1074
      ],
      "decimal_formatted": {
        "operands": [
          "102",
          "528",
          "444",
          "539"
        ],
        "result": "1613"
      }
    },
    "generationTime": 1,
    "questionId": "q_1759079328571_xhzwjya6v",
    "generationSetup": {
      "controller_used": "VALIDATIONController",
      "format_requested": "VALIDATION",
      "format_actual": "VALIDATION",
      "scenario_theme": "SHOPPING",
      "scenario_id": "shop-001-bookfair",
      "scenario_selection_method": "default",
      "distractor_strategies": [
        null
      ],
      "distractor_count": 1,
      "theme_variety": false,
      "format_variety": false,
      "enhancement_level": "full",
      "features_active": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "features_pending": [],
      "generation_time_ms": 1
    }
  },
  "metadata": {
    "format": "VALIDATION",
    "cognitive_load": 60,
    "curriculum_alignment": [
      "5N1a",
      "5N1b"
    ],
    "difficulty": "5.3",
    "scenario_theme": "SHOPPING",
    "distractor_strategies": [
      null
    ],
    "generation_time_ms": 1,
    "api_version": "2.0",
    "enhancement_status": "full",
    "format_requested": "VALIDATION",
    "format_used": "VALIDATION",
    "features_active": [
      "enhanced_distractors",
      "rich_scenarios",
      "cognitive_load",
      "advanced_formats"
    ],
    "features_pending": []
  },
  "context": {
    "id": "shop-001-bookfair",
    "theme": "SHOPPING",
    "setting": {
      "location": "school book fair",
      "timeContext": "lunch break",
      "atmosphere": "busy"
    },
    "characters": [
      {
        "name": "Sarah",
        "role": "student"
      },
      {
        "name": "Mr. Johnson",
        "role": "teacher"
      }
    ],
    "items": [
      {
        "name": "book",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 3,
          "max": 12,
          "typical": 6.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "bookmark",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.5,
          "max": 2,
          "typical": 1,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      }
    ],
    "culturalElements": [
      {
        "type": "currency",
        "value": "£",
        "explanation": "British pounds"
      },
      {
        "type": "event",
        "value": "book fair",
        "explanation": "School fundraising event"
      }
    ],
    "realWorldConnection": "School fundraising and reading promotion",
    "yearAppropriate": [
      2,
      3,
      4,
      5
    ],
    "templates": [
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "COMPARISON"
        ],
        "template": "{character} wants to buy books at the book fair. Calculate the total cost.",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      }
    ]
  }
}
# Test C.6: MULTI_STEP format
{
  "success": true,
  "question": {
    "text": "Sarah is shopping and needs to make several calculations. First, Sarah adds the cost of 432p and 375p items. Next, Sarah gets a 5p discount. Next, Sarah gets a 11p discount. Then Sarah adds 144p more to the total. What is the final result?",
    "options": [
      {
        "text": "£935.00",
        "value": 935,
        "index": 0
      },
      {
        "text": "807",
        "value": 807,
        "index": 1
      },
      {
        "text": "935",
        "value": 935,
        "index": 2
      },
      {
        "text": "951",
        "value": 951,
        "index": 3
      }
    ],
    "correctIndex": 0,
    "questionContent": {
      "fullText": "Sarah is shopping and needs to make several calculations. First, Sarah adds the cost of 432p and 375p items. Next, Sarah gets a 5p discount. Next, Sarah gets a 11p discount. Then Sarah adds 144p more to the total. What is the final result?",
      "components": {
        "narrative": "Sarah needs to solve this step by step:",
        "steps": [
          {
            "stepNumber": 1,
            "text": "Add 432 and 375",
            "operation": "ADDITION",
            "values": [
              432,
              375
            ],
            "result": 807,
            "description": "Add 432 and 375"
          },
          {
            "stepNumber": 2,
            "text": "Subtract 5 from 807",
            "operation": "SUBTRACTION",
            "values": [
              807,
              5
            ],
            "result": 802,
            "description": "Subtract 5 from 807"
          },
          {
            "stepNumber": 3,
            "text": "Subtract 11 from 802",
            "operation": "SUBTRACTION",
            "values": [
              802,
              11
            ],
            "result": 791,
            "description": "Subtract 11 from 802"
          },
          {
            "stepNumber": 4,
            "text": "Add 144 to 791",
            "operation": "ADDITION",
            "values": [
              791,
              144
            ],
            "result": 935,
            "description": "Add 144 to 791"
          }
        ],
        "prompt": "What is the final result?",
        "highlightValues": [
          432,
          375,
          807,
          807,
          5,
          802,
          802,
          11,
          791,
          791,
          144,
          935
        ],
        "operators": [
          "+",
          "-"
        ]
      },
      "templateData": {
        "character": "Sarah",
        "context": "school book fair",
        "theme": "SHOPPING",
        "quantities": [
          432,
          807,
          802,
          791
        ],
        "prices": [
          375,
          5,
          11,
          144
        ],
        "action": "calculating step by step"
      }
    },
    "format": "MULTI_STEP",
    "difficulty": {
      "year": 5,
      "subLevel": 3,
      "displayName": "5.3",
      "cognitiveLoad": 60
    },
    "cognitiveLoad": 60,
    "curriculumTags": [
      "5N1a",
      "5N1b"
    ],
    "scenario": {
      "id": "shop-001-bookfair",
      "theme": "SHOPPING",
      "setting": {
        "location": "school book fair",
        "timeContext": "lunch break",
        "atmosphere": "busy"
      },
      "characters": [
        {
          "name": "Sarah",
          "role": "student"
        },
        {
          "name": "Mr. Johnson",
          "role": "teacher"
        }
      ],
      "items": [
        {
          "name": "book",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 3,
            "max": 12,
            "typical": 6.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "bookmark",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.5,
            "max": 2,
            "typical": 1,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        }
      ],
      "culturalElements": [
        {
          "type": "currency",
          "value": "£",
          "explanation": "British pounds"
        },
        {
          "type": "event",
          "value": "book fair",
          "explanation": "School fundraising event"
        }
      ],
      "realWorldConnection": "School fundraising and reading promotion",
      "yearAppropriate": [
        2,
        3,
        4,
        5
      ],
      "templates": [
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "COMPARISON"
          ],
          "template": "{character} wants to buy books at the book fair. Calculate the total cost.",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        }
      ]
    },
    "distractors": [
      {
        "value": 807,
        "rationale": "Stopped after first step"
      },
      {
        "value": 935,
        "strategy": "WRONG_OPERATION",
        "rationale": "Used wrong operation in step 1"
      },
      {
        "value": 951,
        "rationale": "Performed operations in wrong order"
      }
    ],
    "enhancementStatus": {
      "level": "full",
      "requestedFormat": "MULTI_STEP",
      "actualFormat": "MULTI_STEP",
      "featuresActive": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "featuresPending": [],
      "isFullyEnhanced": true
    },
    "mathOutput": {
      "operation": "ADDITION",
      "operands": [
        209,
        132,
        290,
        749
      ],
      "result": 1380,
      "intermediate_steps": [
        209,
        341,
        631
      ],
      "decimal_formatted": {
        "operands": [
          "209",
          "132",
          "290",
          "749"
        ],
        "result": "1380"
      }
    },
    "generationTime": 2,
    "questionId": "q_1759079328722_vs16rjwbk",
    "generationSetup": {
      "controller_used": "MULTI_STEPController",
      "format_requested": "MULTI_STEP",
      "format_actual": "MULTI_STEP",
      "scenario_theme": "SHOPPING",
      "scenario_id": "shop-001-bookfair",
      "scenario_selection_method": "default",
      "distractor_strategies": [
        null,
        "WRONG_OPERATION",
        null
      ],
      "distractor_count": 3,
      "theme_variety": false,
      "format_variety": false,
      "enhancement_level": "full",
      "features_active": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "features_pending": [],
      "generation_time_ms": 2
    }
  },
  "metadata": {
    "format": "MULTI_STEP",
    "cognitive_load": 60,
    "curriculum_alignment": [
      "5N1a",
      "5N1b"
    ],
    "difficulty": "5.3",
    "scenario_theme": "SHOPPING",
    "distractor_strategies": [
      null,
      "WRONG_OPERATION",
      null
    ],
    "generation_time_ms": 2,
    "api_version": "2.0",
    "enhancement_status": "full",
    "format_requested": "MULTI_STEP",
    "format_used": "MULTI_STEP",
    "features_active": [
      "enhanced_distractors",
      "rich_scenarios",
      "cognitive_load",
      "advanced_formats"
    ],
    "features_pending": []
  },
  "context": {
    "id": "shop-001-bookfair",
    "theme": "SHOPPING",
    "setting": {
      "location": "school book fair",
      "timeContext": "lunch break",
      "atmosphere": "busy"
    },
    "characters": [
      {
        "name": "Sarah",
        "role": "student"
      },
      {
        "name": "Mr. Johnson",
        "role": "teacher"
      }
    ],
    "items": [
      {
        "name": "book",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 3,
          "max": 12,
          "typical": 6.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "bookmark",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.5,
          "max": 2,
          "typical": 1,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      }
    ],
    "culturalElements": [
      {
        "type": "currency",
        "value": "£",
        "explanation": "British pounds"
      },
      {
        "type": "event",
        "value": "book fair",
        "explanation": "School fundraising event"
      }
    ],
    "realWorldConnection": "School fundraising and reading promotion",
    "yearAppropriate": [
      2,
      3,
      4,
      5
    ],
    "templates": [
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "COMPARISON"
        ],
        "template": "{character} wants to buy books at the book fair. Calculate the total cost.",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      }
    ]
  }
}
# Test C.7: MISSING_VALUE format
{
  "error": "Failed to generate enhanced question",
  "details": "Cannot read properties of undefined (reading 'correctAnswer')",
  "api_version": "2.0"
}
# Test C.8: PATTERN_RECOGNITION format
{
  "success": true,
  "question": {
    "text": "Sarah needs to find the missing number in this pattern: 9, 10, 13, 18, 25, 34, ?",
    "options": [
      {
        "text": "44",
        "value": 44,
        "index": 0
      },
      {
        "text": "50",
        "value": 50,
        "index": 1
      },
      {
        "text": "45",
        "value": 45,
        "index": 2
      },
      {
        "text": "640",
        "value": 640,
        "index": 3
      }
    ],
    "correctIndex": 2,
    "questionContent": {
      "fullText": "Sarah needs to find the missing number in this pattern: 9, 10, 13, 18, 25, 34, ?"
    },
    "format": "PATTERN_RECOGNITION",
    "difficulty": {
      "year": 5,
      "subLevel": 3,
      "displayName": "5.3",
      "cognitiveLoad": 60
    },
    "cognitiveLoad": 60,
    "curriculumTags": [
      "5N1a",
      "5N1b"
    ],
    "scenario": {
      "id": "shop-001-bookfair",
      "theme": "SHOPPING",
      "setting": {
        "location": "school book fair",
        "timeContext": "lunch break",
        "atmosphere": "busy"
      },
      "characters": [
        {
          "name": "Sarah",
          "role": "student"
        },
        {
          "name": "Mr. Johnson",
          "role": "teacher"
        }
      ],
      "items": [
        {
          "name": "book",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 3,
            "max": 12,
            "typical": 6.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "bookmark",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.5,
            "max": 2,
            "typical": 1,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        }
      ],
      "culturalElements": [
        {
          "type": "currency",
          "value": "£",
          "explanation": "British pounds"
        },
        {
          "type": "event",
          "value": "book fair",
          "explanation": "School fundraising event"
        }
      ],
      "realWorldConnection": "School fundraising and reading promotion",
      "yearAppropriate": [
        2,
        3,
        4,
        5
      ],
      "templates": [
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "COMPARISON"
          ],
          "template": "{character} wants to buy books at the book fair. Calculate the total cost.",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        }
      ]
    },
    "distractors": [
      {
        "value": 50,
        "strategy": "WRONG_OPERATION",
        "rationale": "Used wrong operation for pattern"
      },
      {
        "value": 640,
        "rationale": "Started pattern from wrong position"
      },
      {
        "value": 44,
        "strategy": "CALCULATION_ERROR",
        "rationale": "Off by one error"
      }
    ],
    "enhancementStatus": {
      "level": "full",
      "requestedFormat": "PATTERN_RECOGNITION",
      "actualFormat": "PATTERN_RECOGNITION",
      "featuresActive": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "featuresPending": [],
      "isFullyEnhanced": true
    },
    "mathOutput": {
      "operation": "ADDITION",
      "operands": [
        67,
        771,
        760,
        115
      ],
      "result": 1713,
      "intermediate_steps": [
        67,
        838,
        1598
      ],
      "decimal_formatted": {
        "operands": [
          "67",
          "771",
          "760",
          "115"
        ],
        "result": "1713"
      }
    },
    "generationTime": 0,
    "questionId": "q_1759079329107_ne7t9498p",
    "generationSetup": {
      "controller_used": "PATTERN_RECOGNITIONController",
      "format_requested": "PATTERN_RECOGNITION",
      "format_actual": "PATTERN_RECOGNITION",
      "scenario_theme": "SHOPPING",
      "scenario_id": "shop-001-bookfair",
      "scenario_selection_method": "default",
      "distractor_strategies": [
        "WRONG_OPERATION",
        null,
        "CALCULATION_ERROR"
      ],
      "distractor_count": 3,
      "theme_variety": false,
      "format_variety": false,
      "enhancement_level": "full",
      "features_active": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "features_pending": [],
      "generation_time_ms": 0
    }
  },
  "metadata": {
    "format": "PATTERN_RECOGNITION",
    "cognitive_load": 60,
    "curriculum_alignment": [
      "5N1a",
      "5N1b"
    ],
    "difficulty": "5.3",
    "scenario_theme": "SHOPPING",
    "distractor_strategies": [
      "WRONG_OPERATION",
      null,
      "CALCULATION_ERROR"
    ],
    "generation_time_ms": 0,
    "api_version": "2.0",
    "enhancement_status": "full",
    "format_requested": "PATTERN_RECOGNITION",
    "format_used": "PATTERN_RECOGNITION",
    "features_active": [
      "enhanced_distractors",
      "rich_scenarios",
      "cognitive_load",
      "advanced_formats"
    ],
    "features_pending": []
  },
  "context": {
    "id": "shop-001-bookfair",
    "theme": "SHOPPING",
    "setting": {
      "location": "school book fair",
      "timeContext": "lunch break",
      "atmosphere": "busy"
    },
    "characters": [
      {
        "name": "Sarah",
        "role": "student"
      },
      {
        "name": "Mr. Johnson",
        "role": "teacher"
      }
    ],
    "items": [
      {
        "name": "book",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 3,
          "max": 12,
          "typical": 6.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "bookmark",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.5,
          "max": 2,
          "typical": 1,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      }
    ],
    "culturalElements": [
      {
        "type": "currency",
        "value": "£",
        "explanation": "British pounds"
      },
      {
        "type": "event",
        "value": "book fair",
        "explanation": "School fundraising event"
      }
    ],
    "realWorldConnection": "School fundraising and reading promotion",
    "yearAppropriate": [
      2,
      3,
      4,
      5
    ],
    "templates": [
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "COMPARISON"
        ],
        "template": "{character} wants to buy books at the book fair. Calculate the total cost.",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      }
    ]
  }
}

--- SUITE D: DIFFICULTY PROGRESSION TESTS ---
Testing smooth difficulty increase for the MULTIPLICATION model...
# Test D.1: MULTIPLICATION at difficulty 2.1
{
  "success": true,
  "question": {
    "text": "Sarah wants to buy books at the book fair. Calculate the total cost.",
    "options": [
      {
        "text": "£8.32",
        "value": 8.32,
        "index": 0
      },
      {
        "text": "7.32",
        "value": 7.32,
        "index": 1
      },
      {
        "text": "2",
        "value": 2,
        "index": 2
      },
      {
        "text": "4",
        "value": 4,
        "index": 3
      }
    ],
    "correctIndex": 0,
    "format": "DIRECT_CALCULATION",
    "difficulty": {
      "year": 2,
      "subLevel": 1,
      "displayName": "2.1",
      "cognitiveLoad": 20
    },
    "cognitiveLoad": 20,
    "curriculumTags": [
      "2N1a"
    ],
    "scenario": {
      "id": "shop-001-bookfair",
      "theme": "SHOPPING",
      "setting": {
        "location": "school book fair",
        "timeContext": "lunch break",
        "atmosphere": "busy"
      },
      "characters": [
        {
          "name": "Sarah",
          "role": "student"
        },
        {
          "name": "Mr. Johnson",
          "role": "teacher"
        }
      ],
      "items": [
        {
          "name": "book",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 3,
            "max": 12,
            "typical": 6.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "bookmark",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.5,
            "max": 2,
            "typical": 1,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        }
      ],
      "culturalElements": [
        {
          "type": "currency",
          "value": "£",
          "explanation": "British pounds"
        },
        {
          "type": "event",
          "value": "book fair",
          "explanation": "School fundraising event"
        }
      ],
      "realWorldConnection": "School fundraising and reading promotion",
      "yearAppropriate": [
        2,
        3,
        4,
        5
      ],
      "templates": [
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "COMPARISON"
          ],
          "template": "{character} wants to buy books at the book fair. Calculate the total cost.",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        }
      ]
    },
    "distractors": [
      {
        "value": 7.32,
        "displayText": "7.32",
        "strategy": "COMMON_MISCONCEPTION",
        "reasoning": "Counting error"
      },
      {
        "value": 4,
        "displayText": "4",
        "strategy": "WRONG_OPERATION",
        "reasoning": "Added instead of multiplying"
      },
      {
        "value": 2,
        "displayText": "2",
        "strategy": "WRONG_OPERATION",
        "reasoning": "Subtracted instead of multiplying"
      }
    ],
    "enhancementStatus": {
      "level": "partial",
      "requestedFormat": "DIRECT_CALCULATION",
      "actualFormat": "DIRECT_CALCULATION",
      "featuresActive": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "featuresPending": [],
      "isFullyEnhanced": true
    },
    "mathOutput": {
      "operation": "MULTIPLICATION",
      "multiplier": 1,
      "multiplicand": 8.32,
      "result": 8.32
    },
    "generationTime": 0,
    "questionId": "q_1759079329232_h93s66x52",
    "generationSetup": {
      "controller_used": "DIRECT_CALCULATIONController",
      "format_requested": "DIRECT_CALCULATION",
      "format_actual": "DIRECT_CALCULATION",
      "scenario_theme": "SHOPPING",
      "scenario_id": "shop-001-bookfair",
      "scenario_selection_method": "default",
      "distractor_strategies": [
        "COMMON_MISCONCEPTION",
        "WRONG_OPERATION",
        "WRONG_OPERATION"
      ],
      "distractor_count": 3,
      "theme_variety": false,
      "format_variety": false,
      "enhancement_level": "partial",
      "features_active": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "features_pending": [],
      "generation_time_ms": 0
    }
  },
  "metadata": {
    "format": "DIRECT_CALCULATION",
    "cognitive_load": 20,
    "curriculum_alignment": [
      "2N1a"
    ],
    "difficulty": "2.1",
    "scenario_theme": "SHOPPING",
    "distractor_strategies": [
      "COMMON_MISCONCEPTION",
      "WRONG_OPERATION",
      "WRONG_OPERATION"
    ],
    "generation_time_ms": 0,
    "api_version": "2.0",
    "enhancement_status": "partial",
    "format_requested": "DIRECT_CALCULATION",
    "format_used": "DIRECT_CALCULATION",
    "features_active": [
      "enhanced_distractors",
      "rich_scenarios",
      "cognitive_load",
      "advanced_formats"
    ],
    "features_pending": []
  },
  "context": {
    "id": "shop-001-bookfair",
    "theme": "SHOPPING",
    "setting": {
      "location": "school book fair",
      "timeContext": "lunch break",
      "atmosphere": "busy"
    },
    "characters": [
      {
        "name": "Sarah",
        "role": "student"
      },
      {
        "name": "Mr. Johnson",
        "role": "teacher"
      }
    ],
    "items": [
      {
        "name": "book",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 3,
          "max": 12,
          "typical": 6.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "bookmark",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.5,
          "max": 2,
          "typical": 1,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      }
    ],
    "culturalElements": [
      {
        "type": "currency",
        "value": "£",
        "explanation": "British pounds"
      },
      {
        "type": "event",
        "value": "book fair",
        "explanation": "School fundraising event"
      }
    ],
    "realWorldConnection": "School fundraising and reading promotion",
    "yearAppropriate": [
      2,
      3,
      4,
      5
    ],
    "templates": [
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "COMPARISON"
        ],
        "template": "{character} wants to buy books at the book fair. Calculate the total cost.",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      }
    ]
  }
}
# Test D.2: MULTIPLICATION at difficulty 2.4
{
  "success": true,
  "question": {
    "text": "Charlotte buys 2 apple at 50p each. What is the total cost?",
    "options": [
      {
        "text": "11",
        "value": 11,
        "index": 0
      },
      {
        "text": "0",
        "value": 0,
        "index": 1
      },
      {
        "text": "7",
        "value": 7,
        "index": 2
      },
      {
        "text": "£1.00",
        "value": 1,
        "index": 3
      }
    ],
    "correctIndex": 3,
    "format": "DIRECT_CALCULATION",
    "difficulty": {
      "year": 2,
      "subLevel": 4,
      "displayName": "2.4",
      "cognitiveLoad": 35
    },
    "cognitiveLoad": 35,
    "curriculumTags": [
      "2N1a"
    ],
    "scenario": {
      "id": "shop-002-realistic-general",
      "theme": "SHOPPING",
      "setting": {
        "location": "local shop",
        "timeContext": "after school",
        "atmosphere": "friendly"
      },
      "characters": [
        {
          "name": "Charlotte",
          "role": "student"
        }
      ],
      "items": [
        {
          "name": "apple",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.2,
            "max": 0.5,
            "typical": 0.35,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "banana",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.15,
            "max": 0.4,
            "typical": 0.25,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "sandwich",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 2.5,
            "max": 6,
            "typical": 4,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "drink",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.8,
            "max": 2.5,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "cake",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 1.5,
            "max": 4,
            "typical": 2.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "biscuit",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.8,
            "max": 2,
            "typical": 1.2,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "sweet",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.1,
            "max": 1,
            "typical": 0.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "chocolate",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.6,
            "max": 3,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "pen",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.5,
            "max": 2,
            "typical": 1,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "pencil",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.2,
            "max": 1,
            "typical": 0.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "ruler",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.8,
            "max": 2.5,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "notebook",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 1,
            "max": 4,
            "typical": 2,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "eraser",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.3,
            "max": 1.5,
            "typical": 0.75,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "book",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 3,
            "max": 15,
            "typical": 8,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "comic",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 2,
            "max": 5,
            "typical": 3,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "magazine",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 2.5,
            "max": 6,
            "typical": 4,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "toy",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 5,
            "max": 25,
            "typical": 12,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "game",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 8,
            "max": 60,
            "typical": 25,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "puzzle",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 5,
            "max": 20,
            "typical": 12,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "sticker",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 0.2,
            "max": 2,
            "typical": 0.8,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "badge",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 0.5,
            "max": 3,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "poster",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 2,
            "max": 8,
            "typical": 4,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "card",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 0.5,
            "max": 4,
            "typical": 2,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        }
      ],
      "culturalElements": [
        {
          "type": "currency",
          "value": "£",
          "explanation": "British pounds"
        },
        {
          "type": "location",
          "value": "UK local shop",
          "explanation": "Typical British corner shop"
        }
      ],
      "realWorldConnection": "Everyday shopping with realistic UK prices",
      "yearAppropriate": [
        1,
        2,
        3,
        4,
        5,
        6
      ],
      "templates": [
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "MULTI_STEP"
          ],
          "modelCompatibility": [
            "ADDITION"
          ],
          "operandCount": 3,
          "template": "{character} buys a {item1} for {price1}, a {item2} for {price2}, and a {item3} for {price3}. What is the total cost?",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item1",
              "type": "item"
            },
            {
              "key": "item2",
              "type": "item"
            },
            {
              "key": "item3",
              "type": "item"
            },
            {
              "key": "price1",
              "type": "value"
            },
            {
              "key": "price2",
              "type": "value"
            },
            {
              "key": "price3",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "MULTI_STEP"
          ],
          "modelCompatibility": [
            "ADDITION"
          ],
          "operandCount": 2,
          "template": "{character} buys a {item1} for {price1} and a {item2} for {price2}. What is the total cost?",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item1",
              "type": "item"
            },
            {
              "key": "item2",
              "type": "item"
            },
            {
              "key": "price1",
              "type": "value"
            },
            {
              "key": "price2",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION"
          ],
          "modelCompatibility": [
            "SUBTRACTION",
            "CHANGE_CALCULATION"
          ],
          "template": "{character} buys a {item} for {price} and pays with {payment}. How much change does {character} get?",
          "answerTemplate": "{character} receives {result} in change",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "price",
              "type": "value"
            },
            {
              "key": "payment",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION"
          ],
          "modelCompatibility": [
            "MULTIPLICATION"
          ],
          "template": "{character} buys {quantity} {item} at {price} each. What is the total cost?",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "quantity",
              "type": "value"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "price",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION"
          ],
          "modelCompatibility": [
            "DIVISION"
          ],
          "template": "{character} has {total} to spend equally on {quantity} {item}. How much can {character} spend on each one?",
          "answerTemplate": "{character} can spend {result} on each {item}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "total",
              "type": "value"
            },
            {
              "key": "quantity",
              "type": "value"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "COMPARISON",
            "ESTIMATION",
            "MULTI_STEP"
          ],
          "template": "{character} goes to the shop and buys {items}. How much does {character} spend in total?",
          "answerTemplate": "{character} spends {result} in total",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "items",
              "type": "item_list"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "ESTIMATION"
          ],
          "template": "Estimate: If {character} buys {items}, about how much will it cost?",
          "answerTemplate": "It will cost approximately {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "items",
              "type": "item_list"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "VALIDATION"
          ],
          "template": "{character} calculated that {items} costs {amount}. Is this correct?",
          "answerTemplate": "{validation_result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "items",
              "type": "item_list"
            },
            {
              "key": "amount",
              "type": "value"
            },
            {
              "key": "validation_result",
              "type": "boolean"
            }
          ]
        }
      ]
    },
    "distractors": [
      {
        "value": 0,
        "displayText": "0",
        "strategy": "COMMON_MISCONCEPTION",
        "reasoning": "Counting error"
      },
      {
        "value": 11,
        "displayText": "11",
        "strategy": "WRONG_OPERATION",
        "reasoning": "Added instead of multiplying"
      },
      {
        "value": 7,
        "displayText": "7",
        "strategy": "WRONG_OPERATION",
        "reasoning": "Subtracted instead of multiplying"
      }
    ],
    "enhancementStatus": {
      "level": "partial",
      "requestedFormat": "DIRECT_CALCULATION",
      "actualFormat": "DIRECT_CALCULATION",
      "featuresActive": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "featuresPending": [],
      "isFullyEnhanced": true
    },
    "mathOutput": {
      "operation": "MULTIPLICATION",
      "multiplier": 2,
      "multiplicand": 0.5,
      "result": 1
    },
    "generationTime": 0,
    "questionId": "q_1759079329375_rj9eokh3q",
    "generationSetup": {
      "controller_used": "DIRECT_CALCULATIONController",
      "format_requested": "DIRECT_CALCULATION",
      "format_actual": "DIRECT_CALCULATION",
      "scenario_theme": "SHOPPING",
      "scenario_id": "shop-002-realistic-general",
      "scenario_selection_method": "default",
      "distractor_strategies": [
        "COMMON_MISCONCEPTION",
        "WRONG_OPERATION",
        "WRONG_OPERATION"
      ],
      "distractor_count": 3,
      "theme_variety": false,
      "format_variety": false,
      "enhancement_level": "partial",
      "features_active": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "features_pending": [],
      "generation_time_ms": 0
    }
  },
  "metadata": {
    "format": "DIRECT_CALCULATION",
    "cognitive_load": 35,
    "curriculum_alignment": [
      "2N1a"
    ],
    "difficulty": "2.4",
    "scenario_theme": "SHOPPING",
    "distractor_strategies": [
      "COMMON_MISCONCEPTION",
      "WRONG_OPERATION",
      "WRONG_OPERATION"
    ],
    "generation_time_ms": 0,
    "api_version": "2.0",
    "enhancement_status": "partial",
    "format_requested": "DIRECT_CALCULATION",
    "format_used": "DIRECT_CALCULATION",
    "features_active": [
      "enhanced_distractors",
      "rich_scenarios",
      "cognitive_load",
      "advanced_formats"
    ],
    "features_pending": []
  },
  "context": {
    "id": "shop-002-realistic-general",
    "theme": "SHOPPING",
    "setting": {
      "location": "local shop",
      "timeContext": "after school",
      "atmosphere": "friendly"
    },
    "characters": [
      {
        "name": "Charlotte",
        "role": "student"
      }
    ],
    "items": [
      {
        "name": "apple",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.2,
          "max": 0.5,
          "typical": 0.35,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "banana",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.15,
          "max": 0.4,
          "typical": 0.25,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "sandwich",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 2.5,
          "max": 6,
          "typical": 4,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "drink",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.8,
          "max": 2.5,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "cake",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 1.5,
          "max": 4,
          "typical": 2.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "biscuit",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.8,
          "max": 2,
          "typical": 1.2,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "sweet",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.1,
          "max": 1,
          "typical": 0.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "chocolate",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.6,
          "max": 3,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "pen",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.5,
          "max": 2,
          "typical": 1,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "pencil",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.2,
          "max": 1,
          "typical": 0.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "ruler",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.8,
          "max": 2.5,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "notebook",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 1,
          "max": 4,
          "typical": 2,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "eraser",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.3,
          "max": 1.5,
          "typical": 0.75,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "book",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 3,
          "max": 15,
          "typical": 8,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "comic",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 2,
          "max": 5,
          "typical": 3,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "magazine",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 2.5,
          "max": 6,
          "typical": 4,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "toy",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 5,
          "max": 25,
          "typical": 12,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "game",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 8,
          "max": 60,
          "typical": 25,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "puzzle",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 5,
          "max": 20,
          "typical": 12,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "sticker",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 0.2,
          "max": 2,
          "typical": 0.8,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "badge",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 0.5,
          "max": 3,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "poster",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 2,
          "max": 8,
          "typical": 4,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "card",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 0.5,
          "max": 4,
          "typical": 2,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      }
    ],
    "culturalElements": [
      {
        "type": "currency",
        "value": "£",
        "explanation": "British pounds"
      },
      {
        "type": "location",
        "value": "UK local shop",
        "explanation": "Typical British corner shop"
      }
    ],
    "realWorldConnection": "Everyday shopping with realistic UK prices",
    "yearAppropriate": [
      1,
      2,
      3,
      4,
      5,
      6
    ],
    "templates": [
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "MULTI_STEP"
        ],
        "modelCompatibility": [
          "ADDITION"
        ],
        "operandCount": 3,
        "template": "{character} buys a {item1} for {price1}, a {item2} for {price2}, and a {item3} for {price3}. What is the total cost?",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item1",
            "type": "item"
          },
          {
            "key": "item2",
            "type": "item"
          },
          {
            "key": "item3",
            "type": "item"
          },
          {
            "key": "price1",
            "type": "value"
          },
          {
            "key": "price2",
            "type": "value"
          },
          {
            "key": "price3",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "MULTI_STEP"
        ],
        "modelCompatibility": [
          "ADDITION"
        ],
        "operandCount": 2,
        "template": "{character} buys a {item1} for {price1} and a {item2} for {price2}. What is the total cost?",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item1",
            "type": "item"
          },
          {
            "key": "item2",
            "type": "item"
          },
          {
            "key": "price1",
            "type": "value"
          },
          {
            "key": "price2",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION"
        ],
        "modelCompatibility": [
          "SUBTRACTION",
          "CHANGE_CALCULATION"
        ],
        "template": "{character} buys a {item} for {price} and pays with {payment}. How much change does {character} get?",
        "answerTemplate": "{character} receives {result} in change",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "price",
            "type": "value"
          },
          {
            "key": "payment",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION"
        ],
        "modelCompatibility": [
          "MULTIPLICATION"
        ],
        "template": "{character} buys {quantity} {item} at {price} each. What is the total cost?",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "quantity",
            "type": "value"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "price",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION"
        ],
        "modelCompatibility": [
          "DIVISION"
        ],
        "template": "{character} has {total} to spend equally on {quantity} {item}. How much can {character} spend on each one?",
        "answerTemplate": "{character} can spend {result} on each {item}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "total",
            "type": "value"
          },
          {
            "key": "quantity",
            "type": "value"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "COMPARISON",
          "ESTIMATION",
          "MULTI_STEP"
        ],
        "template": "{character} goes to the shop and buys {items}. How much does {character} spend in total?",
        "answerTemplate": "{character} spends {result} in total",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "items",
            "type": "item_list"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "ESTIMATION"
        ],
        "template": "Estimate: If {character} buys {items}, about how much will it cost?",
        "answerTemplate": "It will cost approximately {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "items",
            "type": "item_list"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "VALIDATION"
        ],
        "template": "{character} calculated that {items} costs {amount}. Is this correct?",
        "answerTemplate": "{validation_result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "items",
            "type": "item_list"
          },
          {
            "key": "amount",
            "type": "value"
          },
          {
            "key": "validation_result",
            "type": "boolean"
          }
        ]
      }
    ]
  }
}
# Test D.3: MULTIPLICATION at difficulty 3.2
{
  "success": true,
  "question": {
    "text": "Charlotte is multiplying £11.00 × 3. What is a reasonable estimate?",
    "options": [
      {
        "text": "21",
        "value": 21,
        "index": 0
      },
      {
        "text": "£35.00",
        "value": 35,
        "index": 1
      },
      {
        "text": "52.5",
        "value": 52.5,
        "index": 2
      },
      {
        "text": "33",
        "value": 33,
        "index": 3
      }
    ],
    "correctIndex": 1,
    "questionContent": {
      "fullText": "Charlotte is multiplying £11.00 × 3. What is a reasonable estimate?",
      "templateData": {
        "character": "Charlotte",
        "operation": "is multiplying £11.00 × 3",
        "exactValue": "33",
        "estimatedValue": "35"
      }
    },
    "format": "ESTIMATION",
    "difficulty": {
      "year": 3,
      "subLevel": 2,
      "displayName": "3.2",
      "cognitiveLoad": 35
    },
    "cognitiveLoad": 35,
    "curriculumTags": [
      "3N1a"
    ],
    "scenario": {
      "id": "shop-002-realistic-general",
      "theme": "SHOPPING",
      "setting": {
        "location": "local shop",
        "timeContext": "after school",
        "atmosphere": "friendly"
      },
      "characters": [
        {
          "name": "Charlotte",
          "role": "student"
        }
      ],
      "items": [
        {
          "name": "apple",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.2,
            "max": 0.5,
            "typical": 0.35,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "banana",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.15,
            "max": 0.4,
            "typical": 0.25,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "sandwich",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 2.5,
            "max": 6,
            "typical": 4,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "drink",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.8,
            "max": 2.5,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "cake",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 1.5,
            "max": 4,
            "typical": 2.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "biscuit",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.8,
            "max": 2,
            "typical": 1.2,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "sweet",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.1,
            "max": 1,
            "typical": 0.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "chocolate",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.6,
            "max": 3,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "pen",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.5,
            "max": 2,
            "typical": 1,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "pencil",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.2,
            "max": 1,
            "typical": 0.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "ruler",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.8,
            "max": 2.5,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "notebook",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 1,
            "max": 4,
            "typical": 2,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "eraser",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.3,
            "max": 1.5,
            "typical": 0.75,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "book",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 3,
            "max": 15,
            "typical": 8,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "comic",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 2,
            "max": 5,
            "typical": 3,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "magazine",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 2.5,
            "max": 6,
            "typical": 4,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "toy",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 5,
            "max": 25,
            "typical": 12,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "game",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 8,
            "max": 60,
            "typical": 25,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "puzzle",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 5,
            "max": 20,
            "typical": 12,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "sticker",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 0.2,
            "max": 2,
            "typical": 0.8,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "badge",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 0.5,
            "max": 3,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "poster",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 2,
            "max": 8,
            "typical": 4,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "card",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 0.5,
            "max": 4,
            "typical": 2,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        }
      ],
      "culturalElements": [
        {
          "type": "currency",
          "value": "£",
          "explanation": "British pounds"
        },
        {
          "type": "location",
          "value": "UK local shop",
          "explanation": "Typical British corner shop"
        }
      ],
      "realWorldConnection": "Everyday shopping with realistic UK prices",
      "yearAppropriate": [
        1,
        2,
        3,
        4,
        5,
        6
      ],
      "templates": [
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "MULTI_STEP"
          ],
          "modelCompatibility": [
            "ADDITION"
          ],
          "operandCount": 3,
          "template": "{character} buys a {item1} for {price1}, a {item2} for {price2}, and a {item3} for {price3}. What is the total cost?",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item1",
              "type": "item"
            },
            {
              "key": "item2",
              "type": "item"
            },
            {
              "key": "item3",
              "type": "item"
            },
            {
              "key": "price1",
              "type": "value"
            },
            {
              "key": "price2",
              "type": "value"
            },
            {
              "key": "price3",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "MULTI_STEP"
          ],
          "modelCompatibility": [
            "ADDITION"
          ],
          "operandCount": 2,
          "template": "{character} buys a {item1} for {price1} and a {item2} for {price2}. What is the total cost?",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item1",
              "type": "item"
            },
            {
              "key": "item2",
              "type": "item"
            },
            {
              "key": "price1",
              "type": "value"
            },
            {
              "key": "price2",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION"
          ],
          "modelCompatibility": [
            "SUBTRACTION",
            "CHANGE_CALCULATION"
          ],
          "template": "{character} buys a {item} for {price} and pays with {payment}. How much change does {character} get?",
          "answerTemplate": "{character} receives {result} in change",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "price",
              "type": "value"
            },
            {
              "key": "payment",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION"
          ],
          "modelCompatibility": [
            "MULTIPLICATION"
          ],
          "template": "{character} buys {quantity} {item} at {price} each. What is the total cost?",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "quantity",
              "type": "value"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "price",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION"
          ],
          "modelCompatibility": [
            "DIVISION"
          ],
          "template": "{character} has {total} to spend equally on {quantity} {item}. How much can {character} spend on each one?",
          "answerTemplate": "{character} can spend {result} on each {item}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "total",
              "type": "value"
            },
            {
              "key": "quantity",
              "type": "value"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "COMPARISON",
            "ESTIMATION",
            "MULTI_STEP"
          ],
          "template": "{character} goes to the shop and buys {items}. How much does {character} spend in total?",
          "answerTemplate": "{character} spends {result} in total",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "items",
              "type": "item_list"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "ESTIMATION"
          ],
          "template": "Estimate: If {character} buys {items}, about how much will it cost?",
          "answerTemplate": "It will cost approximately {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "items",
              "type": "item_list"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "VALIDATION"
          ],
          "template": "{character} calculated that {items} costs {amount}. Is this correct?",
          "answerTemplate": "{validation_result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "items",
              "type": "item_list"
            },
            {
              "key": "amount",
              "type": "value"
            },
            {
              "key": "validation_result",
              "type": "boolean"
            }
          ]
        }
      ]
    },
    "distractors": [
      {
        "value": 33,
        "strategy": "WRONG_OPERATION",
        "rationale": "Used exact calculation instead of estimation"
      },
      {
        "value": 52.5,
        "rationale": "Overestimated significantly"
      },
      {
        "value": 21,
        "rationale": "Underestimated significantly"
      }
    ],
    "enhancementStatus": {
      "level": "full",
      "requestedFormat": "ESTIMATION",
      "actualFormat": "ESTIMATION",
      "featuresActive": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "featuresPending": [],
      "isFullyEnhanced": true
    },
    "mathOutput": {
      "operation": "MULTIPLICATION",
      "multiplicand": 11,
      "multiplier": 3,
      "result": 33,
      "factors": [
        11,
        3
      ],
      "decimal_formatted": {
        "operands": [
          "11",
          "3"
        ],
        "result": "33"
      },
      "exactValue": 33,
      "estimatedValue": 35
    },
    "generationTime": 1,
    "questionId": "q_1759079329517_ln6boce3r",
    "generationSetup": {
      "controller_used": "ESTIMATIONController",
      "format_requested": "ESTIMATION",
      "format_actual": "ESTIMATION",
      "scenario_theme": "SHOPPING",
      "scenario_id": "shop-002-realistic-general",
      "scenario_selection_method": "default",
      "distractor_strategies": [
        "WRONG_OPERATION",
        null,
        null
      ],
      "distractor_count": 3,
      "theme_variety": false,
      "format_variety": false,
      "enhancement_level": "full",
      "features_active": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "features_pending": [],
      "generation_time_ms": 1
    }
  },
  "metadata": {
    "format": "ESTIMATION",
    "cognitive_load": 35,
    "curriculum_alignment": [
      "3N1a"
    ],
    "difficulty": "3.2",
    "scenario_theme": "SHOPPING",
    "distractor_strategies": [
      "WRONG_OPERATION",
      null,
      null
    ],
    "generation_time_ms": 1,
    "api_version": "2.0",
    "enhancement_status": "full",
    "format_requested": "ESTIMATION",
    "format_used": "ESTIMATION",
    "features_active": [
      "enhanced_distractors",
      "rich_scenarios",
      "cognitive_load",
      "advanced_formats"
    ],
    "features_pending": []
  },
  "context": {
    "id": "shop-002-realistic-general",
    "theme": "SHOPPING",
    "setting": {
      "location": "local shop",
      "timeContext": "after school",
      "atmosphere": "friendly"
    },
    "characters": [
      {
        "name": "Charlotte",
        "role": "student"
      }
    ],
    "items": [
      {
        "name": "apple",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.2,
          "max": 0.5,
          "typical": 0.35,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "banana",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.15,
          "max": 0.4,
          "typical": 0.25,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "sandwich",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 2.5,
          "max": 6,
          "typical": 4,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "drink",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.8,
          "max": 2.5,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "cake",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 1.5,
          "max": 4,
          "typical": 2.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "biscuit",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.8,
          "max": 2,
          "typical": 1.2,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "sweet",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.1,
          "max": 1,
          "typical": 0.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "chocolate",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.6,
          "max": 3,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "pen",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.5,
          "max": 2,
          "typical": 1,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "pencil",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.2,
          "max": 1,
          "typical": 0.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "ruler",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.8,
          "max": 2.5,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "notebook",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 1,
          "max": 4,
          "typical": 2,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "eraser",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.3,
          "max": 1.5,
          "typical": 0.75,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "book",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 3,
          "max": 15,
          "typical": 8,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "comic",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 2,
          "max": 5,
          "typical": 3,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "magazine",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 2.5,
          "max": 6,
          "typical": 4,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "toy",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 5,
          "max": 25,
          "typical": 12,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "game",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 8,
          "max": 60,
          "typical": 25,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "puzzle",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 5,
          "max": 20,
          "typical": 12,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "sticker",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 0.2,
          "max": 2,
          "typical": 0.8,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "badge",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 0.5,
          "max": 3,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "poster",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 2,
          "max": 8,
          "typical": 4,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "card",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 0.5,
          "max": 4,
          "typical": 2,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      }
    ],
    "culturalElements": [
      {
        "type": "currency",
        "value": "£",
        "explanation": "British pounds"
      },
      {
        "type": "location",
        "value": "UK local shop",
        "explanation": "Typical British corner shop"
      }
    ],
    "realWorldConnection": "Everyday shopping with realistic UK prices",
    "yearAppropriate": [
      1,
      2,
      3,
      4,
      5,
      6
    ],
    "templates": [
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "MULTI_STEP"
        ],
        "modelCompatibility": [
          "ADDITION"
        ],
        "operandCount": 3,
        "template": "{character} buys a {item1} for {price1}, a {item2} for {price2}, and a {item3} for {price3}. What is the total cost?",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item1",
            "type": "item"
          },
          {
            "key": "item2",
            "type": "item"
          },
          {
            "key": "item3",
            "type": "item"
          },
          {
            "key": "price1",
            "type": "value"
          },
          {
            "key": "price2",
            "type": "value"
          },
          {
            "key": "price3",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "MULTI_STEP"
        ],
        "modelCompatibility": [
          "ADDITION"
        ],
        "operandCount": 2,
        "template": "{character} buys a {item1} for {price1} and a {item2} for {price2}. What is the total cost?",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item1",
            "type": "item"
          },
          {
            "key": "item2",
            "type": "item"
          },
          {
            "key": "price1",
            "type": "value"
          },
          {
            "key": "price2",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION"
        ],
        "modelCompatibility": [
          "SUBTRACTION",
          "CHANGE_CALCULATION"
        ],
        "template": "{character} buys a {item} for {price} and pays with {payment}. How much change does {character} get?",
        "answerTemplate": "{character} receives {result} in change",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "price",
            "type": "value"
          },
          {
            "key": "payment",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION"
        ],
        "modelCompatibility": [
          "MULTIPLICATION"
        ],
        "template": "{character} buys {quantity} {item} at {price} each. What is the total cost?",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "quantity",
            "type": "value"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "price",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION"
        ],
        "modelCompatibility": [
          "DIVISION"
        ],
        "template": "{character} has {total} to spend equally on {quantity} {item}. How much can {character} spend on each one?",
        "answerTemplate": "{character} can spend {result} on each {item}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "total",
            "type": "value"
          },
          {
            "key": "quantity",
            "type": "value"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "COMPARISON",
          "ESTIMATION",
          "MULTI_STEP"
        ],
        "template": "{character} goes to the shop and buys {items}. How much does {character} spend in total?",
        "answerTemplate": "{character} spends {result} in total",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "items",
            "type": "item_list"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "ESTIMATION"
        ],
        "template": "Estimate: If {character} buys {items}, about how much will it cost?",
        "answerTemplate": "It will cost approximately {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "items",
            "type": "item_list"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "VALIDATION"
        ],
        "template": "{character} calculated that {items} costs {amount}. Is this correct?",
        "answerTemplate": "{validation_result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "items",
            "type": "item_list"
          },
          {
            "key": "amount",
            "type": "value"
          },
          {
            "key": "validation_result",
            "type": "boolean"
          }
        ]
      }
    ]
  }
}
# Test D.4: MULTIPLICATION at difficulty 4.1
{
  "error": "Failed to generate enhanced question",
  "details": "Cannot read properties of undefined (reading 'correctAnswer')",
  "api_version": "2.0"
}
# Test D.5: MULTIPLICATION at difficulty 5.3
{
  "success": true,
  "question": {
    "text": "Sarah wants to buy books at the book fair. Calculate the total cost.",
    "options": [
      {
        "text": "1028.8",
        "value": 1028.8,
        "index": 0
      },
      {
        "text": "£928.80",
        "value": 928.8,
        "index": 1
      },
      {
        "text": "163",
        "value": 163,
        "index": 2
      },
      {
        "text": "3",
        "value": 3,
        "index": 3
      }
    ],
    "correctIndex": 1,
    "format": "DIRECT_CALCULATION",
    "difficulty": {
      "year": 5,
      "subLevel": 3,
      "displayName": "5.3",
      "cognitiveLoad": 60
    },
    "cognitiveLoad": 60,
    "curriculumTags": [
      "5N1a"
    ],
    "scenario": {
      "id": "shop-001-bookfair",
      "theme": "SHOPPING",
      "setting": {
        "location": "school book fair",
        "timeContext": "lunch break",
        "atmosphere": "busy"
      },
      "characters": [
        {
          "name": "Sarah",
          "role": "student"
        },
        {
          "name": "Mr. Johnson",
          "role": "teacher"
        }
      ],
      "items": [
        {
          "name": "book",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 3,
            "max": 12,
            "typical": 6.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "bookmark",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.5,
            "max": 2,
            "typical": 1,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        }
      ],
      "culturalElements": [
        {
          "type": "currency",
          "value": "£",
          "explanation": "British pounds"
        },
        {
          "type": "event",
          "value": "book fair",
          "explanation": "School fundraising event"
        }
      ],
      "realWorldConnection": "School fundraising and reading promotion",
      "yearAppropriate": [
        2,
        3,
        4,
        5
      ],
      "templates": [
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "COMPARISON"
          ],
          "template": "{character} wants to buy books at the book fair. Calculate the total cost.",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        }
      ]
    },
    "distractors": [
      {
        "value": 163,
        "displayText": "163",
        "strategy": "WRONG_OPERATION",
        "reasoning": "Added instead of multiplying"
      },
      {
        "value": 3,
        "displayText": "3",
        "strategy": "WRONG_OPERATION",
        "reasoning": "Subtracted instead of multiplying"
      },
      {
        "value": 1028.8,
        "displayText": "1028.8",
        "strategy": "PLACE_VALUE_ERROR",
        "reasoning": "Error in carrying to next column"
      }
    ],
    "enhancementStatus": {
      "level": "partial",
      "requestedFormat": "DIRECT_CALCULATION",
      "actualFormat": "DIRECT_CALCULATION",
      "featuresActive": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "featuresPending": [],
      "isFullyEnhanced": true
    },
    "mathOutput": {
      "operation": "MULTIPLICATION",
      "multiplier": 80,
      "multiplicand": 11.61,
      "result": 928.8
    },
    "generationTime": 0,
    "questionId": "q_1759079329936_4g8ji2dfq",
    "generationSetup": {
      "controller_used": "DIRECT_CALCULATIONController",
      "format_requested": "DIRECT_CALCULATION",
      "format_actual": "DIRECT_CALCULATION",
      "scenario_theme": "SHOPPING",
      "scenario_id": "shop-001-bookfair",
      "scenario_selection_method": "default",
      "distractor_strategies": [
        "WRONG_OPERATION",
        "WRONG_OPERATION",
        "PLACE_VALUE_ERROR"
      ],
      "distractor_count": 3,
      "theme_variety": false,
      "format_variety": false,
      "enhancement_level": "partial",
      "features_active": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "features_pending": [],
      "generation_time_ms": 0
    }
  },
  "metadata": {
    "format": "DIRECT_CALCULATION",
    "cognitive_load": 60,
    "curriculum_alignment": [
      "5N1a"
    ],
    "difficulty": "5.3",
    "scenario_theme": "SHOPPING",
    "distractor_strategies": [
      "WRONG_OPERATION",
      "WRONG_OPERATION",
      "PLACE_VALUE_ERROR"
    ],
    "generation_time_ms": 0,
    "api_version": "2.0",
    "enhancement_status": "partial",
    "format_requested": "DIRECT_CALCULATION",
    "format_used": "DIRECT_CALCULATION",
    "features_active": [
      "enhanced_distractors",
      "rich_scenarios",
      "cognitive_load",
      "advanced_formats"
    ],
    "features_pending": []
  },
  "context": {
    "id": "shop-001-bookfair",
    "theme": "SHOPPING",
    "setting": {
      "location": "school book fair",
      "timeContext": "lunch break",
      "atmosphere": "busy"
    },
    "characters": [
      {
        "name": "Sarah",
        "role": "student"
      },
      {
        "name": "Mr. Johnson",
        "role": "teacher"
      }
    ],
    "items": [
      {
        "name": "book",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 3,
          "max": 12,
          "typical": 6.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "bookmark",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.5,
          "max": 2,
          "typical": 1,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      }
    ],
    "culturalElements": [
      {
        "type": "currency",
        "value": "£",
        "explanation": "British pounds"
      },
      {
        "type": "event",
        "value": "book fair",
        "explanation": "School fundraising event"
      }
    ],
    "realWorldConnection": "School fundraising and reading promotion",
    "yearAppropriate": [
      2,
      3,
      4,
      5
    ],
    "templates": [
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "COMPARISON"
        ],
        "template": "{character} wants to buy books at the book fair. Calculate the total cost.",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      }
    ]
  }
}
# Test D.6: MULTIPLICATION at difficulty 6.4
{
  "success": true,
  "question": {
    "text": "Charlotte made an error in their calculation:\\nStep 1: 1306 × 140\\nStep 2: Break down: 1306 × 140\\nStep 3: = 182843\\n\\nWhich step contains the error?",
    "options": [
      {
        "value": null,
        "text": "NaNp",
        "isCorrect": true
      },
      {
        "value": null,
        "text": "NaNp",
        "isCorrect": false
      },
      {
        "value": null,
        "text": "NaNp",
        "isCorrect": false
      }
    ],
    "correctIndex": 2,
    "questionContent": {
      "fullText": "Charlotte made an error in their calculation:\\nStep 1: 1306 × 140\\nStep 2: Break down: 1306 × 140\\nStep 3: = 182843\\n\\nWhich step contains the error?"
    },
    "format": "VALIDATION",
    "difficulty": {
      "year": 6,
      "subLevel": 4,
      "displayName": "6.4",
      "cognitiveLoad": 75
    },
    "cognitiveLoad": 75,
    "curriculumTags": [
      "6N1a"
    ],
    "scenario": {
      "id": "shop-002-realistic-general",
      "theme": "SHOPPING",
      "setting": {
        "location": "local shop",
        "timeContext": "after school",
        "atmosphere": "friendly"
      },
      "characters": [
        {
          "name": "Charlotte",
          "role": "student"
        }
      ],
      "items": [
        {
          "name": "apple",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.2,
            "max": 0.5,
            "typical": 0.35,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "banana",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.15,
            "max": 0.4,
            "typical": 0.25,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "sandwich",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 2.5,
            "max": 6,
            "typical": 4,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "drink",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.8,
            "max": 2.5,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "cake",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 1.5,
            "max": 4,
            "typical": 2.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "biscuit",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.8,
            "max": 2,
            "typical": 1.2,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "sweet",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.1,
            "max": 1,
            "typical": 0.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "chocolate",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.6,
            "max": 3,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "pen",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.5,
            "max": 2,
            "typical": 1,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "pencil",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.2,
            "max": 1,
            "typical": 0.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "ruler",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.8,
            "max": 2.5,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "notebook",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 1,
            "max": 4,
            "typical": 2,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "eraser",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.3,
            "max": 1.5,
            "typical": 0.75,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "book",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 3,
            "max": 15,
            "typical": 8,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "comic",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 2,
            "max": 5,
            "typical": 3,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "magazine",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 2.5,
            "max": 6,
            "typical": 4,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "toy",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 5,
            "max": 25,
            "typical": 12,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "game",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 8,
            "max": 60,
            "typical": 25,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "puzzle",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 5,
            "max": 20,
            "typical": 12,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "sticker",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 0.2,
            "max": 2,
            "typical": 0.8,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "badge",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 0.5,
            "max": 3,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "poster",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 2,
            "max": 8,
            "typical": 4,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "card",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 0.5,
            "max": 4,
            "typical": 2,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        }
      ],
      "culturalElements": [
        {
          "type": "currency",
          "value": "£",
          "explanation": "British pounds"
        },
        {
          "type": "location",
          "value": "UK local shop",
          "explanation": "Typical British corner shop"
        }
      ],
      "realWorldConnection": "Everyday shopping with realistic UK prices",
      "yearAppropriate": [
        1,
        2,
        3,
        4,
        5,
        6
      ],
      "templates": [
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "MULTI_STEP"
          ],
          "modelCompatibility": [
            "ADDITION"
          ],
          "operandCount": 3,
          "template": "{character} buys a {item1} for {price1}, a {item2} for {price2}, and a {item3} for {price3}. What is the total cost?",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item1",
              "type": "item"
            },
            {
              "key": "item2",
              "type": "item"
            },
            {
              "key": "item3",
              "type": "item"
            },
            {
              "key": "price1",
              "type": "value"
            },
            {
              "key": "price2",
              "type": "value"
            },
            {
              "key": "price3",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "MULTI_STEP"
          ],
          "modelCompatibility": [
            "ADDITION"
          ],
          "operandCount": 2,
          "template": "{character} buys a {item1} for {price1} and a {item2} for {price2}. What is the total cost?",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item1",
              "type": "item"
            },
            {
              "key": "item2",
              "type": "item"
            },
            {
              "key": "price1",
              "type": "value"
            },
            {
              "key": "price2",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION"
          ],
          "modelCompatibility": [
            "SUBTRACTION",
            "CHANGE_CALCULATION"
          ],
          "template": "{character} buys a {item} for {price} and pays with {payment}. How much change does {character} get?",
          "answerTemplate": "{character} receives {result} in change",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "price",
              "type": "value"
            },
            {
              "key": "payment",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION"
          ],
          "modelCompatibility": [
            "MULTIPLICATION"
          ],
          "template": "{character} buys {quantity} {item} at {price} each. What is the total cost?",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "quantity",
              "type": "value"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "price",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION"
          ],
          "modelCompatibility": [
            "DIVISION"
          ],
          "template": "{character} has {total} to spend equally on {quantity} {item}. How much can {character} spend on each one?",
          "answerTemplate": "{character} can spend {result} on each {item}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "total",
              "type": "value"
            },
            {
              "key": "quantity",
              "type": "value"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "COMPARISON",
            "ESTIMATION",
            "MULTI_STEP"
          ],
          "template": "{character} goes to the shop and buys {items}. How much does {character} spend in total?",
          "answerTemplate": "{character} spends {result} in total",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "items",
              "type": "item_list"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "ESTIMATION"
          ],
          "template": "Estimate: If {character} buys {items}, about how much will it cost?",
          "answerTemplate": "It will cost approximately {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "items",
              "type": "item_list"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "VALIDATION"
          ],
          "template": "{character} calculated that {items} costs {amount}. Is this correct?",
          "answerTemplate": "{validation_result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "items",
              "type": "item_list"
            },
            {
              "key": "amount",
              "type": "value"
            },
            {
              "key": "validation_result",
              "type": "boolean"
            }
          ]
        }
      ]
    },
    "distractors": [
      {
        "value": "Step 1",
        "rationale": "Incorrectly identified step 1 as containing the error"
      },
      {
        "value": "Step 2",
        "rationale": "Incorrectly identified step 2 as containing the error"
      }
    ],
    "enhancementStatus": {
      "level": "full",
      "requestedFormat": "VALIDATION",
      "actualFormat": "VALIDATION",
      "featuresActive": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "featuresPending": [],
      "isFullyEnhanced": true
    },
    "mathOutput": {
      "operation": "MULTIPLICATION",
      "multiplicand": 1306,
      "multiplier": 140,
      "result": 182840,
      "factors": [
        1306,
        140,
        1
      ],
      "decimal_formatted": {
        "operands": [
          "1306",
          "140",
          "1"
        ],
        "result": "182840"
      }
    },
    "generationTime": 1,
    "questionId": "q_1759079330065_qhff8qdf3",
    "generationSetup": {
      "controller_used": "VALIDATIONController",
      "format_requested": "VALIDATION",
      "format_actual": "VALIDATION",
      "scenario_theme": "SHOPPING",
      "scenario_id": "shop-002-realistic-general",
      "scenario_selection_method": "default",
      "distractor_strategies": [
        null,
        null
      ],
      "distractor_count": 2,
      "theme_variety": false,
      "format_variety": false,
      "enhancement_level": "full",
      "features_active": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "features_pending": [],
      "generation_time_ms": 1
    }
  },
  "metadata": {
    "format": "VALIDATION",
    "cognitive_load": 75,
    "curriculum_alignment": [
      "6N1a"
    ],
    "difficulty": "6.4",
    "scenario_theme": "SHOPPING",
    "distractor_strategies": [
      null,
      null
    ],
    "generation_time_ms": 1,
    "api_version": "2.0",
    "enhancement_status": "full",
    "format_requested": "VALIDATION",
    "format_used": "VALIDATION",
    "features_active": [
      "enhanced_distractors",
      "rich_scenarios",
      "cognitive_load",
      "advanced_formats"
    ],
    "features_pending": []
  },
  "context": {
    "id": "shop-002-realistic-general",
    "theme": "SHOPPING",
    "setting": {
      "location": "local shop",
      "timeContext": "after school",
      "atmosphere": "friendly"
    },
    "characters": [
      {
        "name": "Charlotte",
        "role": "student"
      }
    ],
    "items": [
      {
        "name": "apple",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.2,
          "max": 0.5,
          "typical": 0.35,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "banana",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.15,
          "max": 0.4,
          "typical": 0.25,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "sandwich",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 2.5,
          "max": 6,
          "typical": 4,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "drink",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.8,
          "max": 2.5,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "cake",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 1.5,
          "max": 4,
          "typical": 2.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "biscuit",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.8,
          "max": 2,
          "typical": 1.2,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "sweet",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.1,
          "max": 1,
          "typical": 0.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "chocolate",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.6,
          "max": 3,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "pen",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.5,
          "max": 2,
          "typical": 1,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "pencil",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.2,
          "max": 1,
          "typical": 0.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "ruler",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.8,
          "max": 2.5,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "notebook",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 1,
          "max": 4,
          "typical": 2,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "eraser",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.3,
          "max": 1.5,
          "typical": 0.75,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "book",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 3,
          "max": 15,
          "typical": 8,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "comic",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 2,
          "max": 5,
          "typical": 3,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "magazine",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 2.5,
          "max": 6,
          "typical": 4,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "toy",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 5,
          "max": 25,
          "typical": 12,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "game",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 8,
          "max": 60,
          "typical": 25,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "puzzle",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 5,
          "max": 20,
          "typical": 12,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "sticker",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 0.2,
          "max": 2,
          "typical": 0.8,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "badge",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 0.5,
          "max": 3,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "poster",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 2,
          "max": 8,
          "typical": 4,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "card",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 0.5,
          "max": 4,
          "typical": 2,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      }
    ],
    "culturalElements": [
      {
        "type": "currency",
        "value": "£",
        "explanation": "British pounds"
      },
      {
        "type": "location",
        "value": "UK local shop",
        "explanation": "Typical British corner shop"
      }
    ],
    "realWorldConnection": "Everyday shopping with realistic UK prices",
    "yearAppropriate": [
      1,
      2,
      3,
      4,
      5,
      6
    ],
    "templates": [
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "MULTI_STEP"
        ],
        "modelCompatibility": [
          "ADDITION"
        ],
        "operandCount": 3,
        "template": "{character} buys a {item1} for {price1}, a {item2} for {price2}, and a {item3} for {price3}. What is the total cost?",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item1",
            "type": "item"
          },
          {
            "key": "item2",
            "type": "item"
          },
          {
            "key": "item3",
            "type": "item"
          },
          {
            "key": "price1",
            "type": "value"
          },
          {
            "key": "price2",
            "type": "value"
          },
          {
            "key": "price3",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "MULTI_STEP"
        ],
        "modelCompatibility": [
          "ADDITION"
        ],
        "operandCount": 2,
        "template": "{character} buys a {item1} for {price1} and a {item2} for {price2}. What is the total cost?",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item1",
            "type": "item"
          },
          {
            "key": "item2",
            "type": "item"
          },
          {
            "key": "price1",
            "type": "value"
          },
          {
            "key": "price2",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION"
        ],
        "modelCompatibility": [
          "SUBTRACTION",
          "CHANGE_CALCULATION"
        ],
        "template": "{character} buys a {item} for {price} and pays with {payment}. How much change does {character} get?",
        "answerTemplate": "{character} receives {result} in change",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "price",
            "type": "value"
          },
          {
            "key": "payment",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION"
        ],
        "modelCompatibility": [
          "MULTIPLICATION"
        ],
        "template": "{character} buys {quantity} {item} at {price} each. What is the total cost?",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "quantity",
            "type": "value"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "price",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION"
        ],
        "modelCompatibility": [
          "DIVISION"
        ],
        "template": "{character} has {total} to spend equally on {quantity} {item}. How much can {character} spend on each one?",
        "answerTemplate": "{character} can spend {result} on each {item}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "total",
            "type": "value"
          },
          {
            "key": "quantity",
            "type": "value"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "COMPARISON",
          "ESTIMATION",
          "MULTI_STEP"
        ],
        "template": "{character} goes to the shop and buys {items}. How much does {character} spend in total?",
        "answerTemplate": "{character} spends {result} in total",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "items",
            "type": "item_list"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "ESTIMATION"
        ],
        "template": "Estimate: If {character} buys {items}, about how much will it cost?",
        "answerTemplate": "It will cost approximately {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "items",
            "type": "item_list"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "VALIDATION"
        ],
        "template": "{character} calculated that {items} costs {amount}. Is this correct?",
        "answerTemplate": "{validation_result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "items",
            "type": "item_list"
          },
          {
            "key": "amount",
            "type": "value"
          },
          {
            "key": "validation_result",
            "type": "boolean"
          }
        ]
      }
    ]
  }
}

--- SUITE E: SCENARIO THEME TESTS ---
Testing that each scenario theme can be applied...
# Test E.1: SHOPPING theme
{
  "success": true,
  "question": {
    "text": "Sarah wants to buy books at the book fair. Calculate the total cost.",
    "options": [
      {
        "text": "30",
        "value": 30,
        "index": 0
      },
      {
        "text": "23.92",
        "value": 23.92,
        "index": 1
      },
      {
        "text": "351",
        "value": 351,
        "index": 2
      },
      {
        "text": "£13.92",
        "value": 13.92,
        "index": 3
      }
    ],
    "correctIndex": 3,
    "format": "DIRECT_CALCULATION",
    "difficulty": {
      "year": 3,
      "subLevel": 1,
      "displayName": "3.1",
      "cognitiveLoad": 30
    },
    "cognitiveLoad": 30,
    "curriculumTags": [
      "3N1a",
      "3N1b"
    ],
    "scenario": {
      "id": "shop-001-bookfair",
      "theme": "SHOPPING",
      "setting": {
        "location": "school book fair",
        "timeContext": "lunch break",
        "atmosphere": "busy"
      },
      "characters": [
        {
          "name": "Sarah",
          "role": "student"
        },
        {
          "name": "Mr. Johnson",
          "role": "teacher"
        }
      ],
      "items": [
        {
          "name": "book",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 3,
            "max": 12,
            "typical": 6.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "bookmark",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.5,
            "max": 2,
            "typical": 1,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        }
      ],
      "culturalElements": [
        {
          "type": "currency",
          "value": "£",
          "explanation": "British pounds"
        },
        {
          "type": "event",
          "value": "book fair",
          "explanation": "School fundraising event"
        }
      ],
      "realWorldConnection": "School fundraising and reading promotion",
      "yearAppropriate": [
        2,
        3,
        4,
        5
      ],
      "templates": [
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "COMPARISON"
          ],
          "template": "{character} wants to buy books at the book fair. Calculate the total cost.",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        }
      ]
    },
    "distractors": [
      {
        "value": 30,
        "displayText": "30",
        "strategy": "WRONG_OPERATION",
        "reasoning": "Subtracted instead of adding"
      },
      {
        "value": 351,
        "displayText": "351",
        "strategy": "WRONG_OPERATION",
        "reasoning": "Multiplied instead of adding"
      },
      {
        "value": 23.92,
        "displayText": "23.92",
        "strategy": "PLACE_VALUE_ERROR",
        "reasoning": "Error in carrying to next column"
      }
    ],
    "enhancementStatus": {
      "level": "partial",
      "requestedFormat": "DIRECT_CALCULATION",
      "actualFormat": "DIRECT_CALCULATION",
      "featuresActive": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "featuresPending": [],
      "isFullyEnhanced": true
    },
    "mathOutput": {
      "operation": "ADDITION",
      "operand_1": 9.62,
      "operand_2": 0.79,
      "operand_3": 3.51,
      "result": 13.92
    },
    "generationTime": 1,
    "questionId": "q_1759079330242_tkvnvliv9",
    "generationSetup": {
      "controller_used": "DIRECT_CALCULATIONController",
      "format_requested": "DIRECT_CALCULATION",
      "format_actual": "DIRECT_CALCULATION",
      "scenario_theme": "SHOPPING",
      "scenario_id": "shop-001-bookfair",
      "scenario_selection_method": "requested",
      "distractor_strategies": [
        "WRONG_OPERATION",
        "WRONG_OPERATION",
        "PLACE_VALUE_ERROR"
      ],
      "distractor_count": 3,
      "theme_variety": false,
      "format_variety": false,
      "enhancement_level": "partial",
      "features_active": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "features_pending": [],
      "generation_time_ms": 1
    }
  },
  "metadata": {
    "format": "DIRECT_CALCULATION",
    "cognitive_load": 30,
    "curriculum_alignment": [
      "3N1a",
      "3N1b"
    ],
    "difficulty": "3.1",
    "scenario_theme": "SHOPPING",
    "distractor_strategies": [
      "WRONG_OPERATION",
      "WRONG_OPERATION",
      "PLACE_VALUE_ERROR"
    ],
    "generation_time_ms": 1,
    "api_version": "2.0",
    "enhancement_status": "partial",
    "format_requested": "DIRECT_CALCULATION",
    "format_used": "DIRECT_CALCULATION",
    "features_active": [
      "enhanced_distractors",
      "rich_scenarios",
      "cognitive_load",
      "advanced_formats"
    ],
    "features_pending": []
  },
  "context": {
    "id": "shop-001-bookfair",
    "theme": "SHOPPING",
    "setting": {
      "location": "school book fair",
      "timeContext": "lunch break",
      "atmosphere": "busy"
    },
    "characters": [
      {
        "name": "Sarah",
        "role": "student"
      },
      {
        "name": "Mr. Johnson",
        "role": "teacher"
      }
    ],
    "items": [
      {
        "name": "book",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 3,
          "max": 12,
          "typical": 6.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "bookmark",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.5,
          "max": 2,
          "typical": 1,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      }
    ],
    "culturalElements": [
      {
        "type": "currency",
        "value": "£",
        "explanation": "British pounds"
      },
      {
        "type": "event",
        "value": "book fair",
        "explanation": "School fundraising event"
      }
    ],
    "realWorldConnection": "School fundraising and reading promotion",
    "yearAppropriate": [
      2,
      3,
      4,
      5
    ],
    "templates": [
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "COMPARISON"
        ],
        "template": "{character} wants to buy books at the book fair. Calculate the total cost.",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      }
    ]
  }
}
# Test E.2: COOKING theme
{
  "success": true,
  "question": {
    "text": "James is making cake. The ingredients cost £7, £10, £24. What is the total cost?",
    "options": [
      {
        "text": "70",
        "value": 70,
        "index": 0
      },
      {
        "text": "£41.00",
        "value": 41,
        "index": 1
      },
      {
        "text": "51",
        "value": 51,
        "index": 2
      },
      {
        "text": "17",
        "value": 17,
        "index": 3
      }
    ],
    "correctIndex": 1,
    "format": "DIRECT_CALCULATION",
    "difficulty": {
      "year": 3,
      "subLevel": 1,
      "displayName": "3.1",
      "cognitiveLoad": 30
    },
    "cognitiveLoad": 30,
    "curriculumTags": [
      "3N1a",
      "3N1b"
    ],
    "scenario": {
      "id": "cooking-3-1759079330405",
      "theme": "COOKING",
      "setting": {
        "location": "kitchen",
        "timeContext": "weekend baking",
        "atmosphere": "creative"
      },
      "characters": [
        {
          "name": "James",
          "role": "student"
        },
        {
          "name": "Mum",
          "role": "parent"
        }
      ],
      "items": [
        {
          "name": "flour",
          "category": "FOOD_ITEMS",
          "typicalValue": {
            "min": 1,
            "max": 5,
            "typical": 2.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "eggs",
          "category": "FOOD_ITEMS",
          "typicalValue": {
            "min": 1,
            "max": 5,
            "typical": 2.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "butter",
          "category": "FOOD_ITEMS",
          "typicalValue": {
            "min": 1,
            "max": 5,
            "typical": 2.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "sugar",
          "category": "FOOD_ITEMS",
          "typicalValue": {
            "min": 1,
            "max": 5,
            "typical": 2.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "milk",
          "category": "FOOD_ITEMS",
          "typicalValue": {
            "min": 1,
            "max": 5,
            "typical": 2.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "chocolate chips",
          "category": "FOOD_ITEMS",
          "typicalValue": {
            "min": 1,
            "max": 5,
            "typical": 2.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        }
      ],
      "culturalElements": [
        {
          "type": "currency",
          "value": "£",
          "explanation": "British pounds"
        },
        {
          "type": "measurement",
          "value": "grams",
          "explanation": "Weight measurement for ingredients"
        }
      ],
      "realWorldConnection": "Following recipes and calculating ingredient costs",
      "yearAppropriate": [
        3
      ],
      "templates": [
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "MULTI_STEP"
          ],
          "template": "{character} is making {recipe}. The ingredients cost {prices}. What is the total cost?",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "recipe",
              "type": "item"
            },
            {
              "key": "prices",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        }
      ]
    },
    "distractors": [
      {
        "value": 70,
        "displayText": "70",
        "strategy": "WRONG_OPERATION",
        "reasoning": "Multiplied instead of adding"
      },
      {
        "value": 51,
        "displayText": "51",
        "strategy": "PLACE_VALUE_ERROR",
        "reasoning": "Error in carrying to next column"
      },
      {
        "value": 17,
        "displayText": "17",
        "strategy": "PARTIAL_CALCULATION",
        "reasoning": "Stopped calculation early"
      }
    ],
    "enhancementStatus": {
      "level": "partial",
      "requestedFormat": "DIRECT_CALCULATION",
      "actualFormat": "DIRECT_CALCULATION",
      "featuresActive": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "featuresPending": [],
      "isFullyEnhanced": true
    },
    "mathOutput": {
      "operation": "ADDITION",
      "operand_1": 7,
      "operand_2": 10,
      "operand_3": 24,
      "result": 41
    },
    "generationTime": 1,
    "questionId": "q_1759079330405_wecoawkop",
    "generationSetup": {
      "controller_used": "DIRECT_CALCULATIONController",
      "format_requested": "DIRECT_CALCULATION",
      "format_actual": "DIRECT_CALCULATION",
      "scenario_theme": "COOKING",
      "scenario_id": "cooking-3-1759079330405",
      "scenario_selection_method": "requested",
      "distractor_strategies": [
        "WRONG_OPERATION",
        "PLACE_VALUE_ERROR",
        "PARTIAL_CALCULATION"
      ],
      "distractor_count": 3,
      "theme_variety": false,
      "format_variety": false,
      "enhancement_level": "partial",
      "features_active": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "features_pending": [],
      "generation_time_ms": 1
    }
  },
  "metadata": {
    "format": "DIRECT_CALCULATION",
    "cognitive_load": 30,
    "curriculum_alignment": [
      "3N1a",
      "3N1b"
    ],
    "difficulty": "3.1",
    "scenario_theme": "COOKING",
    "distractor_strategies": [
      "WRONG_OPERATION",
      "PLACE_VALUE_ERROR",
      "PARTIAL_CALCULATION"
    ],
    "generation_time_ms": 1,
    "api_version": "2.0",
    "enhancement_status": "partial",
    "format_requested": "DIRECT_CALCULATION",
    "format_used": "DIRECT_CALCULATION",
    "features_active": [
      "enhanced_distractors",
      "rich_scenarios",
      "cognitive_load",
      "advanced_formats"
    ],
    "features_pending": []
  },
  "context": {
    "id": "cooking-3-1759079330405",
    "theme": "COOKING",
    "setting": {
      "location": "kitchen",
      "timeContext": "weekend baking",
      "atmosphere": "creative"
    },
    "characters": [
      {
        "name": "James",
        "role": "student"
      },
      {
        "name": "Mum",
        "role": "parent"
      }
    ],
    "items": [
      {
        "name": "flour",
        "category": "FOOD_ITEMS",
        "typicalValue": {
          "min": 1,
          "max": 5,
          "typical": 2.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "eggs",
        "category": "FOOD_ITEMS",
        "typicalValue": {
          "min": 1,
          "max": 5,
          "typical": 2.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "butter",
        "category": "FOOD_ITEMS",
        "typicalValue": {
          "min": 1,
          "max": 5,
          "typical": 2.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "sugar",
        "category": "FOOD_ITEMS",
        "typicalValue": {
          "min": 1,
          "max": 5,
          "typical": 2.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "milk",
        "category": "FOOD_ITEMS",
        "typicalValue": {
          "min": 1,
          "max": 5,
          "typical": 2.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "chocolate chips",
        "category": "FOOD_ITEMS",
        "typicalValue": {
          "min": 1,
          "max": 5,
          "typical": 2.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      }
    ],
    "culturalElements": [
      {
        "type": "currency",
        "value": "£",
        "explanation": "British pounds"
      },
      {
        "type": "measurement",
        "value": "grams",
        "explanation": "Weight measurement for ingredients"
      }
    ],
    "realWorldConnection": "Following recipes and calculating ingredient costs",
    "yearAppropriate": [
      3
    ],
    "templates": [
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "MULTI_STEP"
        ],
        "template": "{character} is making {recipe}. The ingredients cost {prices}. What is the total cost?",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "recipe",
            "type": "item"
          },
          {
            "key": "prices",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      }
    ]
  }
}
# Test E.3: SPORTS theme
{
  "success": true,
  "question": {
    "text": "The football costs £20. If Oliver buys 2, how much will it cost?",
    "options": [
      {
        "text": "71",
        "value": 71,
        "index": 0
      },
      {
        "text": "£61.00",
        "value": 61,
        "index": 1
      },
      {
        "text": "14",
        "value": 14,
        "index": 2
      },
      {
        "text": "275",
        "value": 275,
        "index": 3
      }
    ],
    "correctIndex": 1,
    "format": "DIRECT_CALCULATION",
    "difficulty": {
      "year": 3,
      "subLevel": 1,
      "displayName": "3.1",
      "cognitiveLoad": 30
    },
    "cognitiveLoad": 30,
    "curriculumTags": [
      "3N1a",
      "3N1b"
    ],
    "scenario": {
      "id": "sports-3-1759079330532",
      "theme": "SPORTS",
      "setting": {
        "location": "sports shop",
        "timeContext": "weekend",
        "atmosphere": "energetic"
      },
      "characters": [
        {
          "name": "Oliver",
          "role": "student"
        },
        {
          "name": "Sophia",
          "role": "coach"
        }
      ],
      "items": [
        {
          "name": "football",
          "category": "SPORTS_EQUIPMENT",
          "typicalValue": {
            "min": 5,
            "max": 50,
            "typical": 20,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "tennis ball",
          "category": "SPORTS_EQUIPMENT",
          "typicalValue": {
            "min": 5,
            "max": 50,
            "typical": 20,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "cricket bat",
          "category": "SPORTS_EQUIPMENT",
          "typicalValue": {
            "min": 5,
            "max": 50,
            "typical": 20,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "rugby ball",
          "category": "SPORTS_EQUIPMENT",
          "typicalValue": {
            "min": 5,
            "max": 50,
            "typical": 20,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "basketball",
          "category": "SPORTS_EQUIPMENT",
          "typicalValue": {
            "min": 5,
            "max": 50,
            "typical": 20,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        }
      ],
      "culturalElements": [
        {
          "type": "currency",
          "value": "£",
          "explanation": "British pounds"
        }
      ],
      "realWorldConnection": "Calculating costs for sports activities",
      "yearAppropriate": [
        3
      ],
      "templates": [
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "MULTI_STEP"
          ],
          "template": "The {item} costs {price}. If {character} buys {quantity}, how much will it cost?",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "price",
              "type": "value"
            },
            {
              "key": "quantity",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        }
      ]
    },
    "distractors": [
      {
        "value": 14,
        "displayText": "14",
        "strategy": "WRONG_OPERATION",
        "reasoning": "Subtracted instead of adding"
      },
      {
        "value": 275,
        "displayText": "275",
        "strategy": "WRONG_OPERATION",
        "reasoning": "Multiplied instead of adding"
      },
      {
        "value": 71,
        "displayText": "71",
        "strategy": "PLACE_VALUE_ERROR",
        "reasoning": "Error in carrying to next column"
      }
    ],
    "enhancementStatus": {
      "level": "partial",
      "requestedFormat": "DIRECT_CALCULATION",
      "actualFormat": "DIRECT_CALCULATION",
      "featuresActive": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "featuresPending": [],
      "isFullyEnhanced": true
    },
    "mathOutput": {
      "operation": "ADDITION",
      "operand_1": 25,
      "operand_2": 11,
      "operand_3": 25,
      "result": 61
    },
    "generationTime": 1,
    "questionId": "q_1759079330533_h8jpgwzi3",
    "generationSetup": {
      "controller_used": "DIRECT_CALCULATIONController",
      "format_requested": "DIRECT_CALCULATION",
      "format_actual": "DIRECT_CALCULATION",
      "scenario_theme": "SPORTS",
      "scenario_id": "sports-3-1759079330532",
      "scenario_selection_method": "requested",
      "distractor_strategies": [
        "WRONG_OPERATION",
        "WRONG_OPERATION",
        "PLACE_VALUE_ERROR"
      ],
      "distractor_count": 3,
      "theme_variety": false,
      "format_variety": false,
      "enhancement_level": "partial",
      "features_active": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "features_pending": [],
      "generation_time_ms": 1
    }
  },
  "metadata": {
    "format": "DIRECT_CALCULATION",
    "cognitive_load": 30,
    "curriculum_alignment": [
      "3N1a",
      "3N1b"
    ],
    "difficulty": "3.1",
    "scenario_theme": "SPORTS",
    "distractor_strategies": [
      "WRONG_OPERATION",
      "WRONG_OPERATION",
      "PLACE_VALUE_ERROR"
    ],
    "generation_time_ms": 1,
    "api_version": "2.0",
    "enhancement_status": "partial",
    "format_requested": "DIRECT_CALCULATION",
    "format_used": "DIRECT_CALCULATION",
    "features_active": [
      "enhanced_distractors",
      "rich_scenarios",
      "cognitive_load",
      "advanced_formats"
    ],
    "features_pending": []
  },
  "context": {
    "id": "sports-3-1759079330532",
    "theme": "SPORTS",
    "setting": {
      "location": "sports shop",
      "timeContext": "weekend",
      "atmosphere": "energetic"
    },
    "characters": [
      {
        "name": "Oliver",
        "role": "student"
      },
      {
        "name": "Sophia",
        "role": "coach"
      }
    ],
    "items": [
      {
        "name": "football",
        "category": "SPORTS_EQUIPMENT",
        "typicalValue": {
          "min": 5,
          "max": 50,
          "typical": 20,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "tennis ball",
        "category": "SPORTS_EQUIPMENT",
        "typicalValue": {
          "min": 5,
          "max": 50,
          "typical": 20,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "cricket bat",
        "category": "SPORTS_EQUIPMENT",
        "typicalValue": {
          "min": 5,
          "max": 50,
          "typical": 20,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "rugby ball",
        "category": "SPORTS_EQUIPMENT",
        "typicalValue": {
          "min": 5,
          "max": 50,
          "typical": 20,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "basketball",
        "category": "SPORTS_EQUIPMENT",
        "typicalValue": {
          "min": 5,
          "max": 50,
          "typical": 20,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      }
    ],
    "culturalElements": [
      {
        "type": "currency",
        "value": "£",
        "explanation": "British pounds"
      }
    ],
    "realWorldConnection": "Calculating costs for sports activities",
    "yearAppropriate": [
      3
    ],
    "templates": [
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "MULTI_STEP"
        ],
        "template": "The {item} costs {price}. If {character} buys {quantity}, how much will it cost?",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "price",
            "type": "value"
          },
          {
            "key": "quantity",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      }
    ]
  }
}
# Test E.4: SCHOOL theme
{
  "success": true,
  "question": {
    "text": "Elizabeth needs to buy calculator, compass, protractor, highlighter for school. How much will it cost in total?",
    "options": [
      {
        "text": "4",
        "value": 4,
        "index": 0
      },
      {
        "text": "1221",
        "value": 1221,
        "index": 1
      },
      {
        "text": "£109.00",
        "value": 109,
        "index": 2
      },
      {
        "text": "209",
        "value": 209,
        "index": 3
      }
    ],
    "correctIndex": 2,
    "format": "DIRECT_CALCULATION",
    "difficulty": {
      "year": 3,
      "subLevel": 1,
      "displayName": "3.1",
      "cognitiveLoad": 30
    },
    "cognitiveLoad": 30,
    "curriculumTags": [
      "3N1a",
      "3N1b"
    ],
    "scenario": {
      "id": "school-3-1759079330671",
      "theme": "SCHOOL",
      "setting": {
        "location": "school stationery shop",
        "timeContext": "start of term",
        "atmosphere": "busy"
      },
      "characters": [
        {
          "name": "Elizabeth",
          "role": "student"
        },
        {
          "name": "Mrs. Thompson",
          "role": "teacher"
        }
      ],
      "items": [
        {
          "name": "calculator",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.5,
            "max": 15,
            "typical": 3,
            "distribution": "skewed_low"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "compass",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.5,
            "max": 15,
            "typical": 3,
            "distribution": "skewed_low"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "protractor",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.5,
            "max": 15,
            "typical": 3,
            "distribution": "skewed_low"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "highlighter",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.5,
            "max": 15,
            "typical": 3,
            "distribution": "skewed_low"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        }
      ],
      "culturalElements": [
        {
          "type": "currency",
          "value": "£",
          "explanation": "British pounds"
        },
        {
          "type": "event",
          "value": "start of term",
          "explanation": "When students buy school supplies"
        }
      ],
      "realWorldConnection": "Budgeting for school supplies",
      "yearAppropriate": [
        3
      ],
      "templates": [
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "COMPARISON"
          ],
          "template": "{character} needs to buy {items} for school. How much will it cost in total?",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "items",
              "type": "item"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        }
      ]
    },
    "distractors": [
      {
        "value": 4,
        "displayText": "4",
        "strategy": "WRONG_OPERATION",
        "reasoning": "Subtracted instead of adding"
      },
      {
        "value": 1221,
        "displayText": "1221",
        "strategy": "WRONG_OPERATION",
        "reasoning": "Multiplied instead of adding"
      },
      {
        "value": 209,
        "displayText": "209",
        "strategy": "PLACE_VALUE_ERROR",
        "reasoning": "Error in carrying to next column"
      }
    ],
    "enhancementStatus": {
      "level": "partial",
      "requestedFormat": "DIRECT_CALCULATION",
      "actualFormat": "DIRECT_CALCULATION",
      "featuresActive": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "featuresPending": [],
      "isFullyEnhanced": true
    },
    "mathOutput": {
      "operation": "ADDITION",
      "operand_1": 37,
      "operand_2": 33,
      "operand_3": 39,
      "result": 109
    },
    "generationTime": 1,
    "questionId": "q_1759079330671_dzpz418g9",
    "generationSetup": {
      "controller_used": "DIRECT_CALCULATIONController",
      "format_requested": "DIRECT_CALCULATION",
      "format_actual": "DIRECT_CALCULATION",
      "scenario_theme": "SCHOOL",
      "scenario_id": "school-3-1759079330671",
      "scenario_selection_method": "requested",
      "distractor_strategies": [
        "WRONG_OPERATION",
        "WRONG_OPERATION",
        "PLACE_VALUE_ERROR"
      ],
      "distractor_count": 3,
      "theme_variety": false,
      "format_variety": false,
      "enhancement_level": "partial",
      "features_active": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "features_pending": [],
      "generation_time_ms": 1
    }
  },
  "metadata": {
    "format": "DIRECT_CALCULATION",
    "cognitive_load": 30,
    "curriculum_alignment": [
      "3N1a",
      "3N1b"
    ],
    "difficulty": "3.1",
    "scenario_theme": "SCHOOL",
    "distractor_strategies": [
      "WRONG_OPERATION",
      "WRONG_OPERATION",
      "PLACE_VALUE_ERROR"
    ],
    "generation_time_ms": 1,
    "api_version": "2.0",
    "enhancement_status": "partial",
    "format_requested": "DIRECT_CALCULATION",
    "format_used": "DIRECT_CALCULATION",
    "features_active": [
      "enhanced_distractors",
      "rich_scenarios",
      "cognitive_load",
      "advanced_formats"
    ],
    "features_pending": []
  },
  "context": {
    "id": "school-3-1759079330671",
    "theme": "SCHOOL",
    "setting": {
      "location": "school stationery shop",
      "timeContext": "start of term",
      "atmosphere": "busy"
    },
    "characters": [
      {
        "name": "Elizabeth",
        "role": "student"
      },
      {
        "name": "Mrs. Thompson",
        "role": "teacher"
      }
    ],
    "items": [
      {
        "name": "calculator",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.5,
          "max": 15,
          "typical": 3,
          "distribution": "skewed_low"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "compass",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.5,
          "max": 15,
          "typical": 3,
          "distribution": "skewed_low"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "protractor",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.5,
          "max": 15,
          "typical": 3,
          "distribution": "skewed_low"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "highlighter",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.5,
          "max": 15,
          "typical": 3,
          "distribution": "skewed_low"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      }
    ],
    "culturalElements": [
      {
        "type": "currency",
        "value": "£",
        "explanation": "British pounds"
      },
      {
        "type": "event",
        "value": "start of term",
        "explanation": "When students buy school supplies"
      }
    ],
    "realWorldConnection": "Budgeting for school supplies",
    "yearAppropriate": [
      3
    ],
    "templates": [
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "COMPARISON"
        ],
        "template": "{character} needs to buy {items} for school. How much will it cost in total?",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "items",
            "type": "item"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      }
    ]
  }
}
# Test E.5: POCKET_MONEY theme
{
  "success": true,
  "question": {
    "text": "What is 14 + 4 + 28?",
    "options": [
      {
        "text": "18",
        "value": 18,
        "index": 0
      },
      {
        "text": "10",
        "value": 10,
        "index": 1
      },
      {
        "text": "56",
        "value": 56,
        "index": 2
      },
      {
        "text": "£46.00",
        "value": 46,
        "index": 3
      }
    ],
    "correctIndex": 3,
    "format": "DIRECT_CALCULATION",
    "difficulty": {
      "year": 3,
      "subLevel": 1,
      "displayName": "3.1",
      "cognitiveLoad": 30
    },
    "cognitiveLoad": 30,
    "curriculumTags": [
      "3N1a",
      "3N1b"
    ],
    "scenario": {
      "id": "pocket-money-3-1759079330825",
      "theme": "POCKET_MONEY",
      "setting": {
        "location": "home",
        "timeContext": "weekly",
        "atmosphere": "planning"
      },
      "characters": [
        {
          "name": "Henry",
          "role": "student"
        }
      ],
      "items": [
        {
          "name": "video game",
          "category": "SAVING_GOAL",
          "typicalValue": {
            "min": 12,
            "max": 40,
            "typical": 25,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "board game",
          "category": "SAVING_GOAL",
          "typicalValue": {
            "min": 12,
            "max": 40,
            "typical": 25,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "sports equipment",
          "category": "SAVING_GOAL",
          "typicalValue": {
            "min": 12,
            "max": 40,
            "typical": 25,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        }
      ],
      "culturalElements": [
        {
          "type": "currency",
          "value": "£",
          "explanation": "British pounds"
        },
        {
          "type": "custom",
          "value": "pocket money",
          "explanation": "Weekly allowance for children"
        }
      ],
      "realWorldConnection": "Learning to save and budget money",
      "yearAppropriate": [
        3
      ],
      "templates": [
        {
          "formatCompatibility": [
            "ESTIMATION",
            "MULTI_STEP"
          ],
          "template": "If {character} gets {amount} pocket money each week, how many weeks will it take to save for a {item} that costs {price}?",
          "answerTemplate": "It will take {result} weeks",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "amount",
              "type": "value"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "price",
              "type": "value"
            }
          ]
        }
      ]
    },
    "distractors": [
      {
        "value": 10,
        "displayText": "10",
        "strategy": "WRONG_OPERATION",
        "reasoning": "Subtracted instead of adding"
      },
      {
        "value": 56,
        "displayText": "56",
        "strategy": "WRONG_OPERATION",
        "reasoning": "Multiplied instead of adding"
      },
      {
        "value": 18,
        "displayText": "18",
        "strategy": "PARTIAL_CALCULATION",
        "reasoning": "Stopped calculation early"
      }
    ],
    "enhancementStatus": {
      "level": "partial",
      "requestedFormat": "DIRECT_CALCULATION",
      "actualFormat": "DIRECT_CALCULATION",
      "featuresActive": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "featuresPending": [],
      "isFullyEnhanced": true
    },
    "mathOutput": {
      "operation": "ADDITION",
      "operand_1": 14,
      "operand_2": 4,
      "operand_3": 28,
      "result": 46
    },
    "generationTime": 1,
    "questionId": "q_1759079330826_bp373fffu",
    "generationSetup": {
      "controller_used": "DIRECT_CALCULATIONController",
      "format_requested": "DIRECT_CALCULATION",
      "format_actual": "DIRECT_CALCULATION",
      "scenario_theme": "POCKET_MONEY",
      "scenario_id": "pocket-money-3-1759079330825",
      "scenario_selection_method": "requested",
      "distractor_strategies": [
        "WRONG_OPERATION",
        "WRONG_OPERATION",
        "PARTIAL_CALCULATION"
      ],
      "distractor_count": 3,
      "theme_variety": false,
      "format_variety": false,
      "enhancement_level": "partial",
      "features_active": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "features_pending": [],
      "generation_time_ms": 1
    }
  },
  "metadata": {
    "format": "DIRECT_CALCULATION",
    "cognitive_load": 30,
    "curriculum_alignment": [
      "3N1a",
      "3N1b"
    ],
    "difficulty": "3.1",
    "scenario_theme": "POCKET_MONEY",
    "distractor_strategies": [
      "WRONG_OPERATION",
      "WRONG_OPERATION",
      "PARTIAL_CALCULATION"
    ],
    "generation_time_ms": 1,
    "api_version": "2.0",
    "enhancement_status": "partial",
    "format_requested": "DIRECT_CALCULATION",
    "format_used": "DIRECT_CALCULATION",
    "features_active": [
      "enhanced_distractors",
      "rich_scenarios",
      "cognitive_load",
      "advanced_formats"
    ],
    "features_pending": []
  },
  "context": {
    "id": "pocket-money-3-1759079330825",
    "theme": "POCKET_MONEY",
    "setting": {
      "location": "home",
      "timeContext": "weekly",
      "atmosphere": "planning"
    },
    "characters": [
      {
        "name": "Henry",
        "role": "student"
      }
    ],
    "items": [
      {
        "name": "video game",
        "category": "SAVING_GOAL",
        "typicalValue": {
          "min": 12,
          "max": 40,
          "typical": 25,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "board game",
        "category": "SAVING_GOAL",
        "typicalValue": {
          "min": 12,
          "max": 40,
          "typical": 25,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "sports equipment",
        "category": "SAVING_GOAL",
        "typicalValue": {
          "min": 12,
          "max": 40,
          "typical": 25,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      }
    ],
    "culturalElements": [
      {
        "type": "currency",
        "value": "£",
        "explanation": "British pounds"
      },
      {
        "type": "custom",
        "value": "pocket money",
        "explanation": "Weekly allowance for children"
      }
    ],
    "realWorldConnection": "Learning to save and budget money",
    "yearAppropriate": [
      3
    ],
    "templates": [
      {
        "formatCompatibility": [
          "ESTIMATION",
          "MULTI_STEP"
        ],
        "template": "If {character} gets {amount} pocket money each week, how many weeks will it take to save for a {item} that costs {price}?",
        "answerTemplate": "It will take {result} weeks",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "amount",
            "type": "value"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "price",
            "type": "value"
          }
        ]
      }
    ]
  }
}
# Test E.6: NATURE theme
{
  "success": true,
  "question": {
    "text": "Charlotte collected flower, leaf, stone, stick, acorn, feather, shell, pine cone while exploring. How many items in total?",
    "options": [
      {
        "text": "1260",
        "value": 1260,
        "index": 0
      },
      {
        "text": "1",
        "value": 1,
        "index": 1
      },
      {
        "text": "210",
        "value": 210,
        "index": 2
      },
      {
        "text": "110",
        "value": 110,
        "index": 3
      }
    ],
    "correctIndex": 3,
    "format": "DIRECT_CALCULATION",
    "difficulty": {
      "year": 3,
      "subLevel": 1,
      "displayName": "3.1",
      "cognitiveLoad": 30
    },
    "cognitiveLoad": 30,
    "curriculumTags": [
      "3N1a",
      "3N1b"
    ],
    "scenario": {
      "id": "nature-3-1759079330982",
      "theme": "NATURE",
      "setting": {
        "location": "garden",
        "timeContext": "outdoor exploration",
        "atmosphere": "peaceful"
      },
      "characters": [
        {
          "name": "Charlotte",
          "role": "student"
        },
        {
          "name": "Mr. Green",
          "role": "park ranger"
        }
      ],
      "items": [
        {
          "name": "flower",
          "category": "NATURE_ITEMS",
          "typicalValue": {
            "min": 1,
            "max": 20,
            "typical": 5,
            "distribution": "normal"
          },
          "unit": "items",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "leaf",
          "category": "NATURE_ITEMS",
          "typicalValue": {
            "min": 1,
            "max": 20,
            "typical": 5,
            "distribution": "normal"
          },
          "unit": "items",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "stone",
          "category": "NATURE_ITEMS",
          "typicalValue": {
            "min": 1,
            "max": 20,
            "typical": 5,
            "distribution": "normal"
          },
          "unit": "items",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "stick",
          "category": "NATURE_ITEMS",
          "typicalValue": {
            "min": 1,
            "max": 20,
            "typical": 5,
            "distribution": "normal"
          },
          "unit": "items",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "acorn",
          "category": "NATURE_ITEMS",
          "typicalValue": {
            "min": 1,
            "max": 20,
            "typical": 5,
            "distribution": "normal"
          },
          "unit": "items",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "feather",
          "category": "NATURE_ITEMS",
          "typicalValue": {
            "min": 1,
            "max": 20,
            "typical": 5,
            "distribution": "normal"
          },
          "unit": "items",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "shell",
          "category": "NATURE_ITEMS",
          "typicalValue": {
            "min": 1,
            "max": 20,
            "typical": 5,
            "distribution": "normal"
          },
          "unit": "items",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "pine cone",
          "category": "NATURE_ITEMS",
          "typicalValue": {
            "min": 1,
            "max": 20,
            "typical": 5,
            "distribution": "normal"
          },
          "unit": "items",
          "attributes": {
            "quality": "standard"
          }
        }
      ],
      "culturalElements": [
        {
          "type": "location",
          "value": "UK countryside",
          "explanation": "British natural environments"
        }
      ],
      "realWorldConnection": "Counting and collecting in nature",
      "yearAppropriate": [
        3
      ],
      "templates": [
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "COMPARISON"
          ],
          "template": "{character} collected {items} while exploring. How many items in total?",
          "answerTemplate": "{character} collected {result} items",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "items",
              "type": "item"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        }
      ]
    },
    "distractors": [
      {
        "value": 1,
        "displayText": "1",
        "strategy": "WRONG_OPERATION",
        "reasoning": "Subtracted instead of adding"
      },
      {
        "value": 1260,
        "displayText": "1260",
        "strategy": "WRONG_OPERATION",
        "reasoning": "Multiplied instead of adding"
      },
      {
        "value": 210,
        "displayText": "210",
        "strategy": "PLACE_VALUE_ERROR",
        "reasoning": "Error in carrying to next column"
      }
    ],
    "enhancementStatus": {
      "level": "partial",
      "requestedFormat": "DIRECT_CALCULATION",
      "actualFormat": "DIRECT_CALCULATION",
      "featuresActive": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "featuresPending": [],
      "isFullyEnhanced": true
    },
    "mathOutput": {
      "operation": "ADDITION",
      "operand_1": 36,
      "operand_2": 35,
      "operand_3": 39,
      "result": 110
    },
    "generationTime": 1,
    "questionId": "q_1759079330982_i1d67vbek",
    "generationSetup": {
      "controller_used": "DIRECT_CALCULATIONController",
      "format_requested": "DIRECT_CALCULATION",
      "format_actual": "DIRECT_CALCULATION",
      "scenario_theme": "NATURE",
      "scenario_id": "nature-3-1759079330982",
      "scenario_selection_method": "requested",
      "distractor_strategies": [
        "WRONG_OPERATION",
        "WRONG_OPERATION",
        "PLACE_VALUE_ERROR"
      ],
      "distractor_count": 3,
      "theme_variety": false,
      "format_variety": false,
      "enhancement_level": "partial",
      "features_active": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "features_pending": [],
      "generation_time_ms": 1
    }
  },
  "metadata": {
    "format": "DIRECT_CALCULATION",
    "cognitive_load": 30,
    "curriculum_alignment": [
      "3N1a",
      "3N1b"
    ],
    "difficulty": "3.1",
    "scenario_theme": "NATURE",
    "distractor_strategies": [
      "WRONG_OPERATION",
      "WRONG_OPERATION",
      "PLACE_VALUE_ERROR"
    ],
    "generation_time_ms": 1,
    "api_version": "2.0",
    "enhancement_status": "partial",
    "format_requested": "DIRECT_CALCULATION",
    "format_used": "DIRECT_CALCULATION",
    "features_active": [
      "enhanced_distractors",
      "rich_scenarios",
      "cognitive_load",
      "advanced_formats"
    ],
    "features_pending": []
  },
  "context": {
    "id": "nature-3-1759079330982",
    "theme": "NATURE",
    "setting": {
      "location": "garden",
      "timeContext": "outdoor exploration",
      "atmosphere": "peaceful"
    },
    "characters": [
      {
        "name": "Charlotte",
        "role": "student"
      },
      {
        "name": "Mr. Green",
        "role": "park ranger"
      }
    ],
    "items": [
      {
        "name": "flower",
        "category": "NATURE_ITEMS",
        "typicalValue": {
          "min": 1,
          "max": 20,
          "typical": 5,
          "distribution": "normal"
        },
        "unit": "items",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "leaf",
        "category": "NATURE_ITEMS",
        "typicalValue": {
          "min": 1,
          "max": 20,
          "typical": 5,
          "distribution": "normal"
        },
        "unit": "items",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "stone",
        "category": "NATURE_ITEMS",
        "typicalValue": {
          "min": 1,
          "max": 20,
          "typical": 5,
          "distribution": "normal"
        },
        "unit": "items",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "stick",
        "category": "NATURE_ITEMS",
        "typicalValue": {
          "min": 1,
          "max": 20,
          "typical": 5,
          "distribution": "normal"
        },
        "unit": "items",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "acorn",
        "category": "NATURE_ITEMS",
        "typicalValue": {
          "min": 1,
          "max": 20,
          "typical": 5,
          "distribution": "normal"
        },
        "unit": "items",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "feather",
        "category": "NATURE_ITEMS",
        "typicalValue": {
          "min": 1,
          "max": 20,
          "typical": 5,
          "distribution": "normal"
        },
        "unit": "items",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "shell",
        "category": "NATURE_ITEMS",
        "typicalValue": {
          "min": 1,
          "max": 20,
          "typical": 5,
          "distribution": "normal"
        },
        "unit": "items",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "pine cone",
        "category": "NATURE_ITEMS",
        "typicalValue": {
          "min": 1,
          "max": 20,
          "typical": 5,
          "distribution": "normal"
        },
        "unit": "items",
        "attributes": {
          "quality": "standard"
        }
      }
    ],
    "culturalElements": [
      {
        "type": "location",
        "value": "UK countryside",
        "explanation": "British natural environments"
      }
    ],
    "realWorldConnection": "Counting and collecting in nature",
    "yearAppropriate": [
      3
    ],
    "templates": [
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "COMPARISON"
        ],
        "template": "{character} collected {items} while exploring. How many items in total?",
        "answerTemplate": "{character} collected {result} items",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "items",
            "type": "item"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      }
    ]
  }
}
# Test E.7: TRANSPORT theme
{
  "success": true,
  "question": {
    "text": "A {transport} journey costs £34. How much for 37 journeys?",
    "options": [
      {
        "text": "1258",
        "value": 1258,
        "index": 0
      },
      {
        "text": "105",
        "value": 105,
        "index": 1
      },
      {
        "text": "71",
        "value": 71,
        "index": 2
      },
      {
        "text": "£95.00",
        "value": 95,
        "index": 3
      }
    ],
    "correctIndex": 3,
    "format": "DIRECT_CALCULATION",
    "difficulty": {
      "year": 3,
      "subLevel": 1,
      "displayName": "3.1",
      "cognitiveLoad": 30
    },
    "cognitiveLoad": 30,
    "curriculumTags": [
      "3N1a",
      "3N1b"
    ],
    "scenario": {
      "id": "transport-3-1759079331105",
      "theme": "TRANSPORT",
      "setting": {
        "location": "transport hub",
        "timeContext": "journey planning",
        "atmosphere": "busy"
      },
      "characters": [
        {
          "name": "Elijah",
          "role": "passenger"
        },
        {
          "name": "Mrs. Driver",
          "role": "transport operator"
        }
      ],
      "items": [
        {
          "name": "bus",
          "category": "TRANSPORT",
          "typicalValue": {
            "min": 1.5,
            "max": 15,
            "typical": 5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "train",
          "category": "TRANSPORT",
          "typicalValue": {
            "min": 1.5,
            "max": 15,
            "typical": 5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "taxi",
          "category": "TRANSPORT",
          "typicalValue": {
            "min": 1.5,
            "max": 15,
            "typical": 5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "tube",
          "category": "TRANSPORT",
          "typicalValue": {
            "min": 1.5,
            "max": 15,
            "typical": 5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "bike",
          "category": "TRANSPORT",
          "typicalValue": {
            "min": 1.5,
            "max": 15,
            "typical": 5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        }
      ],
      "culturalElements": [
        {
          "type": "currency",
          "value": "£",
          "explanation": "British pounds for transport fares"
        }
      ],
      "realWorldConnection": "Calculating travel costs and distances",
      "yearAppropriate": [
        3
      ],
      "templates": [
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "MULTI_STEP"
          ],
          "template": "A {transport} journey costs {price}. How much for {quantity} journeys?",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "transport",
              "type": "item"
            },
            {
              "key": "price",
              "type": "value"
            },
            {
              "key": "quantity",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        }
      ]
    },
    "distractors": [
      {
        "value": 1258,
        "displayText": "1258",
        "strategy": "WRONG_OPERATION",
        "reasoning": "Multiplied instead of adding"
      },
      {
        "value": 105,
        "displayText": "105",
        "strategy": "PLACE_VALUE_ERROR",
        "reasoning": "Error in carrying to next column"
      },
      {
        "value": 71,
        "displayText": "71",
        "strategy": "PARTIAL_CALCULATION",
        "reasoning": "Stopped calculation early"
      }
    ],
    "enhancementStatus": {
      "level": "partial",
      "requestedFormat": "DIRECT_CALCULATION",
      "actualFormat": "DIRECT_CALCULATION",
      "featuresActive": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "featuresPending": [],
      "isFullyEnhanced": true
    },
    "mathOutput": {
      "operation": "ADDITION",
      "operand_1": 34,
      "operand_2": 37,
      "operand_3": 24,
      "result": 95
    },
    "generationTime": 1,
    "questionId": "q_1759079331105_gwyg2bv7v",
    "generationSetup": {
      "controller_used": "DIRECT_CALCULATIONController",
      "format_requested": "DIRECT_CALCULATION",
      "format_actual": "DIRECT_CALCULATION",
      "scenario_theme": "TRANSPORT",
      "scenario_id": "transport-3-1759079331105",
      "scenario_selection_method": "requested",
      "distractor_strategies": [
        "WRONG_OPERATION",
        "PLACE_VALUE_ERROR",
        "PARTIAL_CALCULATION"
      ],
      "distractor_count": 3,
      "theme_variety": false,
      "format_variety": false,
      "enhancement_level": "partial",
      "features_active": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "features_pending": [],
      "generation_time_ms": 1
    }
  },
  "metadata": {
    "format": "DIRECT_CALCULATION",
    "cognitive_load": 30,
    "curriculum_alignment": [
      "3N1a",
      "3N1b"
    ],
    "difficulty": "3.1",
    "scenario_theme": "TRANSPORT",
    "distractor_strategies": [
      "WRONG_OPERATION",
      "PLACE_VALUE_ERROR",
      "PARTIAL_CALCULATION"
    ],
    "generation_time_ms": 1,
    "api_version": "2.0",
    "enhancement_status": "partial",
    "format_requested": "DIRECT_CALCULATION",
    "format_used": "DIRECT_CALCULATION",
    "features_active": [
      "enhanced_distractors",
      "rich_scenarios",
      "cognitive_load",
      "advanced_formats"
    ],
    "features_pending": []
  },
  "context": {
    "id": "transport-3-1759079331105",
    "theme": "TRANSPORT",
    "setting": {
      "location": "transport hub",
      "timeContext": "journey planning",
      "atmosphere": "busy"
    },
    "characters": [
      {
        "name": "Elijah",
        "role": "passenger"
      },
      {
        "name": "Mrs. Driver",
        "role": "transport operator"
      }
    ],
    "items": [
      {
        "name": "bus",
        "category": "TRANSPORT",
        "typicalValue": {
          "min": 1.5,
          "max": 15,
          "typical": 5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "train",
        "category": "TRANSPORT",
        "typicalValue": {
          "min": 1.5,
          "max": 15,
          "typical": 5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "taxi",
        "category": "TRANSPORT",
        "typicalValue": {
          "min": 1.5,
          "max": 15,
          "typical": 5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "tube",
        "category": "TRANSPORT",
        "typicalValue": {
          "min": 1.5,
          "max": 15,
          "typical": 5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "bike",
        "category": "TRANSPORT",
        "typicalValue": {
          "min": 1.5,
          "max": 15,
          "typical": 5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      }
    ],
    "culturalElements": [
      {
        "type": "currency",
        "value": "£",
        "explanation": "British pounds for transport fares"
      }
    ],
    "realWorldConnection": "Calculating travel costs and distances",
    "yearAppropriate": [
      3
    ],
    "templates": [
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "MULTI_STEP"
        ],
        "template": "A {transport} journey costs {price}. How much for {quantity} journeys?",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "transport",
            "type": "item"
          },
          {
            "key": "price",
            "type": "value"
          },
          {
            "key": "quantity",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      }
    ]
  }
}
# Test E.8: COLLECTIONS theme
{
  "success": true,
  "question": {
    "text": "James has sticker, card, coin, stamp, badge, marble, button in their collection. How many altogether?",
    "options": [
      {
        "text": "1131",
        "value": 1131,
        "index": 0
      },
      {
        "text": "10",
        "value": 10,
        "index": 1
      },
      {
        "text": "102",
        "value": 102,
        "index": 2
      },
      {
        "text": "92",
        "value": 92,
        "index": 3
      }
    ],
    "correctIndex": 3,
    "format": "DIRECT_CALCULATION",
    "difficulty": {
      "year": 3,
      "subLevel": 1,
      "displayName": "3.1",
      "cognitiveLoad": 30
    },
    "cognitiveLoad": 30,
    "curriculumTags": [
      "3N1a",
      "3N1b"
    ],
    "scenario": {
      "id": "collections-3-1759079331258",
      "theme": "COLLECTIONS",
      "setting": {
        "location": "bedroom",
        "timeContext": "organizing collection",
        "atmosphere": "focused"
      },
      "characters": [
        {
          "name": "James",
          "role": "collector"
        },
        {
          "name": "Emma",
          "role": "friend"
        }
      ],
      "items": [
        {
          "name": "sticker",
          "category": "COLLECTIBLES",
          "typicalValue": {
            "min": 1,
            "max": 50,
            "typical": 10,
            "distribution": "normal"
          },
          "unit": "items",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "card",
          "category": "COLLECTIBLES",
          "typicalValue": {
            "min": 1,
            "max": 50,
            "typical": 10,
            "distribution": "normal"
          },
          "unit": "items",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "coin",
          "category": "COLLECTIBLES",
          "typicalValue": {
            "min": 1,
            "max": 50,
            "typical": 10,
            "distribution": "normal"
          },
          "unit": "items",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "stamp",
          "category": "COLLECTIBLES",
          "typicalValue": {
            "min": 1,
            "max": 50,
            "typical": 10,
            "distribution": "normal"
          },
          "unit": "items",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "badge",
          "category": "COLLECTIBLES",
          "typicalValue": {
            "min": 1,
            "max": 50,
            "typical": 10,
            "distribution": "normal"
          },
          "unit": "items",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "marble",
          "category": "COLLECTIBLES",
          "typicalValue": {
            "min": 1,
            "max": 50,
            "typical": 10,
            "distribution": "normal"
          },
          "unit": "items",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "button",
          "category": "COLLECTIBLES",
          "typicalValue": {
            "min": 1,
            "max": 50,
            "typical": 10,
            "distribution": "normal"
          },
          "unit": "items",
          "attributes": {
            "quality": "standard"
          }
        }
      ],
      "culturalElements": [
        {
          "type": "hobby",
          "value": "collecting",
          "explanation": "Popular childhood hobby"
        }
      ],
      "realWorldConnection": "Organizing and counting collections",
      "yearAppropriate": [
        3
      ],
      "templates": [
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "ORDERING"
          ],
          "template": "{character} has {items} in their collection. How many altogether?",
          "answerTemplate": "{character} has {result} items total",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "items",
              "type": "item"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        }
      ]
    },
    "distractors": [
      {
        "value": 10,
        "displayText": "10",
        "strategy": "WRONG_OPERATION",
        "reasoning": "Subtracted instead of adding"
      },
      {
        "value": 1131,
        "displayText": "1131",
        "strategy": "WRONG_OPERATION",
        "reasoning": "Multiplied instead of adding"
      },
      {
        "value": 102,
        "displayText": "102",
        "strategy": "PLACE_VALUE_ERROR",
        "reasoning": "Error in carrying to next column"
      }
    ],
    "enhancementStatus": {
      "level": "partial",
      "requestedFormat": "DIRECT_CALCULATION",
      "actualFormat": "DIRECT_CALCULATION",
      "featuresActive": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "featuresPending": [],
      "isFullyEnhanced": true
    },
    "mathOutput": {
      "operation": "ADDITION",
      "operand_1": 39,
      "operand_2": 29,
      "operand_3": 24,
      "result": 92
    },
    "generationTime": 1,
    "questionId": "q_1759079331258_rsaw8fbao",
    "generationSetup": {
      "controller_used": "DIRECT_CALCULATIONController",
      "format_requested": "DIRECT_CALCULATION",
      "format_actual": "DIRECT_CALCULATION",
      "scenario_theme": "COLLECTIONS",
      "scenario_id": "collections-3-1759079331258",
      "scenario_selection_method": "requested",
      "distractor_strategies": [
        "WRONG_OPERATION",
        "WRONG_OPERATION",
        "PLACE_VALUE_ERROR"
      ],
      "distractor_count": 3,
      "theme_variety": false,
      "format_variety": false,
      "enhancement_level": "partial",
      "features_active": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "features_pending": [],
      "generation_time_ms": 1
    }
  },
  "metadata": {
    "format": "DIRECT_CALCULATION",
    "cognitive_load": 30,
    "curriculum_alignment": [
      "3N1a",
      "3N1b"
    ],
    "difficulty": "3.1",
    "scenario_theme": "COLLECTIONS",
    "distractor_strategies": [
      "WRONG_OPERATION",
      "WRONG_OPERATION",
      "PLACE_VALUE_ERROR"
    ],
    "generation_time_ms": 1,
    "api_version": "2.0",
    "enhancement_status": "partial",
    "format_requested": "DIRECT_CALCULATION",
    "format_used": "DIRECT_CALCULATION",
    "features_active": [
      "enhanced_distractors",
      "rich_scenarios",
      "cognitive_load",
      "advanced_formats"
    ],
    "features_pending": []
  },
  "context": {
    "id": "collections-3-1759079331258",
    "theme": "COLLECTIONS",
    "setting": {
      "location": "bedroom",
      "timeContext": "organizing collection",
      "atmosphere": "focused"
    },
    "characters": [
      {
        "name": "James",
        "role": "collector"
      },
      {
        "name": "Emma",
        "role": "friend"
      }
    ],
    "items": [
      {
        "name": "sticker",
        "category": "COLLECTIBLES",
        "typicalValue": {
          "min": 1,
          "max": 50,
          "typical": 10,
          "distribution": "normal"
        },
        "unit": "items",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "card",
        "category": "COLLECTIBLES",
        "typicalValue": {
          "min": 1,
          "max": 50,
          "typical": 10,
          "distribution": "normal"
        },
        "unit": "items",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "coin",
        "category": "COLLECTIBLES",
        "typicalValue": {
          "min": 1,
          "max": 50,
          "typical": 10,
          "distribution": "normal"
        },
        "unit": "items",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "stamp",
        "category": "COLLECTIBLES",
        "typicalValue": {
          "min": 1,
          "max": 50,
          "typical": 10,
          "distribution": "normal"
        },
        "unit": "items",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "badge",
        "category": "COLLECTIBLES",
        "typicalValue": {
          "min": 1,
          "max": 50,
          "typical": 10,
          "distribution": "normal"
        },
        "unit": "items",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "marble",
        "category": "COLLECTIBLES",
        "typicalValue": {
          "min": 1,
          "max": 50,
          "typical": 10,
          "distribution": "normal"
        },
        "unit": "items",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "button",
        "category": "COLLECTIBLES",
        "typicalValue": {
          "min": 1,
          "max": 50,
          "typical": 10,
          "distribution": "normal"
        },
        "unit": "items",
        "attributes": {
          "quality": "standard"
        }
      }
    ],
    "culturalElements": [
      {
        "type": "hobby",
        "value": "collecting",
        "explanation": "Popular childhood hobby"
      }
    ],
    "realWorldConnection": "Organizing and counting collections",
    "yearAppropriate": [
      3
    ],
    "templates": [
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "ORDERING"
        ],
        "template": "{character} has {items} in their collection. How many altogether?",
        "answerTemplate": "{character} has {result} items total",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "items",
            "type": "item"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      }
    ]
  }
}
# Test E.9: HOUSEHOLD theme
{
  "success": true,
  "question": {
    "text": "Elijah needs to tidy cup, plate, spoon, towel, pillow, book, toy, sock. How many items to put away?",
    "options": [
      {
        "text": "104",
        "value": 104,
        "index": 0
      },
      {
        "text": "63",
        "value": 63,
        "index": 1
      },
      {
        "text": "94",
        "value": 94,
        "index": 2
      },
      {
        "text": "980",
        "value": 980,
        "index": 3
      }
    ],
    "correctIndex": 2,
    "format": "DIRECT_CALCULATION",
    "difficulty": {
      "year": 3,
      "subLevel": 1,
      "displayName": "3.1",
      "cognitiveLoad": 30
    },
    "cognitiveLoad": 30,
    "curriculumTags": [
      "3N1a",
      "3N1b"
    ],
    "scenario": {
      "id": "household-3-1759079331408",
      "theme": "HOUSEHOLD",
      "setting": {
        "location": "living room",
        "timeContext": "tidying up",
        "atmosphere": "homely"
      },
      "characters": [
        {
          "name": "Elijah",
          "role": "child"
        },
        {
          "name": "Mum",
          "role": "parent"
        }
      ],
      "items": [
        {
          "name": "cup",
          "category": "HOUSEHOLD_ITEMS",
          "typicalValue": {
            "min": 1,
            "max": 30,
            "typical": 8,
            "distribution": "normal"
          },
          "unit": "items",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "plate",
          "category": "HOUSEHOLD_ITEMS",
          "typicalValue": {
            "min": 1,
            "max": 30,
            "typical": 8,
            "distribution": "normal"
          },
          "unit": "items",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "spoon",
          "category": "HOUSEHOLD_ITEMS",
          "typicalValue": {
            "min": 1,
            "max": 30,
            "typical": 8,
            "distribution": "normal"
          },
          "unit": "items",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "towel",
          "category": "HOUSEHOLD_ITEMS",
          "typicalValue": {
            "min": 1,
            "max": 30,
            "typical": 8,
            "distribution": "normal"
          },
          "unit": "items",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "pillow",
          "category": "HOUSEHOLD_ITEMS",
          "typicalValue": {
            "min": 1,
            "max": 30,
            "typical": 8,
            "distribution": "normal"
          },
          "unit": "items",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "book",
          "category": "HOUSEHOLD_ITEMS",
          "typicalValue": {
            "min": 1,
            "max": 30,
            "typical": 8,
            "distribution": "normal"
          },
          "unit": "items",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "toy",
          "category": "HOUSEHOLD_ITEMS",
          "typicalValue": {
            "min": 1,
            "max": 30,
            "typical": 8,
            "distribution": "normal"
          },
          "unit": "items",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "sock",
          "category": "HOUSEHOLD_ITEMS",
          "typicalValue": {
            "min": 1,
            "max": 30,
            "typical": 8,
            "distribution": "normal"
          },
          "unit": "items",
          "attributes": {
            "quality": "standard"
          }
        }
      ],
      "culturalElements": [
        {
          "type": "custom",
          "value": "household chores",
          "explanation": "Daily home activities"
        }
      ],
      "realWorldConnection": "Organizing and counting household items",
      "yearAppropriate": [
        3
      ],
      "templates": [
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "COMPARISON"
          ],
          "template": "{character} needs to tidy {items}. How many items to put away?",
          "answerTemplate": "{character} needs to put away {result} items",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "items",
              "type": "item"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        }
      ]
    },
    "distractors": [
      {
        "value": 980,
        "displayText": "980",
        "strategy": "WRONG_OPERATION",
        "reasoning": "Multiplied instead of adding"
      },
      {
        "value": 104,
        "displayText": "104",
        "strategy": "PLACE_VALUE_ERROR",
        "reasoning": "Error in carrying to next column"
      },
      {
        "value": 63,
        "displayText": "63",
        "strategy": "PARTIAL_CALCULATION",
        "reasoning": "Stopped calculation early"
      }
    ],
    "enhancementStatus": {
      "level": "partial",
      "requestedFormat": "DIRECT_CALCULATION",
      "actualFormat": "DIRECT_CALCULATION",
      "featuresActive": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "featuresPending": [],
      "isFullyEnhanced": true
    },
    "mathOutput": {
      "operation": "ADDITION",
      "operand_1": 28,
      "operand_2": 35,
      "operand_3": 31,
      "result": 94
    },
    "generationTime": 1,
    "questionId": "q_1759079331409_t200pwfu6",
    "generationSetup": {
      "controller_used": "DIRECT_CALCULATIONController",
      "format_requested": "DIRECT_CALCULATION",
      "format_actual": "DIRECT_CALCULATION",
      "scenario_theme": "HOUSEHOLD",
      "scenario_id": "household-3-1759079331408",
      "scenario_selection_method": "requested",
      "distractor_strategies": [
        "WRONG_OPERATION",
        "PLACE_VALUE_ERROR",
        "PARTIAL_CALCULATION"
      ],
      "distractor_count": 3,
      "theme_variety": false,
      "format_variety": false,
      "enhancement_level": "partial",
      "features_active": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "features_pending": [],
      "generation_time_ms": 1
    }
  },
  "metadata": {
    "format": "DIRECT_CALCULATION",
    "cognitive_load": 30,
    "curriculum_alignment": [
      "3N1a",
      "3N1b"
    ],
    "difficulty": "3.1",
    "scenario_theme": "HOUSEHOLD",
    "distractor_strategies": [
      "WRONG_OPERATION",
      "PLACE_VALUE_ERROR",
      "PARTIAL_CALCULATION"
    ],
    "generation_time_ms": 1,
    "api_version": "2.0",
    "enhancement_status": "partial",
    "format_requested": "DIRECT_CALCULATION",
    "format_used": "DIRECT_CALCULATION",
    "features_active": [
      "enhanced_distractors",
      "rich_scenarios",
      "cognitive_load",
      "advanced_formats"
    ],
    "features_pending": []
  },
  "context": {
    "id": "household-3-1759079331408",
    "theme": "HOUSEHOLD",
    "setting": {
      "location": "living room",
      "timeContext": "tidying up",
      "atmosphere": "homely"
    },
    "characters": [
      {
        "name": "Elijah",
        "role": "child"
      },
      {
        "name": "Mum",
        "role": "parent"
      }
    ],
    "items": [
      {
        "name": "cup",
        "category": "HOUSEHOLD_ITEMS",
        "typicalValue": {
          "min": 1,
          "max": 30,
          "typical": 8,
          "distribution": "normal"
        },
        "unit": "items",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "plate",
        "category": "HOUSEHOLD_ITEMS",
        "typicalValue": {
          "min": 1,
          "max": 30,
          "typical": 8,
          "distribution": "normal"
        },
        "unit": "items",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "spoon",
        "category": "HOUSEHOLD_ITEMS",
        "typicalValue": {
          "min": 1,
          "max": 30,
          "typical": 8,
          "distribution": "normal"
        },
        "unit": "items",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "towel",
        "category": "HOUSEHOLD_ITEMS",
        "typicalValue": {
          "min": 1,
          "max": 30,
          "typical": 8,
          "distribution": "normal"
        },
        "unit": "items",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "pillow",
        "category": "HOUSEHOLD_ITEMS",
        "typicalValue": {
          "min": 1,
          "max": 30,
          "typical": 8,
          "distribution": "normal"
        },
        "unit": "items",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "book",
        "category": "HOUSEHOLD_ITEMS",
        "typicalValue": {
          "min": 1,
          "max": 30,
          "typical": 8,
          "distribution": "normal"
        },
        "unit": "items",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "toy",
        "category": "HOUSEHOLD_ITEMS",
        "typicalValue": {
          "min": 1,
          "max": 30,
          "typical": 8,
          "distribution": "normal"
        },
        "unit": "items",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "sock",
        "category": "HOUSEHOLD_ITEMS",
        "typicalValue": {
          "min": 1,
          "max": 30,
          "typical": 8,
          "distribution": "normal"
        },
        "unit": "items",
        "attributes": {
          "quality": "standard"
        }
      }
    ],
    "culturalElements": [
      {
        "type": "custom",
        "value": "household chores",
        "explanation": "Daily home activities"
      }
    ],
    "realWorldConnection": "Organizing and counting household items",
    "yearAppropriate": [
      3
    ],
    "templates": [
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "COMPARISON"
        ],
        "template": "{character} needs to tidy {items}. How many items to put away?",
        "answerTemplate": "{character} needs to put away {result} items",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "items",
            "type": "item"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      }
    ]
  }
}
# Test E.10: CELEBRATIONS theme
{
  "success": true,
  "question": {
    "text": "Liam is planning a {celebration}. The supplies cost £32.00, £21.00. What is the total?",
    "options": [
      {
        "text": "102",
        "value": 102,
        "index": 0
      },
      {
        "text": "672",
        "value": 672,
        "index": 1
      },
      {
        "text": "£92.00",
        "value": 92,
        "index": 2
      },
      {
        "text": "11",
        "value": 11,
        "index": 3
      }
    ],
    "correctIndex": 2,
    "format": "DIRECT_CALCULATION",
    "difficulty": {
      "year": 3,
      "subLevel": 1,
      "displayName": "3.1",
      "cognitiveLoad": 30
    },
    "cognitiveLoad": 30,
    "curriculumTags": [
      "3N1a",
      "3N1b"
    ],
    "scenario": {
      "id": "celebrations-3-1759079331547",
      "theme": "CELEBRATIONS",
      "setting": {
        "location": "party venue",
        "timeContext": "celebration planning",
        "atmosphere": "festive"
      },
      "characters": [
        {
          "name": "Liam",
          "role": "party organizer"
        },
        {
          "name": "Liam",
          "role": "guest"
        }
      ],
      "items": [
        {
          "name": "balloon",
          "category": "PARTY_SUPPLIES",
          "typicalValue": {
            "min": 0.5,
            "max": 20,
            "typical": 5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "cake",
          "category": "PARTY_SUPPLIES",
          "typicalValue": {
            "min": 0.5,
            "max": 20,
            "typical": 5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "present",
          "category": "PARTY_SUPPLIES",
          "typicalValue": {
            "min": 0.5,
            "max": 20,
            "typical": 5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "decoration",
          "category": "PARTY_SUPPLIES",
          "typicalValue": {
            "min": 0.5,
            "max": 20,
            "typical": 5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "party hat",
          "category": "PARTY_SUPPLIES",
          "typicalValue": {
            "min": 0.5,
            "max": 20,
            "typical": 5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "candle",
          "category": "PARTY_SUPPLIES",
          "typicalValue": {
            "min": 0.5,
            "max": 20,
            "typical": 5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        }
      ],
      "culturalElements": [
        {
          "type": "currency",
          "value": "£",
          "explanation": "British pounds for party supplies"
        },
        {
          "type": "event",
          "value": "celebration",
          "explanation": "Special occasions and festivals"
        }
      ],
      "realWorldConnection": "Planning and budgeting for celebrations",
      "yearAppropriate": [
        3
      ],
      "templates": [
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "MULTI_STEP"
          ],
          "template": "{character} is planning a {celebration}. The supplies cost {prices}. What is the total?",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "celebration",
              "type": "event"
            },
            {
              "key": "prices",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        }
      ]
    },
    "distractors": [
      {
        "value": 11,
        "displayText": "11",
        "strategy": "WRONG_OPERATION",
        "reasoning": "Subtracted instead of adding"
      },
      {
        "value": 672,
        "displayText": "672",
        "strategy": "WRONG_OPERATION",
        "reasoning": "Multiplied instead of adding"
      },
      {
        "value": 102,
        "displayText": "102",
        "strategy": "PLACE_VALUE_ERROR",
        "reasoning": "Error in carrying to next column"
      }
    ],
    "enhancementStatus": {
      "level": "partial",
      "requestedFormat": "DIRECT_CALCULATION",
      "actualFormat": "DIRECT_CALCULATION",
      "featuresActive": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "featuresPending": [],
      "isFullyEnhanced": true
    },
    "mathOutput": {
      "operation": "ADDITION",
      "operand_1": 32,
      "operand_2": 21,
      "operand_3": 39,
      "result": 92
    },
    "generationTime": 1,
    "questionId": "q_1759079331547_0mpq76bg9",
    "generationSetup": {
      "controller_used": "DIRECT_CALCULATIONController",
      "format_requested": "DIRECT_CALCULATION",
      "format_actual": "DIRECT_CALCULATION",
      "scenario_theme": "CELEBRATIONS",
      "scenario_id": "celebrations-3-1759079331547",
      "scenario_selection_method": "requested",
      "distractor_strategies": [
        "WRONG_OPERATION",
        "WRONG_OPERATION",
        "PLACE_VALUE_ERROR"
      ],
      "distractor_count": 3,
      "theme_variety": false,
      "format_variety": false,
      "enhancement_level": "partial",
      "features_active": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "features_pending": [],
      "generation_time_ms": 1
    }
  },
  "metadata": {
    "format": "DIRECT_CALCULATION",
    "cognitive_load": 30,
    "curriculum_alignment": [
      "3N1a",
      "3N1b"
    ],
    "difficulty": "3.1",
    "scenario_theme": "CELEBRATIONS",
    "distractor_strategies": [
      "WRONG_OPERATION",
      "WRONG_OPERATION",
      "PLACE_VALUE_ERROR"
    ],
    "generation_time_ms": 1,
    "api_version": "2.0",
    "enhancement_status": "partial",
    "format_requested": "DIRECT_CALCULATION",
    "format_used": "DIRECT_CALCULATION",
    "features_active": [
      "enhanced_distractors",
      "rich_scenarios",
      "cognitive_load",
      "advanced_formats"
    ],
    "features_pending": []
  },
  "context": {
    "id": "celebrations-3-1759079331547",
    "theme": "CELEBRATIONS",
    "setting": {
      "location": "party venue",
      "timeContext": "celebration planning",
      "atmosphere": "festive"
    },
    "characters": [
      {
        "name": "Liam",
        "role": "party organizer"
      },
      {
        "name": "Liam",
        "role": "guest"
      }
    ],
    "items": [
      {
        "name": "balloon",
        "category": "PARTY_SUPPLIES",
        "typicalValue": {
          "min": 0.5,
          "max": 20,
          "typical": 5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "cake",
        "category": "PARTY_SUPPLIES",
        "typicalValue": {
          "min": 0.5,
          "max": 20,
          "typical": 5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "present",
        "category": "PARTY_SUPPLIES",
        "typicalValue": {
          "min": 0.5,
          "max": 20,
          "typical": 5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "decoration",
        "category": "PARTY_SUPPLIES",
        "typicalValue": {
          "min": 0.5,
          "max": 20,
          "typical": 5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "party hat",
        "category": "PARTY_SUPPLIES",
        "typicalValue": {
          "min": 0.5,
          "max": 20,
          "typical": 5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "candle",
        "category": "PARTY_SUPPLIES",
        "typicalValue": {
          "min": 0.5,
          "max": 20,
          "typical": 5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      }
    ],
    "culturalElements": [
      {
        "type": "currency",
        "value": "£",
        "explanation": "British pounds for party supplies"
      },
      {
        "type": "event",
        "value": "celebration",
        "explanation": "Special occasions and festivals"
      }
    ],
    "realWorldConnection": "Planning and budgeting for celebrations",
    "yearAppropriate": [
      3
    ],
    "templates": [
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "MULTI_STEP"
        ],
        "template": "{character} is planning a {celebration}. The supplies cost {prices}. What is the total?",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "celebration",
            "type": "event"
          },
          {
            "key": "prices",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      }
    ]
  }
}

--- SUITE F: EDGE CASE AND ERROR HANDLING TESTS ---
Testing invalid inputs and expected error responses...
# Test F.1: Request with a non-existent model_id
{
  "error": "Unsupported model_id: FOOBAR. Supported models: ADDITION, SUBTRACTION, MULTIPLICATION, DIVISION, PERCENTAGE, FRACTION, COUNTING, TIME_RATE, CONVERSION, COMPARISON, MULTI_STEP, LINEAR_EQUATION, UNIT_RATE, COIN_RECOGNITION, CHANGE_CALCULATION, MONEY_COMBINATIONS, MIXED_MONEY_UNITS, MONEY_FRACTIONS, MONEY_SCALING, SHAPE_RECOGNITION, SHAPE_PROPERTIES, ANGLE_MEASUREMENT, POSITION_DIRECTION, AREA_PERIMETER"
}
# Test F.2: Request with an invalid difficulty_level
{
  "error": "difficulty_level must be X.Y where X=1-6 and Y=1-4"
}
# Test F.3: Request with an invalid format_preference
{
  "error": "Invalid format_preference. Valid options: DIRECT_CALCULATION, COMPARISON, ESTIMATION, ORDERING, VALIDATION, MULTI_STEP, MISSING_VALUE, PATTERN_RECOGNITION"
}
# Test F.4: Request with a dedicated broken model (TEST_BROKEN)
{
  "error": "Unsupported model_id: TEST_BROKEN. Supported models: ADDITION, SUBTRACTION, MULTIPLICATION, DIVISION, PERCENTAGE, FRACTION, COUNTING, TIME_RATE, CONVERSION, COMPARISON, MULTI_STEP, LINEAR_EQUATION, UNIT_RATE, COIN_RECOGNITION, CHANGE_CALCULATION, MONEY_COMBINATIONS, MIXED_MONEY_UNITS, MONEY_FRACTIONS, MONEY_SCALING, SHAPE_RECOGNITION, SHAPE_PROPERTIES, ANGLE_MEASUREMENT, POSITION_DIRECTION, AREA_PERIMETER"
}
# Test F.5: Request with a quantity greater than 20
{
  "error": "quantity must be between 1 and 20"
}
# Test F.6: Request missing the required model_id field
{
  "error": "model_id is required"
}

--- SUITE G: BATCH GENERATION TESTS ---
Testing the ability to generate multiple questions in one request...
# Test G.1: Request a batch of 5 questions
{
  "success": true,
  "questions": [
    {
      "text": "Sarah showed their working:\\n78 - 35\\n= 46\\n\\nIs this working correct?",
      "options": [
        {
          "text": "£43.00",
          "value": 43,
          "index": 0
        },
        {
          "value": 43.64309074796649,
          "text": "£43.64",
          "isCorrect": false
        }
      ],
      "correctIndex": 0,
      "questionContent": {
        "fullText": "Sarah showed their working:\\n78 - 35\\n= 46\\n\\nIs this working correct?"
      },
      "format": "VALIDATION",
      "difficulty": {
        "year": 3,
        "subLevel": 3,
        "displayName": "3.3",
        "cognitiveLoad": 40
      },
      "cognitiveLoad": 40,
      "curriculumTags": [
        "3N1c",
        "3N1d"
      ],
      "scenario": {
        "id": "shop-001-bookfair",
        "theme": "SHOPPING",
        "setting": {
          "location": "school book fair",
          "timeContext": "lunch break",
          "atmosphere": "busy"
        },
        "characters": [
          {
            "name": "Sarah",
            "role": "student"
          },
          {
            "name": "Mr. Johnson",
            "role": "teacher"
          }
        ],
        "items": [
          {
            "name": "book",
            "category": "BOOKS_MEDIA",
            "typicalValue": {
              "min": 3,
              "max": 12,
              "typical": 6.5,
              "distribution": "normal"
            },
            "unit": "£",
            "attributes": {
              "quality": "standard"
            }
          },
          {
            "name": "bookmark",
            "category": "SCHOOL_SUPPLIES",
            "typicalValue": {
              "min": 0.5,
              "max": 2,
              "typical": 1,
              "distribution": "normal"
            },
            "unit": "£",
            "attributes": {
              "quality": "standard"
            }
          }
        ],
        "culturalElements": [
          {
            "type": "currency",
            "value": "£",
            "explanation": "British pounds"
          },
          {
            "type": "event",
            "value": "book fair",
            "explanation": "School fundraising event"
          }
        ],
        "realWorldConnection": "School fundraising and reading promotion",
        "yearAppropriate": [
          2,
          3,
          4,
          5
        ],
        "templates": [
          {
            "formatCompatibility": [
              "DIRECT_CALCULATION",
              "COMPARISON"
            ],
            "template": "{character} wants to buy books at the book fair. Calculate the total cost.",
            "answerTemplate": "The total cost is {result}",
            "placeholders": [
              {
                "key": "character",
                "type": "character"
              },
              {
                "key": "result",
                "type": "value"
              }
            ]
          }
        ]
      },
      "distractors": [
        {
          "value": "Incorrect",
          "rationale": "Incorrectly identified correct work as wrong"
        }
      ],
      "enhancementStatus": {
        "level": "full",
        "requestedFormat": "VALIDATION",
        "actualFormat": "VALIDATION",
        "featuresActive": [
          "enhanced_distractors",
          "rich_scenarios",
          "cognitive_load",
          "advanced_formats"
        ],
        "featuresPending": [],
        "isFullyEnhanced": true
      },
      "mathOutput": {
        "operation": "SUBTRACTION",
        "minuend": 78,
        "subtrahend": 35,
        "result": 43,
        "decimal_formatted": {
          "minuend": "78",
          "subtrahend": "35",
          "result": "43"
        }
      },
      "generationTime": 1,
      "questionId": "q_1759079332455_9zf5j6jb4",
      "generationSetup": {
        "controller_used": "VALIDATIONController",
        "format_requested": "VALIDATION",
        "format_actual": "VALIDATION",
        "scenario_theme": "SHOPPING",
        "scenario_id": "shop-001-bookfair",
        "scenario_selection_method": "default",
        "distractor_strategies": [
          null
        ],
        "distractor_count": 1,
        "theme_variety": false,
        "format_variety": false,
        "enhancement_level": "full",
        "features_active": [
          "enhanced_distractors",
          "rich_scenarios",
          "cognitive_load",
          "advanced_formats"
        ],
        "features_pending": [],
        "generation_time_ms": 1
      }
    },
    {
      "text": "Charlotte is subtracting £52.00 - £26.00. What is a reasonable estimate?",
      "options": [
        {
          "text": "£25.00",
          "value": 25,
          "index": 0
        },
        {
          "text": "15",
          "value": 15,
          "index": 1
        },
        {
          "text": "26",
          "value": 26,
          "index": 2
        },
        {
          "text": "37.5",
          "value": 37.5,
          "index": 3
        }
      ],
      "correctIndex": 0,
      "questionContent": {
        "fullText": "Charlotte is subtracting £52.00 - £26.00. What is a reasonable estimate?",
        "templateData": {
          "character": "Charlotte",
          "operation": "is subtracting £52.00 - £26.00",
          "exactValue": "26",
          "estimatedValue": "25"
        }
      },
      "format": "ESTIMATION",
      "difficulty": {
        "year": 3,
        "subLevel": 3,
        "displayName": "3.3",
        "cognitiveLoad": 40
      },
      "cognitiveLoad": 40,
      "curriculumTags": [
        "3N1c",
        "3N1d"
      ],
      "scenario": {
        "id": "shop-002-realistic-general",
        "theme": "SHOPPING",
        "setting": {
          "location": "local shop",
          "timeContext": "after school",
          "atmosphere": "friendly"
        },
        "characters": [
          {
            "name": "Charlotte",
            "role": "student"
          }
        ],
        "items": [
          {
            "name": "apple",
            "category": "FOOD_DRINK",
            "typicalValue": {
              "min": 0.2,
              "max": 0.5,
              "typical": 0.35,
              "distribution": "normal"
            },
            "unit": "£",
            "attributes": {
              "quality": "standard"
            }
          },
          {
            "name": "banana",
            "category": "FOOD_DRINK",
            "typicalValue": {
              "min": 0.15,
              "max": 0.4,
              "typical": 0.25,
              "distribution": "normal"
            },
            "unit": "£",
            "attributes": {
              "quality": "standard"
            }
          },
          {
            "name": "sandwich",
            "category": "FOOD_DRINK",
            "typicalValue": {
              "min": 2.5,
              "max": 6,
              "typical": 4,
              "distribution": "normal"
            },
            "unit": "£",
            "attributes": {
              "quality": "standard"
            }
          },
          {
            "name": "drink",
            "category": "FOOD_DRINK",
            "typicalValue": {
              "min": 0.8,
              "max": 2.5,
              "typical": 1.5,
              "distribution": "normal"
            },
            "unit": "£",
            "attributes": {
              "quality": "standard"
            }
          },
          {
            "name": "cake",
            "category": "FOOD_DRINK",
            "typicalValue": {
              "min": 1.5,
              "max": 4,
              "typical": 2.5,
              "distribution": "normal"
            },
            "unit": "£",
            "attributes": {
              "quality": "standard"
            }
          },
          {
            "name": "biscuit",
            "category": "FOOD_DRINK",
            "typicalValue": {
              "min": 0.8,
              "max": 2,
              "typical": 1.2,
              "distribution": "normal"
            },
            "unit": "£",
            "attributes": {
              "quality": "standard"
            }
          },
          {
            "name": "sweet",
            "category": "FOOD_DRINK",
            "typicalValue": {
              "min": 0.1,
              "max": 1,
              "typical": 0.5,
              "distribution": "normal"
            },
            "unit": "£",
            "attributes": {
              "quality": "standard"
            }
          },
          {
            "name": "chocolate",
            "category": "FOOD_DRINK",
            "typicalValue": {
              "min": 0.6,
              "max": 3,
              "typical": 1.5,
              "distribution": "normal"
            },
            "unit": "£",
            "attributes": {
              "quality": "standard"
            }
          },
          {
            "name": "pen",
            "category": "SCHOOL_SUPPLIES",
            "typicalValue": {
              "min": 0.5,
              "max": 2,
              "typical": 1,
              "distribution": "normal"
            },
            "unit": "£",
            "attributes": {
              "quality": "standard"
            }
          },
          {
            "name": "pencil",
            "category": "SCHOOL_SUPPLIES",
            "typicalValue": {
              "min": 0.2,
              "max": 1,
              "typical": 0.5,
              "distribution": "normal"
            },
            "unit": "£",
            "attributes": {
              "quality": "standard"
            }
          },
          {
            "name": "ruler",
            "category": "SCHOOL_SUPPLIES",
            "typicalValue": {
              "min": 0.8,
              "max": 2.5,
              "typical": 1.5,
              "distribution": "normal"
            },
            "unit": "£",
            "attributes": {
              "quality": "standard"
            }
          },
          {
            "name": "notebook",
            "category": "SCHOOL_SUPPLIES",
            "typicalValue": {
              "min": 1,
              "max": 4,
              "typical": 2,
              "distribution": "normal"
            },
            "unit": "£",
            "attributes": {
              "quality": "standard"
            }
          },
          {
            "name": "eraser",
            "category": "SCHOOL_SUPPLIES",
            "typicalValue": {
              "min": 0.3,
              "max": 1.5,
              "typical": 0.75,
              "distribution": "normal"
            },
            "unit": "£",
            "attributes": {
              "quality": "standard"
            }
          },
          {
            "name": "book",
            "category": "BOOKS_MEDIA",
            "typicalValue": {
              "min": 3,
              "max": 15,
              "typical": 8,
              "distribution": "normal"
            },
            "unit": "£",
            "attributes": {
              "quality": "standard"
            }
          },
          {
            "name": "comic",
            "category": "BOOKS_MEDIA",
            "typicalValue": {
              "min": 2,
              "max": 5,
              "typical": 3,
              "distribution": "normal"
            },
            "unit": "£",
            "attributes": {
              "quality": "standard"
            }
          },
          {
            "name": "magazine",
            "category": "BOOKS_MEDIA",
            "typicalValue": {
              "min": 2.5,
              "max": 6,
              "typical": 4,
              "distribution": "normal"
            },
            "unit": "£",
            "attributes": {
              "quality": "standard"
            }
          },
          {
            "name": "toy",
            "category": "TOYS_GAMES",
            "typicalValue": {
              "min": 5,
              "max": 25,
              "typical": 12,
              "distribution": "normal"
            },
            "unit": "£",
            "attributes": {
              "quality": "standard"
            }
          },
          {
            "name": "game",
            "category": "TOYS_GAMES",
            "typicalValue": {
              "min": 8,
              "max": 60,
              "typical": 25,
              "distribution": "normal"
            },
            "unit": "£",
            "attributes": {
              "quality": "standard"
            }
          },
          {
            "name": "puzzle",
            "category": "TOYS_GAMES",
            "typicalValue": {
              "min": 5,
              "max": 20,
              "typical": 12,
              "distribution": "normal"
            },
            "unit": "£",
            "attributes": {
              "quality": "standard"
            }
          },
          {
            "name": "sticker",
            "category": "TOYS_GAMES",
            "typicalValue": {
              "min": 0.2,
              "max": 2,
              "typical": 0.8,
              "distribution": "normal"
            },
            "unit": "£",
            "attributes": {
              "quality": "standard"
            }
          },
          {
            "name": "badge",
            "category": "TOYS_GAMES",
            "typicalValue": {
              "min": 0.5,
              "max": 3,
              "typical": 1.5,
              "distribution": "normal"
            },
            "unit": "£",
            "attributes": {
              "quality": "standard"
            }
          },
          {
            "name": "poster",
            "category": "BOOKS_MEDIA",
            "typicalValue": {
              "min": 2,
              "max": 8,
              "typical": 4,
              "distribution": "normal"
            },
            "unit": "£",
            "attributes": {
              "quality": "standard"
            }
          },
          {
            "name": "card",
            "category": "BOOKS_MEDIA",
            "typicalValue": {
              "min": 0.5,
              "max": 4,
              "typical": 2,
              "distribution": "normal"
            },
            "unit": "£",
            "attributes": {
              "quality": "standard"
            }
          }
        ],
        "culturalElements": [
          {
            "type": "currency",
            "value": "£",
            "explanation": "British pounds"
          },
          {
            "type": "location",
            "value": "UK local shop",
            "explanation": "Typical British corner shop"
          }
        ],
        "realWorldConnection": "Everyday shopping with realistic UK prices",
        "yearAppropriate": [
          1,
          2,
          3,
          4,
          5,
          6
        ],
        "templates": [
          {
            "formatCompatibility": [
              "DIRECT_CALCULATION",
              "MULTI_STEP"
            ],
            "modelCompatibility": [
              "ADDITION"
            ],
            "operandCount": 3,
            "template": "{character} buys a {item1} for {price1}, a {item2} for {price2}, and a {item3} for {price3}. What is the total cost?",
            "answerTemplate": "The total cost is {result}",
            "placeholders": [
              {
                "key": "character",
                "type": "character"
              },
              {
                "key": "item1",
                "type": "item"
              },
              {
                "key": "item2",
                "type": "item"
              },
              {
                "key": "item3",
                "type": "item"
              },
              {
                "key": "price1",
                "type": "value"
              },
              {
                "key": "price2",
                "type": "value"
              },
              {
                "key": "price3",
                "type": "value"
              },
              {
                "key": "result",
                "type": "value"
              }
            ]
          },
          {
            "formatCompatibility": [
              "DIRECT_CALCULATION",
              "MULTI_STEP"
            ],
            "modelCompatibility": [
              "ADDITION"
            ],
            "operandCount": 2,
            "template": "{character} buys a {item1} for {price1} and a {item2} for {price2}. What is the total cost?",
            "answerTemplate": "The total cost is {result}",
            "placeholders": [
              {
                "key": "character",
                "type": "character"
              },
              {
                "key": "item1",
                "type": "item"
              },
              {
                "key": "item2",
                "type": "item"
              },
              {
                "key": "price1",
                "type": "value"
              },
              {
                "key": "price2",
                "type": "value"
              },
              {
                "key": "result",
                "type": "value"
              }
            ]
          },
          {
            "formatCompatibility": [
              "DIRECT_CALCULATION"
            ],
            "modelCompatibility": [
              "SUBTRACTION",
              "CHANGE_CALCULATION"
            ],
            "template": "{character} buys a {item} for {price} and pays with {payment}. How much change does {character} get?",
            "answerTemplate": "{character} receives {result} in change",
            "placeholders": [
              {
                "key": "character",
                "type": "character"
              },
              {
                "key": "item",
                "type": "item"
              },
              {
                "key": "price",
                "type": "value"
              },
              {
                "key": "payment",
                "type": "value"
              },
              {
                "key": "result",
                "type": "value"
              }
            ]
          },
          {
            "formatCompatibility": [
              "DIRECT_CALCULATION"
            ],
            "modelCompatibility": [
              "MULTIPLICATION"
            ],
            "template": "{character} buys {quantity} {item} at {price} each. What is the total cost?",
            "answerTemplate": "The total cost is {result}",
            "placeholders": [
              {
                "key": "character",
                "type": "character"
              },
              {
                "key": "quantity",
                "type": "value"
              },
              {
                "key": "item",
                "type": "item"
              },
              {
                "key": "price",
                "type": "value"
              },
              {
                "key": "result",
                "type": "value"
              }
            ]
          },
          {
            "formatCompatibility": [
              "DIRECT_CALCULATION"
            ],
            "modelCompatibility": [
              "DIVISION"
            ],
            "template": "{character} has {total} to spend equally on {quantity} {item}. How much can {character} spend on each one?",
            "answerTemplate": "{character} can spend {result} on each {item}",
            "placeholders": [
              {
                "key": "character",
                "type": "character"
              },
              {
                "key": "total",
                "type": "value"
              },
              {
                "key": "quantity",
                "type": "value"
              },
              {
                "key": "item",
                "type": "item"
              },
              {
                "key": "result",
                "type": "value"
              }
            ]
          },
          {
            "formatCompatibility": [
              "DIRECT_CALCULATION",
              "COMPARISON",
              "ESTIMATION",
              "MULTI_STEP"
            ],
            "template": "{character} goes to the shop and buys {items}. How much does {character} spend in total?",
            "answerTemplate": "{character} spends {result} in total",
            "placeholders": [
              {
                "key": "character",
                "type": "character"
              },
              {
                "key": "items",
                "type": "item_list"
              },
              {
                "key": "result",
                "type": "value"
              }
            ]
          },
          {
            "formatCompatibility": [
              "ESTIMATION"
            ],
            "template": "Estimate: If {character} buys {items}, about how much will it cost?",
            "answerTemplate": "It will cost approximately {result}",
            "placeholders": [
              {
                "key": "character",
                "type": "character"
              },
              {
                "key": "items",
                "type": "item_list"
              },
              {
                "key": "result",
                "type": "value"
              }
            ]
          },
          {
            "formatCompatibility": [
              "VALIDATION"
            ],
            "template": "{character} calculated that {items} costs {amount}. Is this correct?",
            "answerTemplate": "{validation_result}",
            "placeholders": [
              {
                "key": "character",
                "type": "character"
              },
              {
                "key": "items",
                "type": "item_list"
              },
              {
                "key": "amount",
                "type": "value"
              },
              {
                "key": "validation_result",
                "type": "boolean"
              }
            ]
          }
        ]
      },
      "distractors": [
        {
          "value": 26,
          "strategy": "WRONG_OPERATION",
          "rationale": "Used exact calculation instead of estimation"
        },
        {
          "value": 37.5,
          "rationale": "Overestimated significantly"
        },
        {
          "value": 15,
          "rationale": "Underestimated significantly"
        }
      ],
      "enhancementStatus": {
        "level": "full",
        "requestedFormat": "ESTIMATION",
        "actualFormat": "ESTIMATION",
        "featuresActive": [
          "enhanced_distractors",
          "rich_scenarios",
          "cognitive_load",
          "advanced_formats"
        ],
        "featuresPending": [],
        "isFullyEnhanced": true
      },
      "mathOutput": {
        "operation": "SUBTRACTION",
        "minuend": 52,
        "subtrahend": 26,
        "result": 26,
        "decimal_formatted": {
          "minuend": "52",
          "subtrahend": "26",
          "result": "26"
        },
        "exactValue": 26,
        "estimatedValue": 25
      },
      "generationTime": 0,
      "questionId": "q_1759079332455_dt4irit4a",
      "generationSetup": {
        "controller_used": "ESTIMATIONController",
        "format_requested": "ESTIMATION",
        "format_actual": "ESTIMATION",
        "scenario_theme": "SHOPPING",
        "scenario_id": "shop-002-realistic-general",
        "scenario_selection_method": "default",
        "distractor_strategies": [
          "WRONG_OPERATION",
          null,
          null
        ],
        "distractor_count": 3,
        "theme_variety": false,
        "format_variety": false,
        "enhancement_level": "full",
        "features_active": [
          "enhanced_distractors",
          "rich_scenarios",
          "cognitive_load",
          "advanced_formats"
        ],
        "features_pending": [],
        "generation_time_ms": 0
      }
    },
    {
      "text": "Sarah showed their working:\\n82 - 72\\n= 154\\n\\nIs this working correct?",
      "options": [
        {
          "value": 10,
          "text": "£10.00",
          "isCorrect": true
        },
        {
          "text": "£10.00",
          "value": 10,
          "index": 1
        }
      ],
      "correctIndex": 1,
      "questionContent": {
        "fullText": "Sarah showed their working:\\n82 - 72\\n= 154\\n\\nIs this working correct?"
      },
      "format": "VALIDATION",
      "difficulty": {
        "year": 3,
        "subLevel": 3,
        "displayName": "3.3",
        "cognitiveLoad": 40
      },
      "cognitiveLoad": 40,
      "curriculumTags": [
        "3N1c",
        "3N1d"
      ],
      "scenario": {
        "id": "shop-001-bookfair",
        "theme": "SHOPPING",
        "setting": {
          "location": "school book fair",
          "timeContext": "lunch break",
          "atmosphere": "busy"
        },
        "characters": [
          {
            "name": "Sarah",
            "role": "student"
          },
          {
            "name": "Mr. Johnson",
            "role": "teacher"
          }
        ],
        "items": [
          {
            "name": "book",
            "category": "BOOKS_MEDIA",
            "typicalValue": {
              "min": 3,
              "max": 12,
              "typical": 6.5,
              "distribution": "normal"
            },
            "unit": "£",
            "attributes": {
              "quality": "standard"
            }
          },
          {
            "name": "bookmark",
            "category": "SCHOOL_SUPPLIES",
            "typicalValue": {
              "min": 0.5,
              "max": 2,
              "typical": 1,
              "distribution": "normal"
            },
            "unit": "£",
            "attributes": {
              "quality": "standard"
            }
          }
        ],
        "culturalElements": [
          {
            "type": "currency",
            "value": "£",
            "explanation": "British pounds"
          },
          {
            "type": "event",
            "value": "book fair",
            "explanation": "School fundraising event"
          }
        ],
        "realWorldConnection": "School fundraising and reading promotion",
        "yearAppropriate": [
          2,
          3,
          4,
          5
        ],
        "templates": [
          {
            "formatCompatibility": [
              "DIRECT_CALCULATION",
              "COMPARISON"
            ],
            "template": "{character} wants to buy books at the book fair. Calculate the total cost.",
            "answerTemplate": "The total cost is {result}",
            "placeholders": [
              {
                "key": "character",
                "type": "character"
              },
              {
                "key": "result",
                "type": "value"
              }
            ]
          }
        ]
      },
      "distractors": [
        {
          "value": "Incorrect",
          "rationale": "Incorrectly identified correct work as wrong"
        }
      ],
      "enhancementStatus": {
        "level": "full",
        "requestedFormat": "VALIDATION",
        "actualFormat": "VALIDATION",
        "featuresActive": [
          "enhanced_distractors",
          "rich_scenarios",
          "cognitive_load",
          "advanced_formats"
        ],
        "featuresPending": [],
        "isFullyEnhanced": true
      },
      "mathOutput": {
        "operation": "SUBTRACTION",
        "minuend": 82,
        "subtrahend": 72,
        "result": 10,
        "decimal_formatted": {
          "minuend": "82",
          "subtrahend": "72",
          "result": "1"
        }
      },
      "generationTime": 1,
      "questionId": "q_1759079332456_hwt1tcaxw",
      "generationSetup": {
        "controller_used": "VALIDATIONController",
        "format_requested": "VALIDATION",
        "format_actual": "VALIDATION",
        "scenario_theme": "SHOPPING",
        "scenario_id": "shop-001-bookfair",
        "scenario_selection_method": "default",
        "distractor_strategies": [
          null
        ],
        "distractor_count": 1,
        "theme_variety": false,
        "format_variety": false,
        "enhancement_level": "full",
        "features_active": [
          "enhanced_distractors",
          "rich_scenarios",
          "cognitive_load",
          "advanced_formats"
        ],
        "features_pending": [],
        "generation_time_ms": 1
      }
    },
    {
      "text": "Sarah wants to buy books at the book fair. Calculate the total cost.",
      "options": [
        {
          "text": "£1.34",
          "value": 1.34,
          "index": 0
        },
        {
          "text": "3.34",
          "value": 3.34,
          "index": 1
        },
        {
          "text": "0.3400000000000001",
          "value": 0.3400000000000001,
          "index": 2
        },
        {
          "text": "99",
          "value": 99,
          "index": 3
        }
      ],
      "correctIndex": 0,
      "format": "DIRECT_CALCULATION",
      "difficulty": {
        "year": 3,
        "subLevel": 3,
        "displayName": "3.3",
        "cognitiveLoad": 40
      },
      "cognitiveLoad": 40,
      "curriculumTags": [
        "3N1c",
        "3N1d"
      ],
      "scenario": {
        "id": "shop-001-bookfair",
        "theme": "SHOPPING",
        "setting": {
          "location": "school book fair",
          "timeContext": "lunch break",
          "atmosphere": "busy"
        },
        "characters": [
          {
            "name": "Sarah",
            "role": "student"
          },
          {
            "name": "Mr. Johnson",
            "role": "teacher"
          }
        ],
        "items": [
          {
            "name": "book",
            "category": "BOOKS_MEDIA",
            "typicalValue": {
              "min": 3,
              "max": 12,
              "typical": 6.5,
              "distribution": "normal"
            },
            "unit": "£",
            "attributes": {
              "quality": "standard"
            }
          },
          {
            "name": "bookmark",
            "category": "SCHOOL_SUPPLIES",
            "typicalValue": {
              "min": 0.5,
              "max": 2,
              "typical": 1,
              "distribution": "normal"
            },
            "unit": "£",
            "attributes": {
              "quality": "standard"
            }
          }
        ],
        "culturalElements": [
          {
            "type": "currency",
            "value": "£",
            "explanation": "British pounds"
          },
          {
            "type": "event",
            "value": "book fair",
            "explanation": "School fundraising event"
          }
        ],
        "realWorldConnection": "School fundraising and reading promotion",
        "yearAppropriate": [
          2,
          3,
          4,
          5
        ],
        "templates": [
          {
            "formatCompatibility": [
              "DIRECT_CALCULATION",
              "COMPARISON"
            ],
            "template": "{character} wants to buy books at the book fair. Calculate the total cost.",
            "answerTemplate": "The total cost is {result}",
            "placeholders": [
              {
                "key": "character",
                "type": "character"
              },
              {
                "key": "result",
                "type": "value"
              }
            ]
          }
        ]
      },
      "distractors": [
        {
          "value": 99,
          "displayText": "99",
          "strategy": "WRONG_OPERATION",
          "reasoning": "Added instead of subtracting"
        },
        {
          "value": 0.3400000000000001,
          "displayText": "0.3400000000000001",
          "strategy": "CLOSE_VALUE",
          "reasoning": "Off by 1"
        },
        {
          "value": 3.34,
          "displayText": "3.34",
          "strategy": "CLOSE_VALUE",
          "reasoning": "Off by 2"
        }
      ],
      "enhancementStatus": {
        "level": "partial",
        "requestedFormat": "DIRECT_CALCULATION",
        "actualFormat": "DIRECT_CALCULATION",
        "featuresActive": [
          "enhanced_distractors",
          "rich_scenarios",
          "cognitive_load",
          "advanced_formats"
        ],
        "featuresPending": [],
        "isFullyEnhanced": true
      },
      "mathOutput": {
        "operation": "SUBTRACTION",
        "subtrahend": 8.66,
        "minuend": 10,
        "result": 1.34
      },
      "generationTime": 0,
      "questionId": "q_1759079332456_grfmlajuh",
      "generationSetup": {
        "controller_used": "DIRECT_CALCULATIONController",
        "format_requested": "DIRECT_CALCULATION",
        "format_actual": "DIRECT_CALCULATION",
        "scenario_theme": "SHOPPING",
        "scenario_id": "shop-001-bookfair",
        "scenario_selection_method": "default",
        "distractor_strategies": [
          "WRONG_OPERATION",
          "CLOSE_VALUE",
          "CLOSE_VALUE"
        ],
        "distractor_count": 3,
        "theme_variety": false,
        "format_variety": false,
        "enhancement_level": "partial",
        "features_active": [
          "enhanced_distractors",
          "rich_scenarios",
          "cognitive_load",
          "advanced_formats"
        ],
        "features_pending": [],
        "generation_time_ms": 0
      }
    },
    {
      "text": "Charlotte buys a apple for 38p and pays with £40. How much change does Charlotte get?",
      "options": [
        {
          "text": "120",
          "value": 120,
          "index": 0
        },
        {
          "text": "49.62",
          "value": 49.62,
          "index": 1
        },
        {
          "text": "£39.62",
          "value": 39.62,
          "index": 2
        },
        {
          "text": "41.62",
          "value": 41.62,
          "index": 3
        }
      ],
      "correctIndex": 2,
      "format": "DIRECT_CALCULATION",
      "difficulty": {
        "year": 3,
        "subLevel": 3,
        "displayName": "3.3",
        "cognitiveLoad": 40
      },
      "cognitiveLoad": 40,
      "curriculumTags": [
        "3N1c",
        "3N1d"
      ],
      "scenario": {
        "id": "shop-002-realistic-general",
        "theme": "SHOPPING",
        "setting": {
          "location": "local shop",
          "timeContext": "after school",
          "atmosphere": "friendly"
        },
        "characters": [
          {
            "name": "Charlotte",
            "role": "student"
          }
        ],
        "items": [
          {
            "name": "apple",
            "category": "FOOD_DRINK",
            "typicalValue": {
              "min": 0.2,
              "max": 0.5,
              "typical": 0.35,
              "distribution": "normal"
            },
            "unit": "£",
            "attributes": {
              "quality": "standard"
            }
          },
          {
            "name": "banana",
            "category": "FOOD_DRINK",
            "typicalValue": {
              "min": 0.15,
              "max": 0.4,
              "typical": 0.25,
              "distribution": "normal"
            },
            "unit": "£",
            "attributes": {
              "quality": "standard"
            }
          },
          {
            "name": "sandwich",
            "category": "FOOD_DRINK",
            "typicalValue": {
              "min": 2.5,
              "max": 6,
              "typical": 4,
              "distribution": "normal"
            },
            "unit": "£",
            "attributes": {
              "quality": "standard"
            }
          },
          {
            "name": "drink",
            "category": "FOOD_DRINK",
            "typicalValue": {
              "min": 0.8,
              "max": 2.5,
              "typical": 1.5,
              "distribution": "normal"
            },
            "unit": "£",
            "attributes": {
              "quality": "standard"
            }
          },
          {
            "name": "cake",
            "category": "FOOD_DRINK",
            "typicalValue": {
              "min": 1.5,
              "max": 4,
              "typical": 2.5,
              "distribution": "normal"
            },
            "unit": "£",
            "attributes": {
              "quality": "standard"
            }
          },
          {
            "name": "biscuit",
            "category": "FOOD_DRINK",
            "typicalValue": {
              "min": 0.8,
              "max": 2,
              "typical": 1.2,
              "distribution": "normal"
            },
            "unit": "£",
            "attributes": {
              "quality": "standard"
            }
          },
          {
            "name": "sweet",
            "category": "FOOD_DRINK",
            "typicalValue": {
              "min": 0.1,
              "max": 1,
              "typical": 0.5,
              "distribution": "normal"
            },
            "unit": "£",
            "attributes": {
              "quality": "standard"
            }
          },
          {
            "name": "chocolate",
            "category": "FOOD_DRINK",
            "typicalValue": {
              "min": 0.6,
              "max": 3,
              "typical": 1.5,
              "distribution": "normal"
            },
            "unit": "£",
            "attributes": {
              "quality": "standard"
            }
          },
          {
            "name": "pen",
            "category": "SCHOOL_SUPPLIES",
            "typicalValue": {
              "min": 0.5,
              "max": 2,
              "typical": 1,
              "distribution": "normal"
            },
            "unit": "£",
            "attributes": {
              "quality": "standard"
            }
          },
          {
            "name": "pencil",
            "category": "SCHOOL_SUPPLIES",
            "typicalValue": {
              "min": 0.2,
              "max": 1,
              "typical": 0.5,
              "distribution": "normal"
            },
            "unit": "£",
            "attributes": {
              "quality": "standard"
            }
          },
          {
            "name": "ruler",
            "category": "SCHOOL_SUPPLIES",
            "typicalValue": {
              "min": 0.8,
              "max": 2.5,
              "typical": 1.5,
              "distribution": "normal"
            },
            "unit": "£",
            "attributes": {
              "quality": "standard"
            }
          },
          {
            "name": "notebook",
            "category": "SCHOOL_SUPPLIES",
            "typicalValue": {
              "min": 1,
              "max": 4,
              "typical": 2,
              "distribution": "normal"
            },
            "unit": "£",
            "attributes": {
              "quality": "standard"
            }
          },
          {
            "name": "eraser",
            "category": "SCHOOL_SUPPLIES",
            "typicalValue": {
              "min": 0.3,
              "max": 1.5,
              "typical": 0.75,
              "distribution": "normal"
            },
            "unit": "£",
            "attributes": {
              "quality": "standard"
            }
          },
          {
            "name": "book",
            "category": "BOOKS_MEDIA",
            "typicalValue": {
              "min": 3,
              "max": 15,
              "typical": 8,
              "distribution": "normal"
            },
            "unit": "£",
            "attributes": {
              "quality": "standard"
            }
          },
          {
            "name": "comic",
            "category": "BOOKS_MEDIA",
            "typicalValue": {
              "min": 2,
              "max": 5,
              "typical": 3,
              "distribution": "normal"
            },
            "unit": "£",
            "attributes": {
              "quality": "standard"
            }
          },
          {
            "name": "magazine",
            "category": "BOOKS_MEDIA",
            "typicalValue": {
              "min": 2.5,
              "max": 6,
              "typical": 4,
              "distribution": "normal"
            },
            "unit": "£",
            "attributes": {
              "quality": "standard"
            }
          },
          {
            "name": "toy",
            "category": "TOYS_GAMES",
            "typicalValue": {
              "min": 5,
              "max": 25,
              "typical": 12,
              "distribution": "normal"
            },
            "unit": "£",
            "attributes": {
              "quality": "standard"
            }
          },
          {
            "name": "game",
            "category": "TOYS_GAMES",
            "typicalValue": {
              "min": 8,
              "max": 60,
              "typical": 25,
              "distribution": "normal"
            },
            "unit": "£",
            "attributes": {
              "quality": "standard"
            }
          },
          {
            "name": "puzzle",
            "category": "TOYS_GAMES",
            "typicalValue": {
              "min": 5,
              "max": 20,
              "typical": 12,
              "distribution": "normal"
            },
            "unit": "£",
            "attributes": {
              "quality": "standard"
            }
          },
          {
            "name": "sticker",
            "category": "TOYS_GAMES",
            "typicalValue": {
              "min": 0.2,
              "max": 2,
              "typical": 0.8,
              "distribution": "normal"
            },
            "unit": "£",
            "attributes": {
              "quality": "standard"
            }
          },
          {
            "name": "badge",
            "category": "TOYS_GAMES",
            "typicalValue": {
              "min": 0.5,
              "max": 3,
              "typical": 1.5,
              "distribution": "normal"
            },
            "unit": "£",
            "attributes": {
              "quality": "standard"
            }
          },
          {
            "name": "poster",
            "category": "BOOKS_MEDIA",
            "typicalValue": {
              "min": 2,
              "max": 8,
              "typical": 4,
              "distribution": "normal"
            },
            "unit": "£",
            "attributes": {
              "quality": "standard"
            }
          },
          {
            "name": "card",
            "category": "BOOKS_MEDIA",
            "typicalValue": {
              "min": 0.5,
              "max": 4,
              "typical": 2,
              "distribution": "normal"
            },
            "unit": "£",
            "attributes": {
              "quality": "standard"
            }
          }
        ],
        "culturalElements": [
          {
            "type": "currency",
            "value": "£",
            "explanation": "British pounds"
          },
          {
            "type": "location",
            "value": "UK local shop",
            "explanation": "Typical British corner shop"
          }
        ],
        "realWorldConnection": "Everyday shopping with realistic UK prices",
        "yearAppropriate": [
          1,
          2,
          3,
          4,
          5,
          6
        ],
        "templates": [
          {
            "formatCompatibility": [
              "DIRECT_CALCULATION",
              "MULTI_STEP"
            ],
            "modelCompatibility": [
              "ADDITION"
            ],
            "operandCount": 3,
            "template": "{character} buys a {item1} for {price1}, a {item2} for {price2}, and a {item3} for {price3}. What is the total cost?",
            "answerTemplate": "The total cost is {result}",
            "placeholders": [
              {
                "key": "character",
                "type": "character"
              },
              {
                "key": "item1",
                "type": "item"
              },
              {
                "key": "item2",
                "type": "item"
              },
              {
                "key": "item3",
                "type": "item"
              },
              {
                "key": "price1",
                "type": "value"
              },
              {
                "key": "price2",
                "type": "value"
              },
              {
                "key": "price3",
                "type": "value"
              },
              {
                "key": "result",
                "type": "value"
              }
            ]
          },
          {
            "formatCompatibility": [
              "DIRECT_CALCULATION",
              "MULTI_STEP"
            ],
            "modelCompatibility": [
              "ADDITION"
            ],
            "operandCount": 2,
            "template": "{character} buys a {item1} for {price1} and a {item2} for {price2}. What is the total cost?",
            "answerTemplate": "The total cost is {result}",
            "placeholders": [
              {
                "key": "character",
                "type": "character"
              },
              {
                "key": "item1",
                "type": "item"
              },
              {
                "key": "item2",
                "type": "item"
              },
              {
                "key": "price1",
                "type": "value"
              },
              {
                "key": "price2",
                "type": "value"
              },
              {
                "key": "result",
                "type": "value"
              }
            ]
          },
          {
            "formatCompatibility": [
              "DIRECT_CALCULATION"
            ],
            "modelCompatibility": [
              "SUBTRACTION",
              "CHANGE_CALCULATION"
            ],
            "template": "{character} buys a {item} for {price} and pays with {payment}. How much change does {character} get?",
            "answerTemplate": "{character} receives {result} in change",
            "placeholders": [
              {
                "key": "character",
                "type": "character"
              },
              {
                "key": "item",
                "type": "item"
              },
              {
                "key": "price",
                "type": "value"
              },
              {
                "key": "payment",
                "type": "value"
              },
              {
                "key": "result",
                "type": "value"
              }
            ]
          },
          {
            "formatCompatibility": [
              "DIRECT_CALCULATION"
            ],
            "modelCompatibility": [
              "MULTIPLICATION"
            ],
            "template": "{character} buys {quantity} {item} at {price} each. What is the total cost?",
            "answerTemplate": "The total cost is {result}",
            "placeholders": [
              {
                "key": "character",
                "type": "character"
              },
              {
                "key": "quantity",
                "type": "value"
              },
              {
                "key": "item",
                "type": "item"
              },
              {
                "key": "price",
                "type": "value"
              },
              {
                "key": "result",
                "type": "value"
              }
            ]
          },
          {
            "formatCompatibility": [
              "DIRECT_CALCULATION"
            ],
            "modelCompatibility": [
              "DIVISION"
            ],
            "template": "{character} has {total} to spend equally on {quantity} {item}. How much can {character} spend on each one?",
            "answerTemplate": "{character} can spend {result} on each {item}",
            "placeholders": [
              {
                "key": "character",
                "type": "character"
              },
              {
                "key": "total",
                "type": "value"
              },
              {
                "key": "quantity",
                "type": "value"
              },
              {
                "key": "item",
                "type": "item"
              },
              {
                "key": "result",
                "type": "value"
              }
            ]
          },
          {
            "formatCompatibility": [
              "DIRECT_CALCULATION",
              "COMPARISON",
              "ESTIMATION",
              "MULTI_STEP"
            ],
            "template": "{character} goes to the shop and buys {items}. How much does {character} spend in total?",
            "answerTemplate": "{character} spends {result} in total",
            "placeholders": [
              {
                "key": "character",
                "type": "character"
              },
              {
                "key": "items",
                "type": "item_list"
              },
              {
                "key": "result",
                "type": "value"
              }
            ]
          },
          {
            "formatCompatibility": [
              "ESTIMATION"
            ],
            "template": "Estimate: If {character} buys {items}, about how much will it cost?",
            "answerTemplate": "It will cost approximately {result}",
            "placeholders": [
              {
                "key": "character",
                "type": "character"
              },
              {
                "key": "items",
                "type": "item_list"
              },
              {
                "key": "result",
                "type": "value"
              }
            ]
          },
          {
            "formatCompatibility": [
              "VALIDATION"
            ],
            "template": "{character} calculated that {items} costs {amount}. Is this correct?",
            "answerTemplate": "{validation_result}",
            "placeholders": [
              {
                "key": "character",
                "type": "character"
              },
              {
                "key": "items",
                "type": "item_list"
              },
              {
                "key": "amount",
                "type": "value"
              },
              {
                "key": "validation_result",
                "type": "boolean"
              }
            ]
          }
        ]
      },
      "distractors": [
        {
          "value": 120,
          "displayText": "120",
          "strategy": "WRONG_OPERATION",
          "reasoning": "Added instead of subtracting"
        },
        {
          "value": 49.62,
          "displayText": "49.62",
          "strategy": "PLACE_VALUE_ERROR",
          "reasoning": "Error in carrying to next column"
        },
        {
          "value": 41.62,
          "displayText": "41.62",
          "strategy": "CLOSE_VALUE",
          "reasoning": "Off by 2"
        }
      ],
      "enhancementStatus": {
        "level": "partial",
        "requestedFormat": "DIRECT_CALCULATION",
        "actualFormat": "DIRECT_CALCULATION",
        "featuresActive": [
          "enhanced_distractors",
          "rich_scenarios",
          "cognitive_load",
          "advanced_formats"
        ],
        "featuresPending": [],
        "isFullyEnhanced": true
      },
      "mathOutput": {
        "operation": "SUBTRACTION",
        "subtrahend": 0.38,
        "minuend": 40,
        "result": 39.62
      },
      "generationTime": 1,
      "questionId": "q_1759079332456_rgf6fmgc8",
      "generationSetup": {
        "controller_used": "DIRECT_CALCULATIONController",
        "format_requested": "DIRECT_CALCULATION",
        "format_actual": "DIRECT_CALCULATION",
        "scenario_theme": "SHOPPING",
        "scenario_id": "shop-002-realistic-general",
        "scenario_selection_method": "default",
        "distractor_strategies": [
          "WRONG_OPERATION",
          "PLACE_VALUE_ERROR",
          "CLOSE_VALUE"
        ],
        "distractor_count": 3,
        "theme_variety": false,
        "format_variety": false,
        "enhancement_level": "partial",
        "features_active": [
          "enhanced_distractors",
          "rich_scenarios",
          "cognitive_load",
          "advanced_formats"
        ],
        "features_pending": [],
        "generation_time_ms": 1
      }
    }
  ],
  "metadata": {
    "format": "VALIDATION",
    "cognitive_load": 40,
    "curriculum_alignment": [
      "3N1c",
      "3N1d"
    ],
    "difficulty": "3.3",
    "scenario_theme": "SHOPPING",
    "distractor_strategies": [],
    "generation_time_ms": 3,
    "enhancement_status": "full",
    "format_used": "VALIDATION",
    "features_active": [
      "enhanced_distractors",
      "rich_scenarios",
      "cognitive_load",
      "advanced_formats"
    ],
    "features_pending": [],
    "api_version": "2.0"
  },
  "batch_info": {
    "total_questions": 5,
    "avg_generation_time": 0.6,
    "success_rate": 1
  }
}

--- API TEST SUITE COMPLETE ---
