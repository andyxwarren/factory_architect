--- SUITE A: SMOKE TESTS ---
Running basic tests to ensure the API is online and responsive...
# Test A.1: Basic ADDITION request
{
  "success": true,
  "question": {
    "text": "Oliver buys a apple for 44p and a banana for 29p. What is the total cost?",
    "options": [
      {
        "text": "3",
        "value": 3,
        "index": 0
      },
      {
        "text": "73p",
        "value": 0.73,
        "index": 1
      },
      {
        "text": "1.73",
        "value": 1.73,
        "index": 2
      },
      {
        "text": "2",
        "value": 2,
        "index": 3
      }
    ],
    "correctIndex": 1,
    "format": "DIRECT_CALCULATION",
    "difficulty": {
      "year": 1,
      "subLevel": 1,
      "displayName": "1.1",
      "cognitiveLoad": 10
    },
    "cognitiveLoad": 10,
    "curriculumTags": [
      "1N1a",
      "1N1b"
    ],
    "scenario": {
      "id": "shop-002-realistic-general",
      "theme": "SHOPPING",
      "setting": {
        "location": "local shop",
        "timeContext": "after school",
        "atmosphere": "friendly"
      },
      "characters": [
        {
          "name": "Oliver",
          "role": "student"
        }
      ],
      "items": [
        {
          "name": "apple",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.2,
            "max": 0.5,
            "typical": 0.35,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "banana",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.15,
            "max": 0.4,
            "typical": 0.25,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "sandwich",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 2.5,
            "max": 6,
            "typical": 4,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "drink",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.8,
            "max": 2.5,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "cake",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 1.5,
            "max": 4,
            "typical": 2.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "biscuit",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.8,
            "max": 2,
            "typical": 1.2,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "sweet",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.1,
            "max": 1,
            "typical": 0.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "chocolate",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.6,
            "max": 3,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "pen",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.5,
            "max": 2,
            "typical": 1,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "pencil",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.2,
            "max": 1,
            "typical": 0.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "ruler",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.8,
            "max": 2.5,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "notebook",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 1,
            "max": 4,
            "typical": 2,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "eraser",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.3,
            "max": 1.5,
            "typical": 0.75,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "book",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 3,
            "max": 15,
            "typical": 8,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "comic",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 2,
            "max": 5,
            "typical": 3,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "magazine",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 2.5,
            "max": 6,
            "typical": 4,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "toy",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 5,
            "max": 25,
            "typical": 12,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "game",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 8,
            "max": 60,
            "typical": 25,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "puzzle",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 5,
            "max": 20,
            "typical": 12,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "sticker",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 0.2,
            "max": 2,
            "typical": 0.8,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "badge",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 0.5,
            "max": 3,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "poster",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 2,
            "max": 8,
            "typical": 4,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "card",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 0.5,
            "max": 4,
            "typical": 2,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        }
      ],
      "culturalElements": [
        {
          "type": "currency",
          "value": "£",
          "explanation": "British pounds"
        },
        {
          "type": "location",
          "value": "UK local shop",
          "explanation": "Typical British corner shop"
        }
      ],
      "realWorldConnection": "Everyday shopping with realistic UK prices",
      "yearAppropriate": [
        1,
        2,
        3,
        4,
        5,
        6
      ],
      "templates": [
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "MULTI_STEP"
          ],
          "modelCompatibility": [
            "ADDITION"
          ],
          "operandCount": 3,
          "template": "{character} buys a {item1} for {price1}, a {item2} for {price2}, and a {item3} for {price3}. What is the total cost?",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item1",
              "type": "item"
            },
            {
              "key": "item2",
              "type": "item"
            },
            {
              "key": "item3",
              "type": "item"
            },
            {
              "key": "price1",
              "type": "value"
            },
            {
              "key": "price2",
              "type": "value"
            },
            {
              "key": "price3",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "MULTI_STEP"
          ],
          "modelCompatibility": [
            "ADDITION"
          ],
          "operandCount": 2,
          "template": "{character} buys a {item1} for {price1} and a {item2} for {price2}. What is the total cost?",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item1",
              "type": "item"
            },
            {
              "key": "item2",
              "type": "item"
            },
            {
              "key": "price1",
              "type": "value"
            },
            {
              "key": "price2",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION"
          ],
          "modelCompatibility": [
            "SUBTRACTION",
            "CHANGE_CALCULATION"
          ],
          "template": "{character} buys a {item} for {price} and pays with {payment}. How much change does {character} get?",
          "answerTemplate": "{character} receives {result} in change",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "price",
              "type": "value"
            },
            {
              "key": "payment",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION"
          ],
          "modelCompatibility": [
            "MULTIPLICATION"
          ],
          "template": "{character} buys {quantity} {item} at {price} each. What is the total cost?",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "quantity",
              "type": "value"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "price",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION"
          ],
          "modelCompatibility": [
            "DIVISION"
          ],
          "template": "{character} has {total} to spend equally on {quantity} {item}. How much can {character} spend on each one?",
          "answerTemplate": "{character} can spend {result} on each {item}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "total",
              "type": "value"
            },
            {
              "key": "quantity",
              "type": "value"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "COMPARISON",
            "ESTIMATION",
            "MULTI_STEP"
          ],
          "template": "{character} goes to the shop and buys {items}. How much does {character} spend in total?",
          "answerTemplate": "{character} spends {result} in total",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "items",
              "type": "item_list"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "ESTIMATION"
          ],
          "template": "Estimate: If {character} buys {items}, about how much will it cost?",
          "answerTemplate": "It will cost approximately {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "items",
              "type": "item_list"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "VALIDATION"
          ],
          "template": "{character} calculated that {items} costs {amount}. Is this correct?",
          "answerTemplate": "{validation_result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "items",
              "type": "item_list"
            },
            {
              "key": "amount",
              "type": "value"
            },
            {
              "key": "validation_result",
              "type": "boolean"
            }
          ]
        }
      ]
    },
    "distractors": [
      {
        "value": 2,
        "displayText": "2",
        "strategy": "WRONG_OPERATION",
        "reasoning": "Subtracted instead of adding"
      },
      {
        "value": 3,
        "displayText": "3",
        "strategy": "WRONG_OPERATION",
        "reasoning": "Multiplied instead of adding"
      },
      {
        "value": 1.73,
        "displayText": "1.73",
        "strategy": "CLOSE_VALUE",
        "reasoning": "Off by 1"
      }
    ],
    "enhancementStatus": {
      "level": "partial",
      "requestedFormat": "DIRECT_CALCULATION",
      "actualFormat": "DIRECT_CALCULATION",
      "featuresActive": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "featuresPending": [],
      "isFullyEnhanced": true
    },
    "mathOutput": {
      "operation": "ADDITION",
      "operand_1": 0.44,
      "operand_2": 0.29,
      "result": 0.73
    },
    "generationTime": 4,
    "questionId": "q_1759130028662_zzj31eejg",
    "generationSetup": {
      "controller_used": "DIRECT_CALCULATIONController",
      "format_requested": "DIRECT_CALCULATION",
      "format_actual": "DIRECT_CALCULATION",
      "scenario_theme": "SHOPPING",
      "scenario_id": "shop-002-realistic-general",
      "scenario_selection_method": "default",
      "distractor_strategies": [
        "WRONG_OPERATION",
        "WRONG_OPERATION",
        "CLOSE_VALUE"
      ],
      "distractor_count": 3,
      "theme_variety": false,
      "format_variety": false,
      "enhancement_level": "partial",
      "features_active": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "features_pending": [],
      "generation_time_ms": 4
    }
  },
  "metadata": {
    "format": "DIRECT_CALCULATION",
    "cognitive_load": 10,
    "curriculum_alignment": [
      "1N1a",
      "1N1b"
    ],
    "difficulty": "1.1",
    "scenario_theme": "SHOPPING",
    "distractor_strategies": [
      "WRONG_OPERATION",
      "WRONG_OPERATION",
      "CLOSE_VALUE"
    ],
    "generation_time_ms": 4,
    "api_version": "2.0",
    "enhancement_status": "partial",
    "format_requested": "DIRECT_CALCULATION",
    "format_used": "DIRECT_CALCULATION",
    "features_active": [
      "enhanced_distractors",
      "rich_scenarios",
      "cognitive_load",
      "advanced_formats"
    ],
    "features_pending": []
  },
  "context": {
    "id": "shop-002-realistic-general",
    "theme": "SHOPPING",
    "setting": {
      "location": "local shop",
      "timeContext": "after school",
      "atmosphere": "friendly"
    },
    "characters": [
      {
        "name": "Oliver",
        "role": "student"
      }
    ],
    "items": [
      {
        "name": "apple",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.2,
          "max": 0.5,
          "typical": 0.35,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "banana",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.15,
          "max": 0.4,
          "typical": 0.25,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "sandwich",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 2.5,
          "max": 6,
          "typical": 4,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "drink",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.8,
          "max": 2.5,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "cake",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 1.5,
          "max": 4,
          "typical": 2.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "biscuit",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.8,
          "max": 2,
          "typical": 1.2,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "sweet",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.1,
          "max": 1,
          "typical": 0.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "chocolate",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.6,
          "max": 3,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "pen",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.5,
          "max": 2,
          "typical": 1,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "pencil",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.2,
          "max": 1,
          "typical": 0.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "ruler",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.8,
          "max": 2.5,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "notebook",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 1,
          "max": 4,
          "typical": 2,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "eraser",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.3,
          "max": 1.5,
          "typical": 0.75,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "book",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 3,
          "max": 15,
          "typical": 8,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "comic",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 2,
          "max": 5,
          "typical": 3,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "magazine",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 2.5,
          "max": 6,
          "typical": 4,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "toy",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 5,
          "max": 25,
          "typical": 12,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "game",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 8,
          "max": 60,
          "typical": 25,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "puzzle",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 5,
          "max": 20,
          "typical": 12,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "sticker",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 0.2,
          "max": 2,
          "typical": 0.8,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "badge",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 0.5,
          "max": 3,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "poster",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 2,
          "max": 8,
          "typical": 4,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "card",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 0.5,
          "max": 4,
          "typical": 2,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      }
    ],
    "culturalElements": [
      {
        "type": "currency",
        "value": "£",
        "explanation": "British pounds"
      },
      {
        "type": "location",
        "value": "UK local shop",
        "explanation": "Typical British corner shop"
      }
    ],
    "realWorldConnection": "Everyday shopping with realistic UK prices",
    "yearAppropriate": [
      1,
      2,
      3,
      4,
      5,
      6
    ],
    "templates": [
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "MULTI_STEP"
        ],
        "modelCompatibility": [
          "ADDITION"
        ],
        "operandCount": 3,
        "template": "{character} buys a {item1} for {price1}, a {item2} for {price2}, and a {item3} for {price3}. What is the total cost?",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item1",
            "type": "item"
          },
          {
            "key": "item2",
            "type": "item"
          },
          {
            "key": "item3",
            "type": "item"
          },
          {
            "key": "price1",
            "type": "value"
          },
          {
            "key": "price2",
            "type": "value"
          },
          {
            "key": "price3",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "MULTI_STEP"
        ],
        "modelCompatibility": [
          "ADDITION"
        ],
        "operandCount": 2,
        "template": "{character} buys a {item1} for {price1} and a {item2} for {price2}. What is the total cost?",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item1",
            "type": "item"
          },
          {
            "key": "item2",
            "type": "item"
          },
          {
            "key": "price1",
            "type": "value"
          },
          {
            "key": "price2",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION"
        ],
        "modelCompatibility": [
          "SUBTRACTION",
          "CHANGE_CALCULATION"
        ],
        "template": "{character} buys a {item} for {price} and pays with {payment}. How much change does {character} get?",
        "answerTemplate": "{character} receives {result} in change",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "price",
            "type": "value"
          },
          {
            "key": "payment",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION"
        ],
        "modelCompatibility": [
          "MULTIPLICATION"
        ],
        "template": "{character} buys {quantity} {item} at {price} each. What is the total cost?",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "quantity",
            "type": "value"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "price",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION"
        ],
        "modelCompatibility": [
          "DIVISION"
        ],
        "template": "{character} has {total} to spend equally on {quantity} {item}. How much can {character} spend on each one?",
        "answerTemplate": "{character} can spend {result} on each {item}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "total",
            "type": "value"
          },
          {
            "key": "quantity",
            "type": "value"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "COMPARISON",
          "ESTIMATION",
          "MULTI_STEP"
        ],
        "template": "{character} goes to the shop and buys {items}. How much does {character} spend in total?",
        "answerTemplate": "{character} spends {result} in total",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "items",
            "type": "item_list"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "ESTIMATION"
        ],
        "template": "Estimate: If {character} buys {items}, about how much will it cost?",
        "answerTemplate": "It will cost approximately {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "items",
            "type": "item_list"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "VALIDATION"
        ],
        "template": "{character} calculated that {items} costs {amount}. Is this correct?",
        "answerTemplate": "{validation_result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "items",
            "type": "item_list"
          },
          {
            "key": "amount",
            "type": "value"
          },
          {
            "key": "validation_result",
            "type": "boolean"
          }
        ]
      }
    ]
  }
}
# Test A.2: Basic SUBTRACTION request
{
  "success": true,
  "question": {
    "text": "Oliver buys a apple for 42p and pays with £45. How much change does Oliver get?",
    "options": [
      {
        "text": "8",
        "value": 8,
        "index": 0
      },
      {
        "text": "54.58",
        "value": 54.58,
        "index": 1
      },
      {
        "text": "£44.58",
        "value": 44.58,
        "index": 2
      }
    ],
    "correctIndex": 2,
    "format": "DIRECT_CALCULATION",
    "difficulty": {
      "year": 1,
      "subLevel": 2,
      "displayName": "1.2",
      "cognitiveLoad": 15
    },
    "cognitiveLoad": 15,
    "curriculumTags": [
      "1N1c",
      "1N1d"
    ],
    "scenario": {
      "id": "shop-002-realistic-general",
      "theme": "SHOPPING",
      "setting": {
        "location": "local shop",
        "timeContext": "after school",
        "atmosphere": "friendly"
      },
      "characters": [
        {
          "name": "Oliver",
          "role": "student"
        }
      ],
      "items": [
        {
          "name": "apple",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.2,
            "max": 0.5,
            "typical": 0.35,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "banana",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.15,
            "max": 0.4,
            "typical": 0.25,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "sandwich",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 2.5,
            "max": 6,
            "typical": 4,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "drink",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.8,
            "max": 2.5,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "cake",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 1.5,
            "max": 4,
            "typical": 2.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "biscuit",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.8,
            "max": 2,
            "typical": 1.2,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "sweet",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.1,
            "max": 1,
            "typical": 0.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "chocolate",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.6,
            "max": 3,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "pen",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.5,
            "max": 2,
            "typical": 1,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "pencil",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.2,
            "max": 1,
            "typical": 0.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "ruler",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.8,
            "max": 2.5,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "notebook",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 1,
            "max": 4,
            "typical": 2,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "eraser",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.3,
            "max": 1.5,
            "typical": 0.75,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "book",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 3,
            "max": 15,
            "typical": 8,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "comic",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 2,
            "max": 5,
            "typical": 3,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "magazine",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 2.5,
            "max": 6,
            "typical": 4,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "toy",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 5,
            "max": 25,
            "typical": 12,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "game",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 8,
            "max": 60,
            "typical": 25,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "puzzle",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 5,
            "max": 20,
            "typical": 12,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "sticker",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 0.2,
            "max": 2,
            "typical": 0.8,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "badge",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 0.5,
            "max": 3,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "poster",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 2,
            "max": 8,
            "typical": 4,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "card",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 0.5,
            "max": 4,
            "typical": 2,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        }
      ],
      "culturalElements": [
        {
          "type": "currency",
          "value": "£",
          "explanation": "British pounds"
        },
        {
          "type": "location",
          "value": "UK local shop",
          "explanation": "Typical British corner shop"
        }
      ],
      "realWorldConnection": "Everyday shopping with realistic UK prices",
      "yearAppropriate": [
        1,
        2,
        3,
        4,
        5,
        6
      ],
      "templates": [
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "MULTI_STEP"
          ],
          "modelCompatibility": [
            "ADDITION"
          ],
          "operandCount": 3,
          "template": "{character} buys a {item1} for {price1}, a {item2} for {price2}, and a {item3} for {price3}. What is the total cost?",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item1",
              "type": "item"
            },
            {
              "key": "item2",
              "type": "item"
            },
            {
              "key": "item3",
              "type": "item"
            },
            {
              "key": "price1",
              "type": "value"
            },
            {
              "key": "price2",
              "type": "value"
            },
            {
              "key": "price3",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "MULTI_STEP"
          ],
          "modelCompatibility": [
            "ADDITION"
          ],
          "operandCount": 2,
          "template": "{character} buys a {item1} for {price1} and a {item2} for {price2}. What is the total cost?",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item1",
              "type": "item"
            },
            {
              "key": "item2",
              "type": "item"
            },
            {
              "key": "price1",
              "type": "value"
            },
            {
              "key": "price2",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION"
          ],
          "modelCompatibility": [
            "SUBTRACTION",
            "CHANGE_CALCULATION"
          ],
          "template": "{character} buys a {item} for {price} and pays with {payment}. How much change does {character} get?",
          "answerTemplate": "{character} receives {result} in change",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "price",
              "type": "value"
            },
            {
              "key": "payment",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION"
          ],
          "modelCompatibility": [
            "MULTIPLICATION"
          ],
          "template": "{character} buys {quantity} {item} at {price} each. What is the total cost?",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "quantity",
              "type": "value"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "price",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION"
          ],
          "modelCompatibility": [
            "DIVISION"
          ],
          "template": "{character} has {total} to spend equally on {quantity} {item}. How much can {character} spend on each one?",
          "answerTemplate": "{character} can spend {result} on each {item}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "total",
              "type": "value"
            },
            {
              "key": "quantity",
              "type": "value"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "COMPARISON",
            "ESTIMATION",
            "MULTI_STEP"
          ],
          "template": "{character} goes to the shop and buys {items}. How much does {character} spend in total?",
          "answerTemplate": "{character} spends {result} in total",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "items",
              "type": "item_list"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "ESTIMATION"
          ],
          "template": "Estimate: If {character} buys {items}, about how much will it cost?",
          "answerTemplate": "It will cost approximately {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "items",
              "type": "item_list"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "VALIDATION"
          ],
          "template": "{character} calculated that {items} costs {amount}. Is this correct?",
          "answerTemplate": "{validation_result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "items",
              "type": "item_list"
            },
            {
              "key": "amount",
              "type": "value"
            },
            {
              "key": "validation_result",
              "type": "boolean"
            }
          ]
        }
      ]
    },
    "distractors": [
      {
        "value": 8,
        "displayText": "8",
        "strategy": "WRONG_OPERATION",
        "reasoning": "Added instead of subtracting"
      },
      {
        "value": 54.58,
        "displayText": "54.58",
        "strategy": "PLACE_VALUE_ERROR",
        "reasoning": "Error in carrying to next column"
      }
    ],
    "enhancementStatus": {
      "level": "partial",
      "requestedFormat": "DIRECT_CALCULATION",
      "actualFormat": "DIRECT_CALCULATION",
      "featuresActive": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "featuresPending": [],
      "isFullyEnhanced": true
    },
    "mathOutput": {
      "operation": "SUBTRACTION",
      "subtrahend": 0.42,
      "minuend": 45,
      "result": 44.58
    },
    "generationTime": 1,
    "questionId": "q_1759130028777_86ou0htcs",
    "generationSetup": {
      "controller_used": "DIRECT_CALCULATIONController",
      "format_requested": "DIRECT_CALCULATION",
      "format_actual": "DIRECT_CALCULATION",
      "scenario_theme": "SHOPPING",
      "scenario_id": "shop-002-realistic-general",
      "scenario_selection_method": "default",
      "distractor_strategies": [
        "WRONG_OPERATION",
        "PLACE_VALUE_ERROR"
      ],
      "distractor_count": 2,
      "theme_variety": false,
      "format_variety": false,
      "enhancement_level": "partial",
      "features_active": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "features_pending": [],
      "generation_time_ms": 1
    }
  },
  "metadata": {
    "format": "DIRECT_CALCULATION",
    "cognitive_load": 15,
    "curriculum_alignment": [
      "1N1c",
      "1N1d"
    ],
    "difficulty": "1.2",
    "scenario_theme": "SHOPPING",
    "distractor_strategies": [
      "WRONG_OPERATION",
      "PLACE_VALUE_ERROR"
    ],
    "generation_time_ms": 1,
    "api_version": "2.0",
    "enhancement_status": "partial",
    "format_requested": "DIRECT_CALCULATION",
    "format_used": "DIRECT_CALCULATION",
    "features_active": [
      "enhanced_distractors",
      "rich_scenarios",
      "cognitive_load",
      "advanced_formats"
    ],
    "features_pending": []
  },
  "context": {
    "id": "shop-002-realistic-general",
    "theme": "SHOPPING",
    "setting": {
      "location": "local shop",
      "timeContext": "after school",
      "atmosphere": "friendly"
    },
    "characters": [
      {
        "name": "Oliver",
        "role": "student"
      }
    ],
    "items": [
      {
        "name": "apple",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.2,
          "max": 0.5,
          "typical": 0.35,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "banana",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.15,
          "max": 0.4,
          "typical": 0.25,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "sandwich",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 2.5,
          "max": 6,
          "typical": 4,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "drink",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.8,
          "max": 2.5,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "cake",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 1.5,
          "max": 4,
          "typical": 2.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "biscuit",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.8,
          "max": 2,
          "typical": 1.2,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "sweet",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.1,
          "max": 1,
          "typical": 0.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "chocolate",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.6,
          "max": 3,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "pen",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.5,
          "max": 2,
          "typical": 1,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "pencil",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.2,
          "max": 1,
          "typical": 0.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "ruler",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.8,
          "max": 2.5,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "notebook",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 1,
          "max": 4,
          "typical": 2,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "eraser",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.3,
          "max": 1.5,
          "typical": 0.75,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "book",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 3,
          "max": 15,
          "typical": 8,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "comic",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 2,
          "max": 5,
          "typical": 3,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "magazine",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 2.5,
          "max": 6,
          "typical": 4,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "toy",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 5,
          "max": 25,
          "typical": 12,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "game",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 8,
          "max": 60,
          "typical": 25,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "puzzle",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 5,
          "max": 20,
          "typical": 12,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "sticker",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 0.2,
          "max": 2,
          "typical": 0.8,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "badge",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 0.5,
          "max": 3,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "poster",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 2,
          "max": 8,
          "typical": 4,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "card",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 0.5,
          "max": 4,
          "typical": 2,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      }
    ],
    "culturalElements": [
      {
        "type": "currency",
        "value": "£",
        "explanation": "British pounds"
      },
      {
        "type": "location",
        "value": "UK local shop",
        "explanation": "Typical British corner shop"
      }
    ],
    "realWorldConnection": "Everyday shopping with realistic UK prices",
    "yearAppropriate": [
      1,
      2,
      3,
      4,
      5,
      6
    ],
    "templates": [
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "MULTI_STEP"
        ],
        "modelCompatibility": [
          "ADDITION"
        ],
        "operandCount": 3,
        "template": "{character} buys a {item1} for {price1}, a {item2} for {price2}, and a {item3} for {price3}. What is the total cost?",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item1",
            "type": "item"
          },
          {
            "key": "item2",
            "type": "item"
          },
          {
            "key": "item3",
            "type": "item"
          },
          {
            "key": "price1",
            "type": "value"
          },
          {
            "key": "price2",
            "type": "value"
          },
          {
            "key": "price3",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "MULTI_STEP"
        ],
        "modelCompatibility": [
          "ADDITION"
        ],
        "operandCount": 2,
        "template": "{character} buys a {item1} for {price1} and a {item2} for {price2}. What is the total cost?",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item1",
            "type": "item"
          },
          {
            "key": "item2",
            "type": "item"
          },
          {
            "key": "price1",
            "type": "value"
          },
          {
            "key": "price2",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION"
        ],
        "modelCompatibility": [
          "SUBTRACTION",
          "CHANGE_CALCULATION"
        ],
        "template": "{character} buys a {item} for {price} and pays with {payment}. How much change does {character} get?",
        "answerTemplate": "{character} receives {result} in change",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "price",
            "type": "value"
          },
          {
            "key": "payment",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION"
        ],
        "modelCompatibility": [
          "MULTIPLICATION"
        ],
        "template": "{character} buys {quantity} {item} at {price} each. What is the total cost?",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "quantity",
            "type": "value"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "price",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION"
        ],
        "modelCompatibility": [
          "DIVISION"
        ],
        "template": "{character} has {total} to spend equally on {quantity} {item}. How much can {character} spend on each one?",
        "answerTemplate": "{character} can spend {result} on each {item}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "total",
            "type": "value"
          },
          {
            "key": "quantity",
            "type": "value"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "COMPARISON",
          "ESTIMATION",
          "MULTI_STEP"
        ],
        "template": "{character} goes to the shop and buys {items}. How much does {character} spend in total?",
        "answerTemplate": "{character} spends {result} in total",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "items",
            "type": "item_list"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "ESTIMATION"
        ],
        "template": "Estimate: If {character} buys {items}, about how much will it cost?",
        "answerTemplate": "It will cost approximately {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "items",
            "type": "item_list"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "VALIDATION"
        ],
        "template": "{character} calculated that {items} costs {amount}. Is this correct?",
        "answerTemplate": "{validation_result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "items",
            "type": "item_list"
          },
          {
            "key": "amount",
            "type": "value"
          },
          {
            "key": "validation_result",
            "type": "boolean"
          }
        ]
      }
    ]
  }
}

--- SUITE B: MODEL COVERAGE TESTS ---
Testing every mathematical model to ensure basic generation and catch crashes...
# Test B.1: ADDITION model
{
  "success": true,
  "question": {
    "text": "Sarah wants to buy books at the book fair. Calculate the total cost.",
    "options": [
      {
        "text": "29",
        "value": 29,
        "index": 0
      },
      {
        "text": "2546",
        "value": 2546,
        "index": 1
      },
      {
        "text": "25.73",
        "value": 25.73,
        "index": 2
      },
      {
        "text": "£15.73",
        "value": 15.73,
        "index": 3
      }
    ],
    "correctIndex": 3,
    "format": "DIRECT_CALCULATION",
    "difficulty": {
      "year": 4,
      "subLevel": 1,
      "displayName": "4.1",
      "cognitiveLoad": 40
    },
    "cognitiveLoad": 40,
    "curriculumTags": [
      "4N1a",
      "4N1b"
    ],
    "scenario": {
      "id": "shop-001-bookfair",
      "theme": "SHOPPING",
      "setting": {
        "location": "school book fair",
        "timeContext": "lunch break",
        "atmosphere": "busy"
      },
      "characters": [
        {
          "name": "Sarah",
          "role": "student"
        },
        {
          "name": "Mr. Johnson",
          "role": "teacher"
        }
      ],
      "items": [
        {
          "name": "book",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 3,
            "max": 12,
            "typical": 6.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "bookmark",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.5,
            "max": 2,
            "typical": 1,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        }
      ],
      "culturalElements": [
        {
          "type": "currency",
          "value": "£",
          "explanation": "British pounds"
        },
        {
          "type": "event",
          "value": "book fair",
          "explanation": "School fundraising event"
        }
      ],
      "realWorldConnection": "School fundraising and reading promotion",
      "yearAppropriate": [
        2,
        3,
        4,
        5
      ],
      "templates": [
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "COMPARISON"
          ],
          "template": "{character} wants to buy books at the book fair. Calculate the total cost.",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        }
      ]
    },
    "distractors": [
      {
        "value": 29,
        "displayText": "29",
        "strategy": "WRONG_OPERATION",
        "reasoning": "Subtracted instead of adding"
      },
      {
        "value": 2546,
        "displayText": "2546",
        "strategy": "WRONG_OPERATION",
        "reasoning": "Multiplied instead of adding"
      },
      {
        "value": 25.73,
        "displayText": "25.73",
        "strategy": "PLACE_VALUE_ERROR",
        "reasoning": "Error in carrying to next column"
      }
    ],
    "enhancementStatus": {
      "level": "partial",
      "requestedFormat": "DIRECT_CALCULATION",
      "actualFormat": "DIRECT_CALCULATION",
      "featuresActive": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "featuresPending": [],
      "isFullyEnhanced": true
    },
    "mathOutput": {
      "operation": "ADDITION",
      "operand_1": 9.79,
      "operand_2": 1.34,
      "operand_3": 4.6,
      "result": 15.73
    },
    "generationTime": 1,
    "questionId": "q_1759130028827_1xucqb4xy",
    "generationSetup": {
      "controller_used": "DIRECT_CALCULATIONController",
      "format_requested": "DIRECT_CALCULATION",
      "format_actual": "DIRECT_CALCULATION",
      "scenario_theme": "SHOPPING",
      "scenario_id": "shop-001-bookfair",
      "scenario_selection_method": "default",
      "distractor_strategies": [
        "WRONG_OPERATION",
        "WRONG_OPERATION",
        "PLACE_VALUE_ERROR"
      ],
      "distractor_count": 3,
      "theme_variety": false,
      "format_variety": false,
      "enhancement_level": "partial",
      "features_active": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "features_pending": [],
      "generation_time_ms": 1
    }
  },
  "metadata": {
    "format": "DIRECT_CALCULATION",
    "cognitive_load": 40,
    "curriculum_alignment": [
      "4N1a",
      "4N1b"
    ],
    "difficulty": "4.1",
    "scenario_theme": "SHOPPING",
    "distractor_strategies": [
      "WRONG_OPERATION",
      "WRONG_OPERATION",
      "PLACE_VALUE_ERROR"
    ],
    "generation_time_ms": 1,
    "api_version": "2.0",
    "enhancement_status": "partial",
    "format_requested": "DIRECT_CALCULATION",
    "format_used": "DIRECT_CALCULATION",
    "features_active": [
      "enhanced_distractors",
      "rich_scenarios",
      "cognitive_load",
      "advanced_formats"
    ],
    "features_pending": []
  },
  "context": {
    "id": "shop-001-bookfair",
    "theme": "SHOPPING",
    "setting": {
      "location": "school book fair",
      "timeContext": "lunch break",
      "atmosphere": "busy"
    },
    "characters": [
      {
        "name": "Sarah",
        "role": "student"
      },
      {
        "name": "Mr. Johnson",
        "role": "teacher"
      }
    ],
    "items": [
      {
        "name": "book",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 3,
          "max": 12,
          "typical": 6.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "bookmark",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.5,
          "max": 2,
          "typical": 1,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      }
    ],
    "culturalElements": [
      {
        "type": "currency",
        "value": "£",
        "explanation": "British pounds"
      },
      {
        "type": "event",
        "value": "book fair",
        "explanation": "School fundraising event"
      }
    ],
    "realWorldConnection": "School fundraising and reading promotion",
    "yearAppropriate": [
      2,
      3,
      4,
      5
    ],
    "templates": [
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "COMPARISON"
        ],
        "template": "{character} wants to buy books at the book fair. Calculate the total cost.",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      }
    ]
  }
}
# Test B.2: SUBTRACTION model
{
  "success": true,
  "question": {
    "text": "Sarah wants to buy books at the book fair. Calculate the total cost.",
    "options": [
      {
        "text": "3.0300000000000002",
        "value": 3.0300000000000002,
        "index": 0
      },
      {
        "text": "104",
        "value": 104,
        "index": 1
      },
      {
        "text": "5.03",
        "value": 5.03,
        "index": 2
      },
      {
        "text": "£4.03",
        "value": 4.03,
        "index": 3
      }
    ],
    "correctIndex": 3,
    "format": "DIRECT_CALCULATION",
    "difficulty": {
      "year": 4,
      "subLevel": 1,
      "displayName": "4.1",
      "cognitiveLoad": 40
    },
    "cognitiveLoad": 40,
    "curriculumTags": [
      "4N1c",
      "4N1d"
    ],
    "scenario": {
      "id": "shop-001-bookfair",
      "theme": "SHOPPING",
      "setting": {
        "location": "school book fair",
        "timeContext": "lunch break",
        "atmosphere": "busy"
      },
      "characters": [
        {
          "name": "Sarah",
          "role": "student"
        },
        {
          "name": "Mr. Johnson",
          "role": "teacher"
        }
      ],
      "items": [
        {
          "name": "book",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 3,
            "max": 12,
            "typical": 6.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "bookmark",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.5,
            "max": 2,
            "typical": 1,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        }
      ],
      "culturalElements": [
        {
          "type": "currency",
          "value": "£",
          "explanation": "British pounds"
        },
        {
          "type": "event",
          "value": "book fair",
          "explanation": "School fundraising event"
        }
      ],
      "realWorldConnection": "School fundraising and reading promotion",
      "yearAppropriate": [
        2,
        3,
        4,
        5
      ],
      "templates": [
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "COMPARISON"
          ],
          "template": "{character} wants to buy books at the book fair. Calculate the total cost.",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        }
      ]
    },
    "distractors": [
      {
        "value": 104,
        "displayText": "104",
        "strategy": "WRONG_OPERATION",
        "reasoning": "Added instead of subtracting"
      },
      {
        "value": 5.03,
        "displayText": "5.03",
        "strategy": "CLOSE_VALUE",
        "reasoning": "Off by 1"
      },
      {
        "value": 3.0300000000000002,
        "displayText": "3.0300000000000002",
        "strategy": "CLOSE_VALUE",
        "reasoning": "Off by 1"
      }
    ],
    "enhancementStatus": {
      "level": "partial",
      "requestedFormat": "DIRECT_CALCULATION",
      "actualFormat": "DIRECT_CALCULATION",
      "featuresActive": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "featuresPending": [],
      "isFullyEnhanced": true
    },
    "mathOutput": {
      "operation": "SUBTRACTION",
      "subtrahend": 10.97,
      "minuend": 15,
      "result": 4.03
    },
    "generationTime": 0,
    "questionId": "q_1759130028879_p8b8gl464",
    "generationSetup": {
      "controller_used": "DIRECT_CALCULATIONController",
      "format_requested": "DIRECT_CALCULATION",
      "format_actual": "DIRECT_CALCULATION",
      "scenario_theme": "SHOPPING",
      "scenario_id": "shop-001-bookfair",
      "scenario_selection_method": "default",
      "distractor_strategies": [
        "WRONG_OPERATION",
        "CLOSE_VALUE",
        "CLOSE_VALUE"
      ],
      "distractor_count": 3,
      "theme_variety": false,
      "format_variety": false,
      "enhancement_level": "partial",
      "features_active": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "features_pending": [],
      "generation_time_ms": 0
    }
  },
  "metadata": {
    "format": "DIRECT_CALCULATION",
    "cognitive_load": 40,
    "curriculum_alignment": [
      "4N1c",
      "4N1d"
    ],
    "difficulty": "4.1",
    "scenario_theme": "SHOPPING",
    "distractor_strategies": [
      "WRONG_OPERATION",
      "CLOSE_VALUE",
      "CLOSE_VALUE"
    ],
    "generation_time_ms": 0,
    "api_version": "2.0",
    "enhancement_status": "partial",
    "format_requested": "DIRECT_CALCULATION",
    "format_used": "DIRECT_CALCULATION",
    "features_active": [
      "enhanced_distractors",
      "rich_scenarios",
      "cognitive_load",
      "advanced_formats"
    ],
    "features_pending": []
  },
  "context": {
    "id": "shop-001-bookfair",
    "theme": "SHOPPING",
    "setting": {
      "location": "school book fair",
      "timeContext": "lunch break",
      "atmosphere": "busy"
    },
    "characters": [
      {
        "name": "Sarah",
        "role": "student"
      },
      {
        "name": "Mr. Johnson",
        "role": "teacher"
      }
    ],
    "items": [
      {
        "name": "book",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 3,
          "max": 12,
          "typical": 6.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "bookmark",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.5,
          "max": 2,
          "typical": 1,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      }
    ],
    "culturalElements": [
      {
        "type": "currency",
        "value": "£",
        "explanation": "British pounds"
      },
      {
        "type": "event",
        "value": "book fair",
        "explanation": "School fundraising event"
      }
    ],
    "realWorldConnection": "School fundraising and reading promotion",
    "yearAppropriate": [
      2,
      3,
      4,
      5
    ],
    "templates": [
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "COMPARISON"
        ],
        "template": "{character} wants to buy books at the book fair. Calculate the total cost.",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      }
    ]
  }
}
# Test B.3: MULTIPLICATION model
{
  "success": true,
  "question": {
    "text": "Sarah wants to buy books at the book fair. Calculate the total cost.",
    "options": [
      {
        "text": "20",
        "value": 20,
        "index": 0
      },
      {
        "text": "87.7",
        "value": 87.7,
        "index": 1
      },
      {
        "text": "6",
        "value": 6,
        "index": 2
      },
      {
        "text": "£77.70",
        "value": 77.7,
        "index": 3
      }
    ],
    "correctIndex": 3,
    "format": "DIRECT_CALCULATION",
    "difficulty": {
      "year": 4,
      "subLevel": 1,
      "displayName": "4.1",
      "cognitiveLoad": 40
    },
    "cognitiveLoad": 40,
    "curriculumTags": [
      "4N1a"
    ],
    "scenario": {
      "id": "shop-001-bookfair",
      "theme": "SHOPPING",
      "setting": {
        "location": "school book fair",
        "timeContext": "lunch break",
        "atmosphere": "busy"
      },
      "characters": [
        {
          "name": "Sarah",
          "role": "student"
        },
        {
          "name": "Mr. Johnson",
          "role": "teacher"
        }
      ],
      "items": [
        {
          "name": "book",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 3,
            "max": 12,
            "typical": 6.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "bookmark",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.5,
            "max": 2,
            "typical": 1,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        }
      ],
      "culturalElements": [
        {
          "type": "currency",
          "value": "£",
          "explanation": "British pounds"
        },
        {
          "type": "event",
          "value": "book fair",
          "explanation": "School fundraising event"
        }
      ],
      "realWorldConnection": "School fundraising and reading promotion",
      "yearAppropriate": [
        2,
        3,
        4,
        5
      ],
      "templates": [
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "COMPARISON"
          ],
          "template": "{character} wants to buy books at the book fair. Calculate the total cost.",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        }
      ]
    },
    "distractors": [
      {
        "value": 20,
        "displayText": "20",
        "strategy": "WRONG_OPERATION",
        "reasoning": "Added instead of multiplying"
      },
      {
        "value": 6,
        "displayText": "6",
        "strategy": "WRONG_OPERATION",
        "reasoning": "Subtracted instead of multiplying"
      },
      {
        "value": 87.7,
        "displayText": "87.7",
        "strategy": "PLACE_VALUE_ERROR",
        "reasoning": "Error in carrying to next column"
      }
    ],
    "enhancementStatus": {
      "level": "partial",
      "requestedFormat": "DIRECT_CALCULATION",
      "actualFormat": "DIRECT_CALCULATION",
      "featuresActive": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "featuresPending": [],
      "isFullyEnhanced": true
    },
    "mathOutput": {
      "operation": "MULTIPLICATION",
      "multiplier": 7,
      "multiplicand": 11.1,
      "result": 77.7
    },
    "generationTime": 1,
    "questionId": "q_1759130028941_2lkq6davm",
    "generationSetup": {
      "controller_used": "DIRECT_CALCULATIONController",
      "format_requested": "DIRECT_CALCULATION",
      "format_actual": "DIRECT_CALCULATION",
      "scenario_theme": "SHOPPING",
      "scenario_id": "shop-001-bookfair",
      "scenario_selection_method": "default",
      "distractor_strategies": [
        "WRONG_OPERATION",
        "WRONG_OPERATION",
        "PLACE_VALUE_ERROR"
      ],
      "distractor_count": 3,
      "theme_variety": false,
      "format_variety": false,
      "enhancement_level": "partial",
      "features_active": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "features_pending": [],
      "generation_time_ms": 1
    }
  },
  "metadata": {
    "format": "DIRECT_CALCULATION",
    "cognitive_load": 40,
    "curriculum_alignment": [
      "4N1a"
    ],
    "difficulty": "4.1",
    "scenario_theme": "SHOPPING",
    "distractor_strategies": [
      "WRONG_OPERATION",
      "WRONG_OPERATION",
      "PLACE_VALUE_ERROR"
    ],
    "generation_time_ms": 1,
    "api_version": "2.0",
    "enhancement_status": "partial",
    "format_requested": "DIRECT_CALCULATION",
    "format_used": "DIRECT_CALCULATION",
    "features_active": [
      "enhanced_distractors",
      "rich_scenarios",
      "cognitive_load",
      "advanced_formats"
    ],
    "features_pending": []
  },
  "context": {
    "id": "shop-001-bookfair",
    "theme": "SHOPPING",
    "setting": {
      "location": "school book fair",
      "timeContext": "lunch break",
      "atmosphere": "busy"
    },
    "characters": [
      {
        "name": "Sarah",
        "role": "student"
      },
      {
        "name": "Mr. Johnson",
        "role": "teacher"
      }
    ],
    "items": [
      {
        "name": "book",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 3,
          "max": 12,
          "typical": 6.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "bookmark",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.5,
          "max": 2,
          "typical": 1,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      }
    ],
    "culturalElements": [
      {
        "type": "currency",
        "value": "£",
        "explanation": "British pounds"
      },
      {
        "type": "event",
        "value": "book fair",
        "explanation": "School fundraising event"
      }
    ],
    "realWorldConnection": "School fundraising and reading promotion",
    "yearAppropriate": [
      2,
      3,
      4,
      5
    ],
    "templates": [
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "COMPARISON"
        ],
        "template": "{character} wants to buy books at the book fair. Calculate the total cost.",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      }
    ]
  }
}
# Test B.4: DIVISION model
{
  "success": true,
  "question": {
    "text": "Sarah wants to buy books at the book fair. Calculate the total cost.",
    "options": [
      {
        "text": "4",
        "value": 4,
        "index": 0
      },
      {
        "text": "12.27",
        "value": 12.27,
        "index": 1
      },
      {
        "text": "£11.27 remainder 4",
        "value": 11.27,
        "index": 2
      },
      {
        "text": "10.27",
        "value": 10.27,
        "index": 3
      }
    ],
    "correctIndex": 2,
    "format": "DIRECT_CALCULATION",
    "difficulty": {
      "year": 4,
      "subLevel": 1,
      "displayName": "4.1",
      "cognitiveLoad": 40
    },
    "cognitiveLoad": 40,
    "curriculumTags": [
      "4N1a"
    ],
    "scenario": {
      "id": "shop-001-bookfair",
      "theme": "SHOPPING",
      "setting": {
        "location": "school book fair",
        "timeContext": "lunch break",
        "atmosphere": "busy"
      },
      "characters": [
        {
          "name": "Sarah",
          "role": "student"
        },
        {
          "name": "Mr. Johnson",
          "role": "teacher"
        }
      ],
      "items": [
        {
          "name": "book",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 3,
            "max": 12,
            "typical": 6.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "bookmark",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.5,
            "max": 2,
            "typical": 1,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        }
      ],
      "culturalElements": [
        {
          "type": "currency",
          "value": "£",
          "explanation": "British pounds"
        },
        {
          "type": "event",
          "value": "book fair",
          "explanation": "School fundraising event"
        }
      ],
      "realWorldConnection": "School fundraising and reading promotion",
      "yearAppropriate": [
        2,
        3,
        4,
        5
      ],
      "templates": [
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "COMPARISON"
          ],
          "template": "{character} wants to buy books at the book fair. Calculate the total cost.",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        }
      ]
    },
    "distractors": [
      {
        "value": 4,
        "displayText": "4",
        "strategy": "WRONG_OPERATION",
        "reasoning": "Subtracted instead of dividing"
      },
      {
        "value": 12.27,
        "displayText": "12.27",
        "strategy": "CLOSE_VALUE",
        "reasoning": "Off by 1"
      },
      {
        "value": 10.27,
        "displayText": "10.27",
        "strategy": "CLOSE_VALUE",
        "reasoning": "Off by 1"
      }
    ],
    "enhancementStatus": {
      "level": "partial",
      "requestedFormat": "DIRECT_CALCULATION",
      "actualFormat": "DIRECT_CALCULATION",
      "featuresActive": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "featuresPending": [],
      "isFullyEnhanced": true
    },
    "mathOutput": {
      "operation": "DIVISION",
      "divisor": 6,
      "dividend": 67.62,
      "quotient": 11.27,
      "remainder": 0
    },
    "generationTime": 0,
    "questionId": "q_1759130029054_cz30l9xd5",
    "generationSetup": {
      "controller_used": "DIRECT_CALCULATIONController",
      "format_requested": "DIRECT_CALCULATION",
      "format_actual": "DIRECT_CALCULATION",
      "scenario_theme": "SHOPPING",
      "scenario_id": "shop-001-bookfair",
      "scenario_selection_method": "default",
      "distractor_strategies": [
        "WRONG_OPERATION",
        "CLOSE_VALUE",
        "CLOSE_VALUE"
      ],
      "distractor_count": 3,
      "theme_variety": false,
      "format_variety": false,
      "enhancement_level": "partial",
      "features_active": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "features_pending": [],
      "generation_time_ms": 0
    }
  },
  "metadata": {
    "format": "DIRECT_CALCULATION",
    "cognitive_load": 40,
    "curriculum_alignment": [
      "4N1a"
    ],
    "difficulty": "4.1",
    "scenario_theme": "SHOPPING",
    "distractor_strategies": [
      "WRONG_OPERATION",
      "CLOSE_VALUE",
      "CLOSE_VALUE"
    ],
    "generation_time_ms": 0,
    "api_version": "2.0",
    "enhancement_status": "partial",
    "format_requested": "DIRECT_CALCULATION",
    "format_used": "DIRECT_CALCULATION",
    "features_active": [
      "enhanced_distractors",
      "rich_scenarios",
      "cognitive_load",
      "advanced_formats"
    ],
    "features_pending": []
  },
  "context": {
    "id": "shop-001-bookfair",
    "theme": "SHOPPING",
    "setting": {
      "location": "school book fair",
      "timeContext": "lunch break",
      "atmosphere": "busy"
    },
    "characters": [
      {
        "name": "Sarah",
        "role": "student"
      },
      {
        "name": "Mr. Johnson",
        "role": "teacher"
      }
    ],
    "items": [
      {
        "name": "book",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 3,
          "max": 12,
          "typical": 6.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "bookmark",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.5,
          "max": 2,
          "typical": 1,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      }
    ],
    "culturalElements": [
      {
        "type": "currency",
        "value": "£",
        "explanation": "British pounds"
      },
      {
        "type": "event",
        "value": "book fair",
        "explanation": "School fundraising event"
      }
    ],
    "realWorldConnection": "School fundraising and reading promotion",
    "yearAppropriate": [
      2,
      3,
      4,
      5
    ],
    "templates": [
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "COMPARISON"
        ],
        "template": "{character} wants to buy books at the book fair. Calculate the total cost.",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      }
    ]
  }
}
# Test B.5: PERCENTAGE model
{
  "success": true,
  "question": {
    "text": "Oliver goes to the shop and buys apple, banana, sandwich, drink, cake, biscuit, sweet, chocolate, pen, pencil, ruler, notebook, eraser, book, comic, magazine, toy, game, puzzle, sticker, badge, poster, card. How much does Oliver spend in total?",
    "options": [
      {
        "value": 21.5,
        "text": "£21.50",
        "isCorrect": true
      },
      {
        "text": "2.15",
        "value": 2.15,
        "index": 1
      },
      {
        "text": "23.5",
        "value": 23.5,
        "index": 2
      },
      {
        "text": "£21.50",
        "value": 21.5,
        "index": 3
      }
    ],
    "correctIndex": 3,
    "format": "DIRECT_CALCULATION",
    "difficulty": {
      "year": 4,
      "subLevel": 1,
      "displayName": "4.1",
      "cognitiveLoad": 40
    },
    "cognitiveLoad": 40,
    "curriculumTags": [
      "4N1a"
    ],
    "scenario": {
      "id": "shop-002-realistic-general",
      "theme": "SHOPPING",
      "setting": {
        "location": "local shop",
        "timeContext": "after school",
        "atmosphere": "friendly"
      },
      "characters": [
        {
          "name": "Oliver",
          "role": "student"
        }
      ],
      "items": [
        {
          "name": "apple",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.2,
            "max": 0.5,
            "typical": 0.35,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "banana",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.15,
            "max": 0.4,
            "typical": 0.25,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "sandwich",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 2.5,
            "max": 6,
            "typical": 4,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "drink",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.8,
            "max": 2.5,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "cake",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 1.5,
            "max": 4,
            "typical": 2.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "biscuit",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.8,
            "max": 2,
            "typical": 1.2,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "sweet",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.1,
            "max": 1,
            "typical": 0.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "chocolate",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.6,
            "max": 3,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "pen",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.5,
            "max": 2,
            "typical": 1,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "pencil",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.2,
            "max": 1,
            "typical": 0.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "ruler",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.8,
            "max": 2.5,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "notebook",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 1,
            "max": 4,
            "typical": 2,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "eraser",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.3,
            "max": 1.5,
            "typical": 0.75,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "book",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 3,
            "max": 15,
            "typical": 8,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "comic",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 2,
            "max": 5,
            "typical": 3,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "magazine",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 2.5,
            "max": 6,
            "typical": 4,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "toy",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 5,
            "max": 25,
            "typical": 12,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "game",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 8,
            "max": 60,
            "typical": 25,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "puzzle",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 5,
            "max": 20,
            "typical": 12,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "sticker",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 0.2,
            "max": 2,
            "typical": 0.8,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "badge",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 0.5,
            "max": 3,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "poster",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 2,
            "max": 8,
            "typical": 4,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "card",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 0.5,
            "max": 4,
            "typical": 2,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        }
      ],
      "culturalElements": [
        {
          "type": "currency",
          "value": "£",
          "explanation": "British pounds"
        },
        {
          "type": "location",
          "value": "UK local shop",
          "explanation": "Typical British corner shop"
        }
      ],
      "realWorldConnection": "Everyday shopping with realistic UK prices",
      "yearAppropriate": [
        1,
        2,
        3,
        4,
        5,
        6
      ],
      "templates": [
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "MULTI_STEP"
          ],
          "modelCompatibility": [
            "ADDITION"
          ],
          "operandCount": 3,
          "template": "{character} buys a {item1} for {price1}, a {item2} for {price2}, and a {item3} for {price3}. What is the total cost?",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item1",
              "type": "item"
            },
            {
              "key": "item2",
              "type": "item"
            },
            {
              "key": "item3",
              "type": "item"
            },
            {
              "key": "price1",
              "type": "value"
            },
            {
              "key": "price2",
              "type": "value"
            },
            {
              "key": "price3",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "MULTI_STEP"
          ],
          "modelCompatibility": [
            "ADDITION"
          ],
          "operandCount": 2,
          "template": "{character} buys a {item1} for {price1} and a {item2} for {price2}. What is the total cost?",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item1",
              "type": "item"
            },
            {
              "key": "item2",
              "type": "item"
            },
            {
              "key": "price1",
              "type": "value"
            },
            {
              "key": "price2",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION"
          ],
          "modelCompatibility": [
            "SUBTRACTION",
            "CHANGE_CALCULATION"
          ],
          "template": "{character} buys a {item} for {price} and pays with {payment}. How much change does {character} get?",
          "answerTemplate": "{character} receives {result} in change",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "price",
              "type": "value"
            },
            {
              "key": "payment",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION"
          ],
          "modelCompatibility": [
            "MULTIPLICATION"
          ],
          "template": "{character} buys {quantity} {item} at {price} each. What is the total cost?",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "quantity",
              "type": "value"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "price",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION"
          ],
          "modelCompatibility": [
            "DIVISION"
          ],
          "template": "{character} has {total} to spend equally on {quantity} {item}. How much can {character} spend on each one?",
          "answerTemplate": "{character} can spend {result} on each {item}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "total",
              "type": "value"
            },
            {
              "key": "quantity",
              "type": "value"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "COMPARISON",
            "ESTIMATION",
            "MULTI_STEP"
          ],
          "template": "{character} goes to the shop and buys {items}. How much does {character} spend in total?",
          "answerTemplate": "{character} spends {result} in total",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "items",
              "type": "item_list"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "ESTIMATION"
          ],
          "template": "Estimate: If {character} buys {items}, about how much will it cost?",
          "answerTemplate": "It will cost approximately {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "items",
              "type": "item_list"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "VALIDATION"
          ],
          "template": "{character} calculated that {items} costs {amount}. Is this correct?",
          "answerTemplate": "{validation_result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "items",
              "type": "item_list"
            },
            {
              "key": "amount",
              "type": "value"
            },
            {
              "key": "validation_result",
              "type": "boolean"
            }
          ]
        }
      ]
    },
    "distractors": [
      {
        "value": null,
        "displayText": "NaN",
        "strategy": "UNIT_CONFUSION",
        "reasoning": "Multiplied by percentage without converting to decimal"
      },
      {
        "value": 23.5,
        "displayText": "23.5",
        "strategy": "CLOSE_VALUE",
        "reasoning": "Off by 2"
      },
      {
        "value": 2.15,
        "displayText": "2.15",
        "strategy": "OFF_BY_MAGNITUDE",
        "reasoning": "Result is 10 times too small"
      }
    ],
    "enhancementStatus": {
      "level": "partial",
      "requestedFormat": "DIRECT_CALCULATION",
      "actualFormat": "DIRECT_CALCULATION",
      "featuresActive": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "featuresPending": [],
      "isFullyEnhanced": true
    },
    "mathOutput": {
      "operation": "PERCENTAGE",
      "base_value": 43,
      "percentage": 50,
      "result": 21.5
    },
    "generationTime": 1,
    "questionId": "q_1759130029121_f4c70j61r",
    "generationSetup": {
      "controller_used": "DIRECT_CALCULATIONController",
      "format_requested": "DIRECT_CALCULATION",
      "format_actual": "DIRECT_CALCULATION",
      "scenario_theme": "SHOPPING",
      "scenario_id": "shop-002-realistic-general",
      "scenario_selection_method": "default",
      "distractor_strategies": [
        "UNIT_CONFUSION",
        "CLOSE_VALUE",
        "OFF_BY_MAGNITUDE"
      ],
      "distractor_count": 3,
      "theme_variety": false,
      "format_variety": false,
      "enhancement_level": "partial",
      "features_active": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "features_pending": [],
      "generation_time_ms": 1
    }
  },
  "metadata": {
    "format": "DIRECT_CALCULATION",
    "cognitive_load": 40,
    "curriculum_alignment": [
      "4N1a"
    ],
    "difficulty": "4.1",
    "scenario_theme": "SHOPPING",
    "distractor_strategies": [
      "UNIT_CONFUSION",
      "CLOSE_VALUE",
      "OFF_BY_MAGNITUDE"
    ],
    "generation_time_ms": 1,
    "api_version": "2.0",
    "enhancement_status": "partial",
    "format_requested": "DIRECT_CALCULATION",
    "format_used": "DIRECT_CALCULATION",
    "features_active": [
      "enhanced_distractors",
      "rich_scenarios",
      "cognitive_load",
      "advanced_formats"
    ],
    "features_pending": []
  },
  "context": {
    "id": "shop-002-realistic-general",
    "theme": "SHOPPING",
    "setting": {
      "location": "local shop",
      "timeContext": "after school",
      "atmosphere": "friendly"
    },
    "characters": [
      {
        "name": "Oliver",
        "role": "student"
      }
    ],
    "items": [
      {
        "name": "apple",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.2,
          "max": 0.5,
          "typical": 0.35,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "banana",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.15,
          "max": 0.4,
          "typical": 0.25,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "sandwich",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 2.5,
          "max": 6,
          "typical": 4,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "drink",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.8,
          "max": 2.5,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "cake",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 1.5,
          "max": 4,
          "typical": 2.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "biscuit",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.8,
          "max": 2,
          "typical": 1.2,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "sweet",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.1,
          "max": 1,
          "typical": 0.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "chocolate",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.6,
          "max": 3,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "pen",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.5,
          "max": 2,
          "typical": 1,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "pencil",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.2,
          "max": 1,
          "typical": 0.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "ruler",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.8,
          "max": 2.5,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "notebook",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 1,
          "max": 4,
          "typical": 2,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "eraser",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.3,
          "max": 1.5,
          "typical": 0.75,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "book",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 3,
          "max": 15,
          "typical": 8,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "comic",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 2,
          "max": 5,
          "typical": 3,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "magazine",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 2.5,
          "max": 6,
          "typical": 4,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "toy",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 5,
          "max": 25,
          "typical": 12,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "game",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 8,
          "max": 60,
          "typical": 25,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "puzzle",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 5,
          "max": 20,
          "typical": 12,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "sticker",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 0.2,
          "max": 2,
          "typical": 0.8,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "badge",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 0.5,
          "max": 3,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "poster",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 2,
          "max": 8,
          "typical": 4,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "card",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 0.5,
          "max": 4,
          "typical": 2,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      }
    ],
    "culturalElements": [
      {
        "type": "currency",
        "value": "£",
        "explanation": "British pounds"
      },
      {
        "type": "location",
        "value": "UK local shop",
        "explanation": "Typical British corner shop"
      }
    ],
    "realWorldConnection": "Everyday shopping with realistic UK prices",
    "yearAppropriate": [
      1,
      2,
      3,
      4,
      5,
      6
    ],
    "templates": [
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "MULTI_STEP"
        ],
        "modelCompatibility": [
          "ADDITION"
        ],
        "operandCount": 3,
        "template": "{character} buys a {item1} for {price1}, a {item2} for {price2}, and a {item3} for {price3}. What is the total cost?",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item1",
            "type": "item"
          },
          {
            "key": "item2",
            "type": "item"
          },
          {
            "key": "item3",
            "type": "item"
          },
          {
            "key": "price1",
            "type": "value"
          },
          {
            "key": "price2",
            "type": "value"
          },
          {
            "key": "price3",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "MULTI_STEP"
        ],
        "modelCompatibility": [
          "ADDITION"
        ],
        "operandCount": 2,
        "template": "{character} buys a {item1} for {price1} and a {item2} for {price2}. What is the total cost?",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item1",
            "type": "item"
          },
          {
            "key": "item2",
            "type": "item"
          },
          {
            "key": "price1",
            "type": "value"
          },
          {
            "key": "price2",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION"
        ],
        "modelCompatibility": [
          "SUBTRACTION",
          "CHANGE_CALCULATION"
        ],
        "template": "{character} buys a {item} for {price} and pays with {payment}. How much change does {character} get?",
        "answerTemplate": "{character} receives {result} in change",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "price",
            "type": "value"
          },
          {
            "key": "payment",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION"
        ],
        "modelCompatibility": [
          "MULTIPLICATION"
        ],
        "template": "{character} buys {quantity} {item} at {price} each. What is the total cost?",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "quantity",
            "type": "value"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "price",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION"
        ],
        "modelCompatibility": [
          "DIVISION"
        ],
        "template": "{character} has {total} to spend equally on {quantity} {item}. How much can {character} spend on each one?",
        "answerTemplate": "{character} can spend {result} on each {item}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "total",
            "type": "value"
          },
          {
            "key": "quantity",
            "type": "value"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "COMPARISON",
          "ESTIMATION",
          "MULTI_STEP"
        ],
        "template": "{character} goes to the shop and buys {items}. How much does {character} spend in total?",
        "answerTemplate": "{character} spends {result} in total",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "items",
            "type": "item_list"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "ESTIMATION"
        ],
        "template": "Estimate: If {character} buys {items}, about how much will it cost?",
        "answerTemplate": "It will cost approximately {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "items",
            "type": "item_list"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "VALIDATION"
        ],
        "template": "{character} calculated that {items} costs {amount}. Is this correct?",
        "answerTemplate": "{validation_result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "items",
            "type": "item_list"
          },
          {
            "key": "amount",
            "type": "value"
          },
          {
            "key": "validation_result",
            "type": "boolean"
          }
        ]
      }
    ]
  }
}
# Test B.6: FRACTION model
{
  "success": true,
  "question": {
    "text": "What is one quarter of 39?",
    "options": [
      {
        "text": "8.75",
        "value": 8.75,
        "index": 0
      },
      {
        "text": "£9.75",
        "value": 9.75,
        "index": 1
      },
      {
        "text": "10.75",
        "value": 10.75,
        "index": 2
      }
    ],
    "correctIndex": 1,
    "questionContent": {
      "fullText": "What is one quarter of 39?",
      "templateData": {
        "numerator": 1,
        "denominator": 4,
        "whole_value": 39,
        "fraction_text": "one quarter",
        "result": 9.75
      }
    },
    "format": "DIRECT_CALCULATION",
    "difficulty": {
      "year": 4,
      "subLevel": 1,
      "displayName": "4.1",
      "cognitiveLoad": 40
    },
    "cognitiveLoad": 40,
    "curriculumTags": [
      "4N1a"
    ],
    "scenario": {
      "id": "default-4-1759130029359",
      "theme": "SHOPPING",
      "setting": {
        "location": "shop",
        "timeContext": "afternoon",
        "atmosphere": "friendly"
      },
      "characters": [
        {
          "name": "Oliver",
          "role": "student"
        }
      ],
      "items": [
        {
          "name": "item",
          "category": "HOUSEHOLD_ITEMS",
          "typicalValue": {
            "min": 1,
            "max": 10,
            "typical": 5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        }
      ],
      "culturalElements": [
        {
          "type": "currency",
          "value": "£",
          "explanation": "British pounds"
        }
      ],
      "realWorldConnection": "Basic shopping calculations",
      "yearAppropriate": [
        4
      ],
      "templates": [
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION"
          ],
          "template": "{character} buys a {item} for {price}. How much does it cost?",
          "answerTemplate": "It costs {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "price",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        }
      ]
    },
    "distractors": [
      {
        "value": 10.75,
        "displayText": "10.75",
        "strategy": "CLOSE_VALUE",
        "reasoning": "Off by 1"
      },
      {
        "value": 8.75,
        "displayText": "8.75",
        "strategy": "CLOSE_VALUE",
        "reasoning": "Off by 1"
      }
    ],
    "enhancementStatus": {
      "level": "partial",
      "requestedFormat": "DIRECT_CALCULATION",
      "actualFormat": "DIRECT_CALCULATION",
      "featuresActive": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "featuresPending": [],
      "isFullyEnhanced": true
    },
    "mathOutput": {
      "operation": "FRACTION",
      "whole_value": 39,
      "numerator": 1,
      "denominator": 4,
      "result": 9.75
    },
    "generationTime": 1,
    "questionId": "q_1759130029360_6dwkal111",
    "generationSetup": {
      "controller_used": "DIRECT_CALCULATIONController",
      "format_requested": "DIRECT_CALCULATION",
      "format_actual": "DIRECT_CALCULATION",
      "scenario_theme": "SHOPPING",
      "scenario_id": "default-4-1759130029359",
      "scenario_selection_method": "default",
      "distractor_strategies": [
        "CLOSE_VALUE",
        "CLOSE_VALUE"
      ],
      "distractor_count": 2,
      "theme_variety": false,
      "format_variety": false,
      "enhancement_level": "partial",
      "features_active": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "features_pending": [],
      "generation_time_ms": 1
    }
  },
  "metadata": {
    "format": "DIRECT_CALCULATION",
    "cognitive_load": 40,
    "curriculum_alignment": [
      "4N1a"
    ],
    "difficulty": "4.1",
    "scenario_theme": "SHOPPING",
    "distractor_strategies": [
      "CLOSE_VALUE",
      "CLOSE_VALUE"
    ],
    "generation_time_ms": 1,
    "api_version": "2.0",
    "enhancement_status": "partial",
    "format_requested": "DIRECT_CALCULATION",
    "format_used": "DIRECT_CALCULATION",
    "features_active": [
      "enhanced_distractors",
      "rich_scenarios",
      "cognitive_load",
      "advanced_formats"
    ],
    "features_pending": []
  },
  "context": {
    "id": "default-4-1759130029359",
    "theme": "SHOPPING",
    "setting": {
      "location": "shop",
      "timeContext": "afternoon",
      "atmosphere": "friendly"
    },
    "characters": [
      {
        "name": "Oliver",
        "role": "student"
      }
    ],
    "items": [
      {
        "name": "item",
        "category": "HOUSEHOLD_ITEMS",
        "typicalValue": {
          "min": 1,
          "max": 10,
          "typical": 5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      }
    ],
    "culturalElements": [
      {
        "type": "currency",
        "value": "£",
        "explanation": "British pounds"
      }
    ],
    "realWorldConnection": "Basic shopping calculations",
    "yearAppropriate": [
      4
    ],
    "templates": [
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION"
        ],
        "template": "{character} buys a {item} for {price}. How much does it cost?",
        "answerTemplate": "It costs {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "price",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      }
    ]
  }
}
# Test B.7: COUNTING model
{
  "success": true,
  "question": {
    "text": "Emma buys a item for £5. How much does it cost?",
    "options": [
      {
        "value": 0,
        "text": "0p",
        "isCorrect": true
      }
    ],
    "correctIndex": 0,
    "format": "DIRECT_CALCULATION",
    "difficulty": {
      "year": 4,
      "subLevel": 1,
      "displayName": "4.1",
      "cognitiveLoad": 40
    },
    "cognitiveLoad": 40,
    "curriculumTags": [
      "4N1a"
    ],
    "scenario": {
      "id": "default-4-1759130029475",
      "theme": "SHOPPING",
      "setting": {
        "location": "shop",
        "timeContext": "afternoon",
        "atmosphere": "friendly"
      },
      "characters": [
        {
          "name": "Emma",
          "role": "student"
        }
      ],
      "items": [
        {
          "name": "item",
          "category": "HOUSEHOLD_ITEMS",
          "typicalValue": {
            "min": 1,
            "max": 10,
            "typical": 5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        }
      ],
      "culturalElements": [
        {
          "type": "currency",
          "value": "£",
          "explanation": "British pounds"
        }
      ],
      "realWorldConnection": "Basic shopping calculations",
      "yearAppropriate": [
        4
      ],
      "templates": [
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION"
          ],
          "template": "{character} buys a {item} for {price}. How much does it cost?",
          "answerTemplate": "It costs {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "price",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        }
      ]
    },
    "distractors": [],
    "enhancementStatus": {
      "level": "partial",
      "requestedFormat": "DIRECT_CALCULATION",
      "actualFormat": "DIRECT_CALCULATION",
      "featuresActive": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "featuresPending": [],
      "isFullyEnhanced": true
    },
    "mathOutput": {
      "operation": "COUNTING"
    },
    "generationTime": 1,
    "questionId": "q_1759130029476_lurnqx54u",
    "generationSetup": {
      "controller_used": "DIRECT_CALCULATIONController",
      "format_requested": "DIRECT_CALCULATION",
      "format_actual": "DIRECT_CALCULATION",
      "scenario_theme": "SHOPPING",
      "scenario_id": "default-4-1759130029475",
      "scenario_selection_method": "default",
      "distractor_strategies": [],
      "distractor_count": 0,
      "theme_variety": false,
      "format_variety": false,
      "enhancement_level": "partial",
      "features_active": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "features_pending": [],
      "generation_time_ms": 1
    }
  },
  "metadata": {
    "format": "DIRECT_CALCULATION",
    "cognitive_load": 40,
    "curriculum_alignment": [
      "4N1a"
    ],
    "difficulty": "4.1",
    "scenario_theme": "SHOPPING",
    "distractor_strategies": [],
    "generation_time_ms": 1,
    "api_version": "2.0",
    "enhancement_status": "partial",
    "format_requested": "DIRECT_CALCULATION",
    "format_used": "DIRECT_CALCULATION",
    "features_active": [
      "enhanced_distractors",
      "rich_scenarios",
      "cognitive_load",
      "advanced_formats"
    ],
    "features_pending": []
  },
  "context": {
    "id": "default-4-1759130029475",
    "theme": "SHOPPING",
    "setting": {
      "location": "shop",
      "timeContext": "afternoon",
      "atmosphere": "friendly"
    },
    "characters": [
      {
        "name": "Emma",
        "role": "student"
      }
    ],
    "items": [
      {
        "name": "item",
        "category": "HOUSEHOLD_ITEMS",
        "typicalValue": {
          "min": 1,
          "max": 10,
          "typical": 5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      }
    ],
    "culturalElements": [
      {
        "type": "currency",
        "value": "£",
        "explanation": "British pounds"
      }
    ],
    "realWorldConnection": "Basic shopping calculations",
    "yearAppropriate": [
      4
    ],
    "templates": [
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION"
        ],
        "template": "{character} buys a {item} for {price}. How much does it cost?",
        "answerTemplate": "It costs {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "price",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      }
    ]
  }
}
# Test B.8: TIME_RATE model
{
  "success": true,
  "question": {
    "text": "Jacob buys a item for £5. How much does it cost?",
    "options": [
      {
        "value": 0,
        "text": "0p",
        "isCorrect": true
      }
    ],
    "correctIndex": 0,
    "format": "DIRECT_CALCULATION",
    "difficulty": {
      "year": 4,
      "subLevel": 1,
      "displayName": "4.1",
      "cognitiveLoad": 40
    },
    "cognitiveLoad": 40,
    "curriculumTags": [
      "4N1a"
    ],
    "scenario": {
      "id": "default-4-1759130029627",
      "theme": "SHOPPING",
      "setting": {
        "location": "shop",
        "timeContext": "afternoon",
        "atmosphere": "friendly"
      },
      "characters": [
        {
          "name": "Jacob",
          "role": "student"
        }
      ],
      "items": [
        {
          "name": "item",
          "category": "HOUSEHOLD_ITEMS",
          "typicalValue": {
            "min": 1,
            "max": 10,
            "typical": 5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        }
      ],
      "culturalElements": [
        {
          "type": "currency",
          "value": "£",
          "explanation": "British pounds"
        }
      ],
      "realWorldConnection": "Basic shopping calculations",
      "yearAppropriate": [
        4
      ],
      "templates": [
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION"
          ],
          "template": "{character} buys a {item} for {price}. How much does it cost?",
          "answerTemplate": "It costs {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "price",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        }
      ]
    },
    "distractors": [],
    "enhancementStatus": {
      "level": "partial",
      "requestedFormat": "DIRECT_CALCULATION",
      "actualFormat": "DIRECT_CALCULATION",
      "featuresActive": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "featuresPending": [],
      "isFullyEnhanced": true
    },
    "mathOutput": {
      "operation": "TIME_RATE",
      "rate": {
        "value": 25,
        "period": "day"
      }
    },
    "generationTime": 1,
    "questionId": "q_1759130029628_cgyvz6oxy",
    "generationSetup": {
      "controller_used": "DIRECT_CALCULATIONController",
      "format_requested": "DIRECT_CALCULATION",
      "format_actual": "DIRECT_CALCULATION",
      "scenario_theme": "SHOPPING",
      "scenario_id": "default-4-1759130029627",
      "scenario_selection_method": "default",
      "distractor_strategies": [],
      "distractor_count": 0,
      "theme_variety": false,
      "format_variety": false,
      "enhancement_level": "partial",
      "features_active": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "features_pending": [],
      "generation_time_ms": 1
    }
  },
  "metadata": {
    "format": "DIRECT_CALCULATION",
    "cognitive_load": 40,
    "curriculum_alignment": [
      "4N1a"
    ],
    "difficulty": "4.1",
    "scenario_theme": "SHOPPING",
    "distractor_strategies": [],
    "generation_time_ms": 1,
    "api_version": "2.0",
    "enhancement_status": "partial",
    "format_requested": "DIRECT_CALCULATION",
    "format_used": "DIRECT_CALCULATION",
    "features_active": [
      "enhanced_distractors",
      "rich_scenarios",
      "cognitive_load",
      "advanced_formats"
    ],
    "features_pending": []
  },
  "context": {
    "id": "default-4-1759130029627",
    "theme": "SHOPPING",
    "setting": {
      "location": "shop",
      "timeContext": "afternoon",
      "atmosphere": "friendly"
    },
    "characters": [
      {
        "name": "Jacob",
        "role": "student"
      }
    ],
    "items": [
      {
        "name": "item",
        "category": "HOUSEHOLD_ITEMS",
        "typicalValue": {
          "min": 1,
          "max": 10,
          "typical": 5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      }
    ],
    "culturalElements": [
      {
        "type": "currency",
        "value": "£",
        "explanation": "British pounds"
      }
    ],
    "realWorldConnection": "Basic shopping calculations",
    "yearAppropriate": [
      4
    ],
    "templates": [
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION"
        ],
        "template": "{character} buys a {item} for {price}. How much does it cost?",
        "answerTemplate": "It costs {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "price",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      }
    ]
  }
}
# Test B.9: CONVERSION model
{
  "success": true,
  "question": {
    "text": "Lucas buys a item for £5. How much does it cost?",
    "options": [
      {
        "value": 0,
        "text": "0p",
        "isCorrect": true
      }
    ],
    "correctIndex": 0,
    "format": "DIRECT_CALCULATION",
    "difficulty": {
      "year": 4,
      "subLevel": 1,
      "displayName": "4.1",
      "cognitiveLoad": 40
    },
    "cognitiveLoad": 40,
    "curriculumTags": [
      "4N1a"
    ],
    "scenario": {
      "id": "default-4-1759130029717",
      "theme": "SHOPPING",
      "setting": {
        "location": "shop",
        "timeContext": "afternoon",
        "atmosphere": "friendly"
      },
      "characters": [
        {
          "name": "Lucas",
          "role": "student"
        }
      ],
      "items": [
        {
          "name": "item",
          "category": "HOUSEHOLD_ITEMS",
          "typicalValue": {
            "min": 1,
            "max": 10,
            "typical": 5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        }
      ],
      "culturalElements": [
        {
          "type": "currency",
          "value": "£",
          "explanation": "British pounds"
        }
      ],
      "realWorldConnection": "Basic shopping calculations",
      "yearAppropriate": [
        4
      ],
      "templates": [
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION"
          ],
          "template": "{character} buys a {item} for {price}. How much does it cost?",
          "answerTemplate": "It costs {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "price",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        }
      ]
    },
    "distractors": [],
    "enhancementStatus": {
      "level": "partial",
      "requestedFormat": "DIRECT_CALCULATION",
      "actualFormat": "DIRECT_CALCULATION",
      "featuresActive": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "featuresPending": [],
      "isFullyEnhanced": true
    },
    "mathOutput": {
      "operation": "CONVERSION",
      "original_value": 982,
      "converted_value": 9.82,
      "conversion_factor": 0.01
    },
    "generationTime": 1,
    "questionId": "q_1759130029717_556merhvf",
    "generationSetup": {
      "controller_used": "DIRECT_CALCULATIONController",
      "format_requested": "DIRECT_CALCULATION",
      "format_actual": "DIRECT_CALCULATION",
      "scenario_theme": "SHOPPING",
      "scenario_id": "default-4-1759130029717",
      "scenario_selection_method": "default",
      "distractor_strategies": [],
      "distractor_count": 0,
      "theme_variety": false,
      "format_variety": false,
      "enhancement_level": "partial",
      "features_active": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "features_pending": [],
      "generation_time_ms": 1
    }
  },
  "metadata": {
    "format": "DIRECT_CALCULATION",
    "cognitive_load": 40,
    "curriculum_alignment": [
      "4N1a"
    ],
    "difficulty": "4.1",
    "scenario_theme": "SHOPPING",
    "distractor_strategies": [],
    "generation_time_ms": 1,
    "api_version": "2.0",
    "enhancement_status": "partial",
    "format_requested": "DIRECT_CALCULATION",
    "format_used": "DIRECT_CALCULATION",
    "features_active": [
      "enhanced_distractors",
      "rich_scenarios",
      "cognitive_load",
      "advanced_formats"
    ],
    "features_pending": []
  },
  "context": {
    "id": "default-4-1759130029717",
    "theme": "SHOPPING",
    "setting": {
      "location": "shop",
      "timeContext": "afternoon",
      "atmosphere": "friendly"
    },
    "characters": [
      {
        "name": "Lucas",
        "role": "student"
      }
    ],
    "items": [
      {
        "name": "item",
        "category": "HOUSEHOLD_ITEMS",
        "typicalValue": {
          "min": 1,
          "max": 10,
          "typical": 5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      }
    ],
    "culturalElements": [
      {
        "type": "currency",
        "value": "£",
        "explanation": "British pounds"
      }
    ],
    "realWorldConnection": "Basic shopping calculations",
    "yearAppropriate": [
      4
    ],
    "templates": [
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION"
        ],
        "template": "{character} buys a {item} for {price}. How much does it cost?",
        "answerTemplate": "It costs {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "price",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      }
    ]
  }
}
# Test B.10: COMPARISON model
{
  "success": true,
  "question": {
    "text": "Sarah is comparing options to find the best value.\n\nOption A: 1000ml for £25.00\nOption B: 750ml for £195.00\n\nWhich option offers better value for money?",
    "options": [
      {
        "text": "A saves you 47p",
        "value": 0,
        "index": 0
      },
      {
        "text": "Both options are equally good value",
        "value": -1,
        "index": 1
      },
      {
        "text": "A is better value",
        "value": 0,
        "index": 2
      },
      {
        "text": "B is better value",
        "value": 1,
        "index": 3
      }
    ],
    "correctIndex": 0,
    "questionContent": {
      "fullText": "Sarah is comparing options to find the best value.\n\nOption A: 1000ml for £25.00\nOption B: 750ml for £195.00\n\nWhich option offers better value for money?",
      "templateData": {
        "character": "Sarah",
        "optionA": "1000ml for £25.00",
        "optionB": "750ml for £195.00",
        "context": "general",
        "comparisonType": "price_per_unit"
      }
    },
    "format": "COMPARISON",
    "difficulty": {
      "year": 4,
      "subLevel": 1,
      "displayName": "4.1",
      "cognitiveLoad": 40
    },
    "cognitiveLoad": 40,
    "curriculumTags": [
      "4N1a"
    ],
    "scenario": {
      "id": "shop-001-bookfair",
      "theme": "SHOPPING",
      "setting": {
        "location": "school book fair",
        "timeContext": "lunch break",
        "atmosphere": "busy"
      },
      "characters": [
        {
          "name": "Sarah",
          "role": "student"
        },
        {
          "name": "Mr. Johnson",
          "role": "teacher"
        }
      ],
      "items": [
        {
          "name": "book",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 3,
            "max": 12,
            "typical": 6.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "bookmark",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.5,
            "max": 2,
            "typical": 1,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        }
      ],
      "culturalElements": [
        {
          "type": "currency",
          "value": "£",
          "explanation": "British pounds"
        },
        {
          "type": "event",
          "value": "book fair",
          "explanation": "School fundraising event"
        }
      ],
      "realWorldConnection": "School fundraising and reading promotion",
      "yearAppropriate": [
        2,
        3,
        4,
        5
      ],
      "templates": [
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "COMPARISON"
          ],
          "template": "{character} wants to buy books at the book fair. Calculate the total cost.",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        }
      ]
    },
    "distractors": [
      {
        "value": 1,
        "displayText": "B is better value",
        "strategy": "REVERSED_COMPARISON",
        "reasoning": "Selected the option with higher total price instead of better unit price"
      },
      {
        "value": -1,
        "displayText": "Both options are equally good value",
        "strategy": "WRONG_SELECTION",
        "reasoning": "Failed to calculate the difference correctly"
      },
      {
        "value": 0,
        "displayText": "A saves you 47p",
        "strategy": "CALCULATION_ERROR",
        "reasoning": "Arithmetic error in calculating the difference"
      }
    ],
    "enhancementStatus": {
      "level": "full",
      "requestedFormat": "COMPARISON",
      "actualFormat": "COMPARISON",
      "featuresActive": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "featuresPending": [],
      "isFullyEnhanced": true
    },
    "mathOutput": {
      "operation": "COMPARISON",
      "option_1_value": 25,
      "option_1_quantity": 1000,
      "option_1_price": 25,
      "option_1_unit_rate": 0.025,
      "option_2_value": 195,
      "option_2_quantity": 750,
      "option_2_price": 195,
      "option_2_unit_rate": 0.26
    },
    "generationTime": 1,
    "questionId": "q_1759130029790_1a4n6l1kn",
    "generationSetup": {
      "controller_used": "COMPARISONController",
      "format_requested": "COMPARISON",
      "format_actual": "COMPARISON",
      "scenario_theme": "SHOPPING",
      "scenario_id": "shop-001-bookfair",
      "scenario_selection_method": "default",
      "distractor_strategies": [
        "REVERSED_COMPARISON",
        "WRONG_SELECTION",
        "CALCULATION_ERROR"
      ],
      "distractor_count": 3,
      "theme_variety": false,
      "format_variety": false,
      "enhancement_level": "full",
      "features_active": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "features_pending": [],
      "generation_time_ms": 1
    }
  },
  "metadata": {
    "format": "COMPARISON",
    "cognitive_load": 40,
    "curriculum_alignment": [
      "4N1a"
    ],
    "difficulty": "4.1",
    "scenario_theme": "SHOPPING",
    "distractor_strategies": [
      "REVERSED_COMPARISON",
      "WRONG_SELECTION",
      "CALCULATION_ERROR"
    ],
    "generation_time_ms": 1,
    "api_version": "2.0",
    "enhancement_status": "full",
    "format_requested": "COMPARISON",
    "format_used": "COMPARISON",
    "features_active": [
      "enhanced_distractors",
      "rich_scenarios",
      "cognitive_load",
      "advanced_formats"
    ],
    "features_pending": []
  },
  "context": {
    "id": "shop-001-bookfair",
    "theme": "SHOPPING",
    "setting": {
      "location": "school book fair",
      "timeContext": "lunch break",
      "atmosphere": "busy"
    },
    "characters": [
      {
        "name": "Sarah",
        "role": "student"
      },
      {
        "name": "Mr. Johnson",
        "role": "teacher"
      }
    ],
    "items": [
      {
        "name": "book",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 3,
          "max": 12,
          "typical": 6.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "bookmark",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.5,
          "max": 2,
          "typical": 1,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      }
    ],
    "culturalElements": [
      {
        "type": "currency",
        "value": "£",
        "explanation": "British pounds"
      },
      {
        "type": "event",
        "value": "book fair",
        "explanation": "School fundraising event"
      }
    ],
    "realWorldConnection": "School fundraising and reading promotion",
    "yearAppropriate": [
      2,
      3,
      4,
      5
    ],
    "templates": [
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "COMPARISON"
        ],
        "template": "{character} wants to buy books at the book fair. Calculate the total cost.",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      }
    ]
  }
}
# Test B.11: MULTI_STEP model
{
  "success": true,
  "question": {
    "text": "Sarah wants to buy books at the book fair. Calculate the total cost.",
    "options": [
      {
        "text": "£18.00",
        "value": 18,
        "index": 0
      },
      {
        "text": "17",
        "value": 17,
        "index": 1
      },
      {
        "text": "19",
        "value": 19,
        "index": 2
      }
    ],
    "correctIndex": 0,
    "format": "DIRECT_CALCULATION",
    "difficulty": {
      "year": 4,
      "subLevel": 1,
      "displayName": "4.1",
      "cognitiveLoad": 40
    },
    "cognitiveLoad": 40,
    "curriculumTags": [
      "4N1a"
    ],
    "scenario": {
      "id": "shop-001-bookfair",
      "theme": "SHOPPING",
      "setting": {
        "location": "school book fair",
        "timeContext": "lunch break",
        "atmosphere": "busy"
      },
      "characters": [
        {
          "name": "Sarah",
          "role": "student"
        },
        {
          "name": "Mr. Johnson",
          "role": "teacher"
        }
      ],
      "items": [
        {
          "name": "book",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 3,
            "max": 12,
            "typical": 6.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "bookmark",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.5,
            "max": 2,
            "typical": 1,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        }
      ],
      "culturalElements": [
        {
          "type": "currency",
          "value": "£",
          "explanation": "British pounds"
        },
        {
          "type": "event",
          "value": "book fair",
          "explanation": "School fundraising event"
        }
      ],
      "realWorldConnection": "School fundraising and reading promotion",
      "yearAppropriate": [
        2,
        3,
        4,
        5
      ],
      "templates": [
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "COMPARISON"
          ],
          "template": "{character} wants to buy books at the book fair. Calculate the total cost.",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        }
      ]
    },
    "distractors": [
      {
        "value": 19,
        "displayText": "19",
        "strategy": "CLOSE_VALUE",
        "reasoning": "Off by 1"
      },
      {
        "value": 17,
        "displayText": "17",
        "strategy": "CLOSE_VALUE",
        "reasoning": "Off by 1"
      }
    ],
    "enhancementStatus": {
      "level": "partial",
      "requestedFormat": "DIRECT_CALCULATION",
      "actualFormat": "DIRECT_CALCULATION",
      "featuresActive": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "featuresPending": [],
      "isFullyEnhanced": true
    },
    "mathOutput": {
      "operation": "MULTI_STEP",
      "step_1_result": 36,
      "step_2_result": 66,
      "step_3_result": 18
    },
    "generationTime": 1,
    "questionId": "q_1759130029855_86x5gc0jj",
    "generationSetup": {
      "controller_used": "DIRECT_CALCULATIONController",
      "format_requested": "DIRECT_CALCULATION",
      "format_actual": "DIRECT_CALCULATION",
      "scenario_theme": "SHOPPING",
      "scenario_id": "shop-001-bookfair",
      "scenario_selection_method": "default",
      "distractor_strategies": [
        "CLOSE_VALUE",
        "CLOSE_VALUE"
      ],
      "distractor_count": 2,
      "theme_variety": false,
      "format_variety": false,
      "enhancement_level": "partial",
      "features_active": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "features_pending": [],
      "generation_time_ms": 1
    }
  },
  "metadata": {
    "format": "DIRECT_CALCULATION",
    "cognitive_load": 40,
    "curriculum_alignment": [
      "4N1a"
    ],
    "difficulty": "4.1",
    "scenario_theme": "SHOPPING",
    "distractor_strategies": [
      "CLOSE_VALUE",
      "CLOSE_VALUE"
    ],
    "generation_time_ms": 1,
    "api_version": "2.0",
    "enhancement_status": "partial",
    "format_requested": "DIRECT_CALCULATION",
    "format_used": "DIRECT_CALCULATION",
    "features_active": [
      "enhanced_distractors",
      "rich_scenarios",
      "cognitive_load",
      "advanced_formats"
    ],
    "features_pending": []
  },
  "context": {
    "id": "shop-001-bookfair",
    "theme": "SHOPPING",
    "setting": {
      "location": "school book fair",
      "timeContext": "lunch break",
      "atmosphere": "busy"
    },
    "characters": [
      {
        "name": "Sarah",
        "role": "student"
      },
      {
        "name": "Mr. Johnson",
        "role": "teacher"
      }
    ],
    "items": [
      {
        "name": "book",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 3,
          "max": 12,
          "typical": 6.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "bookmark",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.5,
          "max": 2,
          "typical": 1,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      }
    ],
    "culturalElements": [
      {
        "type": "currency",
        "value": "£",
        "explanation": "British pounds"
      },
      {
        "type": "event",
        "value": "book fair",
        "explanation": "School fundraising event"
      }
    ],
    "realWorldConnection": "School fundraising and reading promotion",
    "yearAppropriate": [
      2,
      3,
      4,
      5
    ],
    "templates": [
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "COMPARISON"
        ],
        "template": "{character} wants to buy books at the book fair. Calculate the total cost.",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      }
    ]
  }
}
# Test B.12: LINEAR_EQUATION model
{
  "success": true,
  "question": {
    "text": "Oliver goes to the shop and buys apple, banana, sandwich, drink, cake, biscuit, sweet, chocolate, pen, pencil, ruler, notebook, eraser, book, comic, magazine, toy, game, puzzle, sticker, badge, poster, card. How much does Oliver spend in total?",
    "options": [
      {
        "value": 0,
        "text": "0p",
        "isCorrect": true
      }
    ],
    "correctIndex": 0,
    "format": "DIRECT_CALCULATION",
    "difficulty": {
      "year": 4,
      "subLevel": 1,
      "displayName": "4.1",
      "cognitiveLoad": 40
    },
    "cognitiveLoad": 40,
    "curriculumTags": [
      "4N1a"
    ],
    "scenario": {
      "id": "shop-002-realistic-general",
      "theme": "SHOPPING",
      "setting": {
        "location": "local shop",
        "timeContext": "after school",
        "atmosphere": "friendly"
      },
      "characters": [
        {
          "name": "Oliver",
          "role": "student"
        }
      ],
      "items": [
        {
          "name": "apple",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.2,
            "max": 0.5,
            "typical": 0.35,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "banana",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.15,
            "max": 0.4,
            "typical": 0.25,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "sandwich",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 2.5,
            "max": 6,
            "typical": 4,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "drink",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.8,
            "max": 2.5,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "cake",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 1.5,
            "max": 4,
            "typical": 2.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "biscuit",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.8,
            "max": 2,
            "typical": 1.2,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "sweet",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.1,
            "max": 1,
            "typical": 0.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "chocolate",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.6,
            "max": 3,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "pen",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.5,
            "max": 2,
            "typical": 1,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "pencil",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.2,
            "max": 1,
            "typical": 0.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "ruler",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.8,
            "max": 2.5,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "notebook",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 1,
            "max": 4,
            "typical": 2,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "eraser",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.3,
            "max": 1.5,
            "typical": 0.75,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "book",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 3,
            "max": 15,
            "typical": 8,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "comic",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 2,
            "max": 5,
            "typical": 3,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "magazine",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 2.5,
            "max": 6,
            "typical": 4,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "toy",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 5,
            "max": 25,
            "typical": 12,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "game",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 8,
            "max": 60,
            "typical": 25,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "puzzle",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 5,
            "max": 20,
            "typical": 12,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "sticker",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 0.2,
            "max": 2,
            "typical": 0.8,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "badge",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 0.5,
            "max": 3,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "poster",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 2,
            "max": 8,
            "typical": 4,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "card",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 0.5,
            "max": 4,
            "typical": 2,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        }
      ],
      "culturalElements": [
        {
          "type": "currency",
          "value": "£",
          "explanation": "British pounds"
        },
        {
          "type": "location",
          "value": "UK local shop",
          "explanation": "Typical British corner shop"
        }
      ],
      "realWorldConnection": "Everyday shopping with realistic UK prices",
      "yearAppropriate": [
        1,
        2,
        3,
        4,
        5,
        6
      ],
      "templates": [
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "MULTI_STEP"
          ],
          "modelCompatibility": [
            "ADDITION"
          ],
          "operandCount": 3,
          "template": "{character} buys a {item1} for {price1}, a {item2} for {price2}, and a {item3} for {price3}. What is the total cost?",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item1",
              "type": "item"
            },
            {
              "key": "item2",
              "type": "item"
            },
            {
              "key": "item3",
              "type": "item"
            },
            {
              "key": "price1",
              "type": "value"
            },
            {
              "key": "price2",
              "type": "value"
            },
            {
              "key": "price3",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "MULTI_STEP"
          ],
          "modelCompatibility": [
            "ADDITION"
          ],
          "operandCount": 2,
          "template": "{character} buys a {item1} for {price1} and a {item2} for {price2}. What is the total cost?",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item1",
              "type": "item"
            },
            {
              "key": "item2",
              "type": "item"
            },
            {
              "key": "price1",
              "type": "value"
            },
            {
              "key": "price2",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION"
          ],
          "modelCompatibility": [
            "SUBTRACTION",
            "CHANGE_CALCULATION"
          ],
          "template": "{character} buys a {item} for {price} and pays with {payment}. How much change does {character} get?",
          "answerTemplate": "{character} receives {result} in change",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "price",
              "type": "value"
            },
            {
              "key": "payment",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION"
          ],
          "modelCompatibility": [
            "MULTIPLICATION"
          ],
          "template": "{character} buys {quantity} {item} at {price} each. What is the total cost?",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "quantity",
              "type": "value"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "price",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION"
          ],
          "modelCompatibility": [
            "DIVISION"
          ],
          "template": "{character} has {total} to spend equally on {quantity} {item}. How much can {character} spend on each one?",
          "answerTemplate": "{character} can spend {result} on each {item}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "total",
              "type": "value"
            },
            {
              "key": "quantity",
              "type": "value"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "COMPARISON",
            "ESTIMATION",
            "MULTI_STEP"
          ],
          "template": "{character} goes to the shop and buys {items}. How much does {character} spend in total?",
          "answerTemplate": "{character} spends {result} in total",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "items",
              "type": "item_list"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "ESTIMATION"
          ],
          "template": "Estimate: If {character} buys {items}, about how much will it cost?",
          "answerTemplate": "It will cost approximately {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "items",
              "type": "item_list"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "VALIDATION"
          ],
          "template": "{character} calculated that {items} costs {amount}. Is this correct?",
          "answerTemplate": "{validation_result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "items",
              "type": "item_list"
            },
            {
              "key": "amount",
              "type": "value"
            },
            {
              "key": "validation_result",
              "type": "boolean"
            }
          ]
        }
      ]
    },
    "distractors": [],
    "enhancementStatus": {
      "level": "partial",
      "requestedFormat": "DIRECT_CALCULATION",
      "actualFormat": "DIRECT_CALCULATION",
      "featuresActive": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "featuresPending": [],
      "isFullyEnhanced": true
    },
    "mathOutput": {
      "operation": "LINEAR_EQUATION",
      "slope": 2,
      "intercept": 9
    },
    "generationTime": 1,
    "questionId": "q_1759130029953_5q0u9e8wp",
    "generationSetup": {
      "controller_used": "DIRECT_CALCULATIONController",
      "format_requested": "DIRECT_CALCULATION",
      "format_actual": "DIRECT_CALCULATION",
      "scenario_theme": "SHOPPING",
      "scenario_id": "shop-002-realistic-general",
      "scenario_selection_method": "default",
      "distractor_strategies": [],
      "distractor_count": 0,
      "theme_variety": false,
      "format_variety": false,
      "enhancement_level": "partial",
      "features_active": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "features_pending": [],
      "generation_time_ms": 1
    }
  },
  "metadata": {
    "format": "DIRECT_CALCULATION",
    "cognitive_load": 40,
    "curriculum_alignment": [
      "4N1a"
    ],
    "difficulty": "4.1",
    "scenario_theme": "SHOPPING",
    "distractor_strategies": [],
    "generation_time_ms": 1,
    "api_version": "2.0",
    "enhancement_status": "partial",
    "format_requested": "DIRECT_CALCULATION",
    "format_used": "DIRECT_CALCULATION",
    "features_active": [
      "enhanced_distractors",
      "rich_scenarios",
      "cognitive_load",
      "advanced_formats"
    ],
    "features_pending": []
  },
  "context": {
    "id": "shop-002-realistic-general",
    "theme": "SHOPPING",
    "setting": {
      "location": "local shop",
      "timeContext": "after school",
      "atmosphere": "friendly"
    },
    "characters": [
      {
        "name": "Oliver",
        "role": "student"
      }
    ],
    "items": [
      {
        "name": "apple",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.2,
          "max": 0.5,
          "typical": 0.35,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "banana",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.15,
          "max": 0.4,
          "typical": 0.25,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "sandwich",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 2.5,
          "max": 6,
          "typical": 4,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "drink",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.8,
          "max": 2.5,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "cake",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 1.5,
          "max": 4,
          "typical": 2.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "biscuit",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.8,
          "max": 2,
          "typical": 1.2,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "sweet",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.1,
          "max": 1,
          "typical": 0.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "chocolate",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.6,
          "max": 3,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "pen",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.5,
          "max": 2,
          "typical": 1,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "pencil",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.2,
          "max": 1,
          "typical": 0.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "ruler",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.8,
          "max": 2.5,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "notebook",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 1,
          "max": 4,
          "typical": 2,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "eraser",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.3,
          "max": 1.5,
          "typical": 0.75,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "book",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 3,
          "max": 15,
          "typical": 8,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "comic",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 2,
          "max": 5,
          "typical": 3,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "magazine",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 2.5,
          "max": 6,
          "typical": 4,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "toy",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 5,
          "max": 25,
          "typical": 12,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "game",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 8,
          "max": 60,
          "typical": 25,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "puzzle",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 5,
          "max": 20,
          "typical": 12,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "sticker",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 0.2,
          "max": 2,
          "typical": 0.8,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "badge",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 0.5,
          "max": 3,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "poster",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 2,
          "max": 8,
          "typical": 4,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "card",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 0.5,
          "max": 4,
          "typical": 2,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      }
    ],
    "culturalElements": [
      {
        "type": "currency",
        "value": "£",
        "explanation": "British pounds"
      },
      {
        "type": "location",
        "value": "UK local shop",
        "explanation": "Typical British corner shop"
      }
    ],
    "realWorldConnection": "Everyday shopping with realistic UK prices",
    "yearAppropriate": [
      1,
      2,
      3,
      4,
      5,
      6
    ],
    "templates": [
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "MULTI_STEP"
        ],
        "modelCompatibility": [
          "ADDITION"
        ],
        "operandCount": 3,
        "template": "{character} buys a {item1} for {price1}, a {item2} for {price2}, and a {item3} for {price3}. What is the total cost?",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item1",
            "type": "item"
          },
          {
            "key": "item2",
            "type": "item"
          },
          {
            "key": "item3",
            "type": "item"
          },
          {
            "key": "price1",
            "type": "value"
          },
          {
            "key": "price2",
            "type": "value"
          },
          {
            "key": "price3",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "MULTI_STEP"
        ],
        "modelCompatibility": [
          "ADDITION"
        ],
        "operandCount": 2,
        "template": "{character} buys a {item1} for {price1} and a {item2} for {price2}. What is the total cost?",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item1",
            "type": "item"
          },
          {
            "key": "item2",
            "type": "item"
          },
          {
            "key": "price1",
            "type": "value"
          },
          {
            "key": "price2",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION"
        ],
        "modelCompatibility": [
          "SUBTRACTION",
          "CHANGE_CALCULATION"
        ],
        "template": "{character} buys a {item} for {price} and pays with {payment}. How much change does {character} get?",
        "answerTemplate": "{character} receives {result} in change",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "price",
            "type": "value"
          },
          {
            "key": "payment",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION"
        ],
        "modelCompatibility": [
          "MULTIPLICATION"
        ],
        "template": "{character} buys {quantity} {item} at {price} each. What is the total cost?",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "quantity",
            "type": "value"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "price",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION"
        ],
        "modelCompatibility": [
          "DIVISION"
        ],
        "template": "{character} has {total} to spend equally on {quantity} {item}. How much can {character} spend on each one?",
        "answerTemplate": "{character} can spend {result} on each {item}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "total",
            "type": "value"
          },
          {
            "key": "quantity",
            "type": "value"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "COMPARISON",
          "ESTIMATION",
          "MULTI_STEP"
        ],
        "template": "{character} goes to the shop and buys {items}. How much does {character} spend in total?",
        "answerTemplate": "{character} spends {result} in total",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "items",
            "type": "item_list"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "ESTIMATION"
        ],
        "template": "Estimate: If {character} buys {items}, about how much will it cost?",
        "answerTemplate": "It will cost approximately {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "items",
            "type": "item_list"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "VALIDATION"
        ],
        "template": "{character} calculated that {items} costs {amount}. Is this correct?",
        "answerTemplate": "{validation_result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "items",
            "type": "item_list"
          },
          {
            "key": "amount",
            "type": "value"
          },
          {
            "key": "validation_result",
            "type": "boolean"
          }
        ]
      }
    ]
  }
}
# Test B.13: UNIT_RATE model
{
  "success": true,
  "question": {
    "text": "Oliver goes to the shop and buys apple, banana, sandwich, drink, cake, biscuit, sweet, chocolate, pen, pencil, ruler, notebook, eraser, book, comic, magazine, toy, game, puzzle, sticker, badge, poster, card. How much does Oliver spend in total?",
    "options": [
      {
        "value": 0,
        "text": "0p",
        "isCorrect": true
      }
    ],
    "correctIndex": 0,
    "format": "DIRECT_CALCULATION",
    "difficulty": {
      "year": 4,
      "subLevel": 1,
      "displayName": "4.1",
      "cognitiveLoad": 40
    },
    "cognitiveLoad": 40,
    "curriculumTags": [
      "4N1a"
    ],
    "scenario": {
      "id": "shop-002-realistic-general",
      "theme": "SHOPPING",
      "setting": {
        "location": "local shop",
        "timeContext": "after school",
        "atmosphere": "friendly"
      },
      "characters": [
        {
          "name": "Oliver",
          "role": "student"
        }
      ],
      "items": [
        {
          "name": "apple",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.2,
            "max": 0.5,
            "typical": 0.35,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "banana",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.15,
            "max": 0.4,
            "typical": 0.25,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "sandwich",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 2.5,
            "max": 6,
            "typical": 4,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "drink",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.8,
            "max": 2.5,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "cake",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 1.5,
            "max": 4,
            "typical": 2.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "biscuit",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.8,
            "max": 2,
            "typical": 1.2,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "sweet",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.1,
            "max": 1,
            "typical": 0.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "chocolate",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.6,
            "max": 3,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "pen",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.5,
            "max": 2,
            "typical": 1,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "pencil",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.2,
            "max": 1,
            "typical": 0.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "ruler",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.8,
            "max": 2.5,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "notebook",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 1,
            "max": 4,
            "typical": 2,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "eraser",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.3,
            "max": 1.5,
            "typical": 0.75,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "book",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 3,
            "max": 15,
            "typical": 8,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "comic",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 2,
            "max": 5,
            "typical": 3,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "magazine",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 2.5,
            "max": 6,
            "typical": 4,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "toy",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 5,
            "max": 25,
            "typical": 12,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "game",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 8,
            "max": 60,
            "typical": 25,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "puzzle",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 5,
            "max": 20,
            "typical": 12,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "sticker",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 0.2,
            "max": 2,
            "typical": 0.8,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "badge",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 0.5,
            "max": 3,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "poster",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 2,
            "max": 8,
            "typical": 4,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "card",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 0.5,
            "max": 4,
            "typical": 2,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        }
      ],
      "culturalElements": [
        {
          "type": "currency",
          "value": "£",
          "explanation": "British pounds"
        },
        {
          "type": "location",
          "value": "UK local shop",
          "explanation": "Typical British corner shop"
        }
      ],
      "realWorldConnection": "Everyday shopping with realistic UK prices",
      "yearAppropriate": [
        1,
        2,
        3,
        4,
        5,
        6
      ],
      "templates": [
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "MULTI_STEP"
          ],
          "modelCompatibility": [
            "ADDITION"
          ],
          "operandCount": 3,
          "template": "{character} buys a {item1} for {price1}, a {item2} for {price2}, and a {item3} for {price3}. What is the total cost?",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item1",
              "type": "item"
            },
            {
              "key": "item2",
              "type": "item"
            },
            {
              "key": "item3",
              "type": "item"
            },
            {
              "key": "price1",
              "type": "value"
            },
            {
              "key": "price2",
              "type": "value"
            },
            {
              "key": "price3",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "MULTI_STEP"
          ],
          "modelCompatibility": [
            "ADDITION"
          ],
          "operandCount": 2,
          "template": "{character} buys a {item1} for {price1} and a {item2} for {price2}. What is the total cost?",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item1",
              "type": "item"
            },
            {
              "key": "item2",
              "type": "item"
            },
            {
              "key": "price1",
              "type": "value"
            },
            {
              "key": "price2",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION"
          ],
          "modelCompatibility": [
            "SUBTRACTION",
            "CHANGE_CALCULATION"
          ],
          "template": "{character} buys a {item} for {price} and pays with {payment}. How much change does {character} get?",
          "answerTemplate": "{character} receives {result} in change",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "price",
              "type": "value"
            },
            {
              "key": "payment",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION"
          ],
          "modelCompatibility": [
            "MULTIPLICATION"
          ],
          "template": "{character} buys {quantity} {item} at {price} each. What is the total cost?",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "quantity",
              "type": "value"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "price",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION"
          ],
          "modelCompatibility": [
            "DIVISION"
          ],
          "template": "{character} has {total} to spend equally on {quantity} {item}. How much can {character} spend on each one?",
          "answerTemplate": "{character} can spend {result} on each {item}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "total",
              "type": "value"
            },
            {
              "key": "quantity",
              "type": "value"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "COMPARISON",
            "ESTIMATION",
            "MULTI_STEP"
          ],
          "template": "{character} goes to the shop and buys {items}. How much does {character} spend in total?",
          "answerTemplate": "{character} spends {result} in total",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "items",
              "type": "item_list"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "ESTIMATION"
          ],
          "template": "Estimate: If {character} buys {items}, about how much will it cost?",
          "answerTemplate": "It will cost approximately {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "items",
              "type": "item_list"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "VALIDATION"
          ],
          "template": "{character} calculated that {items} costs {amount}. Is this correct?",
          "answerTemplate": "{validation_result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "items",
              "type": "item_list"
            },
            {
              "key": "amount",
              "type": "value"
            },
            {
              "key": "validation_result",
              "type": "boolean"
            }
          ]
        }
      ]
    },
    "distractors": [],
    "enhancementStatus": {
      "level": "partial",
      "requestedFormat": "DIRECT_CALCULATION",
      "actualFormat": "DIRECT_CALCULATION",
      "featuresActive": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "featuresPending": [],
      "isFullyEnhanced": true
    },
    "mathOutput": {
      "operation": "UNIT_RATE"
    },
    "generationTime": 1,
    "questionId": "q_1759130030064_h5dk4k11o",
    "generationSetup": {
      "controller_used": "DIRECT_CALCULATIONController",
      "format_requested": "DIRECT_CALCULATION",
      "format_actual": "DIRECT_CALCULATION",
      "scenario_theme": "SHOPPING",
      "scenario_id": "shop-002-realistic-general",
      "scenario_selection_method": "default",
      "distractor_strategies": [],
      "distractor_count": 0,
      "theme_variety": false,
      "format_variety": false,
      "enhancement_level": "partial",
      "features_active": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "features_pending": [],
      "generation_time_ms": 1
    }
  },
  "metadata": {
    "format": "DIRECT_CALCULATION",
    "cognitive_load": 40,
    "curriculum_alignment": [
      "4N1a"
    ],
    "difficulty": "4.1",
    "scenario_theme": "SHOPPING",
    "distractor_strategies": [],
    "generation_time_ms": 1,
    "api_version": "2.0",
    "enhancement_status": "partial",
    "format_requested": "DIRECT_CALCULATION",
    "format_used": "DIRECT_CALCULATION",
    "features_active": [
      "enhanced_distractors",
      "rich_scenarios",
      "cognitive_load",
      "advanced_formats"
    ],
    "features_pending": []
  },
  "context": {
    "id": "shop-002-realistic-general",
    "theme": "SHOPPING",
    "setting": {
      "location": "local shop",
      "timeContext": "after school",
      "atmosphere": "friendly"
    },
    "characters": [
      {
        "name": "Oliver",
        "role": "student"
      }
    ],
    "items": [
      {
        "name": "apple",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.2,
          "max": 0.5,
          "typical": 0.35,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "banana",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.15,
          "max": 0.4,
          "typical": 0.25,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "sandwich",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 2.5,
          "max": 6,
          "typical": 4,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "drink",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.8,
          "max": 2.5,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "cake",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 1.5,
          "max": 4,
          "typical": 2.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "biscuit",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.8,
          "max": 2,
          "typical": 1.2,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "sweet",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.1,
          "max": 1,
          "typical": 0.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "chocolate",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.6,
          "max": 3,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "pen",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.5,
          "max": 2,
          "typical": 1,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "pencil",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.2,
          "max": 1,
          "typical": 0.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "ruler",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.8,
          "max": 2.5,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "notebook",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 1,
          "max": 4,
          "typical": 2,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "eraser",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.3,
          "max": 1.5,
          "typical": 0.75,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "book",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 3,
          "max": 15,
          "typical": 8,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "comic",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 2,
          "max": 5,
          "typical": 3,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "magazine",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 2.5,
          "max": 6,
          "typical": 4,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "toy",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 5,
          "max": 25,
          "typical": 12,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "game",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 8,
          "max": 60,
          "typical": 25,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "puzzle",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 5,
          "max": 20,
          "typical": 12,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "sticker",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 0.2,
          "max": 2,
          "typical": 0.8,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "badge",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 0.5,
          "max": 3,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "poster",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 2,
          "max": 8,
          "typical": 4,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "card",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 0.5,
          "max": 4,
          "typical": 2,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      }
    ],
    "culturalElements": [
      {
        "type": "currency",
        "value": "£",
        "explanation": "British pounds"
      },
      {
        "type": "location",
        "value": "UK local shop",
        "explanation": "Typical British corner shop"
      }
    ],
    "realWorldConnection": "Everyday shopping with realistic UK prices",
    "yearAppropriate": [
      1,
      2,
      3,
      4,
      5,
      6
    ],
    "templates": [
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "MULTI_STEP"
        ],
        "modelCompatibility": [
          "ADDITION"
        ],
        "operandCount": 3,
        "template": "{character} buys a {item1} for {price1}, a {item2} for {price2}, and a {item3} for {price3}. What is the total cost?",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item1",
            "type": "item"
          },
          {
            "key": "item2",
            "type": "item"
          },
          {
            "key": "item3",
            "type": "item"
          },
          {
            "key": "price1",
            "type": "value"
          },
          {
            "key": "price2",
            "type": "value"
          },
          {
            "key": "price3",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "MULTI_STEP"
        ],
        "modelCompatibility": [
          "ADDITION"
        ],
        "operandCount": 2,
        "template": "{character} buys a {item1} for {price1} and a {item2} for {price2}. What is the total cost?",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item1",
            "type": "item"
          },
          {
            "key": "item2",
            "type": "item"
          },
          {
            "key": "price1",
            "type": "value"
          },
          {
            "key": "price2",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION"
        ],
        "modelCompatibility": [
          "SUBTRACTION",
          "CHANGE_CALCULATION"
        ],
        "template": "{character} buys a {item} for {price} and pays with {payment}. How much change does {character} get?",
        "answerTemplate": "{character} receives {result} in change",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "price",
            "type": "value"
          },
          {
            "key": "payment",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION"
        ],
        "modelCompatibility": [
          "MULTIPLICATION"
        ],
        "template": "{character} buys {quantity} {item} at {price} each. What is the total cost?",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "quantity",
            "type": "value"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "price",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION"
        ],
        "modelCompatibility": [
          "DIVISION"
        ],
        "template": "{character} has {total} to spend equally on {quantity} {item}. How much can {character} spend on each one?",
        "answerTemplate": "{character} can spend {result} on each {item}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "total",
            "type": "value"
          },
          {
            "key": "quantity",
            "type": "value"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "COMPARISON",
          "ESTIMATION",
          "MULTI_STEP"
        ],
        "template": "{character} goes to the shop and buys {items}. How much does {character} spend in total?",
        "answerTemplate": "{character} spends {result} in total",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "items",
            "type": "item_list"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "ESTIMATION"
        ],
        "template": "Estimate: If {character} buys {items}, about how much will it cost?",
        "answerTemplate": "It will cost approximately {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "items",
            "type": "item_list"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "VALIDATION"
        ],
        "template": "{character} calculated that {items} costs {amount}. Is this correct?",
        "answerTemplate": "{validation_result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "items",
            "type": "item_list"
          },
          {
            "key": "amount",
            "type": "value"
          },
          {
            "key": "validation_result",
            "type": "boolean"
          }
        ]
      }
    ]
  }
}
# Test B.14: COIN_RECOGNITION model
{
  "success": true,
  "question": {
    "text": "Oliver goes to the shop and buys apple, banana, sandwich, drink, cake, biscuit, sweet, chocolate, pen, pencil, ruler, notebook, eraser, book, comic, magazine, toy, game, puzzle, sticker, badge, poster, card. How much does Oliver spend in total?",
    "options": [
      {
        "value": 0,
        "text": "0p",
        "isCorrect": true
      }
    ],
    "correctIndex": 0,
    "format": "DIRECT_CALCULATION",
    "difficulty": {
      "year": 4,
      "subLevel": 1,
      "displayName": "4.1",
      "cognitiveLoad": 40
    },
    "cognitiveLoad": 40,
    "curriculumTags": [
      "4N1a"
    ],
    "scenario": {
      "id": "shop-002-realistic-general",
      "theme": "SHOPPING",
      "setting": {
        "location": "local shop",
        "timeContext": "after school",
        "atmosphere": "friendly"
      },
      "characters": [
        {
          "name": "Oliver",
          "role": "student"
        }
      ],
      "items": [
        {
          "name": "apple",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.2,
            "max": 0.5,
            "typical": 0.35,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "banana",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.15,
            "max": 0.4,
            "typical": 0.25,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "sandwich",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 2.5,
            "max": 6,
            "typical": 4,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "drink",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.8,
            "max": 2.5,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "cake",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 1.5,
            "max": 4,
            "typical": 2.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "biscuit",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.8,
            "max": 2,
            "typical": 1.2,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "sweet",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.1,
            "max": 1,
            "typical": 0.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "chocolate",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.6,
            "max": 3,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "pen",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.5,
            "max": 2,
            "typical": 1,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "pencil",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.2,
            "max": 1,
            "typical": 0.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "ruler",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.8,
            "max": 2.5,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "notebook",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 1,
            "max": 4,
            "typical": 2,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "eraser",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.3,
            "max": 1.5,
            "typical": 0.75,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "book",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 3,
            "max": 15,
            "typical": 8,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "comic",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 2,
            "max": 5,
            "typical": 3,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "magazine",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 2.5,
            "max": 6,
            "typical": 4,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "toy",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 5,
            "max": 25,
            "typical": 12,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "game",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 8,
            "max": 60,
            "typical": 25,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "puzzle",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 5,
            "max": 20,
            "typical": 12,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "sticker",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 0.2,
            "max": 2,
            "typical": 0.8,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "badge",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 0.5,
            "max": 3,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "poster",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 2,
            "max": 8,
            "typical": 4,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "card",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 0.5,
            "max": 4,
            "typical": 2,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        }
      ],
      "culturalElements": [
        {
          "type": "currency",
          "value": "£",
          "explanation": "British pounds"
        },
        {
          "type": "location",
          "value": "UK local shop",
          "explanation": "Typical British corner shop"
        }
      ],
      "realWorldConnection": "Everyday shopping with realistic UK prices",
      "yearAppropriate": [
        1,
        2,
        3,
        4,
        5,
        6
      ],
      "templates": [
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "MULTI_STEP"
          ],
          "modelCompatibility": [
            "ADDITION"
          ],
          "operandCount": 3,
          "template": "{character} buys a {item1} for {price1}, a {item2} for {price2}, and a {item3} for {price3}. What is the total cost?",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item1",
              "type": "item"
            },
            {
              "key": "item2",
              "type": "item"
            },
            {
              "key": "item3",
              "type": "item"
            },
            {
              "key": "price1",
              "type": "value"
            },
            {
              "key": "price2",
              "type": "value"
            },
            {
              "key": "price3",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "MULTI_STEP"
          ],
          "modelCompatibility": [
            "ADDITION"
          ],
          "operandCount": 2,
          "template": "{character} buys a {item1} for {price1} and a {item2} for {price2}. What is the total cost?",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item1",
              "type": "item"
            },
            {
              "key": "item2",
              "type": "item"
            },
            {
              "key": "price1",
              "type": "value"
            },
            {
              "key": "price2",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION"
          ],
          "modelCompatibility": [
            "SUBTRACTION",
            "CHANGE_CALCULATION"
          ],
          "template": "{character} buys a {item} for {price} and pays with {payment}. How much change does {character} get?",
          "answerTemplate": "{character} receives {result} in change",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "price",
              "type": "value"
            },
            {
              "key": "payment",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION"
          ],
          "modelCompatibility": [
            "MULTIPLICATION"
          ],
          "template": "{character} buys {quantity} {item} at {price} each. What is the total cost?",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "quantity",
              "type": "value"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "price",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION"
          ],
          "modelCompatibility": [
            "DIVISION"
          ],
          "template": "{character} has {total} to spend equally on {quantity} {item}. How much can {character} spend on each one?",
          "answerTemplate": "{character} can spend {result} on each {item}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "total",
              "type": "value"
            },
            {
              "key": "quantity",
              "type": "value"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "COMPARISON",
            "ESTIMATION",
            "MULTI_STEP"
          ],
          "template": "{character} goes to the shop and buys {items}. How much does {character} spend in total?",
          "answerTemplate": "{character} spends {result} in total",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "items",
              "type": "item_list"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "ESTIMATION"
          ],
          "template": "Estimate: If {character} buys {items}, about how much will it cost?",
          "answerTemplate": "It will cost approximately {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "items",
              "type": "item_list"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "VALIDATION"
          ],
          "template": "{character} calculated that {items} costs {amount}. Is this correct?",
          "answerTemplate": "{validation_result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "items",
              "type": "item_list"
            },
            {
              "key": "amount",
              "type": "value"
            },
            {
              "key": "validation_result",
              "type": "boolean"
            }
          ]
        }
      ]
    },
    "distractors": [],
    "enhancementStatus": {
      "level": "partial",
      "requestedFormat": "DIRECT_CALCULATION",
      "actualFormat": "DIRECT_CALCULATION",
      "featuresActive": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "featuresPending": [],
      "isFullyEnhanced": true
    },
    "mathOutput": {
      "operation": "COIN_RECOGNITION",
      "total_value": 2000
    },
    "generationTime": 0,
    "questionId": "q_1759130030130_cx1p2goi7",
    "generationSetup": {
      "controller_used": "DIRECT_CALCULATIONController",
      "format_requested": "DIRECT_CALCULATION",
      "format_actual": "DIRECT_CALCULATION",
      "scenario_theme": "SHOPPING",
      "scenario_id": "shop-002-realistic-general",
      "scenario_selection_method": "default",
      "distractor_strategies": [],
      "distractor_count": 0,
      "theme_variety": false,
      "format_variety": false,
      "enhancement_level": "partial",
      "features_active": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "features_pending": [],
      "generation_time_ms": 0
    }
  },
  "metadata": {
    "format": "DIRECT_CALCULATION",
    "cognitive_load": 40,
    "curriculum_alignment": [
      "4N1a"
    ],
    "difficulty": "4.1",
    "scenario_theme": "SHOPPING",
    "distractor_strategies": [],
    "generation_time_ms": 1,
    "api_version": "2.0",
    "enhancement_status": "partial",
    "format_requested": "DIRECT_CALCULATION",
    "format_used": "DIRECT_CALCULATION",
    "features_active": [
      "enhanced_distractors",
      "rich_scenarios",
      "cognitive_load",
      "advanced_formats"
    ],
    "features_pending": []
  },
  "context": {
    "id": "shop-002-realistic-general",
    "theme": "SHOPPING",
    "setting": {
      "location": "local shop",
      "timeContext": "after school",
      "atmosphere": "friendly"
    },
    "characters": [
      {
        "name": "Oliver",
        "role": "student"
      }
    ],
    "items": [
      {
        "name": "apple",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.2,
          "max": 0.5,
          "typical": 0.35,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "banana",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.15,
          "max": 0.4,
          "typical": 0.25,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "sandwich",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 2.5,
          "max": 6,
          "typical": 4,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "drink",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.8,
          "max": 2.5,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "cake",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 1.5,
          "max": 4,
          "typical": 2.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "biscuit",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.8,
          "max": 2,
          "typical": 1.2,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "sweet",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.1,
          "max": 1,
          "typical": 0.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "chocolate",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.6,
          "max": 3,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "pen",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.5,
          "max": 2,
          "typical": 1,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "pencil",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.2,
          "max": 1,
          "typical": 0.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "ruler",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.8,
          "max": 2.5,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "notebook",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 1,
          "max": 4,
          "typical": 2,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "eraser",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.3,
          "max": 1.5,
          "typical": 0.75,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "book",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 3,
          "max": 15,
          "typical": 8,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "comic",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 2,
          "max": 5,
          "typical": 3,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "magazine",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 2.5,
          "max": 6,
          "typical": 4,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "toy",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 5,
          "max": 25,
          "typical": 12,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "game",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 8,
          "max": 60,
          "typical": 25,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "puzzle",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 5,
          "max": 20,
          "typical": 12,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "sticker",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 0.2,
          "max": 2,
          "typical": 0.8,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "badge",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 0.5,
          "max": 3,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "poster",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 2,
          "max": 8,
          "typical": 4,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "card",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 0.5,
          "max": 4,
          "typical": 2,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      }
    ],
    "culturalElements": [
      {
        "type": "currency",
        "value": "£",
        "explanation": "British pounds"
      },
      {
        "type": "location",
        "value": "UK local shop",
        "explanation": "Typical British corner shop"
      }
    ],
    "realWorldConnection": "Everyday shopping with realistic UK prices",
    "yearAppropriate": [
      1,
      2,
      3,
      4,
      5,
      6
    ],
    "templates": [
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "MULTI_STEP"
        ],
        "modelCompatibility": [
          "ADDITION"
        ],
        "operandCount": 3,
        "template": "{character} buys a {item1} for {price1}, a {item2} for {price2}, and a {item3} for {price3}. What is the total cost?",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item1",
            "type": "item"
          },
          {
            "key": "item2",
            "type": "item"
          },
          {
            "key": "item3",
            "type": "item"
          },
          {
            "key": "price1",
            "type": "value"
          },
          {
            "key": "price2",
            "type": "value"
          },
          {
            "key": "price3",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "MULTI_STEP"
        ],
        "modelCompatibility": [
          "ADDITION"
        ],
        "operandCount": 2,
        "template": "{character} buys a {item1} for {price1} and a {item2} for {price2}. What is the total cost?",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item1",
            "type": "item"
          },
          {
            "key": "item2",
            "type": "item"
          },
          {
            "key": "price1",
            "type": "value"
          },
          {
            "key": "price2",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION"
        ],
        "modelCompatibility": [
          "SUBTRACTION",
          "CHANGE_CALCULATION"
        ],
        "template": "{character} buys a {item} for {price} and pays with {payment}. How much change does {character} get?",
        "answerTemplate": "{character} receives {result} in change",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "price",
            "type": "value"
          },
          {
            "key": "payment",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION"
        ],
        "modelCompatibility": [
          "MULTIPLICATION"
        ],
        "template": "{character} buys {quantity} {item} at {price} each. What is the total cost?",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "quantity",
            "type": "value"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "price",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION"
        ],
        "modelCompatibility": [
          "DIVISION"
        ],
        "template": "{character} has {total} to spend equally on {quantity} {item}. How much can {character} spend on each one?",
        "answerTemplate": "{character} can spend {result} on each {item}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "total",
            "type": "value"
          },
          {
            "key": "quantity",
            "type": "value"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "COMPARISON",
          "ESTIMATION",
          "MULTI_STEP"
        ],
        "template": "{character} goes to the shop and buys {items}. How much does {character} spend in total?",
        "answerTemplate": "{character} spends {result} in total",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "items",
            "type": "item_list"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "ESTIMATION"
        ],
        "template": "Estimate: If {character} buys {items}, about how much will it cost?",
        "answerTemplate": "It will cost approximately {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "items",
            "type": "item_list"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "VALIDATION"
        ],
        "template": "{character} calculated that {items} costs {amount}. Is this correct?",
        "answerTemplate": "{validation_result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "items",
            "type": "item_list"
          },
          {
            "key": "amount",
            "type": "value"
          },
          {
            "key": "validation_result",
            "type": "boolean"
          }
        ]
      }
    ]
  }
}
# Test B.15: CHANGE_CALCULATION model
{
  "success": true,
  "question": {
    "text": "Sarah wants to buy books at the book fair. Calculate the total cost.",
    "options": [
      {
        "value": 0,
        "text": "0p",
        "isCorrect": true
      }
    ],
    "correctIndex": 0,
    "format": "DIRECT_CALCULATION",
    "difficulty": {
      "year": 4,
      "subLevel": 1,
      "displayName": "4.1",
      "cognitiveLoad": 40
    },
    "cognitiveLoad": 40,
    "curriculumTags": [
      "4N1a"
    ],
    "scenario": {
      "id": "shop-001-bookfair",
      "theme": "SHOPPING",
      "setting": {
        "location": "school book fair",
        "timeContext": "lunch break",
        "atmosphere": "busy"
      },
      "characters": [
        {
          "name": "Sarah",
          "role": "student"
        },
        {
          "name": "Mr. Johnson",
          "role": "teacher"
        }
      ],
      "items": [
        {
          "name": "book",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 3,
            "max": 12,
            "typical": 6.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "bookmark",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.5,
            "max": 2,
            "typical": 1,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        }
      ],
      "culturalElements": [
        {
          "type": "currency",
          "value": "£",
          "explanation": "British pounds"
        },
        {
          "type": "event",
          "value": "book fair",
          "explanation": "School fundraising event"
        }
      ],
      "realWorldConnection": "School fundraising and reading promotion",
      "yearAppropriate": [
        2,
        3,
        4,
        5
      ],
      "templates": [
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "COMPARISON"
          ],
          "template": "{character} wants to buy books at the book fair. Calculate the total cost.",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        }
      ]
    },
    "distractors": [],
    "enhancementStatus": {
      "level": "partial",
      "requestedFormat": "DIRECT_CALCULATION",
      "actualFormat": "DIRECT_CALCULATION",
      "featuresActive": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "featuresPending": [],
      "isFullyEnhanced": true
    },
    "mathOutput": {
      "operation": "CHANGE_CALCULATION"
    },
    "generationTime": 1,
    "questionId": "q_1759130030179_lp33vh62j",
    "generationSetup": {
      "controller_used": "DIRECT_CALCULATIONController",
      "format_requested": "DIRECT_CALCULATION",
      "format_actual": "DIRECT_CALCULATION",
      "scenario_theme": "SHOPPING",
      "scenario_id": "shop-001-bookfair",
      "scenario_selection_method": "default",
      "distractor_strategies": [],
      "distractor_count": 0,
      "theme_variety": false,
      "format_variety": false,
      "enhancement_level": "partial",
      "features_active": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "features_pending": [],
      "generation_time_ms": 1
    }
  },
  "metadata": {
    "format": "DIRECT_CALCULATION",
    "cognitive_load": 40,
    "curriculum_alignment": [
      "4N1a"
    ],
    "difficulty": "4.1",
    "scenario_theme": "SHOPPING",
    "distractor_strategies": [],
    "generation_time_ms": 1,
    "api_version": "2.0",
    "enhancement_status": "partial",
    "format_requested": "DIRECT_CALCULATION",
    "format_used": "DIRECT_CALCULATION",
    "features_active": [
      "enhanced_distractors",
      "rich_scenarios",
      "cognitive_load",
      "advanced_formats"
    ],
    "features_pending": []
  },
  "context": {
    "id": "shop-001-bookfair",
    "theme": "SHOPPING",
    "setting": {
      "location": "school book fair",
      "timeContext": "lunch break",
      "atmosphere": "busy"
    },
    "characters": [
      {
        "name": "Sarah",
        "role": "student"
      },
      {
        "name": "Mr. Johnson",
        "role": "teacher"
      }
    ],
    "items": [
      {
        "name": "book",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 3,
          "max": 12,
          "typical": 6.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "bookmark",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.5,
          "max": 2,
          "typical": 1,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      }
    ],
    "culturalElements": [
      {
        "type": "currency",
        "value": "£",
        "explanation": "British pounds"
      },
      {
        "type": "event",
        "value": "book fair",
        "explanation": "School fundraising event"
      }
    ],
    "realWorldConnection": "School fundraising and reading promotion",
    "yearAppropriate": [
      2,
      3,
      4,
      5
    ],
    "templates": [
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "COMPARISON"
        ],
        "template": "{character} wants to buy books at the book fair. Calculate the total cost.",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      }
    ]
  }
}
# Test B.16: MONEY_COMBINATIONS model
{
  "success": true,
  "question": {
    "text": "Sarah wants to buy books at the book fair. Calculate the total cost.",
    "options": [
      {
        "value": 0,
        "text": "0p",
        "isCorrect": true
      }
    ],
    "correctIndex": 0,
    "format": "DIRECT_CALCULATION",
    "difficulty": {
      "year": 4,
      "subLevel": 1,
      "displayName": "4.1",
      "cognitiveLoad": 40
    },
    "cognitiveLoad": 40,
    "curriculumTags": [
      "4N1a"
    ],
    "scenario": {
      "id": "shop-001-bookfair",
      "theme": "SHOPPING",
      "setting": {
        "location": "school book fair",
        "timeContext": "lunch break",
        "atmosphere": "busy"
      },
      "characters": [
        {
          "name": "Sarah",
          "role": "student"
        },
        {
          "name": "Mr. Johnson",
          "role": "teacher"
        }
      ],
      "items": [
        {
          "name": "book",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 3,
            "max": 12,
            "typical": 6.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "bookmark",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.5,
            "max": 2,
            "typical": 1,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        }
      ],
      "culturalElements": [
        {
          "type": "currency",
          "value": "£",
          "explanation": "British pounds"
        },
        {
          "type": "event",
          "value": "book fair",
          "explanation": "School fundraising event"
        }
      ],
      "realWorldConnection": "School fundraising and reading promotion",
      "yearAppropriate": [
        2,
        3,
        4,
        5
      ],
      "templates": [
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "COMPARISON"
          ],
          "template": "{character} wants to buy books at the book fair. Calculate the total cost.",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        }
      ]
    },
    "distractors": [],
    "enhancementStatus": {
      "level": "partial",
      "requestedFormat": "DIRECT_CALCULATION",
      "actualFormat": "DIRECT_CALCULATION",
      "featuresActive": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "featuresPending": [],
      "isFullyEnhanced": true
    },
    "mathOutput": {
      "operation": "MONEY_COMBINATIONS",
      "target_amount": 157,
      "combination_count": 5
    },
    "generationTime": 72,
    "questionId": "q_1759130030302_7xpa70oql",
    "generationSetup": {
      "controller_used": "DIRECT_CALCULATIONController",
      "format_requested": "DIRECT_CALCULATION",
      "format_actual": "DIRECT_CALCULATION",
      "scenario_theme": "SHOPPING",
      "scenario_id": "shop-001-bookfair",
      "scenario_selection_method": "default",
      "distractor_strategies": [],
      "distractor_count": 0,
      "theme_variety": false,
      "format_variety": false,
      "enhancement_level": "partial",
      "features_active": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "features_pending": [],
      "generation_time_ms": 72
    }
  },
  "metadata": {
    "format": "DIRECT_CALCULATION",
    "cognitive_load": 40,
    "curriculum_alignment": [
      "4N1a"
    ],
    "difficulty": "4.1",
    "scenario_theme": "SHOPPING",
    "distractor_strategies": [],
    "generation_time_ms": 72,
    "api_version": "2.0",
    "enhancement_status": "partial",
    "format_requested": "DIRECT_CALCULATION",
    "format_used": "DIRECT_CALCULATION",
    "features_active": [
      "enhanced_distractors",
      "rich_scenarios",
      "cognitive_load",
      "advanced_formats"
    ],
    "features_pending": []
  },
  "context": {
    "id": "shop-001-bookfair",
    "theme": "SHOPPING",
    "setting": {
      "location": "school book fair",
      "timeContext": "lunch break",
      "atmosphere": "busy"
    },
    "characters": [
      {
        "name": "Sarah",
        "role": "student"
      },
      {
        "name": "Mr. Johnson",
        "role": "teacher"
      }
    ],
    "items": [
      {
        "name": "book",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 3,
          "max": 12,
          "typical": 6.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "bookmark",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.5,
          "max": 2,
          "typical": 1,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      }
    ],
    "culturalElements": [
      {
        "type": "currency",
        "value": "£",
        "explanation": "British pounds"
      },
      {
        "type": "event",
        "value": "book fair",
        "explanation": "School fundraising event"
      }
    ],
    "realWorldConnection": "School fundraising and reading promotion",
    "yearAppropriate": [
      2,
      3,
      4,
      5
    ],
    "templates": [
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "COMPARISON"
        ],
        "template": "{character} wants to buy books at the book fair. Calculate the total cost.",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      }
    ]
  }
}
# Test B.17: MIXED_MONEY_UNITS model
{
  "error": "Failed to generate enhanced question",
  "details": "value.toFixed is not a function",
  "api_version": "2.0"
}
# Test B.18: MONEY_FRACTIONS model
{
  "success": true,
  "question": {
    "text": "Oliver goes to the shop and buys apple, banana, sandwich, drink, cake, biscuit, sweet, chocolate, pen, pencil, ruler, notebook, eraser, book, comic, magazine, toy, game, puzzle, sticker, badge, poster, card. How much does Oliver spend in total?",
    "options": [
      {
        "text": "£18.75",
        "value": 18.75,
        "index": 0
      },
      {
        "text": "19.75",
        "value": 19.75,
        "index": 1
      },
      {
        "text": "17.75",
        "value": 17.75,
        "index": 2
      }
    ],
    "correctIndex": 0,
    "format": "DIRECT_CALCULATION",
    "difficulty": {
      "year": 4,
      "subLevel": 1,
      "displayName": "4.1",
      "cognitiveLoad": 40
    },
    "cognitiveLoad": 40,
    "curriculumTags": [
      "4N1a"
    ],
    "scenario": {
      "id": "shop-002-realistic-general",
      "theme": "SHOPPING",
      "setting": {
        "location": "local shop",
        "timeContext": "after school",
        "atmosphere": "friendly"
      },
      "characters": [
        {
          "name": "Oliver",
          "role": "student"
        }
      ],
      "items": [
        {
          "name": "apple",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.2,
            "max": 0.5,
            "typical": 0.35,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "banana",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.15,
            "max": 0.4,
            "typical": 0.25,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "sandwich",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 2.5,
            "max": 6,
            "typical": 4,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "drink",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.8,
            "max": 2.5,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "cake",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 1.5,
            "max": 4,
            "typical": 2.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "biscuit",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.8,
            "max": 2,
            "typical": 1.2,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "sweet",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.1,
            "max": 1,
            "typical": 0.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "chocolate",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.6,
            "max": 3,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "pen",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.5,
            "max": 2,
            "typical": 1,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "pencil",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.2,
            "max": 1,
            "typical": 0.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "ruler",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.8,
            "max": 2.5,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "notebook",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 1,
            "max": 4,
            "typical": 2,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "eraser",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.3,
            "max": 1.5,
            "typical": 0.75,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "book",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 3,
            "max": 15,
            "typical": 8,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "comic",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 2,
            "max": 5,
            "typical": 3,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "magazine",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 2.5,
            "max": 6,
            "typical": 4,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "toy",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 5,
            "max": 25,
            "typical": 12,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "game",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 8,
            "max": 60,
            "typical": 25,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "puzzle",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 5,
            "max": 20,
            "typical": 12,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "sticker",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 0.2,
            "max": 2,
            "typical": 0.8,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "badge",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 0.5,
            "max": 3,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "poster",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 2,
            "max": 8,
            "typical": 4,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "card",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 0.5,
            "max": 4,
            "typical": 2,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        }
      ],
      "culturalElements": [
        {
          "type": "currency",
          "value": "£",
          "explanation": "British pounds"
        },
        {
          "type": "location",
          "value": "UK local shop",
          "explanation": "Typical British corner shop"
        }
      ],
      "realWorldConnection": "Everyday shopping with realistic UK prices",
      "yearAppropriate": [
        1,
        2,
        3,
        4,
        5,
        6
      ],
      "templates": [
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "MULTI_STEP"
          ],
          "modelCompatibility": [
            "ADDITION"
          ],
          "operandCount": 3,
          "template": "{character} buys a {item1} for {price1}, a {item2} for {price2}, and a {item3} for {price3}. What is the total cost?",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item1",
              "type": "item"
            },
            {
              "key": "item2",
              "type": "item"
            },
            {
              "key": "item3",
              "type": "item"
            },
            {
              "key": "price1",
              "type": "value"
            },
            {
              "key": "price2",
              "type": "value"
            },
            {
              "key": "price3",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "MULTI_STEP"
          ],
          "modelCompatibility": [
            "ADDITION"
          ],
          "operandCount": 2,
          "template": "{character} buys a {item1} for {price1} and a {item2} for {price2}. What is the total cost?",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item1",
              "type": "item"
            },
            {
              "key": "item2",
              "type": "item"
            },
            {
              "key": "price1",
              "type": "value"
            },
            {
              "key": "price2",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION"
          ],
          "modelCompatibility": [
            "SUBTRACTION",
            "CHANGE_CALCULATION"
          ],
          "template": "{character} buys a {item} for {price} and pays with {payment}. How much change does {character} get?",
          "answerTemplate": "{character} receives {result} in change",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "price",
              "type": "value"
            },
            {
              "key": "payment",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION"
          ],
          "modelCompatibility": [
            "MULTIPLICATION"
          ],
          "template": "{character} buys {quantity} {item} at {price} each. What is the total cost?",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "quantity",
              "type": "value"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "price",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION"
          ],
          "modelCompatibility": [
            "DIVISION"
          ],
          "template": "{character} has {total} to spend equally on {quantity} {item}. How much can {character} spend on each one?",
          "answerTemplate": "{character} can spend {result} on each {item}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "total",
              "type": "value"
            },
            {
              "key": "quantity",
              "type": "value"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "COMPARISON",
            "ESTIMATION",
            "MULTI_STEP"
          ],
          "template": "{character} goes to the shop and buys {items}. How much does {character} spend in total?",
          "answerTemplate": "{character} spends {result} in total",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "items",
              "type": "item_list"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "ESTIMATION"
          ],
          "template": "Estimate: If {character} buys {items}, about how much will it cost?",
          "answerTemplate": "It will cost approximately {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "items",
              "type": "item_list"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "VALIDATION"
          ],
          "template": "{character} calculated that {items} costs {amount}. Is this correct?",
          "answerTemplate": "{validation_result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "items",
              "type": "item_list"
            },
            {
              "key": "amount",
              "type": "value"
            },
            {
              "key": "validation_result",
              "type": "boolean"
            }
          ]
        }
      ]
    },
    "distractors": [
      {
        "value": 19.75,
        "displayText": "19.75",
        "strategy": "CLOSE_VALUE",
        "reasoning": "Off by 1"
      },
      {
        "value": 17.75,
        "displayText": "17.75",
        "strategy": "CLOSE_VALUE",
        "reasoning": "Off by 1"
      }
    ],
    "enhancementStatus": {
      "level": "partial",
      "requestedFormat": "DIRECT_CALCULATION",
      "actualFormat": "DIRECT_CALCULATION",
      "featuresActive": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "featuresPending": [],
      "isFullyEnhanced": true
    },
    "mathOutput": {
      "operation": "MONEY_FRACTIONS",
      "result": 18.75
    },
    "generationTime": 0,
    "questionId": "q_1759130030458_zz3kgamvc",
    "generationSetup": {
      "controller_used": "DIRECT_CALCULATIONController",
      "format_requested": "DIRECT_CALCULATION",
      "format_actual": "DIRECT_CALCULATION",
      "scenario_theme": "SHOPPING",
      "scenario_id": "shop-002-realistic-general",
      "scenario_selection_method": "default",
      "distractor_strategies": [
        "CLOSE_VALUE",
        "CLOSE_VALUE"
      ],
      "distractor_count": 2,
      "theme_variety": false,
      "format_variety": false,
      "enhancement_level": "partial",
      "features_active": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "features_pending": [],
      "generation_time_ms": 0
    }
  },
  "metadata": {
    "format": "DIRECT_CALCULATION",
    "cognitive_load": 40,
    "curriculum_alignment": [
      "4N1a"
    ],
    "difficulty": "4.1",
    "scenario_theme": "SHOPPING",
    "distractor_strategies": [
      "CLOSE_VALUE",
      "CLOSE_VALUE"
    ],
    "generation_time_ms": 0,
    "api_version": "2.0",
    "enhancement_status": "partial",
    "format_requested": "DIRECT_CALCULATION",
    "format_used": "DIRECT_CALCULATION",
    "features_active": [
      "enhanced_distractors",
      "rich_scenarios",
      "cognitive_load",
      "advanced_formats"
    ],
    "features_pending": []
  },
  "context": {
    "id": "shop-002-realistic-general",
    "theme": "SHOPPING",
    "setting": {
      "location": "local shop",
      "timeContext": "after school",
      "atmosphere": "friendly"
    },
    "characters": [
      {
        "name": "Oliver",
        "role": "student"
      }
    ],
    "items": [
      {
        "name": "apple",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.2,
          "max": 0.5,
          "typical": 0.35,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "banana",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.15,
          "max": 0.4,
          "typical": 0.25,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "sandwich",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 2.5,
          "max": 6,
          "typical": 4,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "drink",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.8,
          "max": 2.5,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "cake",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 1.5,
          "max": 4,
          "typical": 2.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "biscuit",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.8,
          "max": 2,
          "typical": 1.2,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "sweet",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.1,
          "max": 1,
          "typical": 0.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "chocolate",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.6,
          "max": 3,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "pen",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.5,
          "max": 2,
          "typical": 1,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "pencil",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.2,
          "max": 1,
          "typical": 0.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "ruler",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.8,
          "max": 2.5,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "notebook",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 1,
          "max": 4,
          "typical": 2,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "eraser",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.3,
          "max": 1.5,
          "typical": 0.75,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "book",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 3,
          "max": 15,
          "typical": 8,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "comic",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 2,
          "max": 5,
          "typical": 3,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "magazine",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 2.5,
          "max": 6,
          "typical": 4,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "toy",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 5,
          "max": 25,
          "typical": 12,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "game",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 8,
          "max": 60,
          "typical": 25,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "puzzle",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 5,
          "max": 20,
          "typical": 12,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "sticker",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 0.2,
          "max": 2,
          "typical": 0.8,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "badge",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 0.5,
          "max": 3,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "poster",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 2,
          "max": 8,
          "typical": 4,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "card",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 0.5,
          "max": 4,
          "typical": 2,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      }
    ],
    "culturalElements": [
      {
        "type": "currency",
        "value": "£",
        "explanation": "British pounds"
      },
      {
        "type": "location",
        "value": "UK local shop",
        "explanation": "Typical British corner shop"
      }
    ],
    "realWorldConnection": "Everyday shopping with realistic UK prices",
    "yearAppropriate": [
      1,
      2,
      3,
      4,
      5,
      6
    ],
    "templates": [
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "MULTI_STEP"
        ],
        "modelCompatibility": [
          "ADDITION"
        ],
        "operandCount": 3,
        "template": "{character} buys a {item1} for {price1}, a {item2} for {price2}, and a {item3} for {price3}. What is the total cost?",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item1",
            "type": "item"
          },
          {
            "key": "item2",
            "type": "item"
          },
          {
            "key": "item3",
            "type": "item"
          },
          {
            "key": "price1",
            "type": "value"
          },
          {
            "key": "price2",
            "type": "value"
          },
          {
            "key": "price3",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "MULTI_STEP"
        ],
        "modelCompatibility": [
          "ADDITION"
        ],
        "operandCount": 2,
        "template": "{character} buys a {item1} for {price1} and a {item2} for {price2}. What is the total cost?",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item1",
            "type": "item"
          },
          {
            "key": "item2",
            "type": "item"
          },
          {
            "key": "price1",
            "type": "value"
          },
          {
            "key": "price2",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION"
        ],
        "modelCompatibility": [
          "SUBTRACTION",
          "CHANGE_CALCULATION"
        ],
        "template": "{character} buys a {item} for {price} and pays with {payment}. How much change does {character} get?",
        "answerTemplate": "{character} receives {result} in change",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "price",
            "type": "value"
          },
          {
            "key": "payment",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION"
        ],
        "modelCompatibility": [
          "MULTIPLICATION"
        ],
        "template": "{character} buys {quantity} {item} at {price} each. What is the total cost?",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "quantity",
            "type": "value"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "price",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION"
        ],
        "modelCompatibility": [
          "DIVISION"
        ],
        "template": "{character} has {total} to spend equally on {quantity} {item}. How much can {character} spend on each one?",
        "answerTemplate": "{character} can spend {result} on each {item}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "total",
            "type": "value"
          },
          {
            "key": "quantity",
            "type": "value"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "COMPARISON",
          "ESTIMATION",
          "MULTI_STEP"
        ],
        "template": "{character} goes to the shop and buys {items}. How much does {character} spend in total?",
        "answerTemplate": "{character} spends {result} in total",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "items",
            "type": "item_list"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "ESTIMATION"
        ],
        "template": "Estimate: If {character} buys {items}, about how much will it cost?",
        "answerTemplate": "It will cost approximately {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "items",
            "type": "item_list"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "VALIDATION"
        ],
        "template": "{character} calculated that {items} costs {amount}. Is this correct?",
        "answerTemplate": "{validation_result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "items",
            "type": "item_list"
          },
          {
            "key": "amount",
            "type": "value"
          },
          {
            "key": "validation_result",
            "type": "boolean"
          }
        ]
      }
    ]
  }
}
# Test B.19: MONEY_SCALING model
{
  "success": true,
  "question": {
    "text": "Oliver goes to the shop and buys apple, banana, sandwich, drink, cake, biscuit, sweet, chocolate, pen, pencil, ruler, notebook, eraser, book, comic, magazine, toy, game, puzzle, sticker, badge, poster, card. How much does Oliver spend in total?",
    "options": [
      {
        "value": 0,
        "text": "0p",
        "isCorrect": true
      }
    ],
    "correctIndex": 0,
    "format": "DIRECT_CALCULATION",
    "difficulty": {
      "year": 4,
      "subLevel": 1,
      "displayName": "4.1",
      "cognitiveLoad": 40
    },
    "cognitiveLoad": 40,
    "curriculumTags": [
      "4N1a"
    ],
    "scenario": {
      "id": "shop-002-realistic-general",
      "theme": "SHOPPING",
      "setting": {
        "location": "local shop",
        "timeContext": "after school",
        "atmosphere": "friendly"
      },
      "characters": [
        {
          "name": "Oliver",
          "role": "student"
        }
      ],
      "items": [
        {
          "name": "apple",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.2,
            "max": 0.5,
            "typical": 0.35,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "banana",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.15,
            "max": 0.4,
            "typical": 0.25,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "sandwich",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 2.5,
            "max": 6,
            "typical": 4,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "drink",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.8,
            "max": 2.5,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "cake",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 1.5,
            "max": 4,
            "typical": 2.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "biscuit",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.8,
            "max": 2,
            "typical": 1.2,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "sweet",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.1,
            "max": 1,
            "typical": 0.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "chocolate",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.6,
            "max": 3,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "pen",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.5,
            "max": 2,
            "typical": 1,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "pencil",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.2,
            "max": 1,
            "typical": 0.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "ruler",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.8,
            "max": 2.5,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "notebook",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 1,
            "max": 4,
            "typical": 2,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "eraser",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.3,
            "max": 1.5,
            "typical": 0.75,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "book",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 3,
            "max": 15,
            "typical": 8,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "comic",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 2,
            "max": 5,
            "typical": 3,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "magazine",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 2.5,
            "max": 6,
            "typical": 4,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "toy",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 5,
            "max": 25,
            "typical": 12,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "game",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 8,
            "max": 60,
            "typical": 25,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "puzzle",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 5,
            "max": 20,
            "typical": 12,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "sticker",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 0.2,
            "max": 2,
            "typical": 0.8,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "badge",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 0.5,
            "max": 3,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "poster",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 2,
            "max": 8,
            "typical": 4,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "card",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 0.5,
            "max": 4,
            "typical": 2,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        }
      ],
      "culturalElements": [
        {
          "type": "currency",
          "value": "£",
          "explanation": "British pounds"
        },
        {
          "type": "location",
          "value": "UK local shop",
          "explanation": "Typical British corner shop"
        }
      ],
      "realWorldConnection": "Everyday shopping with realistic UK prices",
      "yearAppropriate": [
        1,
        2,
        3,
        4,
        5,
        6
      ],
      "templates": [
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "MULTI_STEP"
          ],
          "modelCompatibility": [
            "ADDITION"
          ],
          "operandCount": 3,
          "template": "{character} buys a {item1} for {price1}, a {item2} for {price2}, and a {item3} for {price3}. What is the total cost?",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item1",
              "type": "item"
            },
            {
              "key": "item2",
              "type": "item"
            },
            {
              "key": "item3",
              "type": "item"
            },
            {
              "key": "price1",
              "type": "value"
            },
            {
              "key": "price2",
              "type": "value"
            },
            {
              "key": "price3",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "MULTI_STEP"
          ],
          "modelCompatibility": [
            "ADDITION"
          ],
          "operandCount": 2,
          "template": "{character} buys a {item1} for {price1} and a {item2} for {price2}. What is the total cost?",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item1",
              "type": "item"
            },
            {
              "key": "item2",
              "type": "item"
            },
            {
              "key": "price1",
              "type": "value"
            },
            {
              "key": "price2",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION"
          ],
          "modelCompatibility": [
            "SUBTRACTION",
            "CHANGE_CALCULATION"
          ],
          "template": "{character} buys a {item} for {price} and pays with {payment}. How much change does {character} get?",
          "answerTemplate": "{character} receives {result} in change",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "price",
              "type": "value"
            },
            {
              "key": "payment",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION"
          ],
          "modelCompatibility": [
            "MULTIPLICATION"
          ],
          "template": "{character} buys {quantity} {item} at {price} each. What is the total cost?",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "quantity",
              "type": "value"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "price",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION"
          ],
          "modelCompatibility": [
            "DIVISION"
          ],
          "template": "{character} has {total} to spend equally on {quantity} {item}. How much can {character} spend on each one?",
          "answerTemplate": "{character} can spend {result} on each {item}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "total",
              "type": "value"
            },
            {
              "key": "quantity",
              "type": "value"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "COMPARISON",
            "ESTIMATION",
            "MULTI_STEP"
          ],
          "template": "{character} goes to the shop and buys {items}. How much does {character} spend in total?",
          "answerTemplate": "{character} spends {result} in total",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "items",
              "type": "item_list"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "ESTIMATION"
          ],
          "template": "Estimate: If {character} buys {items}, about how much will it cost?",
          "answerTemplate": "It will cost approximately {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "items",
              "type": "item_list"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "VALIDATION"
          ],
          "template": "{character} calculated that {items} costs {amount}. Is this correct?",
          "answerTemplate": "{validation_result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "items",
              "type": "item_list"
            },
            {
              "key": "amount",
              "type": "value"
            },
            {
              "key": "validation_result",
              "type": "boolean"
            }
          ]
        }
      ]
    },
    "distractors": [],
    "enhancementStatus": {
      "level": "partial",
      "requestedFormat": "DIRECT_CALCULATION",
      "actualFormat": "DIRECT_CALCULATION",
      "featuresActive": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "featuresPending": [],
      "isFullyEnhanced": true
    },
    "mathOutput": {
      "operation": "MONEY_SCALING",
      "base_amount": 58
    },
    "generationTime": 1,
    "questionId": "q_1759130030665_z1qwkr1zb",
    "generationSetup": {
      "controller_used": "DIRECT_CALCULATIONController",
      "format_requested": "DIRECT_CALCULATION",
      "format_actual": "DIRECT_CALCULATION",
      "scenario_theme": "SHOPPING",
      "scenario_id": "shop-002-realistic-general",
      "scenario_selection_method": "default",
      "distractor_strategies": [],
      "distractor_count": 0,
      "theme_variety": false,
      "format_variety": false,
      "enhancement_level": "partial",
      "features_active": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "features_pending": [],
      "generation_time_ms": 1
    }
  },
  "metadata": {
    "format": "DIRECT_CALCULATION",
    "cognitive_load": 40,
    "curriculum_alignment": [
      "4N1a"
    ],
    "difficulty": "4.1",
    "scenario_theme": "SHOPPING",
    "distractor_strategies": [],
    "generation_time_ms": 1,
    "api_version": "2.0",
    "enhancement_status": "partial",
    "format_requested": "DIRECT_CALCULATION",
    "format_used": "DIRECT_CALCULATION",
    "features_active": [
      "enhanced_distractors",
      "rich_scenarios",
      "cognitive_load",
      "advanced_formats"
    ],
    "features_pending": []
  },
  "context": {
    "id": "shop-002-realistic-general",
    "theme": "SHOPPING",
    "setting": {
      "location": "local shop",
      "timeContext": "after school",
      "atmosphere": "friendly"
    },
    "characters": [
      {
        "name": "Oliver",
        "role": "student"
      }
    ],
    "items": [
      {
        "name": "apple",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.2,
          "max": 0.5,
          "typical": 0.35,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "banana",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.15,
          "max": 0.4,
          "typical": 0.25,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "sandwich",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 2.5,
          "max": 6,
          "typical": 4,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "drink",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.8,
          "max": 2.5,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "cake",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 1.5,
          "max": 4,
          "typical": 2.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "biscuit",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.8,
          "max": 2,
          "typical": 1.2,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "sweet",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.1,
          "max": 1,
          "typical": 0.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "chocolate",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.6,
          "max": 3,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "pen",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.5,
          "max": 2,
          "typical": 1,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "pencil",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.2,
          "max": 1,
          "typical": 0.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "ruler",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.8,
          "max": 2.5,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "notebook",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 1,
          "max": 4,
          "typical": 2,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "eraser",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.3,
          "max": 1.5,
          "typical": 0.75,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "book",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 3,
          "max": 15,
          "typical": 8,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "comic",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 2,
          "max": 5,
          "typical": 3,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "magazine",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 2.5,
          "max": 6,
          "typical": 4,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "toy",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 5,
          "max": 25,
          "typical": 12,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "game",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 8,
          "max": 60,
          "typical": 25,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "puzzle",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 5,
          "max": 20,
          "typical": 12,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "sticker",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 0.2,
          "max": 2,
          "typical": 0.8,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "badge",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 0.5,
          "max": 3,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "poster",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 2,
          "max": 8,
          "typical": 4,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "card",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 0.5,
          "max": 4,
          "typical": 2,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      }
    ],
    "culturalElements": [
      {
        "type": "currency",
        "value": "£",
        "explanation": "British pounds"
      },
      {
        "type": "location",
        "value": "UK local shop",
        "explanation": "Typical British corner shop"
      }
    ],
    "realWorldConnection": "Everyday shopping with realistic UK prices",
    "yearAppropriate": [
      1,
      2,
      3,
      4,
      5,
      6
    ],
    "templates": [
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "MULTI_STEP"
        ],
        "modelCompatibility": [
          "ADDITION"
        ],
        "operandCount": 3,
        "template": "{character} buys a {item1} for {price1}, a {item2} for {price2}, and a {item3} for {price3}. What is the total cost?",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item1",
            "type": "item"
          },
          {
            "key": "item2",
            "type": "item"
          },
          {
            "key": "item3",
            "type": "item"
          },
          {
            "key": "price1",
            "type": "value"
          },
          {
            "key": "price2",
            "type": "value"
          },
          {
            "key": "price3",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "MULTI_STEP"
        ],
        "modelCompatibility": [
          "ADDITION"
        ],
        "operandCount": 2,
        "template": "{character} buys a {item1} for {price1} and a {item2} for {price2}. What is the total cost?",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item1",
            "type": "item"
          },
          {
            "key": "item2",
            "type": "item"
          },
          {
            "key": "price1",
            "type": "value"
          },
          {
            "key": "price2",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION"
        ],
        "modelCompatibility": [
          "SUBTRACTION",
          "CHANGE_CALCULATION"
        ],
        "template": "{character} buys a {item} for {price} and pays with {payment}. How much change does {character} get?",
        "answerTemplate": "{character} receives {result} in change",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "price",
            "type": "value"
          },
          {
            "key": "payment",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION"
        ],
        "modelCompatibility": [
          "MULTIPLICATION"
        ],
        "template": "{character} buys {quantity} {item} at {price} each. What is the total cost?",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "quantity",
            "type": "value"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "price",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION"
        ],
        "modelCompatibility": [
          "DIVISION"
        ],
        "template": "{character} has {total} to spend equally on {quantity} {item}. How much can {character} spend on each one?",
        "answerTemplate": "{character} can spend {result} on each {item}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "total",
            "type": "value"
          },
          {
            "key": "quantity",
            "type": "value"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "COMPARISON",
          "ESTIMATION",
          "MULTI_STEP"
        ],
        "template": "{character} goes to the shop and buys {items}. How much does {character} spend in total?",
        "answerTemplate": "{character} spends {result} in total",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "items",
            "type": "item_list"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "ESTIMATION"
        ],
        "template": "Estimate: If {character} buys {items}, about how much will it cost?",
        "answerTemplate": "It will cost approximately {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "items",
            "type": "item_list"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "VALIDATION"
        ],
        "template": "{character} calculated that {items} costs {amount}. Is this correct?",
        "answerTemplate": "{validation_result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "items",
            "type": "item_list"
          },
          {
            "key": "amount",
            "type": "value"
          },
          {
            "key": "validation_result",
            "type": "boolean"
          }
        ]
      }
    ]
  }
}
# Test B.20: SHAPE_RECOGNITION model
{
  "success": true,
  "question": {
    "text": "Evelyn buys a item for £5. How much does it cost?",
    "options": [
      {
        "value": 0,
        "text": "0p",
        "isCorrect": true
      }
    ],
    "correctIndex": 0,
    "format": "DIRECT_CALCULATION",
    "difficulty": {
      "year": 4,
      "subLevel": 1,
      "displayName": "4.1",
      "cognitiveLoad": 40
    },
    "cognitiveLoad": 40,
    "curriculumTags": [
      "4N1a"
    ],
    "scenario": {
      "id": "default-4-1759130030836",
      "theme": "SHOPPING",
      "setting": {
        "location": "shop",
        "timeContext": "afternoon",
        "atmosphere": "friendly"
      },
      "characters": [
        {
          "name": "Evelyn",
          "role": "student"
        }
      ],
      "items": [
        {
          "name": "item",
          "category": "HOUSEHOLD_ITEMS",
          "typicalValue": {
            "min": 1,
            "max": 10,
            "typical": 5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        }
      ],
      "culturalElements": [
        {
          "type": "currency",
          "value": "£",
          "explanation": "British pounds"
        }
      ],
      "realWorldConnection": "Basic shopping calculations",
      "yearAppropriate": [
        4
      ],
      "templates": [
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION"
          ],
          "template": "{character} buys a {item} for {price}. How much does it cost?",
          "answerTemplate": "It costs {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "price",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        }
      ]
    },
    "distractors": [],
    "enhancementStatus": {
      "level": "partial",
      "requestedFormat": "DIRECT_CALCULATION",
      "actualFormat": "DIRECT_CALCULATION",
      "featuresActive": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "featuresPending": [],
      "isFullyEnhanced": true
    },
    "mathOutput": {
      "operation": "SHAPE_RECOGNITION"
    },
    "generationTime": 1,
    "questionId": "q_1759130030837_6kydealr0",
    "generationSetup": {
      "controller_used": "DIRECT_CALCULATIONController",
      "format_requested": "DIRECT_CALCULATION",
      "format_actual": "DIRECT_CALCULATION",
      "scenario_theme": "SHOPPING",
      "scenario_id": "default-4-1759130030836",
      "scenario_selection_method": "default",
      "distractor_strategies": [],
      "distractor_count": 0,
      "theme_variety": false,
      "format_variety": false,
      "enhancement_level": "partial",
      "features_active": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "features_pending": [],
      "generation_time_ms": 1
    }
  },
  "metadata": {
    "format": "DIRECT_CALCULATION",
    "cognitive_load": 40,
    "curriculum_alignment": [
      "4N1a"
    ],
    "difficulty": "4.1",
    "scenario_theme": "SHOPPING",
    "distractor_strategies": [],
    "generation_time_ms": 1,
    "api_version": "2.0",
    "enhancement_status": "partial",
    "format_requested": "DIRECT_CALCULATION",
    "format_used": "DIRECT_CALCULATION",
    "features_active": [
      "enhanced_distractors",
      "rich_scenarios",
      "cognitive_load",
      "advanced_formats"
    ],
    "features_pending": []
  },
  "context": {
    "id": "default-4-1759130030836",
    "theme": "SHOPPING",
    "setting": {
      "location": "shop",
      "timeContext": "afternoon",
      "atmosphere": "friendly"
    },
    "characters": [
      {
        "name": "Evelyn",
        "role": "student"
      }
    ],
    "items": [
      {
        "name": "item",
        "category": "HOUSEHOLD_ITEMS",
        "typicalValue": {
          "min": 1,
          "max": 10,
          "typical": 5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      }
    ],
    "culturalElements": [
      {
        "type": "currency",
        "value": "£",
        "explanation": "British pounds"
      }
    ],
    "realWorldConnection": "Basic shopping calculations",
    "yearAppropriate": [
      4
    ],
    "templates": [
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION"
        ],
        "template": "{character} buys a {item} for {price}. How much does it cost?",
        "answerTemplate": "It costs {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "price",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      }
    ]
  }
}
# Test B.21: SHAPE_PROPERTIES model
{
  "success": true,
  "question": {
    "text": "Liam buys a item for £5. How much does it cost?",
    "options": [
      {
        "value": 0,
        "text": "0p",
        "isCorrect": true
      }
    ],
    "correctIndex": 0,
    "format": "DIRECT_CALCULATION",
    "difficulty": {
      "year": 4,
      "subLevel": 1,
      "displayName": "4.1",
      "cognitiveLoad": 40
    },
    "cognitiveLoad": 40,
    "curriculumTags": [
      "4N1a"
    ],
    "scenario": {
      "id": "default-4-1759130030882",
      "theme": "SHOPPING",
      "setting": {
        "location": "shop",
        "timeContext": "afternoon",
        "atmosphere": "friendly"
      },
      "characters": [
        {
          "name": "Liam",
          "role": "student"
        }
      ],
      "items": [
        {
          "name": "item",
          "category": "HOUSEHOLD_ITEMS",
          "typicalValue": {
            "min": 1,
            "max": 10,
            "typical": 5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        }
      ],
      "culturalElements": [
        {
          "type": "currency",
          "value": "£",
          "explanation": "British pounds"
        }
      ],
      "realWorldConnection": "Basic shopping calculations",
      "yearAppropriate": [
        4
      ],
      "templates": [
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION"
          ],
          "template": "{character} buys a {item} for {price}. How much does it cost?",
          "answerTemplate": "It costs {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "price",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        }
      ]
    },
    "distractors": [],
    "enhancementStatus": {
      "level": "partial",
      "requestedFormat": "DIRECT_CALCULATION",
      "actualFormat": "DIRECT_CALCULATION",
      "featuresActive": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "featuresPending": [],
      "isFullyEnhanced": true
    },
    "mathOutput": {
      "operation": "SHAPE_PROPERTIES"
    },
    "generationTime": 1,
    "questionId": "q_1759130030882_w574rz0lu",
    "generationSetup": {
      "controller_used": "DIRECT_CALCULATIONController",
      "format_requested": "DIRECT_CALCULATION",
      "format_actual": "DIRECT_CALCULATION",
      "scenario_theme": "SHOPPING",
      "scenario_id": "default-4-1759130030882",
      "scenario_selection_method": "default",
      "distractor_strategies": [],
      "distractor_count": 0,
      "theme_variety": false,
      "format_variety": false,
      "enhancement_level": "partial",
      "features_active": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "features_pending": [],
      "generation_time_ms": 1
    }
  },
  "metadata": {
    "format": "DIRECT_CALCULATION",
    "cognitive_load": 40,
    "curriculum_alignment": [
      "4N1a"
    ],
    "difficulty": "4.1",
    "scenario_theme": "SHOPPING",
    "distractor_strategies": [],
    "generation_time_ms": 1,
    "api_version": "2.0",
    "enhancement_status": "partial",
    "format_requested": "DIRECT_CALCULATION",
    "format_used": "DIRECT_CALCULATION",
    "features_active": [
      "enhanced_distractors",
      "rich_scenarios",
      "cognitive_load",
      "advanced_formats"
    ],
    "features_pending": []
  },
  "context": {
    "id": "default-4-1759130030882",
    "theme": "SHOPPING",
    "setting": {
      "location": "shop",
      "timeContext": "afternoon",
      "atmosphere": "friendly"
    },
    "characters": [
      {
        "name": "Liam",
        "role": "student"
      }
    ],
    "items": [
      {
        "name": "item",
        "category": "HOUSEHOLD_ITEMS",
        "typicalValue": {
          "min": 1,
          "max": 10,
          "typical": 5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      }
    ],
    "culturalElements": [
      {
        "type": "currency",
        "value": "£",
        "explanation": "British pounds"
      }
    ],
    "realWorldConnection": "Basic shopping calculations",
    "yearAppropriate": [
      4
    ],
    "templates": [
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION"
        ],
        "template": "{character} buys a {item} for {price}. How much does it cost?",
        "answerTemplate": "It costs {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "price",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      }
    ]
  }
}
# Test B.22: ANGLE_MEASUREMENT model
{
  "success": true,
  "question": {
    "text": "Olivia buys a item for £5. How much does it cost?",
    "options": [
      {
        "value": 0,
        "text": "0p",
        "isCorrect": true
      }
    ],
    "correctIndex": 0,
    "format": "DIRECT_CALCULATION",
    "difficulty": {
      "year": 4,
      "subLevel": 1,
      "displayName": "4.1",
      "cognitiveLoad": 40
    },
    "cognitiveLoad": 40,
    "curriculumTags": [
      "4N1a"
    ],
    "scenario": {
      "id": "default-4-1759130030930",
      "theme": "SHOPPING",
      "setting": {
        "location": "shop",
        "timeContext": "afternoon",
        "atmosphere": "friendly"
      },
      "characters": [
        {
          "name": "Olivia",
          "role": "student"
        }
      ],
      "items": [
        {
          "name": "item",
          "category": "HOUSEHOLD_ITEMS",
          "typicalValue": {
            "min": 1,
            "max": 10,
            "typical": 5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        }
      ],
      "culturalElements": [
        {
          "type": "currency",
          "value": "£",
          "explanation": "British pounds"
        }
      ],
      "realWorldConnection": "Basic shopping calculations",
      "yearAppropriate": [
        4
      ],
      "templates": [
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION"
          ],
          "template": "{character} buys a {item} for {price}. How much does it cost?",
          "answerTemplate": "It costs {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "price",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        }
      ]
    },
    "distractors": [],
    "enhancementStatus": {
      "level": "partial",
      "requestedFormat": "DIRECT_CALCULATION",
      "actualFormat": "DIRECT_CALCULATION",
      "featuresActive": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "featuresPending": [],
      "isFullyEnhanced": true
    },
    "mathOutput": {
      "operation": "ANGLE_MEASUREMENT",
      "angle_degrees": 90,
      "angle_type": "right"
    },
    "generationTime": 1,
    "questionId": "q_1759130030930_lu4a8tn9c",
    "generationSetup": {
      "controller_used": "DIRECT_CALCULATIONController",
      "format_requested": "DIRECT_CALCULATION",
      "format_actual": "DIRECT_CALCULATION",
      "scenario_theme": "SHOPPING",
      "scenario_id": "default-4-1759130030930",
      "scenario_selection_method": "default",
      "distractor_strategies": [],
      "distractor_count": 0,
      "theme_variety": false,
      "format_variety": false,
      "enhancement_level": "partial",
      "features_active": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "features_pending": [],
      "generation_time_ms": 1
    }
  },
  "metadata": {
    "format": "DIRECT_CALCULATION",
    "cognitive_load": 40,
    "curriculum_alignment": [
      "4N1a"
    ],
    "difficulty": "4.1",
    "scenario_theme": "SHOPPING",
    "distractor_strategies": [],
    "generation_time_ms": 1,
    "api_version": "2.0",
    "enhancement_status": "partial",
    "format_requested": "DIRECT_CALCULATION",
    "format_used": "DIRECT_CALCULATION",
    "features_active": [
      "enhanced_distractors",
      "rich_scenarios",
      "cognitive_load",
      "advanced_formats"
    ],
    "features_pending": []
  },
  "context": {
    "id": "default-4-1759130030930",
    "theme": "SHOPPING",
    "setting": {
      "location": "shop",
      "timeContext": "afternoon",
      "atmosphere": "friendly"
    },
    "characters": [
      {
        "name": "Olivia",
        "role": "student"
      }
    ],
    "items": [
      {
        "name": "item",
        "category": "HOUSEHOLD_ITEMS",
        "typicalValue": {
          "min": 1,
          "max": 10,
          "typical": 5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      }
    ],
    "culturalElements": [
      {
        "type": "currency",
        "value": "£",
        "explanation": "British pounds"
      }
    ],
    "realWorldConnection": "Basic shopping calculations",
    "yearAppropriate": [
      4
    ],
    "templates": [
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION"
        ],
        "template": "{character} buys a {item} for {price}. How much does it cost?",
        "answerTemplate": "It costs {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "price",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      }
    ]
  }
}
# Test B.23: POSITION_DIRECTION model
{
  "success": true,
  "question": {
    "text": "Michael buys a item for £5. How much does it cost?",
    "options": [
      {
        "value": 0,
        "text": "0p",
        "isCorrect": true
      }
    ],
    "correctIndex": 0,
    "format": "DIRECT_CALCULATION",
    "difficulty": {
      "year": 4,
      "subLevel": 1,
      "displayName": "4.1",
      "cognitiveLoad": 40
    },
    "cognitiveLoad": 40,
    "curriculumTags": [
      "4N1a"
    ],
    "scenario": {
      "id": "default-4-1759130031129",
      "theme": "SHOPPING",
      "setting": {
        "location": "shop",
        "timeContext": "afternoon",
        "atmosphere": "friendly"
      },
      "characters": [
        {
          "name": "Michael",
          "role": "student"
        }
      ],
      "items": [
        {
          "name": "item",
          "category": "HOUSEHOLD_ITEMS",
          "typicalValue": {
            "min": 1,
            "max": 10,
            "typical": 5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        }
      ],
      "culturalElements": [
        {
          "type": "currency",
          "value": "£",
          "explanation": "British pounds"
        }
      ],
      "realWorldConnection": "Basic shopping calculations",
      "yearAppropriate": [
        4
      ],
      "templates": [
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION"
          ],
          "template": "{character} buys a {item} for {price}. How much does it cost?",
          "answerTemplate": "It costs {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "price",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        }
      ]
    },
    "distractors": [],
    "enhancementStatus": {
      "level": "partial",
      "requestedFormat": "DIRECT_CALCULATION",
      "actualFormat": "DIRECT_CALCULATION",
      "featuresActive": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "featuresPending": [],
      "isFullyEnhanced": true
    },
    "mathOutput": {
      "operation": "POSITION_DIRECTION"
    },
    "generationTime": 1,
    "questionId": "q_1759130031130_af61wdk25",
    "generationSetup": {
      "controller_used": "DIRECT_CALCULATIONController",
      "format_requested": "DIRECT_CALCULATION",
      "format_actual": "DIRECT_CALCULATION",
      "scenario_theme": "SHOPPING",
      "scenario_id": "default-4-1759130031129",
      "scenario_selection_method": "default",
      "distractor_strategies": [],
      "distractor_count": 0,
      "theme_variety": false,
      "format_variety": false,
      "enhancement_level": "partial",
      "features_active": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "features_pending": [],
      "generation_time_ms": 1
    }
  },
  "metadata": {
    "format": "DIRECT_CALCULATION",
    "cognitive_load": 40,
    "curriculum_alignment": [
      "4N1a"
    ],
    "difficulty": "4.1",
    "scenario_theme": "SHOPPING",
    "distractor_strategies": [],
    "generation_time_ms": 1,
    "api_version": "2.0",
    "enhancement_status": "partial",
    "format_requested": "DIRECT_CALCULATION",
    "format_used": "DIRECT_CALCULATION",
    "features_active": [
      "enhanced_distractors",
      "rich_scenarios",
      "cognitive_load",
      "advanced_formats"
    ],
    "features_pending": []
  },
  "context": {
    "id": "default-4-1759130031129",
    "theme": "SHOPPING",
    "setting": {
      "location": "shop",
      "timeContext": "afternoon",
      "atmosphere": "friendly"
    },
    "characters": [
      {
        "name": "Michael",
        "role": "student"
      }
    ],
    "items": [
      {
        "name": "item",
        "category": "HOUSEHOLD_ITEMS",
        "typicalValue": {
          "min": 1,
          "max": 10,
          "typical": 5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      }
    ],
    "culturalElements": [
      {
        "type": "currency",
        "value": "£",
        "explanation": "British pounds"
      }
    ],
    "realWorldConnection": "Basic shopping calculations",
    "yearAppropriate": [
      4
    ],
    "templates": [
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION"
        ],
        "template": "{character} buys a {item} for {price}. How much does it cost?",
        "answerTemplate": "It costs {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "price",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      }
    ]
  }
}
# Test B.24: AREA_PERIMETER model
{
  "success": true,
  "question": {
    "text": "Lucas buys a item for £5. How much does it cost?",
    "options": [
      {
        "value": 0,
        "text": "0p",
        "isCorrect": true
      }
    ],
    "correctIndex": 0,
    "format": "DIRECT_CALCULATION",
    "difficulty": {
      "year": 4,
      "subLevel": 1,
      "displayName": "4.1",
      "cognitiveLoad": 40
    },
    "cognitiveLoad": 40,
    "curriculumTags": [
      "4N1a"
    ],
    "scenario": {
      "id": "default-4-1759130031282",
      "theme": "SHOPPING",
      "setting": {
        "location": "shop",
        "timeContext": "afternoon",
        "atmosphere": "friendly"
      },
      "characters": [
        {
          "name": "Lucas",
          "role": "student"
        }
      ],
      "items": [
        {
          "name": "item",
          "category": "HOUSEHOLD_ITEMS",
          "typicalValue": {
            "min": 1,
            "max": 10,
            "typical": 5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        }
      ],
      "culturalElements": [
        {
          "type": "currency",
          "value": "£",
          "explanation": "British pounds"
        }
      ],
      "realWorldConnection": "Basic shopping calculations",
      "yearAppropriate": [
        4
      ],
      "templates": [
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION"
          ],
          "template": "{character} buys a {item} for {price}. How much does it cost?",
          "answerTemplate": "It costs {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "price",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        }
      ]
    },
    "distractors": [],
    "enhancementStatus": {
      "level": "partial",
      "requestedFormat": "DIRECT_CALCULATION",
      "actualFormat": "DIRECT_CALCULATION",
      "featuresActive": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "featuresPending": [],
      "isFullyEnhanced": true
    },
    "mathOutput": {
      "operation": "AREA_PERIMETER"
    },
    "generationTime": 1,
    "questionId": "q_1759130031283_0m3n5uab1",
    "generationSetup": {
      "controller_used": "DIRECT_CALCULATIONController",
      "format_requested": "DIRECT_CALCULATION",
      "format_actual": "DIRECT_CALCULATION",
      "scenario_theme": "SHOPPING",
      "scenario_id": "default-4-1759130031282",
      "scenario_selection_method": "default",
      "distractor_strategies": [],
      "distractor_count": 0,
      "theme_variety": false,
      "format_variety": false,
      "enhancement_level": "partial",
      "features_active": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "features_pending": [],
      "generation_time_ms": 1
    }
  },
  "metadata": {
    "format": "DIRECT_CALCULATION",
    "cognitive_load": 40,
    "curriculum_alignment": [
      "4N1a"
    ],
    "difficulty": "4.1",
    "scenario_theme": "SHOPPING",
    "distractor_strategies": [],
    "generation_time_ms": 1,
    "api_version": "2.0",
    "enhancement_status": "partial",
    "format_requested": "DIRECT_CALCULATION",
    "format_used": "DIRECT_CALCULATION",
    "features_active": [
      "enhanced_distractors",
      "rich_scenarios",
      "cognitive_load",
      "advanced_formats"
    ],
    "features_pending": []
  },
  "context": {
    "id": "default-4-1759130031282",
    "theme": "SHOPPING",
    "setting": {
      "location": "shop",
      "timeContext": "afternoon",
      "atmosphere": "friendly"
    },
    "characters": [
      {
        "name": "Lucas",
        "role": "student"
      }
    ],
    "items": [
      {
        "name": "item",
        "category": "HOUSEHOLD_ITEMS",
        "typicalValue": {
          "min": 1,
          "max": 10,
          "typical": 5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      }
    ],
    "culturalElements": [
      {
        "type": "currency",
        "value": "£",
        "explanation": "British pounds"
      }
    ],
    "realWorldConnection": "Basic shopping calculations",
    "yearAppropriate": [
      4
    ],
    "templates": [
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION"
        ],
        "template": "{character} buys a {item} for {price}. How much does it cost?",
        "answerTemplate": "It costs {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "price",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      }
    ]
  }
}

--- SUITE C: FORMAT COVERAGE TESTS ---
Testing every question format using the ADDITION model...
# Test C.1: DIRECT_CALCULATION format
{
  "success": true,
  "question": {
    "text": "Sarah wants to buy books at the book fair. Calculate the total cost.",
    "options": [
      {
        "text": "320334",
        "value": 320334,
        "index": 0
      },
      {
        "text": "18.83",
        "value": 18.83,
        "index": 1
      },
      {
        "text": "£19.83",
        "value": 19.83,
        "index": 2
      },
      {
        "text": "29.83",
        "value": 29.83,
        "index": 3
      }
    ],
    "correctIndex": 2,
    "format": "DIRECT_CALCULATION",
    "difficulty": {
      "year": 5,
      "subLevel": 3,
      "displayName": "5.3",
      "cognitiveLoad": 60
    },
    "cognitiveLoad": 60,
    "curriculumTags": [
      "5N1a",
      "5N1b"
    ],
    "scenario": {
      "id": "shop-001-bookfair",
      "theme": "SHOPPING",
      "setting": {
        "location": "school book fair",
        "timeContext": "lunch break",
        "atmosphere": "busy"
      },
      "characters": [
        {
          "name": "Sarah",
          "role": "student"
        },
        {
          "name": "Mr. Johnson",
          "role": "teacher"
        }
      ],
      "items": [
        {
          "name": "book",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 3,
            "max": 12,
            "typical": 6.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "bookmark",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.5,
            "max": 2,
            "typical": 1,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        }
      ],
      "culturalElements": [
        {
          "type": "currency",
          "value": "£",
          "explanation": "British pounds"
        },
        {
          "type": "event",
          "value": "book fair",
          "explanation": "School fundraising event"
        }
      ],
      "realWorldConnection": "School fundraising and reading promotion",
      "yearAppropriate": [
        2,
        3,
        4,
        5
      ],
      "templates": [
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "COMPARISON"
          ],
          "template": "{character} wants to buy books at the book fair. Calculate the total cost.",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        }
      ]
    },
    "distractors": [
      {
        "value": 320334,
        "displayText": "320334",
        "strategy": "WRONG_OPERATION",
        "reasoning": "Multiplied instead of adding"
      },
      {
        "value": 29.83,
        "displayText": "29.83",
        "strategy": "PLACE_VALUE_ERROR",
        "reasoning": "Error in carrying to next column"
      },
      {
        "value": 18.83,
        "displayText": "18.83",
        "strategy": "PLACE_VALUE_ERROR",
        "reasoning": "Forgot to carry"
      }
    ],
    "enhancementStatus": {
      "level": "partial",
      "requestedFormat": "DIRECT_CALCULATION",
      "actualFormat": "DIRECT_CALCULATION",
      "featuresActive": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "featuresPending": [],
      "isFullyEnhanced": true
    },
    "mathOutput": {
      "operation": "ADDITION",
      "operand_1": 11.51,
      "operand_2": 0.82,
      "operand_3": 5.53,
      "operand_4": 1.97,
      "result": 19.83
    },
    "generationTime": 1,
    "questionId": "q_1759130031325_48sr8hhzi",
    "generationSetup": {
      "controller_used": "DIRECT_CALCULATIONController",
      "format_requested": "DIRECT_CALCULATION",
      "format_actual": "DIRECT_CALCULATION",
      "scenario_theme": "SHOPPING",
      "scenario_id": "shop-001-bookfair",
      "scenario_selection_method": "default",
      "distractor_strategies": [
        "WRONG_OPERATION",
        "PLACE_VALUE_ERROR",
        "PLACE_VALUE_ERROR"
      ],
      "distractor_count": 3,
      "theme_variety": false,
      "format_variety": false,
      "enhancement_level": "partial",
      "features_active": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "features_pending": [],
      "generation_time_ms": 1
    }
  },
  "metadata": {
    "format": "DIRECT_CALCULATION",
    "cognitive_load": 60,
    "curriculum_alignment": [
      "5N1a",
      "5N1b"
    ],
    "difficulty": "5.3",
    "scenario_theme": "SHOPPING",
    "distractor_strategies": [
      "WRONG_OPERATION",
      "PLACE_VALUE_ERROR",
      "PLACE_VALUE_ERROR"
    ],
    "generation_time_ms": 1,
    "api_version": "2.0",
    "enhancement_status": "partial",
    "format_requested": "DIRECT_CALCULATION",
    "format_used": "DIRECT_CALCULATION",
    "features_active": [
      "enhanced_distractors",
      "rich_scenarios",
      "cognitive_load",
      "advanced_formats"
    ],
    "features_pending": []
  },
  "context": {
    "id": "shop-001-bookfair",
    "theme": "SHOPPING",
    "setting": {
      "location": "school book fair",
      "timeContext": "lunch break",
      "atmosphere": "busy"
    },
    "characters": [
      {
        "name": "Sarah",
        "role": "student"
      },
      {
        "name": "Mr. Johnson",
        "role": "teacher"
      }
    ],
    "items": [
      {
        "name": "book",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 3,
          "max": 12,
          "typical": 6.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "bookmark",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.5,
          "max": 2,
          "typical": 1,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      }
    ],
    "culturalElements": [
      {
        "type": "currency",
        "value": "£",
        "explanation": "British pounds"
      },
      {
        "type": "event",
        "value": "book fair",
        "explanation": "School fundraising event"
      }
    ],
    "realWorldConnection": "School fundraising and reading promotion",
    "yearAppropriate": [
      2,
      3,
      4,
      5
    ],
    "templates": [
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "COMPARISON"
        ],
        "template": "{character} wants to buy books at the book fair. Calculate the total cost.",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      }
    ]
  }
}
# Test C.2: COMPARISON format
{
  "success": true,
  "question": {
    "text": "Oliver is comparing options to find the best value.\n\nOption A: A: 570 + 900 + 751 + 46 = 2267\nOption B: B: 612 + 985 + 708 = 2305\n\nWhich calculation gives the higher result?",
    "options": [
      {
        "text": "Option B is better value",
        "value": 1,
        "index": 0
      },
      {
        "text": "Both options are equally good value",
        "value": -1,
        "index": 1
      },
      {
        "text": "Option A saves you £76.00",
        "value": 0,
        "index": 2
      },
      {
        "text": "Option A is better value",
        "value": 0,
        "index": 3
      }
    ],
    "correctIndex": 2,
    "questionContent": {
      "fullText": "Oliver is comparing options to find the best value.\n\nOption A: A: 570 + 900 + 751 + 46 = 2267\nOption B: B: 612 + 985 + 708 = 2305\n\nWhich calculation gives the higher result?",
      "templateData": {
        "character": "Oliver",
        "optionA": "A: 570 + 900 + 751 + 46 = 2267",
        "optionB": "B: 612 + 985 + 708 = 2305",
        "context": "addition",
        "comparisonType": "calculated_value"
      }
    },
    "format": "COMPARISON",
    "difficulty": {
      "year": 5,
      "subLevel": 3,
      "displayName": "5.3",
      "cognitiveLoad": 60
    },
    "cognitiveLoad": 60,
    "curriculumTags": [
      "5N1a",
      "5N1b"
    ],
    "scenario": {
      "id": "shop-002-realistic-general",
      "theme": "SHOPPING",
      "setting": {
        "location": "local shop",
        "timeContext": "after school",
        "atmosphere": "friendly"
      },
      "characters": [
        {
          "name": "Oliver",
          "role": "student"
        }
      ],
      "items": [
        {
          "name": "apple",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.2,
            "max": 0.5,
            "typical": 0.35,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "banana",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.15,
            "max": 0.4,
            "typical": 0.25,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "sandwich",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 2.5,
            "max": 6,
            "typical": 4,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "drink",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.8,
            "max": 2.5,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "cake",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 1.5,
            "max": 4,
            "typical": 2.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "biscuit",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.8,
            "max": 2,
            "typical": 1.2,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "sweet",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.1,
            "max": 1,
            "typical": 0.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "chocolate",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.6,
            "max": 3,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "pen",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.5,
            "max": 2,
            "typical": 1,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "pencil",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.2,
            "max": 1,
            "typical": 0.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "ruler",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.8,
            "max": 2.5,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "notebook",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 1,
            "max": 4,
            "typical": 2,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "eraser",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.3,
            "max": 1.5,
            "typical": 0.75,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "book",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 3,
            "max": 15,
            "typical": 8,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "comic",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 2,
            "max": 5,
            "typical": 3,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "magazine",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 2.5,
            "max": 6,
            "typical": 4,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "toy",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 5,
            "max": 25,
            "typical": 12,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "game",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 8,
            "max": 60,
            "typical": 25,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "puzzle",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 5,
            "max": 20,
            "typical": 12,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "sticker",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 0.2,
            "max": 2,
            "typical": 0.8,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "badge",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 0.5,
            "max": 3,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "poster",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 2,
            "max": 8,
            "typical": 4,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "card",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 0.5,
            "max": 4,
            "typical": 2,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        }
      ],
      "culturalElements": [
        {
          "type": "currency",
          "value": "£",
          "explanation": "British pounds"
        },
        {
          "type": "location",
          "value": "UK local shop",
          "explanation": "Typical British corner shop"
        }
      ],
      "realWorldConnection": "Everyday shopping with realistic UK prices",
      "yearAppropriate": [
        1,
        2,
        3,
        4,
        5,
        6
      ],
      "templates": [
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "MULTI_STEP"
          ],
          "modelCompatibility": [
            "ADDITION"
          ],
          "operandCount": 3,
          "template": "{character} buys a {item1} for {price1}, a {item2} for {price2}, and a {item3} for {price3}. What is the total cost?",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item1",
              "type": "item"
            },
            {
              "key": "item2",
              "type": "item"
            },
            {
              "key": "item3",
              "type": "item"
            },
            {
              "key": "price1",
              "type": "value"
            },
            {
              "key": "price2",
              "type": "value"
            },
            {
              "key": "price3",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "MULTI_STEP"
          ],
          "modelCompatibility": [
            "ADDITION"
          ],
          "operandCount": 2,
          "template": "{character} buys a {item1} for {price1} and a {item2} for {price2}. What is the total cost?",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item1",
              "type": "item"
            },
            {
              "key": "item2",
              "type": "item"
            },
            {
              "key": "price1",
              "type": "value"
            },
            {
              "key": "price2",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION"
          ],
          "modelCompatibility": [
            "SUBTRACTION",
            "CHANGE_CALCULATION"
          ],
          "template": "{character} buys a {item} for {price} and pays with {payment}. How much change does {character} get?",
          "answerTemplate": "{character} receives {result} in change",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "price",
              "type": "value"
            },
            {
              "key": "payment",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION"
          ],
          "modelCompatibility": [
            "MULTIPLICATION"
          ],
          "template": "{character} buys {quantity} {item} at {price} each. What is the total cost?",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "quantity",
              "type": "value"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "price",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION"
          ],
          "modelCompatibility": [
            "DIVISION"
          ],
          "template": "{character} has {total} to spend equally on {quantity} {item}. How much can {character} spend on each one?",
          "answerTemplate": "{character} can spend {result} on each {item}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "total",
              "type": "value"
            },
            {
              "key": "quantity",
              "type": "value"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "COMPARISON",
            "ESTIMATION",
            "MULTI_STEP"
          ],
          "template": "{character} goes to the shop and buys {items}. How much does {character} spend in total?",
          "answerTemplate": "{character} spends {result} in total",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "items",
              "type": "item_list"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "ESTIMATION"
          ],
          "template": "Estimate: If {character} buys {items}, about how much will it cost?",
          "answerTemplate": "It will cost approximately {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "items",
              "type": "item_list"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "VALIDATION"
          ],
          "template": "{character} calculated that {items} costs {amount}. Is this correct?",
          "answerTemplate": "{validation_result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "items",
              "type": "item_list"
            },
            {
              "key": "amount",
              "type": "value"
            },
            {
              "key": "validation_result",
              "type": "boolean"
            }
          ]
        }
      ]
    },
    "distractors": [
      {
        "value": 1,
        "displayText": "Option B is better value",
        "strategy": "REVERSED_COMPARISON",
        "reasoning": "Selected the option with lower value"
      },
      {
        "value": -1,
        "displayText": "Both options are equally good value",
        "strategy": "WRONG_SELECTION",
        "reasoning": "Failed to calculate the difference correctly"
      },
      {
        "value": 0,
        "displayText": "Option A saves you £76.00",
        "strategy": "CALCULATION_ERROR",
        "reasoning": "Arithmetic error in calculating the difference"
      }
    ],
    "enhancementStatus": {
      "level": "full",
      "requestedFormat": "COMPARISON",
      "actualFormat": "COMPARISON",
      "featuresActive": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "featuresPending": [],
      "isFullyEnhanced": true
    },
    "mathOutput": {
      "operation": "ADDITION",
      "option_1_value": 2267,
      "option_2_value": 2305
    },
    "generationTime": 1,
    "questionId": "q_1759130031373_uo6d9mbdj",
    "generationSetup": {
      "controller_used": "COMPARISONController",
      "format_requested": "COMPARISON",
      "format_actual": "COMPARISON",
      "scenario_theme": "SHOPPING",
      "scenario_id": "shop-002-realistic-general",
      "scenario_selection_method": "default",
      "distractor_strategies": [
        "REVERSED_COMPARISON",
        "WRONG_SELECTION",
        "CALCULATION_ERROR"
      ],
      "distractor_count": 3,
      "theme_variety": false,
      "format_variety": false,
      "enhancement_level": "full",
      "features_active": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "features_pending": [],
      "generation_time_ms": 1
    }
  },
  "metadata": {
    "format": "COMPARISON",
    "cognitive_load": 60,
    "curriculum_alignment": [
      "5N1a",
      "5N1b"
    ],
    "difficulty": "5.3",
    "scenario_theme": "SHOPPING",
    "distractor_strategies": [
      "REVERSED_COMPARISON",
      "WRONG_SELECTION",
      "CALCULATION_ERROR"
    ],
    "generation_time_ms": 1,
    "api_version": "2.0",
    "enhancement_status": "full",
    "format_requested": "COMPARISON",
    "format_used": "COMPARISON",
    "features_active": [
      "enhanced_distractors",
      "rich_scenarios",
      "cognitive_load",
      "advanced_formats"
    ],
    "features_pending": []
  },
  "context": {
    "id": "shop-002-realistic-general",
    "theme": "SHOPPING",
    "setting": {
      "location": "local shop",
      "timeContext": "after school",
      "atmosphere": "friendly"
    },
    "characters": [
      {
        "name": "Oliver",
        "role": "student"
      }
    ],
    "items": [
      {
        "name": "apple",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.2,
          "max": 0.5,
          "typical": 0.35,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "banana",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.15,
          "max": 0.4,
          "typical": 0.25,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "sandwich",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 2.5,
          "max": 6,
          "typical": 4,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "drink",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.8,
          "max": 2.5,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "cake",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 1.5,
          "max": 4,
          "typical": 2.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "biscuit",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.8,
          "max": 2,
          "typical": 1.2,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "sweet",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.1,
          "max": 1,
          "typical": 0.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "chocolate",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.6,
          "max": 3,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "pen",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.5,
          "max": 2,
          "typical": 1,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "pencil",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.2,
          "max": 1,
          "typical": 0.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "ruler",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.8,
          "max": 2.5,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "notebook",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 1,
          "max": 4,
          "typical": 2,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "eraser",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.3,
          "max": 1.5,
          "typical": 0.75,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "book",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 3,
          "max": 15,
          "typical": 8,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "comic",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 2,
          "max": 5,
          "typical": 3,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "magazine",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 2.5,
          "max": 6,
          "typical": 4,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "toy",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 5,
          "max": 25,
          "typical": 12,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "game",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 8,
          "max": 60,
          "typical": 25,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "puzzle",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 5,
          "max": 20,
          "typical": 12,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "sticker",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 0.2,
          "max": 2,
          "typical": 0.8,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "badge",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 0.5,
          "max": 3,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "poster",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 2,
          "max": 8,
          "typical": 4,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "card",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 0.5,
          "max": 4,
          "typical": 2,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      }
    ],
    "culturalElements": [
      {
        "type": "currency",
        "value": "£",
        "explanation": "British pounds"
      },
      {
        "type": "location",
        "value": "UK local shop",
        "explanation": "Typical British corner shop"
      }
    ],
    "realWorldConnection": "Everyday shopping with realistic UK prices",
    "yearAppropriate": [
      1,
      2,
      3,
      4,
      5,
      6
    ],
    "templates": [
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "MULTI_STEP"
        ],
        "modelCompatibility": [
          "ADDITION"
        ],
        "operandCount": 3,
        "template": "{character} buys a {item1} for {price1}, a {item2} for {price2}, and a {item3} for {price3}. What is the total cost?",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item1",
            "type": "item"
          },
          {
            "key": "item2",
            "type": "item"
          },
          {
            "key": "item3",
            "type": "item"
          },
          {
            "key": "price1",
            "type": "value"
          },
          {
            "key": "price2",
            "type": "value"
          },
          {
            "key": "price3",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "MULTI_STEP"
        ],
        "modelCompatibility": [
          "ADDITION"
        ],
        "operandCount": 2,
        "template": "{character} buys a {item1} for {price1} and a {item2} for {price2}. What is the total cost?",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item1",
            "type": "item"
          },
          {
            "key": "item2",
            "type": "item"
          },
          {
            "key": "price1",
            "type": "value"
          },
          {
            "key": "price2",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION"
        ],
        "modelCompatibility": [
          "SUBTRACTION",
          "CHANGE_CALCULATION"
        ],
        "template": "{character} buys a {item} for {price} and pays with {payment}. How much change does {character} get?",
        "answerTemplate": "{character} receives {result} in change",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "price",
            "type": "value"
          },
          {
            "key": "payment",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION"
        ],
        "modelCompatibility": [
          "MULTIPLICATION"
        ],
        "template": "{character} buys {quantity} {item} at {price} each. What is the total cost?",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "quantity",
            "type": "value"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "price",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION"
        ],
        "modelCompatibility": [
          "DIVISION"
        ],
        "template": "{character} has {total} to spend equally on {quantity} {item}. How much can {character} spend on each one?",
        "answerTemplate": "{character} can spend {result} on each {item}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "total",
            "type": "value"
          },
          {
            "key": "quantity",
            "type": "value"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "COMPARISON",
          "ESTIMATION",
          "MULTI_STEP"
        ],
        "template": "{character} goes to the shop and buys {items}. How much does {character} spend in total?",
        "answerTemplate": "{character} spends {result} in total",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "items",
            "type": "item_list"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "ESTIMATION"
        ],
        "template": "Estimate: If {character} buys {items}, about how much will it cost?",
        "answerTemplate": "It will cost approximately {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "items",
            "type": "item_list"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "VALIDATION"
        ],
        "template": "{character} calculated that {items} costs {amount}. Is this correct?",
        "answerTemplate": "{validation_result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "items",
            "type": "item_list"
          },
          {
            "key": "amount",
            "type": "value"
          },
          {
            "key": "validation_result",
            "type": "boolean"
          }
        ]
      }
    ]
  }
}
# Test C.3: ESTIMATION format
{
  "success": true,
  "question": {
    "text": "Sarah is adding £558.00 + £875.00 + £814.00 + £217.00. Round the result to the nearest hundreds.",
    "options": [
      {
        "text": "2400",
        "value": 2400,
        "index": 0
      },
      {
        "text": "2500",
        "value": 2500,
        "index": 1
      },
      {
        "text": "£2500.00",
        "value": 2500,
        "index": 2
      },
      {
        "text": "2460",
        "value": 2460,
        "index": 3
      }
    ],
    "correctIndex": 1,
    "questionContent": {
      "fullText": "Sarah is adding £558.00 + £875.00 + £814.00 + £217.00. Round the result to the nearest hundreds.",
      "templateData": {
        "character": "Sarah",
        "operation": "is adding £558.00 + £875.00 + £814.00 + £217.00",
        "roundingPlace": "hundreds",
        "exactValue": "2464",
        "roundedValue": "2500"
      }
    },
    "format": "ESTIMATION",
    "difficulty": {
      "year": 5,
      "subLevel": 3,
      "displayName": "5.3",
      "cognitiveLoad": 60
    },
    "cognitiveLoad": 60,
    "curriculumTags": [
      "5N1a",
      "5N1b"
    ],
    "scenario": {
      "id": "shop-001-bookfair",
      "theme": "SHOPPING",
      "setting": {
        "location": "school book fair",
        "timeContext": "lunch break",
        "atmosphere": "busy"
      },
      "characters": [
        {
          "name": "Sarah",
          "role": "student"
        },
        {
          "name": "Mr. Johnson",
          "role": "teacher"
        }
      ],
      "items": [
        {
          "name": "book",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 3,
            "max": 12,
            "typical": 6.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "bookmark",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.5,
            "max": 2,
            "typical": 1,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        }
      ],
      "culturalElements": [
        {
          "type": "currency",
          "value": "£",
          "explanation": "British pounds"
        },
        {
          "type": "event",
          "value": "book fair",
          "explanation": "School fundraising event"
        }
      ],
      "realWorldConnection": "School fundraising and reading promotion",
      "yearAppropriate": [
        2,
        3,
        4,
        5
      ],
      "templates": [
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "COMPARISON"
          ],
          "template": "{character} wants to buy books at the book fair. Calculate the total cost.",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        }
      ]
    },
    "distractors": [
      {
        "value": 2460,
        "strategy": "WRONG_OPERATION",
        "rationale": "Rounded to wrong place value"
      },
      {
        "value": 2400,
        "rationale": "Truncated instead of rounded"
      },
      {
        "value": 2500,
        "rationale": "Always rounded up"
      }
    ],
    "enhancementStatus": {
      "level": "full",
      "requestedFormat": "ESTIMATION",
      "actualFormat": "ESTIMATION",
      "featuresActive": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "featuresPending": [],
      "isFullyEnhanced": true
    },
    "mathOutput": {
      "operation": "ADDITION",
      "operands": [
        558,
        875,
        814,
        217
      ],
      "result": 2464,
      "intermediate_steps": [
        558,
        1433,
        2247
      ],
      "decimal_formatted": {
        "operands": [
          "558",
          "875",
          "814",
          "217"
        ],
        "result": "2464"
      },
      "exactValue": 2464,
      "roundedValue": 2500
    },
    "generationTime": 1,
    "questionId": "q_1759130031480_cgth5t19x",
    "generationSetup": {
      "controller_used": "ESTIMATIONController",
      "format_requested": "ESTIMATION",
      "format_actual": "ESTIMATION",
      "scenario_theme": "SHOPPING",
      "scenario_id": "shop-001-bookfair",
      "scenario_selection_method": "default",
      "distractor_strategies": [
        "WRONG_OPERATION",
        null,
        null
      ],
      "distractor_count": 3,
      "theme_variety": false,
      "format_variety": false,
      "enhancement_level": "full",
      "features_active": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "features_pending": [],
      "generation_time_ms": 1
    }
  },
  "metadata": {
    "format": "ESTIMATION",
    "cognitive_load": 60,
    "curriculum_alignment": [
      "5N1a",
      "5N1b"
    ],
    "difficulty": "5.3",
    "scenario_theme": "SHOPPING",
    "distractor_strategies": [
      "WRONG_OPERATION",
      null,
      null
    ],
    "generation_time_ms": 1,
    "api_version": "2.0",
    "enhancement_status": "full",
    "format_requested": "ESTIMATION",
    "format_used": "ESTIMATION",
    "features_active": [
      "enhanced_distractors",
      "rich_scenarios",
      "cognitive_load",
      "advanced_formats"
    ],
    "features_pending": []
  },
  "context": {
    "id": "shop-001-bookfair",
    "theme": "SHOPPING",
    "setting": {
      "location": "school book fair",
      "timeContext": "lunch break",
      "atmosphere": "busy"
    },
    "characters": [
      {
        "name": "Sarah",
        "role": "student"
      },
      {
        "name": "Mr. Johnson",
        "role": "teacher"
      }
    ],
    "items": [
      {
        "name": "book",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 3,
          "max": 12,
          "typical": 6.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "bookmark",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.5,
          "max": 2,
          "typical": 1,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      }
    ],
    "culturalElements": [
      {
        "type": "currency",
        "value": "£",
        "explanation": "British pounds"
      },
      {
        "type": "event",
        "value": "book fair",
        "explanation": "School fundraising event"
      }
    ],
    "realWorldConnection": "School fundraising and reading promotion",
    "yearAppropriate": [
      2,
      3,
      4,
      5
    ],
    "templates": [
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "COMPARISON"
        ],
        "template": "{character} wants to buy books at the book fair. Calculate the total cost.",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      }
    ]
  }
}
# Test C.4: ORDERING format
{
  "success": true,
  "question": {
    "text": "Sarah is comparing prices: 594, 261, 333, 291 pence. Arrange these prices from smallest to largest.",
    "options": [
      {
        "text": "261, 291, 594, 333",
        "value": 2,
        "index": 0
      },
      {
        "text": "594, 333, 291, 261",
        "value": 1,
        "index": 1
      },
      {
        "text": "594, 261, 333, 291",
        "value": 3,
        "index": 2
      },
      {
        "text": "261, 291, 333, 594",
        "value": 0,
        "index": 3
      }
    ],
    "correctIndex": 3,
    "questionContent": {
      "fullText": "Sarah is comparing prices: 594, 261, 333, 291 pence. Arrange these prices from smallest to largest."
    },
    "format": "ORDERING",
    "difficulty": {
      "year": 5,
      "subLevel": 3,
      "displayName": "5.3",
      "cognitiveLoad": 60
    },
    "cognitiveLoad": 60,
    "curriculumTags": [
      "5N1a",
      "5N1b"
    ],
    "scenario": {
      "id": "shop-001-bookfair",
      "theme": "SHOPPING",
      "setting": {
        "location": "school book fair",
        "timeContext": "lunch break",
        "atmosphere": "busy"
      },
      "characters": [
        {
          "name": "Sarah",
          "role": "student"
        },
        {
          "name": "Mr. Johnson",
          "role": "teacher"
        }
      ],
      "items": [
        {
          "name": "book",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 3,
            "max": 12,
            "typical": 6.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "bookmark",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.5,
            "max": 2,
            "typical": 1,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        }
      ],
      "culturalElements": [
        {
          "type": "currency",
          "value": "£",
          "explanation": "British pounds"
        },
        {
          "type": "event",
          "value": "book fair",
          "explanation": "School fundraising event"
        }
      ],
      "realWorldConnection": "School fundraising and reading promotion",
      "yearAppropriate": [
        2,
        3,
        4,
        5
      ],
      "templates": [
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "COMPARISON"
          ],
          "template": "{character} wants to buy books at the book fair. Calculate the total cost.",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        }
      ]
    },
    "distractors": [
      {
        "value": 1,
        "displayText": "594, 333, 291, 261",
        "reasoning": "Ordered in opposite direction"
      },
      {
        "value": 2,
        "displayText": "261, 291, 594, 333",
        "reasoning": "Partially correct ordering"
      },
      {
        "value": 3,
        "displayText": "594, 261, 333, 291",
        "reasoning": "Original unsorted order"
      }
    ],
    "enhancementStatus": {
      "level": "full",
      "requestedFormat": "ORDERING",
      "actualFormat": "ORDERING",
      "featuresActive": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "featuresPending": [],
      "isFullyEnhanced": true
    },
    "mathOutput": {
      "operation": "ADDITION",
      "operands": [
        676,
        997,
        377,
        365
      ],
      "result": 2415,
      "intermediate_steps": [
        676,
        1673,
        2050
      ],
      "decimal_formatted": {
        "operands": [
          "676",
          "997",
          "377",
          "365"
        ],
        "result": "2415"
      }
    },
    "generationTime": 1,
    "questionId": "q_1759130031606_0zaa2trjs",
    "generationSetup": {
      "controller_used": "ORDERINGController",
      "format_requested": "ORDERING",
      "format_actual": "ORDERING",
      "scenario_theme": "SHOPPING",
      "scenario_id": "shop-001-bookfair",
      "scenario_selection_method": "default",
      "distractor_strategies": [
        null,
        null,
        null
      ],
      "distractor_count": 3,
      "theme_variety": false,
      "format_variety": false,
      "enhancement_level": "full",
      "features_active": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "features_pending": [],
      "generation_time_ms": 1
    }
  },
  "metadata": {
    "format": "ORDERING",
    "cognitive_load": 60,
    "curriculum_alignment": [
      "5N1a",
      "5N1b"
    ],
    "difficulty": "5.3",
    "scenario_theme": "SHOPPING",
    "distractor_strategies": [
      null,
      null,
      null
    ],
    "generation_time_ms": 1,
    "api_version": "2.0",
    "enhancement_status": "full",
    "format_requested": "ORDERING",
    "format_used": "ORDERING",
    "features_active": [
      "enhanced_distractors",
      "rich_scenarios",
      "cognitive_load",
      "advanced_formats"
    ],
    "features_pending": []
  },
  "context": {
    "id": "shop-001-bookfair",
    "theme": "SHOPPING",
    "setting": {
      "location": "school book fair",
      "timeContext": "lunch break",
      "atmosphere": "busy"
    },
    "characters": [
      {
        "name": "Sarah",
        "role": "student"
      },
      {
        "name": "Mr. Johnson",
        "role": "teacher"
      }
    ],
    "items": [
      {
        "name": "book",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 3,
          "max": 12,
          "typical": 6.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "bookmark",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.5,
          "max": 2,
          "typical": 1,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      }
    ],
    "culturalElements": [
      {
        "type": "currency",
        "value": "£",
        "explanation": "British pounds"
      },
      {
        "type": "event",
        "value": "book fair",
        "explanation": "School fundraising event"
      }
    ],
    "realWorldConnection": "School fundraising and reading promotion",
    "yearAppropriate": [
      2,
      3,
      4,
      5
    ],
    "templates": [
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "COMPARISON"
        ],
        "template": "{character} wants to buy books at the book fair. Calculate the total cost.",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      }
    ]
  }
}
# Test C.5: VALIDATION format
{
  "success": true,
  "question": {
    "text": "Sarah needs to solve: 827 + 355 + 176 + 368\\n\\nWhich answer is correct?\\nA) 472  B) 1723  C) 1726  D) 17260",
    "options": [
      {
        "text": "£1726.00",
        "value": 1726,
        "index": 0
      },
      {
        "text": "472",
        "value": 472,
        "index": 1
      },
      {
        "text": "1723",
        "value": 1723,
        "index": 2
      },
      {
        "text": "17260",
        "value": 17260,
        "index": 3
      }
    ],
    "correctIndex": 0,
    "questionContent": {
      "fullText": "Sarah needs to solve: 827 + 355 + 176 + 368\\n\\nWhich answer is correct?\\nA) 472  B) 1723  C) 1726  D) 17260"
    },
    "format": "VALIDATION",
    "difficulty": {
      "year": 5,
      "subLevel": 3,
      "displayName": "5.3",
      "cognitiveLoad": 60
    },
    "cognitiveLoad": 60,
    "curriculumTags": [
      "5N1a",
      "5N1b"
    ],
    "scenario": {
      "id": "shop-001-bookfair",
      "theme": "SHOPPING",
      "setting": {
        "location": "school book fair",
        "timeContext": "lunch break",
        "atmosphere": "busy"
      },
      "characters": [
        {
          "name": "Sarah",
          "role": "student"
        },
        {
          "name": "Mr. Johnson",
          "role": "teacher"
        }
      ],
      "items": [
        {
          "name": "book",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 3,
            "max": 12,
            "typical": 6.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "bookmark",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.5,
            "max": 2,
            "typical": 1,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        }
      ],
      "culturalElements": [
        {
          "type": "currency",
          "value": "£",
          "explanation": "British pounds"
        },
        {
          "type": "event",
          "value": "book fair",
          "explanation": "School fundraising event"
        }
      ],
      "realWorldConnection": "School fundraising and reading promotion",
      "yearAppropriate": [
        2,
        3,
        4,
        5
      ],
      "templates": [
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "COMPARISON"
          ],
          "template": "{character} wants to buy books at the book fair. Calculate the total cost.",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        }
      ]
    },
    "distractors": [
      {
        "value": 472,
        "strategy": "CALCULATION_ERROR",
        "rationale": "Common calculation error"
      },
      {
        "value": 1723,
        "strategy": "CALCULATION_ERROR",
        "rationale": "Common calculation error"
      },
      {
        "value": 17260,
        "strategy": "CALCULATION_ERROR",
        "rationale": "Common calculation error"
      }
    ],
    "enhancementStatus": {
      "level": "full",
      "requestedFormat": "VALIDATION",
      "actualFormat": "VALIDATION",
      "featuresActive": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "featuresPending": [],
      "isFullyEnhanced": true
    },
    "mathOutput": {
      "operation": "ADDITION",
      "operands": [
        827,
        355,
        176,
        368
      ],
      "result": 1726,
      "intermediate_steps": [
        827,
        1182,
        1358
      ],
      "decimal_formatted": {
        "operands": [
          "827",
          "355",
          "176",
          "368"
        ],
        "result": "1726"
      }
    },
    "generationTime": 1,
    "questionId": "q_1759130031647_0auidj7y1",
    "generationSetup": {
      "controller_used": "VALIDATIONController",
      "format_requested": "VALIDATION",
      "format_actual": "VALIDATION",
      "scenario_theme": "SHOPPING",
      "scenario_id": "shop-001-bookfair",
      "scenario_selection_method": "default",
      "distractor_strategies": [
        "CALCULATION_ERROR",
        "CALCULATION_ERROR",
        "CALCULATION_ERROR"
      ],
      "distractor_count": 3,
      "theme_variety": false,
      "format_variety": false,
      "enhancement_level": "full",
      "features_active": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "features_pending": [],
      "generation_time_ms": 1
    }
  },
  "metadata": {
    "format": "VALIDATION",
    "cognitive_load": 60,
    "curriculum_alignment": [
      "5N1a",
      "5N1b"
    ],
    "difficulty": "5.3",
    "scenario_theme": "SHOPPING",
    "distractor_strategies": [
      "CALCULATION_ERROR",
      "CALCULATION_ERROR",
      "CALCULATION_ERROR"
    ],
    "generation_time_ms": 1,
    "api_version": "2.0",
    "enhancement_status": "full",
    "format_requested": "VALIDATION",
    "format_used": "VALIDATION",
    "features_active": [
      "enhanced_distractors",
      "rich_scenarios",
      "cognitive_load",
      "advanced_formats"
    ],
    "features_pending": []
  },
  "context": {
    "id": "shop-001-bookfair",
    "theme": "SHOPPING",
    "setting": {
      "location": "school book fair",
      "timeContext": "lunch break",
      "atmosphere": "busy"
    },
    "characters": [
      {
        "name": "Sarah",
        "role": "student"
      },
      {
        "name": "Mr. Johnson",
        "role": "teacher"
      }
    ],
    "items": [
      {
        "name": "book",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 3,
          "max": 12,
          "typical": 6.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "bookmark",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.5,
          "max": 2,
          "typical": 1,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      }
    ],
    "culturalElements": [
      {
        "type": "currency",
        "value": "£",
        "explanation": "British pounds"
      },
      {
        "type": "event",
        "value": "book fair",
        "explanation": "School fundraising event"
      }
    ],
    "realWorldConnection": "School fundraising and reading promotion",
    "yearAppropriate": [
      2,
      3,
      4,
      5
    ],
    "templates": [
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "COMPARISON"
        ],
        "template": "{character} wants to buy books at the book fair. Calculate the total cost.",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      }
    ]
  }
}
# Test C.6: MULTI_STEP format
{
  "success": true,
  "question": {
    "text": "Oliver is shopping and needs to make several calculations. First, Oliver adds the cost of 595p and 584p items. Next, Oliver gets a 14p discount. Next, Oliver gets a 3p discount. Then Oliver adds 35p more to the total. What is the final result?",
    "options": [
      {
        "text": "1179",
        "value": 1179,
        "index": 0
      },
      {
        "text": "1197",
        "value": 1197,
        "index": 1
      },
      {
        "text": "1214",
        "value": 1214,
        "index": 2
      },
      {
        "text": "£1197.00",
        "value": 1197,
        "index": 3
      }
    ],
    "correctIndex": 1,
    "questionContent": {
      "fullText": "Oliver is shopping and needs to make several calculations. First, Oliver adds the cost of 595p and 584p items. Next, Oliver gets a 14p discount. Next, Oliver gets a 3p discount. Then Oliver adds 35p more to the total. What is the final result?",
      "components": {
        "narrative": "Oliver needs to solve this step by step:",
        "steps": [
          {
            "stepNumber": 1,
            "text": "Add 595 and 584",
            "operation": "ADDITION",
            "values": [
              595,
              584
            ],
            "result": 1179,
            "description": "Add 595 and 584"
          },
          {
            "stepNumber": 2,
            "text": "Subtract 14 from 1179",
            "operation": "SUBTRACTION",
            "values": [
              1179,
              14
            ],
            "result": 1165,
            "description": "Subtract 14 from 1179"
          },
          {
            "stepNumber": 3,
            "text": "Subtract 3 from 1165",
            "operation": "SUBTRACTION",
            "values": [
              1165,
              3
            ],
            "result": 1162,
            "description": "Subtract 3 from 1165"
          },
          {
            "stepNumber": 4,
            "text": "Add 35 to 1162",
            "operation": "ADDITION",
            "values": [
              1162,
              35
            ],
            "result": 1197,
            "description": "Add 35 to 1162"
          }
        ],
        "prompt": "What is the final result?",
        "highlightValues": [
          595,
          584,
          1179,
          1179,
          14,
          1165,
          1165,
          3,
          1162,
          1162,
          35,
          1197
        ],
        "operators": [
          "+",
          "-"
        ]
      },
      "templateData": {
        "character": "Oliver",
        "context": "local shop",
        "theme": "SHOPPING",
        "quantities": [
          595,
          1179,
          1165,
          1162
        ],
        "prices": [
          584,
          14,
          3,
          35
        ],
        "action": "calculating step by step"
      }
    },
    "format": "MULTI_STEP",
    "difficulty": {
      "year": 5,
      "subLevel": 3,
      "displayName": "5.3",
      "cognitiveLoad": 60
    },
    "cognitiveLoad": 60,
    "curriculumTags": [
      "5N1a",
      "5N1b"
    ],
    "scenario": {
      "id": "shop-002-realistic-general",
      "theme": "SHOPPING",
      "setting": {
        "location": "local shop",
        "timeContext": "after school",
        "atmosphere": "friendly"
      },
      "characters": [
        {
          "name": "Oliver",
          "role": "student"
        }
      ],
      "items": [
        {
          "name": "apple",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.2,
            "max": 0.5,
            "typical": 0.35,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "banana",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.15,
            "max": 0.4,
            "typical": 0.25,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "sandwich",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 2.5,
            "max": 6,
            "typical": 4,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "drink",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.8,
            "max": 2.5,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "cake",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 1.5,
            "max": 4,
            "typical": 2.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "biscuit",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.8,
            "max": 2,
            "typical": 1.2,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "sweet",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.1,
            "max": 1,
            "typical": 0.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "chocolate",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.6,
            "max": 3,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "pen",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.5,
            "max": 2,
            "typical": 1,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "pencil",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.2,
            "max": 1,
            "typical": 0.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "ruler",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.8,
            "max": 2.5,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "notebook",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 1,
            "max": 4,
            "typical": 2,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "eraser",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.3,
            "max": 1.5,
            "typical": 0.75,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "book",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 3,
            "max": 15,
            "typical": 8,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "comic",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 2,
            "max": 5,
            "typical": 3,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "magazine",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 2.5,
            "max": 6,
            "typical": 4,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "toy",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 5,
            "max": 25,
            "typical": 12,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "game",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 8,
            "max": 60,
            "typical": 25,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "puzzle",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 5,
            "max": 20,
            "typical": 12,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "sticker",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 0.2,
            "max": 2,
            "typical": 0.8,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "badge",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 0.5,
            "max": 3,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "poster",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 2,
            "max": 8,
            "typical": 4,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "card",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 0.5,
            "max": 4,
            "typical": 2,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        }
      ],
      "culturalElements": [
        {
          "type": "currency",
          "value": "£",
          "explanation": "British pounds"
        },
        {
          "type": "location",
          "value": "UK local shop",
          "explanation": "Typical British corner shop"
        }
      ],
      "realWorldConnection": "Everyday shopping with realistic UK prices",
      "yearAppropriate": [
        1,
        2,
        3,
        4,
        5,
        6
      ],
      "templates": [
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "MULTI_STEP"
          ],
          "modelCompatibility": [
            "ADDITION"
          ],
          "operandCount": 3,
          "template": "{character} buys a {item1} for {price1}, a {item2} for {price2}, and a {item3} for {price3}. What is the total cost?",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item1",
              "type": "item"
            },
            {
              "key": "item2",
              "type": "item"
            },
            {
              "key": "item3",
              "type": "item"
            },
            {
              "key": "price1",
              "type": "value"
            },
            {
              "key": "price2",
              "type": "value"
            },
            {
              "key": "price3",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "MULTI_STEP"
          ],
          "modelCompatibility": [
            "ADDITION"
          ],
          "operandCount": 2,
          "template": "{character} buys a {item1} for {price1} and a {item2} for {price2}. What is the total cost?",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item1",
              "type": "item"
            },
            {
              "key": "item2",
              "type": "item"
            },
            {
              "key": "price1",
              "type": "value"
            },
            {
              "key": "price2",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION"
          ],
          "modelCompatibility": [
            "SUBTRACTION",
            "CHANGE_CALCULATION"
          ],
          "template": "{character} buys a {item} for {price} and pays with {payment}. How much change does {character} get?",
          "answerTemplate": "{character} receives {result} in change",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "price",
              "type": "value"
            },
            {
              "key": "payment",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION"
          ],
          "modelCompatibility": [
            "MULTIPLICATION"
          ],
          "template": "{character} buys {quantity} {item} at {price} each. What is the total cost?",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "quantity",
              "type": "value"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "price",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION"
          ],
          "modelCompatibility": [
            "DIVISION"
          ],
          "template": "{character} has {total} to spend equally on {quantity} {item}. How much can {character} spend on each one?",
          "answerTemplate": "{character} can spend {result} on each {item}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "total",
              "type": "value"
            },
            {
              "key": "quantity",
              "type": "value"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "COMPARISON",
            "ESTIMATION",
            "MULTI_STEP"
          ],
          "template": "{character} goes to the shop and buys {items}. How much does {character} spend in total?",
          "answerTemplate": "{character} spends {result} in total",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "items",
              "type": "item_list"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "ESTIMATION"
          ],
          "template": "Estimate: If {character} buys {items}, about how much will it cost?",
          "answerTemplate": "It will cost approximately {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "items",
              "type": "item_list"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "VALIDATION"
          ],
          "template": "{character} calculated that {items} costs {amount}. Is this correct?",
          "answerTemplate": "{validation_result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "items",
              "type": "item_list"
            },
            {
              "key": "amount",
              "type": "value"
            },
            {
              "key": "validation_result",
              "type": "boolean"
            }
          ]
        }
      ]
    },
    "distractors": [
      {
        "value": 1179,
        "rationale": "Stopped after first step"
      },
      {
        "value": 1197,
        "strategy": "WRONG_OPERATION",
        "rationale": "Used wrong operation in step 1"
      },
      {
        "value": 1214,
        "rationale": "Performed operations in wrong order"
      }
    ],
    "enhancementStatus": {
      "level": "full",
      "requestedFormat": "MULTI_STEP",
      "actualFormat": "MULTI_STEP",
      "featuresActive": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "featuresPending": [],
      "isFullyEnhanced": true
    },
    "mathOutput": {
      "operation": "ADDITION",
      "operands": [
        147,
        423,
        424,
        257
      ],
      "result": 1251,
      "intermediate_steps": [
        147,
        570,
        994
      ],
      "decimal_formatted": {
        "operands": [
          "147",
          "423",
          "424",
          "257"
        ],
        "result": "1251"
      }
    },
    "generationTime": 1,
    "questionId": "q_1759130031761_8d61teoz2",
    "generationSetup": {
      "controller_used": "MULTI_STEPController",
      "format_requested": "MULTI_STEP",
      "format_actual": "MULTI_STEP",
      "scenario_theme": "SHOPPING",
      "scenario_id": "shop-002-realistic-general",
      "scenario_selection_method": "default",
      "distractor_strategies": [
        null,
        "WRONG_OPERATION",
        null
      ],
      "distractor_count": 3,
      "theme_variety": false,
      "format_variety": false,
      "enhancement_level": "full",
      "features_active": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "features_pending": [],
      "generation_time_ms": 1
    }
  },
  "metadata": {
    "format": "MULTI_STEP",
    "cognitive_load": 60,
    "curriculum_alignment": [
      "5N1a",
      "5N1b"
    ],
    "difficulty": "5.3",
    "scenario_theme": "SHOPPING",
    "distractor_strategies": [
      null,
      "WRONG_OPERATION",
      null
    ],
    "generation_time_ms": 1,
    "api_version": "2.0",
    "enhancement_status": "full",
    "format_requested": "MULTI_STEP",
    "format_used": "MULTI_STEP",
    "features_active": [
      "enhanced_distractors",
      "rich_scenarios",
      "cognitive_load",
      "advanced_formats"
    ],
    "features_pending": []
  },
  "context": {
    "id": "shop-002-realistic-general",
    "theme": "SHOPPING",
    "setting": {
      "location": "local shop",
      "timeContext": "after school",
      "atmosphere": "friendly"
    },
    "characters": [
      {
        "name": "Oliver",
        "role": "student"
      }
    ],
    "items": [
      {
        "name": "apple",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.2,
          "max": 0.5,
          "typical": 0.35,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "banana",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.15,
          "max": 0.4,
          "typical": 0.25,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "sandwich",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 2.5,
          "max": 6,
          "typical": 4,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "drink",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.8,
          "max": 2.5,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "cake",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 1.5,
          "max": 4,
          "typical": 2.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "biscuit",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.8,
          "max": 2,
          "typical": 1.2,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "sweet",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.1,
          "max": 1,
          "typical": 0.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "chocolate",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.6,
          "max": 3,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "pen",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.5,
          "max": 2,
          "typical": 1,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "pencil",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.2,
          "max": 1,
          "typical": 0.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "ruler",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.8,
          "max": 2.5,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "notebook",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 1,
          "max": 4,
          "typical": 2,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "eraser",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.3,
          "max": 1.5,
          "typical": 0.75,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "book",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 3,
          "max": 15,
          "typical": 8,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "comic",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 2,
          "max": 5,
          "typical": 3,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "magazine",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 2.5,
          "max": 6,
          "typical": 4,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "toy",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 5,
          "max": 25,
          "typical": 12,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "game",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 8,
          "max": 60,
          "typical": 25,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "puzzle",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 5,
          "max": 20,
          "typical": 12,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "sticker",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 0.2,
          "max": 2,
          "typical": 0.8,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "badge",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 0.5,
          "max": 3,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "poster",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 2,
          "max": 8,
          "typical": 4,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "card",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 0.5,
          "max": 4,
          "typical": 2,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      }
    ],
    "culturalElements": [
      {
        "type": "currency",
        "value": "£",
        "explanation": "British pounds"
      },
      {
        "type": "location",
        "value": "UK local shop",
        "explanation": "Typical British corner shop"
      }
    ],
    "realWorldConnection": "Everyday shopping with realistic UK prices",
    "yearAppropriate": [
      1,
      2,
      3,
      4,
      5,
      6
    ],
    "templates": [
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "MULTI_STEP"
        ],
        "modelCompatibility": [
          "ADDITION"
        ],
        "operandCount": 3,
        "template": "{character} buys a {item1} for {price1}, a {item2} for {price2}, and a {item3} for {price3}. What is the total cost?",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item1",
            "type": "item"
          },
          {
            "key": "item2",
            "type": "item"
          },
          {
            "key": "item3",
            "type": "item"
          },
          {
            "key": "price1",
            "type": "value"
          },
          {
            "key": "price2",
            "type": "value"
          },
          {
            "key": "price3",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "MULTI_STEP"
        ],
        "modelCompatibility": [
          "ADDITION"
        ],
        "operandCount": 2,
        "template": "{character} buys a {item1} for {price1} and a {item2} for {price2}. What is the total cost?",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item1",
            "type": "item"
          },
          {
            "key": "item2",
            "type": "item"
          },
          {
            "key": "price1",
            "type": "value"
          },
          {
            "key": "price2",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION"
        ],
        "modelCompatibility": [
          "SUBTRACTION",
          "CHANGE_CALCULATION"
        ],
        "template": "{character} buys a {item} for {price} and pays with {payment}. How much change does {character} get?",
        "answerTemplate": "{character} receives {result} in change",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "price",
            "type": "value"
          },
          {
            "key": "payment",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION"
        ],
        "modelCompatibility": [
          "MULTIPLICATION"
        ],
        "template": "{character} buys {quantity} {item} at {price} each. What is the total cost?",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "quantity",
            "type": "value"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "price",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION"
        ],
        "modelCompatibility": [
          "DIVISION"
        ],
        "template": "{character} has {total} to spend equally on {quantity} {item}. How much can {character} spend on each one?",
        "answerTemplate": "{character} can spend {result} on each {item}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "total",
            "type": "value"
          },
          {
            "key": "quantity",
            "type": "value"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "COMPARISON",
          "ESTIMATION",
          "MULTI_STEP"
        ],
        "template": "{character} goes to the shop and buys {items}. How much does {character} spend in total?",
        "answerTemplate": "{character} spends {result} in total",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "items",
            "type": "item_list"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "ESTIMATION"
        ],
        "template": "Estimate: If {character} buys {items}, about how much will it cost?",
        "answerTemplate": "It will cost approximately {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "items",
            "type": "item_list"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "VALIDATION"
        ],
        "template": "{character} calculated that {items} costs {amount}. Is this correct?",
        "answerTemplate": "{validation_result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "items",
            "type": "item_list"
          },
          {
            "key": "amount",
            "type": "value"
          },
          {
            "key": "validation_result",
            "type": "boolean"
          }
        ]
      }
    ]
  }
}
# Test C.7: MISSING_VALUE format
{
  "success": true,
  "question": {
    "text": "Oliver is working on this equation: ? + undefined = 2950. What number should replace the ? to make this equation true?",
    "options": [
      {
        "text": "902",
        "value": 902,
        "index": 0
      },
      {
        "text": "900",
        "value": 900,
        "index": 1
      },
      {
        "value": 868.8794681371975,
        "text": "£868.88",
        "isCorrect": false
      },
      {
        "text": "364",
        "value": 364,
        "index": 3
      }
    ],
    "correctIndex": 1,
    "questionContent": {
      "fullText": "Oliver is working on this equation: ? + undefined = 2950. What number should replace the ? to make this equation true?"
    },
    "format": "MISSING_VALUE",
    "difficulty": {
      "year": 5,
      "subLevel": 3,
      "displayName": "5.3",
      "cognitiveLoad": 60
    },
    "cognitiveLoad": 60,
    "curriculumTags": [
      "5N1a",
      "5N1b"
    ],
    "scenario": {
      "id": "shop-002-realistic-general",
      "theme": "SHOPPING",
      "setting": {
        "location": "local shop",
        "timeContext": "after school",
        "atmosphere": "friendly"
      },
      "characters": [
        {
          "name": "Oliver",
          "role": "student"
        }
      ],
      "items": [
        {
          "name": "apple",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.2,
            "max": 0.5,
            "typical": 0.35,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "banana",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.15,
            "max": 0.4,
            "typical": 0.25,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "sandwich",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 2.5,
            "max": 6,
            "typical": 4,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "drink",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.8,
            "max": 2.5,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "cake",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 1.5,
            "max": 4,
            "typical": 2.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "biscuit",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.8,
            "max": 2,
            "typical": 1.2,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "sweet",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.1,
            "max": 1,
            "typical": 0.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "chocolate",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.6,
            "max": 3,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "pen",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.5,
            "max": 2,
            "typical": 1,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "pencil",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.2,
            "max": 1,
            "typical": 0.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "ruler",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.8,
            "max": 2.5,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "notebook",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 1,
            "max": 4,
            "typical": 2,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "eraser",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.3,
            "max": 1.5,
            "typical": 0.75,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "book",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 3,
            "max": 15,
            "typical": 8,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "comic",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 2,
            "max": 5,
            "typical": 3,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "magazine",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 2.5,
            "max": 6,
            "typical": 4,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "toy",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 5,
            "max": 25,
            "typical": 12,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "game",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 8,
            "max": 60,
            "typical": 25,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "puzzle",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 5,
            "max": 20,
            "typical": 12,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "sticker",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 0.2,
            "max": 2,
            "typical": 0.8,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "badge",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 0.5,
            "max": 3,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "poster",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 2,
            "max": 8,
            "typical": 4,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "card",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 0.5,
            "max": 4,
            "typical": 2,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        }
      ],
      "culturalElements": [
        {
          "type": "currency",
          "value": "£",
          "explanation": "British pounds"
        },
        {
          "type": "location",
          "value": "UK local shop",
          "explanation": "Typical British corner shop"
        }
      ],
      "realWorldConnection": "Everyday shopping with realistic UK prices",
      "yearAppropriate": [
        1,
        2,
        3,
        4,
        5,
        6
      ],
      "templates": [
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "MULTI_STEP"
          ],
          "modelCompatibility": [
            "ADDITION"
          ],
          "operandCount": 3,
          "template": "{character} buys a {item1} for {price1}, a {item2} for {price2}, and a {item3} for {price3}. What is the total cost?",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item1",
              "type": "item"
            },
            {
              "key": "item2",
              "type": "item"
            },
            {
              "key": "item3",
              "type": "item"
            },
            {
              "key": "price1",
              "type": "value"
            },
            {
              "key": "price2",
              "type": "value"
            },
            {
              "key": "price3",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "MULTI_STEP"
          ],
          "modelCompatibility": [
            "ADDITION"
          ],
          "operandCount": 2,
          "template": "{character} buys a {item1} for {price1} and a {item2} for {price2}. What is the total cost?",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item1",
              "type": "item"
            },
            {
              "key": "item2",
              "type": "item"
            },
            {
              "key": "price1",
              "type": "value"
            },
            {
              "key": "price2",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION"
          ],
          "modelCompatibility": [
            "SUBTRACTION",
            "CHANGE_CALCULATION"
          ],
          "template": "{character} buys a {item} for {price} and pays with {payment}. How much change does {character} get?",
          "answerTemplate": "{character} receives {result} in change",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "price",
              "type": "value"
            },
            {
              "key": "payment",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION"
          ],
          "modelCompatibility": [
            "MULTIPLICATION"
          ],
          "template": "{character} buys {quantity} {item} at {price} each. What is the total cost?",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "quantity",
              "type": "value"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "price",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION"
          ],
          "modelCompatibility": [
            "DIVISION"
          ],
          "template": "{character} has {total} to spend equally on {quantity} {item}. How much can {character} spend on each one?",
          "answerTemplate": "{character} can spend {result} on each {item}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "total",
              "type": "value"
            },
            {
              "key": "quantity",
              "type": "value"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "COMPARISON",
            "ESTIMATION",
            "MULTI_STEP"
          ],
          "template": "{character} goes to the shop and buys {items}. How much does {character} spend in total?",
          "answerTemplate": "{character} spends {result} in total",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "items",
              "type": "item_list"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "ESTIMATION"
          ],
          "template": "Estimate: If {character} buys {items}, about how much will it cost?",
          "answerTemplate": "It will cost approximately {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "items",
              "type": "item_list"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "VALIDATION"
          ],
          "template": "{character} calculated that {items} costs {amount}. Is this correct?",
          "answerTemplate": "{validation_result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "items",
              "type": "item_list"
            },
            {
              "key": "amount",
              "type": "value"
            },
            {
              "key": "validation_result",
              "type": "boolean"
            }
          ]
        }
      ]
    },
    "distractors": [
      {
        "value": null,
        "strategy": "WRONG_OPERATION",
        "rationale": "Used wrong operation to solve"
      },
      {
        "value": 902,
        "strategy": "CALCULATION_ERROR",
        "rationale": "Arithmetic calculation error"
      },
      {
        "value": 364,
        "rationale": "Confused given value with missing value"
      }
    ],
    "enhancementStatus": {
      "level": "full",
      "requestedFormat": "MISSING_VALUE",
      "actualFormat": "MISSING_VALUE",
      "featuresActive": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "featuresPending": [],
      "isFullyEnhanced": true
    },
    "mathOutput": {
      "operation": "ADDITION",
      "operands": [
        900,
        364,
        754,
        932
      ],
      "result": 2950,
      "intermediate_steps": [
        900,
        1264,
        2018
      ],
      "decimal_formatted": {
        "operands": [
          "900",
          "364",
          "754",
          "932"
        ],
        "result": "2950"
      }
    },
    "generationTime": 0,
    "questionId": "q_1759130031807_z12hnhnih",
    "generationSetup": {
      "controller_used": "MISSING_VALUEController",
      "format_requested": "MISSING_VALUE",
      "format_actual": "MISSING_VALUE",
      "scenario_theme": "SHOPPING",
      "scenario_id": "shop-002-realistic-general",
      "scenario_selection_method": "default",
      "distractor_strategies": [
        "WRONG_OPERATION",
        "CALCULATION_ERROR",
        null
      ],
      "distractor_count": 3,
      "theme_variety": false,
      "format_variety": false,
      "enhancement_level": "full",
      "features_active": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "features_pending": [],
      "generation_time_ms": 0
    }
  },
  "metadata": {
    "format": "MISSING_VALUE",
    "cognitive_load": 60,
    "curriculum_alignment": [
      "5N1a",
      "5N1b"
    ],
    "difficulty": "5.3",
    "scenario_theme": "SHOPPING",
    "distractor_strategies": [
      "WRONG_OPERATION",
      "CALCULATION_ERROR",
      null
    ],
    "generation_time_ms": 1,
    "api_version": "2.0",
    "enhancement_status": "full",
    "format_requested": "MISSING_VALUE",
    "format_used": "MISSING_VALUE",
    "features_active": [
      "enhanced_distractors",
      "rich_scenarios",
      "cognitive_load",
      "advanced_formats"
    ],
    "features_pending": []
  },
  "context": {
    "id": "shop-002-realistic-general",
    "theme": "SHOPPING",
    "setting": {
      "location": "local shop",
      "timeContext": "after school",
      "atmosphere": "friendly"
    },
    "characters": [
      {
        "name": "Oliver",
        "role": "student"
      }
    ],
    "items": [
      {
        "name": "apple",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.2,
          "max": 0.5,
          "typical": 0.35,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "banana",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.15,
          "max": 0.4,
          "typical": 0.25,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "sandwich",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 2.5,
          "max": 6,
          "typical": 4,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "drink",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.8,
          "max": 2.5,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "cake",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 1.5,
          "max": 4,
          "typical": 2.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "biscuit",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.8,
          "max": 2,
          "typical": 1.2,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "sweet",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.1,
          "max": 1,
          "typical": 0.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "chocolate",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.6,
          "max": 3,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "pen",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.5,
          "max": 2,
          "typical": 1,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "pencil",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.2,
          "max": 1,
          "typical": 0.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "ruler",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.8,
          "max": 2.5,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "notebook",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 1,
          "max": 4,
          "typical": 2,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "eraser",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.3,
          "max": 1.5,
          "typical": 0.75,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "book",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 3,
          "max": 15,
          "typical": 8,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "comic",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 2,
          "max": 5,
          "typical": 3,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "magazine",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 2.5,
          "max": 6,
          "typical": 4,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "toy",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 5,
          "max": 25,
          "typical": 12,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "game",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 8,
          "max": 60,
          "typical": 25,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "puzzle",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 5,
          "max": 20,
          "typical": 12,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "sticker",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 0.2,
          "max": 2,
          "typical": 0.8,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "badge",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 0.5,
          "max": 3,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "poster",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 2,
          "max": 8,
          "typical": 4,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "card",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 0.5,
          "max": 4,
          "typical": 2,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      }
    ],
    "culturalElements": [
      {
        "type": "currency",
        "value": "£",
        "explanation": "British pounds"
      },
      {
        "type": "location",
        "value": "UK local shop",
        "explanation": "Typical British corner shop"
      }
    ],
    "realWorldConnection": "Everyday shopping with realistic UK prices",
    "yearAppropriate": [
      1,
      2,
      3,
      4,
      5,
      6
    ],
    "templates": [
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "MULTI_STEP"
        ],
        "modelCompatibility": [
          "ADDITION"
        ],
        "operandCount": 3,
        "template": "{character} buys a {item1} for {price1}, a {item2} for {price2}, and a {item3} for {price3}. What is the total cost?",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item1",
            "type": "item"
          },
          {
            "key": "item2",
            "type": "item"
          },
          {
            "key": "item3",
            "type": "item"
          },
          {
            "key": "price1",
            "type": "value"
          },
          {
            "key": "price2",
            "type": "value"
          },
          {
            "key": "price3",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "MULTI_STEP"
        ],
        "modelCompatibility": [
          "ADDITION"
        ],
        "operandCount": 2,
        "template": "{character} buys a {item1} for {price1} and a {item2} for {price2}. What is the total cost?",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item1",
            "type": "item"
          },
          {
            "key": "item2",
            "type": "item"
          },
          {
            "key": "price1",
            "type": "value"
          },
          {
            "key": "price2",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION"
        ],
        "modelCompatibility": [
          "SUBTRACTION",
          "CHANGE_CALCULATION"
        ],
        "template": "{character} buys a {item} for {price} and pays with {payment}. How much change does {character} get?",
        "answerTemplate": "{character} receives {result} in change",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "price",
            "type": "value"
          },
          {
            "key": "payment",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION"
        ],
        "modelCompatibility": [
          "MULTIPLICATION"
        ],
        "template": "{character} buys {quantity} {item} at {price} each. What is the total cost?",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "quantity",
            "type": "value"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "price",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION"
        ],
        "modelCompatibility": [
          "DIVISION"
        ],
        "template": "{character} has {total} to spend equally on {quantity} {item}. How much can {character} spend on each one?",
        "answerTemplate": "{character} can spend {result} on each {item}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "total",
            "type": "value"
          },
          {
            "key": "quantity",
            "type": "value"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "COMPARISON",
          "ESTIMATION",
          "MULTI_STEP"
        ],
        "template": "{character} goes to the shop and buys {items}. How much does {character} spend in total?",
        "answerTemplate": "{character} spends {result} in total",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "items",
            "type": "item_list"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "ESTIMATION"
        ],
        "template": "Estimate: If {character} buys {items}, about how much will it cost?",
        "answerTemplate": "It will cost approximately {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "items",
            "type": "item_list"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "VALIDATION"
        ],
        "template": "{character} calculated that {items} costs {amount}. Is this correct?",
        "answerTemplate": "{validation_result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "items",
            "type": "item_list"
          },
          {
            "key": "amount",
            "type": "value"
          },
          {
            "key": "validation_result",
            "type": "boolean"
          }
        ]
      }
    ]
  }
}
# Test C.8: PATTERN_RECOGNITION format
{
  "success": true,
  "question": {
    "text": "Oliver needs to find the missing number in this pattern: 14, ?, 18, 23, 30, ?, 50",
    "options": [
      {
        "value": null,
        "text": "NaNp",
        "isCorrect": true
      },
      {
        "text": "20",
        "value": 20,
        "index": 1
      },
      {
        "text": "16",
        "value": 16,
        "index": 2
      },
      {
        "text": "960",
        "value": 960,
        "index": 3
      }
    ],
    "correctIndex": 0,
    "questionContent": {
      "fullText": "Oliver needs to find the missing number in this pattern: 14, ?, 18, 23, 30, ?, 50"
    },
    "format": "PATTERN_RECOGNITION",
    "difficulty": {
      "year": 5,
      "subLevel": 3,
      "displayName": "5.3",
      "cognitiveLoad": 60
    },
    "cognitiveLoad": 60,
    "curriculumTags": [
      "5N1a",
      "5N1b"
    ],
    "scenario": {
      "id": "shop-002-realistic-general",
      "theme": "SHOPPING",
      "setting": {
        "location": "local shop",
        "timeContext": "after school",
        "atmosphere": "friendly"
      },
      "characters": [
        {
          "name": "Oliver",
          "role": "student"
        }
      ],
      "items": [
        {
          "name": "apple",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.2,
            "max": 0.5,
            "typical": 0.35,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "banana",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.15,
            "max": 0.4,
            "typical": 0.25,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "sandwich",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 2.5,
            "max": 6,
            "typical": 4,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "drink",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.8,
            "max": 2.5,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "cake",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 1.5,
            "max": 4,
            "typical": 2.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "biscuit",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.8,
            "max": 2,
            "typical": 1.2,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "sweet",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.1,
            "max": 1,
            "typical": 0.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "chocolate",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.6,
            "max": 3,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "pen",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.5,
            "max": 2,
            "typical": 1,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "pencil",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.2,
            "max": 1,
            "typical": 0.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "ruler",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.8,
            "max": 2.5,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "notebook",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 1,
            "max": 4,
            "typical": 2,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "eraser",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.3,
            "max": 1.5,
            "typical": 0.75,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "book",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 3,
            "max": 15,
            "typical": 8,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "comic",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 2,
            "max": 5,
            "typical": 3,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "magazine",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 2.5,
            "max": 6,
            "typical": 4,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "toy",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 5,
            "max": 25,
            "typical": 12,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "game",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 8,
            "max": 60,
            "typical": 25,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "puzzle",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 5,
            "max": 20,
            "typical": 12,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "sticker",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 0.2,
            "max": 2,
            "typical": 0.8,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "badge",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 0.5,
            "max": 3,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "poster",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 2,
            "max": 8,
            "typical": 4,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "card",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 0.5,
            "max": 4,
            "typical": 2,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        }
      ],
      "culturalElements": [
        {
          "type": "currency",
          "value": "£",
          "explanation": "British pounds"
        },
        {
          "type": "location",
          "value": "UK local shop",
          "explanation": "Typical British corner shop"
        }
      ],
      "realWorldConnection": "Everyday shopping with realistic UK prices",
      "yearAppropriate": [
        1,
        2,
        3,
        4,
        5,
        6
      ],
      "templates": [
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "MULTI_STEP"
          ],
          "modelCompatibility": [
            "ADDITION"
          ],
          "operandCount": 3,
          "template": "{character} buys a {item1} for {price1}, a {item2} for {price2}, and a {item3} for {price3}. What is the total cost?",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item1",
              "type": "item"
            },
            {
              "key": "item2",
              "type": "item"
            },
            {
              "key": "item3",
              "type": "item"
            },
            {
              "key": "price1",
              "type": "value"
            },
            {
              "key": "price2",
              "type": "value"
            },
            {
              "key": "price3",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "MULTI_STEP"
          ],
          "modelCompatibility": [
            "ADDITION"
          ],
          "operandCount": 2,
          "template": "{character} buys a {item1} for {price1} and a {item2} for {price2}. What is the total cost?",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item1",
              "type": "item"
            },
            {
              "key": "item2",
              "type": "item"
            },
            {
              "key": "price1",
              "type": "value"
            },
            {
              "key": "price2",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION"
          ],
          "modelCompatibility": [
            "SUBTRACTION",
            "CHANGE_CALCULATION"
          ],
          "template": "{character} buys a {item} for {price} and pays with {payment}. How much change does {character} get?",
          "answerTemplate": "{character} receives {result} in change",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "price",
              "type": "value"
            },
            {
              "key": "payment",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION"
          ],
          "modelCompatibility": [
            "MULTIPLICATION"
          ],
          "template": "{character} buys {quantity} {item} at {price} each. What is the total cost?",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "quantity",
              "type": "value"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "price",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION"
          ],
          "modelCompatibility": [
            "DIVISION"
          ],
          "template": "{character} has {total} to spend equally on {quantity} {item}. How much can {character} spend on each one?",
          "answerTemplate": "{character} can spend {result} on each {item}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "total",
              "type": "value"
            },
            {
              "key": "quantity",
              "type": "value"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "COMPARISON",
            "ESTIMATION",
            "MULTI_STEP"
          ],
          "template": "{character} goes to the shop and buys {items}. How much does {character} spend in total?",
          "answerTemplate": "{character} spends {result} in total",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "items",
              "type": "item_list"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "ESTIMATION"
          ],
          "template": "Estimate: If {character} buys {items}, about how much will it cost?",
          "answerTemplate": "It will cost approximately {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "items",
              "type": "item_list"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "VALIDATION"
          ],
          "template": "{character} calculated that {items} costs {amount}. Is this correct?",
          "answerTemplate": "{validation_result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "items",
              "type": "item_list"
            },
            {
              "key": "amount",
              "type": "value"
            },
            {
              "key": "validation_result",
              "type": "boolean"
            }
          ]
        }
      ]
    },
    "distractors": [
      {
        "value": 20,
        "strategy": "WRONG_OPERATION",
        "rationale": "Used wrong operation for pattern"
      },
      {
        "value": 960,
        "rationale": "Started pattern from wrong position"
      },
      {
        "value": 16,
        "strategy": "CALCULATION_ERROR",
        "rationale": "Off by one error"
      }
    ],
    "enhancementStatus": {
      "level": "full",
      "requestedFormat": "PATTERN_RECOGNITION",
      "actualFormat": "PATTERN_RECOGNITION",
      "featuresActive": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "featuresPending": [],
      "isFullyEnhanced": true
    },
    "mathOutput": {
      "operation": "ADDITION",
      "operands": [
        787,
        995,
        584,
        563
      ],
      "result": 2929,
      "intermediate_steps": [
        787,
        1782,
        2366
      ],
      "decimal_formatted": {
        "operands": [
          "787",
          "995",
          "584",
          "563"
        ],
        "result": "2929"
      }
    },
    "generationTime": 1,
    "questionId": "q_1759130031850_1ha9kgydo",
    "generationSetup": {
      "controller_used": "PATTERN_RECOGNITIONController",
      "format_requested": "PATTERN_RECOGNITION",
      "format_actual": "PATTERN_RECOGNITION",
      "scenario_theme": "SHOPPING",
      "scenario_id": "shop-002-realistic-general",
      "scenario_selection_method": "default",
      "distractor_strategies": [
        "WRONG_OPERATION",
        null,
        "CALCULATION_ERROR"
      ],
      "distractor_count": 3,
      "theme_variety": false,
      "format_variety": false,
      "enhancement_level": "full",
      "features_active": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "features_pending": [],
      "generation_time_ms": 1
    }
  },
  "metadata": {
    "format": "PATTERN_RECOGNITION",
    "cognitive_load": 60,
    "curriculum_alignment": [
      "5N1a",
      "5N1b"
    ],
    "difficulty": "5.3",
    "scenario_theme": "SHOPPING",
    "distractor_strategies": [
      "WRONG_OPERATION",
      null,
      "CALCULATION_ERROR"
    ],
    "generation_time_ms": 1,
    "api_version": "2.0",
    "enhancement_status": "full",
    "format_requested": "PATTERN_RECOGNITION",
    "format_used": "PATTERN_RECOGNITION",
    "features_active": [
      "enhanced_distractors",
      "rich_scenarios",
      "cognitive_load",
      "advanced_formats"
    ],
    "features_pending": []
  },
  "context": {
    "id": "shop-002-realistic-general",
    "theme": "SHOPPING",
    "setting": {
      "location": "local shop",
      "timeContext": "after school",
      "atmosphere": "friendly"
    },
    "characters": [
      {
        "name": "Oliver",
        "role": "student"
      }
    ],
    "items": [
      {
        "name": "apple",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.2,
          "max": 0.5,
          "typical": 0.35,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "banana",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.15,
          "max": 0.4,
          "typical": 0.25,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "sandwich",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 2.5,
          "max": 6,
          "typical": 4,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "drink",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.8,
          "max": 2.5,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "cake",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 1.5,
          "max": 4,
          "typical": 2.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "biscuit",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.8,
          "max": 2,
          "typical": 1.2,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "sweet",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.1,
          "max": 1,
          "typical": 0.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "chocolate",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.6,
          "max": 3,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "pen",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.5,
          "max": 2,
          "typical": 1,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "pencil",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.2,
          "max": 1,
          "typical": 0.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "ruler",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.8,
          "max": 2.5,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "notebook",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 1,
          "max": 4,
          "typical": 2,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "eraser",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.3,
          "max": 1.5,
          "typical": 0.75,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "book",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 3,
          "max": 15,
          "typical": 8,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "comic",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 2,
          "max": 5,
          "typical": 3,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "magazine",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 2.5,
          "max": 6,
          "typical": 4,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "toy",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 5,
          "max": 25,
          "typical": 12,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "game",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 8,
          "max": 60,
          "typical": 25,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "puzzle",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 5,
          "max": 20,
          "typical": 12,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "sticker",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 0.2,
          "max": 2,
          "typical": 0.8,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "badge",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 0.5,
          "max": 3,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "poster",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 2,
          "max": 8,
          "typical": 4,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "card",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 0.5,
          "max": 4,
          "typical": 2,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      }
    ],
    "culturalElements": [
      {
        "type": "currency",
        "value": "£",
        "explanation": "British pounds"
      },
      {
        "type": "location",
        "value": "UK local shop",
        "explanation": "Typical British corner shop"
      }
    ],
    "realWorldConnection": "Everyday shopping with realistic UK prices",
    "yearAppropriate": [
      1,
      2,
      3,
      4,
      5,
      6
    ],
    "templates": [
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "MULTI_STEP"
        ],
        "modelCompatibility": [
          "ADDITION"
        ],
        "operandCount": 3,
        "template": "{character} buys a {item1} for {price1}, a {item2} for {price2}, and a {item3} for {price3}. What is the total cost?",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item1",
            "type": "item"
          },
          {
            "key": "item2",
            "type": "item"
          },
          {
            "key": "item3",
            "type": "item"
          },
          {
            "key": "price1",
            "type": "value"
          },
          {
            "key": "price2",
            "type": "value"
          },
          {
            "key": "price3",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "MULTI_STEP"
        ],
        "modelCompatibility": [
          "ADDITION"
        ],
        "operandCount": 2,
        "template": "{character} buys a {item1} for {price1} and a {item2} for {price2}. What is the total cost?",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item1",
            "type": "item"
          },
          {
            "key": "item2",
            "type": "item"
          },
          {
            "key": "price1",
            "type": "value"
          },
          {
            "key": "price2",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION"
        ],
        "modelCompatibility": [
          "SUBTRACTION",
          "CHANGE_CALCULATION"
        ],
        "template": "{character} buys a {item} for {price} and pays with {payment}. How much change does {character} get?",
        "answerTemplate": "{character} receives {result} in change",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "price",
            "type": "value"
          },
          {
            "key": "payment",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION"
        ],
        "modelCompatibility": [
          "MULTIPLICATION"
        ],
        "template": "{character} buys {quantity} {item} at {price} each. What is the total cost?",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "quantity",
            "type": "value"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "price",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION"
        ],
        "modelCompatibility": [
          "DIVISION"
        ],
        "template": "{character} has {total} to spend equally on {quantity} {item}. How much can {character} spend on each one?",
        "answerTemplate": "{character} can spend {result} on each {item}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "total",
            "type": "value"
          },
          {
            "key": "quantity",
            "type": "value"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "COMPARISON",
          "ESTIMATION",
          "MULTI_STEP"
        ],
        "template": "{character} goes to the shop and buys {items}. How much does {character} spend in total?",
        "answerTemplate": "{character} spends {result} in total",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "items",
            "type": "item_list"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "ESTIMATION"
        ],
        "template": "Estimate: If {character} buys {items}, about how much will it cost?",
        "answerTemplate": "It will cost approximately {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "items",
            "type": "item_list"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "VALIDATION"
        ],
        "template": "{character} calculated that {items} costs {amount}. Is this correct?",
        "answerTemplate": "{validation_result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "items",
            "type": "item_list"
          },
          {
            "key": "amount",
            "type": "value"
          },
          {
            "key": "validation_result",
            "type": "boolean"
          }
        ]
      }
    ]
  }
}

--- SUITE D: DIFFICULTY PROGRESSION TESTS ---
Testing smooth difficulty increase for the MULTIPLICATION model...
# Test D.1: MULTIPLICATION at difficulty 2.1
{
  "success": true,
  "question": {
    "text": "Oliver buys 2 apple at 40p each. What is the total cost?",
    "options": [
      {
        "text": "7",
        "value": 7,
        "index": 0
      },
      {
        "text": "-0.19999999999999996",
        "value": -0.19999999999999996,
        "index": 1
      },
      {
        "text": "80p",
        "value": 0.8,
        "index": 2
      },
      {
        "text": "3",
        "value": 3,
        "index": 3
      }
    ],
    "correctIndex": 2,
    "format": "DIRECT_CALCULATION",
    "difficulty": {
      "year": 2,
      "subLevel": 1,
      "displayName": "2.1",
      "cognitiveLoad": 20
    },
    "cognitiveLoad": 20,
    "curriculumTags": [
      "2N1a"
    ],
    "scenario": {
      "id": "shop-002-realistic-general",
      "theme": "SHOPPING",
      "setting": {
        "location": "local shop",
        "timeContext": "after school",
        "atmosphere": "friendly"
      },
      "characters": [
        {
          "name": "Oliver",
          "role": "student"
        }
      ],
      "items": [
        {
          "name": "apple",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.2,
            "max": 0.5,
            "typical": 0.35,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "banana",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.15,
            "max": 0.4,
            "typical": 0.25,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "sandwich",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 2.5,
            "max": 6,
            "typical": 4,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "drink",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.8,
            "max": 2.5,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "cake",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 1.5,
            "max": 4,
            "typical": 2.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "biscuit",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.8,
            "max": 2,
            "typical": 1.2,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "sweet",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.1,
            "max": 1,
            "typical": 0.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "chocolate",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.6,
            "max": 3,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "pen",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.5,
            "max": 2,
            "typical": 1,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "pencil",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.2,
            "max": 1,
            "typical": 0.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "ruler",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.8,
            "max": 2.5,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "notebook",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 1,
            "max": 4,
            "typical": 2,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "eraser",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.3,
            "max": 1.5,
            "typical": 0.75,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "book",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 3,
            "max": 15,
            "typical": 8,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "comic",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 2,
            "max": 5,
            "typical": 3,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "magazine",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 2.5,
            "max": 6,
            "typical": 4,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "toy",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 5,
            "max": 25,
            "typical": 12,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "game",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 8,
            "max": 60,
            "typical": 25,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "puzzle",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 5,
            "max": 20,
            "typical": 12,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "sticker",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 0.2,
            "max": 2,
            "typical": 0.8,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "badge",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 0.5,
            "max": 3,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "poster",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 2,
            "max": 8,
            "typical": 4,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "card",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 0.5,
            "max": 4,
            "typical": 2,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        }
      ],
      "culturalElements": [
        {
          "type": "currency",
          "value": "£",
          "explanation": "British pounds"
        },
        {
          "type": "location",
          "value": "UK local shop",
          "explanation": "Typical British corner shop"
        }
      ],
      "realWorldConnection": "Everyday shopping with realistic UK prices",
      "yearAppropriate": [
        1,
        2,
        3,
        4,
        5,
        6
      ],
      "templates": [
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "MULTI_STEP"
          ],
          "modelCompatibility": [
            "ADDITION"
          ],
          "operandCount": 3,
          "template": "{character} buys a {item1} for {price1}, a {item2} for {price2}, and a {item3} for {price3}. What is the total cost?",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item1",
              "type": "item"
            },
            {
              "key": "item2",
              "type": "item"
            },
            {
              "key": "item3",
              "type": "item"
            },
            {
              "key": "price1",
              "type": "value"
            },
            {
              "key": "price2",
              "type": "value"
            },
            {
              "key": "price3",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "MULTI_STEP"
          ],
          "modelCompatibility": [
            "ADDITION"
          ],
          "operandCount": 2,
          "template": "{character} buys a {item1} for {price1} and a {item2} for {price2}. What is the total cost?",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item1",
              "type": "item"
            },
            {
              "key": "item2",
              "type": "item"
            },
            {
              "key": "price1",
              "type": "value"
            },
            {
              "key": "price2",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION"
          ],
          "modelCompatibility": [
            "SUBTRACTION",
            "CHANGE_CALCULATION"
          ],
          "template": "{character} buys a {item} for {price} and pays with {payment}. How much change does {character} get?",
          "answerTemplate": "{character} receives {result} in change",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "price",
              "type": "value"
            },
            {
              "key": "payment",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION"
          ],
          "modelCompatibility": [
            "MULTIPLICATION"
          ],
          "template": "{character} buys {quantity} {item} at {price} each. What is the total cost?",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "quantity",
              "type": "value"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "price",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION"
          ],
          "modelCompatibility": [
            "DIVISION"
          ],
          "template": "{character} has {total} to spend equally on {quantity} {item}. How much can {character} spend on each one?",
          "answerTemplate": "{character} can spend {result} on each {item}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "total",
              "type": "value"
            },
            {
              "key": "quantity",
              "type": "value"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "COMPARISON",
            "ESTIMATION",
            "MULTI_STEP"
          ],
          "template": "{character} goes to the shop and buys {items}. How much does {character} spend in total?",
          "answerTemplate": "{character} spends {result} in total",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "items",
              "type": "item_list"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "ESTIMATION"
          ],
          "template": "Estimate: If {character} buys {items}, about how much will it cost?",
          "answerTemplate": "It will cost approximately {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "items",
              "type": "item_list"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "VALIDATION"
          ],
          "template": "{character} calculated that {items} costs {amount}. Is this correct?",
          "answerTemplate": "{validation_result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "items",
              "type": "item_list"
            },
            {
              "key": "amount",
              "type": "value"
            },
            {
              "key": "validation_result",
              "type": "boolean"
            }
          ]
        }
      ]
    },
    "distractors": [
      {
        "value": -0.19999999999999996,
        "displayText": "-0.19999999999999996",
        "strategy": "COMMON_MISCONCEPTION",
        "reasoning": "Counting error"
      },
      {
        "value": 7,
        "displayText": "7",
        "strategy": "WRONG_OPERATION",
        "reasoning": "Added instead of multiplying"
      },
      {
        "value": 3,
        "displayText": "3",
        "strategy": "WRONG_OPERATION",
        "reasoning": "Subtracted instead of multiplying"
      }
    ],
    "enhancementStatus": {
      "level": "partial",
      "requestedFormat": "DIRECT_CALCULATION",
      "actualFormat": "DIRECT_CALCULATION",
      "featuresActive": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "featuresPending": [],
      "isFullyEnhanced": true
    },
    "mathOutput": {
      "operation": "MULTIPLICATION",
      "multiplier": 2,
      "multiplicand": 0.4,
      "result": 0.8
    },
    "generationTime": 0,
    "questionId": "q_1759130031976_oitbr0lwa",
    "generationSetup": {
      "controller_used": "DIRECT_CALCULATIONController",
      "format_requested": "DIRECT_CALCULATION",
      "format_actual": "DIRECT_CALCULATION",
      "scenario_theme": "SHOPPING",
      "scenario_id": "shop-002-realistic-general",
      "scenario_selection_method": "default",
      "distractor_strategies": [
        "COMMON_MISCONCEPTION",
        "WRONG_OPERATION",
        "WRONG_OPERATION"
      ],
      "distractor_count": 3,
      "theme_variety": false,
      "format_variety": false,
      "enhancement_level": "partial",
      "features_active": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "features_pending": [],
      "generation_time_ms": 0
    }
  },
  "metadata": {
    "format": "DIRECT_CALCULATION",
    "cognitive_load": 20,
    "curriculum_alignment": [
      "2N1a"
    ],
    "difficulty": "2.1",
    "scenario_theme": "SHOPPING",
    "distractor_strategies": [
      "COMMON_MISCONCEPTION",
      "WRONG_OPERATION",
      "WRONG_OPERATION"
    ],
    "generation_time_ms": 0,
    "api_version": "2.0",
    "enhancement_status": "partial",
    "format_requested": "DIRECT_CALCULATION",
    "format_used": "DIRECT_CALCULATION",
    "features_active": [
      "enhanced_distractors",
      "rich_scenarios",
      "cognitive_load",
      "advanced_formats"
    ],
    "features_pending": []
  },
  "context": {
    "id": "shop-002-realistic-general",
    "theme": "SHOPPING",
    "setting": {
      "location": "local shop",
      "timeContext": "after school",
      "atmosphere": "friendly"
    },
    "characters": [
      {
        "name": "Oliver",
        "role": "student"
      }
    ],
    "items": [
      {
        "name": "apple",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.2,
          "max": 0.5,
          "typical": 0.35,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "banana",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.15,
          "max": 0.4,
          "typical": 0.25,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "sandwich",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 2.5,
          "max": 6,
          "typical": 4,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "drink",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.8,
          "max": 2.5,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "cake",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 1.5,
          "max": 4,
          "typical": 2.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "biscuit",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.8,
          "max": 2,
          "typical": 1.2,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "sweet",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.1,
          "max": 1,
          "typical": 0.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "chocolate",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.6,
          "max": 3,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "pen",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.5,
          "max": 2,
          "typical": 1,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "pencil",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.2,
          "max": 1,
          "typical": 0.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "ruler",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.8,
          "max": 2.5,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "notebook",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 1,
          "max": 4,
          "typical": 2,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "eraser",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.3,
          "max": 1.5,
          "typical": 0.75,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "book",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 3,
          "max": 15,
          "typical": 8,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "comic",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 2,
          "max": 5,
          "typical": 3,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "magazine",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 2.5,
          "max": 6,
          "typical": 4,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "toy",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 5,
          "max": 25,
          "typical": 12,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "game",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 8,
          "max": 60,
          "typical": 25,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "puzzle",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 5,
          "max": 20,
          "typical": 12,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "sticker",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 0.2,
          "max": 2,
          "typical": 0.8,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "badge",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 0.5,
          "max": 3,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "poster",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 2,
          "max": 8,
          "typical": 4,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "card",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 0.5,
          "max": 4,
          "typical": 2,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      }
    ],
    "culturalElements": [
      {
        "type": "currency",
        "value": "£",
        "explanation": "British pounds"
      },
      {
        "type": "location",
        "value": "UK local shop",
        "explanation": "Typical British corner shop"
      }
    ],
    "realWorldConnection": "Everyday shopping with realistic UK prices",
    "yearAppropriate": [
      1,
      2,
      3,
      4,
      5,
      6
    ],
    "templates": [
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "MULTI_STEP"
        ],
        "modelCompatibility": [
          "ADDITION"
        ],
        "operandCount": 3,
        "template": "{character} buys a {item1} for {price1}, a {item2} for {price2}, and a {item3} for {price3}. What is the total cost?",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item1",
            "type": "item"
          },
          {
            "key": "item2",
            "type": "item"
          },
          {
            "key": "item3",
            "type": "item"
          },
          {
            "key": "price1",
            "type": "value"
          },
          {
            "key": "price2",
            "type": "value"
          },
          {
            "key": "price3",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "MULTI_STEP"
        ],
        "modelCompatibility": [
          "ADDITION"
        ],
        "operandCount": 2,
        "template": "{character} buys a {item1} for {price1} and a {item2} for {price2}. What is the total cost?",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item1",
            "type": "item"
          },
          {
            "key": "item2",
            "type": "item"
          },
          {
            "key": "price1",
            "type": "value"
          },
          {
            "key": "price2",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION"
        ],
        "modelCompatibility": [
          "SUBTRACTION",
          "CHANGE_CALCULATION"
        ],
        "template": "{character} buys a {item} for {price} and pays with {payment}. How much change does {character} get?",
        "answerTemplate": "{character} receives {result} in change",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "price",
            "type": "value"
          },
          {
            "key": "payment",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION"
        ],
        "modelCompatibility": [
          "MULTIPLICATION"
        ],
        "template": "{character} buys {quantity} {item} at {price} each. What is the total cost?",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "quantity",
            "type": "value"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "price",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION"
        ],
        "modelCompatibility": [
          "DIVISION"
        ],
        "template": "{character} has {total} to spend equally on {quantity} {item}. How much can {character} spend on each one?",
        "answerTemplate": "{character} can spend {result} on each {item}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "total",
            "type": "value"
          },
          {
            "key": "quantity",
            "type": "value"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "COMPARISON",
          "ESTIMATION",
          "MULTI_STEP"
        ],
        "template": "{character} goes to the shop and buys {items}. How much does {character} spend in total?",
        "answerTemplate": "{character} spends {result} in total",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "items",
            "type": "item_list"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "ESTIMATION"
        ],
        "template": "Estimate: If {character} buys {items}, about how much will it cost?",
        "answerTemplate": "It will cost approximately {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "items",
            "type": "item_list"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "VALIDATION"
        ],
        "template": "{character} calculated that {items} costs {amount}. Is this correct?",
        "answerTemplate": "{validation_result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "items",
            "type": "item_list"
          },
          {
            "key": "amount",
            "type": "value"
          },
          {
            "key": "validation_result",
            "type": "boolean"
          }
        ]
      }
    ]
  }
}
# Test D.2: MULTIPLICATION at difficulty 2.4
{
  "success": true,
  "question": {
    "text": "Sarah wants to buy books at the book fair. Calculate the total cost.",
    "options": [
      {
        "text": "6",
        "value": 6,
        "index": 0
      },
      {
        "text": "9.98",
        "value": 9.98,
        "index": 1
      },
      {
        "text": "7.98",
        "value": 7.98,
        "index": 2
      },
      {
        "text": "£8.98",
        "value": 8.98,
        "index": 3
      }
    ],
    "correctIndex": 3,
    "format": "DIRECT_CALCULATION",
    "difficulty": {
      "year": 2,
      "subLevel": 4,
      "displayName": "2.4",
      "cognitiveLoad": 35
    },
    "cognitiveLoad": 35,
    "curriculumTags": [
      "2N1a"
    ],
    "scenario": {
      "id": "shop-001-bookfair",
      "theme": "SHOPPING",
      "setting": {
        "location": "school book fair",
        "timeContext": "lunch break",
        "atmosphere": "busy"
      },
      "characters": [
        {
          "name": "Sarah",
          "role": "student"
        },
        {
          "name": "Mr. Johnson",
          "role": "teacher"
        }
      ],
      "items": [
        {
          "name": "book",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 3,
            "max": 12,
            "typical": 6.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "bookmark",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.5,
            "max": 2,
            "typical": 1,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        }
      ],
      "culturalElements": [
        {
          "type": "currency",
          "value": "£",
          "explanation": "British pounds"
        },
        {
          "type": "event",
          "value": "book fair",
          "explanation": "School fundraising event"
        }
      ],
      "realWorldConnection": "School fundraising and reading promotion",
      "yearAppropriate": [
        2,
        3,
        4,
        5
      ],
      "templates": [
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "COMPARISON"
          ],
          "template": "{character} wants to buy books at the book fair. Calculate the total cost.",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        }
      ]
    },
    "distractors": [
      {
        "value": 7.98,
        "displayText": "7.98",
        "strategy": "COMMON_MISCONCEPTION",
        "reasoning": "Counting error"
      },
      {
        "value": 6,
        "displayText": "6",
        "strategy": "WRONG_OPERATION",
        "reasoning": "Subtracted instead of multiplying"
      },
      {
        "value": 9.98,
        "displayText": "9.98",
        "strategy": "CLOSE_VALUE",
        "reasoning": "Off by 1"
      }
    ],
    "enhancementStatus": {
      "level": "partial",
      "requestedFormat": "DIRECT_CALCULATION",
      "actualFormat": "DIRECT_CALCULATION",
      "featuresActive": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "featuresPending": [],
      "isFullyEnhanced": true
    },
    "mathOutput": {
      "operation": "MULTIPLICATION",
      "multiplier": 1,
      "multiplicand": 8.98,
      "result": 8.98
    },
    "generationTime": 1,
    "questionId": "q_1759130032103_tysvem949",
    "generationSetup": {
      "controller_used": "DIRECT_CALCULATIONController",
      "format_requested": "DIRECT_CALCULATION",
      "format_actual": "DIRECT_CALCULATION",
      "scenario_theme": "SHOPPING",
      "scenario_id": "shop-001-bookfair",
      "scenario_selection_method": "default",
      "distractor_strategies": [
        "COMMON_MISCONCEPTION",
        "WRONG_OPERATION",
        "CLOSE_VALUE"
      ],
      "distractor_count": 3,
      "theme_variety": false,
      "format_variety": false,
      "enhancement_level": "partial",
      "features_active": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "features_pending": [],
      "generation_time_ms": 1
    }
  },
  "metadata": {
    "format": "DIRECT_CALCULATION",
    "cognitive_load": 35,
    "curriculum_alignment": [
      "2N1a"
    ],
    "difficulty": "2.4",
    "scenario_theme": "SHOPPING",
    "distractor_strategies": [
      "COMMON_MISCONCEPTION",
      "WRONG_OPERATION",
      "CLOSE_VALUE"
    ],
    "generation_time_ms": 1,
    "api_version": "2.0",
    "enhancement_status": "partial",
    "format_requested": "DIRECT_CALCULATION",
    "format_used": "DIRECT_CALCULATION",
    "features_active": [
      "enhanced_distractors",
      "rich_scenarios",
      "cognitive_load",
      "advanced_formats"
    ],
    "features_pending": []
  },
  "context": {
    "id": "shop-001-bookfair",
    "theme": "SHOPPING",
    "setting": {
      "location": "school book fair",
      "timeContext": "lunch break",
      "atmosphere": "busy"
    },
    "characters": [
      {
        "name": "Sarah",
        "role": "student"
      },
      {
        "name": "Mr. Johnson",
        "role": "teacher"
      }
    ],
    "items": [
      {
        "name": "book",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 3,
          "max": 12,
          "typical": 6.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "bookmark",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.5,
          "max": 2,
          "typical": 1,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      }
    ],
    "culturalElements": [
      {
        "type": "currency",
        "value": "£",
        "explanation": "British pounds"
      },
      {
        "type": "event",
        "value": "book fair",
        "explanation": "School fundraising event"
      }
    ],
    "realWorldConnection": "School fundraising and reading promotion",
    "yearAppropriate": [
      2,
      3,
      4,
      5
    ],
    "templates": [
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "COMPARISON"
        ],
        "template": "{character} wants to buy books at the book fair. Calculate the total cost.",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      }
    ]
  }
}
# Test D.3: MULTIPLICATION at difficulty 3.2
{
  "success": true,
  "question": {
    "text": "Sarah is multiplying £7.00 × 6. What is a reasonable estimate?",
    "options": [
      {
        "text": "24",
        "value": 24,
        "index": 0
      },
      {
        "text": "60",
        "value": 60,
        "index": 1
      },
      {
        "text": "£40.00",
        "value": 40,
        "index": 2
      },
      {
        "text": "42",
        "value": 42,
        "index": 3
      }
    ],
    "correctIndex": 2,
    "questionContent": {
      "fullText": "Sarah is multiplying £7.00 × 6. What is a reasonable estimate?",
      "templateData": {
        "character": "Sarah",
        "operation": "is multiplying £7.00 × 6",
        "exactValue": "42",
        "estimatedValue": "40"
      }
    },
    "format": "ESTIMATION",
    "difficulty": {
      "year": 3,
      "subLevel": 2,
      "displayName": "3.2",
      "cognitiveLoad": 35
    },
    "cognitiveLoad": 35,
    "curriculumTags": [
      "3N1a"
    ],
    "scenario": {
      "id": "shop-001-bookfair",
      "theme": "SHOPPING",
      "setting": {
        "location": "school book fair",
        "timeContext": "lunch break",
        "atmosphere": "busy"
      },
      "characters": [
        {
          "name": "Sarah",
          "role": "student"
        },
        {
          "name": "Mr. Johnson",
          "role": "teacher"
        }
      ],
      "items": [
        {
          "name": "book",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 3,
            "max": 12,
            "typical": 6.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "bookmark",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.5,
            "max": 2,
            "typical": 1,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        }
      ],
      "culturalElements": [
        {
          "type": "currency",
          "value": "£",
          "explanation": "British pounds"
        },
        {
          "type": "event",
          "value": "book fair",
          "explanation": "School fundraising event"
        }
      ],
      "realWorldConnection": "School fundraising and reading promotion",
      "yearAppropriate": [
        2,
        3,
        4,
        5
      ],
      "templates": [
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "COMPARISON"
          ],
          "template": "{character} wants to buy books at the book fair. Calculate the total cost.",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        }
      ]
    },
    "distractors": [
      {
        "value": 42,
        "strategy": "WRONG_OPERATION",
        "rationale": "Used exact calculation instead of estimation"
      },
      {
        "value": 60,
        "rationale": "Overestimated significantly"
      },
      {
        "value": 24,
        "rationale": "Underestimated significantly"
      }
    ],
    "enhancementStatus": {
      "level": "full",
      "requestedFormat": "ESTIMATION",
      "actualFormat": "ESTIMATION",
      "featuresActive": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "featuresPending": [],
      "isFullyEnhanced": true
    },
    "mathOutput": {
      "operation": "MULTIPLICATION",
      "multiplicand": 7,
      "multiplier": 6,
      "result": 42,
      "factors": [
        7,
        6
      ],
      "decimal_formatted": {
        "operands": [
          "7",
          "6"
        ],
        "result": "42"
      },
      "exactValue": 42,
      "estimatedValue": 40
    },
    "generationTime": 1,
    "questionId": "q_1759130032148_km1pn8rpf",
    "generationSetup": {
      "controller_used": "ESTIMATIONController",
      "format_requested": "ESTIMATION",
      "format_actual": "ESTIMATION",
      "scenario_theme": "SHOPPING",
      "scenario_id": "shop-001-bookfair",
      "scenario_selection_method": "default",
      "distractor_strategies": [
        "WRONG_OPERATION",
        null,
        null
      ],
      "distractor_count": 3,
      "theme_variety": false,
      "format_variety": false,
      "enhancement_level": "full",
      "features_active": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "features_pending": [],
      "generation_time_ms": 1
    }
  },
  "metadata": {
    "format": "ESTIMATION",
    "cognitive_load": 35,
    "curriculum_alignment": [
      "3N1a"
    ],
    "difficulty": "3.2",
    "scenario_theme": "SHOPPING",
    "distractor_strategies": [
      "WRONG_OPERATION",
      null,
      null
    ],
    "generation_time_ms": 1,
    "api_version": "2.0",
    "enhancement_status": "full",
    "format_requested": "ESTIMATION",
    "format_used": "ESTIMATION",
    "features_active": [
      "enhanced_distractors",
      "rich_scenarios",
      "cognitive_load",
      "advanced_formats"
    ],
    "features_pending": []
  },
  "context": {
    "id": "shop-001-bookfair",
    "theme": "SHOPPING",
    "setting": {
      "location": "school book fair",
      "timeContext": "lunch break",
      "atmosphere": "busy"
    },
    "characters": [
      {
        "name": "Sarah",
        "role": "student"
      },
      {
        "name": "Mr. Johnson",
        "role": "teacher"
      }
    ],
    "items": [
      {
        "name": "book",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 3,
          "max": 12,
          "typical": 6.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "bookmark",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.5,
          "max": 2,
          "typical": 1,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      }
    ],
    "culturalElements": [
      {
        "type": "currency",
        "value": "£",
        "explanation": "British pounds"
      },
      {
        "type": "event",
        "value": "book fair",
        "explanation": "School fundraising event"
      }
    ],
    "realWorldConnection": "School fundraising and reading promotion",
    "yearAppropriate": [
      2,
      3,
      4,
      5
    ],
    "templates": [
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "COMPARISON"
        ],
        "template": "{character} wants to buy books at the book fair. Calculate the total cost.",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      }
    ]
  }
}
# Test D.4: MULTIPLICATION at difficulty 4.1
{
  "success": true,
  "question": {
    "text": "Oliver buys 2 apple at 43p each. What is the total cost?",
    "options": [
      {
        "text": "5",
        "value": 5,
        "index": 0
      },
      {
        "text": "2.86",
        "value": 2.86,
        "index": 1
      },
      {
        "text": "9",
        "value": 9,
        "index": 2
      },
      {
        "text": "86p",
        "value": 0.86,
        "index": 3
      }
    ],
    "correctIndex": 3,
    "format": "DIRECT_CALCULATION",
    "difficulty": {
      "year": 4,
      "subLevel": 1,
      "displayName": "4.1",
      "cognitiveLoad": 40
    },
    "cognitiveLoad": 40,
    "curriculumTags": [
      "4N1a"
    ],
    "scenario": {
      "id": "shop-002-realistic-general",
      "theme": "SHOPPING",
      "setting": {
        "location": "local shop",
        "timeContext": "after school",
        "atmosphere": "friendly"
      },
      "characters": [
        {
          "name": "Oliver",
          "role": "student"
        }
      ],
      "items": [
        {
          "name": "apple",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.2,
            "max": 0.5,
            "typical": 0.35,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "banana",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.15,
            "max": 0.4,
            "typical": 0.25,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "sandwich",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 2.5,
            "max": 6,
            "typical": 4,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "drink",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.8,
            "max": 2.5,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "cake",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 1.5,
            "max": 4,
            "typical": 2.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "biscuit",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.8,
            "max": 2,
            "typical": 1.2,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "sweet",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.1,
            "max": 1,
            "typical": 0.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "chocolate",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.6,
            "max": 3,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "pen",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.5,
            "max": 2,
            "typical": 1,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "pencil",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.2,
            "max": 1,
            "typical": 0.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "ruler",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.8,
            "max": 2.5,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "notebook",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 1,
            "max": 4,
            "typical": 2,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "eraser",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.3,
            "max": 1.5,
            "typical": 0.75,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "book",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 3,
            "max": 15,
            "typical": 8,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "comic",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 2,
            "max": 5,
            "typical": 3,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "magazine",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 2.5,
            "max": 6,
            "typical": 4,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "toy",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 5,
            "max": 25,
            "typical": 12,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "game",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 8,
            "max": 60,
            "typical": 25,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "puzzle",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 5,
            "max": 20,
            "typical": 12,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "sticker",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 0.2,
            "max": 2,
            "typical": 0.8,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "badge",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 0.5,
            "max": 3,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "poster",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 2,
            "max": 8,
            "typical": 4,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "card",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 0.5,
            "max": 4,
            "typical": 2,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        }
      ],
      "culturalElements": [
        {
          "type": "currency",
          "value": "£",
          "explanation": "British pounds"
        },
        {
          "type": "location",
          "value": "UK local shop",
          "explanation": "Typical British corner shop"
        }
      ],
      "realWorldConnection": "Everyday shopping with realistic UK prices",
      "yearAppropriate": [
        1,
        2,
        3,
        4,
        5,
        6
      ],
      "templates": [
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "MULTI_STEP"
          ],
          "modelCompatibility": [
            "ADDITION"
          ],
          "operandCount": 3,
          "template": "{character} buys a {item1} for {price1}, a {item2} for {price2}, and a {item3} for {price3}. What is the total cost?",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item1",
              "type": "item"
            },
            {
              "key": "item2",
              "type": "item"
            },
            {
              "key": "item3",
              "type": "item"
            },
            {
              "key": "price1",
              "type": "value"
            },
            {
              "key": "price2",
              "type": "value"
            },
            {
              "key": "price3",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "MULTI_STEP"
          ],
          "modelCompatibility": [
            "ADDITION"
          ],
          "operandCount": 2,
          "template": "{character} buys a {item1} for {price1} and a {item2} for {price2}. What is the total cost?",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item1",
              "type": "item"
            },
            {
              "key": "item2",
              "type": "item"
            },
            {
              "key": "price1",
              "type": "value"
            },
            {
              "key": "price2",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION"
          ],
          "modelCompatibility": [
            "SUBTRACTION",
            "CHANGE_CALCULATION"
          ],
          "template": "{character} buys a {item} for {price} and pays with {payment}. How much change does {character} get?",
          "answerTemplate": "{character} receives {result} in change",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "price",
              "type": "value"
            },
            {
              "key": "payment",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION"
          ],
          "modelCompatibility": [
            "MULTIPLICATION"
          ],
          "template": "{character} buys {quantity} {item} at {price} each. What is the total cost?",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "quantity",
              "type": "value"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "price",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION"
          ],
          "modelCompatibility": [
            "DIVISION"
          ],
          "template": "{character} has {total} to spend equally on {quantity} {item}. How much can {character} spend on each one?",
          "answerTemplate": "{character} can spend {result} on each {item}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "total",
              "type": "value"
            },
            {
              "key": "quantity",
              "type": "value"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "COMPARISON",
            "ESTIMATION",
            "MULTI_STEP"
          ],
          "template": "{character} goes to the shop and buys {items}. How much does {character} spend in total?",
          "answerTemplate": "{character} spends {result} in total",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "items",
              "type": "item_list"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "ESTIMATION"
          ],
          "template": "Estimate: If {character} buys {items}, about how much will it cost?",
          "answerTemplate": "It will cost approximately {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "items",
              "type": "item_list"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "VALIDATION"
          ],
          "template": "{character} calculated that {items} costs {amount}. Is this correct?",
          "answerTemplate": "{validation_result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "items",
              "type": "item_list"
            },
            {
              "key": "amount",
              "type": "value"
            },
            {
              "key": "validation_result",
              "type": "boolean"
            }
          ]
        }
      ]
    },
    "distractors": [
      {
        "value": 9,
        "displayText": "9",
        "strategy": "WRONG_OPERATION",
        "reasoning": "Added instead of multiplying"
      },
      {
        "value": 5,
        "displayText": "5",
        "strategy": "WRONG_OPERATION",
        "reasoning": "Subtracted instead of multiplying"
      },
      {
        "value": 2.86,
        "displayText": "2.86",
        "strategy": "CLOSE_VALUE",
        "reasoning": "Off by 2"
      }
    ],
    "enhancementStatus": {
      "level": "partial",
      "requestedFormat": "DIRECT_CALCULATION",
      "actualFormat": "DIRECT_CALCULATION",
      "featuresActive": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "featuresPending": [],
      "isFullyEnhanced": true
    },
    "mathOutput": {
      "operation": "MULTIPLICATION",
      "multiplier": 2,
      "multiplicand": 0.43,
      "result": 0.86
    },
    "generationTime": 0,
    "questionId": "q_1759130032193_4oqc9qj8y",
    "generationSetup": {
      "controller_used": "DIRECT_CALCULATIONController",
      "format_requested": "DIRECT_CALCULATION",
      "format_actual": "DIRECT_CALCULATION",
      "scenario_theme": "SHOPPING",
      "scenario_id": "shop-002-realistic-general",
      "scenario_selection_method": "default",
      "distractor_strategies": [
        "WRONG_OPERATION",
        "WRONG_OPERATION",
        "CLOSE_VALUE"
      ],
      "distractor_count": 3,
      "theme_variety": false,
      "format_variety": false,
      "enhancement_level": "partial",
      "features_active": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "features_pending": [],
      "generation_time_ms": 0
    }
  },
  "metadata": {
    "format": "DIRECT_CALCULATION",
    "cognitive_load": 40,
    "curriculum_alignment": [
      "4N1a"
    ],
    "difficulty": "4.1",
    "scenario_theme": "SHOPPING",
    "distractor_strategies": [
      "WRONG_OPERATION",
      "WRONG_OPERATION",
      "CLOSE_VALUE"
    ],
    "generation_time_ms": 0,
    "api_version": "2.0",
    "enhancement_status": "partial",
    "format_requested": "DIRECT_CALCULATION",
    "format_used": "DIRECT_CALCULATION",
    "features_active": [
      "enhanced_distractors",
      "rich_scenarios",
      "cognitive_load",
      "advanced_formats"
    ],
    "features_pending": []
  },
  "context": {
    "id": "shop-002-realistic-general",
    "theme": "SHOPPING",
    "setting": {
      "location": "local shop",
      "timeContext": "after school",
      "atmosphere": "friendly"
    },
    "characters": [
      {
        "name": "Oliver",
        "role": "student"
      }
    ],
    "items": [
      {
        "name": "apple",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.2,
          "max": 0.5,
          "typical": 0.35,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "banana",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.15,
          "max": 0.4,
          "typical": 0.25,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "sandwich",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 2.5,
          "max": 6,
          "typical": 4,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "drink",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.8,
          "max": 2.5,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "cake",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 1.5,
          "max": 4,
          "typical": 2.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "biscuit",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.8,
          "max": 2,
          "typical": 1.2,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "sweet",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.1,
          "max": 1,
          "typical": 0.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "chocolate",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.6,
          "max": 3,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "pen",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.5,
          "max": 2,
          "typical": 1,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "pencil",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.2,
          "max": 1,
          "typical": 0.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "ruler",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.8,
          "max": 2.5,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "notebook",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 1,
          "max": 4,
          "typical": 2,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "eraser",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.3,
          "max": 1.5,
          "typical": 0.75,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "book",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 3,
          "max": 15,
          "typical": 8,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "comic",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 2,
          "max": 5,
          "typical": 3,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "magazine",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 2.5,
          "max": 6,
          "typical": 4,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "toy",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 5,
          "max": 25,
          "typical": 12,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "game",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 8,
          "max": 60,
          "typical": 25,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "puzzle",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 5,
          "max": 20,
          "typical": 12,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "sticker",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 0.2,
          "max": 2,
          "typical": 0.8,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "badge",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 0.5,
          "max": 3,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "poster",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 2,
          "max": 8,
          "typical": 4,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "card",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 0.5,
          "max": 4,
          "typical": 2,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      }
    ],
    "culturalElements": [
      {
        "type": "currency",
        "value": "£",
        "explanation": "British pounds"
      },
      {
        "type": "location",
        "value": "UK local shop",
        "explanation": "Typical British corner shop"
      }
    ],
    "realWorldConnection": "Everyday shopping with realistic UK prices",
    "yearAppropriate": [
      1,
      2,
      3,
      4,
      5,
      6
    ],
    "templates": [
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "MULTI_STEP"
        ],
        "modelCompatibility": [
          "ADDITION"
        ],
        "operandCount": 3,
        "template": "{character} buys a {item1} for {price1}, a {item2} for {price2}, and a {item3} for {price3}. What is the total cost?",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item1",
            "type": "item"
          },
          {
            "key": "item2",
            "type": "item"
          },
          {
            "key": "item3",
            "type": "item"
          },
          {
            "key": "price1",
            "type": "value"
          },
          {
            "key": "price2",
            "type": "value"
          },
          {
            "key": "price3",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "MULTI_STEP"
        ],
        "modelCompatibility": [
          "ADDITION"
        ],
        "operandCount": 2,
        "template": "{character} buys a {item1} for {price1} and a {item2} for {price2}. What is the total cost?",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item1",
            "type": "item"
          },
          {
            "key": "item2",
            "type": "item"
          },
          {
            "key": "price1",
            "type": "value"
          },
          {
            "key": "price2",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION"
        ],
        "modelCompatibility": [
          "SUBTRACTION",
          "CHANGE_CALCULATION"
        ],
        "template": "{character} buys a {item} for {price} and pays with {payment}. How much change does {character} get?",
        "answerTemplate": "{character} receives {result} in change",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "price",
            "type": "value"
          },
          {
            "key": "payment",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION"
        ],
        "modelCompatibility": [
          "MULTIPLICATION"
        ],
        "template": "{character} buys {quantity} {item} at {price} each. What is the total cost?",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "quantity",
            "type": "value"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "price",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION"
        ],
        "modelCompatibility": [
          "DIVISION"
        ],
        "template": "{character} has {total} to spend equally on {quantity} {item}. How much can {character} spend on each one?",
        "answerTemplate": "{character} can spend {result} on each {item}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "total",
            "type": "value"
          },
          {
            "key": "quantity",
            "type": "value"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "COMPARISON",
          "ESTIMATION",
          "MULTI_STEP"
        ],
        "template": "{character} goes to the shop and buys {items}. How much does {character} spend in total?",
        "answerTemplate": "{character} spends {result} in total",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "items",
            "type": "item_list"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "ESTIMATION"
        ],
        "template": "Estimate: If {character} buys {items}, about how much will it cost?",
        "answerTemplate": "It will cost approximately {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "items",
            "type": "item_list"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "VALIDATION"
        ],
        "template": "{character} calculated that {items} costs {amount}. Is this correct?",
        "answerTemplate": "{validation_result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "items",
            "type": "item_list"
          },
          {
            "key": "amount",
            "type": "value"
          },
          {
            "key": "validation_result",
            "type": "boolean"
          }
        ]
      }
    ]
  }
}
# Test D.5: MULTIPLICATION at difficulty 5.3
{
  "success": true,
  "question": {
    "text": "Sarah is shopping and needs to make several calculations. Sarah then buys 3 items at 426p each. Then Sarah adds 198p more to the total. What is the final result?",
    "options": [
      {
        "text": "1476",
        "value": 1476,
        "index": 0
      },
      {
        "text": "1476",
        "value": 1476,
        "index": 1
      },
      {
        "text": "1278",
        "value": 1278,
        "index": 2
      },
      {
        "text": "£1476.00",
        "value": 1476,
        "index": 3
      }
    ],
    "correctIndex": 0,
    "questionContent": {
      "fullText": "Sarah is shopping and needs to make several calculations. Sarah then buys 3 items at 426p each. Then Sarah adds 198p more to the total. What is the final result?",
      "components": {
        "narrative": "Sarah needs to solve this step by step:",
        "steps": [
          {
            "stepNumber": 1,
            "text": "Multiply 426 by 3",
            "operation": "MULTIPLICATION",
            "values": [
              426,
              3
            ],
            "result": 1278,
            "description": "Multiply 426 by 3"
          },
          {
            "stepNumber": 2,
            "text": "Add 198 to 1278",
            "operation": "ADDITION",
            "values": [
              1278,
              198
            ],
            "result": 1476,
            "description": "Add 198 to 1278"
          }
        ],
        "prompt": "What is the final result?",
        "highlightValues": [
          426,
          3,
          1278,
          1278,
          198,
          1476
        ],
        "operators": [
          "×",
          "+"
        ]
      },
      "templateData": {
        "character": "Sarah",
        "context": "school book fair",
        "theme": "SHOPPING",
        "quantities": [
          426,
          1278
        ],
        "prices": [
          3,
          198
        ],
        "action": "calculating step by step"
      }
    },
    "format": "MULTI_STEP",
    "difficulty": {
      "year": 5,
      "subLevel": 3,
      "displayName": "5.3",
      "cognitiveLoad": 60
    },
    "cognitiveLoad": 60,
    "curriculumTags": [
      "5N1a"
    ],
    "scenario": {
      "id": "shop-001-bookfair",
      "theme": "SHOPPING",
      "setting": {
        "location": "school book fair",
        "timeContext": "lunch break",
        "atmosphere": "busy"
      },
      "characters": [
        {
          "name": "Sarah",
          "role": "student"
        },
        {
          "name": "Mr. Johnson",
          "role": "teacher"
        }
      ],
      "items": [
        {
          "name": "book",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 3,
            "max": 12,
            "typical": 6.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "bookmark",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.5,
            "max": 2,
            "typical": 1,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        }
      ],
      "culturalElements": [
        {
          "type": "currency",
          "value": "£",
          "explanation": "British pounds"
        },
        {
          "type": "event",
          "value": "book fair",
          "explanation": "School fundraising event"
        }
      ],
      "realWorldConnection": "School fundraising and reading promotion",
      "yearAppropriate": [
        2,
        3,
        4,
        5
      ],
      "templates": [
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "COMPARISON"
          ],
          "template": "{character} wants to buy books at the book fair. Calculate the total cost.",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        }
      ]
    },
    "distractors": [
      {
        "value": 1278,
        "rationale": "Stopped after first step"
      },
      {
        "value": 1476,
        "strategy": "WRONG_OPERATION",
        "rationale": "Used wrong operation in step 1"
      },
      {
        "value": 1476,
        "rationale": "Performed operations in wrong order"
      }
    ],
    "enhancementStatus": {
      "level": "full",
      "requestedFormat": "MULTI_STEP",
      "actualFormat": "MULTI_STEP",
      "featuresActive": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "featuresPending": [],
      "isFullyEnhanced": true
    },
    "mathOutput": {
      "operation": "MULTIPLICATION",
      "multiplicand": 68,
      "multiplier": 20,
      "result": 1360,
      "factors": [
        68,
        20
      ],
      "decimal_formatted": {
        "operands": [
          "68",
          "20"
        ],
        "result": "1360"
      }
    },
    "generationTime": 0,
    "questionId": "q_1759130032310_uohqe8cy8",
    "generationSetup": {
      "controller_used": "MULTI_STEPController",
      "format_requested": "MULTI_STEP",
      "format_actual": "MULTI_STEP",
      "scenario_theme": "SHOPPING",
      "scenario_id": "shop-001-bookfair",
      "scenario_selection_method": "default",
      "distractor_strategies": [
        null,
        "WRONG_OPERATION",
        null
      ],
      "distractor_count": 3,
      "theme_variety": false,
      "format_variety": false,
      "enhancement_level": "full",
      "features_active": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "features_pending": [],
      "generation_time_ms": 0
    }
  },
  "metadata": {
    "format": "MULTI_STEP",
    "cognitive_load": 60,
    "curriculum_alignment": [
      "5N1a"
    ],
    "difficulty": "5.3",
    "scenario_theme": "SHOPPING",
    "distractor_strategies": [
      null,
      "WRONG_OPERATION",
      null
    ],
    "generation_time_ms": 0,
    "api_version": "2.0",
    "enhancement_status": "full",
    "format_requested": "MULTI_STEP",
    "format_used": "MULTI_STEP",
    "features_active": [
      "enhanced_distractors",
      "rich_scenarios",
      "cognitive_load",
      "advanced_formats"
    ],
    "features_pending": []
  },
  "context": {
    "id": "shop-001-bookfair",
    "theme": "SHOPPING",
    "setting": {
      "location": "school book fair",
      "timeContext": "lunch break",
      "atmosphere": "busy"
    },
    "characters": [
      {
        "name": "Sarah",
        "role": "student"
      },
      {
        "name": "Mr. Johnson",
        "role": "teacher"
      }
    ],
    "items": [
      {
        "name": "book",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 3,
          "max": 12,
          "typical": 6.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "bookmark",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.5,
          "max": 2,
          "typical": 1,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      }
    ],
    "culturalElements": [
      {
        "type": "currency",
        "value": "£",
        "explanation": "British pounds"
      },
      {
        "type": "event",
        "value": "book fair",
        "explanation": "School fundraising event"
      }
    ],
    "realWorldConnection": "School fundraising and reading promotion",
    "yearAppropriate": [
      2,
      3,
      4,
      5
    ],
    "templates": [
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "COMPARISON"
        ],
        "template": "{character} wants to buy books at the book fair. Calculate the total cost.",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      }
    ]
  }
}
# Test D.6: MULTIPLICATION at difficulty 6.4
{
  "success": true,
  "question": {
    "text": "Oliver is working on this equation: ? × undefined = 107460. What number should replace the ? to make this equation true?",
    "options": [
      {
        "text": "108",
        "value": 108,
        "index": 0
      },
      {
        "text": "199",
        "value": 199,
        "index": 1
      },
      {
        "text": "204",
        "value": 204,
        "index": 2
      },
      {
        "text": "197",
        "value": 197,
        "index": 3
      }
    ],
    "correctIndex": 1,
    "questionContent": {
      "fullText": "Oliver is working on this equation: ? × undefined = 107460. What number should replace the ? to make this equation true?"
    },
    "format": "MISSING_VALUE",
    "difficulty": {
      "year": 6,
      "subLevel": 4,
      "displayName": "6.4",
      "cognitiveLoad": 75
    },
    "cognitiveLoad": 75,
    "curriculumTags": [
      "6N1a"
    ],
    "scenario": {
      "id": "shop-002-realistic-general",
      "theme": "SHOPPING",
      "setting": {
        "location": "local shop",
        "timeContext": "after school",
        "atmosphere": "friendly"
      },
      "characters": [
        {
          "name": "Oliver",
          "role": "student"
        }
      ],
      "items": [
        {
          "name": "apple",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.2,
            "max": 0.5,
            "typical": 0.35,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "banana",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.15,
            "max": 0.4,
            "typical": 0.25,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "sandwich",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 2.5,
            "max": 6,
            "typical": 4,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "drink",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.8,
            "max": 2.5,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "cake",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 1.5,
            "max": 4,
            "typical": 2.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "biscuit",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.8,
            "max": 2,
            "typical": 1.2,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "sweet",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.1,
            "max": 1,
            "typical": 0.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "chocolate",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.6,
            "max": 3,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "pen",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.5,
            "max": 2,
            "typical": 1,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "pencil",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.2,
            "max": 1,
            "typical": 0.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "ruler",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.8,
            "max": 2.5,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "notebook",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 1,
            "max": 4,
            "typical": 2,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "eraser",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.3,
            "max": 1.5,
            "typical": 0.75,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "book",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 3,
            "max": 15,
            "typical": 8,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "comic",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 2,
            "max": 5,
            "typical": 3,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "magazine",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 2.5,
            "max": 6,
            "typical": 4,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "toy",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 5,
            "max": 25,
            "typical": 12,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "game",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 8,
            "max": 60,
            "typical": 25,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "puzzle",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 5,
            "max": 20,
            "typical": 12,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "sticker",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 0.2,
            "max": 2,
            "typical": 0.8,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "badge",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 0.5,
            "max": 3,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "poster",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 2,
            "max": 8,
            "typical": 4,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "card",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 0.5,
            "max": 4,
            "typical": 2,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        }
      ],
      "culturalElements": [
        {
          "type": "currency",
          "value": "£",
          "explanation": "British pounds"
        },
        {
          "type": "location",
          "value": "UK local shop",
          "explanation": "Typical British corner shop"
        }
      ],
      "realWorldConnection": "Everyday shopping with realistic UK prices",
      "yearAppropriate": [
        1,
        2,
        3,
        4,
        5,
        6
      ],
      "templates": [
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "MULTI_STEP"
          ],
          "modelCompatibility": [
            "ADDITION"
          ],
          "operandCount": 3,
          "template": "{character} buys a {item1} for {price1}, a {item2} for {price2}, and a {item3} for {price3}. What is the total cost?",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item1",
              "type": "item"
            },
            {
              "key": "item2",
              "type": "item"
            },
            {
              "key": "item3",
              "type": "item"
            },
            {
              "key": "price1",
              "type": "value"
            },
            {
              "key": "price2",
              "type": "value"
            },
            {
              "key": "price3",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "MULTI_STEP"
          ],
          "modelCompatibility": [
            "ADDITION"
          ],
          "operandCount": 2,
          "template": "{character} buys a {item1} for {price1} and a {item2} for {price2}. What is the total cost?",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item1",
              "type": "item"
            },
            {
              "key": "item2",
              "type": "item"
            },
            {
              "key": "price1",
              "type": "value"
            },
            {
              "key": "price2",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION"
          ],
          "modelCompatibility": [
            "SUBTRACTION",
            "CHANGE_CALCULATION"
          ],
          "template": "{character} buys a {item} for {price} and pays with {payment}. How much change does {character} get?",
          "answerTemplate": "{character} receives {result} in change",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "price",
              "type": "value"
            },
            {
              "key": "payment",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION"
          ],
          "modelCompatibility": [
            "MULTIPLICATION"
          ],
          "template": "{character} buys {quantity} {item} at {price} each. What is the total cost?",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "quantity",
              "type": "value"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "price",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION"
          ],
          "modelCompatibility": [
            "DIVISION"
          ],
          "template": "{character} has {total} to spend equally on {quantity} {item}. How much can {character} spend on each one?",
          "answerTemplate": "{character} can spend {result} on each {item}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "total",
              "type": "value"
            },
            {
              "key": "quantity",
              "type": "value"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "COMPARISON",
            "ESTIMATION",
            "MULTI_STEP"
          ],
          "template": "{character} goes to the shop and buys {items}. How much does {character} spend in total?",
          "answerTemplate": "{character} spends {result} in total",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "items",
              "type": "item_list"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "ESTIMATION"
          ],
          "template": "Estimate: If {character} buys {items}, about how much will it cost?",
          "answerTemplate": "It will cost approximately {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "items",
              "type": "item_list"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "VALIDATION"
          ],
          "template": "{character} calculated that {items} costs {amount}. Is this correct?",
          "answerTemplate": "{validation_result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "items",
              "type": "item_list"
            },
            {
              "key": "amount",
              "type": "value"
            },
            {
              "key": "validation_result",
              "type": "boolean"
            }
          ]
        }
      ]
    },
    "distractors": [
      {
        "value": 204,
        "strategy": "WRONG_OPERATION",
        "rationale": "Used wrong operation to solve"
      },
      {
        "value": 197,
        "strategy": "CALCULATION_ERROR",
        "rationale": "Arithmetic calculation error"
      },
      {
        "value": 108,
        "rationale": "Confused given value with missing value"
      }
    ],
    "enhancementStatus": {
      "level": "full",
      "requestedFormat": "MISSING_VALUE",
      "actualFormat": "MISSING_VALUE",
      "featuresActive": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "featuresPending": [],
      "isFullyEnhanced": true
    },
    "mathOutput": {
      "operation": "MULTIPLICATION",
      "multiplicand": 199,
      "multiplier": 108,
      "result": 107460,
      "factors": [
        199,
        108,
        5
      ],
      "decimal_formatted": {
        "operands": [
          "199",
          "108",
          "5"
        ],
        "result": "107460"
      }
    },
    "generationTime": 0,
    "questionId": "q_1759130032350_75z94yyp2",
    "generationSetup": {
      "controller_used": "MISSING_VALUEController",
      "format_requested": "MISSING_VALUE",
      "format_actual": "MISSING_VALUE",
      "scenario_theme": "SHOPPING",
      "scenario_id": "shop-002-realistic-general",
      "scenario_selection_method": "default",
      "distractor_strategies": [
        "WRONG_OPERATION",
        "CALCULATION_ERROR",
        null
      ],
      "distractor_count": 3,
      "theme_variety": false,
      "format_variety": false,
      "enhancement_level": "full",
      "features_active": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "features_pending": [],
      "generation_time_ms": 0
    }
  },
  "metadata": {
    "format": "MISSING_VALUE",
    "cognitive_load": 75,
    "curriculum_alignment": [
      "6N1a"
    ],
    "difficulty": "6.4",
    "scenario_theme": "SHOPPING",
    "distractor_strategies": [
      "WRONG_OPERATION",
      "CALCULATION_ERROR",
      null
    ],
    "generation_time_ms": 0,
    "api_version": "2.0",
    "enhancement_status": "full",
    "format_requested": "MISSING_VALUE",
    "format_used": "MISSING_VALUE",
    "features_active": [
      "enhanced_distractors",
      "rich_scenarios",
      "cognitive_load",
      "advanced_formats"
    ],
    "features_pending": []
  },
  "context": {
    "id": "shop-002-realistic-general",
    "theme": "SHOPPING",
    "setting": {
      "location": "local shop",
      "timeContext": "after school",
      "atmosphere": "friendly"
    },
    "characters": [
      {
        "name": "Oliver",
        "role": "student"
      }
    ],
    "items": [
      {
        "name": "apple",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.2,
          "max": 0.5,
          "typical": 0.35,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "banana",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.15,
          "max": 0.4,
          "typical": 0.25,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "sandwich",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 2.5,
          "max": 6,
          "typical": 4,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "drink",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.8,
          "max": 2.5,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "cake",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 1.5,
          "max": 4,
          "typical": 2.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "biscuit",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.8,
          "max": 2,
          "typical": 1.2,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "sweet",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.1,
          "max": 1,
          "typical": 0.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "chocolate",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.6,
          "max": 3,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "pen",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.5,
          "max": 2,
          "typical": 1,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "pencil",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.2,
          "max": 1,
          "typical": 0.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "ruler",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.8,
          "max": 2.5,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "notebook",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 1,
          "max": 4,
          "typical": 2,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "eraser",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.3,
          "max": 1.5,
          "typical": 0.75,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "book",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 3,
          "max": 15,
          "typical": 8,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "comic",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 2,
          "max": 5,
          "typical": 3,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "magazine",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 2.5,
          "max": 6,
          "typical": 4,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "toy",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 5,
          "max": 25,
          "typical": 12,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "game",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 8,
          "max": 60,
          "typical": 25,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "puzzle",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 5,
          "max": 20,
          "typical": 12,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "sticker",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 0.2,
          "max": 2,
          "typical": 0.8,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "badge",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 0.5,
          "max": 3,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "poster",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 2,
          "max": 8,
          "typical": 4,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "card",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 0.5,
          "max": 4,
          "typical": 2,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      }
    ],
    "culturalElements": [
      {
        "type": "currency",
        "value": "£",
        "explanation": "British pounds"
      },
      {
        "type": "location",
        "value": "UK local shop",
        "explanation": "Typical British corner shop"
      }
    ],
    "realWorldConnection": "Everyday shopping with realistic UK prices",
    "yearAppropriate": [
      1,
      2,
      3,
      4,
      5,
      6
    ],
    "templates": [
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "MULTI_STEP"
        ],
        "modelCompatibility": [
          "ADDITION"
        ],
        "operandCount": 3,
        "template": "{character} buys a {item1} for {price1}, a {item2} for {price2}, and a {item3} for {price3}. What is the total cost?",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item1",
            "type": "item"
          },
          {
            "key": "item2",
            "type": "item"
          },
          {
            "key": "item3",
            "type": "item"
          },
          {
            "key": "price1",
            "type": "value"
          },
          {
            "key": "price2",
            "type": "value"
          },
          {
            "key": "price3",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "MULTI_STEP"
        ],
        "modelCompatibility": [
          "ADDITION"
        ],
        "operandCount": 2,
        "template": "{character} buys a {item1} for {price1} and a {item2} for {price2}. What is the total cost?",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item1",
            "type": "item"
          },
          {
            "key": "item2",
            "type": "item"
          },
          {
            "key": "price1",
            "type": "value"
          },
          {
            "key": "price2",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION"
        ],
        "modelCompatibility": [
          "SUBTRACTION",
          "CHANGE_CALCULATION"
        ],
        "template": "{character} buys a {item} for {price} and pays with {payment}. How much change does {character} get?",
        "answerTemplate": "{character} receives {result} in change",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "price",
            "type": "value"
          },
          {
            "key": "payment",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION"
        ],
        "modelCompatibility": [
          "MULTIPLICATION"
        ],
        "template": "{character} buys {quantity} {item} at {price} each. What is the total cost?",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "quantity",
            "type": "value"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "price",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION"
        ],
        "modelCompatibility": [
          "DIVISION"
        ],
        "template": "{character} has {total} to spend equally on {quantity} {item}. How much can {character} spend on each one?",
        "answerTemplate": "{character} can spend {result} on each {item}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "total",
            "type": "value"
          },
          {
            "key": "quantity",
            "type": "value"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "COMPARISON",
          "ESTIMATION",
          "MULTI_STEP"
        ],
        "template": "{character} goes to the shop and buys {items}. How much does {character} spend in total?",
        "answerTemplate": "{character} spends {result} in total",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "items",
            "type": "item_list"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "ESTIMATION"
        ],
        "template": "Estimate: If {character} buys {items}, about how much will it cost?",
        "answerTemplate": "It will cost approximately {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "items",
            "type": "item_list"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "VALIDATION"
        ],
        "template": "{character} calculated that {items} costs {amount}. Is this correct?",
        "answerTemplate": "{validation_result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "items",
            "type": "item_list"
          },
          {
            "key": "amount",
            "type": "value"
          },
          {
            "key": "validation_result",
            "type": "boolean"
          }
        ]
      }
    ]
  }
}

--- SUITE E: SCENARIO THEME TESTS ---
Testing that each scenario theme can be applied...
# Test E.1: SHOPPING theme
{
  "success": true,
  "question": {
    "text": "Oliver buys a apple for 27p, a banana for 29p, and a sandwich for £5.31. What is the total cost?",
    "options": [
      {
        "text": "6.87",
        "value": 6.87,
        "index": 0
      },
      {
        "text": "£5.87",
        "value": 5.87,
        "index": 1
      },
      {
        "text": "28",
        "value": 28,
        "index": 2
      },
      {
        "text": "132",
        "value": 132,
        "index": 3
      }
    ],
    "correctIndex": 1,
    "format": "DIRECT_CALCULATION",
    "difficulty": {
      "year": 3,
      "subLevel": 1,
      "displayName": "3.1",
      "cognitiveLoad": 30
    },
    "cognitiveLoad": 30,
    "curriculumTags": [
      "3N1a",
      "3N1b"
    ],
    "scenario": {
      "id": "shop-002-realistic-general",
      "theme": "SHOPPING",
      "setting": {
        "location": "local shop",
        "timeContext": "after school",
        "atmosphere": "friendly"
      },
      "characters": [
        {
          "name": "Oliver",
          "role": "student"
        }
      ],
      "items": [
        {
          "name": "apple",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.2,
            "max": 0.5,
            "typical": 0.35,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "banana",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.15,
            "max": 0.4,
            "typical": 0.25,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "sandwich",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 2.5,
            "max": 6,
            "typical": 4,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "drink",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.8,
            "max": 2.5,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "cake",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 1.5,
            "max": 4,
            "typical": 2.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "biscuit",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.8,
            "max": 2,
            "typical": 1.2,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "sweet",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.1,
            "max": 1,
            "typical": 0.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "chocolate",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.6,
            "max": 3,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "pen",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.5,
            "max": 2,
            "typical": 1,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "pencil",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.2,
            "max": 1,
            "typical": 0.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "ruler",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.8,
            "max": 2.5,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "notebook",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 1,
            "max": 4,
            "typical": 2,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "eraser",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.3,
            "max": 1.5,
            "typical": 0.75,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "book",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 3,
            "max": 15,
            "typical": 8,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "comic",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 2,
            "max": 5,
            "typical": 3,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "magazine",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 2.5,
            "max": 6,
            "typical": 4,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "toy",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 5,
            "max": 25,
            "typical": 12,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "game",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 8,
            "max": 60,
            "typical": 25,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "puzzle",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 5,
            "max": 20,
            "typical": 12,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "sticker",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 0.2,
            "max": 2,
            "typical": 0.8,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "badge",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 0.5,
            "max": 3,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "poster",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 2,
            "max": 8,
            "typical": 4,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "card",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 0.5,
            "max": 4,
            "typical": 2,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        }
      ],
      "culturalElements": [
        {
          "type": "currency",
          "value": "£",
          "explanation": "British pounds"
        },
        {
          "type": "location",
          "value": "UK local shop",
          "explanation": "Typical British corner shop"
        }
      ],
      "realWorldConnection": "Everyday shopping with realistic UK prices",
      "yearAppropriate": [
        1,
        2,
        3,
        4,
        5,
        6
      ],
      "templates": [
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "MULTI_STEP"
          ],
          "modelCompatibility": [
            "ADDITION"
          ],
          "operandCount": 3,
          "template": "{character} buys a {item1} for {price1}, a {item2} for {price2}, and a {item3} for {price3}. What is the total cost?",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item1",
              "type": "item"
            },
            {
              "key": "item2",
              "type": "item"
            },
            {
              "key": "item3",
              "type": "item"
            },
            {
              "key": "price1",
              "type": "value"
            },
            {
              "key": "price2",
              "type": "value"
            },
            {
              "key": "price3",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "MULTI_STEP"
          ],
          "modelCompatibility": [
            "ADDITION"
          ],
          "operandCount": 2,
          "template": "{character} buys a {item1} for {price1} and a {item2} for {price2}. What is the total cost?",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item1",
              "type": "item"
            },
            {
              "key": "item2",
              "type": "item"
            },
            {
              "key": "price1",
              "type": "value"
            },
            {
              "key": "price2",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION"
          ],
          "modelCompatibility": [
            "SUBTRACTION",
            "CHANGE_CALCULATION"
          ],
          "template": "{character} buys a {item} for {price} and pays with {payment}. How much change does {character} get?",
          "answerTemplate": "{character} receives {result} in change",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "price",
              "type": "value"
            },
            {
              "key": "payment",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION"
          ],
          "modelCompatibility": [
            "MULTIPLICATION"
          ],
          "template": "{character} buys {quantity} {item} at {price} each. What is the total cost?",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "quantity",
              "type": "value"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "price",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION"
          ],
          "modelCompatibility": [
            "DIVISION"
          ],
          "template": "{character} has {total} to spend equally on {quantity} {item}. How much can {character} spend on each one?",
          "answerTemplate": "{character} can spend {result} on each {item}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "total",
              "type": "value"
            },
            {
              "key": "quantity",
              "type": "value"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "COMPARISON",
            "ESTIMATION",
            "MULTI_STEP"
          ],
          "template": "{character} goes to the shop and buys {items}. How much does {character} spend in total?",
          "answerTemplate": "{character} spends {result} in total",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "items",
              "type": "item_list"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "ESTIMATION"
          ],
          "template": "Estimate: If {character} buys {items}, about how much will it cost?",
          "answerTemplate": "It will cost approximately {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "items",
              "type": "item_list"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "VALIDATION"
          ],
          "template": "{character} calculated that {items} costs {amount}. Is this correct?",
          "answerTemplate": "{validation_result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "items",
              "type": "item_list"
            },
            {
              "key": "amount",
              "type": "value"
            },
            {
              "key": "validation_result",
              "type": "boolean"
            }
          ]
        }
      ]
    },
    "distractors": [
      {
        "value": 132,
        "displayText": "132",
        "strategy": "WRONG_OPERATION",
        "reasoning": "Multiplied instead of adding"
      },
      {
        "value": 28,
        "displayText": "28",
        "strategy": "PARTIAL_CALCULATION",
        "reasoning": "Stopped calculation early"
      },
      {
        "value": 6.87,
        "displayText": "6.87",
        "strategy": "CLOSE_VALUE",
        "reasoning": "Off by 1"
      }
    ],
    "enhancementStatus": {
      "level": "partial",
      "requestedFormat": "DIRECT_CALCULATION",
      "actualFormat": "DIRECT_CALCULATION",
      "featuresActive": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "featuresPending": [],
      "isFullyEnhanced": true
    },
    "mathOutput": {
      "operation": "ADDITION",
      "operand_1": 0.27,
      "operand_2": 0.29,
      "operand_3": 5.31,
      "result": 5.87
    },
    "generationTime": 1,
    "questionId": "q_1759130032394_o6wbllh06",
    "generationSetup": {
      "controller_used": "DIRECT_CALCULATIONController",
      "format_requested": "DIRECT_CALCULATION",
      "format_actual": "DIRECT_CALCULATION",
      "scenario_theme": "SHOPPING",
      "scenario_id": "shop-002-realistic-general",
      "scenario_selection_method": "requested",
      "distractor_strategies": [
        "WRONG_OPERATION",
        "PARTIAL_CALCULATION",
        "CLOSE_VALUE"
      ],
      "distractor_count": 3,
      "theme_variety": false,
      "format_variety": false,
      "enhancement_level": "partial",
      "features_active": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "features_pending": [],
      "generation_time_ms": 1
    }
  },
  "metadata": {
    "format": "DIRECT_CALCULATION",
    "cognitive_load": 30,
    "curriculum_alignment": [
      "3N1a",
      "3N1b"
    ],
    "difficulty": "3.1",
    "scenario_theme": "SHOPPING",
    "distractor_strategies": [
      "WRONG_OPERATION",
      "PARTIAL_CALCULATION",
      "CLOSE_VALUE"
    ],
    "generation_time_ms": 1,
    "api_version": "2.0",
    "enhancement_status": "partial",
    "format_requested": "DIRECT_CALCULATION",
    "format_used": "DIRECT_CALCULATION",
    "features_active": [
      "enhanced_distractors",
      "rich_scenarios",
      "cognitive_load",
      "advanced_formats"
    ],
    "features_pending": []
  },
  "context": {
    "id": "shop-002-realistic-general",
    "theme": "SHOPPING",
    "setting": {
      "location": "local shop",
      "timeContext": "after school",
      "atmosphere": "friendly"
    },
    "characters": [
      {
        "name": "Oliver",
        "role": "student"
      }
    ],
    "items": [
      {
        "name": "apple",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.2,
          "max": 0.5,
          "typical": 0.35,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "banana",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.15,
          "max": 0.4,
          "typical": 0.25,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "sandwich",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 2.5,
          "max": 6,
          "typical": 4,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "drink",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.8,
          "max": 2.5,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "cake",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 1.5,
          "max": 4,
          "typical": 2.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "biscuit",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.8,
          "max": 2,
          "typical": 1.2,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "sweet",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.1,
          "max": 1,
          "typical": 0.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "chocolate",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.6,
          "max": 3,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "pen",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.5,
          "max": 2,
          "typical": 1,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "pencil",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.2,
          "max": 1,
          "typical": 0.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "ruler",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.8,
          "max": 2.5,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "notebook",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 1,
          "max": 4,
          "typical": 2,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "eraser",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.3,
          "max": 1.5,
          "typical": 0.75,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "book",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 3,
          "max": 15,
          "typical": 8,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "comic",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 2,
          "max": 5,
          "typical": 3,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "magazine",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 2.5,
          "max": 6,
          "typical": 4,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "toy",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 5,
          "max": 25,
          "typical": 12,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "game",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 8,
          "max": 60,
          "typical": 25,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "puzzle",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 5,
          "max": 20,
          "typical": 12,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "sticker",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 0.2,
          "max": 2,
          "typical": 0.8,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "badge",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 0.5,
          "max": 3,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "poster",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 2,
          "max": 8,
          "typical": 4,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "card",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 0.5,
          "max": 4,
          "typical": 2,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      }
    ],
    "culturalElements": [
      {
        "type": "currency",
        "value": "£",
        "explanation": "British pounds"
      },
      {
        "type": "location",
        "value": "UK local shop",
        "explanation": "Typical British corner shop"
      }
    ],
    "realWorldConnection": "Everyday shopping with realistic UK prices",
    "yearAppropriate": [
      1,
      2,
      3,
      4,
      5,
      6
    ],
    "templates": [
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "MULTI_STEP"
        ],
        "modelCompatibility": [
          "ADDITION"
        ],
        "operandCount": 3,
        "template": "{character} buys a {item1} for {price1}, a {item2} for {price2}, and a {item3} for {price3}. What is the total cost?",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item1",
            "type": "item"
          },
          {
            "key": "item2",
            "type": "item"
          },
          {
            "key": "item3",
            "type": "item"
          },
          {
            "key": "price1",
            "type": "value"
          },
          {
            "key": "price2",
            "type": "value"
          },
          {
            "key": "price3",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "MULTI_STEP"
        ],
        "modelCompatibility": [
          "ADDITION"
        ],
        "operandCount": 2,
        "template": "{character} buys a {item1} for {price1} and a {item2} for {price2}. What is the total cost?",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item1",
            "type": "item"
          },
          {
            "key": "item2",
            "type": "item"
          },
          {
            "key": "price1",
            "type": "value"
          },
          {
            "key": "price2",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION"
        ],
        "modelCompatibility": [
          "SUBTRACTION",
          "CHANGE_CALCULATION"
        ],
        "template": "{character} buys a {item} for {price} and pays with {payment}. How much change does {character} get?",
        "answerTemplate": "{character} receives {result} in change",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "price",
            "type": "value"
          },
          {
            "key": "payment",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION"
        ],
        "modelCompatibility": [
          "MULTIPLICATION"
        ],
        "template": "{character} buys {quantity} {item} at {price} each. What is the total cost?",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "quantity",
            "type": "value"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "price",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION"
        ],
        "modelCompatibility": [
          "DIVISION"
        ],
        "template": "{character} has {total} to spend equally on {quantity} {item}. How much can {character} spend on each one?",
        "answerTemplate": "{character} can spend {result} on each {item}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "total",
            "type": "value"
          },
          {
            "key": "quantity",
            "type": "value"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "COMPARISON",
          "ESTIMATION",
          "MULTI_STEP"
        ],
        "template": "{character} goes to the shop and buys {items}. How much does {character} spend in total?",
        "answerTemplate": "{character} spends {result} in total",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "items",
            "type": "item_list"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "ESTIMATION"
        ],
        "template": "Estimate: If {character} buys {items}, about how much will it cost?",
        "answerTemplate": "It will cost approximately {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "items",
            "type": "item_list"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "VALIDATION"
        ],
        "template": "{character} calculated that {items} costs {amount}. Is this correct?",
        "answerTemplate": "{validation_result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "items",
            "type": "item_list"
          },
          {
            "key": "amount",
            "type": "value"
          },
          {
            "key": "validation_result",
            "type": "boolean"
          }
        ]
      }
    ]
  }
}
# Test E.2: COOKING theme
{
  "success": true,
  "question": {
    "text": "Lucas is making bread. The ingredients cost £14, £39, £9. What is the total cost?",
    "options": [
      {
        "text": "546",
        "value": 546,
        "index": 0
      },
      {
        "text": "72",
        "value": 72,
        "index": 1
      },
      {
        "text": "£62.00",
        "value": 62,
        "index": 2
      },
      {
        "text": "53",
        "value": 53,
        "index": 3
      }
    ],
    "correctIndex": 2,
    "format": "DIRECT_CALCULATION",
    "difficulty": {
      "year": 3,
      "subLevel": 1,
      "displayName": "3.1",
      "cognitiveLoad": 30
    },
    "cognitiveLoad": 30,
    "curriculumTags": [
      "3N1a",
      "3N1b"
    ],
    "scenario": {
      "id": "cooking-3-1759130032440",
      "theme": "COOKING",
      "setting": {
        "location": "kitchen",
        "timeContext": "weekend baking",
        "atmosphere": "creative"
      },
      "characters": [
        {
          "name": "Lucas",
          "role": "student"
        },
        {
          "name": "Mum",
          "role": "parent"
        }
      ],
      "items": [
        {
          "name": "flour",
          "category": "FOOD_ITEMS",
          "typicalValue": {
            "min": 1,
            "max": 5,
            "typical": 2.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "eggs",
          "category": "FOOD_ITEMS",
          "typicalValue": {
            "min": 1,
            "max": 5,
            "typical": 2.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "butter",
          "category": "FOOD_ITEMS",
          "typicalValue": {
            "min": 1,
            "max": 5,
            "typical": 2.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "sugar",
          "category": "FOOD_ITEMS",
          "typicalValue": {
            "min": 1,
            "max": 5,
            "typical": 2.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "milk",
          "category": "FOOD_ITEMS",
          "typicalValue": {
            "min": 1,
            "max": 5,
            "typical": 2.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "chocolate chips",
          "category": "FOOD_ITEMS",
          "typicalValue": {
            "min": 1,
            "max": 5,
            "typical": 2.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        }
      ],
      "culturalElements": [
        {
          "type": "currency",
          "value": "£",
          "explanation": "British pounds"
        },
        {
          "type": "measurement",
          "value": "grams",
          "explanation": "Weight measurement for ingredients"
        }
      ],
      "realWorldConnection": "Following recipes and calculating ingredient costs",
      "yearAppropriate": [
        3
      ],
      "templates": [
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "MULTI_STEP"
          ],
          "template": "{character} is making {recipe}. The ingredients cost {prices}. What is the total cost?",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "recipe",
              "type": "item"
            },
            {
              "key": "prices",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        }
      ]
    },
    "distractors": [
      {
        "value": 546,
        "displayText": "546",
        "strategy": "WRONG_OPERATION",
        "reasoning": "Multiplied instead of adding"
      },
      {
        "value": 72,
        "displayText": "72",
        "strategy": "PLACE_VALUE_ERROR",
        "reasoning": "Error in carrying to next column"
      },
      {
        "value": 53,
        "displayText": "53",
        "strategy": "PARTIAL_CALCULATION",
        "reasoning": "Stopped calculation early"
      }
    ],
    "enhancementStatus": {
      "level": "partial",
      "requestedFormat": "DIRECT_CALCULATION",
      "actualFormat": "DIRECT_CALCULATION",
      "featuresActive": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "featuresPending": [],
      "isFullyEnhanced": true
    },
    "mathOutput": {
      "operation": "ADDITION",
      "operand_1": 14,
      "operand_2": 39,
      "operand_3": 9,
      "result": 62
    },
    "generationTime": 1,
    "questionId": "q_1759130032440_rtu0yxnsk",
    "generationSetup": {
      "controller_used": "DIRECT_CALCULATIONController",
      "format_requested": "DIRECT_CALCULATION",
      "format_actual": "DIRECT_CALCULATION",
      "scenario_theme": "COOKING",
      "scenario_id": "cooking-3-1759130032440",
      "scenario_selection_method": "requested",
      "distractor_strategies": [
        "WRONG_OPERATION",
        "PLACE_VALUE_ERROR",
        "PARTIAL_CALCULATION"
      ],
      "distractor_count": 3,
      "theme_variety": false,
      "format_variety": false,
      "enhancement_level": "partial",
      "features_active": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "features_pending": [],
      "generation_time_ms": 1
    }
  },
  "metadata": {
    "format": "DIRECT_CALCULATION",
    "cognitive_load": 30,
    "curriculum_alignment": [
      "3N1a",
      "3N1b"
    ],
    "difficulty": "3.1",
    "scenario_theme": "COOKING",
    "distractor_strategies": [
      "WRONG_OPERATION",
      "PLACE_VALUE_ERROR",
      "PARTIAL_CALCULATION"
    ],
    "generation_time_ms": 1,
    "api_version": "2.0",
    "enhancement_status": "partial",
    "format_requested": "DIRECT_CALCULATION",
    "format_used": "DIRECT_CALCULATION",
    "features_active": [
      "enhanced_distractors",
      "rich_scenarios",
      "cognitive_load",
      "advanced_formats"
    ],
    "features_pending": []
  },
  "context": {
    "id": "cooking-3-1759130032440",
    "theme": "COOKING",
    "setting": {
      "location": "kitchen",
      "timeContext": "weekend baking",
      "atmosphere": "creative"
    },
    "characters": [
      {
        "name": "Lucas",
        "role": "student"
      },
      {
        "name": "Mum",
        "role": "parent"
      }
    ],
    "items": [
      {
        "name": "flour",
        "category": "FOOD_ITEMS",
        "typicalValue": {
          "min": 1,
          "max": 5,
          "typical": 2.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "eggs",
        "category": "FOOD_ITEMS",
        "typicalValue": {
          "min": 1,
          "max": 5,
          "typical": 2.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "butter",
        "category": "FOOD_ITEMS",
        "typicalValue": {
          "min": 1,
          "max": 5,
          "typical": 2.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "sugar",
        "category": "FOOD_ITEMS",
        "typicalValue": {
          "min": 1,
          "max": 5,
          "typical": 2.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "milk",
        "category": "FOOD_ITEMS",
        "typicalValue": {
          "min": 1,
          "max": 5,
          "typical": 2.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "chocolate chips",
        "category": "FOOD_ITEMS",
        "typicalValue": {
          "min": 1,
          "max": 5,
          "typical": 2.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      }
    ],
    "culturalElements": [
      {
        "type": "currency",
        "value": "£",
        "explanation": "British pounds"
      },
      {
        "type": "measurement",
        "value": "grams",
        "explanation": "Weight measurement for ingredients"
      }
    ],
    "realWorldConnection": "Following recipes and calculating ingredient costs",
    "yearAppropriate": [
      3
    ],
    "templates": [
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "MULTI_STEP"
        ],
        "template": "{character} is making {recipe}. The ingredients cost {prices}. What is the total cost?",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "recipe",
            "type": "item"
          },
          {
            "key": "prices",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      }
    ]
  }
}
# Test E.3: SPORTS theme
{
  "success": true,
  "question": {
    "text": "The football costs £20. If Charlotte buys 2, how much will it cost?",
    "options": [
      {
        "text": "9",
        "value": 9,
        "index": 0
      },
      {
        "text": "£74.00",
        "value": 74,
        "index": 1
      },
      {
        "text": "84",
        "value": 84,
        "index": 2
      },
      {
        "text": "360",
        "value": 360,
        "index": 3
      }
    ],
    "correctIndex": 1,
    "format": "DIRECT_CALCULATION",
    "difficulty": {
      "year": 3,
      "subLevel": 1,
      "displayName": "3.1",
      "cognitiveLoad": 30
    },
    "cognitiveLoad": 30,
    "curriculumTags": [
      "3N1a",
      "3N1b"
    ],
    "scenario": {
      "id": "sports-3-1759130032492",
      "theme": "SPORTS",
      "setting": {
        "location": "school sports hall",
        "timeContext": "weekend",
        "atmosphere": "energetic"
      },
      "characters": [
        {
          "name": "Charlotte",
          "role": "student"
        },
        {
          "name": "Abigail",
          "role": "coach"
        }
      ],
      "items": [
        {
          "name": "football",
          "category": "SPORTS_EQUIPMENT",
          "typicalValue": {
            "min": 5,
            "max": 50,
            "typical": 20,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "tennis ball",
          "category": "SPORTS_EQUIPMENT",
          "typicalValue": {
            "min": 5,
            "max": 50,
            "typical": 20,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "cricket bat",
          "category": "SPORTS_EQUIPMENT",
          "typicalValue": {
            "min": 5,
            "max": 50,
            "typical": 20,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "rugby ball",
          "category": "SPORTS_EQUIPMENT",
          "typicalValue": {
            "min": 5,
            "max": 50,
            "typical": 20,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "basketball",
          "category": "SPORTS_EQUIPMENT",
          "typicalValue": {
            "min": 5,
            "max": 50,
            "typical": 20,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        }
      ],
      "culturalElements": [
        {
          "type": "currency",
          "value": "£",
          "explanation": "British pounds"
        }
      ],
      "realWorldConnection": "Calculating costs for sports activities",
      "yearAppropriate": [
        3
      ],
      "templates": [
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "MULTI_STEP"
          ],
          "template": "The {item} costs {price}. If {character} buys {quantity}, how much will it cost?",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "price",
              "type": "value"
            },
            {
              "key": "quantity",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        }
      ]
    },
    "distractors": [
      {
        "value": 9,
        "displayText": "9",
        "strategy": "WRONG_OPERATION",
        "reasoning": "Subtracted instead of adding"
      },
      {
        "value": 360,
        "displayText": "360",
        "strategy": "WRONG_OPERATION",
        "reasoning": "Multiplied instead of adding"
      },
      {
        "value": 84,
        "displayText": "84",
        "strategy": "PLACE_VALUE_ERROR",
        "reasoning": "Error in carrying to next column"
      }
    ],
    "enhancementStatus": {
      "level": "partial",
      "requestedFormat": "DIRECT_CALCULATION",
      "actualFormat": "DIRECT_CALCULATION",
      "featuresActive": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "featuresPending": [],
      "isFullyEnhanced": true
    },
    "mathOutput": {
      "operation": "ADDITION",
      "operand_1": 24,
      "operand_2": 15,
      "operand_3": 35,
      "result": 74
    },
    "generationTime": 1,
    "questionId": "q_1759130032492_urxgmb6ze",
    "generationSetup": {
      "controller_used": "DIRECT_CALCULATIONController",
      "format_requested": "DIRECT_CALCULATION",
      "format_actual": "DIRECT_CALCULATION",
      "scenario_theme": "SPORTS",
      "scenario_id": "sports-3-1759130032492",
      "scenario_selection_method": "requested",
      "distractor_strategies": [
        "WRONG_OPERATION",
        "WRONG_OPERATION",
        "PLACE_VALUE_ERROR"
      ],
      "distractor_count": 3,
      "theme_variety": false,
      "format_variety": false,
      "enhancement_level": "partial",
      "features_active": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "features_pending": [],
      "generation_time_ms": 1
    }
  },
  "metadata": {
    "format": "DIRECT_CALCULATION",
    "cognitive_load": 30,
    "curriculum_alignment": [
      "3N1a",
      "3N1b"
    ],
    "difficulty": "3.1",
    "scenario_theme": "SPORTS",
    "distractor_strategies": [
      "WRONG_OPERATION",
      "WRONG_OPERATION",
      "PLACE_VALUE_ERROR"
    ],
    "generation_time_ms": 1,
    "api_version": "2.0",
    "enhancement_status": "partial",
    "format_requested": "DIRECT_CALCULATION",
    "format_used": "DIRECT_CALCULATION",
    "features_active": [
      "enhanced_distractors",
      "rich_scenarios",
      "cognitive_load",
      "advanced_formats"
    ],
    "features_pending": []
  },
  "context": {
    "id": "sports-3-1759130032492",
    "theme": "SPORTS",
    "setting": {
      "location": "school sports hall",
      "timeContext": "weekend",
      "atmosphere": "energetic"
    },
    "characters": [
      {
        "name": "Charlotte",
        "role": "student"
      },
      {
        "name": "Abigail",
        "role": "coach"
      }
    ],
    "items": [
      {
        "name": "football",
        "category": "SPORTS_EQUIPMENT",
        "typicalValue": {
          "min": 5,
          "max": 50,
          "typical": 20,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "tennis ball",
        "category": "SPORTS_EQUIPMENT",
        "typicalValue": {
          "min": 5,
          "max": 50,
          "typical": 20,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "cricket bat",
        "category": "SPORTS_EQUIPMENT",
        "typicalValue": {
          "min": 5,
          "max": 50,
          "typical": 20,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "rugby ball",
        "category": "SPORTS_EQUIPMENT",
        "typicalValue": {
          "min": 5,
          "max": 50,
          "typical": 20,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "basketball",
        "category": "SPORTS_EQUIPMENT",
        "typicalValue": {
          "min": 5,
          "max": 50,
          "typical": 20,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      }
    ],
    "culturalElements": [
      {
        "type": "currency",
        "value": "£",
        "explanation": "British pounds"
      }
    ],
    "realWorldConnection": "Calculating costs for sports activities",
    "yearAppropriate": [
      3
    ],
    "templates": [
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "MULTI_STEP"
        ],
        "template": "The {item} costs {price}. If {character} buys {quantity}, how much will it cost?",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "price",
            "type": "value"
          },
          {
            "key": "quantity",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      }
    ]
  }
}
# Test E.4: SCHOOL theme
{
  "success": true,
  "question": {
    "text": "William needs to buy calculator, compass, protractor, highlighter for school. How much will it cost in total?",
    "options": [
      {
        "text": "168",
        "value": 168,
        "index": 0
      },
      {
        "text": "£37.00",
        "value": 37,
        "index": 1
      },
      {
        "text": "29",
        "value": 29,
        "index": 2
      },
      {
        "text": "47",
        "value": 47,
        "index": 3
      }
    ],
    "correctIndex": 1,
    "format": "DIRECT_CALCULATION",
    "difficulty": {
      "year": 3,
      "subLevel": 1,
      "displayName": "3.1",
      "cognitiveLoad": 30
    },
    "cognitiveLoad": 30,
    "curriculumTags": [
      "3N1a",
      "3N1b"
    ],
    "scenario": {
      "id": "school-3-1759130032618",
      "theme": "SCHOOL",
      "setting": {
        "location": "school stationery shop",
        "timeContext": "start of term",
        "atmosphere": "busy"
      },
      "characters": [
        {
          "name": "William",
          "role": "student"
        },
        {
          "name": "Mrs. Thompson",
          "role": "teacher"
        }
      ],
      "items": [
        {
          "name": "calculator",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.5,
            "max": 15,
            "typical": 3,
            "distribution": "skewed_low"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "compass",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.5,
            "max": 15,
            "typical": 3,
            "distribution": "skewed_low"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "protractor",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.5,
            "max": 15,
            "typical": 3,
            "distribution": "skewed_low"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "highlighter",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.5,
            "max": 15,
            "typical": 3,
            "distribution": "skewed_low"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        }
      ],
      "culturalElements": [
        {
          "type": "currency",
          "value": "£",
          "explanation": "British pounds"
        },
        {
          "type": "event",
          "value": "start of term",
          "explanation": "When students buy school supplies"
        }
      ],
      "realWorldConnection": "Budgeting for school supplies",
      "yearAppropriate": [
        3
      ],
      "templates": [
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "COMPARISON"
          ],
          "template": "{character} needs to buy {items} for school. How much will it cost in total?",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "items",
              "type": "item"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        }
      ]
    },
    "distractors": [
      {
        "value": 168,
        "displayText": "168",
        "strategy": "WRONG_OPERATION",
        "reasoning": "Multiplied instead of adding"
      },
      {
        "value": 47,
        "displayText": "47",
        "strategy": "PLACE_VALUE_ERROR",
        "reasoning": "Error in carrying to next column"
      },
      {
        "value": 29,
        "displayText": "29",
        "strategy": "PARTIAL_CALCULATION",
        "reasoning": "Stopped calculation early"
      }
    ],
    "enhancementStatus": {
      "level": "partial",
      "requestedFormat": "DIRECT_CALCULATION",
      "actualFormat": "DIRECT_CALCULATION",
      "featuresActive": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "featuresPending": [],
      "isFullyEnhanced": true
    },
    "mathOutput": {
      "operation": "ADDITION",
      "operand_1": 8,
      "operand_2": 21,
      "operand_3": 8,
      "result": 37
    },
    "generationTime": 1,
    "questionId": "q_1759130032619_htzdg9slq",
    "generationSetup": {
      "controller_used": "DIRECT_CALCULATIONController",
      "format_requested": "DIRECT_CALCULATION",
      "format_actual": "DIRECT_CALCULATION",
      "scenario_theme": "SCHOOL",
      "scenario_id": "school-3-1759130032618",
      "scenario_selection_method": "requested",
      "distractor_strategies": [
        "WRONG_OPERATION",
        "PLACE_VALUE_ERROR",
        "PARTIAL_CALCULATION"
      ],
      "distractor_count": 3,
      "theme_variety": false,
      "format_variety": false,
      "enhancement_level": "partial",
      "features_active": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "features_pending": [],
      "generation_time_ms": 1
    }
  },
  "metadata": {
    "format": "DIRECT_CALCULATION",
    "cognitive_load": 30,
    "curriculum_alignment": [
      "3N1a",
      "3N1b"
    ],
    "difficulty": "3.1",
    "scenario_theme": "SCHOOL",
    "distractor_strategies": [
      "WRONG_OPERATION",
      "PLACE_VALUE_ERROR",
      "PARTIAL_CALCULATION"
    ],
    "generation_time_ms": 1,
    "api_version": "2.0",
    "enhancement_status": "partial",
    "format_requested": "DIRECT_CALCULATION",
    "format_used": "DIRECT_CALCULATION",
    "features_active": [
      "enhanced_distractors",
      "rich_scenarios",
      "cognitive_load",
      "advanced_formats"
    ],
    "features_pending": []
  },
  "context": {
    "id": "school-3-1759130032618",
    "theme": "SCHOOL",
    "setting": {
      "location": "school stationery shop",
      "timeContext": "start of term",
      "atmosphere": "busy"
    },
    "characters": [
      {
        "name": "William",
        "role": "student"
      },
      {
        "name": "Mrs. Thompson",
        "role": "teacher"
      }
    ],
    "items": [
      {
        "name": "calculator",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.5,
          "max": 15,
          "typical": 3,
          "distribution": "skewed_low"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "compass",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.5,
          "max": 15,
          "typical": 3,
          "distribution": "skewed_low"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "protractor",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.5,
          "max": 15,
          "typical": 3,
          "distribution": "skewed_low"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "highlighter",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.5,
          "max": 15,
          "typical": 3,
          "distribution": "skewed_low"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      }
    ],
    "culturalElements": [
      {
        "type": "currency",
        "value": "£",
        "explanation": "British pounds"
      },
      {
        "type": "event",
        "value": "start of term",
        "explanation": "When students buy school supplies"
      }
    ],
    "realWorldConnection": "Budgeting for school supplies",
    "yearAppropriate": [
      3
    ],
    "templates": [
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "COMPARISON"
        ],
        "template": "{character} needs to buy {items} for school. How much will it cost in total?",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "items",
            "type": "item"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      }
    ]
  }
}
# Test E.5: POCKET_MONEY theme
{
  "success": true,
  "question": {
    "text": "What is 31 + 28 + 25?",
    "options": [
      {
        "text": "3",
        "value": 3,
        "index": 0
      },
      {
        "text": "£84.00",
        "value": 84,
        "index": 1
      },
      {
        "text": "868",
        "value": 868,
        "index": 2
      },
      {
        "text": "94",
        "value": 94,
        "index": 3
      }
    ],
    "correctIndex": 1,
    "format": "DIRECT_CALCULATION",
    "difficulty": {
      "year": 3,
      "subLevel": 1,
      "displayName": "3.1",
      "cognitiveLoad": 30
    },
    "cognitiveLoad": 30,
    "curriculumTags": [
      "3N1a",
      "3N1b"
    ],
    "scenario": {
      "id": "pocket-money-3-1759130032679",
      "theme": "POCKET_MONEY",
      "setting": {
        "location": "home",
        "timeContext": "weekly",
        "atmosphere": "planning"
      },
      "characters": [
        {
          "name": "Elizabeth",
          "role": "student"
        }
      ],
      "items": [
        {
          "name": "video game",
          "category": "SAVING_GOAL",
          "typicalValue": {
            "min": 12,
            "max": 40,
            "typical": 25,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "board game",
          "category": "SAVING_GOAL",
          "typicalValue": {
            "min": 12,
            "max": 40,
            "typical": 25,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "sports equipment",
          "category": "SAVING_GOAL",
          "typicalValue": {
            "min": 12,
            "max": 40,
            "typical": 25,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        }
      ],
      "culturalElements": [
        {
          "type": "currency",
          "value": "£",
          "explanation": "British pounds"
        },
        {
          "type": "custom",
          "value": "pocket money",
          "explanation": "Weekly allowance for children"
        }
      ],
      "realWorldConnection": "Learning to save and budget money",
      "yearAppropriate": [
        3
      ],
      "templates": [
        {
          "formatCompatibility": [
            "ESTIMATION",
            "MULTI_STEP"
          ],
          "template": "If {character} gets {amount} pocket money each week, how many weeks will it take to save for a {item} that costs {price}?",
          "answerTemplate": "It will take {result} weeks",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "amount",
              "type": "value"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "price",
              "type": "value"
            }
          ]
        }
      ]
    },
    "distractors": [
      {
        "value": 3,
        "displayText": "3",
        "strategy": "WRONG_OPERATION",
        "reasoning": "Subtracted instead of adding"
      },
      {
        "value": 868,
        "displayText": "868",
        "strategy": "WRONG_OPERATION",
        "reasoning": "Multiplied instead of adding"
      },
      {
        "value": 94,
        "displayText": "94",
        "strategy": "PLACE_VALUE_ERROR",
        "reasoning": "Error in carrying to next column"
      }
    ],
    "enhancementStatus": {
      "level": "partial",
      "requestedFormat": "DIRECT_CALCULATION",
      "actualFormat": "DIRECT_CALCULATION",
      "featuresActive": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "featuresPending": [],
      "isFullyEnhanced": true
    },
    "mathOutput": {
      "operation": "ADDITION",
      "operand_1": 31,
      "operand_2": 28,
      "operand_3": 25,
      "result": 84
    },
    "generationTime": 1,
    "questionId": "q_1759130032679_adxpw53ih",
    "generationSetup": {
      "controller_used": "DIRECT_CALCULATIONController",
      "format_requested": "DIRECT_CALCULATION",
      "format_actual": "DIRECT_CALCULATION",
      "scenario_theme": "POCKET_MONEY",
      "scenario_id": "pocket-money-3-1759130032679",
      "scenario_selection_method": "requested",
      "distractor_strategies": [
        "WRONG_OPERATION",
        "WRONG_OPERATION",
        "PLACE_VALUE_ERROR"
      ],
      "distractor_count": 3,
      "theme_variety": false,
      "format_variety": false,
      "enhancement_level": "partial",
      "features_active": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "features_pending": [],
      "generation_time_ms": 1
    }
  },
  "metadata": {
    "format": "DIRECT_CALCULATION",
    "cognitive_load": 30,
    "curriculum_alignment": [
      "3N1a",
      "3N1b"
    ],
    "difficulty": "3.1",
    "scenario_theme": "POCKET_MONEY",
    "distractor_strategies": [
      "WRONG_OPERATION",
      "WRONG_OPERATION",
      "PLACE_VALUE_ERROR"
    ],
    "generation_time_ms": 1,
    "api_version": "2.0",
    "enhancement_status": "partial",
    "format_requested": "DIRECT_CALCULATION",
    "format_used": "DIRECT_CALCULATION",
    "features_active": [
      "enhanced_distractors",
      "rich_scenarios",
      "cognitive_load",
      "advanced_formats"
    ],
    "features_pending": []
  },
  "context": {
    "id": "pocket-money-3-1759130032679",
    "theme": "POCKET_MONEY",
    "setting": {
      "location": "home",
      "timeContext": "weekly",
      "atmosphere": "planning"
    },
    "characters": [
      {
        "name": "Elizabeth",
        "role": "student"
      }
    ],
    "items": [
      {
        "name": "video game",
        "category": "SAVING_GOAL",
        "typicalValue": {
          "min": 12,
          "max": 40,
          "typical": 25,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "board game",
        "category": "SAVING_GOAL",
        "typicalValue": {
          "min": 12,
          "max": 40,
          "typical": 25,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "sports equipment",
        "category": "SAVING_GOAL",
        "typicalValue": {
          "min": 12,
          "max": 40,
          "typical": 25,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      }
    ],
    "culturalElements": [
      {
        "type": "currency",
        "value": "£",
        "explanation": "British pounds"
      },
      {
        "type": "custom",
        "value": "pocket money",
        "explanation": "Weekly allowance for children"
      }
    ],
    "realWorldConnection": "Learning to save and budget money",
    "yearAppropriate": [
      3
    ],
    "templates": [
      {
        "formatCompatibility": [
          "ESTIMATION",
          "MULTI_STEP"
        ],
        "template": "If {character} gets {amount} pocket money each week, how many weeks will it take to save for a {item} that costs {price}?",
        "answerTemplate": "It will take {result} weeks",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "amount",
            "type": "value"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "price",
            "type": "value"
          }
        ]
      }
    ]
  }
}
# Test E.6: NATURE theme
{
  "success": true,
  "question": {
    "text": "William collected flower, leaf, stone, stick, acorn, feather, shell, pine cone while exploring. How many items in total?",
    "options": [
      {
        "text": "13",
        "value": 13,
        "index": 0
      },
      {
        "text": "14",
        "value": 14,
        "index": 1
      },
      {
        "text": "24",
        "value": 24,
        "index": 2
      },
      {
        "text": "21",
        "value": 21,
        "index": 3
      }
    ],
    "correctIndex": 1,
    "format": "DIRECT_CALCULATION",
    "difficulty": {
      "year": 3,
      "subLevel": 1,
      "displayName": "3.1",
      "cognitiveLoad": 30
    },
    "cognitiveLoad": 30,
    "curriculumTags": [
      "3N1a",
      "3N1b"
    ],
    "scenario": {
      "id": "nature-3-1759130032801",
      "theme": "NATURE",
      "setting": {
        "location": "forest",
        "timeContext": "outdoor exploration",
        "atmosphere": "peaceful"
      },
      "characters": [
        {
          "name": "William",
          "role": "student"
        },
        {
          "name": "Mr. Green",
          "role": "park ranger"
        }
      ],
      "items": [
        {
          "name": "flower",
          "category": "NATURE_ITEMS",
          "typicalValue": {
            "min": 1,
            "max": 20,
            "typical": 5,
            "distribution": "normal"
          },
          "unit": "items",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "leaf",
          "category": "NATURE_ITEMS",
          "typicalValue": {
            "min": 1,
            "max": 20,
            "typical": 5,
            "distribution": "normal"
          },
          "unit": "items",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "stone",
          "category": "NATURE_ITEMS",
          "typicalValue": {
            "min": 1,
            "max": 20,
            "typical": 5,
            "distribution": "normal"
          },
          "unit": "items",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "stick",
          "category": "NATURE_ITEMS",
          "typicalValue": {
            "min": 1,
            "max": 20,
            "typical": 5,
            "distribution": "normal"
          },
          "unit": "items",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "acorn",
          "category": "NATURE_ITEMS",
          "typicalValue": {
            "min": 1,
            "max": 20,
            "typical": 5,
            "distribution": "normal"
          },
          "unit": "items",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "feather",
          "category": "NATURE_ITEMS",
          "typicalValue": {
            "min": 1,
            "max": 20,
            "typical": 5,
            "distribution": "normal"
          },
          "unit": "items",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "shell",
          "category": "NATURE_ITEMS",
          "typicalValue": {
            "min": 1,
            "max": 20,
            "typical": 5,
            "distribution": "normal"
          },
          "unit": "items",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "pine cone",
          "category": "NATURE_ITEMS",
          "typicalValue": {
            "min": 1,
            "max": 20,
            "typical": 5,
            "distribution": "normal"
          },
          "unit": "items",
          "attributes": {
            "quality": "standard"
          }
        }
      ],
      "culturalElements": [
        {
          "type": "location",
          "value": "UK countryside",
          "explanation": "British natural environments"
        }
      ],
      "realWorldConnection": "Counting and collecting in nature",
      "yearAppropriate": [
        3
      ],
      "templates": [
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "COMPARISON"
          ],
          "template": "{character} collected {items} while exploring. How many items in total?",
          "answerTemplate": "{character} collected {result} items",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "items",
              "type": "item"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        }
      ]
    },
    "distractors": [
      {
        "value": 21,
        "displayText": "21",
        "strategy": "WRONG_OPERATION",
        "reasoning": "Multiplied instead of adding"
      },
      {
        "value": 24,
        "displayText": "24",
        "strategy": "PLACE_VALUE_ERROR",
        "reasoning": "Error in carrying to next column"
      },
      {
        "value": 13,
        "displayText": "13",
        "strategy": "PLACE_VALUE_ERROR",
        "reasoning": "Forgot to carry"
      }
    ],
    "enhancementStatus": {
      "level": "partial",
      "requestedFormat": "DIRECT_CALCULATION",
      "actualFormat": "DIRECT_CALCULATION",
      "featuresActive": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "featuresPending": [],
      "isFullyEnhanced": true
    },
    "mathOutput": {
      "operation": "ADDITION",
      "operand_1": 3,
      "operand_2": 7,
      "operand_3": 4,
      "result": 14
    },
    "generationTime": 1,
    "questionId": "q_1759130032801_yvtvxkmbp",
    "generationSetup": {
      "controller_used": "DIRECT_CALCULATIONController",
      "format_requested": "DIRECT_CALCULATION",
      "format_actual": "DIRECT_CALCULATION",
      "scenario_theme": "NATURE",
      "scenario_id": "nature-3-1759130032801",
      "scenario_selection_method": "requested",
      "distractor_strategies": [
        "WRONG_OPERATION",
        "PLACE_VALUE_ERROR",
        "PLACE_VALUE_ERROR"
      ],
      "distractor_count": 3,
      "theme_variety": false,
      "format_variety": false,
      "enhancement_level": "partial",
      "features_active": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "features_pending": [],
      "generation_time_ms": 1
    }
  },
  "metadata": {
    "format": "DIRECT_CALCULATION",
    "cognitive_load": 30,
    "curriculum_alignment": [
      "3N1a",
      "3N1b"
    ],
    "difficulty": "3.1",
    "scenario_theme": "NATURE",
    "distractor_strategies": [
      "WRONG_OPERATION",
      "PLACE_VALUE_ERROR",
      "PLACE_VALUE_ERROR"
    ],
    "generation_time_ms": 1,
    "api_version": "2.0",
    "enhancement_status": "partial",
    "format_requested": "DIRECT_CALCULATION",
    "format_used": "DIRECT_CALCULATION",
    "features_active": [
      "enhanced_distractors",
      "rich_scenarios",
      "cognitive_load",
      "advanced_formats"
    ],
    "features_pending": []
  },
  "context": {
    "id": "nature-3-1759130032801",
    "theme": "NATURE",
    "setting": {
      "location": "forest",
      "timeContext": "outdoor exploration",
      "atmosphere": "peaceful"
    },
    "characters": [
      {
        "name": "William",
        "role": "student"
      },
      {
        "name": "Mr. Green",
        "role": "park ranger"
      }
    ],
    "items": [
      {
        "name": "flower",
        "category": "NATURE_ITEMS",
        "typicalValue": {
          "min": 1,
          "max": 20,
          "typical": 5,
          "distribution": "normal"
        },
        "unit": "items",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "leaf",
        "category": "NATURE_ITEMS",
        "typicalValue": {
          "min": 1,
          "max": 20,
          "typical": 5,
          "distribution": "normal"
        },
        "unit": "items",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "stone",
        "category": "NATURE_ITEMS",
        "typicalValue": {
          "min": 1,
          "max": 20,
          "typical": 5,
          "distribution": "normal"
        },
        "unit": "items",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "stick",
        "category": "NATURE_ITEMS",
        "typicalValue": {
          "min": 1,
          "max": 20,
          "typical": 5,
          "distribution": "normal"
        },
        "unit": "items",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "acorn",
        "category": "NATURE_ITEMS",
        "typicalValue": {
          "min": 1,
          "max": 20,
          "typical": 5,
          "distribution": "normal"
        },
        "unit": "items",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "feather",
        "category": "NATURE_ITEMS",
        "typicalValue": {
          "min": 1,
          "max": 20,
          "typical": 5,
          "distribution": "normal"
        },
        "unit": "items",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "shell",
        "category": "NATURE_ITEMS",
        "typicalValue": {
          "min": 1,
          "max": 20,
          "typical": 5,
          "distribution": "normal"
        },
        "unit": "items",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "pine cone",
        "category": "NATURE_ITEMS",
        "typicalValue": {
          "min": 1,
          "max": 20,
          "typical": 5,
          "distribution": "normal"
        },
        "unit": "items",
        "attributes": {
          "quality": "standard"
        }
      }
    ],
    "culturalElements": [
      {
        "type": "location",
        "value": "UK countryside",
        "explanation": "British natural environments"
      }
    ],
    "realWorldConnection": "Counting and collecting in nature",
    "yearAppropriate": [
      3
    ],
    "templates": [
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "COMPARISON"
        ],
        "template": "{character} collected {items} while exploring. How many items in total?",
        "answerTemplate": "{character} collected {result} items",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "items",
            "type": "item"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      }
    ]
  }
}
# Test E.7: TRANSPORT theme
{
  "success": true,
  "question": {
    "text": "A {transport} journey costs £35. How much for 6 journeys?",
    "options": [
      {
        "text": "62",
        "value": 62,
        "index": 0
      },
      {
        "text": "£52.00",
        "value": 52,
        "index": 1
      },
      {
        "text": "29",
        "value": 29,
        "index": 2
      },
      {
        "text": "210",
        "value": 210,
        "index": 3
      }
    ],
    "correctIndex": 1,
    "format": "DIRECT_CALCULATION",
    "difficulty": {
      "year": 3,
      "subLevel": 1,
      "displayName": "3.1",
      "cognitiveLoad": 30
    },
    "cognitiveLoad": 30,
    "curriculumTags": [
      "3N1a",
      "3N1b"
    ],
    "scenario": {
      "id": "transport-3-1759130032844",
      "theme": "TRANSPORT",
      "setting": {
        "location": "transport hub",
        "timeContext": "journey planning",
        "atmosphere": "busy"
      },
      "characters": [
        {
          "name": "Elizabeth",
          "role": "passenger"
        },
        {
          "name": "Mrs. Driver",
          "role": "transport operator"
        }
      ],
      "items": [
        {
          "name": "bus",
          "category": "TRANSPORT",
          "typicalValue": {
            "min": 1.5,
            "max": 15,
            "typical": 5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "train",
          "category": "TRANSPORT",
          "typicalValue": {
            "min": 1.5,
            "max": 15,
            "typical": 5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "taxi",
          "category": "TRANSPORT",
          "typicalValue": {
            "min": 1.5,
            "max": 15,
            "typical": 5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "tube",
          "category": "TRANSPORT",
          "typicalValue": {
            "min": 1.5,
            "max": 15,
            "typical": 5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "bike",
          "category": "TRANSPORT",
          "typicalValue": {
            "min": 1.5,
            "max": 15,
            "typical": 5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        }
      ],
      "culturalElements": [
        {
          "type": "currency",
          "value": "£",
          "explanation": "British pounds for transport fares"
        }
      ],
      "realWorldConnection": "Calculating travel costs and distances",
      "yearAppropriate": [
        3
      ],
      "templates": [
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "MULTI_STEP"
          ],
          "template": "A {transport} journey costs {price}. How much for {quantity} journeys?",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "transport",
              "type": "item"
            },
            {
              "key": "price",
              "type": "value"
            },
            {
              "key": "quantity",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        }
      ]
    },
    "distractors": [
      {
        "value": 29,
        "displayText": "29",
        "strategy": "WRONG_OPERATION",
        "reasoning": "Subtracted instead of adding"
      },
      {
        "value": 210,
        "displayText": "210",
        "strategy": "WRONG_OPERATION",
        "reasoning": "Multiplied instead of adding"
      },
      {
        "value": 62,
        "displayText": "62",
        "strategy": "PLACE_VALUE_ERROR",
        "reasoning": "Error in carrying to next column"
      }
    ],
    "enhancementStatus": {
      "level": "partial",
      "requestedFormat": "DIRECT_CALCULATION",
      "actualFormat": "DIRECT_CALCULATION",
      "featuresActive": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "featuresPending": [],
      "isFullyEnhanced": true
    },
    "mathOutput": {
      "operation": "ADDITION",
      "operand_1": 35,
      "operand_2": 6,
      "operand_3": 11,
      "result": 52
    },
    "generationTime": 1,
    "questionId": "q_1759130032845_8my3i71e1",
    "generationSetup": {
      "controller_used": "DIRECT_CALCULATIONController",
      "format_requested": "DIRECT_CALCULATION",
      "format_actual": "DIRECT_CALCULATION",
      "scenario_theme": "TRANSPORT",
      "scenario_id": "transport-3-1759130032844",
      "scenario_selection_method": "requested",
      "distractor_strategies": [
        "WRONG_OPERATION",
        "WRONG_OPERATION",
        "PLACE_VALUE_ERROR"
      ],
      "distractor_count": 3,
      "theme_variety": false,
      "format_variety": false,
      "enhancement_level": "partial",
      "features_active": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "features_pending": [],
      "generation_time_ms": 1
    }
  },
  "metadata": {
    "format": "DIRECT_CALCULATION",
    "cognitive_load": 30,
    "curriculum_alignment": [
      "3N1a",
      "3N1b"
    ],
    "difficulty": "3.1",
    "scenario_theme": "TRANSPORT",
    "distractor_strategies": [
      "WRONG_OPERATION",
      "WRONG_OPERATION",
      "PLACE_VALUE_ERROR"
    ],
    "generation_time_ms": 1,
    "api_version": "2.0",
    "enhancement_status": "partial",
    "format_requested": "DIRECT_CALCULATION",
    "format_used": "DIRECT_CALCULATION",
    "features_active": [
      "enhanced_distractors",
      "rich_scenarios",
      "cognitive_load",
      "advanced_formats"
    ],
    "features_pending": []
  },
  "context": {
    "id": "transport-3-1759130032844",
    "theme": "TRANSPORT",
    "setting": {
      "location": "transport hub",
      "timeContext": "journey planning",
      "atmosphere": "busy"
    },
    "characters": [
      {
        "name": "Elizabeth",
        "role": "passenger"
      },
      {
        "name": "Mrs. Driver",
        "role": "transport operator"
      }
    ],
    "items": [
      {
        "name": "bus",
        "category": "TRANSPORT",
        "typicalValue": {
          "min": 1.5,
          "max": 15,
          "typical": 5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "train",
        "category": "TRANSPORT",
        "typicalValue": {
          "min": 1.5,
          "max": 15,
          "typical": 5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "taxi",
        "category": "TRANSPORT",
        "typicalValue": {
          "min": 1.5,
          "max": 15,
          "typical": 5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "tube",
        "category": "TRANSPORT",
        "typicalValue": {
          "min": 1.5,
          "max": 15,
          "typical": 5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "bike",
        "category": "TRANSPORT",
        "typicalValue": {
          "min": 1.5,
          "max": 15,
          "typical": 5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      }
    ],
    "culturalElements": [
      {
        "type": "currency",
        "value": "£",
        "explanation": "British pounds for transport fares"
      }
    ],
    "realWorldConnection": "Calculating travel costs and distances",
    "yearAppropriate": [
      3
    ],
    "templates": [
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "MULTI_STEP"
        ],
        "template": "A {transport} journey costs {price}. How much for {quantity} journeys?",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "transport",
            "type": "item"
          },
          {
            "key": "price",
            "type": "value"
          },
          {
            "key": "quantity",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      }
    ]
  }
}
# Test E.8: COLLECTIONS theme
{
  "success": true,
  "question": {
    "text": "Daniel has sticker, card, coin, stamp, badge, marble, button in their collection. How many altogether?",
    "options": [
      {
        "text": "52",
        "value": 52,
        "index": 0
      },
      {
        "text": "576",
        "value": 576,
        "index": 1
      },
      {
        "text": "79",
        "value": 79,
        "index": 2
      },
      {
        "text": "89",
        "value": 89,
        "index": 3
      }
    ],
    "correctIndex": 2,
    "format": "DIRECT_CALCULATION",
    "difficulty": {
      "year": 3,
      "subLevel": 1,
      "displayName": "3.1",
      "cognitiveLoad": 30
    },
    "cognitiveLoad": 30,
    "curriculumTags": [
      "3N1a",
      "3N1b"
    ],
    "scenario": {
      "id": "collections-3-1759130032895",
      "theme": "COLLECTIONS",
      "setting": {
        "location": "bedroom",
        "timeContext": "organizing collection",
        "atmosphere": "focused"
      },
      "characters": [
        {
          "name": "Daniel",
          "role": "collector"
        },
        {
          "name": "William",
          "role": "friend"
        }
      ],
      "items": [
        {
          "name": "sticker",
          "category": "COLLECTIBLES",
          "typicalValue": {
            "min": 1,
            "max": 50,
            "typical": 10,
            "distribution": "normal"
          },
          "unit": "items",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "card",
          "category": "COLLECTIBLES",
          "typicalValue": {
            "min": 1,
            "max": 50,
            "typical": 10,
            "distribution": "normal"
          },
          "unit": "items",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "coin",
          "category": "COLLECTIBLES",
          "typicalValue": {
            "min": 1,
            "max": 50,
            "typical": 10,
            "distribution": "normal"
          },
          "unit": "items",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "stamp",
          "category": "COLLECTIBLES",
          "typicalValue": {
            "min": 1,
            "max": 50,
            "typical": 10,
            "distribution": "normal"
          },
          "unit": "items",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "badge",
          "category": "COLLECTIBLES",
          "typicalValue": {
            "min": 1,
            "max": 50,
            "typical": 10,
            "distribution": "normal"
          },
          "unit": "items",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "marble",
          "category": "COLLECTIBLES",
          "typicalValue": {
            "min": 1,
            "max": 50,
            "typical": 10,
            "distribution": "normal"
          },
          "unit": "items",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "button",
          "category": "COLLECTIBLES",
          "typicalValue": {
            "min": 1,
            "max": 50,
            "typical": 10,
            "distribution": "normal"
          },
          "unit": "items",
          "attributes": {
            "quality": "standard"
          }
        }
      ],
      "culturalElements": [
        {
          "type": "hobby",
          "value": "collecting",
          "explanation": "Popular childhood hobby"
        }
      ],
      "realWorldConnection": "Organizing and counting collections",
      "yearAppropriate": [
        3
      ],
      "templates": [
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "ORDERING"
          ],
          "template": "{character} has {items} in their collection. How many altogether?",
          "answerTemplate": "{character} has {result} items total",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "items",
              "type": "item"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        }
      ]
    },
    "distractors": [
      {
        "value": 576,
        "displayText": "576",
        "strategy": "WRONG_OPERATION",
        "reasoning": "Multiplied instead of adding"
      },
      {
        "value": 89,
        "displayText": "89",
        "strategy": "PLACE_VALUE_ERROR",
        "reasoning": "Error in carrying to next column"
      },
      {
        "value": 52,
        "displayText": "52",
        "strategy": "PARTIAL_CALCULATION",
        "reasoning": "Stopped calculation early"
      }
    ],
    "enhancementStatus": {
      "level": "partial",
      "requestedFormat": "DIRECT_CALCULATION",
      "actualFormat": "DIRECT_CALCULATION",
      "featuresActive": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "featuresPending": [],
      "isFullyEnhanced": true
    },
    "mathOutput": {
      "operation": "ADDITION",
      "operand_1": 16,
      "operand_2": 36,
      "operand_3": 27,
      "result": 79
    },
    "generationTime": 0,
    "questionId": "q_1759130032895_zoq20eotd",
    "generationSetup": {
      "controller_used": "DIRECT_CALCULATIONController",
      "format_requested": "DIRECT_CALCULATION",
      "format_actual": "DIRECT_CALCULATION",
      "scenario_theme": "COLLECTIONS",
      "scenario_id": "collections-3-1759130032895",
      "scenario_selection_method": "requested",
      "distractor_strategies": [
        "WRONG_OPERATION",
        "PLACE_VALUE_ERROR",
        "PARTIAL_CALCULATION"
      ],
      "distractor_count": 3,
      "theme_variety": false,
      "format_variety": false,
      "enhancement_level": "partial",
      "features_active": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "features_pending": [],
      "generation_time_ms": 0
    }
  },
  "metadata": {
    "format": "DIRECT_CALCULATION",
    "cognitive_load": 30,
    "curriculum_alignment": [
      "3N1a",
      "3N1b"
    ],
    "difficulty": "3.1",
    "scenario_theme": "COLLECTIONS",
    "distractor_strategies": [
      "WRONG_OPERATION",
      "PLACE_VALUE_ERROR",
      "PARTIAL_CALCULATION"
    ],
    "generation_time_ms": 0,
    "api_version": "2.0",
    "enhancement_status": "partial",
    "format_requested": "DIRECT_CALCULATION",
    "format_used": "DIRECT_CALCULATION",
    "features_active": [
      "enhanced_distractors",
      "rich_scenarios",
      "cognitive_load",
      "advanced_formats"
    ],
    "features_pending": []
  },
  "context": {
    "id": "collections-3-1759130032895",
    "theme": "COLLECTIONS",
    "setting": {
      "location": "bedroom",
      "timeContext": "organizing collection",
      "atmosphere": "focused"
    },
    "characters": [
      {
        "name": "Daniel",
        "role": "collector"
      },
      {
        "name": "William",
        "role": "friend"
      }
    ],
    "items": [
      {
        "name": "sticker",
        "category": "COLLECTIBLES",
        "typicalValue": {
          "min": 1,
          "max": 50,
          "typical": 10,
          "distribution": "normal"
        },
        "unit": "items",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "card",
        "category": "COLLECTIBLES",
        "typicalValue": {
          "min": 1,
          "max": 50,
          "typical": 10,
          "distribution": "normal"
        },
        "unit": "items",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "coin",
        "category": "COLLECTIBLES",
        "typicalValue": {
          "min": 1,
          "max": 50,
          "typical": 10,
          "distribution": "normal"
        },
        "unit": "items",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "stamp",
        "category": "COLLECTIBLES",
        "typicalValue": {
          "min": 1,
          "max": 50,
          "typical": 10,
          "distribution": "normal"
        },
        "unit": "items",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "badge",
        "category": "COLLECTIBLES",
        "typicalValue": {
          "min": 1,
          "max": 50,
          "typical": 10,
          "distribution": "normal"
        },
        "unit": "items",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "marble",
        "category": "COLLECTIBLES",
        "typicalValue": {
          "min": 1,
          "max": 50,
          "typical": 10,
          "distribution": "normal"
        },
        "unit": "items",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "button",
        "category": "COLLECTIBLES",
        "typicalValue": {
          "min": 1,
          "max": 50,
          "typical": 10,
          "distribution": "normal"
        },
        "unit": "items",
        "attributes": {
          "quality": "standard"
        }
      }
    ],
    "culturalElements": [
      {
        "type": "hobby",
        "value": "collecting",
        "explanation": "Popular childhood hobby"
      }
    ],
    "realWorldConnection": "Organizing and counting collections",
    "yearAppropriate": [
      3
    ],
    "templates": [
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "ORDERING"
        ],
        "template": "{character} has {items} in their collection. How many altogether?",
        "answerTemplate": "{character} has {result} items total",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "items",
            "type": "item"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      }
    ]
  }
}
# Test E.9: HOUSEHOLD theme
{
  "success": true,
  "question": {
    "text": "Mia needs to tidy cup, plate, spoon, towel, pillow, book, toy, sock. How many items to put away?",
    "options": [
      {
        "text": "858",
        "value": 858,
        "index": 0
      },
      {
        "text": "62",
        "value": 62,
        "index": 1
      },
      {
        "text": "72",
        "value": 72,
        "index": 2
      }
    ],
    "correctIndex": 1,
    "format": "DIRECT_CALCULATION",
    "difficulty": {
      "year": 3,
      "subLevel": 1,
      "displayName": "3.1",
      "cognitiveLoad": 30
    },
    "cognitiveLoad": 30,
    "curriculumTags": [
      "3N1a",
      "3N1b"
    ],
    "scenario": {
      "id": "household-3-1759130032943",
      "theme": "HOUSEHOLD",
      "setting": {
        "location": "living room",
        "timeContext": "tidying up",
        "atmosphere": "homely"
      },
      "characters": [
        {
          "name": "Mia",
          "role": "child"
        },
        {
          "name": "Mum",
          "role": "parent"
        }
      ],
      "items": [
        {
          "name": "cup",
          "category": "HOUSEHOLD_ITEMS",
          "typicalValue": {
            "min": 1,
            "max": 30,
            "typical": 8,
            "distribution": "normal"
          },
          "unit": "items",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "plate",
          "category": "HOUSEHOLD_ITEMS",
          "typicalValue": {
            "min": 1,
            "max": 30,
            "typical": 8,
            "distribution": "normal"
          },
          "unit": "items",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "spoon",
          "category": "HOUSEHOLD_ITEMS",
          "typicalValue": {
            "min": 1,
            "max": 30,
            "typical": 8,
            "distribution": "normal"
          },
          "unit": "items",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "towel",
          "category": "HOUSEHOLD_ITEMS",
          "typicalValue": {
            "min": 1,
            "max": 30,
            "typical": 8,
            "distribution": "normal"
          },
          "unit": "items",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "pillow",
          "category": "HOUSEHOLD_ITEMS",
          "typicalValue": {
            "min": 1,
            "max": 30,
            "typical": 8,
            "distribution": "normal"
          },
          "unit": "items",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "book",
          "category": "HOUSEHOLD_ITEMS",
          "typicalValue": {
            "min": 1,
            "max": 30,
            "typical": 8,
            "distribution": "normal"
          },
          "unit": "items",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "toy",
          "category": "HOUSEHOLD_ITEMS",
          "typicalValue": {
            "min": 1,
            "max": 30,
            "typical": 8,
            "distribution": "normal"
          },
          "unit": "items",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "sock",
          "category": "HOUSEHOLD_ITEMS",
          "typicalValue": {
            "min": 1,
            "max": 30,
            "typical": 8,
            "distribution": "normal"
          },
          "unit": "items",
          "attributes": {
            "quality": "standard"
          }
        }
      ],
      "culturalElements": [
        {
          "type": "custom",
          "value": "household chores",
          "explanation": "Daily home activities"
        }
      ],
      "realWorldConnection": "Organizing and counting household items",
      "yearAppropriate": [
        3
      ],
      "templates": [
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "COMPARISON"
          ],
          "template": "{character} needs to tidy {items}. How many items to put away?",
          "answerTemplate": "{character} needs to put away {result} items",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "items",
              "type": "item"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        }
      ]
    },
    "distractors": [
      {
        "value": 858,
        "displayText": "858",
        "strategy": "WRONG_OPERATION",
        "reasoning": "Multiplied instead of adding"
      },
      {
        "value": 72,
        "displayText": "72",
        "strategy": "PLACE_VALUE_ERROR",
        "reasoning": "Error in carrying to next column"
      }
    ],
    "enhancementStatus": {
      "level": "partial",
      "requestedFormat": "DIRECT_CALCULATION",
      "actualFormat": "DIRECT_CALCULATION",
      "featuresActive": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "featuresPending": [],
      "isFullyEnhanced": true
    },
    "mathOutput": {
      "operation": "ADDITION",
      "operand_1": 22,
      "operand_2": 39,
      "operand_3": 1,
      "result": 62
    },
    "generationTime": 0,
    "questionId": "q_1759130032943_sxkws34yw",
    "generationSetup": {
      "controller_used": "DIRECT_CALCULATIONController",
      "format_requested": "DIRECT_CALCULATION",
      "format_actual": "DIRECT_CALCULATION",
      "scenario_theme": "HOUSEHOLD",
      "scenario_id": "household-3-1759130032943",
      "scenario_selection_method": "requested",
      "distractor_strategies": [
        "WRONG_OPERATION",
        "PLACE_VALUE_ERROR"
      ],
      "distractor_count": 2,
      "theme_variety": false,
      "format_variety": false,
      "enhancement_level": "partial",
      "features_active": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "features_pending": [],
      "generation_time_ms": 0
    }
  },
  "metadata": {
    "format": "DIRECT_CALCULATION",
    "cognitive_load": 30,
    "curriculum_alignment": [
      "3N1a",
      "3N1b"
    ],
    "difficulty": "3.1",
    "scenario_theme": "HOUSEHOLD",
    "distractor_strategies": [
      "WRONG_OPERATION",
      "PLACE_VALUE_ERROR"
    ],
    "generation_time_ms": 0,
    "api_version": "2.0",
    "enhancement_status": "partial",
    "format_requested": "DIRECT_CALCULATION",
    "format_used": "DIRECT_CALCULATION",
    "features_active": [
      "enhanced_distractors",
      "rich_scenarios",
      "cognitive_load",
      "advanced_formats"
    ],
    "features_pending": []
  },
  "context": {
    "id": "household-3-1759130032943",
    "theme": "HOUSEHOLD",
    "setting": {
      "location": "living room",
      "timeContext": "tidying up",
      "atmosphere": "homely"
    },
    "characters": [
      {
        "name": "Mia",
        "role": "child"
      },
      {
        "name": "Mum",
        "role": "parent"
      }
    ],
    "items": [
      {
        "name": "cup",
        "category": "HOUSEHOLD_ITEMS",
        "typicalValue": {
          "min": 1,
          "max": 30,
          "typical": 8,
          "distribution": "normal"
        },
        "unit": "items",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "plate",
        "category": "HOUSEHOLD_ITEMS",
        "typicalValue": {
          "min": 1,
          "max": 30,
          "typical": 8,
          "distribution": "normal"
        },
        "unit": "items",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "spoon",
        "category": "HOUSEHOLD_ITEMS",
        "typicalValue": {
          "min": 1,
          "max": 30,
          "typical": 8,
          "distribution": "normal"
        },
        "unit": "items",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "towel",
        "category": "HOUSEHOLD_ITEMS",
        "typicalValue": {
          "min": 1,
          "max": 30,
          "typical": 8,
          "distribution": "normal"
        },
        "unit": "items",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "pillow",
        "category": "HOUSEHOLD_ITEMS",
        "typicalValue": {
          "min": 1,
          "max": 30,
          "typical": 8,
          "distribution": "normal"
        },
        "unit": "items",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "book",
        "category": "HOUSEHOLD_ITEMS",
        "typicalValue": {
          "min": 1,
          "max": 30,
          "typical": 8,
          "distribution": "normal"
        },
        "unit": "items",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "toy",
        "category": "HOUSEHOLD_ITEMS",
        "typicalValue": {
          "min": 1,
          "max": 30,
          "typical": 8,
          "distribution": "normal"
        },
        "unit": "items",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "sock",
        "category": "HOUSEHOLD_ITEMS",
        "typicalValue": {
          "min": 1,
          "max": 30,
          "typical": 8,
          "distribution": "normal"
        },
        "unit": "items",
        "attributes": {
          "quality": "standard"
        }
      }
    ],
    "culturalElements": [
      {
        "type": "custom",
        "value": "household chores",
        "explanation": "Daily home activities"
      }
    ],
    "realWorldConnection": "Organizing and counting household items",
    "yearAppropriate": [
      3
    ],
    "templates": [
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "COMPARISON"
        ],
        "template": "{character} needs to tidy {items}. How many items to put away?",
        "answerTemplate": "{character} needs to put away {result} items",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "items",
            "type": "item"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      }
    ]
  }
}
# Test E.10: CELEBRATIONS theme
{
  "success": true,
  "question": {
    "text": "Alexander is planning a {celebration}. The supplies cost £12.00, £12.00. What is the total?",
    "options": [
      {
        "text": "70",
        "value": 70,
        "index": 0
      },
      {
        "text": "144",
        "value": 144,
        "index": 1
      },
      {
        "text": "24",
        "value": 24,
        "index": 2
      },
      {
        "text": "£60.00",
        "value": 60,
        "index": 3
      }
    ],
    "correctIndex": 3,
    "format": "DIRECT_CALCULATION",
    "difficulty": {
      "year": 3,
      "subLevel": 1,
      "displayName": "3.1",
      "cognitiveLoad": 30
    },
    "cognitiveLoad": 30,
    "curriculumTags": [
      "3N1a",
      "3N1b"
    ],
    "scenario": {
      "id": "celebrations-3-1759130032984",
      "theme": "CELEBRATIONS",
      "setting": {
        "location": "party venue",
        "timeContext": "celebration planning",
        "atmosphere": "festive"
      },
      "characters": [
        {
          "name": "Alexander",
          "role": "party organizer"
        },
        {
          "name": "Olivia",
          "role": "guest"
        }
      ],
      "items": [
        {
          "name": "balloon",
          "category": "PARTY_SUPPLIES",
          "typicalValue": {
            "min": 0.5,
            "max": 20,
            "typical": 5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "cake",
          "category": "PARTY_SUPPLIES",
          "typicalValue": {
            "min": 0.5,
            "max": 20,
            "typical": 5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "present",
          "category": "PARTY_SUPPLIES",
          "typicalValue": {
            "min": 0.5,
            "max": 20,
            "typical": 5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "decoration",
          "category": "PARTY_SUPPLIES",
          "typicalValue": {
            "min": 0.5,
            "max": 20,
            "typical": 5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "party hat",
          "category": "PARTY_SUPPLIES",
          "typicalValue": {
            "min": 0.5,
            "max": 20,
            "typical": 5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "candle",
          "category": "PARTY_SUPPLIES",
          "typicalValue": {
            "min": 0.5,
            "max": 20,
            "typical": 5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        }
      ],
      "culturalElements": [
        {
          "type": "currency",
          "value": "£",
          "explanation": "British pounds for party supplies"
        },
        {
          "type": "event",
          "value": "celebration",
          "explanation": "Special occasions and festivals"
        }
      ],
      "realWorldConnection": "Planning and budgeting for celebrations",
      "yearAppropriate": [
        3
      ],
      "templates": [
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "MULTI_STEP"
          ],
          "template": "{character} is planning a {celebration}. The supplies cost {prices}. What is the total?",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "celebration",
              "type": "event"
            },
            {
              "key": "prices",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        }
      ]
    },
    "distractors": [
      {
        "value": 144,
        "displayText": "144",
        "strategy": "WRONG_OPERATION",
        "reasoning": "Multiplied instead of adding"
      },
      {
        "value": 70,
        "displayText": "70",
        "strategy": "PLACE_VALUE_ERROR",
        "reasoning": "Error in carrying to next column"
      },
      {
        "value": 24,
        "displayText": "24",
        "strategy": "PARTIAL_CALCULATION",
        "reasoning": "Stopped calculation early"
      }
    ],
    "enhancementStatus": {
      "level": "partial",
      "requestedFormat": "DIRECT_CALCULATION",
      "actualFormat": "DIRECT_CALCULATION",
      "featuresActive": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "featuresPending": [],
      "isFullyEnhanced": true
    },
    "mathOutput": {
      "operation": "ADDITION",
      "operand_1": 12,
      "operand_2": 12,
      "operand_3": 36,
      "result": 60
    },
    "generationTime": 1,
    "questionId": "q_1759130032984_vobzayfme",
    "generationSetup": {
      "controller_used": "DIRECT_CALCULATIONController",
      "format_requested": "DIRECT_CALCULATION",
      "format_actual": "DIRECT_CALCULATION",
      "scenario_theme": "CELEBRATIONS",
      "scenario_id": "celebrations-3-1759130032984",
      "scenario_selection_method": "requested",
      "distractor_strategies": [
        "WRONG_OPERATION",
        "PLACE_VALUE_ERROR",
        "PARTIAL_CALCULATION"
      ],
      "distractor_count": 3,
      "theme_variety": false,
      "format_variety": false,
      "enhancement_level": "partial",
      "features_active": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "features_pending": [],
      "generation_time_ms": 1
    }
  },
  "metadata": {
    "format": "DIRECT_CALCULATION",
    "cognitive_load": 30,
    "curriculum_alignment": [
      "3N1a",
      "3N1b"
    ],
    "difficulty": "3.1",
    "scenario_theme": "CELEBRATIONS",
    "distractor_strategies": [
      "WRONG_OPERATION",
      "PLACE_VALUE_ERROR",
      "PARTIAL_CALCULATION"
    ],
    "generation_time_ms": 1,
    "api_version": "2.0",
    "enhancement_status": "partial",
    "format_requested": "DIRECT_CALCULATION",
    "format_used": "DIRECT_CALCULATION",
    "features_active": [
      "enhanced_distractors",
      "rich_scenarios",
      "cognitive_load",
      "advanced_formats"
    ],
    "features_pending": []
  },
  "context": {
    "id": "celebrations-3-1759130032984",
    "theme": "CELEBRATIONS",
    "setting": {
      "location": "party venue",
      "timeContext": "celebration planning",
      "atmosphere": "festive"
    },
    "characters": [
      {
        "name": "Alexander",
        "role": "party organizer"
      },
      {
        "name": "Olivia",
        "role": "guest"
      }
    ],
    "items": [
      {
        "name": "balloon",
        "category": "PARTY_SUPPLIES",
        "typicalValue": {
          "min": 0.5,
          "max": 20,
          "typical": 5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "cake",
        "category": "PARTY_SUPPLIES",
        "typicalValue": {
          "min": 0.5,
          "max": 20,
          "typical": 5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "present",
        "category": "PARTY_SUPPLIES",
        "typicalValue": {
          "min": 0.5,
          "max": 20,
          "typical": 5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "decoration",
        "category": "PARTY_SUPPLIES",
        "typicalValue": {
          "min": 0.5,
          "max": 20,
          "typical": 5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "party hat",
        "category": "PARTY_SUPPLIES",
        "typicalValue": {
          "min": 0.5,
          "max": 20,
          "typical": 5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "candle",
        "category": "PARTY_SUPPLIES",
        "typicalValue": {
          "min": 0.5,
          "max": 20,
          "typical": 5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      }
    ],
    "culturalElements": [
      {
        "type": "currency",
        "value": "£",
        "explanation": "British pounds for party supplies"
      },
      {
        "type": "event",
        "value": "celebration",
        "explanation": "Special occasions and festivals"
      }
    ],
    "realWorldConnection": "Planning and budgeting for celebrations",
    "yearAppropriate": [
      3
    ],
    "templates": [
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "MULTI_STEP"
        ],
        "template": "{character} is planning a {celebration}. The supplies cost {prices}. What is the total?",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "celebration",
            "type": "event"
          },
          {
            "key": "prices",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      }
    ]
  }
}

--- SUITE F: EDGE CASE AND ERROR HANDLING TESTS ---
Testing invalid inputs and expected error responses...
# Test F.1: Request with a non-existent model_id
{
  "error": "Unsupported model_id: FOOBAR. Supported models: ADDITION, SUBTRACTION, MULTIPLICATION, DIVISION, PERCENTAGE, FRACTION, COUNTING, TIME_RATE, CONVERSION, COMPARISON, MULTI_STEP, LINEAR_EQUATION, UNIT_RATE, COIN_RECOGNITION, CHANGE_CALCULATION, MONEY_COMBINATIONS, MIXED_MONEY_UNITS, MONEY_FRACTIONS, MONEY_SCALING, SHAPE_RECOGNITION, SHAPE_PROPERTIES, ANGLE_MEASUREMENT, POSITION_DIRECTION, AREA_PERIMETER"
}
# Test F.2: Request with an invalid difficulty_level
{
  "error": "difficulty_level must be X.Y where X=1-6 and Y=1-4"
}
# Test F.3: Request with an invalid format_preference
{
  "error": "Invalid format_preference. Valid options: DIRECT_CALCULATION, COMPARISON, ESTIMATION, ORDERING, VALIDATION, MULTI_STEP, MISSING_VALUE, PATTERN_RECOGNITION"
}
# Test F.4: Request with a dedicated broken model (TEST_BROKEN)
{
  "error": "Unsupported model_id: TEST_BROKEN. Supported models: ADDITION, SUBTRACTION, MULTIPLICATION, DIVISION, PERCENTAGE, FRACTION, COUNTING, TIME_RATE, CONVERSION, COMPARISON, MULTI_STEP, LINEAR_EQUATION, UNIT_RATE, COIN_RECOGNITION, CHANGE_CALCULATION, MONEY_COMBINATIONS, MIXED_MONEY_UNITS, MONEY_FRACTIONS, MONEY_SCALING, SHAPE_RECOGNITION, SHAPE_PROPERTIES, ANGLE_MEASUREMENT, POSITION_DIRECTION, AREA_PERIMETER"
}
# Test F.5: Request with a quantity greater than 20
{
  "error": "quantity must be between 1 and 20"
}
# Test F.6: Request missing the required model_id field
{
  "error": "model_id is required"
}

--- SUITE G: BATCH GENERATION TESTS ---
Testing the ability to generate multiple questions in one request...
# Test G.1: Request a batch of 5 questions
{
  "success": true,
  "questions": [
    {
      "text": "Oliver buys a apple for 20p and pays with £20. How much change does Oliver get?",
      "options": [
        {
          "text": "29.8",
          "value": 29.8,
          "index": 0
        },
        {
          "text": "115",
          "value": 115,
          "index": 1
        },
        {
          "text": "18.8",
          "value": 18.8,
          "index": 2
        },
        {
          "text": "£19.80",
          "value": 19.8,
          "index": 3
        }
      ],
      "correctIndex": 3,
      "format": "DIRECT_CALCULATION",
      "difficulty": {
        "year": 3,
        "subLevel": 3,
        "displayName": "3.3",
        "cognitiveLoad": 40
      },
      "cognitiveLoad": 40,
      "curriculumTags": [
        "3N1c",
        "3N1d"
      ],
      "scenario": {
        "id": "shop-002-realistic-general",
        "theme": "SHOPPING",
        "setting": {
          "location": "local shop",
          "timeContext": "after school",
          "atmosphere": "friendly"
        },
        "characters": [
          {
            "name": "Oliver",
            "role": "student"
          }
        ],
        "items": [
          {
            "name": "apple",
            "category": "FOOD_DRINK",
            "typicalValue": {
              "min": 0.2,
              "max": 0.5,
              "typical": 0.35,
              "distribution": "normal"
            },
            "unit": "£",
            "attributes": {
              "quality": "standard"
            }
          },
          {
            "name": "banana",
            "category": "FOOD_DRINK",
            "typicalValue": {
              "min": 0.15,
              "max": 0.4,
              "typical": 0.25,
              "distribution": "normal"
            },
            "unit": "£",
            "attributes": {
              "quality": "standard"
            }
          },
          {
            "name": "sandwich",
            "category": "FOOD_DRINK",
            "typicalValue": {
              "min": 2.5,
              "max": 6,
              "typical": 4,
              "distribution": "normal"
            },
            "unit": "£",
            "attributes": {
              "quality": "standard"
            }
          },
          {
            "name": "drink",
            "category": "FOOD_DRINK",
            "typicalValue": {
              "min": 0.8,
              "max": 2.5,
              "typical": 1.5,
              "distribution": "normal"
            },
            "unit": "£",
            "attributes": {
              "quality": "standard"
            }
          },
          {
            "name": "cake",
            "category": "FOOD_DRINK",
            "typicalValue": {
              "min": 1.5,
              "max": 4,
              "typical": 2.5,
              "distribution": "normal"
            },
            "unit": "£",
            "attributes": {
              "quality": "standard"
            }
          },
          {
            "name": "biscuit",
            "category": "FOOD_DRINK",
            "typicalValue": {
              "min": 0.8,
              "max": 2,
              "typical": 1.2,
              "distribution": "normal"
            },
            "unit": "£",
            "attributes": {
              "quality": "standard"
            }
          },
          {
            "name": "sweet",
            "category": "FOOD_DRINK",
            "typicalValue": {
              "min": 0.1,
              "max": 1,
              "typical": 0.5,
              "distribution": "normal"
            },
            "unit": "£",
            "attributes": {
              "quality": "standard"
            }
          },
          {
            "name": "chocolate",
            "category": "FOOD_DRINK",
            "typicalValue": {
              "min": 0.6,
              "max": 3,
              "typical": 1.5,
              "distribution": "normal"
            },
            "unit": "£",
            "attributes": {
              "quality": "standard"
            }
          },
          {
            "name": "pen",
            "category": "SCHOOL_SUPPLIES",
            "typicalValue": {
              "min": 0.5,
              "max": 2,
              "typical": 1,
              "distribution": "normal"
            },
            "unit": "£",
            "attributes": {
              "quality": "standard"
            }
          },
          {
            "name": "pencil",
            "category": "SCHOOL_SUPPLIES",
            "typicalValue": {
              "min": 0.2,
              "max": 1,
              "typical": 0.5,
              "distribution": "normal"
            },
            "unit": "£",
            "attributes": {
              "quality": "standard"
            }
          },
          {
            "name": "ruler",
            "category": "SCHOOL_SUPPLIES",
            "typicalValue": {
              "min": 0.8,
              "max": 2.5,
              "typical": 1.5,
              "distribution": "normal"
            },
            "unit": "£",
            "attributes": {
              "quality": "standard"
            }
          },
          {
            "name": "notebook",
            "category": "SCHOOL_SUPPLIES",
            "typicalValue": {
              "min": 1,
              "max": 4,
              "typical": 2,
              "distribution": "normal"
            },
            "unit": "£",
            "attributes": {
              "quality": "standard"
            }
          },
          {
            "name": "eraser",
            "category": "SCHOOL_SUPPLIES",
            "typicalValue": {
              "min": 0.3,
              "max": 1.5,
              "typical": 0.75,
              "distribution": "normal"
            },
            "unit": "£",
            "attributes": {
              "quality": "standard"
            }
          },
          {
            "name": "book",
            "category": "BOOKS_MEDIA",
            "typicalValue": {
              "min": 3,
              "max": 15,
              "typical": 8,
              "distribution": "normal"
            },
            "unit": "£",
            "attributes": {
              "quality": "standard"
            }
          },
          {
            "name": "comic",
            "category": "BOOKS_MEDIA",
            "typicalValue": {
              "min": 2,
              "max": 5,
              "typical": 3,
              "distribution": "normal"
            },
            "unit": "£",
            "attributes": {
              "quality": "standard"
            }
          },
          {
            "name": "magazine",
            "category": "BOOKS_MEDIA",
            "typicalValue": {
              "min": 2.5,
              "max": 6,
              "typical": 4,
              "distribution": "normal"
            },
            "unit": "£",
            "attributes": {
              "quality": "standard"
            }
          },
          {
            "name": "toy",
            "category": "TOYS_GAMES",
            "typicalValue": {
              "min": 5,
              "max": 25,
              "typical": 12,
              "distribution": "normal"
            },
            "unit": "£",
            "attributes": {
              "quality": "standard"
            }
          },
          {
            "name": "game",
            "category": "TOYS_GAMES",
            "typicalValue": {
              "min": 8,
              "max": 60,
              "typical": 25,
              "distribution": "normal"
            },
            "unit": "£",
            "attributes": {
              "quality": "standard"
            }
          },
          {
            "name": "puzzle",
            "category": "TOYS_GAMES",
            "typicalValue": {
              "min": 5,
              "max": 20,
              "typical": 12,
              "distribution": "normal"
            },
            "unit": "£",
            "attributes": {
              "quality": "standard"
            }
          },
          {
            "name": "sticker",
            "category": "TOYS_GAMES",
            "typicalValue": {
              "min": 0.2,
              "max": 2,
              "typical": 0.8,
              "distribution": "normal"
            },
            "unit": "£",
            "attributes": {
              "quality": "standard"
            }
          },
          {
            "name": "badge",
            "category": "TOYS_GAMES",
            "typicalValue": {
              "min": 0.5,
              "max": 3,
              "typical": 1.5,
              "distribution": "normal"
            },
            "unit": "£",
            "attributes": {
              "quality": "standard"
            }
          },
          {
            "name": "poster",
            "category": "BOOKS_MEDIA",
            "typicalValue": {
              "min": 2,
              "max": 8,
              "typical": 4,
              "distribution": "normal"
            },
            "unit": "£",
            "attributes": {
              "quality": "standard"
            }
          },
          {
            "name": "card",
            "category": "BOOKS_MEDIA",
            "typicalValue": {
              "min": 0.5,
              "max": 4,
              "typical": 2,
              "distribution": "normal"
            },
            "unit": "£",
            "attributes": {
              "quality": "standard"
            }
          }
        ],
        "culturalElements": [
          {
            "type": "currency",
            "value": "£",
            "explanation": "British pounds"
          },
          {
            "type": "location",
            "value": "UK local shop",
            "explanation": "Typical British corner shop"
          }
        ],
        "realWorldConnection": "Everyday shopping with realistic UK prices",
        "yearAppropriate": [
          1,
          2,
          3,
          4,
          5,
          6
        ],
        "templates": [
          {
            "formatCompatibility": [
              "DIRECT_CALCULATION",
              "MULTI_STEP"
            ],
            "modelCompatibility": [
              "ADDITION"
            ],
            "operandCount": 3,
            "template": "{character} buys a {item1} for {price1}, a {item2} for {price2}, and a {item3} for {price3}. What is the total cost?",
            "answerTemplate": "The total cost is {result}",
            "placeholders": [
              {
                "key": "character",
                "type": "character"
              },
              {
                "key": "item1",
                "type": "item"
              },
              {
                "key": "item2",
                "type": "item"
              },
              {
                "key": "item3",
                "type": "item"
              },
              {
                "key": "price1",
                "type": "value"
              },
              {
                "key": "price2",
                "type": "value"
              },
              {
                "key": "price3",
                "type": "value"
              },
              {
                "key": "result",
                "type": "value"
              }
            ]
          },
          {
            "formatCompatibility": [
              "DIRECT_CALCULATION",
              "MULTI_STEP"
            ],
            "modelCompatibility": [
              "ADDITION"
            ],
            "operandCount": 2,
            "template": "{character} buys a {item1} for {price1} and a {item2} for {price2}. What is the total cost?",
            "answerTemplate": "The total cost is {result}",
            "placeholders": [
              {
                "key": "character",
                "type": "character"
              },
              {
                "key": "item1",
                "type": "item"
              },
              {
                "key": "item2",
                "type": "item"
              },
              {
                "key": "price1",
                "type": "value"
              },
              {
                "key": "price2",
                "type": "value"
              },
              {
                "key": "result",
                "type": "value"
              }
            ]
          },
          {
            "formatCompatibility": [
              "DIRECT_CALCULATION"
            ],
            "modelCompatibility": [
              "SUBTRACTION",
              "CHANGE_CALCULATION"
            ],
            "template": "{character} buys a {item} for {price} and pays with {payment}. How much change does {character} get?",
            "answerTemplate": "{character} receives {result} in change",
            "placeholders": [
              {
                "key": "character",
                "type": "character"
              },
              {
                "key": "item",
                "type": "item"
              },
              {
                "key": "price",
                "type": "value"
              },
              {
                "key": "payment",
                "type": "value"
              },
              {
                "key": "result",
                "type": "value"
              }
            ]
          },
          {
            "formatCompatibility": [
              "DIRECT_CALCULATION"
            ],
            "modelCompatibility": [
              "MULTIPLICATION"
            ],
            "template": "{character} buys {quantity} {item} at {price} each. What is the total cost?",
            "answerTemplate": "The total cost is {result}",
            "placeholders": [
              {
                "key": "character",
                "type": "character"
              },
              {
                "key": "quantity",
                "type": "value"
              },
              {
                "key": "item",
                "type": "item"
              },
              {
                "key": "price",
                "type": "value"
              },
              {
                "key": "result",
                "type": "value"
              }
            ]
          },
          {
            "formatCompatibility": [
              "DIRECT_CALCULATION"
            ],
            "modelCompatibility": [
              "DIVISION"
            ],
            "template": "{character} has {total} to spend equally on {quantity} {item}. How much can {character} spend on each one?",
            "answerTemplate": "{character} can spend {result} on each {item}",
            "placeholders": [
              {
                "key": "character",
                "type": "character"
              },
              {
                "key": "total",
                "type": "value"
              },
              {
                "key": "quantity",
                "type": "value"
              },
              {
                "key": "item",
                "type": "item"
              },
              {
                "key": "result",
                "type": "value"
              }
            ]
          },
          {
            "formatCompatibility": [
              "DIRECT_CALCULATION",
              "COMPARISON",
              "ESTIMATION",
              "MULTI_STEP"
            ],
            "template": "{character} goes to the shop and buys {items}. How much does {character} spend in total?",
            "answerTemplate": "{character} spends {result} in total",
            "placeholders": [
              {
                "key": "character",
                "type": "character"
              },
              {
                "key": "items",
                "type": "item_list"
              },
              {
                "key": "result",
                "type": "value"
              }
            ]
          },
          {
            "formatCompatibility": [
              "ESTIMATION"
            ],
            "template": "Estimate: If {character} buys {items}, about how much will it cost?",
            "answerTemplate": "It will cost approximately {result}",
            "placeholders": [
              {
                "key": "character",
                "type": "character"
              },
              {
                "key": "items",
                "type": "item_list"
              },
              {
                "key": "result",
                "type": "value"
              }
            ]
          },
          {
            "formatCompatibility": [
              "VALIDATION"
            ],
            "template": "{character} calculated that {items} costs {amount}. Is this correct?",
            "answerTemplate": "{validation_result}",
            "placeholders": [
              {
                "key": "character",
                "type": "character"
              },
              {
                "key": "items",
                "type": "item_list"
              },
              {
                "key": "amount",
                "type": "value"
              },
              {
                "key": "validation_result",
                "type": "boolean"
              }
            ]
          }
        ]
      },
      "distractors": [
        {
          "value": 115,
          "displayText": "115",
          "strategy": "WRONG_OPERATION",
          "reasoning": "Added instead of subtracting"
        },
        {
          "value": 29.8,
          "displayText": "29.8",
          "strategy": "PLACE_VALUE_ERROR",
          "reasoning": "Error in carrying to next column"
        },
        {
          "value": 18.8,
          "displayText": "18.8",
          "strategy": "PLACE_VALUE_ERROR",
          "reasoning": "Forgot to carry"
        }
      ],
      "enhancementStatus": {
        "level": "partial",
        "requestedFormat": "DIRECT_CALCULATION",
        "actualFormat": "DIRECT_CALCULATION",
        "featuresActive": [
          "enhanced_distractors",
          "rich_scenarios",
          "cognitive_load",
          "advanced_formats"
        ],
        "featuresPending": [],
        "isFullyEnhanced": true
      },
      "mathOutput": {
        "operation": "SUBTRACTION",
        "subtrahend": 0.2,
        "minuend": 20,
        "result": 19.8
      },
      "generationTime": 5,
      "questionId": "q_1759130033762_9piqosx0t",
      "generationSetup": {
        "controller_used": "DIRECT_CALCULATIONController",
        "format_requested": "DIRECT_CALCULATION",
        "format_actual": "DIRECT_CALCULATION",
        "scenario_theme": "SHOPPING",
        "scenario_id": "shop-002-realistic-general",
        "scenario_selection_method": "default",
        "distractor_strategies": [
          "WRONG_OPERATION",
          "PLACE_VALUE_ERROR",
          "PLACE_VALUE_ERROR"
        ],
        "distractor_count": 3,
        "theme_variety": false,
        "format_variety": false,
        "enhancement_level": "partial",
        "features_active": [
          "enhanced_distractors",
          "rich_scenarios",
          "cognitive_load",
          "advanced_formats"
        ],
        "features_pending": [],
        "generation_time_ms": 5
      }
    },
    {
      "text": "Sarah is subtracting £95.00 - £9.00. What is a reasonable estimate?",
      "options": [
        {
          "text": "£85.00",
          "value": 85,
          "index": 0
        },
        {
          "text": "127.5",
          "value": 127.5,
          "index": 1
        },
        {
          "text": "51",
          "value": 51,
          "index": 2
        },
        {
          "text": "86",
          "value": 86,
          "index": 3
        }
      ],
      "correctIndex": 0,
      "questionContent": {
        "fullText": "Sarah is subtracting £95.00 - £9.00. What is a reasonable estimate?",
        "templateData": {
          "character": "Sarah",
          "operation": "is subtracting £95.00 - £9.00",
          "exactValue": "86",
          "estimatedValue": "85"
        }
      },
      "format": "ESTIMATION",
      "difficulty": {
        "year": 3,
        "subLevel": 3,
        "displayName": "3.3",
        "cognitiveLoad": 40
      },
      "cognitiveLoad": 40,
      "curriculumTags": [
        "3N1c",
        "3N1d"
      ],
      "scenario": {
        "id": "shop-001-bookfair",
        "theme": "SHOPPING",
        "setting": {
          "location": "school book fair",
          "timeContext": "lunch break",
          "atmosphere": "busy"
        },
        "characters": [
          {
            "name": "Sarah",
            "role": "student"
          },
          {
            "name": "Mr. Johnson",
            "role": "teacher"
          }
        ],
        "items": [
          {
            "name": "book",
            "category": "BOOKS_MEDIA",
            "typicalValue": {
              "min": 3,
              "max": 12,
              "typical": 6.5,
              "distribution": "normal"
            },
            "unit": "£",
            "attributes": {
              "quality": "standard"
            }
          },
          {
            "name": "bookmark",
            "category": "SCHOOL_SUPPLIES",
            "typicalValue": {
              "min": 0.5,
              "max": 2,
              "typical": 1,
              "distribution": "normal"
            },
            "unit": "£",
            "attributes": {
              "quality": "standard"
            }
          }
        ],
        "culturalElements": [
          {
            "type": "currency",
            "value": "£",
            "explanation": "British pounds"
          },
          {
            "type": "event",
            "value": "book fair",
            "explanation": "School fundraising event"
          }
        ],
        "realWorldConnection": "School fundraising and reading promotion",
        "yearAppropriate": [
          2,
          3,
          4,
          5
        ],
        "templates": [
          {
            "formatCompatibility": [
              "DIRECT_CALCULATION",
              "COMPARISON"
            ],
            "template": "{character} wants to buy books at the book fair. Calculate the total cost.",
            "answerTemplate": "The total cost is {result}",
            "placeholders": [
              {
                "key": "character",
                "type": "character"
              },
              {
                "key": "result",
                "type": "value"
              }
            ]
          }
        ]
      },
      "distractors": [
        {
          "value": 86,
          "strategy": "WRONG_OPERATION",
          "rationale": "Used exact calculation instead of estimation"
        },
        {
          "value": 127.5,
          "rationale": "Overestimated significantly"
        },
        {
          "value": 51,
          "rationale": "Underestimated significantly"
        }
      ],
      "enhancementStatus": {
        "level": "full",
        "requestedFormat": "ESTIMATION",
        "actualFormat": "ESTIMATION",
        "featuresActive": [
          "enhanced_distractors",
          "rich_scenarios",
          "cognitive_load",
          "advanced_formats"
        ],
        "featuresPending": [],
        "isFullyEnhanced": true
      },
      "mathOutput": {
        "operation": "SUBTRACTION",
        "minuend": 95,
        "subtrahend": 9,
        "result": 86,
        "decimal_formatted": {
          "minuend": "95",
          "subtrahend": "9",
          "result": "86"
        },
        "exactValue": 86,
        "estimatedValue": 85
      },
      "generationTime": 0,
      "questionId": "q_1759130033763_3dnrxm6oe",
      "generationSetup": {
        "controller_used": "ESTIMATIONController",
        "format_requested": "ESTIMATION",
        "format_actual": "ESTIMATION",
        "scenario_theme": "SHOPPING",
        "scenario_id": "shop-001-bookfair",
        "scenario_selection_method": "default",
        "distractor_strategies": [
          "WRONG_OPERATION",
          null,
          null
        ],
        "distractor_count": 3,
        "theme_variety": false,
        "format_variety": false,
        "enhancement_level": "full",
        "features_active": [
          "enhanced_distractors",
          "rich_scenarios",
          "cognitive_load",
          "advanced_formats"
        ],
        "features_pending": [],
        "generation_time_ms": 0
      }
    },
    {
      "text": "Oliver buys a apple for 44p and pays with £45. How much change does Oliver get?",
      "options": [
        {
          "text": "£44.56",
          "value": 44.56,
          "index": 0
        },
        {
          "text": "54.56",
          "value": 54.56,
          "index": 1
        },
        {
          "text": "50",
          "value": 50,
          "index": 2
        }
      ],
      "correctIndex": 0,
      "format": "DIRECT_CALCULATION",
      "difficulty": {
        "year": 3,
        "subLevel": 3,
        "displayName": "3.3",
        "cognitiveLoad": 40
      },
      "cognitiveLoad": 40,
      "curriculumTags": [
        "3N1c",
        "3N1d"
      ],
      "scenario": {
        "id": "shop-002-realistic-general",
        "theme": "SHOPPING",
        "setting": {
          "location": "local shop",
          "timeContext": "after school",
          "atmosphere": "friendly"
        },
        "characters": [
          {
            "name": "Oliver",
            "role": "student"
          }
        ],
        "items": [
          {
            "name": "apple",
            "category": "FOOD_DRINK",
            "typicalValue": {
              "min": 0.2,
              "max": 0.5,
              "typical": 0.35,
              "distribution": "normal"
            },
            "unit": "£",
            "attributes": {
              "quality": "standard"
            }
          },
          {
            "name": "banana",
            "category": "FOOD_DRINK",
            "typicalValue": {
              "min": 0.15,
              "max": 0.4,
              "typical": 0.25,
              "distribution": "normal"
            },
            "unit": "£",
            "attributes": {
              "quality": "standard"
            }
          },
          {
            "name": "sandwich",
            "category": "FOOD_DRINK",
            "typicalValue": {
              "min": 2.5,
              "max": 6,
              "typical": 4,
              "distribution": "normal"
            },
            "unit": "£",
            "attributes": {
              "quality": "standard"
            }
          },
          {
            "name": "drink",
            "category": "FOOD_DRINK",
            "typicalValue": {
              "min": 0.8,
              "max": 2.5,
              "typical": 1.5,
              "distribution": "normal"
            },
            "unit": "£",
            "attributes": {
              "quality": "standard"
            }
          },
          {
            "name": "cake",
            "category": "FOOD_DRINK",
            "typicalValue": {
              "min": 1.5,
              "max": 4,
              "typical": 2.5,
              "distribution": "normal"
            },
            "unit": "£",
            "attributes": {
              "quality": "standard"
            }
          },
          {
            "name": "biscuit",
            "category": "FOOD_DRINK",
            "typicalValue": {
              "min": 0.8,
              "max": 2,
              "typical": 1.2,
              "distribution": "normal"
            },
            "unit": "£",
            "attributes": {
              "quality": "standard"
            }
          },
          {
            "name": "sweet",
            "category": "FOOD_DRINK",
            "typicalValue": {
              "min": 0.1,
              "max": 1,
              "typical": 0.5,
              "distribution": "normal"
            },
            "unit": "£",
            "attributes": {
              "quality": "standard"
            }
          },
          {
            "name": "chocolate",
            "category": "FOOD_DRINK",
            "typicalValue": {
              "min": 0.6,
              "max": 3,
              "typical": 1.5,
              "distribution": "normal"
            },
            "unit": "£",
            "attributes": {
              "quality": "standard"
            }
          },
          {
            "name": "pen",
            "category": "SCHOOL_SUPPLIES",
            "typicalValue": {
              "min": 0.5,
              "max": 2,
              "typical": 1,
              "distribution": "normal"
            },
            "unit": "£",
            "attributes": {
              "quality": "standard"
            }
          },
          {
            "name": "pencil",
            "category": "SCHOOL_SUPPLIES",
            "typicalValue": {
              "min": 0.2,
              "max": 1,
              "typical": 0.5,
              "distribution": "normal"
            },
            "unit": "£",
            "attributes": {
              "quality": "standard"
            }
          },
          {
            "name": "ruler",
            "category": "SCHOOL_SUPPLIES",
            "typicalValue": {
              "min": 0.8,
              "max": 2.5,
              "typical": 1.5,
              "distribution": "normal"
            },
            "unit": "£",
            "attributes": {
              "quality": "standard"
            }
          },
          {
            "name": "notebook",
            "category": "SCHOOL_SUPPLIES",
            "typicalValue": {
              "min": 1,
              "max": 4,
              "typical": 2,
              "distribution": "normal"
            },
            "unit": "£",
            "attributes": {
              "quality": "standard"
            }
          },
          {
            "name": "eraser",
            "category": "SCHOOL_SUPPLIES",
            "typicalValue": {
              "min": 0.3,
              "max": 1.5,
              "typical": 0.75,
              "distribution": "normal"
            },
            "unit": "£",
            "attributes": {
              "quality": "standard"
            }
          },
          {
            "name": "book",
            "category": "BOOKS_MEDIA",
            "typicalValue": {
              "min": 3,
              "max": 15,
              "typical": 8,
              "distribution": "normal"
            },
            "unit": "£",
            "attributes": {
              "quality": "standard"
            }
          },
          {
            "name": "comic",
            "category": "BOOKS_MEDIA",
            "typicalValue": {
              "min": 2,
              "max": 5,
              "typical": 3,
              "distribution": "normal"
            },
            "unit": "£",
            "attributes": {
              "quality": "standard"
            }
          },
          {
            "name": "magazine",
            "category": "BOOKS_MEDIA",
            "typicalValue": {
              "min": 2.5,
              "max": 6,
              "typical": 4,
              "distribution": "normal"
            },
            "unit": "£",
            "attributes": {
              "quality": "standard"
            }
          },
          {
            "name": "toy",
            "category": "TOYS_GAMES",
            "typicalValue": {
              "min": 5,
              "max": 25,
              "typical": 12,
              "distribution": "normal"
            },
            "unit": "£",
            "attributes": {
              "quality": "standard"
            }
          },
          {
            "name": "game",
            "category": "TOYS_GAMES",
            "typicalValue": {
              "min": 8,
              "max": 60,
              "typical": 25,
              "distribution": "normal"
            },
            "unit": "£",
            "attributes": {
              "quality": "standard"
            }
          },
          {
            "name": "puzzle",
            "category": "TOYS_GAMES",
            "typicalValue": {
              "min": 5,
              "max": 20,
              "typical": 12,
              "distribution": "normal"
            },
            "unit": "£",
            "attributes": {
              "quality": "standard"
            }
          },
          {
            "name": "sticker",
            "category": "TOYS_GAMES",
            "typicalValue": {
              "min": 0.2,
              "max": 2,
              "typical": 0.8,
              "distribution": "normal"
            },
            "unit": "£",
            "attributes": {
              "quality": "standard"
            }
          },
          {
            "name": "badge",
            "category": "TOYS_GAMES",
            "typicalValue": {
              "min": 0.5,
              "max": 3,
              "typical": 1.5,
              "distribution": "normal"
            },
            "unit": "£",
            "attributes": {
              "quality": "standard"
            }
          },
          {
            "name": "poster",
            "category": "BOOKS_MEDIA",
            "typicalValue": {
              "min": 2,
              "max": 8,
              "typical": 4,
              "distribution": "normal"
            },
            "unit": "£",
            "attributes": {
              "quality": "standard"
            }
          },
          {
            "name": "card",
            "category": "BOOKS_MEDIA",
            "typicalValue": {
              "min": 0.5,
              "max": 4,
              "typical": 2,
              "distribution": "normal"
            },
            "unit": "£",
            "attributes": {
              "quality": "standard"
            }
          }
        ],
        "culturalElements": [
          {
            "type": "currency",
            "value": "£",
            "explanation": "British pounds"
          },
          {
            "type": "location",
            "value": "UK local shop",
            "explanation": "Typical British corner shop"
          }
        ],
        "realWorldConnection": "Everyday shopping with realistic UK prices",
        "yearAppropriate": [
          1,
          2,
          3,
          4,
          5,
          6
        ],
        "templates": [
          {
            "formatCompatibility": [
              "DIRECT_CALCULATION",
              "MULTI_STEP"
            ],
            "modelCompatibility": [
              "ADDITION"
            ],
            "operandCount": 3,
            "template": "{character} buys a {item1} for {price1}, a {item2} for {price2}, and a {item3} for {price3}. What is the total cost?",
            "answerTemplate": "The total cost is {result}",
            "placeholders": [
              {
                "key": "character",
                "type": "character"
              },
              {
                "key": "item1",
                "type": "item"
              },
              {
                "key": "item2",
                "type": "item"
              },
              {
                "key": "item3",
                "type": "item"
              },
              {
                "key": "price1",
                "type": "value"
              },
              {
                "key": "price2",
                "type": "value"
              },
              {
                "key": "price3",
                "type": "value"
              },
              {
                "key": "result",
                "type": "value"
              }
            ]
          },
          {
            "formatCompatibility": [
              "DIRECT_CALCULATION",
              "MULTI_STEP"
            ],
            "modelCompatibility": [
              "ADDITION"
            ],
            "operandCount": 2,
            "template": "{character} buys a {item1} for {price1} and a {item2} for {price2}. What is the total cost?",
            "answerTemplate": "The total cost is {result}",
            "placeholders": [
              {
                "key": "character",
                "type": "character"
              },
              {
                "key": "item1",
                "type": "item"
              },
              {
                "key": "item2",
                "type": "item"
              },
              {
                "key": "price1",
                "type": "value"
              },
              {
                "key": "price2",
                "type": "value"
              },
              {
                "key": "result",
                "type": "value"
              }
            ]
          },
          {
            "formatCompatibility": [
              "DIRECT_CALCULATION"
            ],
            "modelCompatibility": [
              "SUBTRACTION",
              "CHANGE_CALCULATION"
            ],
            "template": "{character} buys a {item} for {price} and pays with {payment}. How much change does {character} get?",
            "answerTemplate": "{character} receives {result} in change",
            "placeholders": [
              {
                "key": "character",
                "type": "character"
              },
              {
                "key": "item",
                "type": "item"
              },
              {
                "key": "price",
                "type": "value"
              },
              {
                "key": "payment",
                "type": "value"
              },
              {
                "key": "result",
                "type": "value"
              }
            ]
          },
          {
            "formatCompatibility": [
              "DIRECT_CALCULATION"
            ],
            "modelCompatibility": [
              "MULTIPLICATION"
            ],
            "template": "{character} buys {quantity} {item} at {price} each. What is the total cost?",
            "answerTemplate": "The total cost is {result}",
            "placeholders": [
              {
                "key": "character",
                "type": "character"
              },
              {
                "key": "quantity",
                "type": "value"
              },
              {
                "key": "item",
                "type": "item"
              },
              {
                "key": "price",
                "type": "value"
              },
              {
                "key": "result",
                "type": "value"
              }
            ]
          },
          {
            "formatCompatibility": [
              "DIRECT_CALCULATION"
            ],
            "modelCompatibility": [
              "DIVISION"
            ],
            "template": "{character} has {total} to spend equally on {quantity} {item}. How much can {character} spend on each one?",
            "answerTemplate": "{character} can spend {result} on each {item}",
            "placeholders": [
              {
                "key": "character",
                "type": "character"
              },
              {
                "key": "total",
                "type": "value"
              },
              {
                "key": "quantity",
                "type": "value"
              },
              {
                "key": "item",
                "type": "item"
              },
              {
                "key": "result",
                "type": "value"
              }
            ]
          },
          {
            "formatCompatibility": [
              "DIRECT_CALCULATION",
              "COMPARISON",
              "ESTIMATION",
              "MULTI_STEP"
            ],
            "template": "{character} goes to the shop and buys {items}. How much does {character} spend in total?",
            "answerTemplate": "{character} spends {result} in total",
            "placeholders": [
              {
                "key": "character",
                "type": "character"
              },
              {
                "key": "items",
                "type": "item_list"
              },
              {
                "key": "result",
                "type": "value"
              }
            ]
          },
          {
            "formatCompatibility": [
              "ESTIMATION"
            ],
            "template": "Estimate: If {character} buys {items}, about how much will it cost?",
            "answerTemplate": "It will cost approximately {result}",
            "placeholders": [
              {
                "key": "character",
                "type": "character"
              },
              {
                "key": "items",
                "type": "item_list"
              },
              {
                "key": "result",
                "type": "value"
              }
            ]
          },
          {
            "formatCompatibility": [
              "VALIDATION"
            ],
            "template": "{character} calculated that {items} costs {amount}. Is this correct?",
            "answerTemplate": "{validation_result}",
            "placeholders": [
              {
                "key": "character",
                "type": "character"
              },
              {
                "key": "items",
                "type": "item_list"
              },
              {
                "key": "amount",
                "type": "value"
              },
              {
                "key": "validation_result",
                "type": "boolean"
              }
            ]
          }
        ]
      },
      "distractors": [
        {
          "value": 50,
          "displayText": "50",
          "strategy": "WRONG_OPERATION",
          "reasoning": "Added instead of subtracting"
        },
        {
          "value": 54.56,
          "displayText": "54.56",
          "strategy": "PLACE_VALUE_ERROR",
          "reasoning": "Error in carrying to next column"
        }
      ],
      "enhancementStatus": {
        "level": "partial",
        "requestedFormat": "DIRECT_CALCULATION",
        "actualFormat": "DIRECT_CALCULATION",
        "featuresActive": [
          "enhanced_distractors",
          "rich_scenarios",
          "cognitive_load",
          "advanced_formats"
        ],
        "featuresPending": [],
        "isFullyEnhanced": true
      },
      "mathOutput": {
        "operation": "SUBTRACTION",
        "subtrahend": 0.44,
        "minuend": 45,
        "result": 44.56
      },
      "generationTime": 0,
      "questionId": "q_1759130033763_x0yqvzcav",
      "generationSetup": {
        "controller_used": "DIRECT_CALCULATIONController",
        "format_requested": "DIRECT_CALCULATION",
        "format_actual": "DIRECT_CALCULATION",
        "scenario_theme": "SHOPPING",
        "scenario_id": "shop-002-realistic-general",
        "scenario_selection_method": "default",
        "distractor_strategies": [
          "WRONG_OPERATION",
          "PLACE_VALUE_ERROR"
        ],
        "distractor_count": 2,
        "theme_variety": false,
        "format_variety": false,
        "enhancement_level": "partial",
        "features_active": [
          "enhanced_distractors",
          "rich_scenarios",
          "cognitive_load",
          "advanced_formats"
        ],
        "features_pending": [],
        "generation_time_ms": 0
      }
    }
  ],
  "metadata": {
    "format": "DIRECT_CALCULATION",
    "cognitive_load": 40,
    "curriculum_alignment": [
      "3N1c",
      "3N1d"
    ],
    "difficulty": "3.3",
    "scenario_theme": "SHOPPING",
    "distractor_strategies": [],
    "generation_time_ms": 141,
    "enhancement_status": "partial",
    "format_used": "DIRECT_CALCULATION",
    "features_active": [
      "enhanced_distractors",
      "rich_scenarios",
      "cognitive_load",
      "advanced_formats"
    ],
    "features_pending": [],
    "api_version": "2.0"
  },
  "batch_info": {
    "total_questions": 5,
    "avg_generation_time": 28.2,
    "success_rate": 0.6
  }
}

--- API TEST SUITE COMPLETE ---
