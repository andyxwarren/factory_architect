--- SUITE A: SMOKE TESTS ---
Running basic tests to ensure the API is online and responsive...
# Test A.1: Basic ADDITION request
{
  "success": true,
  "question": {
    "text": "Liam buys an apple for 22p and a banana for 32p. What is the total cost?",
    "options": [
      {
        "text": "54p",
        "value": 0.54,
        "index": 0
      },
      {
        "text": "1.54",
        "value": 1.54,
        "index": 1
      },
      {
        "text": "2.54",
        "value": 2.54,
        "index": 2
      },
      {
        "text": "0.27",
        "value": 0.27,
        "index": 3
      }
    ],
    "correctIndex": 0,
    "format": "DIRECT_CALCULATION",
    "difficulty": {
      "year": 1,
      "subLevel": 1,
      "displayName": "1.1",
      "cognitiveLoad": 10
    },
    "cognitiveLoad": 10,
    "curriculumTags": [
      "1N1a",
      "1N1b"
    ],
    "scenario": {
      "id": "shop-002-realistic-general",
      "theme": "SHOPPING",
      "setting": {
        "location": "local shop",
        "timeContext": "after school",
        "atmosphere": "friendly"
      },
      "characters": [
        {
          "name": "Liam",
          "role": "student"
        }
      ],
      "items": [
        {
          "name": "apple",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.2,
            "max": 0.5,
            "typical": 0.35,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "banana",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.15,
            "max": 0.4,
            "typical": 0.25,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "sandwich",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 2.5,
            "max": 6,
            "typical": 4,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "drink",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.8,
            "max": 2.5,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "cake",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 1.5,
            "max": 4,
            "typical": 2.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "biscuit",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.8,
            "max": 2,
            "typical": 1.2,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "sweet",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.1,
            "max": 1,
            "typical": 0.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "chocolate",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.6,
            "max": 3,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "pen",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.5,
            "max": 2,
            "typical": 1,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "pencil",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.2,
            "max": 1,
            "typical": 0.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "ruler",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.8,
            "max": 2.5,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "notebook",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 1,
            "max": 4,
            "typical": 2,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "eraser",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.3,
            "max": 1.5,
            "typical": 0.75,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "book",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 3,
            "max": 15,
            "typical": 8,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "comic",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 2,
            "max": 5,
            "typical": 3,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "magazine",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 2.5,
            "max": 6,
            "typical": 4,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "toy",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 5,
            "max": 25,
            "typical": 12,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "game",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 8,
            "max": 60,
            "typical": 25,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "puzzle",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 5,
            "max": 20,
            "typical": 12,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "sticker",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 0.2,
            "max": 2,
            "typical": 0.8,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "badge",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 0.5,
            "max": 3,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "poster",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 2,
            "max": 8,
            "typical": 4,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "card",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 0.5,
            "max": 4,
            "typical": 2,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        }
      ],
      "culturalElements": [
        {
          "type": "currency",
          "value": "£",
          "explanation": "British pounds"
        },
        {
          "type": "location",
          "value": "UK local shop",
          "explanation": "Typical British corner shop"
        }
      ],
      "realWorldConnection": "Everyday shopping with realistic UK prices",
      "yearAppropriate": [
        1,
        2,
        3,
        4,
        5,
        6
      ],
      "templates": [
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "MULTI_STEP"
          ],
          "modelCompatibility": [
            "ADDITION"
          ],
          "operandCount": 3,
          "template": "{character} buys {article1} {item1} for {price1}, {article2} {item2} for {price2}, and {article3} {item3} for {price3}. What is the total cost?",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item1",
              "type": "item"
            },
            {
              "key": "item2",
              "type": "item"
            },
            {
              "key": "item3",
              "type": "item"
            },
            {
              "key": "price1",
              "type": "value"
            },
            {
              "key": "price2",
              "type": "value"
            },
            {
              "key": "price3",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "MULTI_STEP"
          ],
          "modelCompatibility": [
            "ADDITION"
          ],
          "operandCount": 2,
          "template": "{character} buys {article1} {item1} for {price1} and {article2} {item2} for {price2}. What is the total cost?",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item1",
              "type": "item"
            },
            {
              "key": "item2",
              "type": "item"
            },
            {
              "key": "price1",
              "type": "value"
            },
            {
              "key": "price2",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION"
          ],
          "modelCompatibility": [
            "SUBTRACTION",
            "CHANGE_CALCULATION"
          ],
          "template": "{character} buys {article} {item} for {price} and pays with {payment}. How much change does {character} get?",
          "answerTemplate": "{character} receives {result} in change",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "price",
              "type": "value"
            },
            {
              "key": "payment",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION"
          ],
          "modelCompatibility": [
            "MULTIPLICATION"
          ],
          "template": "{character} buys {quantity} {item} at {price} each. What is the total cost?",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "quantity",
              "type": "value"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "price",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION"
          ],
          "modelCompatibility": [
            "DIVISION"
          ],
          "template": "{character} has {total} to spend equally on {quantity} {item}. How much can {character} spend on each one?",
          "answerTemplate": "{character} can spend {result} on each {item}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "total",
              "type": "value"
            },
            {
              "key": "quantity",
              "type": "value"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "COMPARISON",
            "ESTIMATION",
            "MULTI_STEP"
          ],
          "template": "{character} goes to the shop and buys {items}. How much does {character} spend in total?",
          "answerTemplate": "{character} spends {result} in total",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "items",
              "type": "item_list"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "ESTIMATION"
          ],
          "template": "Estimate: If {character} buys {items}, about how much will it cost?",
          "answerTemplate": "It will cost approximately {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "items",
              "type": "item_list"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "VALIDATION"
          ],
          "template": "{character} calculated that {items} costs {amount}. Is this correct?",
          "answerTemplate": "{validation_result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "items",
              "type": "item_list"
            },
            {
              "key": "amount",
              "type": "value"
            },
            {
              "key": "validation_result",
              "type": "boolean"
            }
          ]
        }
      ]
    },
    "distractors": [
      {
        "value": 1.54,
        "displayText": "1.54",
        "strategy": "CLOSE_VALUE",
        "reasoning": "Off by 1"
      },
      {
        "value": 2.54,
        "displayText": "2.54",
        "strategy": "CLOSE_VALUE",
        "reasoning": "Off by 2"
      },
      {
        "value": 0.27,
        "displayText": "0.27",
        "reasoning": "Half the correct value"
      }
    ],
    "enhancementStatus": {
      "level": "partial",
      "requestedFormat": "DIRECT_CALCULATION",
      "actualFormat": "DIRECT_CALCULATION",
      "featuresActive": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "featuresPending": [],
      "isFullyEnhanced": true
    },
    "mathOutput": {
      "operation": "ADDITION",
      "operand_1": 0.22,
      "operand_2": 0.32,
      "result": 0.54
    },
    "generationTime": 3,
    "questionId": "q_1759234376442_obwb4xljb",
    "generationSetup": {
      "controller_used": "DIRECT_CALCULATIONController",
      "format_requested": "DIRECT_CALCULATION",
      "format_actual": "DIRECT_CALCULATION",
      "scenario_theme": "SHOPPING",
      "scenario_id": "shop-002-realistic-general",
      "scenario_selection_method": "default",
      "distractor_strategies": [
        "CLOSE_VALUE",
        "CLOSE_VALUE",
        null
      ],
      "distractor_count": 3,
      "theme_variety": false,
      "format_variety": false,
      "enhancement_level": "partial",
      "features_active": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "features_pending": [],
      "generation_time_ms": 3
    }
  },
  "metadata": {
    "format": "DIRECT_CALCULATION",
    "cognitive_load": 10,
    "curriculum_alignment": [
      "1N1a",
      "1N1b"
    ],
    "difficulty": "1.1",
    "scenario_theme": "SHOPPING",
    "distractor_strategies": [
      "CLOSE_VALUE",
      "CLOSE_VALUE",
      null
    ],
    "generation_time_ms": 3,
    "api_version": "2.0",
    "enhancement_status": "partial",
    "format_requested": "DIRECT_CALCULATION",
    "format_used": "DIRECT_CALCULATION",
    "features_active": [
      "enhanced_distractors",
      "rich_scenarios",
      "cognitive_load",
      "advanced_formats"
    ],
    "features_pending": []
  },
  "context": {
    "id": "shop-002-realistic-general",
    "theme": "SHOPPING",
    "setting": {
      "location": "local shop",
      "timeContext": "after school",
      "atmosphere": "friendly"
    },
    "characters": [
      {
        "name": "Liam",
        "role": "student"
      }
    ],
    "items": [
      {
        "name": "apple",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.2,
          "max": 0.5,
          "typical": 0.35,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "banana",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.15,
          "max": 0.4,
          "typical": 0.25,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "sandwich",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 2.5,
          "max": 6,
          "typical": 4,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "drink",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.8,
          "max": 2.5,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "cake",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 1.5,
          "max": 4,
          "typical": 2.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "biscuit",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.8,
          "max": 2,
          "typical": 1.2,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "sweet",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.1,
          "max": 1,
          "typical": 0.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "chocolate",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.6,
          "max": 3,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "pen",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.5,
          "max": 2,
          "typical": 1,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "pencil",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.2,
          "max": 1,
          "typical": 0.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "ruler",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.8,
          "max": 2.5,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "notebook",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 1,
          "max": 4,
          "typical": 2,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "eraser",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.3,
          "max": 1.5,
          "typical": 0.75,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "book",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 3,
          "max": 15,
          "typical": 8,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "comic",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 2,
          "max": 5,
          "typical": 3,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "magazine",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 2.5,
          "max": 6,
          "typical": 4,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "toy",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 5,
          "max": 25,
          "typical": 12,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "game",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 8,
          "max": 60,
          "typical": 25,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "puzzle",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 5,
          "max": 20,
          "typical": 12,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "sticker",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 0.2,
          "max": 2,
          "typical": 0.8,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "badge",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 0.5,
          "max": 3,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "poster",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 2,
          "max": 8,
          "typical": 4,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "card",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 0.5,
          "max": 4,
          "typical": 2,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      }
    ],
    "culturalElements": [
      {
        "type": "currency",
        "value": "£",
        "explanation": "British pounds"
      },
      {
        "type": "location",
        "value": "UK local shop",
        "explanation": "Typical British corner shop"
      }
    ],
    "realWorldConnection": "Everyday shopping with realistic UK prices",
    "yearAppropriate": [
      1,
      2,
      3,
      4,
      5,
      6
    ],
    "templates": [
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "MULTI_STEP"
        ],
        "modelCompatibility": [
          "ADDITION"
        ],
        "operandCount": 3,
        "template": "{character} buys {article1} {item1} for {price1}, {article2} {item2} for {price2}, and {article3} {item3} for {price3}. What is the total cost?",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item1",
            "type": "item"
          },
          {
            "key": "item2",
            "type": "item"
          },
          {
            "key": "item3",
            "type": "item"
          },
          {
            "key": "price1",
            "type": "value"
          },
          {
            "key": "price2",
            "type": "value"
          },
          {
            "key": "price3",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "MULTI_STEP"
        ],
        "modelCompatibility": [
          "ADDITION"
        ],
        "operandCount": 2,
        "template": "{character} buys {article1} {item1} for {price1} and {article2} {item2} for {price2}. What is the total cost?",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item1",
            "type": "item"
          },
          {
            "key": "item2",
            "type": "item"
          },
          {
            "key": "price1",
            "type": "value"
          },
          {
            "key": "price2",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION"
        ],
        "modelCompatibility": [
          "SUBTRACTION",
          "CHANGE_CALCULATION"
        ],
        "template": "{character} buys {article} {item} for {price} and pays with {payment}. How much change does {character} get?",
        "answerTemplate": "{character} receives {result} in change",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "price",
            "type": "value"
          },
          {
            "key": "payment",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION"
        ],
        "modelCompatibility": [
          "MULTIPLICATION"
        ],
        "template": "{character} buys {quantity} {item} at {price} each. What is the total cost?",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "quantity",
            "type": "value"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "price",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION"
        ],
        "modelCompatibility": [
          "DIVISION"
        ],
        "template": "{character} has {total} to spend equally on {quantity} {item}. How much can {character} spend on each one?",
        "answerTemplate": "{character} can spend {result} on each {item}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "total",
            "type": "value"
          },
          {
            "key": "quantity",
            "type": "value"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "COMPARISON",
          "ESTIMATION",
          "MULTI_STEP"
        ],
        "template": "{character} goes to the shop and buys {items}. How much does {character} spend in total?",
        "answerTemplate": "{character} spends {result} in total",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "items",
            "type": "item_list"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "ESTIMATION"
        ],
        "template": "Estimate: If {character} buys {items}, about how much will it cost?",
        "answerTemplate": "It will cost approximately {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "items",
            "type": "item_list"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "VALIDATION"
        ],
        "template": "{character} calculated that {items} costs {amount}. Is this correct?",
        "answerTemplate": "{validation_result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "items",
            "type": "item_list"
          },
          {
            "key": "amount",
            "type": "value"
          },
          {
            "key": "validation_result",
            "type": "boolean"
          }
        ]
      }
    ]
  }
}
# Test A.2: Basic SUBTRACTION request
{
  "success": true,
  "question": {
    "text": "Liam buys an apple for 23p and pays with £2. How much change does Liam get?",
    "options": [
      {
        "text": "£1.77",
        "value": 1.77,
        "index": 0
      },
      {
        "text": "0.77",
        "value": 0.77,
        "index": 1
      },
      {
        "text": "12",
        "value": 12,
        "index": 2
      },
      {
        "text": "2.77",
        "value": 2.77,
        "index": 3
      }
    ],
    "correctIndex": 0,
    "format": "DIRECT_CALCULATION",
    "difficulty": {
      "year": 1,
      "subLevel": 2,
      "displayName": "1.2",
      "cognitiveLoad": 15
    },
    "cognitiveLoad": 15,
    "curriculumTags": [
      "1N1c",
      "1N1d"
    ],
    "scenario": {
      "id": "shop-002-realistic-general",
      "theme": "SHOPPING",
      "setting": {
        "location": "local shop",
        "timeContext": "after school",
        "atmosphere": "friendly"
      },
      "characters": [
        {
          "name": "Liam",
          "role": "student"
        }
      ],
      "items": [
        {
          "name": "apple",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.2,
            "max": 0.5,
            "typical": 0.35,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "banana",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.15,
            "max": 0.4,
            "typical": 0.25,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "sandwich",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 2.5,
            "max": 6,
            "typical": 4,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "drink",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.8,
            "max": 2.5,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "cake",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 1.5,
            "max": 4,
            "typical": 2.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "biscuit",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.8,
            "max": 2,
            "typical": 1.2,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "sweet",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.1,
            "max": 1,
            "typical": 0.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "chocolate",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.6,
            "max": 3,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "pen",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.5,
            "max": 2,
            "typical": 1,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "pencil",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.2,
            "max": 1,
            "typical": 0.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "ruler",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.8,
            "max": 2.5,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "notebook",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 1,
            "max": 4,
            "typical": 2,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "eraser",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.3,
            "max": 1.5,
            "typical": 0.75,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "book",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 3,
            "max": 15,
            "typical": 8,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "comic",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 2,
            "max": 5,
            "typical": 3,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "magazine",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 2.5,
            "max": 6,
            "typical": 4,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "toy",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 5,
            "max": 25,
            "typical": 12,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "game",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 8,
            "max": 60,
            "typical": 25,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "puzzle",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 5,
            "max": 20,
            "typical": 12,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "sticker",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 0.2,
            "max": 2,
            "typical": 0.8,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "badge",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 0.5,
            "max": 3,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "poster",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 2,
            "max": 8,
            "typical": 4,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "card",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 0.5,
            "max": 4,
            "typical": 2,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        }
      ],
      "culturalElements": [
        {
          "type": "currency",
          "value": "£",
          "explanation": "British pounds"
        },
        {
          "type": "location",
          "value": "UK local shop",
          "explanation": "Typical British corner shop"
        }
      ],
      "realWorldConnection": "Everyday shopping with realistic UK prices",
      "yearAppropriate": [
        1,
        2,
        3,
        4,
        5,
        6
      ],
      "templates": [
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "MULTI_STEP"
          ],
          "modelCompatibility": [
            "ADDITION"
          ],
          "operandCount": 3,
          "template": "{character} buys {article1} {item1} for {price1}, {article2} {item2} for {price2}, and {article3} {item3} for {price3}. What is the total cost?",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item1",
              "type": "item"
            },
            {
              "key": "item2",
              "type": "item"
            },
            {
              "key": "item3",
              "type": "item"
            },
            {
              "key": "price1",
              "type": "value"
            },
            {
              "key": "price2",
              "type": "value"
            },
            {
              "key": "price3",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "MULTI_STEP"
          ],
          "modelCompatibility": [
            "ADDITION"
          ],
          "operandCount": 2,
          "template": "{character} buys {article1} {item1} for {price1} and {article2} {item2} for {price2}. What is the total cost?",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item1",
              "type": "item"
            },
            {
              "key": "item2",
              "type": "item"
            },
            {
              "key": "price1",
              "type": "value"
            },
            {
              "key": "price2",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION"
          ],
          "modelCompatibility": [
            "SUBTRACTION",
            "CHANGE_CALCULATION"
          ],
          "template": "{character} buys {article} {item} for {price} and pays with {payment}. How much change does {character} get?",
          "answerTemplate": "{character} receives {result} in change",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "price",
              "type": "value"
            },
            {
              "key": "payment",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION"
          ],
          "modelCompatibility": [
            "MULTIPLICATION"
          ],
          "template": "{character} buys {quantity} {item} at {price} each. What is the total cost?",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "quantity",
              "type": "value"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "price",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION"
          ],
          "modelCompatibility": [
            "DIVISION"
          ],
          "template": "{character} has {total} to spend equally on {quantity} {item}. How much can {character} spend on each one?",
          "answerTemplate": "{character} can spend {result} on each {item}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "total",
              "type": "value"
            },
            {
              "key": "quantity",
              "type": "value"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "COMPARISON",
            "ESTIMATION",
            "MULTI_STEP"
          ],
          "template": "{character} goes to the shop and buys {items}. How much does {character} spend in total?",
          "answerTemplate": "{character} spends {result} in total",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "items",
              "type": "item_list"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "ESTIMATION"
          ],
          "template": "Estimate: If {character} buys {items}, about how much will it cost?",
          "answerTemplate": "It will cost approximately {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "items",
              "type": "item_list"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "VALIDATION"
          ],
          "template": "{character} calculated that {items} costs {amount}. Is this correct?",
          "answerTemplate": "{validation_result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "items",
              "type": "item_list"
            },
            {
              "key": "amount",
              "type": "value"
            },
            {
              "key": "validation_result",
              "type": "boolean"
            }
          ]
        }
      ]
    },
    "distractors": [
      {
        "value": 12,
        "displayText": "12",
        "strategy": "WRONG_OPERATION",
        "reasoning": "Added instead of subtracting"
      },
      {
        "value": 2.77,
        "displayText": "2.77",
        "strategy": "CLOSE_VALUE",
        "reasoning": "Off by 1"
      },
      {
        "value": 0.77,
        "displayText": "0.77",
        "strategy": "CLOSE_VALUE",
        "reasoning": "Off by 1"
      }
    ],
    "enhancementStatus": {
      "level": "partial",
      "requestedFormat": "DIRECT_CALCULATION",
      "actualFormat": "DIRECT_CALCULATION",
      "featuresActive": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "featuresPending": [],
      "isFullyEnhanced": true
    },
    "mathOutput": {
      "operation": "SUBTRACTION",
      "subtrahend": 0.23,
      "minuend": 2,
      "result": 1.77
    },
    "generationTime": 1,
    "questionId": "q_1759234376514_brsp6uxph",
    "generationSetup": {
      "controller_used": "DIRECT_CALCULATIONController",
      "format_requested": "DIRECT_CALCULATION",
      "format_actual": "DIRECT_CALCULATION",
      "scenario_theme": "SHOPPING",
      "scenario_id": "shop-002-realistic-general",
      "scenario_selection_method": "default",
      "distractor_strategies": [
        "WRONG_OPERATION",
        "CLOSE_VALUE",
        "CLOSE_VALUE"
      ],
      "distractor_count": 3,
      "theme_variety": false,
      "format_variety": false,
      "enhancement_level": "partial",
      "features_active": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "features_pending": [],
      "generation_time_ms": 1
    }
  },
  "metadata": {
    "format": "DIRECT_CALCULATION",
    "cognitive_load": 15,
    "curriculum_alignment": [
      "1N1c",
      "1N1d"
    ],
    "difficulty": "1.2",
    "scenario_theme": "SHOPPING",
    "distractor_strategies": [
      "WRONG_OPERATION",
      "CLOSE_VALUE",
      "CLOSE_VALUE"
    ],
    "generation_time_ms": 1,
    "api_version": "2.0",
    "enhancement_status": "partial",
    "format_requested": "DIRECT_CALCULATION",
    "format_used": "DIRECT_CALCULATION",
    "features_active": [
      "enhanced_distractors",
      "rich_scenarios",
      "cognitive_load",
      "advanced_formats"
    ],
    "features_pending": []
  },
  "context": {
    "id": "shop-002-realistic-general",
    "theme": "SHOPPING",
    "setting": {
      "location": "local shop",
      "timeContext": "after school",
      "atmosphere": "friendly"
    },
    "characters": [
      {
        "name": "Liam",
        "role": "student"
      }
    ],
    "items": [
      {
        "name": "apple",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.2,
          "max": 0.5,
          "typical": 0.35,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "banana",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.15,
          "max": 0.4,
          "typical": 0.25,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "sandwich",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 2.5,
          "max": 6,
          "typical": 4,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "drink",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.8,
          "max": 2.5,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "cake",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 1.5,
          "max": 4,
          "typical": 2.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "biscuit",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.8,
          "max": 2,
          "typical": 1.2,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "sweet",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.1,
          "max": 1,
          "typical": 0.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "chocolate",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.6,
          "max": 3,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "pen",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.5,
          "max": 2,
          "typical": 1,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "pencil",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.2,
          "max": 1,
          "typical": 0.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "ruler",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.8,
          "max": 2.5,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "notebook",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 1,
          "max": 4,
          "typical": 2,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "eraser",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.3,
          "max": 1.5,
          "typical": 0.75,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "book",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 3,
          "max": 15,
          "typical": 8,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "comic",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 2,
          "max": 5,
          "typical": 3,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "magazine",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 2.5,
          "max": 6,
          "typical": 4,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "toy",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 5,
          "max": 25,
          "typical": 12,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "game",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 8,
          "max": 60,
          "typical": 25,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "puzzle",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 5,
          "max": 20,
          "typical": 12,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "sticker",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 0.2,
          "max": 2,
          "typical": 0.8,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "badge",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 0.5,
          "max": 3,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "poster",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 2,
          "max": 8,
          "typical": 4,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "card",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 0.5,
          "max": 4,
          "typical": 2,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      }
    ],
    "culturalElements": [
      {
        "type": "currency",
        "value": "£",
        "explanation": "British pounds"
      },
      {
        "type": "location",
        "value": "UK local shop",
        "explanation": "Typical British corner shop"
      }
    ],
    "realWorldConnection": "Everyday shopping with realistic UK prices",
    "yearAppropriate": [
      1,
      2,
      3,
      4,
      5,
      6
    ],
    "templates": [
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "MULTI_STEP"
        ],
        "modelCompatibility": [
          "ADDITION"
        ],
        "operandCount": 3,
        "template": "{character} buys {article1} {item1} for {price1}, {article2} {item2} for {price2}, and {article3} {item3} for {price3}. What is the total cost?",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item1",
            "type": "item"
          },
          {
            "key": "item2",
            "type": "item"
          },
          {
            "key": "item3",
            "type": "item"
          },
          {
            "key": "price1",
            "type": "value"
          },
          {
            "key": "price2",
            "type": "value"
          },
          {
            "key": "price3",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "MULTI_STEP"
        ],
        "modelCompatibility": [
          "ADDITION"
        ],
        "operandCount": 2,
        "template": "{character} buys {article1} {item1} for {price1} and {article2} {item2} for {price2}. What is the total cost?",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item1",
            "type": "item"
          },
          {
            "key": "item2",
            "type": "item"
          },
          {
            "key": "price1",
            "type": "value"
          },
          {
            "key": "price2",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION"
        ],
        "modelCompatibility": [
          "SUBTRACTION",
          "CHANGE_CALCULATION"
        ],
        "template": "{character} buys {article} {item} for {price} and pays with {payment}. How much change does {character} get?",
        "answerTemplate": "{character} receives {result} in change",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "price",
            "type": "value"
          },
          {
            "key": "payment",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION"
        ],
        "modelCompatibility": [
          "MULTIPLICATION"
        ],
        "template": "{character} buys {quantity} {item} at {price} each. What is the total cost?",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "quantity",
            "type": "value"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "price",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION"
        ],
        "modelCompatibility": [
          "DIVISION"
        ],
        "template": "{character} has {total} to spend equally on {quantity} {item}. How much can {character} spend on each one?",
        "answerTemplate": "{character} can spend {result} on each {item}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "total",
            "type": "value"
          },
          {
            "key": "quantity",
            "type": "value"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "COMPARISON",
          "ESTIMATION",
          "MULTI_STEP"
        ],
        "template": "{character} goes to the shop and buys {items}. How much does {character} spend in total?",
        "answerTemplate": "{character} spends {result} in total",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "items",
            "type": "item_list"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "ESTIMATION"
        ],
        "template": "Estimate: If {character} buys {items}, about how much will it cost?",
        "answerTemplate": "It will cost approximately {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "items",
            "type": "item_list"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "VALIDATION"
        ],
        "template": "{character} calculated that {items} costs {amount}. Is this correct?",
        "answerTemplate": "{validation_result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "items",
            "type": "item_list"
          },
          {
            "key": "amount",
            "type": "value"
          },
          {
            "key": "validation_result",
            "type": "boolean"
          }
        ]
      }
    ]
  }
}

--- SUITE B: MODEL COVERAGE TESTS ---
Testing every mathematical model to ensure basic generation and catch crashes...
# Test B.1: ADDITION model
{
  "success": true,
  "question": {
    "text": "Sarah wants to buy books at the book fair. Calculate the total cost.",
    "options": [
      {
        "text": "£14.37",
        "value": 14.37,
        "index": 0
      },
      {
        "text": "24.37",
        "value": 24.369999999999997,
        "index": 1
      },
      {
        "text": "8.28",
        "value": 8.28,
        "index": 2
      },
      {
        "text": "7.46",
        "value": 7.46,
        "index": 3
      }
    ],
    "correctIndex": 0,
    "format": "DIRECT_CALCULATION",
    "difficulty": {
      "year": 4,
      "subLevel": 1,
      "displayName": "4.1",
      "cognitiveLoad": 40
    },
    "cognitiveLoad": 40,
    "curriculumTags": [
      "4N1a",
      "4N1b"
    ],
    "scenario": {
      "id": "shop-001-bookfair",
      "theme": "SHOPPING",
      "setting": {
        "location": "school book fair",
        "timeContext": "lunch break",
        "atmosphere": "busy"
      },
      "characters": [
        {
          "name": "Sarah",
          "role": "student"
        },
        {
          "name": "Mr. Johnson",
          "role": "teacher"
        }
      ],
      "items": [
        {
          "name": "book",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 3,
            "max": 12,
            "typical": 6.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "bookmark",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.5,
            "max": 2,
            "typical": 1,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        }
      ],
      "culturalElements": [
        {
          "type": "currency",
          "value": "£",
          "explanation": "British pounds"
        },
        {
          "type": "event",
          "value": "book fair",
          "explanation": "School fundraising event"
        }
      ],
      "realWorldConnection": "School fundraising and reading promotion",
      "yearAppropriate": [
        2,
        3,
        4,
        5
      ],
      "templates": [
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "COMPARISON"
          ],
          "modelCompatibility": [
            "ADDITION",
            "COUNTING"
          ],
          "template": "{character} wants to buy books at the book fair. Calculate the total cost.",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        }
      ]
    },
    "distractors": [
      {
        "value": 8.28,
        "displayText": "8.28",
        "strategy": "WRONG_OPERATION",
        "reasoning": "Subtracted instead of adding"
      },
      {
        "value": 7.46,
        "displayText": "7.46",
        "strategy": "WRONG_OPERATION",
        "reasoning": "Multiplied instead of adding"
      },
      {
        "value": 24.369999999999997,
        "displayText": "24.37",
        "strategy": "PLACE_VALUE_ERROR",
        "reasoning": "Error in carrying to next column"
      }
    ],
    "enhancementStatus": {
      "level": "partial",
      "requestedFormat": "DIRECT_CALCULATION",
      "actualFormat": "DIRECT_CALCULATION",
      "featuresActive": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "featuresPending": [],
      "isFullyEnhanced": true
    },
    "mathOutput": {
      "operation": "ADDITION",
      "operand_1": 9.1,
      "operand_2": 0.82,
      "operand_3": 4.45,
      "result": 14.37
    },
    "generationTime": 1,
    "questionId": "q_1759234376559_0h6ktydrc",
    "generationSetup": {
      "controller_used": "DIRECT_CALCULATIONController",
      "format_requested": "DIRECT_CALCULATION",
      "format_actual": "DIRECT_CALCULATION",
      "scenario_theme": "SHOPPING",
      "scenario_id": "shop-001-bookfair",
      "scenario_selection_method": "default",
      "distractor_strategies": [
        "WRONG_OPERATION",
        "WRONG_OPERATION",
        "PLACE_VALUE_ERROR"
      ],
      "distractor_count": 3,
      "theme_variety": false,
      "format_variety": false,
      "enhancement_level": "partial",
      "features_active": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "features_pending": [],
      "generation_time_ms": 1
    }
  },
  "metadata": {
    "format": "DIRECT_CALCULATION",
    "cognitive_load": 40,
    "curriculum_alignment": [
      "4N1a",
      "4N1b"
    ],
    "difficulty": "4.1",
    "scenario_theme": "SHOPPING",
    "distractor_strategies": [
      "WRONG_OPERATION",
      "WRONG_OPERATION",
      "PLACE_VALUE_ERROR"
    ],
    "generation_time_ms": 1,
    "api_version": "2.0",
    "enhancement_status": "partial",
    "format_requested": "DIRECT_CALCULATION",
    "format_used": "DIRECT_CALCULATION",
    "features_active": [
      "enhanced_distractors",
      "rich_scenarios",
      "cognitive_load",
      "advanced_formats"
    ],
    "features_pending": []
  },
  "context": {
    "id": "shop-001-bookfair",
    "theme": "SHOPPING",
    "setting": {
      "location": "school book fair",
      "timeContext": "lunch break",
      "atmosphere": "busy"
    },
    "characters": [
      {
        "name": "Sarah",
        "role": "student"
      },
      {
        "name": "Mr. Johnson",
        "role": "teacher"
      }
    ],
    "items": [
      {
        "name": "book",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 3,
          "max": 12,
          "typical": 6.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "bookmark",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.5,
          "max": 2,
          "typical": 1,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      }
    ],
    "culturalElements": [
      {
        "type": "currency",
        "value": "£",
        "explanation": "British pounds"
      },
      {
        "type": "event",
        "value": "book fair",
        "explanation": "School fundraising event"
      }
    ],
    "realWorldConnection": "School fundraising and reading promotion",
    "yearAppropriate": [
      2,
      3,
      4,
      5
    ],
    "templates": [
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "COMPARISON"
        ],
        "modelCompatibility": [
          "ADDITION",
          "COUNTING"
        ],
        "template": "{character} wants to buy books at the book fair. Calculate the total cost.",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      }
    ]
  }
}
# Test B.2: SUBTRACTION model
{
  "success": true,
  "question": {
    "text": "Liam buys an apple for 36p and pays with £2. How much change does Liam get?",
    "options": [
      {
        "text": "£1.64",
        "value": 1.64,
        "index": 0
      },
      {
        "text": "3.64",
        "value": 3.64,
        "index": 1
      },
      {
        "text": "223",
        "value": 223,
        "index": 2
      },
      {
        "text": "2.64",
        "value": 2.64,
        "index": 3
      }
    ],
    "correctIndex": 0,
    "format": "DIRECT_CALCULATION",
    "difficulty": {
      "year": 4,
      "subLevel": 1,
      "displayName": "4.1",
      "cognitiveLoad": 40
    },
    "cognitiveLoad": 40,
    "curriculumTags": [
      "4N1c",
      "4N1d"
    ],
    "scenario": {
      "id": "shop-002-realistic-general",
      "theme": "SHOPPING",
      "setting": {
        "location": "local shop",
        "timeContext": "after school",
        "atmosphere": "friendly"
      },
      "characters": [
        {
          "name": "Liam",
          "role": "student"
        }
      ],
      "items": [
        {
          "name": "apple",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.2,
            "max": 0.5,
            "typical": 0.35,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "banana",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.15,
            "max": 0.4,
            "typical": 0.25,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "sandwich",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 2.5,
            "max": 6,
            "typical": 4,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "drink",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.8,
            "max": 2.5,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "cake",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 1.5,
            "max": 4,
            "typical": 2.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "biscuit",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.8,
            "max": 2,
            "typical": 1.2,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "sweet",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.1,
            "max": 1,
            "typical": 0.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "chocolate",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.6,
            "max": 3,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "pen",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.5,
            "max": 2,
            "typical": 1,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "pencil",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.2,
            "max": 1,
            "typical": 0.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "ruler",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.8,
            "max": 2.5,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "notebook",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 1,
            "max": 4,
            "typical": 2,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "eraser",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.3,
            "max": 1.5,
            "typical": 0.75,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "book",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 3,
            "max": 15,
            "typical": 8,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "comic",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 2,
            "max": 5,
            "typical": 3,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "magazine",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 2.5,
            "max": 6,
            "typical": 4,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "toy",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 5,
            "max": 25,
            "typical": 12,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "game",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 8,
            "max": 60,
            "typical": 25,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "puzzle",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 5,
            "max": 20,
            "typical": 12,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "sticker",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 0.2,
            "max": 2,
            "typical": 0.8,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "badge",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 0.5,
            "max": 3,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "poster",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 2,
            "max": 8,
            "typical": 4,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "card",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 0.5,
            "max": 4,
            "typical": 2,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        }
      ],
      "culturalElements": [
        {
          "type": "currency",
          "value": "£",
          "explanation": "British pounds"
        },
        {
          "type": "location",
          "value": "UK local shop",
          "explanation": "Typical British corner shop"
        }
      ],
      "realWorldConnection": "Everyday shopping with realistic UK prices",
      "yearAppropriate": [
        1,
        2,
        3,
        4,
        5,
        6
      ],
      "templates": [
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "MULTI_STEP"
          ],
          "modelCompatibility": [
            "ADDITION"
          ],
          "operandCount": 3,
          "template": "{character} buys {article1} {item1} for {price1}, {article2} {item2} for {price2}, and {article3} {item3} for {price3}. What is the total cost?",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item1",
              "type": "item"
            },
            {
              "key": "item2",
              "type": "item"
            },
            {
              "key": "item3",
              "type": "item"
            },
            {
              "key": "price1",
              "type": "value"
            },
            {
              "key": "price2",
              "type": "value"
            },
            {
              "key": "price3",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "MULTI_STEP"
          ],
          "modelCompatibility": [
            "ADDITION"
          ],
          "operandCount": 2,
          "template": "{character} buys {article1} {item1} for {price1} and {article2} {item2} for {price2}. What is the total cost?",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item1",
              "type": "item"
            },
            {
              "key": "item2",
              "type": "item"
            },
            {
              "key": "price1",
              "type": "value"
            },
            {
              "key": "price2",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION"
          ],
          "modelCompatibility": [
            "SUBTRACTION",
            "CHANGE_CALCULATION"
          ],
          "template": "{character} buys {article} {item} for {price} and pays with {payment}. How much change does {character} get?",
          "answerTemplate": "{character} receives {result} in change",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "price",
              "type": "value"
            },
            {
              "key": "payment",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION"
          ],
          "modelCompatibility": [
            "MULTIPLICATION"
          ],
          "template": "{character} buys {quantity} {item} at {price} each. What is the total cost?",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "quantity",
              "type": "value"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "price",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION"
          ],
          "modelCompatibility": [
            "DIVISION"
          ],
          "template": "{character} has {total} to spend equally on {quantity} {item}. How much can {character} spend on each one?",
          "answerTemplate": "{character} can spend {result} on each {item}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "total",
              "type": "value"
            },
            {
              "key": "quantity",
              "type": "value"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "COMPARISON",
            "ESTIMATION",
            "MULTI_STEP"
          ],
          "template": "{character} goes to the shop and buys {items}. How much does {character} spend in total?",
          "answerTemplate": "{character} spends {result} in total",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "items",
              "type": "item_list"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "ESTIMATION"
          ],
          "template": "Estimate: If {character} buys {items}, about how much will it cost?",
          "answerTemplate": "It will cost approximately {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "items",
              "type": "item_list"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "VALIDATION"
          ],
          "template": "{character} calculated that {items} costs {amount}. Is this correct?",
          "answerTemplate": "{validation_result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "items",
              "type": "item_list"
            },
            {
              "key": "amount",
              "type": "value"
            },
            {
              "key": "validation_result",
              "type": "boolean"
            }
          ]
        }
      ]
    },
    "distractors": [
      {
        "value": 223,
        "displayText": "223",
        "strategy": "WRONG_OPERATION",
        "reasoning": "Added instead of subtracting"
      },
      {
        "value": 2.64,
        "displayText": "2.64",
        "strategy": "CLOSE_VALUE",
        "reasoning": "Off by 1"
      },
      {
        "value": 3.64,
        "displayText": "3.64",
        "strategy": "CLOSE_VALUE",
        "reasoning": "Off by 2"
      }
    ],
    "enhancementStatus": {
      "level": "partial",
      "requestedFormat": "DIRECT_CALCULATION",
      "actualFormat": "DIRECT_CALCULATION",
      "featuresActive": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "featuresPending": [],
      "isFullyEnhanced": true
    },
    "mathOutput": {
      "operation": "SUBTRACTION",
      "subtrahend": 0.36,
      "minuend": 2,
      "result": 1.64
    },
    "generationTime": 1,
    "questionId": "q_1759234376605_as15tbv56",
    "generationSetup": {
      "controller_used": "DIRECT_CALCULATIONController",
      "format_requested": "DIRECT_CALCULATION",
      "format_actual": "DIRECT_CALCULATION",
      "scenario_theme": "SHOPPING",
      "scenario_id": "shop-002-realistic-general",
      "scenario_selection_method": "default",
      "distractor_strategies": [
        "WRONG_OPERATION",
        "CLOSE_VALUE",
        "CLOSE_VALUE"
      ],
      "distractor_count": 3,
      "theme_variety": false,
      "format_variety": false,
      "enhancement_level": "partial",
      "features_active": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "features_pending": [],
      "generation_time_ms": 1
    }
  },
  "metadata": {
    "format": "DIRECT_CALCULATION",
    "cognitive_load": 40,
    "curriculum_alignment": [
      "4N1c",
      "4N1d"
    ],
    "difficulty": "4.1",
    "scenario_theme": "SHOPPING",
    "distractor_strategies": [
      "WRONG_OPERATION",
      "CLOSE_VALUE",
      "CLOSE_VALUE"
    ],
    "generation_time_ms": 1,
    "api_version": "2.0",
    "enhancement_status": "partial",
    "format_requested": "DIRECT_CALCULATION",
    "format_used": "DIRECT_CALCULATION",
    "features_active": [
      "enhanced_distractors",
      "rich_scenarios",
      "cognitive_load",
      "advanced_formats"
    ],
    "features_pending": []
  },
  "context": {
    "id": "shop-002-realistic-general",
    "theme": "SHOPPING",
    "setting": {
      "location": "local shop",
      "timeContext": "after school",
      "atmosphere": "friendly"
    },
    "characters": [
      {
        "name": "Liam",
        "role": "student"
      }
    ],
    "items": [
      {
        "name": "apple",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.2,
          "max": 0.5,
          "typical": 0.35,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "banana",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.15,
          "max": 0.4,
          "typical": 0.25,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "sandwich",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 2.5,
          "max": 6,
          "typical": 4,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "drink",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.8,
          "max": 2.5,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "cake",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 1.5,
          "max": 4,
          "typical": 2.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "biscuit",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.8,
          "max": 2,
          "typical": 1.2,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "sweet",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.1,
          "max": 1,
          "typical": 0.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "chocolate",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.6,
          "max": 3,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "pen",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.5,
          "max": 2,
          "typical": 1,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "pencil",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.2,
          "max": 1,
          "typical": 0.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "ruler",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.8,
          "max": 2.5,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "notebook",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 1,
          "max": 4,
          "typical": 2,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "eraser",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.3,
          "max": 1.5,
          "typical": 0.75,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "book",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 3,
          "max": 15,
          "typical": 8,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "comic",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 2,
          "max": 5,
          "typical": 3,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "magazine",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 2.5,
          "max": 6,
          "typical": 4,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "toy",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 5,
          "max": 25,
          "typical": 12,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "game",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 8,
          "max": 60,
          "typical": 25,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "puzzle",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 5,
          "max": 20,
          "typical": 12,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "sticker",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 0.2,
          "max": 2,
          "typical": 0.8,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "badge",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 0.5,
          "max": 3,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "poster",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 2,
          "max": 8,
          "typical": 4,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "card",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 0.5,
          "max": 4,
          "typical": 2,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      }
    ],
    "culturalElements": [
      {
        "type": "currency",
        "value": "£",
        "explanation": "British pounds"
      },
      {
        "type": "location",
        "value": "UK local shop",
        "explanation": "Typical British corner shop"
      }
    ],
    "realWorldConnection": "Everyday shopping with realistic UK prices",
    "yearAppropriate": [
      1,
      2,
      3,
      4,
      5,
      6
    ],
    "templates": [
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "MULTI_STEP"
        ],
        "modelCompatibility": [
          "ADDITION"
        ],
        "operandCount": 3,
        "template": "{character} buys {article1} {item1} for {price1}, {article2} {item2} for {price2}, and {article3} {item3} for {price3}. What is the total cost?",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item1",
            "type": "item"
          },
          {
            "key": "item2",
            "type": "item"
          },
          {
            "key": "item3",
            "type": "item"
          },
          {
            "key": "price1",
            "type": "value"
          },
          {
            "key": "price2",
            "type": "value"
          },
          {
            "key": "price3",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "MULTI_STEP"
        ],
        "modelCompatibility": [
          "ADDITION"
        ],
        "operandCount": 2,
        "template": "{character} buys {article1} {item1} for {price1} and {article2} {item2} for {price2}. What is the total cost?",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item1",
            "type": "item"
          },
          {
            "key": "item2",
            "type": "item"
          },
          {
            "key": "price1",
            "type": "value"
          },
          {
            "key": "price2",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION"
        ],
        "modelCompatibility": [
          "SUBTRACTION",
          "CHANGE_CALCULATION"
        ],
        "template": "{character} buys {article} {item} for {price} and pays with {payment}. How much change does {character} get?",
        "answerTemplate": "{character} receives {result} in change",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "price",
            "type": "value"
          },
          {
            "key": "payment",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION"
        ],
        "modelCompatibility": [
          "MULTIPLICATION"
        ],
        "template": "{character} buys {quantity} {item} at {price} each. What is the total cost?",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "quantity",
            "type": "value"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "price",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION"
        ],
        "modelCompatibility": [
          "DIVISION"
        ],
        "template": "{character} has {total} to spend equally on {quantity} {item}. How much can {character} spend on each one?",
        "answerTemplate": "{character} can spend {result} on each {item}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "total",
            "type": "value"
          },
          {
            "key": "quantity",
            "type": "value"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "COMPARISON",
          "ESTIMATION",
          "MULTI_STEP"
        ],
        "template": "{character} goes to the shop and buys {items}. How much does {character} spend in total?",
        "answerTemplate": "{character} spends {result} in total",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "items",
            "type": "item_list"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "ESTIMATION"
        ],
        "template": "Estimate: If {character} buys {items}, about how much will it cost?",
        "answerTemplate": "It will cost approximately {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "items",
            "type": "item_list"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "VALIDATION"
        ],
        "template": "{character} calculated that {items} costs {amount}. Is this correct?",
        "answerTemplate": "{validation_result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "items",
            "type": "item_list"
          },
          {
            "key": "amount",
            "type": "value"
          },
          {
            "key": "validation_result",
            "type": "boolean"
          }
        ]
      }
    ]
  }
}
# Test B.3: MULTIPLICATION model
{
  "success": true,
  "question": {
    "text": "Liam buys 5 apple at 28p each. What is the total cost?",
    "options": [
      {
        "text": "2.4",
        "value": 2.4,
        "index": 0
      },
      {
        "text": "19",
        "value": 19,
        "index": 1
      },
      {
        "text": "9",
        "value": 9,
        "index": 2
      },
      {
        "text": "£1.40",
        "value": 1.4,
        "index": 3
      }
    ],
    "correctIndex": 3,
    "format": "DIRECT_CALCULATION",
    "difficulty": {
      "year": 4,
      "subLevel": 1,
      "displayName": "4.1",
      "cognitiveLoad": 40
    },
    "cognitiveLoad": 40,
    "curriculumTags": [
      "4N1a"
    ],
    "scenario": {
      "id": "shop-002-realistic-general",
      "theme": "SHOPPING",
      "setting": {
        "location": "local shop",
        "timeContext": "after school",
        "atmosphere": "friendly"
      },
      "characters": [
        {
          "name": "Liam",
          "role": "student"
        }
      ],
      "items": [
        {
          "name": "apple",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.2,
            "max": 0.5,
            "typical": 0.35,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "banana",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.15,
            "max": 0.4,
            "typical": 0.25,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "sandwich",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 2.5,
            "max": 6,
            "typical": 4,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "drink",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.8,
            "max": 2.5,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "cake",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 1.5,
            "max": 4,
            "typical": 2.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "biscuit",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.8,
            "max": 2,
            "typical": 1.2,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "sweet",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.1,
            "max": 1,
            "typical": 0.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "chocolate",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.6,
            "max": 3,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "pen",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.5,
            "max": 2,
            "typical": 1,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "pencil",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.2,
            "max": 1,
            "typical": 0.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "ruler",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.8,
            "max": 2.5,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "notebook",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 1,
            "max": 4,
            "typical": 2,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "eraser",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.3,
            "max": 1.5,
            "typical": 0.75,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "book",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 3,
            "max": 15,
            "typical": 8,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "comic",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 2,
            "max": 5,
            "typical": 3,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "magazine",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 2.5,
            "max": 6,
            "typical": 4,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "toy",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 5,
            "max": 25,
            "typical": 12,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "game",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 8,
            "max": 60,
            "typical": 25,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "puzzle",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 5,
            "max": 20,
            "typical": 12,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "sticker",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 0.2,
            "max": 2,
            "typical": 0.8,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "badge",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 0.5,
            "max": 3,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "poster",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 2,
            "max": 8,
            "typical": 4,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "card",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 0.5,
            "max": 4,
            "typical": 2,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        }
      ],
      "culturalElements": [
        {
          "type": "currency",
          "value": "£",
          "explanation": "British pounds"
        },
        {
          "type": "location",
          "value": "UK local shop",
          "explanation": "Typical British corner shop"
        }
      ],
      "realWorldConnection": "Everyday shopping with realistic UK prices",
      "yearAppropriate": [
        1,
        2,
        3,
        4,
        5,
        6
      ],
      "templates": [
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "MULTI_STEP"
          ],
          "modelCompatibility": [
            "ADDITION"
          ],
          "operandCount": 3,
          "template": "{character} buys {article1} {item1} for {price1}, {article2} {item2} for {price2}, and {article3} {item3} for {price3}. What is the total cost?",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item1",
              "type": "item"
            },
            {
              "key": "item2",
              "type": "item"
            },
            {
              "key": "item3",
              "type": "item"
            },
            {
              "key": "price1",
              "type": "value"
            },
            {
              "key": "price2",
              "type": "value"
            },
            {
              "key": "price3",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "MULTI_STEP"
          ],
          "modelCompatibility": [
            "ADDITION"
          ],
          "operandCount": 2,
          "template": "{character} buys {article1} {item1} for {price1} and {article2} {item2} for {price2}. What is the total cost?",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item1",
              "type": "item"
            },
            {
              "key": "item2",
              "type": "item"
            },
            {
              "key": "price1",
              "type": "value"
            },
            {
              "key": "price2",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION"
          ],
          "modelCompatibility": [
            "SUBTRACTION",
            "CHANGE_CALCULATION"
          ],
          "template": "{character} buys {article} {item} for {price} and pays with {payment}. How much change does {character} get?",
          "answerTemplate": "{character} receives {result} in change",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "price",
              "type": "value"
            },
            {
              "key": "payment",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION"
          ],
          "modelCompatibility": [
            "MULTIPLICATION"
          ],
          "template": "{character} buys {quantity} {item} at {price} each. What is the total cost?",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "quantity",
              "type": "value"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "price",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION"
          ],
          "modelCompatibility": [
            "DIVISION"
          ],
          "template": "{character} has {total} to spend equally on {quantity} {item}. How much can {character} spend on each one?",
          "answerTemplate": "{character} can spend {result} on each {item}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "total",
              "type": "value"
            },
            {
              "key": "quantity",
              "type": "value"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "COMPARISON",
            "ESTIMATION",
            "MULTI_STEP"
          ],
          "template": "{character} goes to the shop and buys {items}. How much does {character} spend in total?",
          "answerTemplate": "{character} spends {result} in total",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "items",
              "type": "item_list"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "ESTIMATION"
          ],
          "template": "Estimate: If {character} buys {items}, about how much will it cost?",
          "answerTemplate": "It will cost approximately {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "items",
              "type": "item_list"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "VALIDATION"
          ],
          "template": "{character} calculated that {items} costs {amount}. Is this correct?",
          "answerTemplate": "{validation_result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "items",
              "type": "item_list"
            },
            {
              "key": "amount",
              "type": "value"
            },
            {
              "key": "validation_result",
              "type": "boolean"
            }
          ]
        }
      ]
    },
    "distractors": [
      {
        "value": 19,
        "displayText": "19",
        "strategy": "WRONG_OPERATION",
        "reasoning": "Added instead of multiplying"
      },
      {
        "value": 9,
        "displayText": "9",
        "strategy": "WRONG_OPERATION",
        "reasoning": "Subtracted instead of multiplying"
      },
      {
        "value": 2.4,
        "displayText": "2.4",
        "strategy": "CLOSE_VALUE",
        "reasoning": "Off by 1"
      }
    ],
    "enhancementStatus": {
      "level": "partial",
      "requestedFormat": "DIRECT_CALCULATION",
      "actualFormat": "DIRECT_CALCULATION",
      "featuresActive": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "featuresPending": [],
      "isFullyEnhanced": true
    },
    "mathOutput": {
      "operation": "MULTIPLICATION",
      "multiplier": 5,
      "multiplicand": 0.28,
      "result": 1.4
    },
    "generationTime": 0,
    "questionId": "q_1759234376656_dord50yet",
    "generationSetup": {
      "controller_used": "DIRECT_CALCULATIONController",
      "format_requested": "DIRECT_CALCULATION",
      "format_actual": "DIRECT_CALCULATION",
      "scenario_theme": "SHOPPING",
      "scenario_id": "shop-002-realistic-general",
      "scenario_selection_method": "default",
      "distractor_strategies": [
        "WRONG_OPERATION",
        "WRONG_OPERATION",
        "CLOSE_VALUE"
      ],
      "distractor_count": 3,
      "theme_variety": false,
      "format_variety": false,
      "enhancement_level": "partial",
      "features_active": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "features_pending": [],
      "generation_time_ms": 0
    }
  },
  "metadata": {
    "format": "DIRECT_CALCULATION",
    "cognitive_load": 40,
    "curriculum_alignment": [
      "4N1a"
    ],
    "difficulty": "4.1",
    "scenario_theme": "SHOPPING",
    "distractor_strategies": [
      "WRONG_OPERATION",
      "WRONG_OPERATION",
      "CLOSE_VALUE"
    ],
    "generation_time_ms": 0,
    "api_version": "2.0",
    "enhancement_status": "partial",
    "format_requested": "DIRECT_CALCULATION",
    "format_used": "DIRECT_CALCULATION",
    "features_active": [
      "enhanced_distractors",
      "rich_scenarios",
      "cognitive_load",
      "advanced_formats"
    ],
    "features_pending": []
  },
  "context": {
    "id": "shop-002-realistic-general",
    "theme": "SHOPPING",
    "setting": {
      "location": "local shop",
      "timeContext": "after school",
      "atmosphere": "friendly"
    },
    "characters": [
      {
        "name": "Liam",
        "role": "student"
      }
    ],
    "items": [
      {
        "name": "apple",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.2,
          "max": 0.5,
          "typical": 0.35,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "banana",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.15,
          "max": 0.4,
          "typical": 0.25,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "sandwich",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 2.5,
          "max": 6,
          "typical": 4,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "drink",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.8,
          "max": 2.5,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "cake",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 1.5,
          "max": 4,
          "typical": 2.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "biscuit",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.8,
          "max": 2,
          "typical": 1.2,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "sweet",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.1,
          "max": 1,
          "typical": 0.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "chocolate",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.6,
          "max": 3,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "pen",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.5,
          "max": 2,
          "typical": 1,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "pencil",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.2,
          "max": 1,
          "typical": 0.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "ruler",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.8,
          "max": 2.5,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "notebook",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 1,
          "max": 4,
          "typical": 2,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "eraser",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.3,
          "max": 1.5,
          "typical": 0.75,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "book",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 3,
          "max": 15,
          "typical": 8,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "comic",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 2,
          "max": 5,
          "typical": 3,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "magazine",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 2.5,
          "max": 6,
          "typical": 4,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "toy",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 5,
          "max": 25,
          "typical": 12,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "game",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 8,
          "max": 60,
          "typical": 25,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "puzzle",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 5,
          "max": 20,
          "typical": 12,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "sticker",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 0.2,
          "max": 2,
          "typical": 0.8,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "badge",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 0.5,
          "max": 3,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "poster",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 2,
          "max": 8,
          "typical": 4,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "card",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 0.5,
          "max": 4,
          "typical": 2,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      }
    ],
    "culturalElements": [
      {
        "type": "currency",
        "value": "£",
        "explanation": "British pounds"
      },
      {
        "type": "location",
        "value": "UK local shop",
        "explanation": "Typical British corner shop"
      }
    ],
    "realWorldConnection": "Everyday shopping with realistic UK prices",
    "yearAppropriate": [
      1,
      2,
      3,
      4,
      5,
      6
    ],
    "templates": [
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "MULTI_STEP"
        ],
        "modelCompatibility": [
          "ADDITION"
        ],
        "operandCount": 3,
        "template": "{character} buys {article1} {item1} for {price1}, {article2} {item2} for {price2}, and {article3} {item3} for {price3}. What is the total cost?",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item1",
            "type": "item"
          },
          {
            "key": "item2",
            "type": "item"
          },
          {
            "key": "item3",
            "type": "item"
          },
          {
            "key": "price1",
            "type": "value"
          },
          {
            "key": "price2",
            "type": "value"
          },
          {
            "key": "price3",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "MULTI_STEP"
        ],
        "modelCompatibility": [
          "ADDITION"
        ],
        "operandCount": 2,
        "template": "{character} buys {article1} {item1} for {price1} and {article2} {item2} for {price2}. What is the total cost?",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item1",
            "type": "item"
          },
          {
            "key": "item2",
            "type": "item"
          },
          {
            "key": "price1",
            "type": "value"
          },
          {
            "key": "price2",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION"
        ],
        "modelCompatibility": [
          "SUBTRACTION",
          "CHANGE_CALCULATION"
        ],
        "template": "{character} buys {article} {item} for {price} and pays with {payment}. How much change does {character} get?",
        "answerTemplate": "{character} receives {result} in change",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "price",
            "type": "value"
          },
          {
            "key": "payment",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION"
        ],
        "modelCompatibility": [
          "MULTIPLICATION"
        ],
        "template": "{character} buys {quantity} {item} at {price} each. What is the total cost?",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "quantity",
            "type": "value"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "price",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION"
        ],
        "modelCompatibility": [
          "DIVISION"
        ],
        "template": "{character} has {total} to spend equally on {quantity} {item}. How much can {character} spend on each one?",
        "answerTemplate": "{character} can spend {result} on each {item}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "total",
            "type": "value"
          },
          {
            "key": "quantity",
            "type": "value"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "COMPARISON",
          "ESTIMATION",
          "MULTI_STEP"
        ],
        "template": "{character} goes to the shop and buys {items}. How much does {character} spend in total?",
        "answerTemplate": "{character} spends {result} in total",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "items",
            "type": "item_list"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "ESTIMATION"
        ],
        "template": "Estimate: If {character} buys {items}, about how much will it cost?",
        "answerTemplate": "It will cost approximately {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "items",
            "type": "item_list"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "VALIDATION"
        ],
        "template": "{character} calculated that {items} costs {amount}. Is this correct?",
        "answerTemplate": "{validation_result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "items",
            "type": "item_list"
          },
          {
            "key": "amount",
            "type": "value"
          },
          {
            "key": "validation_result",
            "type": "boolean"
          }
        ]
      }
    ]
  }
}
# Test B.4: DIVISION model
{
  "success": true,
  "question": {
    "text": "Liam has £1.90 to spend equally on 5 apple. How much can Liam spend on each one?",
    "options": [
      {
        "text": "5.38",
        "value": 5.38,
        "index": 0
      },
      {
        "text": "10",
        "value": 10,
        "index": 1
      },
      {
        "text": "38p",
        "value": 0.38,
        "index": 2
      },
      {
        "text": "2.38",
        "value": 2.38,
        "index": 3
      }
    ],
    "correctIndex": 2,
    "format": "DIRECT_CALCULATION",
    "difficulty": {
      "year": 4,
      "subLevel": 1,
      "displayName": "4.1",
      "cognitiveLoad": 40
    },
    "cognitiveLoad": 40,
    "curriculumTags": [
      "4N1a"
    ],
    "scenario": {
      "id": "shop-002-realistic-general",
      "theme": "SHOPPING",
      "setting": {
        "location": "local shop",
        "timeContext": "after school",
        "atmosphere": "friendly"
      },
      "characters": [
        {
          "name": "Liam",
          "role": "student"
        }
      ],
      "items": [
        {
          "name": "apple",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.2,
            "max": 0.5,
            "typical": 0.35,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "banana",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.15,
            "max": 0.4,
            "typical": 0.25,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "sandwich",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 2.5,
            "max": 6,
            "typical": 4,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "drink",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.8,
            "max": 2.5,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "cake",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 1.5,
            "max": 4,
            "typical": 2.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "biscuit",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.8,
            "max": 2,
            "typical": 1.2,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "sweet",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.1,
            "max": 1,
            "typical": 0.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "chocolate",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.6,
            "max": 3,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "pen",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.5,
            "max": 2,
            "typical": 1,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "pencil",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.2,
            "max": 1,
            "typical": 0.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "ruler",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.8,
            "max": 2.5,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "notebook",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 1,
            "max": 4,
            "typical": 2,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "eraser",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.3,
            "max": 1.5,
            "typical": 0.75,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "book",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 3,
            "max": 15,
            "typical": 8,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "comic",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 2,
            "max": 5,
            "typical": 3,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "magazine",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 2.5,
            "max": 6,
            "typical": 4,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "toy",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 5,
            "max": 25,
            "typical": 12,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "game",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 8,
            "max": 60,
            "typical": 25,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "puzzle",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 5,
            "max": 20,
            "typical": 12,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "sticker",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 0.2,
            "max": 2,
            "typical": 0.8,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "badge",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 0.5,
            "max": 3,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "poster",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 2,
            "max": 8,
            "typical": 4,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "card",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 0.5,
            "max": 4,
            "typical": 2,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        }
      ],
      "culturalElements": [
        {
          "type": "currency",
          "value": "£",
          "explanation": "British pounds"
        },
        {
          "type": "location",
          "value": "UK local shop",
          "explanation": "Typical British corner shop"
        }
      ],
      "realWorldConnection": "Everyday shopping with realistic UK prices",
      "yearAppropriate": [
        1,
        2,
        3,
        4,
        5,
        6
      ],
      "templates": [
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "MULTI_STEP"
          ],
          "modelCompatibility": [
            "ADDITION"
          ],
          "operandCount": 3,
          "template": "{character} buys {article1} {item1} for {price1}, {article2} {item2} for {price2}, and {article3} {item3} for {price3}. What is the total cost?",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item1",
              "type": "item"
            },
            {
              "key": "item2",
              "type": "item"
            },
            {
              "key": "item3",
              "type": "item"
            },
            {
              "key": "price1",
              "type": "value"
            },
            {
              "key": "price2",
              "type": "value"
            },
            {
              "key": "price3",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "MULTI_STEP"
          ],
          "modelCompatibility": [
            "ADDITION"
          ],
          "operandCount": 2,
          "template": "{character} buys {article1} {item1} for {price1} and {article2} {item2} for {price2}. What is the total cost?",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item1",
              "type": "item"
            },
            {
              "key": "item2",
              "type": "item"
            },
            {
              "key": "price1",
              "type": "value"
            },
            {
              "key": "price2",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION"
          ],
          "modelCompatibility": [
            "SUBTRACTION",
            "CHANGE_CALCULATION"
          ],
          "template": "{character} buys {article} {item} for {price} and pays with {payment}. How much change does {character} get?",
          "answerTemplate": "{character} receives {result} in change",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "price",
              "type": "value"
            },
            {
              "key": "payment",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION"
          ],
          "modelCompatibility": [
            "MULTIPLICATION"
          ],
          "template": "{character} buys {quantity} {item} at {price} each. What is the total cost?",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "quantity",
              "type": "value"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "price",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION"
          ],
          "modelCompatibility": [
            "DIVISION"
          ],
          "template": "{character} has {total} to spend equally on {quantity} {item}. How much can {character} spend on each one?",
          "answerTemplate": "{character} can spend {result} on each {item}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "total",
              "type": "value"
            },
            {
              "key": "quantity",
              "type": "value"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "COMPARISON",
            "ESTIMATION",
            "MULTI_STEP"
          ],
          "template": "{character} goes to the shop and buys {items}. How much does {character} spend in total?",
          "answerTemplate": "{character} spends {result} in total",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "items",
              "type": "item_list"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "ESTIMATION"
          ],
          "template": "Estimate: If {character} buys {items}, about how much will it cost?",
          "answerTemplate": "It will cost approximately {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "items",
              "type": "item_list"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "VALIDATION"
          ],
          "template": "{character} calculated that {items} costs {amount}. Is this correct?",
          "answerTemplate": "{validation_result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "items",
              "type": "item_list"
            },
            {
              "key": "amount",
              "type": "value"
            },
            {
              "key": "validation_result",
              "type": "boolean"
            }
          ]
        }
      ]
    },
    "distractors": [
      {
        "value": 10,
        "displayText": "10",
        "strategy": "WRONG_OPERATION",
        "reasoning": "Subtracted instead of dividing"
      },
      {
        "value": 2.38,
        "displayText": "2.38",
        "strategy": "CLOSE_VALUE",
        "reasoning": "Off by 2"
      },
      {
        "value": 5.38,
        "displayText": "5.38",
        "strategy": "CLOSE_VALUE",
        "reasoning": "Off by 5"
      }
    ],
    "enhancementStatus": {
      "level": "partial",
      "requestedFormat": "DIRECT_CALCULATION",
      "actualFormat": "DIRECT_CALCULATION",
      "featuresActive": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "featuresPending": [],
      "isFullyEnhanced": true
    },
    "mathOutput": {
      "operation": "DIVISION",
      "divisor": 5,
      "dividend": 1.9,
      "quotient": 0.38,
      "remainder": 0
    },
    "generationTime": 0,
    "questionId": "q_1759234376719_fifs5qgch",
    "generationSetup": {
      "controller_used": "DIRECT_CALCULATIONController",
      "format_requested": "DIRECT_CALCULATION",
      "format_actual": "DIRECT_CALCULATION",
      "scenario_theme": "SHOPPING",
      "scenario_id": "shop-002-realistic-general",
      "scenario_selection_method": "default",
      "distractor_strategies": [
        "WRONG_OPERATION",
        "CLOSE_VALUE",
        "CLOSE_VALUE"
      ],
      "distractor_count": 3,
      "theme_variety": false,
      "format_variety": false,
      "enhancement_level": "partial",
      "features_active": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "features_pending": [],
      "generation_time_ms": 0
    }
  },
  "metadata": {
    "format": "DIRECT_CALCULATION",
    "cognitive_load": 40,
    "curriculum_alignment": [
      "4N1a"
    ],
    "difficulty": "4.1",
    "scenario_theme": "SHOPPING",
    "distractor_strategies": [
      "WRONG_OPERATION",
      "CLOSE_VALUE",
      "CLOSE_VALUE"
    ],
    "generation_time_ms": 0,
    "api_version": "2.0",
    "enhancement_status": "partial",
    "format_requested": "DIRECT_CALCULATION",
    "format_used": "DIRECT_CALCULATION",
    "features_active": [
      "enhanced_distractors",
      "rich_scenarios",
      "cognitive_load",
      "advanced_formats"
    ],
    "features_pending": []
  },
  "context": {
    "id": "shop-002-realistic-general",
    "theme": "SHOPPING",
    "setting": {
      "location": "local shop",
      "timeContext": "after school",
      "atmosphere": "friendly"
    },
    "characters": [
      {
        "name": "Liam",
        "role": "student"
      }
    ],
    "items": [
      {
        "name": "apple",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.2,
          "max": 0.5,
          "typical": 0.35,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "banana",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.15,
          "max": 0.4,
          "typical": 0.25,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "sandwich",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 2.5,
          "max": 6,
          "typical": 4,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "drink",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.8,
          "max": 2.5,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "cake",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 1.5,
          "max": 4,
          "typical": 2.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "biscuit",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.8,
          "max": 2,
          "typical": 1.2,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "sweet",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.1,
          "max": 1,
          "typical": 0.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "chocolate",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.6,
          "max": 3,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "pen",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.5,
          "max": 2,
          "typical": 1,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "pencil",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.2,
          "max": 1,
          "typical": 0.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "ruler",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.8,
          "max": 2.5,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "notebook",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 1,
          "max": 4,
          "typical": 2,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "eraser",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.3,
          "max": 1.5,
          "typical": 0.75,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "book",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 3,
          "max": 15,
          "typical": 8,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "comic",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 2,
          "max": 5,
          "typical": 3,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "magazine",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 2.5,
          "max": 6,
          "typical": 4,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "toy",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 5,
          "max": 25,
          "typical": 12,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "game",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 8,
          "max": 60,
          "typical": 25,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "puzzle",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 5,
          "max": 20,
          "typical": 12,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "sticker",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 0.2,
          "max": 2,
          "typical": 0.8,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "badge",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 0.5,
          "max": 3,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "poster",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 2,
          "max": 8,
          "typical": 4,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "card",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 0.5,
          "max": 4,
          "typical": 2,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      }
    ],
    "culturalElements": [
      {
        "type": "currency",
        "value": "£",
        "explanation": "British pounds"
      },
      {
        "type": "location",
        "value": "UK local shop",
        "explanation": "Typical British corner shop"
      }
    ],
    "realWorldConnection": "Everyday shopping with realistic UK prices",
    "yearAppropriate": [
      1,
      2,
      3,
      4,
      5,
      6
    ],
    "templates": [
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "MULTI_STEP"
        ],
        "modelCompatibility": [
          "ADDITION"
        ],
        "operandCount": 3,
        "template": "{character} buys {article1} {item1} for {price1}, {article2} {item2} for {price2}, and {article3} {item3} for {price3}. What is the total cost?",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item1",
            "type": "item"
          },
          {
            "key": "item2",
            "type": "item"
          },
          {
            "key": "item3",
            "type": "item"
          },
          {
            "key": "price1",
            "type": "value"
          },
          {
            "key": "price2",
            "type": "value"
          },
          {
            "key": "price3",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "MULTI_STEP"
        ],
        "modelCompatibility": [
          "ADDITION"
        ],
        "operandCount": 2,
        "template": "{character} buys {article1} {item1} for {price1} and {article2} {item2} for {price2}. What is the total cost?",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item1",
            "type": "item"
          },
          {
            "key": "item2",
            "type": "item"
          },
          {
            "key": "price1",
            "type": "value"
          },
          {
            "key": "price2",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION"
        ],
        "modelCompatibility": [
          "SUBTRACTION",
          "CHANGE_CALCULATION"
        ],
        "template": "{character} buys {article} {item} for {price} and pays with {payment}. How much change does {character} get?",
        "answerTemplate": "{character} receives {result} in change",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "price",
            "type": "value"
          },
          {
            "key": "payment",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION"
        ],
        "modelCompatibility": [
          "MULTIPLICATION"
        ],
        "template": "{character} buys {quantity} {item} at {price} each. What is the total cost?",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "quantity",
            "type": "value"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "price",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION"
        ],
        "modelCompatibility": [
          "DIVISION"
        ],
        "template": "{character} has {total} to spend equally on {quantity} {item}. How much can {character} spend on each one?",
        "answerTemplate": "{character} can spend {result} on each {item}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "total",
            "type": "value"
          },
          {
            "key": "quantity",
            "type": "value"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "COMPARISON",
          "ESTIMATION",
          "MULTI_STEP"
        ],
        "template": "{character} goes to the shop and buys {items}. How much does {character} spend in total?",
        "answerTemplate": "{character} spends {result} in total",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "items",
            "type": "item_list"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "ESTIMATION"
        ],
        "template": "Estimate: If {character} buys {items}, about how much will it cost?",
        "answerTemplate": "It will cost approximately {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "items",
            "type": "item_list"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "VALIDATION"
        ],
        "template": "{character} calculated that {items} costs {amount}. Is this correct?",
        "answerTemplate": "{validation_result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "items",
            "type": "item_list"
          },
          {
            "key": "amount",
            "type": "value"
          },
          {
            "key": "validation_result",
            "type": "boolean"
          }
        ]
      }
    ]
  }
}
# Test B.5: PERCENTAGE model
{
  "success": true,
  "question": {
    "text": "Liam goes to the shop and buys apple, banana, sandwich, drink, cake, biscuit, sweet, chocolate, pen, pencil, ruler, notebook, eraser, book, comic, magazine, toy, game, puzzle, sticker, badge, poster, card. How much does Liam spend in total?",
    "options": [
      {
        "text": "£14.00",
        "value": 14,
        "index": 0
      },
      {
        "text": "7",
        "value": 7,
        "index": 1
      },
      {
        "text": "15",
        "value": 15,
        "index": 2
      },
      {
        "text": "13",
        "value": 13,
        "index": 3
      }
    ],
    "correctIndex": 0,
    "format": "DIRECT_CALCULATION",
    "difficulty": {
      "year": 4,
      "subLevel": 1,
      "displayName": "4.1",
      "cognitiveLoad": 40
    },
    "cognitiveLoad": 40,
    "curriculumTags": [
      "4N1a"
    ],
    "scenario": {
      "id": "shop-002-realistic-general",
      "theme": "SHOPPING",
      "setting": {
        "location": "local shop",
        "timeContext": "after school",
        "atmosphere": "friendly"
      },
      "characters": [
        {
          "name": "Liam",
          "role": "student"
        }
      ],
      "items": [
        {
          "name": "apple",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.2,
            "max": 0.5,
            "typical": 0.35,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "banana",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.15,
            "max": 0.4,
            "typical": 0.25,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "sandwich",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 2.5,
            "max": 6,
            "typical": 4,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "drink",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.8,
            "max": 2.5,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "cake",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 1.5,
            "max": 4,
            "typical": 2.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "biscuit",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.8,
            "max": 2,
            "typical": 1.2,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "sweet",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.1,
            "max": 1,
            "typical": 0.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "chocolate",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.6,
            "max": 3,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "pen",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.5,
            "max": 2,
            "typical": 1,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "pencil",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.2,
            "max": 1,
            "typical": 0.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "ruler",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.8,
            "max": 2.5,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "notebook",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 1,
            "max": 4,
            "typical": 2,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "eraser",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.3,
            "max": 1.5,
            "typical": 0.75,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "book",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 3,
            "max": 15,
            "typical": 8,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "comic",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 2,
            "max": 5,
            "typical": 3,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "magazine",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 2.5,
            "max": 6,
            "typical": 4,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "toy",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 5,
            "max": 25,
            "typical": 12,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "game",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 8,
            "max": 60,
            "typical": 25,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "puzzle",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 5,
            "max": 20,
            "typical": 12,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "sticker",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 0.2,
            "max": 2,
            "typical": 0.8,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "badge",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 0.5,
            "max": 3,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "poster",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 2,
            "max": 8,
            "typical": 4,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "card",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 0.5,
            "max": 4,
            "typical": 2,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        }
      ],
      "culturalElements": [
        {
          "type": "currency",
          "value": "£",
          "explanation": "British pounds"
        },
        {
          "type": "location",
          "value": "UK local shop",
          "explanation": "Typical British corner shop"
        }
      ],
      "realWorldConnection": "Everyday shopping with realistic UK prices",
      "yearAppropriate": [
        1,
        2,
        3,
        4,
        5,
        6
      ],
      "templates": [
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "MULTI_STEP"
          ],
          "modelCompatibility": [
            "ADDITION"
          ],
          "operandCount": 3,
          "template": "{character} buys {article1} {item1} for {price1}, {article2} {item2} for {price2}, and {article3} {item3} for {price3}. What is the total cost?",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item1",
              "type": "item"
            },
            {
              "key": "item2",
              "type": "item"
            },
            {
              "key": "item3",
              "type": "item"
            },
            {
              "key": "price1",
              "type": "value"
            },
            {
              "key": "price2",
              "type": "value"
            },
            {
              "key": "price3",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "MULTI_STEP"
          ],
          "modelCompatibility": [
            "ADDITION"
          ],
          "operandCount": 2,
          "template": "{character} buys {article1} {item1} for {price1} and {article2} {item2} for {price2}. What is the total cost?",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item1",
              "type": "item"
            },
            {
              "key": "item2",
              "type": "item"
            },
            {
              "key": "price1",
              "type": "value"
            },
            {
              "key": "price2",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION"
          ],
          "modelCompatibility": [
            "SUBTRACTION",
            "CHANGE_CALCULATION"
          ],
          "template": "{character} buys {article} {item} for {price} and pays with {payment}. How much change does {character} get?",
          "answerTemplate": "{character} receives {result} in change",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "price",
              "type": "value"
            },
            {
              "key": "payment",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION"
          ],
          "modelCompatibility": [
            "MULTIPLICATION"
          ],
          "template": "{character} buys {quantity} {item} at {price} each. What is the total cost?",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "quantity",
              "type": "value"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "price",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION"
          ],
          "modelCompatibility": [
            "DIVISION"
          ],
          "template": "{character} has {total} to spend equally on {quantity} {item}. How much can {character} spend on each one?",
          "answerTemplate": "{character} can spend {result} on each {item}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "total",
              "type": "value"
            },
            {
              "key": "quantity",
              "type": "value"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "COMPARISON",
            "ESTIMATION",
            "MULTI_STEP"
          ],
          "template": "{character} goes to the shop and buys {items}. How much does {character} spend in total?",
          "answerTemplate": "{character} spends {result} in total",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "items",
              "type": "item_list"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "ESTIMATION"
          ],
          "template": "Estimate: If {character} buys {items}, about how much will it cost?",
          "answerTemplate": "It will cost approximately {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "items",
              "type": "item_list"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "VALIDATION"
          ],
          "template": "{character} calculated that {items} costs {amount}. Is this correct?",
          "answerTemplate": "{validation_result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "items",
              "type": "item_list"
            },
            {
              "key": "amount",
              "type": "value"
            },
            {
              "key": "validation_result",
              "type": "boolean"
            }
          ]
        }
      ]
    },
    "distractors": [
      {
        "value": 15,
        "displayText": "15",
        "strategy": "CLOSE_VALUE",
        "reasoning": "Off by 1"
      },
      {
        "value": 13,
        "displayText": "13",
        "strategy": "CLOSE_VALUE",
        "reasoning": "Off by 1"
      },
      {
        "value": 7,
        "displayText": "7",
        "reasoning": "Half the correct value"
      }
    ],
    "enhancementStatus": {
      "level": "partial",
      "requestedFormat": "DIRECT_CALCULATION",
      "actualFormat": "DIRECT_CALCULATION",
      "featuresActive": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "featuresPending": [],
      "isFullyEnhanced": true
    },
    "mathOutput": {
      "operation": "PERCENTAGE",
      "base_value": 14,
      "percentage": 100,
      "result": 14
    },
    "generationTime": 1,
    "questionId": "q_1759234376764_madd0lmrp",
    "generationSetup": {
      "controller_used": "DIRECT_CALCULATIONController",
      "format_requested": "DIRECT_CALCULATION",
      "format_actual": "DIRECT_CALCULATION",
      "scenario_theme": "SHOPPING",
      "scenario_id": "shop-002-realistic-general",
      "scenario_selection_method": "default",
      "distractor_strategies": [
        "CLOSE_VALUE",
        "CLOSE_VALUE",
        null
      ],
      "distractor_count": 3,
      "theme_variety": false,
      "format_variety": false,
      "enhancement_level": "partial",
      "features_active": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "features_pending": [],
      "generation_time_ms": 1
    }
  },
  "metadata": {
    "format": "DIRECT_CALCULATION",
    "cognitive_load": 40,
    "curriculum_alignment": [
      "4N1a"
    ],
    "difficulty": "4.1",
    "scenario_theme": "SHOPPING",
    "distractor_strategies": [
      "CLOSE_VALUE",
      "CLOSE_VALUE",
      null
    ],
    "generation_time_ms": 1,
    "api_version": "2.0",
    "enhancement_status": "partial",
    "format_requested": "DIRECT_CALCULATION",
    "format_used": "DIRECT_CALCULATION",
    "features_active": [
      "enhanced_distractors",
      "rich_scenarios",
      "cognitive_load",
      "advanced_formats"
    ],
    "features_pending": []
  },
  "context": {
    "id": "shop-002-realistic-general",
    "theme": "SHOPPING",
    "setting": {
      "location": "local shop",
      "timeContext": "after school",
      "atmosphere": "friendly"
    },
    "characters": [
      {
        "name": "Liam",
        "role": "student"
      }
    ],
    "items": [
      {
        "name": "apple",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.2,
          "max": 0.5,
          "typical": 0.35,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "banana",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.15,
          "max": 0.4,
          "typical": 0.25,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "sandwich",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 2.5,
          "max": 6,
          "typical": 4,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "drink",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.8,
          "max": 2.5,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "cake",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 1.5,
          "max": 4,
          "typical": 2.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "biscuit",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.8,
          "max": 2,
          "typical": 1.2,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "sweet",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.1,
          "max": 1,
          "typical": 0.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "chocolate",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.6,
          "max": 3,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "pen",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.5,
          "max": 2,
          "typical": 1,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "pencil",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.2,
          "max": 1,
          "typical": 0.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "ruler",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.8,
          "max": 2.5,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "notebook",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 1,
          "max": 4,
          "typical": 2,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "eraser",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.3,
          "max": 1.5,
          "typical": 0.75,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "book",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 3,
          "max": 15,
          "typical": 8,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "comic",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 2,
          "max": 5,
          "typical": 3,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "magazine",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 2.5,
          "max": 6,
          "typical": 4,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "toy",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 5,
          "max": 25,
          "typical": 12,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "game",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 8,
          "max": 60,
          "typical": 25,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "puzzle",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 5,
          "max": 20,
          "typical": 12,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "sticker",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 0.2,
          "max": 2,
          "typical": 0.8,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "badge",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 0.5,
          "max": 3,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "poster",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 2,
          "max": 8,
          "typical": 4,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "card",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 0.5,
          "max": 4,
          "typical": 2,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      }
    ],
    "culturalElements": [
      {
        "type": "currency",
        "value": "£",
        "explanation": "British pounds"
      },
      {
        "type": "location",
        "value": "UK local shop",
        "explanation": "Typical British corner shop"
      }
    ],
    "realWorldConnection": "Everyday shopping with realistic UK prices",
    "yearAppropriate": [
      1,
      2,
      3,
      4,
      5,
      6
    ],
    "templates": [
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "MULTI_STEP"
        ],
        "modelCompatibility": [
          "ADDITION"
        ],
        "operandCount": 3,
        "template": "{character} buys {article1} {item1} for {price1}, {article2} {item2} for {price2}, and {article3} {item3} for {price3}. What is the total cost?",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item1",
            "type": "item"
          },
          {
            "key": "item2",
            "type": "item"
          },
          {
            "key": "item3",
            "type": "item"
          },
          {
            "key": "price1",
            "type": "value"
          },
          {
            "key": "price2",
            "type": "value"
          },
          {
            "key": "price3",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "MULTI_STEP"
        ],
        "modelCompatibility": [
          "ADDITION"
        ],
        "operandCount": 2,
        "template": "{character} buys {article1} {item1} for {price1} and {article2} {item2} for {price2}. What is the total cost?",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item1",
            "type": "item"
          },
          {
            "key": "item2",
            "type": "item"
          },
          {
            "key": "price1",
            "type": "value"
          },
          {
            "key": "price2",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION"
        ],
        "modelCompatibility": [
          "SUBTRACTION",
          "CHANGE_CALCULATION"
        ],
        "template": "{character} buys {article} {item} for {price} and pays with {payment}. How much change does {character} get?",
        "answerTemplate": "{character} receives {result} in change",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "price",
            "type": "value"
          },
          {
            "key": "payment",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION"
        ],
        "modelCompatibility": [
          "MULTIPLICATION"
        ],
        "template": "{character} buys {quantity} {item} at {price} each. What is the total cost?",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "quantity",
            "type": "value"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "price",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION"
        ],
        "modelCompatibility": [
          "DIVISION"
        ],
        "template": "{character} has {total} to spend equally on {quantity} {item}. How much can {character} spend on each one?",
        "answerTemplate": "{character} can spend {result} on each {item}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "total",
            "type": "value"
          },
          {
            "key": "quantity",
            "type": "value"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "COMPARISON",
          "ESTIMATION",
          "MULTI_STEP"
        ],
        "template": "{character} goes to the shop and buys {items}. How much does {character} spend in total?",
        "answerTemplate": "{character} spends {result} in total",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "items",
            "type": "item_list"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "ESTIMATION"
        ],
        "template": "Estimate: If {character} buys {items}, about how much will it cost?",
        "answerTemplate": "It will cost approximately {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "items",
            "type": "item_list"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "VALIDATION"
        ],
        "template": "{character} calculated that {items} costs {amount}. Is this correct?",
        "answerTemplate": "{validation_result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "items",
            "type": "item_list"
          },
          {
            "key": "amount",
            "type": "value"
          },
          {
            "key": "validation_result",
            "type": "boolean"
          }
        ]
      }
    ]
  }
}
# Test B.6: FRACTION model
{
  "success": true,
  "question": {
    "text": "What is one third of 36?",
    "options": [
      {
        "text": "13",
        "value": 13,
        "index": 0
      },
      {
        "text": "6",
        "value": 6,
        "index": 1
      },
      {
        "text": "11",
        "value": 11,
        "index": 2
      },
      {
        "text": "£12.00",
        "value": 12,
        "index": 3
      }
    ],
    "correctIndex": 3,
    "questionContent": {
      "fullText": "What is one third of 36?",
      "templateData": {
        "numerator": 1,
        "denominator": 3,
        "whole_value": 36,
        "fraction_text": "one third",
        "result": 12
      }
    },
    "format": "DIRECT_CALCULATION",
    "difficulty": {
      "year": 4,
      "subLevel": 1,
      "displayName": "4.1",
      "cognitiveLoad": 40
    },
    "cognitiveLoad": 40,
    "curriculumTags": [
      "4N1a"
    ],
    "scenario": {
      "id": "default-4-1759234376816",
      "theme": "SHOPPING",
      "setting": {
        "location": "shop",
        "timeContext": "afternoon",
        "atmosphere": "friendly"
      },
      "characters": [
        {
          "name": "Oliver",
          "role": "student"
        }
      ],
      "items": [
        {
          "name": "item",
          "category": "HOUSEHOLD_ITEMS",
          "typicalValue": {
            "min": 1,
            "max": 10,
            "typical": 5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        }
      ],
      "culturalElements": [
        {
          "type": "currency",
          "value": "£",
          "explanation": "British pounds"
        }
      ],
      "realWorldConnection": "Basic shopping calculations",
      "yearAppropriate": [
        4
      ],
      "templates": [
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION"
          ],
          "template": "{character} buys {article} {item} for {price}. How much does it cost?",
          "answerTemplate": "It costs {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "price",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        }
      ]
    },
    "distractors": [
      {
        "value": 13,
        "displayText": "13",
        "strategy": "CLOSE_VALUE",
        "reasoning": "Off by 1"
      },
      {
        "value": 11,
        "displayText": "11",
        "strategy": "CLOSE_VALUE",
        "reasoning": "Off by 1"
      },
      {
        "value": 6,
        "displayText": "6",
        "reasoning": "Half the correct value"
      }
    ],
    "enhancementStatus": {
      "level": "partial",
      "requestedFormat": "DIRECT_CALCULATION",
      "actualFormat": "DIRECT_CALCULATION",
      "featuresActive": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "featuresPending": [],
      "isFullyEnhanced": true
    },
    "mathOutput": {
      "operation": "FRACTION",
      "whole_value": 36,
      "numerator": 1,
      "denominator": 3,
      "result": 12
    },
    "generationTime": 1,
    "questionId": "q_1759234376816_7gii9b4e4",
    "generationSetup": {
      "controller_used": "DIRECT_CALCULATIONController",
      "format_requested": "DIRECT_CALCULATION",
      "format_actual": "DIRECT_CALCULATION",
      "scenario_theme": "SHOPPING",
      "scenario_id": "default-4-1759234376816",
      "scenario_selection_method": "default",
      "distractor_strategies": [
        "CLOSE_VALUE",
        "CLOSE_VALUE",
        null
      ],
      "distractor_count": 3,
      "theme_variety": false,
      "format_variety": false,
      "enhancement_level": "partial",
      "features_active": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "features_pending": [],
      "generation_time_ms": 1
    }
  },
  "metadata": {
    "format": "DIRECT_CALCULATION",
    "cognitive_load": 40,
    "curriculum_alignment": [
      "4N1a"
    ],
    "difficulty": "4.1",
    "scenario_theme": "SHOPPING",
    "distractor_strategies": [
      "CLOSE_VALUE",
      "CLOSE_VALUE",
      null
    ],
    "generation_time_ms": 1,
    "api_version": "2.0",
    "enhancement_status": "partial",
    "format_requested": "DIRECT_CALCULATION",
    "format_used": "DIRECT_CALCULATION",
    "features_active": [
      "enhanced_distractors",
      "rich_scenarios",
      "cognitive_load",
      "advanced_formats"
    ],
    "features_pending": []
  },
  "context": {
    "id": "default-4-1759234376816",
    "theme": "SHOPPING",
    "setting": {
      "location": "shop",
      "timeContext": "afternoon",
      "atmosphere": "friendly"
    },
    "characters": [
      {
        "name": "Oliver",
        "role": "student"
      }
    ],
    "items": [
      {
        "name": "item",
        "category": "HOUSEHOLD_ITEMS",
        "typicalValue": {
          "min": 1,
          "max": 10,
          "typical": 5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      }
    ],
    "culturalElements": [
      {
        "type": "currency",
        "value": "£",
        "explanation": "British pounds"
      }
    ],
    "realWorldConnection": "Basic shopping calculations",
    "yearAppropriate": [
      4
    ],
    "templates": [
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION"
        ],
        "template": "{character} buys {article} {item} for {price}. How much does it cost?",
        "answerTemplate": "It costs {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "price",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      }
    ]
  }
}
# Test B.7: COUNTING model
{
  "success": true,
  "question": {
    "text": "Ethan buys an item for £5. How much does it cost?",
    "options": [
      {
        "value": 0,
        "text": "0p",
        "isCorrect": true
      }
    ],
    "correctIndex": 0,
    "format": "DIRECT_CALCULATION",
    "difficulty": {
      "year": 4,
      "subLevel": 1,
      "displayName": "4.1",
      "cognitiveLoad": 40
    },
    "cognitiveLoad": 40,
    "curriculumTags": [
      "4N1a"
    ],
    "scenario": {
      "id": "default-4-1759234376870",
      "theme": "SHOPPING",
      "setting": {
        "location": "shop",
        "timeContext": "afternoon",
        "atmosphere": "friendly"
      },
      "characters": [
        {
          "name": "Ethan",
          "role": "student"
        }
      ],
      "items": [
        {
          "name": "item",
          "category": "HOUSEHOLD_ITEMS",
          "typicalValue": {
            "min": 1,
            "max": 10,
            "typical": 5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        }
      ],
      "culturalElements": [
        {
          "type": "currency",
          "value": "£",
          "explanation": "British pounds"
        }
      ],
      "realWorldConnection": "Basic shopping calculations",
      "yearAppropriate": [
        4
      ],
      "templates": [
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION"
          ],
          "template": "{character} buys {article} {item} for {price}. How much does it cost?",
          "answerTemplate": "It costs {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "price",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        }
      ]
    },
    "distractors": [],
    "enhancementStatus": {
      "level": "partial",
      "requestedFormat": "DIRECT_CALCULATION",
      "actualFormat": "DIRECT_CALCULATION",
      "featuresActive": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "featuresPending": [],
      "isFullyEnhanced": true
    },
    "mathOutput": {
      "operation": "COUNTING"
    },
    "generationTime": 2,
    "questionId": "q_1759234376871_x4bew37p6",
    "generationSetup": {
      "controller_used": "DIRECT_CALCULATIONController",
      "format_requested": "DIRECT_CALCULATION",
      "format_actual": "DIRECT_CALCULATION",
      "scenario_theme": "SHOPPING",
      "scenario_id": "default-4-1759234376870",
      "scenario_selection_method": "default",
      "distractor_strategies": [],
      "distractor_count": 0,
      "theme_variety": false,
      "format_variety": false,
      "enhancement_level": "partial",
      "features_active": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "features_pending": [],
      "generation_time_ms": 2
    }
  },
  "metadata": {
    "format": "DIRECT_CALCULATION",
    "cognitive_load": 40,
    "curriculum_alignment": [
      "4N1a"
    ],
    "difficulty": "4.1",
    "scenario_theme": "SHOPPING",
    "distractor_strategies": [],
    "generation_time_ms": 3,
    "api_version": "2.0",
    "enhancement_status": "partial",
    "format_requested": "DIRECT_CALCULATION",
    "format_used": "DIRECT_CALCULATION",
    "features_active": [
      "enhanced_distractors",
      "rich_scenarios",
      "cognitive_load",
      "advanced_formats"
    ],
    "features_pending": []
  },
  "context": {
    "id": "default-4-1759234376870",
    "theme": "SHOPPING",
    "setting": {
      "location": "shop",
      "timeContext": "afternoon",
      "atmosphere": "friendly"
    },
    "characters": [
      {
        "name": "Ethan",
        "role": "student"
      }
    ],
    "items": [
      {
        "name": "item",
        "category": "HOUSEHOLD_ITEMS",
        "typicalValue": {
          "min": 1,
          "max": 10,
          "typical": 5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      }
    ],
    "culturalElements": [
      {
        "type": "currency",
        "value": "£",
        "explanation": "British pounds"
      }
    ],
    "realWorldConnection": "Basic shopping calculations",
    "yearAppropriate": [
      4
    ],
    "templates": [
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION"
        ],
        "template": "{character} buys {article} {item} for {price}. How much does it cost?",
        "answerTemplate": "It costs {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "price",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      }
    ]
  }
}
# Test B.8: TIME_RATE model
{
  "success": true,
  "question": {
    "text": "Olivia buys an item for £5. How much does it cost?",
    "options": [
      {
        "value": 0,
        "text": "0p",
        "isCorrect": true
      }
    ],
    "correctIndex": 0,
    "format": "DIRECT_CALCULATION",
    "difficulty": {
      "year": 4,
      "subLevel": 1,
      "displayName": "4.1",
      "cognitiveLoad": 40
    },
    "cognitiveLoad": 40,
    "curriculumTags": [
      "4N1a"
    ],
    "scenario": {
      "id": "default-4-1759234376920",
      "theme": "SHOPPING",
      "setting": {
        "location": "shop",
        "timeContext": "afternoon",
        "atmosphere": "friendly"
      },
      "characters": [
        {
          "name": "Olivia",
          "role": "student"
        }
      ],
      "items": [
        {
          "name": "item",
          "category": "HOUSEHOLD_ITEMS",
          "typicalValue": {
            "min": 1,
            "max": 10,
            "typical": 5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        }
      ],
      "culturalElements": [
        {
          "type": "currency",
          "value": "£",
          "explanation": "British pounds"
        }
      ],
      "realWorldConnection": "Basic shopping calculations",
      "yearAppropriate": [
        4
      ],
      "templates": [
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION"
          ],
          "template": "{character} buys {article} {item} for {price}. How much does it cost?",
          "answerTemplate": "It costs {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "price",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        }
      ]
    },
    "distractors": [],
    "enhancementStatus": {
      "level": "partial",
      "requestedFormat": "DIRECT_CALCULATION",
      "actualFormat": "DIRECT_CALCULATION",
      "featuresActive": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "featuresPending": [],
      "isFullyEnhanced": true
    },
    "mathOutput": {
      "operation": "TIME_RATE",
      "rate": {
        "value": 3,
        "period": "day"
      }
    },
    "generationTime": 1,
    "questionId": "q_1759234376920_7icmcoyzl",
    "generationSetup": {
      "controller_used": "DIRECT_CALCULATIONController",
      "format_requested": "DIRECT_CALCULATION",
      "format_actual": "DIRECT_CALCULATION",
      "scenario_theme": "SHOPPING",
      "scenario_id": "default-4-1759234376920",
      "scenario_selection_method": "default",
      "distractor_strategies": [],
      "distractor_count": 0,
      "theme_variety": false,
      "format_variety": false,
      "enhancement_level": "partial",
      "features_active": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "features_pending": [],
      "generation_time_ms": 1
    }
  },
  "metadata": {
    "format": "DIRECT_CALCULATION",
    "cognitive_load": 40,
    "curriculum_alignment": [
      "4N1a"
    ],
    "difficulty": "4.1",
    "scenario_theme": "SHOPPING",
    "distractor_strategies": [],
    "generation_time_ms": 1,
    "api_version": "2.0",
    "enhancement_status": "partial",
    "format_requested": "DIRECT_CALCULATION",
    "format_used": "DIRECT_CALCULATION",
    "features_active": [
      "enhanced_distractors",
      "rich_scenarios",
      "cognitive_load",
      "advanced_formats"
    ],
    "features_pending": []
  },
  "context": {
    "id": "default-4-1759234376920",
    "theme": "SHOPPING",
    "setting": {
      "location": "shop",
      "timeContext": "afternoon",
      "atmosphere": "friendly"
    },
    "characters": [
      {
        "name": "Olivia",
        "role": "student"
      }
    ],
    "items": [
      {
        "name": "item",
        "category": "HOUSEHOLD_ITEMS",
        "typicalValue": {
          "min": 1,
          "max": 10,
          "typical": 5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      }
    ],
    "culturalElements": [
      {
        "type": "currency",
        "value": "£",
        "explanation": "British pounds"
      }
    ],
    "realWorldConnection": "Basic shopping calculations",
    "yearAppropriate": [
      4
    ],
    "templates": [
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION"
        ],
        "template": "{character} buys {article} {item} for {price}. How much does it cost?",
        "answerTemplate": "It costs {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "price",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      }
    ]
  }
}
# Test B.9: CONVERSION model
{
  "success": true,
  "question": {
    "text": "Ethan buys an item for £5. How much does it cost?",
    "options": [
      {
        "value": 0,
        "text": "0p",
        "isCorrect": true
      }
    ],
    "correctIndex": 0,
    "format": "DIRECT_CALCULATION",
    "difficulty": {
      "year": 4,
      "subLevel": 1,
      "displayName": "4.1",
      "cognitiveLoad": 40
    },
    "cognitiveLoad": 40,
    "curriculumTags": [
      "4N1a"
    ],
    "scenario": {
      "id": "default-4-1759234376963",
      "theme": "SHOPPING",
      "setting": {
        "location": "shop",
        "timeContext": "afternoon",
        "atmosphere": "friendly"
      },
      "characters": [
        {
          "name": "Ethan",
          "role": "student"
        }
      ],
      "items": [
        {
          "name": "item",
          "category": "HOUSEHOLD_ITEMS",
          "typicalValue": {
            "min": 1,
            "max": 10,
            "typical": 5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        }
      ],
      "culturalElements": [
        {
          "type": "currency",
          "value": "£",
          "explanation": "British pounds"
        }
      ],
      "realWorldConnection": "Basic shopping calculations",
      "yearAppropriate": [
        4
      ],
      "templates": [
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION"
          ],
          "template": "{character} buys {article} {item} for {price}. How much does it cost?",
          "answerTemplate": "It costs {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "price",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        }
      ]
    },
    "distractors": [],
    "enhancementStatus": {
      "level": "partial",
      "requestedFormat": "DIRECT_CALCULATION",
      "actualFormat": "DIRECT_CALCULATION",
      "featuresActive": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "featuresPending": [],
      "isFullyEnhanced": true
    },
    "mathOutput": {
      "operation": "CONVERSION",
      "original_value": 47,
      "converted_value": 4700,
      "conversion_factor": 100
    },
    "generationTime": 1,
    "questionId": "q_1759234376963_6xcuz2g1e",
    "generationSetup": {
      "controller_used": "DIRECT_CALCULATIONController",
      "format_requested": "DIRECT_CALCULATION",
      "format_actual": "DIRECT_CALCULATION",
      "scenario_theme": "SHOPPING",
      "scenario_id": "default-4-1759234376963",
      "scenario_selection_method": "default",
      "distractor_strategies": [],
      "distractor_count": 0,
      "theme_variety": false,
      "format_variety": false,
      "enhancement_level": "partial",
      "features_active": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "features_pending": [],
      "generation_time_ms": 1
    }
  },
  "metadata": {
    "format": "DIRECT_CALCULATION",
    "cognitive_load": 40,
    "curriculum_alignment": [
      "4N1a"
    ],
    "difficulty": "4.1",
    "scenario_theme": "SHOPPING",
    "distractor_strategies": [],
    "generation_time_ms": 1,
    "api_version": "2.0",
    "enhancement_status": "partial",
    "format_requested": "DIRECT_CALCULATION",
    "format_used": "DIRECT_CALCULATION",
    "features_active": [
      "enhanced_distractors",
      "rich_scenarios",
      "cognitive_load",
      "advanced_formats"
    ],
    "features_pending": []
  },
  "context": {
    "id": "default-4-1759234376963",
    "theme": "SHOPPING",
    "setting": {
      "location": "shop",
      "timeContext": "afternoon",
      "atmosphere": "friendly"
    },
    "characters": [
      {
        "name": "Ethan",
        "role": "student"
      }
    ],
    "items": [
      {
        "name": "item",
        "category": "HOUSEHOLD_ITEMS",
        "typicalValue": {
          "min": 1,
          "max": 10,
          "typical": 5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      }
    ],
    "culturalElements": [
      {
        "type": "currency",
        "value": "£",
        "explanation": "British pounds"
      }
    ],
    "realWorldConnection": "Basic shopping calculations",
    "yearAppropriate": [
      4
    ],
    "templates": [
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION"
        ],
        "template": "{character} buys {article} {item} for {price}. How much does it cost?",
        "answerTemplate": "It costs {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "price",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      }
    ]
  }
}
# Test B.10: COMPARISON model
{
  "success": true,
  "question": {
    "text": "Sarah is comparing options to find the best value.\n\nOption A: 1500ml for £131.00\nOption B: 250ml for £112.00\n\nWhich option offers better value for money?",
    "options": [
      {
        "text": "Both options are equally good value",
        "value": -1,
        "index": 0
      },
      {
        "text": "A saves you 72p",
        "value": 0,
        "index": 1
      },
      {
        "text": "A is better value",
        "value": 0,
        "index": 2
      },
      {
        "text": "B is better value",
        "value": 1,
        "index": 3
      }
    ],
    "correctIndex": 1,
    "questionContent": {
      "fullText": "Sarah is comparing options to find the best value.\n\nOption A: 1500ml for £131.00\nOption B: 250ml for £112.00\n\nWhich option offers better value for money?",
      "templateData": {
        "character": "Sarah",
        "optionA": "1500ml for £131.00",
        "optionB": "250ml for £112.00",
        "context": "general",
        "comparisonType": "price_per_unit"
      }
    },
    "format": "COMPARISON",
    "difficulty": {
      "year": 4,
      "subLevel": 1,
      "displayName": "4.1",
      "cognitiveLoad": 40
    },
    "cognitiveLoad": 40,
    "curriculumTags": [
      "4N1a"
    ],
    "scenario": {
      "id": "shop-001-bookfair",
      "theme": "SHOPPING",
      "setting": {
        "location": "school book fair",
        "timeContext": "lunch break",
        "atmosphere": "busy"
      },
      "characters": [
        {
          "name": "Sarah",
          "role": "student"
        },
        {
          "name": "Mr. Johnson",
          "role": "teacher"
        }
      ],
      "items": [
        {
          "name": "book",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 3,
            "max": 12,
            "typical": 6.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "bookmark",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.5,
            "max": 2,
            "typical": 1,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        }
      ],
      "culturalElements": [
        {
          "type": "currency",
          "value": "£",
          "explanation": "British pounds"
        },
        {
          "type": "event",
          "value": "book fair",
          "explanation": "School fundraising event"
        }
      ],
      "realWorldConnection": "School fundraising and reading promotion",
      "yearAppropriate": [
        2,
        3,
        4,
        5
      ],
      "templates": [
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "COMPARISON"
          ],
          "modelCompatibility": [
            "ADDITION",
            "COUNTING"
          ],
          "template": "{character} wants to buy books at the book fair. Calculate the total cost.",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        }
      ]
    },
    "distractors": [
      {
        "value": 1,
        "displayText": "B is better value",
        "strategy": "REVERSED_COMPARISON",
        "reasoning": "Selected the option with higher total price instead of better unit price"
      },
      {
        "value": -1,
        "displayText": "Both options are equally good value",
        "strategy": "WRONG_SELECTION",
        "reasoning": "Failed to calculate the difference correctly"
      },
      {
        "value": 0,
        "displayText": "A saves you 72p",
        "strategy": "CALCULATION_ERROR",
        "reasoning": "Arithmetic error in calculating the difference"
      }
    ],
    "enhancementStatus": {
      "level": "full",
      "requestedFormat": "COMPARISON",
      "actualFormat": "COMPARISON",
      "featuresActive": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "featuresPending": [],
      "isFullyEnhanced": true
    },
    "mathOutput": {
      "operation": "COMPARISON",
      "option_1_value": 131,
      "option_1_quantity": 1500,
      "option_1_price": 131,
      "option_1_unit_rate": 0.08733333333333333,
      "option_2_value": 112,
      "option_2_quantity": 250,
      "option_2_price": 112,
      "option_2_unit_rate": 0.448
    },
    "generationTime": 1,
    "questionId": "q_1759234377012_707aw2tgt",
    "generationSetup": {
      "controller_used": "COMPARISONController",
      "format_requested": "COMPARISON",
      "format_actual": "COMPARISON",
      "scenario_theme": "SHOPPING",
      "scenario_id": "shop-001-bookfair",
      "scenario_selection_method": "default",
      "distractor_strategies": [
        "REVERSED_COMPARISON",
        "WRONG_SELECTION",
        "CALCULATION_ERROR"
      ],
      "distractor_count": 3,
      "theme_variety": false,
      "format_variety": false,
      "enhancement_level": "full",
      "features_active": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "features_pending": [],
      "generation_time_ms": 1
    }
  },
  "metadata": {
    "format": "COMPARISON",
    "cognitive_load": 40,
    "curriculum_alignment": [
      "4N1a"
    ],
    "difficulty": "4.1",
    "scenario_theme": "SHOPPING",
    "distractor_strategies": [
      "REVERSED_COMPARISON",
      "WRONG_SELECTION",
      "CALCULATION_ERROR"
    ],
    "generation_time_ms": 1,
    "api_version": "2.0",
    "enhancement_status": "full",
    "format_requested": "COMPARISON",
    "format_used": "COMPARISON",
    "features_active": [
      "enhanced_distractors",
      "rich_scenarios",
      "cognitive_load",
      "advanced_formats"
    ],
    "features_pending": []
  },
  "context": {
    "id": "shop-001-bookfair",
    "theme": "SHOPPING",
    "setting": {
      "location": "school book fair",
      "timeContext": "lunch break",
      "atmosphere": "busy"
    },
    "characters": [
      {
        "name": "Sarah",
        "role": "student"
      },
      {
        "name": "Mr. Johnson",
        "role": "teacher"
      }
    ],
    "items": [
      {
        "name": "book",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 3,
          "max": 12,
          "typical": 6.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "bookmark",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.5,
          "max": 2,
          "typical": 1,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      }
    ],
    "culturalElements": [
      {
        "type": "currency",
        "value": "£",
        "explanation": "British pounds"
      },
      {
        "type": "event",
        "value": "book fair",
        "explanation": "School fundraising event"
      }
    ],
    "realWorldConnection": "School fundraising and reading promotion",
    "yearAppropriate": [
      2,
      3,
      4,
      5
    ],
    "templates": [
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "COMPARISON"
        ],
        "modelCompatibility": [
          "ADDITION",
          "COUNTING"
        ],
        "template": "{character} wants to buy books at the book fair. Calculate the total cost.",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      }
    ]
  }
}
# Test B.11: MULTI_STEP model
{
  "success": true,
  "question": {
    "text": "Liam goes to the shop and buys apple, banana, sandwich, drink, cake, biscuit, sweet, chocolate, pen, pencil, ruler, notebook, eraser, book, comic, magazine, toy, game, puzzle, sticker, badge, poster, card. How much does Liam spend in total?",
    "options": [
      {
        "text": "12",
        "value": 12,
        "index": 0
      },
      {
        "text": "26",
        "value": 26,
        "index": 1
      },
      {
        "text": "£24.00",
        "value": 24,
        "index": 2
      },
      {
        "text": "23",
        "value": 23,
        "index": 3
      }
    ],
    "correctIndex": 2,
    "format": "DIRECT_CALCULATION",
    "difficulty": {
      "year": 4,
      "subLevel": 1,
      "displayName": "4.1",
      "cognitiveLoad": 40
    },
    "cognitiveLoad": 40,
    "curriculumTags": [
      "4N1a"
    ],
    "scenario": {
      "id": "shop-002-realistic-general",
      "theme": "SHOPPING",
      "setting": {
        "location": "local shop",
        "timeContext": "after school",
        "atmosphere": "friendly"
      },
      "characters": [
        {
          "name": "Liam",
          "role": "student"
        }
      ],
      "items": [
        {
          "name": "apple",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.2,
            "max": 0.5,
            "typical": 0.35,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "banana",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.15,
            "max": 0.4,
            "typical": 0.25,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "sandwich",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 2.5,
            "max": 6,
            "typical": 4,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "drink",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.8,
            "max": 2.5,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "cake",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 1.5,
            "max": 4,
            "typical": 2.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "biscuit",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.8,
            "max": 2,
            "typical": 1.2,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "sweet",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.1,
            "max": 1,
            "typical": 0.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "chocolate",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.6,
            "max": 3,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "pen",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.5,
            "max": 2,
            "typical": 1,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "pencil",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.2,
            "max": 1,
            "typical": 0.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "ruler",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.8,
            "max": 2.5,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "notebook",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 1,
            "max": 4,
            "typical": 2,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "eraser",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.3,
            "max": 1.5,
            "typical": 0.75,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "book",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 3,
            "max": 15,
            "typical": 8,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "comic",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 2,
            "max": 5,
            "typical": 3,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "magazine",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 2.5,
            "max": 6,
            "typical": 4,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "toy",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 5,
            "max": 25,
            "typical": 12,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "game",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 8,
            "max": 60,
            "typical": 25,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "puzzle",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 5,
            "max": 20,
            "typical": 12,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "sticker",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 0.2,
            "max": 2,
            "typical": 0.8,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "badge",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 0.5,
            "max": 3,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "poster",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 2,
            "max": 8,
            "typical": 4,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "card",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 0.5,
            "max": 4,
            "typical": 2,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        }
      ],
      "culturalElements": [
        {
          "type": "currency",
          "value": "£",
          "explanation": "British pounds"
        },
        {
          "type": "location",
          "value": "UK local shop",
          "explanation": "Typical British corner shop"
        }
      ],
      "realWorldConnection": "Everyday shopping with realistic UK prices",
      "yearAppropriate": [
        1,
        2,
        3,
        4,
        5,
        6
      ],
      "templates": [
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "MULTI_STEP"
          ],
          "modelCompatibility": [
            "ADDITION"
          ],
          "operandCount": 3,
          "template": "{character} buys {article1} {item1} for {price1}, {article2} {item2} for {price2}, and {article3} {item3} for {price3}. What is the total cost?",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item1",
              "type": "item"
            },
            {
              "key": "item2",
              "type": "item"
            },
            {
              "key": "item3",
              "type": "item"
            },
            {
              "key": "price1",
              "type": "value"
            },
            {
              "key": "price2",
              "type": "value"
            },
            {
              "key": "price3",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "MULTI_STEP"
          ],
          "modelCompatibility": [
            "ADDITION"
          ],
          "operandCount": 2,
          "template": "{character} buys {article1} {item1} for {price1} and {article2} {item2} for {price2}. What is the total cost?",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item1",
              "type": "item"
            },
            {
              "key": "item2",
              "type": "item"
            },
            {
              "key": "price1",
              "type": "value"
            },
            {
              "key": "price2",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION"
          ],
          "modelCompatibility": [
            "SUBTRACTION",
            "CHANGE_CALCULATION"
          ],
          "template": "{character} buys {article} {item} for {price} and pays with {payment}. How much change does {character} get?",
          "answerTemplate": "{character} receives {result} in change",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "price",
              "type": "value"
            },
            {
              "key": "payment",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION"
          ],
          "modelCompatibility": [
            "MULTIPLICATION"
          ],
          "template": "{character} buys {quantity} {item} at {price} each. What is the total cost?",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "quantity",
              "type": "value"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "price",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION"
          ],
          "modelCompatibility": [
            "DIVISION"
          ],
          "template": "{character} has {total} to spend equally on {quantity} {item}. How much can {character} spend on each one?",
          "answerTemplate": "{character} can spend {result} on each {item}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "total",
              "type": "value"
            },
            {
              "key": "quantity",
              "type": "value"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "COMPARISON",
            "ESTIMATION",
            "MULTI_STEP"
          ],
          "template": "{character} goes to the shop and buys {items}. How much does {character} spend in total?",
          "answerTemplate": "{character} spends {result} in total",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "items",
              "type": "item_list"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "ESTIMATION"
          ],
          "template": "Estimate: If {character} buys {items}, about how much will it cost?",
          "answerTemplate": "It will cost approximately {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "items",
              "type": "item_list"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "VALIDATION"
          ],
          "template": "{character} calculated that {items} costs {amount}. Is this correct?",
          "answerTemplate": "{validation_result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "items",
              "type": "item_list"
            },
            {
              "key": "amount",
              "type": "value"
            },
            {
              "key": "validation_result",
              "type": "boolean"
            }
          ]
        }
      ]
    },
    "distractors": [
      {
        "value": 26,
        "displayText": "26",
        "strategy": "CLOSE_VALUE",
        "reasoning": "Off by 2"
      },
      {
        "value": 23,
        "strategy": "CLOSE_VALUE",
        "displayText": "23",
        "reasoning": "Off by one (lower)"
      },
      {
        "value": 12,
        "displayText": "12",
        "reasoning": "Half the correct value"
      }
    ],
    "enhancementStatus": {
      "level": "partial",
      "requestedFormat": "DIRECT_CALCULATION",
      "actualFormat": "DIRECT_CALCULATION",
      "featuresActive": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "featuresPending": [],
      "isFullyEnhanced": true
    },
    "mathOutput": {
      "operation": "MULTI_STEP",
      "step_1_result": 36,
      "step_2_result": 51,
      "step_3_result": 24
    },
    "generationTime": 1,
    "questionId": "q_1759234377112_aivgyi8cx",
    "generationSetup": {
      "controller_used": "DIRECT_CALCULATIONController",
      "format_requested": "DIRECT_CALCULATION",
      "format_actual": "DIRECT_CALCULATION",
      "scenario_theme": "SHOPPING",
      "scenario_id": "shop-002-realistic-general",
      "scenario_selection_method": "default",
      "distractor_strategies": [
        "CLOSE_VALUE",
        "CLOSE_VALUE",
        null
      ],
      "distractor_count": 3,
      "theme_variety": false,
      "format_variety": false,
      "enhancement_level": "partial",
      "features_active": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "features_pending": [],
      "generation_time_ms": 1
    }
  },
  "metadata": {
    "format": "DIRECT_CALCULATION",
    "cognitive_load": 40,
    "curriculum_alignment": [
      "4N1a"
    ],
    "difficulty": "4.1",
    "scenario_theme": "SHOPPING",
    "distractor_strategies": [
      "CLOSE_VALUE",
      "CLOSE_VALUE",
      null
    ],
    "generation_time_ms": 1,
    "api_version": "2.0",
    "enhancement_status": "partial",
    "format_requested": "DIRECT_CALCULATION",
    "format_used": "DIRECT_CALCULATION",
    "features_active": [
      "enhanced_distractors",
      "rich_scenarios",
      "cognitive_load",
      "advanced_formats"
    ],
    "features_pending": []
  },
  "context": {
    "id": "shop-002-realistic-general",
    "theme": "SHOPPING",
    "setting": {
      "location": "local shop",
      "timeContext": "after school",
      "atmosphere": "friendly"
    },
    "characters": [
      {
        "name": "Liam",
        "role": "student"
      }
    ],
    "items": [
      {
        "name": "apple",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.2,
          "max": 0.5,
          "typical": 0.35,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "banana",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.15,
          "max": 0.4,
          "typical": 0.25,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "sandwich",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 2.5,
          "max": 6,
          "typical": 4,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "drink",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.8,
          "max": 2.5,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "cake",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 1.5,
          "max": 4,
          "typical": 2.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "biscuit",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.8,
          "max": 2,
          "typical": 1.2,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "sweet",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.1,
          "max": 1,
          "typical": 0.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "chocolate",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.6,
          "max": 3,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "pen",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.5,
          "max": 2,
          "typical": 1,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "pencil",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.2,
          "max": 1,
          "typical": 0.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "ruler",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.8,
          "max": 2.5,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "notebook",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 1,
          "max": 4,
          "typical": 2,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "eraser",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.3,
          "max": 1.5,
          "typical": 0.75,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "book",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 3,
          "max": 15,
          "typical": 8,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "comic",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 2,
          "max": 5,
          "typical": 3,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "magazine",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 2.5,
          "max": 6,
          "typical": 4,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "toy",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 5,
          "max": 25,
          "typical": 12,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "game",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 8,
          "max": 60,
          "typical": 25,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "puzzle",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 5,
          "max": 20,
          "typical": 12,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "sticker",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 0.2,
          "max": 2,
          "typical": 0.8,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "badge",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 0.5,
          "max": 3,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "poster",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 2,
          "max": 8,
          "typical": 4,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "card",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 0.5,
          "max": 4,
          "typical": 2,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      }
    ],
    "culturalElements": [
      {
        "type": "currency",
        "value": "£",
        "explanation": "British pounds"
      },
      {
        "type": "location",
        "value": "UK local shop",
        "explanation": "Typical British corner shop"
      }
    ],
    "realWorldConnection": "Everyday shopping with realistic UK prices",
    "yearAppropriate": [
      1,
      2,
      3,
      4,
      5,
      6
    ],
    "templates": [
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "MULTI_STEP"
        ],
        "modelCompatibility": [
          "ADDITION"
        ],
        "operandCount": 3,
        "template": "{character} buys {article1} {item1} for {price1}, {article2} {item2} for {price2}, and {article3} {item3} for {price3}. What is the total cost?",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item1",
            "type": "item"
          },
          {
            "key": "item2",
            "type": "item"
          },
          {
            "key": "item3",
            "type": "item"
          },
          {
            "key": "price1",
            "type": "value"
          },
          {
            "key": "price2",
            "type": "value"
          },
          {
            "key": "price3",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "MULTI_STEP"
        ],
        "modelCompatibility": [
          "ADDITION"
        ],
        "operandCount": 2,
        "template": "{character} buys {article1} {item1} for {price1} and {article2} {item2} for {price2}. What is the total cost?",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item1",
            "type": "item"
          },
          {
            "key": "item2",
            "type": "item"
          },
          {
            "key": "price1",
            "type": "value"
          },
          {
            "key": "price2",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION"
        ],
        "modelCompatibility": [
          "SUBTRACTION",
          "CHANGE_CALCULATION"
        ],
        "template": "{character} buys {article} {item} for {price} and pays with {payment}. How much change does {character} get?",
        "answerTemplate": "{character} receives {result} in change",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "price",
            "type": "value"
          },
          {
            "key": "payment",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION"
        ],
        "modelCompatibility": [
          "MULTIPLICATION"
        ],
        "template": "{character} buys {quantity} {item} at {price} each. What is the total cost?",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "quantity",
            "type": "value"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "price",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION"
        ],
        "modelCompatibility": [
          "DIVISION"
        ],
        "template": "{character} has {total} to spend equally on {quantity} {item}. How much can {character} spend on each one?",
        "answerTemplate": "{character} can spend {result} on each {item}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "total",
            "type": "value"
          },
          {
            "key": "quantity",
            "type": "value"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "COMPARISON",
          "ESTIMATION",
          "MULTI_STEP"
        ],
        "template": "{character} goes to the shop and buys {items}. How much does {character} spend in total?",
        "answerTemplate": "{character} spends {result} in total",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "items",
            "type": "item_list"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "ESTIMATION"
        ],
        "template": "Estimate: If {character} buys {items}, about how much will it cost?",
        "answerTemplate": "It will cost approximately {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "items",
            "type": "item_list"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "VALIDATION"
        ],
        "template": "{character} calculated that {items} costs {amount}. Is this correct?",
        "answerTemplate": "{validation_result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "items",
            "type": "item_list"
          },
          {
            "key": "amount",
            "type": "value"
          },
          {
            "key": "validation_result",
            "type": "boolean"
          }
        ]
      }
    ]
  }
}
# Test B.12: LINEAR_EQUATION model
{
  "error": "Model LINEAR_EQUATION is currently disabled",
  "status": "broken",
  "reason": "Template generation issues, Under testing phase"
}
# Test B.13: UNIT_RATE model
{
  "success": true,
  "question": {
    "text": "Liam goes to the shop and buys apple, banana, sandwich, drink, cake, biscuit, sweet, chocolate, pen, pencil, ruler, notebook, eraser, book, comic, magazine, toy, game, puzzle, sticker, badge, poster, card. How much does Liam spend in total?",
    "options": [
      {
        "value": 0,
        "text": "0p",
        "isCorrect": true
      }
    ],
    "correctIndex": 0,
    "format": "DIRECT_CALCULATION",
    "difficulty": {
      "year": 4,
      "subLevel": 1,
      "displayName": "4.1",
      "cognitiveLoad": 40
    },
    "cognitiveLoad": 40,
    "curriculumTags": [
      "4N1a"
    ],
    "scenario": {
      "id": "shop-002-realistic-general",
      "theme": "SHOPPING",
      "setting": {
        "location": "local shop",
        "timeContext": "after school",
        "atmosphere": "friendly"
      },
      "characters": [
        {
          "name": "Liam",
          "role": "student"
        }
      ],
      "items": [
        {
          "name": "apple",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.2,
            "max": 0.5,
            "typical": 0.35,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "banana",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.15,
            "max": 0.4,
            "typical": 0.25,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "sandwich",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 2.5,
            "max": 6,
            "typical": 4,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "drink",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.8,
            "max": 2.5,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "cake",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 1.5,
            "max": 4,
            "typical": 2.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "biscuit",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.8,
            "max": 2,
            "typical": 1.2,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "sweet",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.1,
            "max": 1,
            "typical": 0.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "chocolate",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.6,
            "max": 3,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "pen",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.5,
            "max": 2,
            "typical": 1,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "pencil",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.2,
            "max": 1,
            "typical": 0.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "ruler",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.8,
            "max": 2.5,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "notebook",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 1,
            "max": 4,
            "typical": 2,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "eraser",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.3,
            "max": 1.5,
            "typical": 0.75,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "book",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 3,
            "max": 15,
            "typical": 8,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "comic",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 2,
            "max": 5,
            "typical": 3,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "magazine",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 2.5,
            "max": 6,
            "typical": 4,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "toy",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 5,
            "max": 25,
            "typical": 12,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "game",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 8,
            "max": 60,
            "typical": 25,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "puzzle",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 5,
            "max": 20,
            "typical": 12,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "sticker",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 0.2,
            "max": 2,
            "typical": 0.8,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "badge",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 0.5,
            "max": 3,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "poster",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 2,
            "max": 8,
            "typical": 4,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "card",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 0.5,
            "max": 4,
            "typical": 2,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        }
      ],
      "culturalElements": [
        {
          "type": "currency",
          "value": "£",
          "explanation": "British pounds"
        },
        {
          "type": "location",
          "value": "UK local shop",
          "explanation": "Typical British corner shop"
        }
      ],
      "realWorldConnection": "Everyday shopping with realistic UK prices",
      "yearAppropriate": [
        1,
        2,
        3,
        4,
        5,
        6
      ],
      "templates": [
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "MULTI_STEP"
          ],
          "modelCompatibility": [
            "ADDITION"
          ],
          "operandCount": 3,
          "template": "{character} buys {article1} {item1} for {price1}, {article2} {item2} for {price2}, and {article3} {item3} for {price3}. What is the total cost?",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item1",
              "type": "item"
            },
            {
              "key": "item2",
              "type": "item"
            },
            {
              "key": "item3",
              "type": "item"
            },
            {
              "key": "price1",
              "type": "value"
            },
            {
              "key": "price2",
              "type": "value"
            },
            {
              "key": "price3",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "MULTI_STEP"
          ],
          "modelCompatibility": [
            "ADDITION"
          ],
          "operandCount": 2,
          "template": "{character} buys {article1} {item1} for {price1} and {article2} {item2} for {price2}. What is the total cost?",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item1",
              "type": "item"
            },
            {
              "key": "item2",
              "type": "item"
            },
            {
              "key": "price1",
              "type": "value"
            },
            {
              "key": "price2",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION"
          ],
          "modelCompatibility": [
            "SUBTRACTION",
            "CHANGE_CALCULATION"
          ],
          "template": "{character} buys {article} {item} for {price} and pays with {payment}. How much change does {character} get?",
          "answerTemplate": "{character} receives {result} in change",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "price",
              "type": "value"
            },
            {
              "key": "payment",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION"
          ],
          "modelCompatibility": [
            "MULTIPLICATION"
          ],
          "template": "{character} buys {quantity} {item} at {price} each. What is the total cost?",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "quantity",
              "type": "value"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "price",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION"
          ],
          "modelCompatibility": [
            "DIVISION"
          ],
          "template": "{character} has {total} to spend equally on {quantity} {item}. How much can {character} spend on each one?",
          "answerTemplate": "{character} can spend {result} on each {item}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "total",
              "type": "value"
            },
            {
              "key": "quantity",
              "type": "value"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "COMPARISON",
            "ESTIMATION",
            "MULTI_STEP"
          ],
          "template": "{character} goes to the shop and buys {items}. How much does {character} spend in total?",
          "answerTemplate": "{character} spends {result} in total",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "items",
              "type": "item_list"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "ESTIMATION"
          ],
          "template": "Estimate: If {character} buys {items}, about how much will it cost?",
          "answerTemplate": "It will cost approximately {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "items",
              "type": "item_list"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "VALIDATION"
          ],
          "template": "{character} calculated that {items} costs {amount}. Is this correct?",
          "answerTemplate": "{validation_result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "items",
              "type": "item_list"
            },
            {
              "key": "amount",
              "type": "value"
            },
            {
              "key": "validation_result",
              "type": "boolean"
            }
          ]
        }
      ]
    },
    "distractors": [],
    "enhancementStatus": {
      "level": "partial",
      "requestedFormat": "DIRECT_CALCULATION",
      "actualFormat": "DIRECT_CALCULATION",
      "featuresActive": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "featuresPending": [],
      "isFullyEnhanced": true
    },
    "mathOutput": {
      "operation": "UNIT_RATE"
    },
    "generationTime": 1,
    "questionId": "q_1759234377205_p7emwx20b",
    "generationSetup": {
      "controller_used": "DIRECT_CALCULATIONController",
      "format_requested": "DIRECT_CALCULATION",
      "format_actual": "DIRECT_CALCULATION",
      "scenario_theme": "SHOPPING",
      "scenario_id": "shop-002-realistic-general",
      "scenario_selection_method": "default",
      "distractor_strategies": [],
      "distractor_count": 0,
      "theme_variety": false,
      "format_variety": false,
      "enhancement_level": "partial",
      "features_active": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "features_pending": [],
      "generation_time_ms": 1
    }
  },
  "metadata": {
    "format": "DIRECT_CALCULATION",
    "cognitive_load": 40,
    "curriculum_alignment": [
      "4N1a"
    ],
    "difficulty": "4.1",
    "scenario_theme": "SHOPPING",
    "distractor_strategies": [],
    "generation_time_ms": 1,
    "api_version": "2.0",
    "enhancement_status": "partial",
    "format_requested": "DIRECT_CALCULATION",
    "format_used": "DIRECT_CALCULATION",
    "features_active": [
      "enhanced_distractors",
      "rich_scenarios",
      "cognitive_load",
      "advanced_formats"
    ],
    "features_pending": []
  },
  "context": {
    "id": "shop-002-realistic-general",
    "theme": "SHOPPING",
    "setting": {
      "location": "local shop",
      "timeContext": "after school",
      "atmosphere": "friendly"
    },
    "characters": [
      {
        "name": "Liam",
        "role": "student"
      }
    ],
    "items": [
      {
        "name": "apple",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.2,
          "max": 0.5,
          "typical": 0.35,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "banana",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.15,
          "max": 0.4,
          "typical": 0.25,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "sandwich",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 2.5,
          "max": 6,
          "typical": 4,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "drink",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.8,
          "max": 2.5,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "cake",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 1.5,
          "max": 4,
          "typical": 2.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "biscuit",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.8,
          "max": 2,
          "typical": 1.2,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "sweet",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.1,
          "max": 1,
          "typical": 0.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "chocolate",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.6,
          "max": 3,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "pen",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.5,
          "max": 2,
          "typical": 1,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "pencil",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.2,
          "max": 1,
          "typical": 0.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "ruler",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.8,
          "max": 2.5,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "notebook",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 1,
          "max": 4,
          "typical": 2,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "eraser",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.3,
          "max": 1.5,
          "typical": 0.75,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "book",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 3,
          "max": 15,
          "typical": 8,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "comic",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 2,
          "max": 5,
          "typical": 3,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "magazine",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 2.5,
          "max": 6,
          "typical": 4,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "toy",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 5,
          "max": 25,
          "typical": 12,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "game",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 8,
          "max": 60,
          "typical": 25,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "puzzle",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 5,
          "max": 20,
          "typical": 12,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "sticker",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 0.2,
          "max": 2,
          "typical": 0.8,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "badge",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 0.5,
          "max": 3,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "poster",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 2,
          "max": 8,
          "typical": 4,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "card",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 0.5,
          "max": 4,
          "typical": 2,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      }
    ],
    "culturalElements": [
      {
        "type": "currency",
        "value": "£",
        "explanation": "British pounds"
      },
      {
        "type": "location",
        "value": "UK local shop",
        "explanation": "Typical British corner shop"
      }
    ],
    "realWorldConnection": "Everyday shopping with realistic UK prices",
    "yearAppropriate": [
      1,
      2,
      3,
      4,
      5,
      6
    ],
    "templates": [
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "MULTI_STEP"
        ],
        "modelCompatibility": [
          "ADDITION"
        ],
        "operandCount": 3,
        "template": "{character} buys {article1} {item1} for {price1}, {article2} {item2} for {price2}, and {article3} {item3} for {price3}. What is the total cost?",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item1",
            "type": "item"
          },
          {
            "key": "item2",
            "type": "item"
          },
          {
            "key": "item3",
            "type": "item"
          },
          {
            "key": "price1",
            "type": "value"
          },
          {
            "key": "price2",
            "type": "value"
          },
          {
            "key": "price3",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "MULTI_STEP"
        ],
        "modelCompatibility": [
          "ADDITION"
        ],
        "operandCount": 2,
        "template": "{character} buys {article1} {item1} for {price1} and {article2} {item2} for {price2}. What is the total cost?",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item1",
            "type": "item"
          },
          {
            "key": "item2",
            "type": "item"
          },
          {
            "key": "price1",
            "type": "value"
          },
          {
            "key": "price2",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION"
        ],
        "modelCompatibility": [
          "SUBTRACTION",
          "CHANGE_CALCULATION"
        ],
        "template": "{character} buys {article} {item} for {price} and pays with {payment}. How much change does {character} get?",
        "answerTemplate": "{character} receives {result} in change",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "price",
            "type": "value"
          },
          {
            "key": "payment",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION"
        ],
        "modelCompatibility": [
          "MULTIPLICATION"
        ],
        "template": "{character} buys {quantity} {item} at {price} each. What is the total cost?",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "quantity",
            "type": "value"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "price",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION"
        ],
        "modelCompatibility": [
          "DIVISION"
        ],
        "template": "{character} has {total} to spend equally on {quantity} {item}. How much can {character} spend on each one?",
        "answerTemplate": "{character} can spend {result} on each {item}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "total",
            "type": "value"
          },
          {
            "key": "quantity",
            "type": "value"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "COMPARISON",
          "ESTIMATION",
          "MULTI_STEP"
        ],
        "template": "{character} goes to the shop and buys {items}. How much does {character} spend in total?",
        "answerTemplate": "{character} spends {result} in total",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "items",
            "type": "item_list"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "ESTIMATION"
        ],
        "template": "Estimate: If {character} buys {items}, about how much will it cost?",
        "answerTemplate": "It will cost approximately {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "items",
            "type": "item_list"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "VALIDATION"
        ],
        "template": "{character} calculated that {items} costs {amount}. Is this correct?",
        "answerTemplate": "{validation_result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "items",
            "type": "item_list"
          },
          {
            "key": "amount",
            "type": "value"
          },
          {
            "key": "validation_result",
            "type": "boolean"
          }
        ]
      }
    ]
  }
}
# Test B.14: COIN_RECOGNITION model
{
  "success": true,
  "question": {
    "text": "Liam goes to the shop and buys apple, banana, sandwich, drink, cake, biscuit, sweet, chocolate, pen, pencil, ruler, notebook, eraser, book, comic, magazine, toy, game, puzzle, sticker, badge, poster, card. How much does Liam spend in total?",
    "options": [
      {
        "value": 0,
        "text": "0p",
        "isCorrect": true
      }
    ],
    "correctIndex": 0,
    "format": "DIRECT_CALCULATION",
    "difficulty": {
      "year": 4,
      "subLevel": 1,
      "displayName": "4.1",
      "cognitiveLoad": 40
    },
    "cognitiveLoad": 40,
    "curriculumTags": [
      "4N1a"
    ],
    "scenario": {
      "id": "shop-002-realistic-general",
      "theme": "SHOPPING",
      "setting": {
        "location": "local shop",
        "timeContext": "after school",
        "atmosphere": "friendly"
      },
      "characters": [
        {
          "name": "Liam",
          "role": "student"
        }
      ],
      "items": [
        {
          "name": "apple",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.2,
            "max": 0.5,
            "typical": 0.35,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "banana",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.15,
            "max": 0.4,
            "typical": 0.25,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "sandwich",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 2.5,
            "max": 6,
            "typical": 4,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "drink",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.8,
            "max": 2.5,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "cake",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 1.5,
            "max": 4,
            "typical": 2.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "biscuit",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.8,
            "max": 2,
            "typical": 1.2,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "sweet",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.1,
            "max": 1,
            "typical": 0.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "chocolate",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.6,
            "max": 3,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "pen",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.5,
            "max": 2,
            "typical": 1,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "pencil",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.2,
            "max": 1,
            "typical": 0.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "ruler",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.8,
            "max": 2.5,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "notebook",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 1,
            "max": 4,
            "typical": 2,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "eraser",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.3,
            "max": 1.5,
            "typical": 0.75,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "book",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 3,
            "max": 15,
            "typical": 8,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "comic",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 2,
            "max": 5,
            "typical": 3,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "magazine",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 2.5,
            "max": 6,
            "typical": 4,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "toy",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 5,
            "max": 25,
            "typical": 12,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "game",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 8,
            "max": 60,
            "typical": 25,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "puzzle",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 5,
            "max": 20,
            "typical": 12,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "sticker",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 0.2,
            "max": 2,
            "typical": 0.8,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "badge",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 0.5,
            "max": 3,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "poster",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 2,
            "max": 8,
            "typical": 4,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "card",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 0.5,
            "max": 4,
            "typical": 2,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        }
      ],
      "culturalElements": [
        {
          "type": "currency",
          "value": "£",
          "explanation": "British pounds"
        },
        {
          "type": "location",
          "value": "UK local shop",
          "explanation": "Typical British corner shop"
        }
      ],
      "realWorldConnection": "Everyday shopping with realistic UK prices",
      "yearAppropriate": [
        1,
        2,
        3,
        4,
        5,
        6
      ],
      "templates": [
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "MULTI_STEP"
          ],
          "modelCompatibility": [
            "ADDITION"
          ],
          "operandCount": 3,
          "template": "{character} buys {article1} {item1} for {price1}, {article2} {item2} for {price2}, and {article3} {item3} for {price3}. What is the total cost?",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item1",
              "type": "item"
            },
            {
              "key": "item2",
              "type": "item"
            },
            {
              "key": "item3",
              "type": "item"
            },
            {
              "key": "price1",
              "type": "value"
            },
            {
              "key": "price2",
              "type": "value"
            },
            {
              "key": "price3",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "MULTI_STEP"
          ],
          "modelCompatibility": [
            "ADDITION"
          ],
          "operandCount": 2,
          "template": "{character} buys {article1} {item1} for {price1} and {article2} {item2} for {price2}. What is the total cost?",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item1",
              "type": "item"
            },
            {
              "key": "item2",
              "type": "item"
            },
            {
              "key": "price1",
              "type": "value"
            },
            {
              "key": "price2",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION"
          ],
          "modelCompatibility": [
            "SUBTRACTION",
            "CHANGE_CALCULATION"
          ],
          "template": "{character} buys {article} {item} for {price} and pays with {payment}. How much change does {character} get?",
          "answerTemplate": "{character} receives {result} in change",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "price",
              "type": "value"
            },
            {
              "key": "payment",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION"
          ],
          "modelCompatibility": [
            "MULTIPLICATION"
          ],
          "template": "{character} buys {quantity} {item} at {price} each. What is the total cost?",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "quantity",
              "type": "value"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "price",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION"
          ],
          "modelCompatibility": [
            "DIVISION"
          ],
          "template": "{character} has {total} to spend equally on {quantity} {item}. How much can {character} spend on each one?",
          "answerTemplate": "{character} can spend {result} on each {item}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "total",
              "type": "value"
            },
            {
              "key": "quantity",
              "type": "value"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "COMPARISON",
            "ESTIMATION",
            "MULTI_STEP"
          ],
          "template": "{character} goes to the shop and buys {items}. How much does {character} spend in total?",
          "answerTemplate": "{character} spends {result} in total",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "items",
              "type": "item_list"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "ESTIMATION"
          ],
          "template": "Estimate: If {character} buys {items}, about how much will it cost?",
          "answerTemplate": "It will cost approximately {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "items",
              "type": "item_list"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "VALIDATION"
          ],
          "template": "{character} calculated that {items} costs {amount}. Is this correct?",
          "answerTemplate": "{validation_result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "items",
              "type": "item_list"
            },
            {
              "key": "amount",
              "type": "value"
            },
            {
              "key": "validation_result",
              "type": "boolean"
            }
          ]
        }
      ]
    },
    "distractors": [],
    "enhancementStatus": {
      "level": "partial",
      "requestedFormat": "DIRECT_CALCULATION",
      "actualFormat": "DIRECT_CALCULATION",
      "featuresActive": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "featuresPending": [],
      "isFullyEnhanced": true
    },
    "mathOutput": {
      "operation": "COIN_RECOGNITION",
      "total_value": 2000
    },
    "generationTime": 1,
    "questionId": "q_1759234377253_m455u6g73",
    "generationSetup": {
      "controller_used": "DIRECT_CALCULATIONController",
      "format_requested": "DIRECT_CALCULATION",
      "format_actual": "DIRECT_CALCULATION",
      "scenario_theme": "SHOPPING",
      "scenario_id": "shop-002-realistic-general",
      "scenario_selection_method": "default",
      "distractor_strategies": [],
      "distractor_count": 0,
      "theme_variety": false,
      "format_variety": false,
      "enhancement_level": "partial",
      "features_active": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "features_pending": [],
      "generation_time_ms": 1
    }
  },
  "metadata": {
    "format": "DIRECT_CALCULATION",
    "cognitive_load": 40,
    "curriculum_alignment": [
      "4N1a"
    ],
    "difficulty": "4.1",
    "scenario_theme": "SHOPPING",
    "distractor_strategies": [],
    "generation_time_ms": 1,
    "api_version": "2.0",
    "enhancement_status": "partial",
    "format_requested": "DIRECT_CALCULATION",
    "format_used": "DIRECT_CALCULATION",
    "features_active": [
      "enhanced_distractors",
      "rich_scenarios",
      "cognitive_load",
      "advanced_formats"
    ],
    "features_pending": []
  },
  "context": {
    "id": "shop-002-realistic-general",
    "theme": "SHOPPING",
    "setting": {
      "location": "local shop",
      "timeContext": "after school",
      "atmosphere": "friendly"
    },
    "characters": [
      {
        "name": "Liam",
        "role": "student"
      }
    ],
    "items": [
      {
        "name": "apple",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.2,
          "max": 0.5,
          "typical": 0.35,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "banana",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.15,
          "max": 0.4,
          "typical": 0.25,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "sandwich",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 2.5,
          "max": 6,
          "typical": 4,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "drink",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.8,
          "max": 2.5,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "cake",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 1.5,
          "max": 4,
          "typical": 2.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "biscuit",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.8,
          "max": 2,
          "typical": 1.2,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "sweet",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.1,
          "max": 1,
          "typical": 0.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "chocolate",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.6,
          "max": 3,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "pen",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.5,
          "max": 2,
          "typical": 1,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "pencil",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.2,
          "max": 1,
          "typical": 0.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "ruler",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.8,
          "max": 2.5,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "notebook",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 1,
          "max": 4,
          "typical": 2,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "eraser",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.3,
          "max": 1.5,
          "typical": 0.75,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "book",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 3,
          "max": 15,
          "typical": 8,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "comic",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 2,
          "max": 5,
          "typical": 3,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "magazine",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 2.5,
          "max": 6,
          "typical": 4,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "toy",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 5,
          "max": 25,
          "typical": 12,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "game",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 8,
          "max": 60,
          "typical": 25,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "puzzle",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 5,
          "max": 20,
          "typical": 12,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "sticker",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 0.2,
          "max": 2,
          "typical": 0.8,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "badge",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 0.5,
          "max": 3,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "poster",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 2,
          "max": 8,
          "typical": 4,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "card",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 0.5,
          "max": 4,
          "typical": 2,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      }
    ],
    "culturalElements": [
      {
        "type": "currency",
        "value": "£",
        "explanation": "British pounds"
      },
      {
        "type": "location",
        "value": "UK local shop",
        "explanation": "Typical British corner shop"
      }
    ],
    "realWorldConnection": "Everyday shopping with realistic UK prices",
    "yearAppropriate": [
      1,
      2,
      3,
      4,
      5,
      6
    ],
    "templates": [
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "MULTI_STEP"
        ],
        "modelCompatibility": [
          "ADDITION"
        ],
        "operandCount": 3,
        "template": "{character} buys {article1} {item1} for {price1}, {article2} {item2} for {price2}, and {article3} {item3} for {price3}. What is the total cost?",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item1",
            "type": "item"
          },
          {
            "key": "item2",
            "type": "item"
          },
          {
            "key": "item3",
            "type": "item"
          },
          {
            "key": "price1",
            "type": "value"
          },
          {
            "key": "price2",
            "type": "value"
          },
          {
            "key": "price3",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "MULTI_STEP"
        ],
        "modelCompatibility": [
          "ADDITION"
        ],
        "operandCount": 2,
        "template": "{character} buys {article1} {item1} for {price1} and {article2} {item2} for {price2}. What is the total cost?",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item1",
            "type": "item"
          },
          {
            "key": "item2",
            "type": "item"
          },
          {
            "key": "price1",
            "type": "value"
          },
          {
            "key": "price2",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION"
        ],
        "modelCompatibility": [
          "SUBTRACTION",
          "CHANGE_CALCULATION"
        ],
        "template": "{character} buys {article} {item} for {price} and pays with {payment}. How much change does {character} get?",
        "answerTemplate": "{character} receives {result} in change",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "price",
            "type": "value"
          },
          {
            "key": "payment",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION"
        ],
        "modelCompatibility": [
          "MULTIPLICATION"
        ],
        "template": "{character} buys {quantity} {item} at {price} each. What is the total cost?",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "quantity",
            "type": "value"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "price",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION"
        ],
        "modelCompatibility": [
          "DIVISION"
        ],
        "template": "{character} has {total} to spend equally on {quantity} {item}. How much can {character} spend on each one?",
        "answerTemplate": "{character} can spend {result} on each {item}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "total",
            "type": "value"
          },
          {
            "key": "quantity",
            "type": "value"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "COMPARISON",
          "ESTIMATION",
          "MULTI_STEP"
        ],
        "template": "{character} goes to the shop and buys {items}. How much does {character} spend in total?",
        "answerTemplate": "{character} spends {result} in total",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "items",
            "type": "item_list"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "ESTIMATION"
        ],
        "template": "Estimate: If {character} buys {items}, about how much will it cost?",
        "answerTemplate": "It will cost approximately {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "items",
            "type": "item_list"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "VALIDATION"
        ],
        "template": "{character} calculated that {items} costs {amount}. Is this correct?",
        "answerTemplate": "{validation_result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "items",
            "type": "item_list"
          },
          {
            "key": "amount",
            "type": "value"
          },
          {
            "key": "validation_result",
            "type": "boolean"
          }
        ]
      }
    ]
  }
}
# Test B.15: CHANGE_CALCULATION model
{
  "success": true,
  "question": {
    "text": "Liam buys an apple for £1.40 and pays with 140. How much change does Liam get?",
    "options": [
      {
        "value": 0,
        "text": "0p",
        "isCorrect": true
      }
    ],
    "correctIndex": 0,
    "format": "DIRECT_CALCULATION",
    "difficulty": {
      "year": 4,
      "subLevel": 1,
      "displayName": "4.1",
      "cognitiveLoad": 40
    },
    "cognitiveLoad": 40,
    "curriculumTags": [
      "4N1a"
    ],
    "scenario": {
      "id": "shop-002-realistic-general",
      "theme": "SHOPPING",
      "setting": {
        "location": "local shop",
        "timeContext": "after school",
        "atmosphere": "friendly"
      },
      "characters": [
        {
          "name": "Liam",
          "role": "student"
        }
      ],
      "items": [
        {
          "name": "apple",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.2,
            "max": 0.5,
            "typical": 0.35,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "banana",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.15,
            "max": 0.4,
            "typical": 0.25,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "sandwich",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 2.5,
            "max": 6,
            "typical": 4,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "drink",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.8,
            "max": 2.5,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "cake",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 1.5,
            "max": 4,
            "typical": 2.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "biscuit",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.8,
            "max": 2,
            "typical": 1.2,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "sweet",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.1,
            "max": 1,
            "typical": 0.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "chocolate",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.6,
            "max": 3,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "pen",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.5,
            "max": 2,
            "typical": 1,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "pencil",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.2,
            "max": 1,
            "typical": 0.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "ruler",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.8,
            "max": 2.5,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "notebook",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 1,
            "max": 4,
            "typical": 2,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "eraser",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.3,
            "max": 1.5,
            "typical": 0.75,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "book",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 3,
            "max": 15,
            "typical": 8,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "comic",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 2,
            "max": 5,
            "typical": 3,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "magazine",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 2.5,
            "max": 6,
            "typical": 4,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "toy",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 5,
            "max": 25,
            "typical": 12,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "game",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 8,
            "max": 60,
            "typical": 25,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "puzzle",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 5,
            "max": 20,
            "typical": 12,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "sticker",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 0.2,
            "max": 2,
            "typical": 0.8,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "badge",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 0.5,
            "max": 3,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "poster",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 2,
            "max": 8,
            "typical": 4,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "card",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 0.5,
            "max": 4,
            "typical": 2,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        }
      ],
      "culturalElements": [
        {
          "type": "currency",
          "value": "£",
          "explanation": "British pounds"
        },
        {
          "type": "location",
          "value": "UK local shop",
          "explanation": "Typical British corner shop"
        }
      ],
      "realWorldConnection": "Everyday shopping with realistic UK prices",
      "yearAppropriate": [
        1,
        2,
        3,
        4,
        5,
        6
      ],
      "templates": [
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "MULTI_STEP"
          ],
          "modelCompatibility": [
            "ADDITION"
          ],
          "operandCount": 3,
          "template": "{character} buys {article1} {item1} for {price1}, {article2} {item2} for {price2}, and {article3} {item3} for {price3}. What is the total cost?",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item1",
              "type": "item"
            },
            {
              "key": "item2",
              "type": "item"
            },
            {
              "key": "item3",
              "type": "item"
            },
            {
              "key": "price1",
              "type": "value"
            },
            {
              "key": "price2",
              "type": "value"
            },
            {
              "key": "price3",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "MULTI_STEP"
          ],
          "modelCompatibility": [
            "ADDITION"
          ],
          "operandCount": 2,
          "template": "{character} buys {article1} {item1} for {price1} and {article2} {item2} for {price2}. What is the total cost?",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item1",
              "type": "item"
            },
            {
              "key": "item2",
              "type": "item"
            },
            {
              "key": "price1",
              "type": "value"
            },
            {
              "key": "price2",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION"
          ],
          "modelCompatibility": [
            "SUBTRACTION",
            "CHANGE_CALCULATION"
          ],
          "template": "{character} buys {article} {item} for {price} and pays with {payment}. How much change does {character} get?",
          "answerTemplate": "{character} receives {result} in change",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "price",
              "type": "value"
            },
            {
              "key": "payment",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION"
          ],
          "modelCompatibility": [
            "MULTIPLICATION"
          ],
          "template": "{character} buys {quantity} {item} at {price} each. What is the total cost?",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "quantity",
              "type": "value"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "price",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION"
          ],
          "modelCompatibility": [
            "DIVISION"
          ],
          "template": "{character} has {total} to spend equally on {quantity} {item}. How much can {character} spend on each one?",
          "answerTemplate": "{character} can spend {result} on each {item}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "total",
              "type": "value"
            },
            {
              "key": "quantity",
              "type": "value"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "COMPARISON",
            "ESTIMATION",
            "MULTI_STEP"
          ],
          "template": "{character} goes to the shop and buys {items}. How much does {character} spend in total?",
          "answerTemplate": "{character} spends {result} in total",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "items",
              "type": "item_list"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "ESTIMATION"
          ],
          "template": "Estimate: If {character} buys {items}, about how much will it cost?",
          "answerTemplate": "It will cost approximately {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "items",
              "type": "item_list"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "VALIDATION"
          ],
          "template": "{character} calculated that {items} costs {amount}. Is this correct?",
          "answerTemplate": "{validation_result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "items",
              "type": "item_list"
            },
            {
              "key": "amount",
              "type": "value"
            },
            {
              "key": "validation_result",
              "type": "boolean"
            }
          ]
        }
      ]
    },
    "distractors": [],
    "enhancementStatus": {
      "level": "partial",
      "requestedFormat": "DIRECT_CALCULATION",
      "actualFormat": "DIRECT_CALCULATION",
      "featuresActive": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "featuresPending": [],
      "isFullyEnhanced": true
    },
    "mathOutput": {
      "operation": "CHANGE_CALCULATION",
      "purchase_amount": 140,
      "payment": 140
    },
    "generationTime": 0,
    "questionId": "q_1759234377355_b1ykuruf2",
    "generationSetup": {
      "controller_used": "DIRECT_CALCULATIONController",
      "format_requested": "DIRECT_CALCULATION",
      "format_actual": "DIRECT_CALCULATION",
      "scenario_theme": "SHOPPING",
      "scenario_id": "shop-002-realistic-general",
      "scenario_selection_method": "default",
      "distractor_strategies": [],
      "distractor_count": 0,
      "theme_variety": false,
      "format_variety": false,
      "enhancement_level": "partial",
      "features_active": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "features_pending": [],
      "generation_time_ms": 0
    }
  },
  "metadata": {
    "format": "DIRECT_CALCULATION",
    "cognitive_load": 40,
    "curriculum_alignment": [
      "4N1a"
    ],
    "difficulty": "4.1",
    "scenario_theme": "SHOPPING",
    "distractor_strategies": [],
    "generation_time_ms": 1,
    "api_version": "2.0",
    "enhancement_status": "partial",
    "format_requested": "DIRECT_CALCULATION",
    "format_used": "DIRECT_CALCULATION",
    "features_active": [
      "enhanced_distractors",
      "rich_scenarios",
      "cognitive_load",
      "advanced_formats"
    ],
    "features_pending": []
  },
  "context": {
    "id": "shop-002-realistic-general",
    "theme": "SHOPPING",
    "setting": {
      "location": "local shop",
      "timeContext": "after school",
      "atmosphere": "friendly"
    },
    "characters": [
      {
        "name": "Liam",
        "role": "student"
      }
    ],
    "items": [
      {
        "name": "apple",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.2,
          "max": 0.5,
          "typical": 0.35,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "banana",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.15,
          "max": 0.4,
          "typical": 0.25,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "sandwich",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 2.5,
          "max": 6,
          "typical": 4,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "drink",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.8,
          "max": 2.5,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "cake",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 1.5,
          "max": 4,
          "typical": 2.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "biscuit",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.8,
          "max": 2,
          "typical": 1.2,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "sweet",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.1,
          "max": 1,
          "typical": 0.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "chocolate",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.6,
          "max": 3,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "pen",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.5,
          "max": 2,
          "typical": 1,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "pencil",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.2,
          "max": 1,
          "typical": 0.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "ruler",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.8,
          "max": 2.5,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "notebook",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 1,
          "max": 4,
          "typical": 2,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "eraser",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.3,
          "max": 1.5,
          "typical": 0.75,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "book",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 3,
          "max": 15,
          "typical": 8,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "comic",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 2,
          "max": 5,
          "typical": 3,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "magazine",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 2.5,
          "max": 6,
          "typical": 4,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "toy",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 5,
          "max": 25,
          "typical": 12,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "game",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 8,
          "max": 60,
          "typical": 25,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "puzzle",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 5,
          "max": 20,
          "typical": 12,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "sticker",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 0.2,
          "max": 2,
          "typical": 0.8,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "badge",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 0.5,
          "max": 3,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "poster",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 2,
          "max": 8,
          "typical": 4,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "card",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 0.5,
          "max": 4,
          "typical": 2,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      }
    ],
    "culturalElements": [
      {
        "type": "currency",
        "value": "£",
        "explanation": "British pounds"
      },
      {
        "type": "location",
        "value": "UK local shop",
        "explanation": "Typical British corner shop"
      }
    ],
    "realWorldConnection": "Everyday shopping with realistic UK prices",
    "yearAppropriate": [
      1,
      2,
      3,
      4,
      5,
      6
    ],
    "templates": [
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "MULTI_STEP"
        ],
        "modelCompatibility": [
          "ADDITION"
        ],
        "operandCount": 3,
        "template": "{character} buys {article1} {item1} for {price1}, {article2} {item2} for {price2}, and {article3} {item3} for {price3}. What is the total cost?",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item1",
            "type": "item"
          },
          {
            "key": "item2",
            "type": "item"
          },
          {
            "key": "item3",
            "type": "item"
          },
          {
            "key": "price1",
            "type": "value"
          },
          {
            "key": "price2",
            "type": "value"
          },
          {
            "key": "price3",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "MULTI_STEP"
        ],
        "modelCompatibility": [
          "ADDITION"
        ],
        "operandCount": 2,
        "template": "{character} buys {article1} {item1} for {price1} and {article2} {item2} for {price2}. What is the total cost?",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item1",
            "type": "item"
          },
          {
            "key": "item2",
            "type": "item"
          },
          {
            "key": "price1",
            "type": "value"
          },
          {
            "key": "price2",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION"
        ],
        "modelCompatibility": [
          "SUBTRACTION",
          "CHANGE_CALCULATION"
        ],
        "template": "{character} buys {article} {item} for {price} and pays with {payment}. How much change does {character} get?",
        "answerTemplate": "{character} receives {result} in change",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "price",
            "type": "value"
          },
          {
            "key": "payment",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION"
        ],
        "modelCompatibility": [
          "MULTIPLICATION"
        ],
        "template": "{character} buys {quantity} {item} at {price} each. What is the total cost?",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "quantity",
            "type": "value"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "price",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION"
        ],
        "modelCompatibility": [
          "DIVISION"
        ],
        "template": "{character} has {total} to spend equally on {quantity} {item}. How much can {character} spend on each one?",
        "answerTemplate": "{character} can spend {result} on each {item}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "total",
            "type": "value"
          },
          {
            "key": "quantity",
            "type": "value"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "COMPARISON",
          "ESTIMATION",
          "MULTI_STEP"
        ],
        "template": "{character} goes to the shop and buys {items}. How much does {character} spend in total?",
        "answerTemplate": "{character} spends {result} in total",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "items",
            "type": "item_list"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "ESTIMATION"
        ],
        "template": "Estimate: If {character} buys {items}, about how much will it cost?",
        "answerTemplate": "It will cost approximately {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "items",
            "type": "item_list"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "VALIDATION"
        ],
        "template": "{character} calculated that {items} costs {amount}. Is this correct?",
        "answerTemplate": "{validation_result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "items",
            "type": "item_list"
          },
          {
            "key": "amount",
            "type": "value"
          },
          {
            "key": "validation_result",
            "type": "boolean"
          }
        ]
      }
    ]
  }
}
# Test B.16: MONEY_COMBINATIONS model
{
  "success": true,
  "question": {
    "text": "Liam goes to the shop and buys apple, banana, sandwich, drink, cake, biscuit, sweet, chocolate, pen, pencil, ruler, notebook, eraser, book, comic, magazine, toy, game, puzzle, sticker, badge, poster, card. How much does Liam spend in total?",
    "options": [
      {
        "value": 0,
        "text": "0p",
        "isCorrect": true
      }
    ],
    "correctIndex": 0,
    "format": "DIRECT_CALCULATION",
    "difficulty": {
      "year": 4,
      "subLevel": 1,
      "displayName": "4.1",
      "cognitiveLoad": 40
    },
    "cognitiveLoad": 40,
    "curriculumTags": [
      "4N1a"
    ],
    "scenario": {
      "id": "shop-002-realistic-general",
      "theme": "SHOPPING",
      "setting": {
        "location": "local shop",
        "timeContext": "after school",
        "atmosphere": "friendly"
      },
      "characters": [
        {
          "name": "Liam",
          "role": "student"
        }
      ],
      "items": [
        {
          "name": "apple",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.2,
            "max": 0.5,
            "typical": 0.35,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "banana",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.15,
            "max": 0.4,
            "typical": 0.25,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "sandwich",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 2.5,
            "max": 6,
            "typical": 4,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "drink",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.8,
            "max": 2.5,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "cake",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 1.5,
            "max": 4,
            "typical": 2.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "biscuit",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.8,
            "max": 2,
            "typical": 1.2,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "sweet",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.1,
            "max": 1,
            "typical": 0.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "chocolate",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.6,
            "max": 3,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "pen",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.5,
            "max": 2,
            "typical": 1,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "pencil",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.2,
            "max": 1,
            "typical": 0.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "ruler",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.8,
            "max": 2.5,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "notebook",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 1,
            "max": 4,
            "typical": 2,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "eraser",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.3,
            "max": 1.5,
            "typical": 0.75,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "book",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 3,
            "max": 15,
            "typical": 8,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "comic",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 2,
            "max": 5,
            "typical": 3,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "magazine",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 2.5,
            "max": 6,
            "typical": 4,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "toy",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 5,
            "max": 25,
            "typical": 12,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "game",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 8,
            "max": 60,
            "typical": 25,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "puzzle",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 5,
            "max": 20,
            "typical": 12,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "sticker",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 0.2,
            "max": 2,
            "typical": 0.8,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "badge",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 0.5,
            "max": 3,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "poster",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 2,
            "max": 8,
            "typical": 4,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "card",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 0.5,
            "max": 4,
            "typical": 2,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        }
      ],
      "culturalElements": [
        {
          "type": "currency",
          "value": "£",
          "explanation": "British pounds"
        },
        {
          "type": "location",
          "value": "UK local shop",
          "explanation": "Typical British corner shop"
        }
      ],
      "realWorldConnection": "Everyday shopping with realistic UK prices",
      "yearAppropriate": [
        1,
        2,
        3,
        4,
        5,
        6
      ],
      "templates": [
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "MULTI_STEP"
          ],
          "modelCompatibility": [
            "ADDITION"
          ],
          "operandCount": 3,
          "template": "{character} buys {article1} {item1} for {price1}, {article2} {item2} for {price2}, and {article3} {item3} for {price3}. What is the total cost?",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item1",
              "type": "item"
            },
            {
              "key": "item2",
              "type": "item"
            },
            {
              "key": "item3",
              "type": "item"
            },
            {
              "key": "price1",
              "type": "value"
            },
            {
              "key": "price2",
              "type": "value"
            },
            {
              "key": "price3",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "MULTI_STEP"
          ],
          "modelCompatibility": [
            "ADDITION"
          ],
          "operandCount": 2,
          "template": "{character} buys {article1} {item1} for {price1} and {article2} {item2} for {price2}. What is the total cost?",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item1",
              "type": "item"
            },
            {
              "key": "item2",
              "type": "item"
            },
            {
              "key": "price1",
              "type": "value"
            },
            {
              "key": "price2",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION"
          ],
          "modelCompatibility": [
            "SUBTRACTION",
            "CHANGE_CALCULATION"
          ],
          "template": "{character} buys {article} {item} for {price} and pays with {payment}. How much change does {character} get?",
          "answerTemplate": "{character} receives {result} in change",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "price",
              "type": "value"
            },
            {
              "key": "payment",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION"
          ],
          "modelCompatibility": [
            "MULTIPLICATION"
          ],
          "template": "{character} buys {quantity} {item} at {price} each. What is the total cost?",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "quantity",
              "type": "value"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "price",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION"
          ],
          "modelCompatibility": [
            "DIVISION"
          ],
          "template": "{character} has {total} to spend equally on {quantity} {item}. How much can {character} spend on each one?",
          "answerTemplate": "{character} can spend {result} on each {item}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "total",
              "type": "value"
            },
            {
              "key": "quantity",
              "type": "value"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "COMPARISON",
            "ESTIMATION",
            "MULTI_STEP"
          ],
          "template": "{character} goes to the shop and buys {items}. How much does {character} spend in total?",
          "answerTemplate": "{character} spends {result} in total",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "items",
              "type": "item_list"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "ESTIMATION"
          ],
          "template": "Estimate: If {character} buys {items}, about how much will it cost?",
          "answerTemplate": "It will cost approximately {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "items",
              "type": "item_list"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "VALIDATION"
          ],
          "template": "{character} calculated that {items} costs {amount}. Is this correct?",
          "answerTemplate": "{validation_result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "items",
              "type": "item_list"
            },
            {
              "key": "amount",
              "type": "value"
            },
            {
              "key": "validation_result",
              "type": "boolean"
            }
          ]
        }
      ]
    },
    "distractors": [],
    "enhancementStatus": {
      "level": "partial",
      "requestedFormat": "DIRECT_CALCULATION",
      "actualFormat": "DIRECT_CALCULATION",
      "featuresActive": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "featuresPending": [],
      "isFullyEnhanced": true
    },
    "mathOutput": {
      "operation": "MONEY_COMBINATIONS",
      "target_amount": 384,
      "combination_count": 5
    },
    "generationTime": 7455,
    "questionId": "q_1759234384907_c27avlxqm",
    "generationSetup": {
      "controller_used": "DIRECT_CALCULATIONController",
      "format_requested": "DIRECT_CALCULATION",
      "format_actual": "DIRECT_CALCULATION",
      "scenario_theme": "SHOPPING",
      "scenario_id": "shop-002-realistic-general",
      "scenario_selection_method": "default",
      "distractor_strategies": [],
      "distractor_count": 0,
      "theme_variety": false,
      "format_variety": false,
      "enhancement_level": "partial",
      "features_active": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "features_pending": [],
      "generation_time_ms": 7455
    }
  },
  "metadata": {
    "format": "DIRECT_CALCULATION",
    "cognitive_load": 40,
    "curriculum_alignment": [
      "4N1a"
    ],
    "difficulty": "4.1",
    "scenario_theme": "SHOPPING",
    "distractor_strategies": [],
    "generation_time_ms": 7455,
    "api_version": "2.0",
    "enhancement_status": "partial",
    "format_requested": "DIRECT_CALCULATION",
    "format_used": "DIRECT_CALCULATION",
    "features_active": [
      "enhanced_distractors",
      "rich_scenarios",
      "cognitive_load",
      "advanced_formats"
    ],
    "features_pending": []
  },
  "context": {
    "id": "shop-002-realistic-general",
    "theme": "SHOPPING",
    "setting": {
      "location": "local shop",
      "timeContext": "after school",
      "atmosphere": "friendly"
    },
    "characters": [
      {
        "name": "Liam",
        "role": "student"
      }
    ],
    "items": [
      {
        "name": "apple",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.2,
          "max": 0.5,
          "typical": 0.35,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "banana",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.15,
          "max": 0.4,
          "typical": 0.25,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "sandwich",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 2.5,
          "max": 6,
          "typical": 4,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "drink",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.8,
          "max": 2.5,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "cake",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 1.5,
          "max": 4,
          "typical": 2.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "biscuit",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.8,
          "max": 2,
          "typical": 1.2,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "sweet",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.1,
          "max": 1,
          "typical": 0.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "chocolate",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.6,
          "max": 3,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "pen",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.5,
          "max": 2,
          "typical": 1,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "pencil",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.2,
          "max": 1,
          "typical": 0.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "ruler",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.8,
          "max": 2.5,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "notebook",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 1,
          "max": 4,
          "typical": 2,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "eraser",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.3,
          "max": 1.5,
          "typical": 0.75,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "book",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 3,
          "max": 15,
          "typical": 8,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "comic",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 2,
          "max": 5,
          "typical": 3,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "magazine",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 2.5,
          "max": 6,
          "typical": 4,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "toy",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 5,
          "max": 25,
          "typical": 12,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "game",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 8,
          "max": 60,
          "typical": 25,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "puzzle",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 5,
          "max": 20,
          "typical": 12,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "sticker",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 0.2,
          "max": 2,
          "typical": 0.8,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "badge",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 0.5,
          "max": 3,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "poster",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 2,
          "max": 8,
          "typical": 4,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "card",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 0.5,
          "max": 4,
          "typical": 2,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      }
    ],
    "culturalElements": [
      {
        "type": "currency",
        "value": "£",
        "explanation": "British pounds"
      },
      {
        "type": "location",
        "value": "UK local shop",
        "explanation": "Typical British corner shop"
      }
    ],
    "realWorldConnection": "Everyday shopping with realistic UK prices",
    "yearAppropriate": [
      1,
      2,
      3,
      4,
      5,
      6
    ],
    "templates": [
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "MULTI_STEP"
        ],
        "modelCompatibility": [
          "ADDITION"
        ],
        "operandCount": 3,
        "template": "{character} buys {article1} {item1} for {price1}, {article2} {item2} for {price2}, and {article3} {item3} for {price3}. What is the total cost?",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item1",
            "type": "item"
          },
          {
            "key": "item2",
            "type": "item"
          },
          {
            "key": "item3",
            "type": "item"
          },
          {
            "key": "price1",
            "type": "value"
          },
          {
            "key": "price2",
            "type": "value"
          },
          {
            "key": "price3",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "MULTI_STEP"
        ],
        "modelCompatibility": [
          "ADDITION"
        ],
        "operandCount": 2,
        "template": "{character} buys {article1} {item1} for {price1} and {article2} {item2} for {price2}. What is the total cost?",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item1",
            "type": "item"
          },
          {
            "key": "item2",
            "type": "item"
          },
          {
            "key": "price1",
            "type": "value"
          },
          {
            "key": "price2",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION"
        ],
        "modelCompatibility": [
          "SUBTRACTION",
          "CHANGE_CALCULATION"
        ],
        "template": "{character} buys {article} {item} for {price} and pays with {payment}. How much change does {character} get?",
        "answerTemplate": "{character} receives {result} in change",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "price",
            "type": "value"
          },
          {
            "key": "payment",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION"
        ],
        "modelCompatibility": [
          "MULTIPLICATION"
        ],
        "template": "{character} buys {quantity} {item} at {price} each. What is the total cost?",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "quantity",
            "type": "value"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "price",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION"
        ],
        "modelCompatibility": [
          "DIVISION"
        ],
        "template": "{character} has {total} to spend equally on {quantity} {item}. How much can {character} spend on each one?",
        "answerTemplate": "{character} can spend {result} on each {item}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "total",
            "type": "value"
          },
          {
            "key": "quantity",
            "type": "value"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "COMPARISON",
          "ESTIMATION",
          "MULTI_STEP"
        ],
        "template": "{character} goes to the shop and buys {items}. How much does {character} spend in total?",
        "answerTemplate": "{character} spends {result} in total",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "items",
            "type": "item_list"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "ESTIMATION"
        ],
        "template": "Estimate: If {character} buys {items}, about how much will it cost?",
        "answerTemplate": "It will cost approximately {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "items",
            "type": "item_list"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "VALIDATION"
        ],
        "template": "{character} calculated that {items} costs {amount}. Is this correct?",
        "answerTemplate": "{validation_result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "items",
            "type": "item_list"
          },
          {
            "key": "amount",
            "type": "value"
          },
          {
            "key": "validation_result",
            "type": "boolean"
          }
        ]
      }
    ]
  }
}
# Test B.17: MIXED_MONEY_UNITS model
{
  "success": true,
  "question": {
    "text": "Liam goes to the shop and buys apple, banana, sandwich, drink, cake, biscuit, sweet, chocolate, pen, pencil, ruler, notebook, eraser, book, comic, magazine, toy, game, puzzle, sticker, badge, poster, card. How much does Liam spend in total?",
    "options": [
      {
        "text": "7.51",
        "value": 7.51,
        "index": 0
      },
      {
        "text": "5.51",
        "value": 5.51,
        "index": 1
      },
      {
        "text": "£6.51",
        "value": 6.51,
        "index": 2
      },
      {
        "text": "3.255",
        "value": 3.26,
        "index": 3
      }
    ],
    "correctIndex": 2,
    "format": "DIRECT_CALCULATION",
    "difficulty": {
      "year": 4,
      "subLevel": 1,
      "displayName": "4.1",
      "cognitiveLoad": 40
    },
    "cognitiveLoad": 40,
    "curriculumTags": [
      "4N1a"
    ],
    "scenario": {
      "id": "shop-002-realistic-general",
      "theme": "SHOPPING",
      "setting": {
        "location": "local shop",
        "timeContext": "after school",
        "atmosphere": "friendly"
      },
      "characters": [
        {
          "name": "Liam",
          "role": "student"
        }
      ],
      "items": [
        {
          "name": "apple",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.2,
            "max": 0.5,
            "typical": 0.35,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "banana",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.15,
            "max": 0.4,
            "typical": 0.25,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "sandwich",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 2.5,
            "max": 6,
            "typical": 4,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "drink",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.8,
            "max": 2.5,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "cake",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 1.5,
            "max": 4,
            "typical": 2.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "biscuit",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.8,
            "max": 2,
            "typical": 1.2,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "sweet",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.1,
            "max": 1,
            "typical": 0.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "chocolate",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.6,
            "max": 3,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "pen",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.5,
            "max": 2,
            "typical": 1,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "pencil",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.2,
            "max": 1,
            "typical": 0.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "ruler",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.8,
            "max": 2.5,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "notebook",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 1,
            "max": 4,
            "typical": 2,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "eraser",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.3,
            "max": 1.5,
            "typical": 0.75,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "book",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 3,
            "max": 15,
            "typical": 8,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "comic",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 2,
            "max": 5,
            "typical": 3,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "magazine",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 2.5,
            "max": 6,
            "typical": 4,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "toy",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 5,
            "max": 25,
            "typical": 12,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "game",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 8,
            "max": 60,
            "typical": 25,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "puzzle",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 5,
            "max": 20,
            "typical": 12,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "sticker",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 0.2,
            "max": 2,
            "typical": 0.8,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "badge",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 0.5,
            "max": 3,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "poster",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 2,
            "max": 8,
            "typical": 4,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "card",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 0.5,
            "max": 4,
            "typical": 2,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        }
      ],
      "culturalElements": [
        {
          "type": "currency",
          "value": "£",
          "explanation": "British pounds"
        },
        {
          "type": "location",
          "value": "UK local shop",
          "explanation": "Typical British corner shop"
        }
      ],
      "realWorldConnection": "Everyday shopping with realistic UK prices",
      "yearAppropriate": [
        1,
        2,
        3,
        4,
        5,
        6
      ],
      "templates": [
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "MULTI_STEP"
          ],
          "modelCompatibility": [
            "ADDITION"
          ],
          "operandCount": 3,
          "template": "{character} buys {article1} {item1} for {price1}, {article2} {item2} for {price2}, and {article3} {item3} for {price3}. What is the total cost?",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item1",
              "type": "item"
            },
            {
              "key": "item2",
              "type": "item"
            },
            {
              "key": "item3",
              "type": "item"
            },
            {
              "key": "price1",
              "type": "value"
            },
            {
              "key": "price2",
              "type": "value"
            },
            {
              "key": "price3",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "MULTI_STEP"
          ],
          "modelCompatibility": [
            "ADDITION"
          ],
          "operandCount": 2,
          "template": "{character} buys {article1} {item1} for {price1} and {article2} {item2} for {price2}. What is the total cost?",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item1",
              "type": "item"
            },
            {
              "key": "item2",
              "type": "item"
            },
            {
              "key": "price1",
              "type": "value"
            },
            {
              "key": "price2",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION"
          ],
          "modelCompatibility": [
            "SUBTRACTION",
            "CHANGE_CALCULATION"
          ],
          "template": "{character} buys {article} {item} for {price} and pays with {payment}. How much change does {character} get?",
          "answerTemplate": "{character} receives {result} in change",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "price",
              "type": "value"
            },
            {
              "key": "payment",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION"
          ],
          "modelCompatibility": [
            "MULTIPLICATION"
          ],
          "template": "{character} buys {quantity} {item} at {price} each. What is the total cost?",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "quantity",
              "type": "value"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "price",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION"
          ],
          "modelCompatibility": [
            "DIVISION"
          ],
          "template": "{character} has {total} to spend equally on {quantity} {item}. How much can {character} spend on each one?",
          "answerTemplate": "{character} can spend {result} on each {item}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "total",
              "type": "value"
            },
            {
              "key": "quantity",
              "type": "value"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "COMPARISON",
            "ESTIMATION",
            "MULTI_STEP"
          ],
          "template": "{character} goes to the shop and buys {items}. How much does {character} spend in total?",
          "answerTemplate": "{character} spends {result} in total",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "items",
              "type": "item_list"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "ESTIMATION"
          ],
          "template": "Estimate: If {character} buys {items}, about how much will it cost?",
          "answerTemplate": "It will cost approximately {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "items",
              "type": "item_list"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "VALIDATION"
          ],
          "template": "{character} calculated that {items} costs {amount}. Is this correct?",
          "answerTemplate": "{validation_result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "items",
              "type": "item_list"
            },
            {
              "key": "amount",
              "type": "value"
            },
            {
              "key": "validation_result",
              "type": "boolean"
            }
          ]
        }
      ]
    },
    "distractors": [
      {
        "value": 7.51,
        "displayText": "7.51",
        "strategy": "CLOSE_VALUE",
        "reasoning": "Off by 1"
      },
      {
        "value": 5.51,
        "displayText": "5.51",
        "strategy": "CLOSE_VALUE",
        "reasoning": "Off by 1"
      },
      {
        "value": 3.26,
        "displayText": "3.255",
        "reasoning": "Half the correct value"
      }
    ],
    "enhancementStatus": {
      "level": "partial",
      "requestedFormat": "DIRECT_CALCULATION",
      "actualFormat": "DIRECT_CALCULATION",
      "featuresActive": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "featuresPending": [],
      "isFullyEnhanced": true
    },
    "mathOutput": {
      "operation": "MIXED_MONEY_UNITS",
      "result": 6.51
    },
    "generationTime": 0,
    "questionId": "q_1759234384958_0dpmoq06w",
    "generationSetup": {
      "controller_used": "DIRECT_CALCULATIONController",
      "format_requested": "DIRECT_CALCULATION",
      "format_actual": "DIRECT_CALCULATION",
      "scenario_theme": "SHOPPING",
      "scenario_id": "shop-002-realistic-general",
      "scenario_selection_method": "default",
      "distractor_strategies": [
        "CLOSE_VALUE",
        "CLOSE_VALUE",
        null
      ],
      "distractor_count": 3,
      "theme_variety": false,
      "format_variety": false,
      "enhancement_level": "partial",
      "features_active": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "features_pending": [],
      "generation_time_ms": 0
    }
  },
  "metadata": {
    "format": "DIRECT_CALCULATION",
    "cognitive_load": 40,
    "curriculum_alignment": [
      "4N1a"
    ],
    "difficulty": "4.1",
    "scenario_theme": "SHOPPING",
    "distractor_strategies": [
      "CLOSE_VALUE",
      "CLOSE_VALUE",
      null
    ],
    "generation_time_ms": 0,
    "api_version": "2.0",
    "enhancement_status": "partial",
    "format_requested": "DIRECT_CALCULATION",
    "format_used": "DIRECT_CALCULATION",
    "features_active": [
      "enhanced_distractors",
      "rich_scenarios",
      "cognitive_load",
      "advanced_formats"
    ],
    "features_pending": []
  },
  "context": {
    "id": "shop-002-realistic-general",
    "theme": "SHOPPING",
    "setting": {
      "location": "local shop",
      "timeContext": "after school",
      "atmosphere": "friendly"
    },
    "characters": [
      {
        "name": "Liam",
        "role": "student"
      }
    ],
    "items": [
      {
        "name": "apple",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.2,
          "max": 0.5,
          "typical": 0.35,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "banana",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.15,
          "max": 0.4,
          "typical": 0.25,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "sandwich",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 2.5,
          "max": 6,
          "typical": 4,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "drink",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.8,
          "max": 2.5,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "cake",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 1.5,
          "max": 4,
          "typical": 2.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "biscuit",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.8,
          "max": 2,
          "typical": 1.2,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "sweet",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.1,
          "max": 1,
          "typical": 0.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "chocolate",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.6,
          "max": 3,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "pen",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.5,
          "max": 2,
          "typical": 1,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "pencil",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.2,
          "max": 1,
          "typical": 0.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "ruler",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.8,
          "max": 2.5,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "notebook",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 1,
          "max": 4,
          "typical": 2,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "eraser",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.3,
          "max": 1.5,
          "typical": 0.75,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "book",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 3,
          "max": 15,
          "typical": 8,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "comic",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 2,
          "max": 5,
          "typical": 3,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "magazine",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 2.5,
          "max": 6,
          "typical": 4,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "toy",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 5,
          "max": 25,
          "typical": 12,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "game",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 8,
          "max": 60,
          "typical": 25,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "puzzle",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 5,
          "max": 20,
          "typical": 12,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "sticker",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 0.2,
          "max": 2,
          "typical": 0.8,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "badge",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 0.5,
          "max": 3,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "poster",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 2,
          "max": 8,
          "typical": 4,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "card",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 0.5,
          "max": 4,
          "typical": 2,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      }
    ],
    "culturalElements": [
      {
        "type": "currency",
        "value": "£",
        "explanation": "British pounds"
      },
      {
        "type": "location",
        "value": "UK local shop",
        "explanation": "Typical British corner shop"
      }
    ],
    "realWorldConnection": "Everyday shopping with realistic UK prices",
    "yearAppropriate": [
      1,
      2,
      3,
      4,
      5,
      6
    ],
    "templates": [
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "MULTI_STEP"
        ],
        "modelCompatibility": [
          "ADDITION"
        ],
        "operandCount": 3,
        "template": "{character} buys {article1} {item1} for {price1}, {article2} {item2} for {price2}, and {article3} {item3} for {price3}. What is the total cost?",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item1",
            "type": "item"
          },
          {
            "key": "item2",
            "type": "item"
          },
          {
            "key": "item3",
            "type": "item"
          },
          {
            "key": "price1",
            "type": "value"
          },
          {
            "key": "price2",
            "type": "value"
          },
          {
            "key": "price3",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "MULTI_STEP"
        ],
        "modelCompatibility": [
          "ADDITION"
        ],
        "operandCount": 2,
        "template": "{character} buys {article1} {item1} for {price1} and {article2} {item2} for {price2}. What is the total cost?",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item1",
            "type": "item"
          },
          {
            "key": "item2",
            "type": "item"
          },
          {
            "key": "price1",
            "type": "value"
          },
          {
            "key": "price2",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION"
        ],
        "modelCompatibility": [
          "SUBTRACTION",
          "CHANGE_CALCULATION"
        ],
        "template": "{character} buys {article} {item} for {price} and pays with {payment}. How much change does {character} get?",
        "answerTemplate": "{character} receives {result} in change",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "price",
            "type": "value"
          },
          {
            "key": "payment",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION"
        ],
        "modelCompatibility": [
          "MULTIPLICATION"
        ],
        "template": "{character} buys {quantity} {item} at {price} each. What is the total cost?",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "quantity",
            "type": "value"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "price",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION"
        ],
        "modelCompatibility": [
          "DIVISION"
        ],
        "template": "{character} has {total} to spend equally on {quantity} {item}. How much can {character} spend on each one?",
        "answerTemplate": "{character} can spend {result} on each {item}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "total",
            "type": "value"
          },
          {
            "key": "quantity",
            "type": "value"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "COMPARISON",
          "ESTIMATION",
          "MULTI_STEP"
        ],
        "template": "{character} goes to the shop and buys {items}. How much does {character} spend in total?",
        "answerTemplate": "{character} spends {result} in total",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "items",
            "type": "item_list"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "ESTIMATION"
        ],
        "template": "Estimate: If {character} buys {items}, about how much will it cost?",
        "answerTemplate": "It will cost approximately {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "items",
            "type": "item_list"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "VALIDATION"
        ],
        "template": "{character} calculated that {items} costs {amount}. Is this correct?",
        "answerTemplate": "{validation_result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "items",
            "type": "item_list"
          },
          {
            "key": "amount",
            "type": "value"
          },
          {
            "key": "validation_result",
            "type": "boolean"
          }
        ]
      }
    ]
  }
}
# Test B.18: MONEY_FRACTIONS model
{
  "success": true,
  "question": {
    "text": "Liam goes to the shop and buys apple, banana, sandwich, drink, cake, biscuit, sweet, chocolate, pen, pencil, ruler, notebook, eraser, book, comic, magazine, toy, game, puzzle, sticker, badge, poster, card. How much does Liam spend in total?",
    "options": [
      {
        "text": "£41.00",
        "value": 41,
        "index": 0
      },
      {
        "text": "42",
        "value": 42,
        "index": 1
      },
      {
        "text": "40",
        "value": 40,
        "index": 2
      },
      {
        "text": "20.5",
        "value": 20.5,
        "index": 3
      }
    ],
    "correctIndex": 0,
    "format": "DIRECT_CALCULATION",
    "difficulty": {
      "year": 4,
      "subLevel": 1,
      "displayName": "4.1",
      "cognitiveLoad": 40
    },
    "cognitiveLoad": 40,
    "curriculumTags": [
      "4N1a"
    ],
    "scenario": {
      "id": "shop-002-realistic-general",
      "theme": "SHOPPING",
      "setting": {
        "location": "local shop",
        "timeContext": "after school",
        "atmosphere": "friendly"
      },
      "characters": [
        {
          "name": "Liam",
          "role": "student"
        }
      ],
      "items": [
        {
          "name": "apple",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.2,
            "max": 0.5,
            "typical": 0.35,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "banana",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.15,
            "max": 0.4,
            "typical": 0.25,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "sandwich",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 2.5,
            "max": 6,
            "typical": 4,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "drink",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.8,
            "max": 2.5,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "cake",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 1.5,
            "max": 4,
            "typical": 2.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "biscuit",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.8,
            "max": 2,
            "typical": 1.2,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "sweet",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.1,
            "max": 1,
            "typical": 0.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "chocolate",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.6,
            "max": 3,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "pen",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.5,
            "max": 2,
            "typical": 1,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "pencil",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.2,
            "max": 1,
            "typical": 0.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "ruler",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.8,
            "max": 2.5,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "notebook",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 1,
            "max": 4,
            "typical": 2,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "eraser",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.3,
            "max": 1.5,
            "typical": 0.75,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "book",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 3,
            "max": 15,
            "typical": 8,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "comic",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 2,
            "max": 5,
            "typical": 3,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "magazine",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 2.5,
            "max": 6,
            "typical": 4,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "toy",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 5,
            "max": 25,
            "typical": 12,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "game",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 8,
            "max": 60,
            "typical": 25,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "puzzle",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 5,
            "max": 20,
            "typical": 12,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "sticker",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 0.2,
            "max": 2,
            "typical": 0.8,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "badge",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 0.5,
            "max": 3,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "poster",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 2,
            "max": 8,
            "typical": 4,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "card",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 0.5,
            "max": 4,
            "typical": 2,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        }
      ],
      "culturalElements": [
        {
          "type": "currency",
          "value": "£",
          "explanation": "British pounds"
        },
        {
          "type": "location",
          "value": "UK local shop",
          "explanation": "Typical British corner shop"
        }
      ],
      "realWorldConnection": "Everyday shopping with realistic UK prices",
      "yearAppropriate": [
        1,
        2,
        3,
        4,
        5,
        6
      ],
      "templates": [
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "MULTI_STEP"
          ],
          "modelCompatibility": [
            "ADDITION"
          ],
          "operandCount": 3,
          "template": "{character} buys {article1} {item1} for {price1}, {article2} {item2} for {price2}, and {article3} {item3} for {price3}. What is the total cost?",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item1",
              "type": "item"
            },
            {
              "key": "item2",
              "type": "item"
            },
            {
              "key": "item3",
              "type": "item"
            },
            {
              "key": "price1",
              "type": "value"
            },
            {
              "key": "price2",
              "type": "value"
            },
            {
              "key": "price3",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "MULTI_STEP"
          ],
          "modelCompatibility": [
            "ADDITION"
          ],
          "operandCount": 2,
          "template": "{character} buys {article1} {item1} for {price1} and {article2} {item2} for {price2}. What is the total cost?",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item1",
              "type": "item"
            },
            {
              "key": "item2",
              "type": "item"
            },
            {
              "key": "price1",
              "type": "value"
            },
            {
              "key": "price2",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION"
          ],
          "modelCompatibility": [
            "SUBTRACTION",
            "CHANGE_CALCULATION"
          ],
          "template": "{character} buys {article} {item} for {price} and pays with {payment}. How much change does {character} get?",
          "answerTemplate": "{character} receives {result} in change",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "price",
              "type": "value"
            },
            {
              "key": "payment",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION"
          ],
          "modelCompatibility": [
            "MULTIPLICATION"
          ],
          "template": "{character} buys {quantity} {item} at {price} each. What is the total cost?",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "quantity",
              "type": "value"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "price",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION"
          ],
          "modelCompatibility": [
            "DIVISION"
          ],
          "template": "{character} has {total} to spend equally on {quantity} {item}. How much can {character} spend on each one?",
          "answerTemplate": "{character} can spend {result} on each {item}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "total",
              "type": "value"
            },
            {
              "key": "quantity",
              "type": "value"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "COMPARISON",
            "ESTIMATION",
            "MULTI_STEP"
          ],
          "template": "{character} goes to the shop and buys {items}. How much does {character} spend in total?",
          "answerTemplate": "{character} spends {result} in total",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "items",
              "type": "item_list"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "ESTIMATION"
          ],
          "template": "Estimate: If {character} buys {items}, about how much will it cost?",
          "answerTemplate": "It will cost approximately {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "items",
              "type": "item_list"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "VALIDATION"
          ],
          "template": "{character} calculated that {items} costs {amount}. Is this correct?",
          "answerTemplate": "{validation_result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "items",
              "type": "item_list"
            },
            {
              "key": "amount",
              "type": "value"
            },
            {
              "key": "validation_result",
              "type": "boolean"
            }
          ]
        }
      ]
    },
    "distractors": [
      {
        "value": 42,
        "strategy": "CLOSE_VALUE",
        "displayText": "42",
        "reasoning": "Off by one"
      },
      {
        "value": 40,
        "strategy": "CLOSE_VALUE",
        "displayText": "40",
        "reasoning": "Off by one (lower)"
      },
      {
        "value": 20.5,
        "displayText": "20.5",
        "reasoning": "Half the correct value"
      }
    ],
    "enhancementStatus": {
      "level": "partial",
      "requestedFormat": "DIRECT_CALCULATION",
      "actualFormat": "DIRECT_CALCULATION",
      "featuresActive": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "featuresPending": [],
      "isFullyEnhanced": true
    },
    "mathOutput": {
      "operation": "MONEY_FRACTIONS",
      "result": 41
    },
    "generationTime": 0,
    "questionId": "q_1759234385007_r49kos0eh",
    "generationSetup": {
      "controller_used": "DIRECT_CALCULATIONController",
      "format_requested": "DIRECT_CALCULATION",
      "format_actual": "DIRECT_CALCULATION",
      "scenario_theme": "SHOPPING",
      "scenario_id": "shop-002-realistic-general",
      "scenario_selection_method": "default",
      "distractor_strategies": [
        "CLOSE_VALUE",
        "CLOSE_VALUE",
        null
      ],
      "distractor_count": 3,
      "theme_variety": false,
      "format_variety": false,
      "enhancement_level": "partial",
      "features_active": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "features_pending": [],
      "generation_time_ms": 0
    }
  },
  "metadata": {
    "format": "DIRECT_CALCULATION",
    "cognitive_load": 40,
    "curriculum_alignment": [
      "4N1a"
    ],
    "difficulty": "4.1",
    "scenario_theme": "SHOPPING",
    "distractor_strategies": [
      "CLOSE_VALUE",
      "CLOSE_VALUE",
      null
    ],
    "generation_time_ms": 0,
    "api_version": "2.0",
    "enhancement_status": "partial",
    "format_requested": "DIRECT_CALCULATION",
    "format_used": "DIRECT_CALCULATION",
    "features_active": [
      "enhanced_distractors",
      "rich_scenarios",
      "cognitive_load",
      "advanced_formats"
    ],
    "features_pending": []
  },
  "context": {
    "id": "shop-002-realistic-general",
    "theme": "SHOPPING",
    "setting": {
      "location": "local shop",
      "timeContext": "after school",
      "atmosphere": "friendly"
    },
    "characters": [
      {
        "name": "Liam",
        "role": "student"
      }
    ],
    "items": [
      {
        "name": "apple",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.2,
          "max": 0.5,
          "typical": 0.35,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "banana",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.15,
          "max": 0.4,
          "typical": 0.25,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "sandwich",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 2.5,
          "max": 6,
          "typical": 4,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "drink",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.8,
          "max": 2.5,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "cake",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 1.5,
          "max": 4,
          "typical": 2.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "biscuit",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.8,
          "max": 2,
          "typical": 1.2,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "sweet",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.1,
          "max": 1,
          "typical": 0.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "chocolate",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.6,
          "max": 3,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "pen",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.5,
          "max": 2,
          "typical": 1,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "pencil",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.2,
          "max": 1,
          "typical": 0.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "ruler",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.8,
          "max": 2.5,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "notebook",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 1,
          "max": 4,
          "typical": 2,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "eraser",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.3,
          "max": 1.5,
          "typical": 0.75,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "book",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 3,
          "max": 15,
          "typical": 8,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "comic",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 2,
          "max": 5,
          "typical": 3,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "magazine",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 2.5,
          "max": 6,
          "typical": 4,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "toy",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 5,
          "max": 25,
          "typical": 12,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "game",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 8,
          "max": 60,
          "typical": 25,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "puzzle",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 5,
          "max": 20,
          "typical": 12,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "sticker",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 0.2,
          "max": 2,
          "typical": 0.8,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "badge",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 0.5,
          "max": 3,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "poster",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 2,
          "max": 8,
          "typical": 4,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "card",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 0.5,
          "max": 4,
          "typical": 2,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      }
    ],
    "culturalElements": [
      {
        "type": "currency",
        "value": "£",
        "explanation": "British pounds"
      },
      {
        "type": "location",
        "value": "UK local shop",
        "explanation": "Typical British corner shop"
      }
    ],
    "realWorldConnection": "Everyday shopping with realistic UK prices",
    "yearAppropriate": [
      1,
      2,
      3,
      4,
      5,
      6
    ],
    "templates": [
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "MULTI_STEP"
        ],
        "modelCompatibility": [
          "ADDITION"
        ],
        "operandCount": 3,
        "template": "{character} buys {article1} {item1} for {price1}, {article2} {item2} for {price2}, and {article3} {item3} for {price3}. What is the total cost?",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item1",
            "type": "item"
          },
          {
            "key": "item2",
            "type": "item"
          },
          {
            "key": "item3",
            "type": "item"
          },
          {
            "key": "price1",
            "type": "value"
          },
          {
            "key": "price2",
            "type": "value"
          },
          {
            "key": "price3",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "MULTI_STEP"
        ],
        "modelCompatibility": [
          "ADDITION"
        ],
        "operandCount": 2,
        "template": "{character} buys {article1} {item1} for {price1} and {article2} {item2} for {price2}. What is the total cost?",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item1",
            "type": "item"
          },
          {
            "key": "item2",
            "type": "item"
          },
          {
            "key": "price1",
            "type": "value"
          },
          {
            "key": "price2",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION"
        ],
        "modelCompatibility": [
          "SUBTRACTION",
          "CHANGE_CALCULATION"
        ],
        "template": "{character} buys {article} {item} for {price} and pays with {payment}. How much change does {character} get?",
        "answerTemplate": "{character} receives {result} in change",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "price",
            "type": "value"
          },
          {
            "key": "payment",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION"
        ],
        "modelCompatibility": [
          "MULTIPLICATION"
        ],
        "template": "{character} buys {quantity} {item} at {price} each. What is the total cost?",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "quantity",
            "type": "value"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "price",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION"
        ],
        "modelCompatibility": [
          "DIVISION"
        ],
        "template": "{character} has {total} to spend equally on {quantity} {item}. How much can {character} spend on each one?",
        "answerTemplate": "{character} can spend {result} on each {item}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "total",
            "type": "value"
          },
          {
            "key": "quantity",
            "type": "value"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "COMPARISON",
          "ESTIMATION",
          "MULTI_STEP"
        ],
        "template": "{character} goes to the shop and buys {items}. How much does {character} spend in total?",
        "answerTemplate": "{character} spends {result} in total",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "items",
            "type": "item_list"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "ESTIMATION"
        ],
        "template": "Estimate: If {character} buys {items}, about how much will it cost?",
        "answerTemplate": "It will cost approximately {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "items",
            "type": "item_list"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "VALIDATION"
        ],
        "template": "{character} calculated that {items} costs {amount}. Is this correct?",
        "answerTemplate": "{validation_result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "items",
            "type": "item_list"
          },
          {
            "key": "amount",
            "type": "value"
          },
          {
            "key": "validation_result",
            "type": "boolean"
          }
        ]
      }
    ]
  }
}
# Test B.19: MONEY_SCALING model
{
  "success": true,
  "question": {
    "text": "Liam goes to the shop and buys apple, banana, sandwich, drink, cake, biscuit, sweet, chocolate, pen, pencil, ruler, notebook, eraser, book, comic, magazine, toy, game, puzzle, sticker, badge, poster, card. How much does Liam spend in total?",
    "options": [
      {
        "value": 0,
        "text": "0p",
        "isCorrect": true
      }
    ],
    "correctIndex": 0,
    "format": "DIRECT_CALCULATION",
    "difficulty": {
      "year": 4,
      "subLevel": 1,
      "displayName": "4.1",
      "cognitiveLoad": 40
    },
    "cognitiveLoad": 40,
    "curriculumTags": [
      "4N1a"
    ],
    "scenario": {
      "id": "shop-002-realistic-general",
      "theme": "SHOPPING",
      "setting": {
        "location": "local shop",
        "timeContext": "after school",
        "atmosphere": "friendly"
      },
      "characters": [
        {
          "name": "Liam",
          "role": "student"
        }
      ],
      "items": [
        {
          "name": "apple",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.2,
            "max": 0.5,
            "typical": 0.35,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "banana",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.15,
            "max": 0.4,
            "typical": 0.25,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "sandwich",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 2.5,
            "max": 6,
            "typical": 4,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "drink",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.8,
            "max": 2.5,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "cake",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 1.5,
            "max": 4,
            "typical": 2.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "biscuit",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.8,
            "max": 2,
            "typical": 1.2,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "sweet",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.1,
            "max": 1,
            "typical": 0.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "chocolate",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.6,
            "max": 3,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "pen",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.5,
            "max": 2,
            "typical": 1,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "pencil",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.2,
            "max": 1,
            "typical": 0.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "ruler",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.8,
            "max": 2.5,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "notebook",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 1,
            "max": 4,
            "typical": 2,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "eraser",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.3,
            "max": 1.5,
            "typical": 0.75,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "book",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 3,
            "max": 15,
            "typical": 8,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "comic",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 2,
            "max": 5,
            "typical": 3,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "magazine",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 2.5,
            "max": 6,
            "typical": 4,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "toy",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 5,
            "max": 25,
            "typical": 12,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "game",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 8,
            "max": 60,
            "typical": 25,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "puzzle",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 5,
            "max": 20,
            "typical": 12,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "sticker",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 0.2,
            "max": 2,
            "typical": 0.8,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "badge",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 0.5,
            "max": 3,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "poster",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 2,
            "max": 8,
            "typical": 4,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "card",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 0.5,
            "max": 4,
            "typical": 2,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        }
      ],
      "culturalElements": [
        {
          "type": "currency",
          "value": "£",
          "explanation": "British pounds"
        },
        {
          "type": "location",
          "value": "UK local shop",
          "explanation": "Typical British corner shop"
        }
      ],
      "realWorldConnection": "Everyday shopping with realistic UK prices",
      "yearAppropriate": [
        1,
        2,
        3,
        4,
        5,
        6
      ],
      "templates": [
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "MULTI_STEP"
          ],
          "modelCompatibility": [
            "ADDITION"
          ],
          "operandCount": 3,
          "template": "{character} buys {article1} {item1} for {price1}, {article2} {item2} for {price2}, and {article3} {item3} for {price3}. What is the total cost?",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item1",
              "type": "item"
            },
            {
              "key": "item2",
              "type": "item"
            },
            {
              "key": "item3",
              "type": "item"
            },
            {
              "key": "price1",
              "type": "value"
            },
            {
              "key": "price2",
              "type": "value"
            },
            {
              "key": "price3",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "MULTI_STEP"
          ],
          "modelCompatibility": [
            "ADDITION"
          ],
          "operandCount": 2,
          "template": "{character} buys {article1} {item1} for {price1} and {article2} {item2} for {price2}. What is the total cost?",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item1",
              "type": "item"
            },
            {
              "key": "item2",
              "type": "item"
            },
            {
              "key": "price1",
              "type": "value"
            },
            {
              "key": "price2",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION"
          ],
          "modelCompatibility": [
            "SUBTRACTION",
            "CHANGE_CALCULATION"
          ],
          "template": "{character} buys {article} {item} for {price} and pays with {payment}. How much change does {character} get?",
          "answerTemplate": "{character} receives {result} in change",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "price",
              "type": "value"
            },
            {
              "key": "payment",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION"
          ],
          "modelCompatibility": [
            "MULTIPLICATION"
          ],
          "template": "{character} buys {quantity} {item} at {price} each. What is the total cost?",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "quantity",
              "type": "value"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "price",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION"
          ],
          "modelCompatibility": [
            "DIVISION"
          ],
          "template": "{character} has {total} to spend equally on {quantity} {item}. How much can {character} spend on each one?",
          "answerTemplate": "{character} can spend {result} on each {item}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "total",
              "type": "value"
            },
            {
              "key": "quantity",
              "type": "value"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "COMPARISON",
            "ESTIMATION",
            "MULTI_STEP"
          ],
          "template": "{character} goes to the shop and buys {items}. How much does {character} spend in total?",
          "answerTemplate": "{character} spends {result} in total",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "items",
              "type": "item_list"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "ESTIMATION"
          ],
          "template": "Estimate: If {character} buys {items}, about how much will it cost?",
          "answerTemplate": "It will cost approximately {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "items",
              "type": "item_list"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "VALIDATION"
          ],
          "template": "{character} calculated that {items} costs {amount}. Is this correct?",
          "answerTemplate": "{validation_result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "items",
              "type": "item_list"
            },
            {
              "key": "amount",
              "type": "value"
            },
            {
              "key": "validation_result",
              "type": "boolean"
            }
          ]
        }
      ]
    },
    "distractors": [],
    "enhancementStatus": {
      "level": "partial",
      "requestedFormat": "DIRECT_CALCULATION",
      "actualFormat": "DIRECT_CALCULATION",
      "featuresActive": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "featuresPending": [],
      "isFullyEnhanced": true
    },
    "mathOutput": {
      "operation": "MONEY_SCALING",
      "base_amount": 75
    },
    "generationTime": 1,
    "questionId": "q_1759234385054_jr1x6770l",
    "generationSetup": {
      "controller_used": "DIRECT_CALCULATIONController",
      "format_requested": "DIRECT_CALCULATION",
      "format_actual": "DIRECT_CALCULATION",
      "scenario_theme": "SHOPPING",
      "scenario_id": "shop-002-realistic-general",
      "scenario_selection_method": "default",
      "distractor_strategies": [],
      "distractor_count": 0,
      "theme_variety": false,
      "format_variety": false,
      "enhancement_level": "partial",
      "features_active": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "features_pending": [],
      "generation_time_ms": 1
    }
  },
  "metadata": {
    "format": "DIRECT_CALCULATION",
    "cognitive_load": 40,
    "curriculum_alignment": [
      "4N1a"
    ],
    "difficulty": "4.1",
    "scenario_theme": "SHOPPING",
    "distractor_strategies": [],
    "generation_time_ms": 1,
    "api_version": "2.0",
    "enhancement_status": "partial",
    "format_requested": "DIRECT_CALCULATION",
    "format_used": "DIRECT_CALCULATION",
    "features_active": [
      "enhanced_distractors",
      "rich_scenarios",
      "cognitive_load",
      "advanced_formats"
    ],
    "features_pending": []
  },
  "context": {
    "id": "shop-002-realistic-general",
    "theme": "SHOPPING",
    "setting": {
      "location": "local shop",
      "timeContext": "after school",
      "atmosphere": "friendly"
    },
    "characters": [
      {
        "name": "Liam",
        "role": "student"
      }
    ],
    "items": [
      {
        "name": "apple",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.2,
          "max": 0.5,
          "typical": 0.35,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "banana",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.15,
          "max": 0.4,
          "typical": 0.25,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "sandwich",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 2.5,
          "max": 6,
          "typical": 4,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "drink",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.8,
          "max": 2.5,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "cake",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 1.5,
          "max": 4,
          "typical": 2.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "biscuit",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.8,
          "max": 2,
          "typical": 1.2,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "sweet",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.1,
          "max": 1,
          "typical": 0.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "chocolate",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.6,
          "max": 3,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "pen",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.5,
          "max": 2,
          "typical": 1,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "pencil",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.2,
          "max": 1,
          "typical": 0.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "ruler",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.8,
          "max": 2.5,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "notebook",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 1,
          "max": 4,
          "typical": 2,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "eraser",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.3,
          "max": 1.5,
          "typical": 0.75,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "book",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 3,
          "max": 15,
          "typical": 8,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "comic",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 2,
          "max": 5,
          "typical": 3,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "magazine",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 2.5,
          "max": 6,
          "typical": 4,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "toy",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 5,
          "max": 25,
          "typical": 12,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "game",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 8,
          "max": 60,
          "typical": 25,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "puzzle",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 5,
          "max": 20,
          "typical": 12,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "sticker",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 0.2,
          "max": 2,
          "typical": 0.8,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "badge",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 0.5,
          "max": 3,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "poster",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 2,
          "max": 8,
          "typical": 4,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "card",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 0.5,
          "max": 4,
          "typical": 2,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      }
    ],
    "culturalElements": [
      {
        "type": "currency",
        "value": "£",
        "explanation": "British pounds"
      },
      {
        "type": "location",
        "value": "UK local shop",
        "explanation": "Typical British corner shop"
      }
    ],
    "realWorldConnection": "Everyday shopping with realistic UK prices",
    "yearAppropriate": [
      1,
      2,
      3,
      4,
      5,
      6
    ],
    "templates": [
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "MULTI_STEP"
        ],
        "modelCompatibility": [
          "ADDITION"
        ],
        "operandCount": 3,
        "template": "{character} buys {article1} {item1} for {price1}, {article2} {item2} for {price2}, and {article3} {item3} for {price3}. What is the total cost?",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item1",
            "type": "item"
          },
          {
            "key": "item2",
            "type": "item"
          },
          {
            "key": "item3",
            "type": "item"
          },
          {
            "key": "price1",
            "type": "value"
          },
          {
            "key": "price2",
            "type": "value"
          },
          {
            "key": "price3",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "MULTI_STEP"
        ],
        "modelCompatibility": [
          "ADDITION"
        ],
        "operandCount": 2,
        "template": "{character} buys {article1} {item1} for {price1} and {article2} {item2} for {price2}. What is the total cost?",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item1",
            "type": "item"
          },
          {
            "key": "item2",
            "type": "item"
          },
          {
            "key": "price1",
            "type": "value"
          },
          {
            "key": "price2",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION"
        ],
        "modelCompatibility": [
          "SUBTRACTION",
          "CHANGE_CALCULATION"
        ],
        "template": "{character} buys {article} {item} for {price} and pays with {payment}. How much change does {character} get?",
        "answerTemplate": "{character} receives {result} in change",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "price",
            "type": "value"
          },
          {
            "key": "payment",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION"
        ],
        "modelCompatibility": [
          "MULTIPLICATION"
        ],
        "template": "{character} buys {quantity} {item} at {price} each. What is the total cost?",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "quantity",
            "type": "value"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "price",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION"
        ],
        "modelCompatibility": [
          "DIVISION"
        ],
        "template": "{character} has {total} to spend equally on {quantity} {item}. How much can {character} spend on each one?",
        "answerTemplate": "{character} can spend {result} on each {item}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "total",
            "type": "value"
          },
          {
            "key": "quantity",
            "type": "value"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "COMPARISON",
          "ESTIMATION",
          "MULTI_STEP"
        ],
        "template": "{character} goes to the shop and buys {items}. How much does {character} spend in total?",
        "answerTemplate": "{character} spends {result} in total",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "items",
            "type": "item_list"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "ESTIMATION"
        ],
        "template": "Estimate: If {character} buys {items}, about how much will it cost?",
        "answerTemplate": "It will cost approximately {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "items",
            "type": "item_list"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "VALIDATION"
        ],
        "template": "{character} calculated that {items} costs {amount}. Is this correct?",
        "answerTemplate": "{validation_result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "items",
            "type": "item_list"
          },
          {
            "key": "amount",
            "type": "value"
          },
          {
            "key": "validation_result",
            "type": "boolean"
          }
        ]
      }
    ]
  }
}
# Test B.20: SHAPE_RECOGNITION model
{
  "success": true,
  "question": {
    "text": "Elijah buys an item for £5. How much does it cost?",
    "options": [
      {
        "value": 0,
        "text": "0p",
        "isCorrect": true
      }
    ],
    "correctIndex": 0,
    "format": "DIRECT_CALCULATION",
    "difficulty": {
      "year": 4,
      "subLevel": 1,
      "displayName": "4.1",
      "cognitiveLoad": 40
    },
    "cognitiveLoad": 40,
    "curriculumTags": [
      "4N1a"
    ],
    "scenario": {
      "id": "default-4-1759234385102",
      "theme": "SHOPPING",
      "setting": {
        "location": "shop",
        "timeContext": "afternoon",
        "atmosphere": "friendly"
      },
      "characters": [
        {
          "name": "Elijah",
          "role": "student"
        }
      ],
      "items": [
        {
          "name": "item",
          "category": "HOUSEHOLD_ITEMS",
          "typicalValue": {
            "min": 1,
            "max": 10,
            "typical": 5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        }
      ],
      "culturalElements": [
        {
          "type": "currency",
          "value": "£",
          "explanation": "British pounds"
        }
      ],
      "realWorldConnection": "Basic shopping calculations",
      "yearAppropriate": [
        4
      ],
      "templates": [
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION"
          ],
          "template": "{character} buys {article} {item} for {price}. How much does it cost?",
          "answerTemplate": "It costs {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "price",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        }
      ]
    },
    "distractors": [],
    "enhancementStatus": {
      "level": "partial",
      "requestedFormat": "DIRECT_CALCULATION",
      "actualFormat": "DIRECT_CALCULATION",
      "featuresActive": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "featuresPending": [],
      "isFullyEnhanced": true
    },
    "mathOutput": {
      "operation": "SHAPE_RECOGNITION"
    },
    "generationTime": 1,
    "questionId": "q_1759234385102_cszq3joa0",
    "generationSetup": {
      "controller_used": "DIRECT_CALCULATIONController",
      "format_requested": "DIRECT_CALCULATION",
      "format_actual": "DIRECT_CALCULATION",
      "scenario_theme": "SHOPPING",
      "scenario_id": "default-4-1759234385102",
      "scenario_selection_method": "default",
      "distractor_strategies": [],
      "distractor_count": 0,
      "theme_variety": false,
      "format_variety": false,
      "enhancement_level": "partial",
      "features_active": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "features_pending": [],
      "generation_time_ms": 1
    }
  },
  "metadata": {
    "format": "DIRECT_CALCULATION",
    "cognitive_load": 40,
    "curriculum_alignment": [
      "4N1a"
    ],
    "difficulty": "4.1",
    "scenario_theme": "SHOPPING",
    "distractor_strategies": [],
    "generation_time_ms": 1,
    "api_version": "2.0",
    "enhancement_status": "partial",
    "format_requested": "DIRECT_CALCULATION",
    "format_used": "DIRECT_CALCULATION",
    "features_active": [
      "enhanced_distractors",
      "rich_scenarios",
      "cognitive_load",
      "advanced_formats"
    ],
    "features_pending": []
  },
  "context": {
    "id": "default-4-1759234385102",
    "theme": "SHOPPING",
    "setting": {
      "location": "shop",
      "timeContext": "afternoon",
      "atmosphere": "friendly"
    },
    "characters": [
      {
        "name": "Elijah",
        "role": "student"
      }
    ],
    "items": [
      {
        "name": "item",
        "category": "HOUSEHOLD_ITEMS",
        "typicalValue": {
          "min": 1,
          "max": 10,
          "typical": 5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      }
    ],
    "culturalElements": [
      {
        "type": "currency",
        "value": "£",
        "explanation": "British pounds"
      }
    ],
    "realWorldConnection": "Basic shopping calculations",
    "yearAppropriate": [
      4
    ],
    "templates": [
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION"
        ],
        "template": "{character} buys {article} {item} for {price}. How much does it cost?",
        "answerTemplate": "It costs {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "price",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      }
    ]
  }
}
# Test B.21: SHAPE_PROPERTIES model
{
  "success": true,
  "question": {
    "text": "Ava buys an item for £5. How much does it cost?",
    "options": [
      {
        "value": 0,
        "text": "0p",
        "isCorrect": true
      }
    ],
    "correctIndex": 0,
    "format": "DIRECT_CALCULATION",
    "difficulty": {
      "year": 4,
      "subLevel": 1,
      "displayName": "4.1",
      "cognitiveLoad": 40
    },
    "cognitiveLoad": 40,
    "curriculumTags": [
      "4N1a"
    ],
    "scenario": {
      "id": "default-4-1759234385149",
      "theme": "SHOPPING",
      "setting": {
        "location": "shop",
        "timeContext": "afternoon",
        "atmosphere": "friendly"
      },
      "characters": [
        {
          "name": "Ava",
          "role": "student"
        }
      ],
      "items": [
        {
          "name": "item",
          "category": "HOUSEHOLD_ITEMS",
          "typicalValue": {
            "min": 1,
            "max": 10,
            "typical": 5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        }
      ],
      "culturalElements": [
        {
          "type": "currency",
          "value": "£",
          "explanation": "British pounds"
        }
      ],
      "realWorldConnection": "Basic shopping calculations",
      "yearAppropriate": [
        4
      ],
      "templates": [
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION"
          ],
          "template": "{character} buys {article} {item} for {price}. How much does it cost?",
          "answerTemplate": "It costs {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "price",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        }
      ]
    },
    "distractors": [],
    "enhancementStatus": {
      "level": "partial",
      "requestedFormat": "DIRECT_CALCULATION",
      "actualFormat": "DIRECT_CALCULATION",
      "featuresActive": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "featuresPending": [],
      "isFullyEnhanced": true
    },
    "mathOutput": {
      "operation": "SHAPE_PROPERTIES"
    },
    "generationTime": 1,
    "questionId": "q_1759234385149_hihs9z1uc",
    "generationSetup": {
      "controller_used": "DIRECT_CALCULATIONController",
      "format_requested": "DIRECT_CALCULATION",
      "format_actual": "DIRECT_CALCULATION",
      "scenario_theme": "SHOPPING",
      "scenario_id": "default-4-1759234385149",
      "scenario_selection_method": "default",
      "distractor_strategies": [],
      "distractor_count": 0,
      "theme_variety": false,
      "format_variety": false,
      "enhancement_level": "partial",
      "features_active": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "features_pending": [],
      "generation_time_ms": 1
    }
  },
  "metadata": {
    "format": "DIRECT_CALCULATION",
    "cognitive_load": 40,
    "curriculum_alignment": [
      "4N1a"
    ],
    "difficulty": "4.1",
    "scenario_theme": "SHOPPING",
    "distractor_strategies": [],
    "generation_time_ms": 1,
    "api_version": "2.0",
    "enhancement_status": "partial",
    "format_requested": "DIRECT_CALCULATION",
    "format_used": "DIRECT_CALCULATION",
    "features_active": [
      "enhanced_distractors",
      "rich_scenarios",
      "cognitive_load",
      "advanced_formats"
    ],
    "features_pending": []
  },
  "context": {
    "id": "default-4-1759234385149",
    "theme": "SHOPPING",
    "setting": {
      "location": "shop",
      "timeContext": "afternoon",
      "atmosphere": "friendly"
    },
    "characters": [
      {
        "name": "Ava",
        "role": "student"
      }
    ],
    "items": [
      {
        "name": "item",
        "category": "HOUSEHOLD_ITEMS",
        "typicalValue": {
          "min": 1,
          "max": 10,
          "typical": 5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      }
    ],
    "culturalElements": [
      {
        "type": "currency",
        "value": "£",
        "explanation": "British pounds"
      }
    ],
    "realWorldConnection": "Basic shopping calculations",
    "yearAppropriate": [
      4
    ],
    "templates": [
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION"
        ],
        "template": "{character} buys {article} {item} for {price}. How much does it cost?",
        "answerTemplate": "It costs {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "price",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      }
    ]
  }
}
# Test B.22: ANGLE_MEASUREMENT model
{
  "success": true,
  "question": {
    "text": "Elizabeth buys an item for £5. How much does it cost?",
    "options": [
      {
        "value": 0,
        "text": "0p",
        "isCorrect": true
      }
    ],
    "correctIndex": 0,
    "format": "DIRECT_CALCULATION",
    "difficulty": {
      "year": 4,
      "subLevel": 1,
      "displayName": "4.1",
      "cognitiveLoad": 40
    },
    "cognitiveLoad": 40,
    "curriculumTags": [
      "4N1a"
    ],
    "scenario": {
      "id": "default-4-1759234385193",
      "theme": "SHOPPING",
      "setting": {
        "location": "shop",
        "timeContext": "afternoon",
        "atmosphere": "friendly"
      },
      "characters": [
        {
          "name": "Elizabeth",
          "role": "student"
        }
      ],
      "items": [
        {
          "name": "item",
          "category": "HOUSEHOLD_ITEMS",
          "typicalValue": {
            "min": 1,
            "max": 10,
            "typical": 5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        }
      ],
      "culturalElements": [
        {
          "type": "currency",
          "value": "£",
          "explanation": "British pounds"
        }
      ],
      "realWorldConnection": "Basic shopping calculations",
      "yearAppropriate": [
        4
      ],
      "templates": [
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION"
          ],
          "template": "{character} buys {article} {item} for {price}. How much does it cost?",
          "answerTemplate": "It costs {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "price",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        }
      ]
    },
    "distractors": [],
    "enhancementStatus": {
      "level": "partial",
      "requestedFormat": "DIRECT_CALCULATION",
      "actualFormat": "DIRECT_CALCULATION",
      "featuresActive": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "featuresPending": [],
      "isFullyEnhanced": true
    },
    "mathOutput": {
      "operation": "ANGLE_MEASUREMENT",
      "angle_degrees": 150,
      "angle_type": "obtuse"
    },
    "generationTime": 1,
    "questionId": "q_1759234385194_ewb88okjn",
    "generationSetup": {
      "controller_used": "DIRECT_CALCULATIONController",
      "format_requested": "DIRECT_CALCULATION",
      "format_actual": "DIRECT_CALCULATION",
      "scenario_theme": "SHOPPING",
      "scenario_id": "default-4-1759234385193",
      "scenario_selection_method": "default",
      "distractor_strategies": [],
      "distractor_count": 0,
      "theme_variety": false,
      "format_variety": false,
      "enhancement_level": "partial",
      "features_active": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "features_pending": [],
      "generation_time_ms": 1
    }
  },
  "metadata": {
    "format": "DIRECT_CALCULATION",
    "cognitive_load": 40,
    "curriculum_alignment": [
      "4N1a"
    ],
    "difficulty": "4.1",
    "scenario_theme": "SHOPPING",
    "distractor_strategies": [],
    "generation_time_ms": 1,
    "api_version": "2.0",
    "enhancement_status": "partial",
    "format_requested": "DIRECT_CALCULATION",
    "format_used": "DIRECT_CALCULATION",
    "features_active": [
      "enhanced_distractors",
      "rich_scenarios",
      "cognitive_load",
      "advanced_formats"
    ],
    "features_pending": []
  },
  "context": {
    "id": "default-4-1759234385193",
    "theme": "SHOPPING",
    "setting": {
      "location": "shop",
      "timeContext": "afternoon",
      "atmosphere": "friendly"
    },
    "characters": [
      {
        "name": "Elizabeth",
        "role": "student"
      }
    ],
    "items": [
      {
        "name": "item",
        "category": "HOUSEHOLD_ITEMS",
        "typicalValue": {
          "min": 1,
          "max": 10,
          "typical": 5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      }
    ],
    "culturalElements": [
      {
        "type": "currency",
        "value": "£",
        "explanation": "British pounds"
      }
    ],
    "realWorldConnection": "Basic shopping calculations",
    "yearAppropriate": [
      4
    ],
    "templates": [
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION"
        ],
        "template": "{character} buys {article} {item} for {price}. How much does it cost?",
        "answerTemplate": "It costs {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "price",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      }
    ]
  }
}
# Test B.23: POSITION_DIRECTION model
{
  "success": true,
  "question": {
    "text": "Ethan buys an item for £5. How much does it cost?",
    "options": [
      {
        "value": 0,
        "text": "0p",
        "isCorrect": true
      }
    ],
    "correctIndex": 0,
    "format": "DIRECT_CALCULATION",
    "difficulty": {
      "year": 4,
      "subLevel": 1,
      "displayName": "4.1",
      "cognitiveLoad": 40
    },
    "cognitiveLoad": 40,
    "curriculumTags": [
      "4N1a"
    ],
    "scenario": {
      "id": "default-4-1759234385239",
      "theme": "SHOPPING",
      "setting": {
        "location": "shop",
        "timeContext": "afternoon",
        "atmosphere": "friendly"
      },
      "characters": [
        {
          "name": "Ethan",
          "role": "student"
        }
      ],
      "items": [
        {
          "name": "item",
          "category": "HOUSEHOLD_ITEMS",
          "typicalValue": {
            "min": 1,
            "max": 10,
            "typical": 5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        }
      ],
      "culturalElements": [
        {
          "type": "currency",
          "value": "£",
          "explanation": "British pounds"
        }
      ],
      "realWorldConnection": "Basic shopping calculations",
      "yearAppropriate": [
        4
      ],
      "templates": [
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION"
          ],
          "template": "{character} buys {article} {item} for {price}. How much does it cost?",
          "answerTemplate": "It costs {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "price",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        }
      ]
    },
    "distractors": [],
    "enhancementStatus": {
      "level": "partial",
      "requestedFormat": "DIRECT_CALCULATION",
      "actualFormat": "DIRECT_CALCULATION",
      "featuresActive": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "featuresPending": [],
      "isFullyEnhanced": true
    },
    "mathOutput": {
      "operation": "POSITION_DIRECTION"
    },
    "generationTime": 1,
    "questionId": "q_1759234385239_ejztmwx8y",
    "generationSetup": {
      "controller_used": "DIRECT_CALCULATIONController",
      "format_requested": "DIRECT_CALCULATION",
      "format_actual": "DIRECT_CALCULATION",
      "scenario_theme": "SHOPPING",
      "scenario_id": "default-4-1759234385239",
      "scenario_selection_method": "default",
      "distractor_strategies": [],
      "distractor_count": 0,
      "theme_variety": false,
      "format_variety": false,
      "enhancement_level": "partial",
      "features_active": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "features_pending": [],
      "generation_time_ms": 1
    }
  },
  "metadata": {
    "format": "DIRECT_CALCULATION",
    "cognitive_load": 40,
    "curriculum_alignment": [
      "4N1a"
    ],
    "difficulty": "4.1",
    "scenario_theme": "SHOPPING",
    "distractor_strategies": [],
    "generation_time_ms": 1,
    "api_version": "2.0",
    "enhancement_status": "partial",
    "format_requested": "DIRECT_CALCULATION",
    "format_used": "DIRECT_CALCULATION",
    "features_active": [
      "enhanced_distractors",
      "rich_scenarios",
      "cognitive_load",
      "advanced_formats"
    ],
    "features_pending": []
  },
  "context": {
    "id": "default-4-1759234385239",
    "theme": "SHOPPING",
    "setting": {
      "location": "shop",
      "timeContext": "afternoon",
      "atmosphere": "friendly"
    },
    "characters": [
      {
        "name": "Ethan",
        "role": "student"
      }
    ],
    "items": [
      {
        "name": "item",
        "category": "HOUSEHOLD_ITEMS",
        "typicalValue": {
          "min": 1,
          "max": 10,
          "typical": 5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      }
    ],
    "culturalElements": [
      {
        "type": "currency",
        "value": "£",
        "explanation": "British pounds"
      }
    ],
    "realWorldConnection": "Basic shopping calculations",
    "yearAppropriate": [
      4
    ],
    "templates": [
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION"
        ],
        "template": "{character} buys {article} {item} for {price}. How much does it cost?",
        "answerTemplate": "It costs {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "price",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      }
    ]
  }
}
# Test B.24: AREA_PERIMETER model
{
  "success": true,
  "question": {
    "text": "Henry buys an item for £5. How much does it cost?",
    "options": [
      {
        "value": 0,
        "text": "0p",
        "isCorrect": true
      }
    ],
    "correctIndex": 0,
    "format": "DIRECT_CALCULATION",
    "difficulty": {
      "year": 4,
      "subLevel": 1,
      "displayName": "4.1",
      "cognitiveLoad": 40
    },
    "cognitiveLoad": 40,
    "curriculumTags": [
      "4N1a"
    ],
    "scenario": {
      "id": "default-4-1759234385284",
      "theme": "SHOPPING",
      "setting": {
        "location": "shop",
        "timeContext": "afternoon",
        "atmosphere": "friendly"
      },
      "characters": [
        {
          "name": "Henry",
          "role": "student"
        }
      ],
      "items": [
        {
          "name": "item",
          "category": "HOUSEHOLD_ITEMS",
          "typicalValue": {
            "min": 1,
            "max": 10,
            "typical": 5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        }
      ],
      "culturalElements": [
        {
          "type": "currency",
          "value": "£",
          "explanation": "British pounds"
        }
      ],
      "realWorldConnection": "Basic shopping calculations",
      "yearAppropriate": [
        4
      ],
      "templates": [
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION"
          ],
          "template": "{character} buys {article} {item} for {price}. How much does it cost?",
          "answerTemplate": "It costs {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "price",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        }
      ]
    },
    "distractors": [],
    "enhancementStatus": {
      "level": "partial",
      "requestedFormat": "DIRECT_CALCULATION",
      "actualFormat": "DIRECT_CALCULATION",
      "featuresActive": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "featuresPending": [],
      "isFullyEnhanced": true
    },
    "mathOutput": {
      "operation": "AREA_PERIMETER"
    },
    "generationTime": 2,
    "questionId": "q_1759234385284_aw6731irq",
    "generationSetup": {
      "controller_used": "DIRECT_CALCULATIONController",
      "format_requested": "DIRECT_CALCULATION",
      "format_actual": "DIRECT_CALCULATION",
      "scenario_theme": "SHOPPING",
      "scenario_id": "default-4-1759234385284",
      "scenario_selection_method": "default",
      "distractor_strategies": [],
      "distractor_count": 0,
      "theme_variety": false,
      "format_variety": false,
      "enhancement_level": "partial",
      "features_active": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "features_pending": [],
      "generation_time_ms": 2
    }
  },
  "metadata": {
    "format": "DIRECT_CALCULATION",
    "cognitive_load": 40,
    "curriculum_alignment": [
      "4N1a"
    ],
    "difficulty": "4.1",
    "scenario_theme": "SHOPPING",
    "distractor_strategies": [],
    "generation_time_ms": 2,
    "api_version": "2.0",
    "enhancement_status": "partial",
    "format_requested": "DIRECT_CALCULATION",
    "format_used": "DIRECT_CALCULATION",
    "features_active": [
      "enhanced_distractors",
      "rich_scenarios",
      "cognitive_load",
      "advanced_formats"
    ],
    "features_pending": []
  },
  "context": {
    "id": "default-4-1759234385284",
    "theme": "SHOPPING",
    "setting": {
      "location": "shop",
      "timeContext": "afternoon",
      "atmosphere": "friendly"
    },
    "characters": [
      {
        "name": "Henry",
        "role": "student"
      }
    ],
    "items": [
      {
        "name": "item",
        "category": "HOUSEHOLD_ITEMS",
        "typicalValue": {
          "min": 1,
          "max": 10,
          "typical": 5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      }
    ],
    "culturalElements": [
      {
        "type": "currency",
        "value": "£",
        "explanation": "British pounds"
      }
    ],
    "realWorldConnection": "Basic shopping calculations",
    "yearAppropriate": [
      4
    ],
    "templates": [
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION"
        ],
        "template": "{character} buys {article} {item} for {price}. How much does it cost?",
        "answerTemplate": "It costs {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "price",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      }
    ]
  }
}

--- SUITE C: FORMAT COVERAGE TESTS ---
Testing every question format using the ADDITION model...
# Test C.1: DIRECT_CALCULATION format
{
  "success": true,
  "question": {
    "text": "Sarah wants to buy books at the book fair. Calculate the total cost.",
    "options": [
      {
        "text": "28.35",
        "value": 28.35,
        "index": 0
      },
      {
        "text": "9.29",
        "value": 9.29,
        "index": 1
      },
      {
        "text": "8.19",
        "value": 8.19,
        "index": 2
      },
      {
        "text": "£18.35",
        "value": 18.35,
        "index": 3
      }
    ],
    "correctIndex": 3,
    "format": "DIRECT_CALCULATION",
    "difficulty": {
      "year": 5,
      "subLevel": 3,
      "displayName": "5.3",
      "cognitiveLoad": 60
    },
    "cognitiveLoad": 60,
    "curriculumTags": [
      "5N1a",
      "5N1b"
    ],
    "scenario": {
      "id": "shop-001-bookfair",
      "theme": "SHOPPING",
      "setting": {
        "location": "school book fair",
        "timeContext": "lunch break",
        "atmosphere": "busy"
      },
      "characters": [
        {
          "name": "Sarah",
          "role": "student"
        },
        {
          "name": "Mr. Johnson",
          "role": "teacher"
        }
      ],
      "items": [
        {
          "name": "book",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 3,
            "max": 12,
            "typical": 6.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "bookmark",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.5,
            "max": 2,
            "typical": 1,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        }
      ],
      "culturalElements": [
        {
          "type": "currency",
          "value": "£",
          "explanation": "British pounds"
        },
        {
          "type": "event",
          "value": "book fair",
          "explanation": "School fundraising event"
        }
      ],
      "realWorldConnection": "School fundraising and reading promotion",
      "yearAppropriate": [
        2,
        3,
        4,
        5
      ],
      "templates": [
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "COMPARISON"
          ],
          "modelCompatibility": [
            "ADDITION",
            "COUNTING"
          ],
          "template": "{character} wants to buy books at the book fair. Calculate the total cost.",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        }
      ]
    },
    "distractors": [
      {
        "value": 8.19,
        "displayText": "8.19",
        "strategy": "WRONG_OPERATION",
        "reasoning": "Subtracted instead of adding"
      },
      {
        "value": 9.29,
        "displayText": "9.29",
        "strategy": "WRONG_OPERATION",
        "reasoning": "Multiplied instead of adding"
      },
      {
        "value": 28.35,
        "displayText": "28.35",
        "strategy": "PLACE_VALUE_ERROR",
        "reasoning": "Error in carrying to next column"
      }
    ],
    "enhancementStatus": {
      "level": "partial",
      "requestedFormat": "DIRECT_CALCULATION",
      "actualFormat": "DIRECT_CALCULATION",
      "featuresActive": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "featuresPending": [],
      "isFullyEnhanced": true
    },
    "mathOutput": {
      "operation": "ADDITION",
      "operand_1": 9.2,
      "operand_2": 1.01,
      "operand_3": 5.64,
      "operand_4": 2.5,
      "result": 18.35
    },
    "generationTime": 0,
    "questionId": "q_1759234385328_t4j18v3pw",
    "generationSetup": {
      "controller_used": "DIRECT_CALCULATIONController",
      "format_requested": "DIRECT_CALCULATION",
      "format_actual": "DIRECT_CALCULATION",
      "scenario_theme": "SHOPPING",
      "scenario_id": "shop-001-bookfair",
      "scenario_selection_method": "default",
      "distractor_strategies": [
        "WRONG_OPERATION",
        "WRONG_OPERATION",
        "PLACE_VALUE_ERROR"
      ],
      "distractor_count": 3,
      "theme_variety": false,
      "format_variety": false,
      "enhancement_level": "partial",
      "features_active": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "features_pending": [],
      "generation_time_ms": 0
    }
  },
  "metadata": {
    "format": "DIRECT_CALCULATION",
    "cognitive_load": 60,
    "curriculum_alignment": [
      "5N1a",
      "5N1b"
    ],
    "difficulty": "5.3",
    "scenario_theme": "SHOPPING",
    "distractor_strategies": [
      "WRONG_OPERATION",
      "WRONG_OPERATION",
      "PLACE_VALUE_ERROR"
    ],
    "generation_time_ms": 0,
    "api_version": "2.0",
    "enhancement_status": "partial",
    "format_requested": "DIRECT_CALCULATION",
    "format_used": "DIRECT_CALCULATION",
    "features_active": [
      "enhanced_distractors",
      "rich_scenarios",
      "cognitive_load",
      "advanced_formats"
    ],
    "features_pending": []
  },
  "context": {
    "id": "shop-001-bookfair",
    "theme": "SHOPPING",
    "setting": {
      "location": "school book fair",
      "timeContext": "lunch break",
      "atmosphere": "busy"
    },
    "characters": [
      {
        "name": "Sarah",
        "role": "student"
      },
      {
        "name": "Mr. Johnson",
        "role": "teacher"
      }
    ],
    "items": [
      {
        "name": "book",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 3,
          "max": 12,
          "typical": 6.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "bookmark",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.5,
          "max": 2,
          "typical": 1,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      }
    ],
    "culturalElements": [
      {
        "type": "currency",
        "value": "£",
        "explanation": "British pounds"
      },
      {
        "type": "event",
        "value": "book fair",
        "explanation": "School fundraising event"
      }
    ],
    "realWorldConnection": "School fundraising and reading promotion",
    "yearAppropriate": [
      2,
      3,
      4,
      5
    ],
    "templates": [
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "COMPARISON"
        ],
        "modelCompatibility": [
          "ADDITION",
          "COUNTING"
        ],
        "template": "{character} wants to buy books at the book fair. Calculate the total cost.",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      }
    ]
  }
}
# Test C.2: COMPARISON format
{
  "success": true,
  "question": {
    "text": "Liam is comparing options to find the best value.\n\nOption A: A: 660 + 700 + 703 + 716 = 2779\nOption B: B: 806 + 531 + 378 = 1715\n\nWhich calculation gives the higher result?",
    "options": [
      {
        "text": "Option B saves you £2128.00",
        "value": 1,
        "index": 0
      },
      {
        "text": "Option A is better value",
        "value": 0,
        "index": 1
      },
      {
        "text": "Both options are equally good value",
        "value": -1,
        "index": 2
      },
      {
        "text": "Option B is better value",
        "value": 1,
        "index": 3
      }
    ],
    "correctIndex": 0,
    "questionContent": {
      "fullText": "Liam is comparing options to find the best value.\n\nOption A: A: 660 + 700 + 703 + 716 = 2779\nOption B: B: 806 + 531 + 378 = 1715\n\nWhich calculation gives the higher result?",
      "templateData": {
        "character": "Liam",
        "optionA": "A: 660 + 700 + 703 + 716 = 2779",
        "optionB": "B: 806 + 531 + 378 = 1715",
        "context": "addition",
        "comparisonType": "calculated_value"
      }
    },
    "format": "COMPARISON",
    "difficulty": {
      "year": 5,
      "subLevel": 3,
      "displayName": "5.3",
      "cognitiveLoad": 60
    },
    "cognitiveLoad": 60,
    "curriculumTags": [
      "5N1a",
      "5N1b"
    ],
    "scenario": {
      "id": "shop-002-realistic-general",
      "theme": "SHOPPING",
      "setting": {
        "location": "local shop",
        "timeContext": "after school",
        "atmosphere": "friendly"
      },
      "characters": [
        {
          "name": "Liam",
          "role": "student"
        }
      ],
      "items": [
        {
          "name": "apple",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.2,
            "max": 0.5,
            "typical": 0.35,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "banana",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.15,
            "max": 0.4,
            "typical": 0.25,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "sandwich",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 2.5,
            "max": 6,
            "typical": 4,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "drink",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.8,
            "max": 2.5,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "cake",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 1.5,
            "max": 4,
            "typical": 2.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "biscuit",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.8,
            "max": 2,
            "typical": 1.2,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "sweet",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.1,
            "max": 1,
            "typical": 0.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "chocolate",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.6,
            "max": 3,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "pen",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.5,
            "max": 2,
            "typical": 1,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "pencil",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.2,
            "max": 1,
            "typical": 0.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "ruler",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.8,
            "max": 2.5,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "notebook",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 1,
            "max": 4,
            "typical": 2,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "eraser",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.3,
            "max": 1.5,
            "typical": 0.75,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "book",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 3,
            "max": 15,
            "typical": 8,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "comic",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 2,
            "max": 5,
            "typical": 3,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "magazine",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 2.5,
            "max": 6,
            "typical": 4,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "toy",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 5,
            "max": 25,
            "typical": 12,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "game",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 8,
            "max": 60,
            "typical": 25,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "puzzle",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 5,
            "max": 20,
            "typical": 12,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "sticker",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 0.2,
            "max": 2,
            "typical": 0.8,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "badge",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 0.5,
            "max": 3,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "poster",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 2,
            "max": 8,
            "typical": 4,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "card",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 0.5,
            "max": 4,
            "typical": 2,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        }
      ],
      "culturalElements": [
        {
          "type": "currency",
          "value": "£",
          "explanation": "British pounds"
        },
        {
          "type": "location",
          "value": "UK local shop",
          "explanation": "Typical British corner shop"
        }
      ],
      "realWorldConnection": "Everyday shopping with realistic UK prices",
      "yearAppropriate": [
        1,
        2,
        3,
        4,
        5,
        6
      ],
      "templates": [
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "MULTI_STEP"
          ],
          "modelCompatibility": [
            "ADDITION"
          ],
          "operandCount": 3,
          "template": "{character} buys {article1} {item1} for {price1}, {article2} {item2} for {price2}, and {article3} {item3} for {price3}. What is the total cost?",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item1",
              "type": "item"
            },
            {
              "key": "item2",
              "type": "item"
            },
            {
              "key": "item3",
              "type": "item"
            },
            {
              "key": "price1",
              "type": "value"
            },
            {
              "key": "price2",
              "type": "value"
            },
            {
              "key": "price3",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "MULTI_STEP"
          ],
          "modelCompatibility": [
            "ADDITION"
          ],
          "operandCount": 2,
          "template": "{character} buys {article1} {item1} for {price1} and {article2} {item2} for {price2}. What is the total cost?",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item1",
              "type": "item"
            },
            {
              "key": "item2",
              "type": "item"
            },
            {
              "key": "price1",
              "type": "value"
            },
            {
              "key": "price2",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION"
          ],
          "modelCompatibility": [
            "SUBTRACTION",
            "CHANGE_CALCULATION"
          ],
          "template": "{character} buys {article} {item} for {price} and pays with {payment}. How much change does {character} get?",
          "answerTemplate": "{character} receives {result} in change",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "price",
              "type": "value"
            },
            {
              "key": "payment",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION"
          ],
          "modelCompatibility": [
            "MULTIPLICATION"
          ],
          "template": "{character} buys {quantity} {item} at {price} each. What is the total cost?",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "quantity",
              "type": "value"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "price",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION"
          ],
          "modelCompatibility": [
            "DIVISION"
          ],
          "template": "{character} has {total} to spend equally on {quantity} {item}. How much can {character} spend on each one?",
          "answerTemplate": "{character} can spend {result} on each {item}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "total",
              "type": "value"
            },
            {
              "key": "quantity",
              "type": "value"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "COMPARISON",
            "ESTIMATION",
            "MULTI_STEP"
          ],
          "template": "{character} goes to the shop and buys {items}. How much does {character} spend in total?",
          "answerTemplate": "{character} spends {result} in total",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "items",
              "type": "item_list"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "ESTIMATION"
          ],
          "template": "Estimate: If {character} buys {items}, about how much will it cost?",
          "answerTemplate": "It will cost approximately {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "items",
              "type": "item_list"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "VALIDATION"
          ],
          "template": "{character} calculated that {items} costs {amount}. Is this correct?",
          "answerTemplate": "{validation_result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "items",
              "type": "item_list"
            },
            {
              "key": "amount",
              "type": "value"
            },
            {
              "key": "validation_result",
              "type": "boolean"
            }
          ]
        }
      ]
    },
    "distractors": [
      {
        "value": 0,
        "displayText": "Option A is better value",
        "strategy": "REVERSED_COMPARISON",
        "reasoning": "Selected the option with lower value"
      },
      {
        "value": -1,
        "displayText": "Both options are equally good value",
        "strategy": "WRONG_SELECTION",
        "reasoning": "Failed to calculate the difference correctly"
      },
      {
        "value": 1,
        "displayText": "Option B saves you £2128.00",
        "strategy": "CALCULATION_ERROR",
        "reasoning": "Arithmetic error in calculating the difference"
      }
    ],
    "enhancementStatus": {
      "level": "full",
      "requestedFormat": "COMPARISON",
      "actualFormat": "COMPARISON",
      "featuresActive": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "featuresPending": [],
      "isFullyEnhanced": true
    },
    "mathOutput": {
      "operation": "ADDITION",
      "option_1_value": 2779,
      "option_2_value": 1715
    },
    "generationTime": 0,
    "questionId": "q_1759234385370_2k0szlq6c",
    "generationSetup": {
      "controller_used": "COMPARISONController",
      "format_requested": "COMPARISON",
      "format_actual": "COMPARISON",
      "scenario_theme": "SHOPPING",
      "scenario_id": "shop-002-realistic-general",
      "scenario_selection_method": "default",
      "distractor_strategies": [
        "REVERSED_COMPARISON",
        "WRONG_SELECTION",
        "CALCULATION_ERROR"
      ],
      "distractor_count": 3,
      "theme_variety": false,
      "format_variety": false,
      "enhancement_level": "full",
      "features_active": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "features_pending": [],
      "generation_time_ms": 0
    }
  },
  "metadata": {
    "format": "COMPARISON",
    "cognitive_load": 60,
    "curriculum_alignment": [
      "5N1a",
      "5N1b"
    ],
    "difficulty": "5.3",
    "scenario_theme": "SHOPPING",
    "distractor_strategies": [
      "REVERSED_COMPARISON",
      "WRONG_SELECTION",
      "CALCULATION_ERROR"
    ],
    "generation_time_ms": 0,
    "api_version": "2.0",
    "enhancement_status": "full",
    "format_requested": "COMPARISON",
    "format_used": "COMPARISON",
    "features_active": [
      "enhanced_distractors",
      "rich_scenarios",
      "cognitive_load",
      "advanced_formats"
    ],
    "features_pending": []
  },
  "context": {
    "id": "shop-002-realistic-general",
    "theme": "SHOPPING",
    "setting": {
      "location": "local shop",
      "timeContext": "after school",
      "atmosphere": "friendly"
    },
    "characters": [
      {
        "name": "Liam",
        "role": "student"
      }
    ],
    "items": [
      {
        "name": "apple",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.2,
          "max": 0.5,
          "typical": 0.35,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "banana",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.15,
          "max": 0.4,
          "typical": 0.25,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "sandwich",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 2.5,
          "max": 6,
          "typical": 4,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "drink",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.8,
          "max": 2.5,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "cake",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 1.5,
          "max": 4,
          "typical": 2.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "biscuit",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.8,
          "max": 2,
          "typical": 1.2,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "sweet",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.1,
          "max": 1,
          "typical": 0.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "chocolate",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.6,
          "max": 3,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "pen",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.5,
          "max": 2,
          "typical": 1,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "pencil",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.2,
          "max": 1,
          "typical": 0.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "ruler",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.8,
          "max": 2.5,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "notebook",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 1,
          "max": 4,
          "typical": 2,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "eraser",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.3,
          "max": 1.5,
          "typical": 0.75,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "book",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 3,
          "max": 15,
          "typical": 8,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "comic",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 2,
          "max": 5,
          "typical": 3,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "magazine",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 2.5,
          "max": 6,
          "typical": 4,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "toy",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 5,
          "max": 25,
          "typical": 12,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "game",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 8,
          "max": 60,
          "typical": 25,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "puzzle",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 5,
          "max": 20,
          "typical": 12,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "sticker",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 0.2,
          "max": 2,
          "typical": 0.8,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "badge",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 0.5,
          "max": 3,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "poster",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 2,
          "max": 8,
          "typical": 4,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "card",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 0.5,
          "max": 4,
          "typical": 2,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      }
    ],
    "culturalElements": [
      {
        "type": "currency",
        "value": "£",
        "explanation": "British pounds"
      },
      {
        "type": "location",
        "value": "UK local shop",
        "explanation": "Typical British corner shop"
      }
    ],
    "realWorldConnection": "Everyday shopping with realistic UK prices",
    "yearAppropriate": [
      1,
      2,
      3,
      4,
      5,
      6
    ],
    "templates": [
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "MULTI_STEP"
        ],
        "modelCompatibility": [
          "ADDITION"
        ],
        "operandCount": 3,
        "template": "{character} buys {article1} {item1} for {price1}, {article2} {item2} for {price2}, and {article3} {item3} for {price3}. What is the total cost?",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item1",
            "type": "item"
          },
          {
            "key": "item2",
            "type": "item"
          },
          {
            "key": "item3",
            "type": "item"
          },
          {
            "key": "price1",
            "type": "value"
          },
          {
            "key": "price2",
            "type": "value"
          },
          {
            "key": "price3",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "MULTI_STEP"
        ],
        "modelCompatibility": [
          "ADDITION"
        ],
        "operandCount": 2,
        "template": "{character} buys {article1} {item1} for {price1} and {article2} {item2} for {price2}. What is the total cost?",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item1",
            "type": "item"
          },
          {
            "key": "item2",
            "type": "item"
          },
          {
            "key": "price1",
            "type": "value"
          },
          {
            "key": "price2",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION"
        ],
        "modelCompatibility": [
          "SUBTRACTION",
          "CHANGE_CALCULATION"
        ],
        "template": "{character} buys {article} {item} for {price} and pays with {payment}. How much change does {character} get?",
        "answerTemplate": "{character} receives {result} in change",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "price",
            "type": "value"
          },
          {
            "key": "payment",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION"
        ],
        "modelCompatibility": [
          "MULTIPLICATION"
        ],
        "template": "{character} buys {quantity} {item} at {price} each. What is the total cost?",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "quantity",
            "type": "value"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "price",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION"
        ],
        "modelCompatibility": [
          "DIVISION"
        ],
        "template": "{character} has {total} to spend equally on {quantity} {item}. How much can {character} spend on each one?",
        "answerTemplate": "{character} can spend {result} on each {item}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "total",
            "type": "value"
          },
          {
            "key": "quantity",
            "type": "value"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "COMPARISON",
          "ESTIMATION",
          "MULTI_STEP"
        ],
        "template": "{character} goes to the shop and buys {items}. How much does {character} spend in total?",
        "answerTemplate": "{character} spends {result} in total",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "items",
            "type": "item_list"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "ESTIMATION"
        ],
        "template": "Estimate: If {character} buys {items}, about how much will it cost?",
        "answerTemplate": "It will cost approximately {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "items",
            "type": "item_list"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "VALIDATION"
        ],
        "template": "{character} calculated that {items} costs {amount}. Is this correct?",
        "answerTemplate": "{validation_result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "items",
            "type": "item_list"
          },
          {
            "key": "amount",
            "type": "value"
          },
          {
            "key": "validation_result",
            "type": "boolean"
          }
        ]
      }
    ]
  }
}
# Test C.3: ESTIMATION format
{
  "success": true,
  "question": {
    "text": "Liam is adding £523.00 + £30.00 + £267.00 + £559.00. Round the result to the nearest hundreds.",
    "options": [
      {
        "text": "1380",
        "value": 1380,
        "index": 0
      },
      {
        "text": "£1400.00",
        "value": 1400,
        "index": 1
      },
      {
        "text": "1400",
        "value": 1400,
        "index": 2
      },
      {
        "text": "1300",
        "value": 1300,
        "index": 3
      }
    ],
    "correctIndex": 1,
    "questionContent": {
      "fullText": "Liam is adding £523.00 + £30.00 + £267.00 + £559.00. Round the result to the nearest hundreds.",
      "templateData": {
        "character": "Liam",
        "operation": "is adding £523.00 + £30.00 + £267.00 + £559.00",
        "roundingPlace": "hundreds",
        "exactValue": "1379",
        "roundedValue": "1400"
      }
    },
    "format": "ESTIMATION",
    "difficulty": {
      "year": 5,
      "subLevel": 3,
      "displayName": "5.3",
      "cognitiveLoad": 60
    },
    "cognitiveLoad": 60,
    "curriculumTags": [
      "5N1a",
      "5N1b"
    ],
    "scenario": {
      "id": "shop-002-realistic-general",
      "theme": "SHOPPING",
      "setting": {
        "location": "local shop",
        "timeContext": "after school",
        "atmosphere": "friendly"
      },
      "characters": [
        {
          "name": "Liam",
          "role": "student"
        }
      ],
      "items": [
        {
          "name": "apple",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.2,
            "max": 0.5,
            "typical": 0.35,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "banana",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.15,
            "max": 0.4,
            "typical": 0.25,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "sandwich",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 2.5,
            "max": 6,
            "typical": 4,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "drink",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.8,
            "max": 2.5,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "cake",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 1.5,
            "max": 4,
            "typical": 2.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "biscuit",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.8,
            "max": 2,
            "typical": 1.2,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "sweet",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.1,
            "max": 1,
            "typical": 0.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "chocolate",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.6,
            "max": 3,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "pen",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.5,
            "max": 2,
            "typical": 1,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "pencil",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.2,
            "max": 1,
            "typical": 0.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "ruler",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.8,
            "max": 2.5,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "notebook",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 1,
            "max": 4,
            "typical": 2,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "eraser",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.3,
            "max": 1.5,
            "typical": 0.75,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "book",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 3,
            "max": 15,
            "typical": 8,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "comic",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 2,
            "max": 5,
            "typical": 3,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "magazine",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 2.5,
            "max": 6,
            "typical": 4,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "toy",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 5,
            "max": 25,
            "typical": 12,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "game",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 8,
            "max": 60,
            "typical": 25,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "puzzle",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 5,
            "max": 20,
            "typical": 12,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "sticker",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 0.2,
            "max": 2,
            "typical": 0.8,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "badge",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 0.5,
            "max": 3,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "poster",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 2,
            "max": 8,
            "typical": 4,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "card",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 0.5,
            "max": 4,
            "typical": 2,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        }
      ],
      "culturalElements": [
        {
          "type": "currency",
          "value": "£",
          "explanation": "British pounds"
        },
        {
          "type": "location",
          "value": "UK local shop",
          "explanation": "Typical British corner shop"
        }
      ],
      "realWorldConnection": "Everyday shopping with realistic UK prices",
      "yearAppropriate": [
        1,
        2,
        3,
        4,
        5,
        6
      ],
      "templates": [
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "MULTI_STEP"
          ],
          "modelCompatibility": [
            "ADDITION"
          ],
          "operandCount": 3,
          "template": "{character} buys {article1} {item1} for {price1}, {article2} {item2} for {price2}, and {article3} {item3} for {price3}. What is the total cost?",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item1",
              "type": "item"
            },
            {
              "key": "item2",
              "type": "item"
            },
            {
              "key": "item3",
              "type": "item"
            },
            {
              "key": "price1",
              "type": "value"
            },
            {
              "key": "price2",
              "type": "value"
            },
            {
              "key": "price3",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "MULTI_STEP"
          ],
          "modelCompatibility": [
            "ADDITION"
          ],
          "operandCount": 2,
          "template": "{character} buys {article1} {item1} for {price1} and {article2} {item2} for {price2}. What is the total cost?",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item1",
              "type": "item"
            },
            {
              "key": "item2",
              "type": "item"
            },
            {
              "key": "price1",
              "type": "value"
            },
            {
              "key": "price2",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION"
          ],
          "modelCompatibility": [
            "SUBTRACTION",
            "CHANGE_CALCULATION"
          ],
          "template": "{character} buys {article} {item} for {price} and pays with {payment}. How much change does {character} get?",
          "answerTemplate": "{character} receives {result} in change",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "price",
              "type": "value"
            },
            {
              "key": "payment",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION"
          ],
          "modelCompatibility": [
            "MULTIPLICATION"
          ],
          "template": "{character} buys {quantity} {item} at {price} each. What is the total cost?",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "quantity",
              "type": "value"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "price",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION"
          ],
          "modelCompatibility": [
            "DIVISION"
          ],
          "template": "{character} has {total} to spend equally on {quantity} {item}. How much can {character} spend on each one?",
          "answerTemplate": "{character} can spend {result} on each {item}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "total",
              "type": "value"
            },
            {
              "key": "quantity",
              "type": "value"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "COMPARISON",
            "ESTIMATION",
            "MULTI_STEP"
          ],
          "template": "{character} goes to the shop and buys {items}. How much does {character} spend in total?",
          "answerTemplate": "{character} spends {result} in total",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "items",
              "type": "item_list"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "ESTIMATION"
          ],
          "template": "Estimate: If {character} buys {items}, about how much will it cost?",
          "answerTemplate": "It will cost approximately {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "items",
              "type": "item_list"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "VALIDATION"
          ],
          "template": "{character} calculated that {items} costs {amount}. Is this correct?",
          "answerTemplate": "{validation_result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "items",
              "type": "item_list"
            },
            {
              "key": "amount",
              "type": "value"
            },
            {
              "key": "validation_result",
              "type": "boolean"
            }
          ]
        }
      ]
    },
    "distractors": [
      {
        "value": 1380,
        "strategy": "WRONG_OPERATION",
        "rationale": "Rounded to wrong place value"
      },
      {
        "value": 1300,
        "rationale": "Truncated instead of rounded"
      },
      {
        "value": 1400,
        "rationale": "Always rounded up"
      }
    ],
    "enhancementStatus": {
      "level": "full",
      "requestedFormat": "ESTIMATION",
      "actualFormat": "ESTIMATION",
      "featuresActive": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "featuresPending": [],
      "isFullyEnhanced": true
    },
    "mathOutput": {
      "operation": "ADDITION",
      "operands": [
        523,
        30,
        267,
        559
      ],
      "result": 1379,
      "intermediate_steps": [
        523,
        553,
        820
      ],
      "decimal_formatted": {
        "operands": [
          "523",
          "30",
          "267",
          "559"
        ],
        "result": "1379"
      },
      "exactValue": 1379,
      "roundedValue": 1400
    },
    "generationTime": 1,
    "questionId": "q_1759234385415_fcvxjkb1y",
    "generationSetup": {
      "controller_used": "ESTIMATIONController",
      "format_requested": "ESTIMATION",
      "format_actual": "ESTIMATION",
      "scenario_theme": "SHOPPING",
      "scenario_id": "shop-002-realistic-general",
      "scenario_selection_method": "default",
      "distractor_strategies": [
        "WRONG_OPERATION",
        null,
        null
      ],
      "distractor_count": 3,
      "theme_variety": false,
      "format_variety": false,
      "enhancement_level": "full",
      "features_active": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "features_pending": [],
      "generation_time_ms": 1
    }
  },
  "metadata": {
    "format": "ESTIMATION",
    "cognitive_load": 60,
    "curriculum_alignment": [
      "5N1a",
      "5N1b"
    ],
    "difficulty": "5.3",
    "scenario_theme": "SHOPPING",
    "distractor_strategies": [
      "WRONG_OPERATION",
      null,
      null
    ],
    "generation_time_ms": 1,
    "api_version": "2.0",
    "enhancement_status": "full",
    "format_requested": "ESTIMATION",
    "format_used": "ESTIMATION",
    "features_active": [
      "enhanced_distractors",
      "rich_scenarios",
      "cognitive_load",
      "advanced_formats"
    ],
    "features_pending": []
  },
  "context": {
    "id": "shop-002-realistic-general",
    "theme": "SHOPPING",
    "setting": {
      "location": "local shop",
      "timeContext": "after school",
      "atmosphere": "friendly"
    },
    "characters": [
      {
        "name": "Liam",
        "role": "student"
      }
    ],
    "items": [
      {
        "name": "apple",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.2,
          "max": 0.5,
          "typical": 0.35,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "banana",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.15,
          "max": 0.4,
          "typical": 0.25,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "sandwich",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 2.5,
          "max": 6,
          "typical": 4,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "drink",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.8,
          "max": 2.5,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "cake",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 1.5,
          "max": 4,
          "typical": 2.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "biscuit",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.8,
          "max": 2,
          "typical": 1.2,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "sweet",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.1,
          "max": 1,
          "typical": 0.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "chocolate",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.6,
          "max": 3,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "pen",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.5,
          "max": 2,
          "typical": 1,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "pencil",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.2,
          "max": 1,
          "typical": 0.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "ruler",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.8,
          "max": 2.5,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "notebook",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 1,
          "max": 4,
          "typical": 2,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "eraser",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.3,
          "max": 1.5,
          "typical": 0.75,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "book",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 3,
          "max": 15,
          "typical": 8,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "comic",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 2,
          "max": 5,
          "typical": 3,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "magazine",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 2.5,
          "max": 6,
          "typical": 4,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "toy",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 5,
          "max": 25,
          "typical": 12,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "game",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 8,
          "max": 60,
          "typical": 25,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "puzzle",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 5,
          "max": 20,
          "typical": 12,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "sticker",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 0.2,
          "max": 2,
          "typical": 0.8,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "badge",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 0.5,
          "max": 3,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "poster",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 2,
          "max": 8,
          "typical": 4,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "card",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 0.5,
          "max": 4,
          "typical": 2,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      }
    ],
    "culturalElements": [
      {
        "type": "currency",
        "value": "£",
        "explanation": "British pounds"
      },
      {
        "type": "location",
        "value": "UK local shop",
        "explanation": "Typical British corner shop"
      }
    ],
    "realWorldConnection": "Everyday shopping with realistic UK prices",
    "yearAppropriate": [
      1,
      2,
      3,
      4,
      5,
      6
    ],
    "templates": [
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "MULTI_STEP"
        ],
        "modelCompatibility": [
          "ADDITION"
        ],
        "operandCount": 3,
        "template": "{character} buys {article1} {item1} for {price1}, {article2} {item2} for {price2}, and {article3} {item3} for {price3}. What is the total cost?",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item1",
            "type": "item"
          },
          {
            "key": "item2",
            "type": "item"
          },
          {
            "key": "item3",
            "type": "item"
          },
          {
            "key": "price1",
            "type": "value"
          },
          {
            "key": "price2",
            "type": "value"
          },
          {
            "key": "price3",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "MULTI_STEP"
        ],
        "modelCompatibility": [
          "ADDITION"
        ],
        "operandCount": 2,
        "template": "{character} buys {article1} {item1} for {price1} and {article2} {item2} for {price2}. What is the total cost?",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item1",
            "type": "item"
          },
          {
            "key": "item2",
            "type": "item"
          },
          {
            "key": "price1",
            "type": "value"
          },
          {
            "key": "price2",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION"
        ],
        "modelCompatibility": [
          "SUBTRACTION",
          "CHANGE_CALCULATION"
        ],
        "template": "{character} buys {article} {item} for {price} and pays with {payment}. How much change does {character} get?",
        "answerTemplate": "{character} receives {result} in change",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "price",
            "type": "value"
          },
          {
            "key": "payment",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION"
        ],
        "modelCompatibility": [
          "MULTIPLICATION"
        ],
        "template": "{character} buys {quantity} {item} at {price} each. What is the total cost?",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "quantity",
            "type": "value"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "price",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION"
        ],
        "modelCompatibility": [
          "DIVISION"
        ],
        "template": "{character} has {total} to spend equally on {quantity} {item}. How much can {character} spend on each one?",
        "answerTemplate": "{character} can spend {result} on each {item}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "total",
            "type": "value"
          },
          {
            "key": "quantity",
            "type": "value"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "COMPARISON",
          "ESTIMATION",
          "MULTI_STEP"
        ],
        "template": "{character} goes to the shop and buys {items}. How much does {character} spend in total?",
        "answerTemplate": "{character} spends {result} in total",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "items",
            "type": "item_list"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "ESTIMATION"
        ],
        "template": "Estimate: If {character} buys {items}, about how much will it cost?",
        "answerTemplate": "It will cost approximately {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "items",
            "type": "item_list"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "VALIDATION"
        ],
        "template": "{character} calculated that {items} costs {amount}. Is this correct?",
        "answerTemplate": "{validation_result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "items",
            "type": "item_list"
          },
          {
            "key": "amount",
            "type": "value"
          },
          {
            "key": "validation_result",
            "type": "boolean"
          }
        ]
      }
    ]
  }
}
# Test C.4: ORDERING format
{
  "success": true,
  "question": {
    "text": "Sarah is comparing prices: 61, 812.5, 715, 376, 360 pence. Arrange these prices from smallest to largest.",
    "options": [
      {
        "text": "61, 360, 376, 715, 812.5",
        "value": 0,
        "index": 0
      },
      {
        "text": "61, 360, 376, 812.5, 715",
        "value": 2,
        "index": 1
      },
      {
        "text": "812.5, 715, 376, 360, 61",
        "value": 1,
        "index": 2
      },
      {
        "text": "61, 812.5, 715, 376, 360",
        "value": 3,
        "index": 3
      }
    ],
    "correctIndex": 0,
    "questionContent": {
      "fullText": "Sarah is comparing prices: 61, 812.5, 715, 376, 360 pence. Arrange these prices from smallest to largest."
    },
    "format": "ORDERING",
    "difficulty": {
      "year": 5,
      "subLevel": 3,
      "displayName": "5.3",
      "cognitiveLoad": 60
    },
    "cognitiveLoad": 60,
    "curriculumTags": [
      "5N1a",
      "5N1b"
    ],
    "scenario": {
      "id": "shop-001-bookfair",
      "theme": "SHOPPING",
      "setting": {
        "location": "school book fair",
        "timeContext": "lunch break",
        "atmosphere": "busy"
      },
      "characters": [
        {
          "name": "Sarah",
          "role": "student"
        },
        {
          "name": "Mr. Johnson",
          "role": "teacher"
        }
      ],
      "items": [
        {
          "name": "book",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 3,
            "max": 12,
            "typical": 6.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "bookmark",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.5,
            "max": 2,
            "typical": 1,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        }
      ],
      "culturalElements": [
        {
          "type": "currency",
          "value": "£",
          "explanation": "British pounds"
        },
        {
          "type": "event",
          "value": "book fair",
          "explanation": "School fundraising event"
        }
      ],
      "realWorldConnection": "School fundraising and reading promotion",
      "yearAppropriate": [
        2,
        3,
        4,
        5
      ],
      "templates": [
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "COMPARISON"
          ],
          "modelCompatibility": [
            "ADDITION",
            "COUNTING"
          ],
          "template": "{character} wants to buy books at the book fair. Calculate the total cost.",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        }
      ]
    },
    "distractors": [
      {
        "value": 1,
        "displayText": "812.5, 715, 376, 360, 61",
        "reasoning": "Ordered in opposite direction"
      },
      {
        "value": 2,
        "displayText": "61, 360, 376, 812.5, 715",
        "reasoning": "Partially correct ordering"
      },
      {
        "value": 3,
        "displayText": "61, 812.5, 715, 376, 360",
        "reasoning": "Original unsorted order"
      }
    ],
    "enhancementStatus": {
      "level": "full",
      "requestedFormat": "ORDERING",
      "actualFormat": "ORDERING",
      "featuresActive": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "featuresPending": [],
      "isFullyEnhanced": true
    },
    "mathOutput": {
      "operation": "ADDITION",
      "operands": [
        194,
        866,
        851,
        850
      ],
      "result": 2761,
      "intermediate_steps": [
        194,
        1060,
        1911
      ],
      "decimal_formatted": {
        "operands": [
          "194",
          "866",
          "851",
          "850"
        ],
        "result": "2761"
      }
    },
    "generationTime": 1,
    "questionId": "q_1759234385465_0fosypwrg",
    "generationSetup": {
      "controller_used": "ORDERINGController",
      "format_requested": "ORDERING",
      "format_actual": "ORDERING",
      "scenario_theme": "SHOPPING",
      "scenario_id": "shop-001-bookfair",
      "scenario_selection_method": "default",
      "distractor_strategies": [
        null,
        null,
        null
      ],
      "distractor_count": 3,
      "theme_variety": false,
      "format_variety": false,
      "enhancement_level": "full",
      "features_active": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "features_pending": [],
      "generation_time_ms": 1
    }
  },
  "metadata": {
    "format": "ORDERING",
    "cognitive_load": 60,
    "curriculum_alignment": [
      "5N1a",
      "5N1b"
    ],
    "difficulty": "5.3",
    "scenario_theme": "SHOPPING",
    "distractor_strategies": [
      null,
      null,
      null
    ],
    "generation_time_ms": 1,
    "api_version": "2.0",
    "enhancement_status": "full",
    "format_requested": "ORDERING",
    "format_used": "ORDERING",
    "features_active": [
      "enhanced_distractors",
      "rich_scenarios",
      "cognitive_load",
      "advanced_formats"
    ],
    "features_pending": []
  },
  "context": {
    "id": "shop-001-bookfair",
    "theme": "SHOPPING",
    "setting": {
      "location": "school book fair",
      "timeContext": "lunch break",
      "atmosphere": "busy"
    },
    "characters": [
      {
        "name": "Sarah",
        "role": "student"
      },
      {
        "name": "Mr. Johnson",
        "role": "teacher"
      }
    ],
    "items": [
      {
        "name": "book",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 3,
          "max": 12,
          "typical": 6.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "bookmark",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.5,
          "max": 2,
          "typical": 1,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      }
    ],
    "culturalElements": [
      {
        "type": "currency",
        "value": "£",
        "explanation": "British pounds"
      },
      {
        "type": "event",
        "value": "book fair",
        "explanation": "School fundraising event"
      }
    ],
    "realWorldConnection": "School fundraising and reading promotion",
    "yearAppropriate": [
      2,
      3,
      4,
      5
    ],
    "templates": [
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "COMPARISON"
        ],
        "modelCompatibility": [
          "ADDITION",
          "COUNTING"
        ],
        "template": "{character} wants to buy books at the book fair. Calculate the total cost.",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      }
    ]
  }
}
# Test C.5: VALIDATION format
{
  "success": true,
  "question": {
    "text": "Liam showed their working:\\n616 + 674 + 844 + 395\\n= 25290\\n\\nIs this working correct?",
    "options": [
      {
        "text": "Incorrect",
        "value": 0,
        "index": 0
      },
      {
        "text": "Incorrect",
        "value": 0,
        "index": 1
      }
    ],
    "correctIndex": 0,
    "questionContent": {
      "fullText": "Liam showed their working:\\n616 + 674 + 844 + 395\\n= 25290\\n\\nIs this working correct?"
    },
    "format": "VALIDATION",
    "difficulty": {
      "year": 5,
      "subLevel": 3,
      "displayName": "5.3",
      "cognitiveLoad": 60
    },
    "cognitiveLoad": 60,
    "curriculumTags": [
      "5N1a",
      "5N1b"
    ],
    "scenario": {
      "id": "shop-002-realistic-general",
      "theme": "SHOPPING",
      "setting": {
        "location": "local shop",
        "timeContext": "after school",
        "atmosphere": "friendly"
      },
      "characters": [
        {
          "name": "Liam",
          "role": "student"
        }
      ],
      "items": [
        {
          "name": "apple",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.2,
            "max": 0.5,
            "typical": 0.35,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "banana",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.15,
            "max": 0.4,
            "typical": 0.25,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "sandwich",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 2.5,
            "max": 6,
            "typical": 4,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "drink",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.8,
            "max": 2.5,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "cake",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 1.5,
            "max": 4,
            "typical": 2.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "biscuit",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.8,
            "max": 2,
            "typical": 1.2,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "sweet",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.1,
            "max": 1,
            "typical": 0.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "chocolate",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.6,
            "max": 3,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "pen",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.5,
            "max": 2,
            "typical": 1,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "pencil",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.2,
            "max": 1,
            "typical": 0.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "ruler",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.8,
            "max": 2.5,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "notebook",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 1,
            "max": 4,
            "typical": 2,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "eraser",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.3,
            "max": 1.5,
            "typical": 0.75,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "book",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 3,
            "max": 15,
            "typical": 8,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "comic",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 2,
            "max": 5,
            "typical": 3,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "magazine",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 2.5,
            "max": 6,
            "typical": 4,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "toy",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 5,
            "max": 25,
            "typical": 12,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "game",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 8,
            "max": 60,
            "typical": 25,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "puzzle",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 5,
            "max": 20,
            "typical": 12,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "sticker",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 0.2,
            "max": 2,
            "typical": 0.8,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "badge",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 0.5,
            "max": 3,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "poster",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 2,
            "max": 8,
            "typical": 4,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "card",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 0.5,
            "max": 4,
            "typical": 2,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        }
      ],
      "culturalElements": [
        {
          "type": "currency",
          "value": "£",
          "explanation": "British pounds"
        },
        {
          "type": "location",
          "value": "UK local shop",
          "explanation": "Typical British corner shop"
        }
      ],
      "realWorldConnection": "Everyday shopping with realistic UK prices",
      "yearAppropriate": [
        1,
        2,
        3,
        4,
        5,
        6
      ],
      "templates": [
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "MULTI_STEP"
          ],
          "modelCompatibility": [
            "ADDITION"
          ],
          "operandCount": 3,
          "template": "{character} buys {article1} {item1} for {price1}, {article2} {item2} for {price2}, and {article3} {item3} for {price3}. What is the total cost?",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item1",
              "type": "item"
            },
            {
              "key": "item2",
              "type": "item"
            },
            {
              "key": "item3",
              "type": "item"
            },
            {
              "key": "price1",
              "type": "value"
            },
            {
              "key": "price2",
              "type": "value"
            },
            {
              "key": "price3",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "MULTI_STEP"
          ],
          "modelCompatibility": [
            "ADDITION"
          ],
          "operandCount": 2,
          "template": "{character} buys {article1} {item1} for {price1} and {article2} {item2} for {price2}. What is the total cost?",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item1",
              "type": "item"
            },
            {
              "key": "item2",
              "type": "item"
            },
            {
              "key": "price1",
              "type": "value"
            },
            {
              "key": "price2",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION"
          ],
          "modelCompatibility": [
            "SUBTRACTION",
            "CHANGE_CALCULATION"
          ],
          "template": "{character} buys {article} {item} for {price} and pays with {payment}. How much change does {character} get?",
          "answerTemplate": "{character} receives {result} in change",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "price",
              "type": "value"
            },
            {
              "key": "payment",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION"
          ],
          "modelCompatibility": [
            "MULTIPLICATION"
          ],
          "template": "{character} buys {quantity} {item} at {price} each. What is the total cost?",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "quantity",
              "type": "value"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "price",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION"
          ],
          "modelCompatibility": [
            "DIVISION"
          ],
          "template": "{character} has {total} to spend equally on {quantity} {item}. How much can {character} spend on each one?",
          "answerTemplate": "{character} can spend {result} on each {item}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "total",
              "type": "value"
            },
            {
              "key": "quantity",
              "type": "value"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "COMPARISON",
            "ESTIMATION",
            "MULTI_STEP"
          ],
          "template": "{character} goes to the shop and buys {items}. How much does {character} spend in total?",
          "answerTemplate": "{character} spends {result} in total",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "items",
              "type": "item_list"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "ESTIMATION"
          ],
          "template": "Estimate: If {character} buys {items}, about how much will it cost?",
          "answerTemplate": "It will cost approximately {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "items",
              "type": "item_list"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "VALIDATION"
          ],
          "template": "{character} calculated that {items} costs {amount}. Is this correct?",
          "answerTemplate": "{validation_result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "items",
              "type": "item_list"
            },
            {
              "key": "amount",
              "type": "value"
            },
            {
              "key": "validation_result",
              "type": "boolean"
            }
          ]
        }
      ]
    },
    "distractors": [
      {
        "value": 0,
        "displayText": "Incorrect",
        "reasoning": "Incorrectly identified correct work as wrong"
      }
    ],
    "enhancementStatus": {
      "level": "full",
      "requestedFormat": "VALIDATION",
      "actualFormat": "VALIDATION",
      "featuresActive": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "featuresPending": [],
      "isFullyEnhanced": true
    },
    "mathOutput": {
      "operation": "ADDITION",
      "operands": [
        616,
        674,
        844,
        395
      ],
      "result": 2529,
      "intermediate_steps": [
        616,
        1290,
        2134
      ],
      "decimal_formatted": {
        "operands": [
          "616",
          "674",
          "844",
          "395"
        ],
        "result": "2529"
      }
    },
    "generationTime": 1,
    "questionId": "q_1759234385513_7uuhj33ko",
    "generationSetup": {
      "controller_used": "VALIDATIONController",
      "format_requested": "VALIDATION",
      "format_actual": "VALIDATION",
      "scenario_theme": "SHOPPING",
      "scenario_id": "shop-002-realistic-general",
      "scenario_selection_method": "default",
      "distractor_strategies": [
        null
      ],
      "distractor_count": 1,
      "theme_variety": false,
      "format_variety": false,
      "enhancement_level": "full",
      "features_active": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "features_pending": [],
      "generation_time_ms": 1
    }
  },
  "metadata": {
    "format": "VALIDATION",
    "cognitive_load": 60,
    "curriculum_alignment": [
      "5N1a",
      "5N1b"
    ],
    "difficulty": "5.3",
    "scenario_theme": "SHOPPING",
    "distractor_strategies": [
      null
    ],
    "generation_time_ms": 1,
    "api_version": "2.0",
    "enhancement_status": "full",
    "format_requested": "VALIDATION",
    "format_used": "VALIDATION",
    "features_active": [
      "enhanced_distractors",
      "rich_scenarios",
      "cognitive_load",
      "advanced_formats"
    ],
    "features_pending": []
  },
  "context": {
    "id": "shop-002-realistic-general",
    "theme": "SHOPPING",
    "setting": {
      "location": "local shop",
      "timeContext": "after school",
      "atmosphere": "friendly"
    },
    "characters": [
      {
        "name": "Liam",
        "role": "student"
      }
    ],
    "items": [
      {
        "name": "apple",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.2,
          "max": 0.5,
          "typical": 0.35,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "banana",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.15,
          "max": 0.4,
          "typical": 0.25,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "sandwich",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 2.5,
          "max": 6,
          "typical": 4,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "drink",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.8,
          "max": 2.5,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "cake",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 1.5,
          "max": 4,
          "typical": 2.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "biscuit",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.8,
          "max": 2,
          "typical": 1.2,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "sweet",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.1,
          "max": 1,
          "typical": 0.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "chocolate",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.6,
          "max": 3,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "pen",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.5,
          "max": 2,
          "typical": 1,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "pencil",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.2,
          "max": 1,
          "typical": 0.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "ruler",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.8,
          "max": 2.5,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "notebook",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 1,
          "max": 4,
          "typical": 2,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "eraser",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.3,
          "max": 1.5,
          "typical": 0.75,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "book",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 3,
          "max": 15,
          "typical": 8,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "comic",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 2,
          "max": 5,
          "typical": 3,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "magazine",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 2.5,
          "max": 6,
          "typical": 4,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "toy",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 5,
          "max": 25,
          "typical": 12,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "game",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 8,
          "max": 60,
          "typical": 25,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "puzzle",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 5,
          "max": 20,
          "typical": 12,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "sticker",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 0.2,
          "max": 2,
          "typical": 0.8,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "badge",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 0.5,
          "max": 3,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "poster",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 2,
          "max": 8,
          "typical": 4,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "card",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 0.5,
          "max": 4,
          "typical": 2,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      }
    ],
    "culturalElements": [
      {
        "type": "currency",
        "value": "£",
        "explanation": "British pounds"
      },
      {
        "type": "location",
        "value": "UK local shop",
        "explanation": "Typical British corner shop"
      }
    ],
    "realWorldConnection": "Everyday shopping with realistic UK prices",
    "yearAppropriate": [
      1,
      2,
      3,
      4,
      5,
      6
    ],
    "templates": [
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "MULTI_STEP"
        ],
        "modelCompatibility": [
          "ADDITION"
        ],
        "operandCount": 3,
        "template": "{character} buys {article1} {item1} for {price1}, {article2} {item2} for {price2}, and {article3} {item3} for {price3}. What is the total cost?",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item1",
            "type": "item"
          },
          {
            "key": "item2",
            "type": "item"
          },
          {
            "key": "item3",
            "type": "item"
          },
          {
            "key": "price1",
            "type": "value"
          },
          {
            "key": "price2",
            "type": "value"
          },
          {
            "key": "price3",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "MULTI_STEP"
        ],
        "modelCompatibility": [
          "ADDITION"
        ],
        "operandCount": 2,
        "template": "{character} buys {article1} {item1} for {price1} and {article2} {item2} for {price2}. What is the total cost?",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item1",
            "type": "item"
          },
          {
            "key": "item2",
            "type": "item"
          },
          {
            "key": "price1",
            "type": "value"
          },
          {
            "key": "price2",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION"
        ],
        "modelCompatibility": [
          "SUBTRACTION",
          "CHANGE_CALCULATION"
        ],
        "template": "{character} buys {article} {item} for {price} and pays with {payment}. How much change does {character} get?",
        "answerTemplate": "{character} receives {result} in change",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "price",
            "type": "value"
          },
          {
            "key": "payment",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION"
        ],
        "modelCompatibility": [
          "MULTIPLICATION"
        ],
        "template": "{character} buys {quantity} {item} at {price} each. What is the total cost?",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "quantity",
            "type": "value"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "price",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION"
        ],
        "modelCompatibility": [
          "DIVISION"
        ],
        "template": "{character} has {total} to spend equally on {quantity} {item}. How much can {character} spend on each one?",
        "answerTemplate": "{character} can spend {result} on each {item}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "total",
            "type": "value"
          },
          {
            "key": "quantity",
            "type": "value"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "COMPARISON",
          "ESTIMATION",
          "MULTI_STEP"
        ],
        "template": "{character} goes to the shop and buys {items}. How much does {character} spend in total?",
        "answerTemplate": "{character} spends {result} in total",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "items",
            "type": "item_list"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "ESTIMATION"
        ],
        "template": "Estimate: If {character} buys {items}, about how much will it cost?",
        "answerTemplate": "It will cost approximately {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "items",
            "type": "item_list"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "VALIDATION"
        ],
        "template": "{character} calculated that {items} costs {amount}. Is this correct?",
        "answerTemplate": "{validation_result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "items",
            "type": "item_list"
          },
          {
            "key": "amount",
            "type": "value"
          },
          {
            "key": "validation_result",
            "type": "boolean"
          }
        ]
      }
    ]
  }
}
# Test C.6: MULTI_STEP format
{
  "success": true,
  "question": {
    "text": "Sarah is shopping and needs to make several calculations. First, Sarah adds the cost of 129p and 9p items. Then Sarah adds 25p more to the total. Then Sarah adds 13p more to the total. Then Sarah adds 12p more to the total. What is the final result?",
    "options": [
      {
        "text": "£188.00",
        "value": 188,
        "index": 0
      },
      {
        "text": "150",
        "value": 150,
        "index": 1
      },
      {
        "text": "138",
        "value": 138,
        "index": 2
      },
      {
        "text": "188",
        "value": 188,
        "index": 3
      }
    ],
    "correctIndex": 0,
    "questionContent": {
      "fullText": "Sarah is shopping and needs to make several calculations. First, Sarah adds the cost of 129p and 9p items. Then Sarah adds 25p more to the total. Then Sarah adds 13p more to the total. Then Sarah adds 12p more to the total. What is the final result?",
      "components": {
        "narrative": "Sarah needs to solve this step by step:",
        "steps": [
          {
            "stepNumber": 1,
            "text": "Add 129 and 9",
            "operation": "ADDITION",
            "values": [
              129,
              9
            ],
            "result": 138,
            "description": "Add 129 and 9"
          },
          {
            "stepNumber": 2,
            "text": "Add 25 to 138",
            "operation": "ADDITION",
            "values": [
              138,
              25
            ],
            "result": 163,
            "description": "Add 25 to 138"
          },
          {
            "stepNumber": 3,
            "text": "Add 13 to 163",
            "operation": "ADDITION",
            "values": [
              163,
              13
            ],
            "result": 176,
            "description": "Add 13 to 163"
          },
          {
            "stepNumber": 4,
            "text": "Add 12 to 176",
            "operation": "ADDITION",
            "values": [
              176,
              12
            ],
            "result": 188,
            "description": "Add 12 to 176"
          }
        ],
        "prompt": "What is the final result?",
        "highlightValues": [
          129,
          9,
          138,
          138,
          25,
          163,
          163,
          13,
          176,
          176,
          12,
          188
        ],
        "operators": [
          "+"
        ]
      },
      "templateData": {
        "character": "Sarah",
        "context": "school book fair",
        "theme": "SHOPPING",
        "quantities": [
          129,
          138,
          163,
          176
        ],
        "prices": [
          9,
          25,
          13,
          12
        ],
        "action": "calculating step by step"
      }
    },
    "format": "MULTI_STEP",
    "difficulty": {
      "year": 5,
      "subLevel": 3,
      "displayName": "5.3",
      "cognitiveLoad": 60
    },
    "cognitiveLoad": 60,
    "curriculumTags": [
      "5N1a",
      "5N1b"
    ],
    "scenario": {
      "id": "shop-001-bookfair",
      "theme": "SHOPPING",
      "setting": {
        "location": "school book fair",
        "timeContext": "lunch break",
        "atmosphere": "busy"
      },
      "characters": [
        {
          "name": "Sarah",
          "role": "student"
        },
        {
          "name": "Mr. Johnson",
          "role": "teacher"
        }
      ],
      "items": [
        {
          "name": "book",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 3,
            "max": 12,
            "typical": 6.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "bookmark",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.5,
            "max": 2,
            "typical": 1,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        }
      ],
      "culturalElements": [
        {
          "type": "currency",
          "value": "£",
          "explanation": "British pounds"
        },
        {
          "type": "event",
          "value": "book fair",
          "explanation": "School fundraising event"
        }
      ],
      "realWorldConnection": "School fundraising and reading promotion",
      "yearAppropriate": [
        2,
        3,
        4,
        5
      ],
      "templates": [
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "COMPARISON"
          ],
          "modelCompatibility": [
            "ADDITION",
            "COUNTING"
          ],
          "template": "{character} wants to buy books at the book fair. Calculate the total cost.",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        }
      ]
    },
    "distractors": [
      {
        "value": 138,
        "rationale": "Stopped after first step"
      },
      {
        "value": 188,
        "strategy": "WRONG_OPERATION",
        "rationale": "Used wrong operation in step 2"
      },
      {
        "value": 150,
        "rationale": "Performed operations in wrong order"
      }
    ],
    "enhancementStatus": {
      "level": "full",
      "requestedFormat": "MULTI_STEP",
      "actualFormat": "MULTI_STEP",
      "featuresActive": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "featuresPending": [],
      "isFullyEnhanced": true
    },
    "mathOutput": {
      "operation": "ADDITION",
      "operands": [
        295,
        296,
        623,
        5
      ],
      "result": 1219,
      "intermediate_steps": [
        295,
        591,
        1214
      ],
      "decimal_formatted": {
        "operands": [
          "295",
          "296",
          "623",
          "5"
        ],
        "result": "1219"
      }
    },
    "generationTime": 1,
    "questionId": "q_1759234385560_8hrn1m0cd",
    "generationSetup": {
      "controller_used": "MULTI_STEPController",
      "format_requested": "MULTI_STEP",
      "format_actual": "MULTI_STEP",
      "scenario_theme": "SHOPPING",
      "scenario_id": "shop-001-bookfair",
      "scenario_selection_method": "default",
      "distractor_strategies": [
        null,
        "WRONG_OPERATION",
        null
      ],
      "distractor_count": 3,
      "theme_variety": false,
      "format_variety": false,
      "enhancement_level": "full",
      "features_active": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "features_pending": [],
      "generation_time_ms": 1
    }
  },
  "metadata": {
    "format": "MULTI_STEP",
    "cognitive_load": 60,
    "curriculum_alignment": [
      "5N1a",
      "5N1b"
    ],
    "difficulty": "5.3",
    "scenario_theme": "SHOPPING",
    "distractor_strategies": [
      null,
      "WRONG_OPERATION",
      null
    ],
    "generation_time_ms": 1,
    "api_version": "2.0",
    "enhancement_status": "full",
    "format_requested": "MULTI_STEP",
    "format_used": "MULTI_STEP",
    "features_active": [
      "enhanced_distractors",
      "rich_scenarios",
      "cognitive_load",
      "advanced_formats"
    ],
    "features_pending": []
  },
  "context": {
    "id": "shop-001-bookfair",
    "theme": "SHOPPING",
    "setting": {
      "location": "school book fair",
      "timeContext": "lunch break",
      "atmosphere": "busy"
    },
    "characters": [
      {
        "name": "Sarah",
        "role": "student"
      },
      {
        "name": "Mr. Johnson",
        "role": "teacher"
      }
    ],
    "items": [
      {
        "name": "book",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 3,
          "max": 12,
          "typical": 6.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "bookmark",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.5,
          "max": 2,
          "typical": 1,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      }
    ],
    "culturalElements": [
      {
        "type": "currency",
        "value": "£",
        "explanation": "British pounds"
      },
      {
        "type": "event",
        "value": "book fair",
        "explanation": "School fundraising event"
      }
    ],
    "realWorldConnection": "School fundraising and reading promotion",
    "yearAppropriate": [
      2,
      3,
      4,
      5
    ],
    "templates": [
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "COMPARISON"
        ],
        "modelCompatibility": [
          "ADDITION",
          "COUNTING"
        ],
        "template": "{character} wants to buy books at the book fair. Calculate the total cost.",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      }
    ]
  }
}
# Test C.7: MISSING_VALUE format
{
  "success": true,
  "question": {
    "text": "Sarah is working on this equation: 784 + 912 = ?. What number should replace the ? to make this equation true?",
    "options": [
      {
        "text": "3496",
        "value": 3496,
        "index": 0
      },
      {
        "value": 3750.399766977615,
        "text": "£3750.40",
        "isCorrect": false
      },
      {
        "text": "784",
        "value": 784,
        "index": 2
      },
      {
        "text": "3495",
        "value": 3495,
        "index": 3
      }
    ],
    "correctIndex": 0,
    "questionContent": {
      "fullText": "Sarah is working on this equation: 784 + 912 = ?. What number should replace the ? to make this equation true?"
    },
    "format": "MISSING_VALUE",
    "difficulty": {
      "year": 5,
      "subLevel": 3,
      "displayName": "5.3",
      "cognitiveLoad": 60
    },
    "cognitiveLoad": 60,
    "curriculumTags": [
      "5N1a",
      "5N1b"
    ],
    "scenario": {
      "id": "shop-001-bookfair",
      "theme": "SHOPPING",
      "setting": {
        "location": "school book fair",
        "timeContext": "lunch break",
        "atmosphere": "busy"
      },
      "characters": [
        {
          "name": "Sarah",
          "role": "student"
        },
        {
          "name": "Mr. Johnson",
          "role": "teacher"
        }
      ],
      "items": [
        {
          "name": "book",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 3,
            "max": 12,
            "typical": 6.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "bookmark",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.5,
            "max": 2,
            "typical": 1,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        }
      ],
      "culturalElements": [
        {
          "type": "currency",
          "value": "£",
          "explanation": "British pounds"
        },
        {
          "type": "event",
          "value": "book fair",
          "explanation": "School fundraising event"
        }
      ],
      "realWorldConnection": "School fundraising and reading promotion",
      "yearAppropriate": [
        2,
        3,
        4,
        5
      ],
      "templates": [
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "COMPARISON"
          ],
          "modelCompatibility": [
            "ADDITION",
            "COUNTING"
          ],
          "template": "{character} wants to buy books at the book fair. Calculate the total cost.",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        }
      ]
    },
    "distractors": [
      {
        "value": null,
        "strategy": "WRONG_OPERATION",
        "rationale": "Used wrong operation to solve"
      },
      {
        "value": 3495,
        "strategy": "CALCULATION_ERROR",
        "rationale": "Arithmetic calculation error"
      },
      {
        "value": 784,
        "rationale": "Confused given value with missing value"
      }
    ],
    "enhancementStatus": {
      "level": "full",
      "requestedFormat": "MISSING_VALUE",
      "actualFormat": "MISSING_VALUE",
      "featuresActive": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "featuresPending": [],
      "isFullyEnhanced": true
    },
    "mathOutput": {
      "operation": "ADDITION",
      "operands": [
        784,
        912,
        840,
        960
      ],
      "result": 3496,
      "intermediate_steps": [
        784,
        1696,
        2536
      ],
      "decimal_formatted": {
        "operands": [
          "784",
          "912",
          "840",
          "960"
        ],
        "result": "3496"
      }
    },
    "generationTime": 0,
    "questionId": "q_1759234385609_fjjorttgb",
    "generationSetup": {
      "controller_used": "MISSING_VALUEController",
      "format_requested": "MISSING_VALUE",
      "format_actual": "MISSING_VALUE",
      "scenario_theme": "SHOPPING",
      "scenario_id": "shop-001-bookfair",
      "scenario_selection_method": "default",
      "distractor_strategies": [
        "WRONG_OPERATION",
        "CALCULATION_ERROR",
        null
      ],
      "distractor_count": 3,
      "theme_variety": false,
      "format_variety": false,
      "enhancement_level": "full",
      "features_active": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "features_pending": [],
      "generation_time_ms": 0
    }
  },
  "metadata": {
    "format": "MISSING_VALUE",
    "cognitive_load": 60,
    "curriculum_alignment": [
      "5N1a",
      "5N1b"
    ],
    "difficulty": "5.3",
    "scenario_theme": "SHOPPING",
    "distractor_strategies": [
      "WRONG_OPERATION",
      "CALCULATION_ERROR",
      null
    ],
    "generation_time_ms": 1,
    "api_version": "2.0",
    "enhancement_status": "full",
    "format_requested": "MISSING_VALUE",
    "format_used": "MISSING_VALUE",
    "features_active": [
      "enhanced_distractors",
      "rich_scenarios",
      "cognitive_load",
      "advanced_formats"
    ],
    "features_pending": []
  },
  "context": {
    "id": "shop-001-bookfair",
    "theme": "SHOPPING",
    "setting": {
      "location": "school book fair",
      "timeContext": "lunch break",
      "atmosphere": "busy"
    },
    "characters": [
      {
        "name": "Sarah",
        "role": "student"
      },
      {
        "name": "Mr. Johnson",
        "role": "teacher"
      }
    ],
    "items": [
      {
        "name": "book",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 3,
          "max": 12,
          "typical": 6.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "bookmark",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.5,
          "max": 2,
          "typical": 1,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      }
    ],
    "culturalElements": [
      {
        "type": "currency",
        "value": "£",
        "explanation": "British pounds"
      },
      {
        "type": "event",
        "value": "book fair",
        "explanation": "School fundraising event"
      }
    ],
    "realWorldConnection": "School fundraising and reading promotion",
    "yearAppropriate": [
      2,
      3,
      4,
      5
    ],
    "templates": [
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "COMPARISON"
        ],
        "modelCompatibility": [
          "ADDITION",
          "COUNTING"
        ],
        "template": "{character} wants to buy books at the book fair. Calculate the total cost.",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      }
    ]
  }
}
# Test C.8: PATTERN_RECOGNITION format
{
  "success": true,
  "question": {
    "text": "Sarah needs to find the missing number in this pattern: 18, 22, ?, 30, 34, 38, ?",
    "options": [
      {
        "text": "46",
        "value": 46,
        "index": 0
      },
      {
        "text": "43",
        "value": 43,
        "index": 1
      },
      {
        "value": null,
        "text": "NaNp",
        "isCorrect": false
      },
      {
        "text": "76",
        "value": 76,
        "index": 3
      }
    ],
    "correctIndex": 2,
    "questionContent": {
      "fullText": "Sarah needs to find the missing number in this pattern: 18, 22, ?, 30, 34, 38, ?"
    },
    "format": "PATTERN_RECOGNITION",
    "difficulty": {
      "year": 5,
      "subLevel": 3,
      "displayName": "5.3",
      "cognitiveLoad": 60
    },
    "cognitiveLoad": 60,
    "curriculumTags": [
      "5N1a",
      "5N1b"
    ],
    "scenario": {
      "id": "shop-001-bookfair",
      "theme": "SHOPPING",
      "setting": {
        "location": "school book fair",
        "timeContext": "lunch break",
        "atmosphere": "busy"
      },
      "characters": [
        {
          "name": "Sarah",
          "role": "student"
        },
        {
          "name": "Mr. Johnson",
          "role": "teacher"
        }
      ],
      "items": [
        {
          "name": "book",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 3,
            "max": 12,
            "typical": 6.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "bookmark",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.5,
            "max": 2,
            "typical": 1,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        }
      ],
      "culturalElements": [
        {
          "type": "currency",
          "value": "£",
          "explanation": "British pounds"
        },
        {
          "type": "event",
          "value": "book fair",
          "explanation": "School fundraising event"
        }
      ],
      "realWorldConnection": "School fundraising and reading promotion",
      "yearAppropriate": [
        2,
        3,
        4,
        5
      ],
      "templates": [
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "COMPARISON"
          ],
          "modelCompatibility": [
            "ADDITION",
            "COUNTING"
          ],
          "template": "{character} wants to buy books at the book fair. Calculate the total cost.",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        }
      ]
    },
    "distractors": [
      {
        "value": 43,
        "rationale": "Used wrong step size (5 instead of 4)"
      },
      {
        "value": 76,
        "strategy": "WRONG_OPERATION",
        "rationale": "Used wrong operation for pattern"
      },
      {
        "value": 46,
        "rationale": "Started pattern from wrong position"
      }
    ],
    "enhancementStatus": {
      "level": "full",
      "requestedFormat": "PATTERN_RECOGNITION",
      "actualFormat": "PATTERN_RECOGNITION",
      "featuresActive": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "featuresPending": [],
      "isFullyEnhanced": true
    },
    "mathOutput": {
      "operation": "ADDITION",
      "operands": [
        719,
        953,
        170,
        328
      ],
      "result": 2170,
      "intermediate_steps": [
        719,
        1672,
        1842
      ],
      "decimal_formatted": {
        "operands": [
          "719",
          "953",
          "170",
          "328"
        ],
        "result": "2170"
      }
    },
    "generationTime": 1,
    "questionId": "q_1759234385662_b83z4kf13",
    "generationSetup": {
      "controller_used": "PATTERN_RECOGNITIONController",
      "format_requested": "PATTERN_RECOGNITION",
      "format_actual": "PATTERN_RECOGNITION",
      "scenario_theme": "SHOPPING",
      "scenario_id": "shop-001-bookfair",
      "scenario_selection_method": "default",
      "distractor_strategies": [
        null,
        "WRONG_OPERATION",
        null
      ],
      "distractor_count": 3,
      "theme_variety": false,
      "format_variety": false,
      "enhancement_level": "full",
      "features_active": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "features_pending": [],
      "generation_time_ms": 1
    }
  },
  "metadata": {
    "format": "PATTERN_RECOGNITION",
    "cognitive_load": 60,
    "curriculum_alignment": [
      "5N1a",
      "5N1b"
    ],
    "difficulty": "5.3",
    "scenario_theme": "SHOPPING",
    "distractor_strategies": [
      null,
      "WRONG_OPERATION",
      null
    ],
    "generation_time_ms": 1,
    "api_version": "2.0",
    "enhancement_status": "full",
    "format_requested": "PATTERN_RECOGNITION",
    "format_used": "PATTERN_RECOGNITION",
    "features_active": [
      "enhanced_distractors",
      "rich_scenarios",
      "cognitive_load",
      "advanced_formats"
    ],
    "features_pending": []
  },
  "context": {
    "id": "shop-001-bookfair",
    "theme": "SHOPPING",
    "setting": {
      "location": "school book fair",
      "timeContext": "lunch break",
      "atmosphere": "busy"
    },
    "characters": [
      {
        "name": "Sarah",
        "role": "student"
      },
      {
        "name": "Mr. Johnson",
        "role": "teacher"
      }
    ],
    "items": [
      {
        "name": "book",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 3,
          "max": 12,
          "typical": 6.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "bookmark",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.5,
          "max": 2,
          "typical": 1,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      }
    ],
    "culturalElements": [
      {
        "type": "currency",
        "value": "£",
        "explanation": "British pounds"
      },
      {
        "type": "event",
        "value": "book fair",
        "explanation": "School fundraising event"
      }
    ],
    "realWorldConnection": "School fundraising and reading promotion",
    "yearAppropriate": [
      2,
      3,
      4,
      5
    ],
    "templates": [
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "COMPARISON"
        ],
        "modelCompatibility": [
          "ADDITION",
          "COUNTING"
        ],
        "template": "{character} wants to buy books at the book fair. Calculate the total cost.",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      }
    ]
  }
}

--- SUITE D: DIFFICULTY PROGRESSION TESTS ---
Testing smooth difficulty increase for the MULTIPLICATION model...
# Test D.1: MULTIPLICATION at difficulty 2.1
{
  "success": true,
  "question": {
    "text": "Liam buys 1 apple at 49p each. What is the total cost?",
    "options": [
      {
        "text": "49p",
        "value": 0.49,
        "index": 0
      },
      {
        "text": "2",
        "value": 2,
        "index": 1
      },
      {
        "text": "1.49",
        "value": 1.49,
        "index": 2
      },
      {
        "text": "-0.51",
        "value": -0.51,
        "index": 3
      }
    ],
    "correctIndex": 0,
    "format": "DIRECT_CALCULATION",
    "difficulty": {
      "year": 2,
      "subLevel": 1,
      "displayName": "2.1",
      "cognitiveLoad": 20
    },
    "cognitiveLoad": 20,
    "curriculumTags": [
      "2N1a"
    ],
    "scenario": {
      "id": "shop-002-realistic-general",
      "theme": "SHOPPING",
      "setting": {
        "location": "local shop",
        "timeContext": "after school",
        "atmosphere": "friendly"
      },
      "characters": [
        {
          "name": "Liam",
          "role": "student"
        }
      ],
      "items": [
        {
          "name": "apple",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.2,
            "max": 0.5,
            "typical": 0.35,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "banana",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.15,
            "max": 0.4,
            "typical": 0.25,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "sandwich",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 2.5,
            "max": 6,
            "typical": 4,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "drink",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.8,
            "max": 2.5,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "cake",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 1.5,
            "max": 4,
            "typical": 2.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "biscuit",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.8,
            "max": 2,
            "typical": 1.2,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "sweet",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.1,
            "max": 1,
            "typical": 0.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "chocolate",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.6,
            "max": 3,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "pen",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.5,
            "max": 2,
            "typical": 1,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "pencil",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.2,
            "max": 1,
            "typical": 0.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "ruler",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.8,
            "max": 2.5,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "notebook",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 1,
            "max": 4,
            "typical": 2,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "eraser",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.3,
            "max": 1.5,
            "typical": 0.75,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "book",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 3,
            "max": 15,
            "typical": 8,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "comic",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 2,
            "max": 5,
            "typical": 3,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "magazine",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 2.5,
            "max": 6,
            "typical": 4,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "toy",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 5,
            "max": 25,
            "typical": 12,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "game",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 8,
            "max": 60,
            "typical": 25,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "puzzle",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 5,
            "max": 20,
            "typical": 12,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "sticker",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 0.2,
            "max": 2,
            "typical": 0.8,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "badge",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 0.5,
            "max": 3,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "poster",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 2,
            "max": 8,
            "typical": 4,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "card",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 0.5,
            "max": 4,
            "typical": 2,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        }
      ],
      "culturalElements": [
        {
          "type": "currency",
          "value": "£",
          "explanation": "British pounds"
        },
        {
          "type": "location",
          "value": "UK local shop",
          "explanation": "Typical British corner shop"
        }
      ],
      "realWorldConnection": "Everyday shopping with realistic UK prices",
      "yearAppropriate": [
        1,
        2,
        3,
        4,
        5,
        6
      ],
      "templates": [
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "MULTI_STEP"
          ],
          "modelCompatibility": [
            "ADDITION"
          ],
          "operandCount": 3,
          "template": "{character} buys {article1} {item1} for {price1}, {article2} {item2} for {price2}, and {article3} {item3} for {price3}. What is the total cost?",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item1",
              "type": "item"
            },
            {
              "key": "item2",
              "type": "item"
            },
            {
              "key": "item3",
              "type": "item"
            },
            {
              "key": "price1",
              "type": "value"
            },
            {
              "key": "price2",
              "type": "value"
            },
            {
              "key": "price3",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "MULTI_STEP"
          ],
          "modelCompatibility": [
            "ADDITION"
          ],
          "operandCount": 2,
          "template": "{character} buys {article1} {item1} for {price1} and {article2} {item2} for {price2}. What is the total cost?",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item1",
              "type": "item"
            },
            {
              "key": "item2",
              "type": "item"
            },
            {
              "key": "price1",
              "type": "value"
            },
            {
              "key": "price2",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION"
          ],
          "modelCompatibility": [
            "SUBTRACTION",
            "CHANGE_CALCULATION"
          ],
          "template": "{character} buys {article} {item} for {price} and pays with {payment}. How much change does {character} get?",
          "answerTemplate": "{character} receives {result} in change",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "price",
              "type": "value"
            },
            {
              "key": "payment",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION"
          ],
          "modelCompatibility": [
            "MULTIPLICATION"
          ],
          "template": "{character} buys {quantity} {item} at {price} each. What is the total cost?",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "quantity",
              "type": "value"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "price",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION"
          ],
          "modelCompatibility": [
            "DIVISION"
          ],
          "template": "{character} has {total} to spend equally on {quantity} {item}. How much can {character} spend on each one?",
          "answerTemplate": "{character} can spend {result} on each {item}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "total",
              "type": "value"
            },
            {
              "key": "quantity",
              "type": "value"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "COMPARISON",
            "ESTIMATION",
            "MULTI_STEP"
          ],
          "template": "{character} goes to the shop and buys {items}. How much does {character} spend in total?",
          "answerTemplate": "{character} spends {result} in total",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "items",
              "type": "item_list"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "ESTIMATION"
          ],
          "template": "Estimate: If {character} buys {items}, about how much will it cost?",
          "answerTemplate": "It will cost approximately {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "items",
              "type": "item_list"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "VALIDATION"
          ],
          "template": "{character} calculated that {items} costs {amount}. Is this correct?",
          "answerTemplate": "{validation_result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "items",
              "type": "item_list"
            },
            {
              "key": "amount",
              "type": "value"
            },
            {
              "key": "validation_result",
              "type": "boolean"
            }
          ]
        }
      ]
    },
    "distractors": [
      {
        "value": -0.51,
        "displayText": "-0.51",
        "strategy": "COMMON_MISCONCEPTION",
        "reasoning": "Counting error"
      },
      {
        "value": 2,
        "displayText": "2",
        "strategy": "WRONG_OPERATION",
        "reasoning": "Added instead of multiplying"
      },
      {
        "value": 1.49,
        "displayText": "1.49",
        "strategy": "CLOSE_VALUE",
        "reasoning": "Off by 1"
      }
    ],
    "enhancementStatus": {
      "level": "partial",
      "requestedFormat": "DIRECT_CALCULATION",
      "actualFormat": "DIRECT_CALCULATION",
      "featuresActive": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "featuresPending": [],
      "isFullyEnhanced": true
    },
    "mathOutput": {
      "operation": "MULTIPLICATION",
      "multiplier": 1,
      "multiplicand": 0.49,
      "result": 0.49
    },
    "generationTime": 0,
    "questionId": "q_1759234385709_j6cmz1uec",
    "generationSetup": {
      "controller_used": "DIRECT_CALCULATIONController",
      "format_requested": "DIRECT_CALCULATION",
      "format_actual": "DIRECT_CALCULATION",
      "scenario_theme": "SHOPPING",
      "scenario_id": "shop-002-realistic-general",
      "scenario_selection_method": "default",
      "distractor_strategies": [
        "COMMON_MISCONCEPTION",
        "WRONG_OPERATION",
        "CLOSE_VALUE"
      ],
      "distractor_count": 3,
      "theme_variety": false,
      "format_variety": false,
      "enhancement_level": "partial",
      "features_active": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "features_pending": [],
      "generation_time_ms": 0
    }
  },
  "metadata": {
    "format": "DIRECT_CALCULATION",
    "cognitive_load": 20,
    "curriculum_alignment": [
      "2N1a"
    ],
    "difficulty": "2.1",
    "scenario_theme": "SHOPPING",
    "distractor_strategies": [
      "COMMON_MISCONCEPTION",
      "WRONG_OPERATION",
      "CLOSE_VALUE"
    ],
    "generation_time_ms": 0,
    "api_version": "2.0",
    "enhancement_status": "partial",
    "format_requested": "DIRECT_CALCULATION",
    "format_used": "DIRECT_CALCULATION",
    "features_active": [
      "enhanced_distractors",
      "rich_scenarios",
      "cognitive_load",
      "advanced_formats"
    ],
    "features_pending": []
  },
  "context": {
    "id": "shop-002-realistic-general",
    "theme": "SHOPPING",
    "setting": {
      "location": "local shop",
      "timeContext": "after school",
      "atmosphere": "friendly"
    },
    "characters": [
      {
        "name": "Liam",
        "role": "student"
      }
    ],
    "items": [
      {
        "name": "apple",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.2,
          "max": 0.5,
          "typical": 0.35,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "banana",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.15,
          "max": 0.4,
          "typical": 0.25,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "sandwich",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 2.5,
          "max": 6,
          "typical": 4,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "drink",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.8,
          "max": 2.5,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "cake",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 1.5,
          "max": 4,
          "typical": 2.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "biscuit",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.8,
          "max": 2,
          "typical": 1.2,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "sweet",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.1,
          "max": 1,
          "typical": 0.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "chocolate",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.6,
          "max": 3,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "pen",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.5,
          "max": 2,
          "typical": 1,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "pencil",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.2,
          "max": 1,
          "typical": 0.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "ruler",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.8,
          "max": 2.5,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "notebook",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 1,
          "max": 4,
          "typical": 2,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "eraser",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.3,
          "max": 1.5,
          "typical": 0.75,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "book",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 3,
          "max": 15,
          "typical": 8,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "comic",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 2,
          "max": 5,
          "typical": 3,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "magazine",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 2.5,
          "max": 6,
          "typical": 4,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "toy",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 5,
          "max": 25,
          "typical": 12,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "game",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 8,
          "max": 60,
          "typical": 25,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "puzzle",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 5,
          "max": 20,
          "typical": 12,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "sticker",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 0.2,
          "max": 2,
          "typical": 0.8,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "badge",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 0.5,
          "max": 3,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "poster",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 2,
          "max": 8,
          "typical": 4,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "card",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 0.5,
          "max": 4,
          "typical": 2,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      }
    ],
    "culturalElements": [
      {
        "type": "currency",
        "value": "£",
        "explanation": "British pounds"
      },
      {
        "type": "location",
        "value": "UK local shop",
        "explanation": "Typical British corner shop"
      }
    ],
    "realWorldConnection": "Everyday shopping with realistic UK prices",
    "yearAppropriate": [
      1,
      2,
      3,
      4,
      5,
      6
    ],
    "templates": [
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "MULTI_STEP"
        ],
        "modelCompatibility": [
          "ADDITION"
        ],
        "operandCount": 3,
        "template": "{character} buys {article1} {item1} for {price1}, {article2} {item2} for {price2}, and {article3} {item3} for {price3}. What is the total cost?",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item1",
            "type": "item"
          },
          {
            "key": "item2",
            "type": "item"
          },
          {
            "key": "item3",
            "type": "item"
          },
          {
            "key": "price1",
            "type": "value"
          },
          {
            "key": "price2",
            "type": "value"
          },
          {
            "key": "price3",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "MULTI_STEP"
        ],
        "modelCompatibility": [
          "ADDITION"
        ],
        "operandCount": 2,
        "template": "{character} buys {article1} {item1} for {price1} and {article2} {item2} for {price2}. What is the total cost?",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item1",
            "type": "item"
          },
          {
            "key": "item2",
            "type": "item"
          },
          {
            "key": "price1",
            "type": "value"
          },
          {
            "key": "price2",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION"
        ],
        "modelCompatibility": [
          "SUBTRACTION",
          "CHANGE_CALCULATION"
        ],
        "template": "{character} buys {article} {item} for {price} and pays with {payment}. How much change does {character} get?",
        "answerTemplate": "{character} receives {result} in change",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "price",
            "type": "value"
          },
          {
            "key": "payment",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION"
        ],
        "modelCompatibility": [
          "MULTIPLICATION"
        ],
        "template": "{character} buys {quantity} {item} at {price} each. What is the total cost?",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "quantity",
            "type": "value"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "price",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION"
        ],
        "modelCompatibility": [
          "DIVISION"
        ],
        "template": "{character} has {total} to spend equally on {quantity} {item}. How much can {character} spend on each one?",
        "answerTemplate": "{character} can spend {result} on each {item}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "total",
            "type": "value"
          },
          {
            "key": "quantity",
            "type": "value"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "COMPARISON",
          "ESTIMATION",
          "MULTI_STEP"
        ],
        "template": "{character} goes to the shop and buys {items}. How much does {character} spend in total?",
        "answerTemplate": "{character} spends {result} in total",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "items",
            "type": "item_list"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "ESTIMATION"
        ],
        "template": "Estimate: If {character} buys {items}, about how much will it cost?",
        "answerTemplate": "It will cost approximately {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "items",
            "type": "item_list"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "VALIDATION"
        ],
        "template": "{character} calculated that {items} costs {amount}. Is this correct?",
        "answerTemplate": "{validation_result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "items",
            "type": "item_list"
          },
          {
            "key": "amount",
            "type": "value"
          },
          {
            "key": "validation_result",
            "type": "boolean"
          }
        ]
      }
    ]
  }
}
# Test D.2: MULTIPLICATION at difficulty 2.4
{
  "success": true,
  "question": {
    "text": "Liam buys 2 apple at 27p each. What is the total cost?",
    "options": [
      {
        "text": "9",
        "value": 9,
        "index": 0
      },
      {
        "text": "54p",
        "value": 0.54,
        "index": 1
      },
      {
        "text": "-0.46",
        "value": -0.45999999999999996,
        "index": 2
      },
      {
        "text": "5",
        "value": 5,
        "index": 3
      }
    ],
    "correctIndex": 1,
    "format": "DIRECT_CALCULATION",
    "difficulty": {
      "year": 2,
      "subLevel": 4,
      "displayName": "2.4",
      "cognitiveLoad": 35
    },
    "cognitiveLoad": 35,
    "curriculumTags": [
      "2N1a"
    ],
    "scenario": {
      "id": "shop-002-realistic-general",
      "theme": "SHOPPING",
      "setting": {
        "location": "local shop",
        "timeContext": "after school",
        "atmosphere": "friendly"
      },
      "characters": [
        {
          "name": "Liam",
          "role": "student"
        }
      ],
      "items": [
        {
          "name": "apple",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.2,
            "max": 0.5,
            "typical": 0.35,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "banana",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.15,
            "max": 0.4,
            "typical": 0.25,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "sandwich",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 2.5,
            "max": 6,
            "typical": 4,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "drink",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.8,
            "max": 2.5,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "cake",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 1.5,
            "max": 4,
            "typical": 2.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "biscuit",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.8,
            "max": 2,
            "typical": 1.2,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "sweet",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.1,
            "max": 1,
            "typical": 0.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "chocolate",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.6,
            "max": 3,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "pen",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.5,
            "max": 2,
            "typical": 1,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "pencil",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.2,
            "max": 1,
            "typical": 0.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "ruler",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.8,
            "max": 2.5,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "notebook",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 1,
            "max": 4,
            "typical": 2,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "eraser",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.3,
            "max": 1.5,
            "typical": 0.75,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "book",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 3,
            "max": 15,
            "typical": 8,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "comic",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 2,
            "max": 5,
            "typical": 3,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "magazine",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 2.5,
            "max": 6,
            "typical": 4,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "toy",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 5,
            "max": 25,
            "typical": 12,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "game",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 8,
            "max": 60,
            "typical": 25,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "puzzle",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 5,
            "max": 20,
            "typical": 12,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "sticker",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 0.2,
            "max": 2,
            "typical": 0.8,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "badge",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 0.5,
            "max": 3,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "poster",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 2,
            "max": 8,
            "typical": 4,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "card",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 0.5,
            "max": 4,
            "typical": 2,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        }
      ],
      "culturalElements": [
        {
          "type": "currency",
          "value": "£",
          "explanation": "British pounds"
        },
        {
          "type": "location",
          "value": "UK local shop",
          "explanation": "Typical British corner shop"
        }
      ],
      "realWorldConnection": "Everyday shopping with realistic UK prices",
      "yearAppropriate": [
        1,
        2,
        3,
        4,
        5,
        6
      ],
      "templates": [
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "MULTI_STEP"
          ],
          "modelCompatibility": [
            "ADDITION"
          ],
          "operandCount": 3,
          "template": "{character} buys {article1} {item1} for {price1}, {article2} {item2} for {price2}, and {article3} {item3} for {price3}. What is the total cost?",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item1",
              "type": "item"
            },
            {
              "key": "item2",
              "type": "item"
            },
            {
              "key": "item3",
              "type": "item"
            },
            {
              "key": "price1",
              "type": "value"
            },
            {
              "key": "price2",
              "type": "value"
            },
            {
              "key": "price3",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "MULTI_STEP"
          ],
          "modelCompatibility": [
            "ADDITION"
          ],
          "operandCount": 2,
          "template": "{character} buys {article1} {item1} for {price1} and {article2} {item2} for {price2}. What is the total cost?",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item1",
              "type": "item"
            },
            {
              "key": "item2",
              "type": "item"
            },
            {
              "key": "price1",
              "type": "value"
            },
            {
              "key": "price2",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION"
          ],
          "modelCompatibility": [
            "SUBTRACTION",
            "CHANGE_CALCULATION"
          ],
          "template": "{character} buys {article} {item} for {price} and pays with {payment}. How much change does {character} get?",
          "answerTemplate": "{character} receives {result} in change",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "price",
              "type": "value"
            },
            {
              "key": "payment",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION"
          ],
          "modelCompatibility": [
            "MULTIPLICATION"
          ],
          "template": "{character} buys {quantity} {item} at {price} each. What is the total cost?",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "quantity",
              "type": "value"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "price",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION"
          ],
          "modelCompatibility": [
            "DIVISION"
          ],
          "template": "{character} has {total} to spend equally on {quantity} {item}. How much can {character} spend on each one?",
          "answerTemplate": "{character} can spend {result} on each {item}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "total",
              "type": "value"
            },
            {
              "key": "quantity",
              "type": "value"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "COMPARISON",
            "ESTIMATION",
            "MULTI_STEP"
          ],
          "template": "{character} goes to the shop and buys {items}. How much does {character} spend in total?",
          "answerTemplate": "{character} spends {result} in total",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "items",
              "type": "item_list"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "ESTIMATION"
          ],
          "template": "Estimate: If {character} buys {items}, about how much will it cost?",
          "answerTemplate": "It will cost approximately {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "items",
              "type": "item_list"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "VALIDATION"
          ],
          "template": "{character} calculated that {items} costs {amount}. Is this correct?",
          "answerTemplate": "{validation_result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "items",
              "type": "item_list"
            },
            {
              "key": "amount",
              "type": "value"
            },
            {
              "key": "validation_result",
              "type": "boolean"
            }
          ]
        }
      ]
    },
    "distractors": [
      {
        "value": -0.45999999999999996,
        "displayText": "-0.46",
        "strategy": "COMMON_MISCONCEPTION",
        "reasoning": "Counting error"
      },
      {
        "value": 9,
        "displayText": "9",
        "strategy": "WRONG_OPERATION",
        "reasoning": "Added instead of multiplying"
      },
      {
        "value": 5,
        "displayText": "5",
        "strategy": "WRONG_OPERATION",
        "reasoning": "Subtracted instead of multiplying"
      }
    ],
    "enhancementStatus": {
      "level": "partial",
      "requestedFormat": "DIRECT_CALCULATION",
      "actualFormat": "DIRECT_CALCULATION",
      "featuresActive": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "featuresPending": [],
      "isFullyEnhanced": true
    },
    "mathOutput": {
      "operation": "MULTIPLICATION",
      "multiplier": 2,
      "multiplicand": 0.27,
      "result": 0.54
    },
    "generationTime": 1,
    "questionId": "q_1759234385757_r4mass08a",
    "generationSetup": {
      "controller_used": "DIRECT_CALCULATIONController",
      "format_requested": "DIRECT_CALCULATION",
      "format_actual": "DIRECT_CALCULATION",
      "scenario_theme": "SHOPPING",
      "scenario_id": "shop-002-realistic-general",
      "scenario_selection_method": "default",
      "distractor_strategies": [
        "COMMON_MISCONCEPTION",
        "WRONG_OPERATION",
        "WRONG_OPERATION"
      ],
      "distractor_count": 3,
      "theme_variety": false,
      "format_variety": false,
      "enhancement_level": "partial",
      "features_active": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "features_pending": [],
      "generation_time_ms": 1
    }
  },
  "metadata": {
    "format": "DIRECT_CALCULATION",
    "cognitive_load": 35,
    "curriculum_alignment": [
      "2N1a"
    ],
    "difficulty": "2.4",
    "scenario_theme": "SHOPPING",
    "distractor_strategies": [
      "COMMON_MISCONCEPTION",
      "WRONG_OPERATION",
      "WRONG_OPERATION"
    ],
    "generation_time_ms": 1,
    "api_version": "2.0",
    "enhancement_status": "partial",
    "format_requested": "DIRECT_CALCULATION",
    "format_used": "DIRECT_CALCULATION",
    "features_active": [
      "enhanced_distractors",
      "rich_scenarios",
      "cognitive_load",
      "advanced_formats"
    ],
    "features_pending": []
  },
  "context": {
    "id": "shop-002-realistic-general",
    "theme": "SHOPPING",
    "setting": {
      "location": "local shop",
      "timeContext": "after school",
      "atmosphere": "friendly"
    },
    "characters": [
      {
        "name": "Liam",
        "role": "student"
      }
    ],
    "items": [
      {
        "name": "apple",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.2,
          "max": 0.5,
          "typical": 0.35,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "banana",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.15,
          "max": 0.4,
          "typical": 0.25,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "sandwich",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 2.5,
          "max": 6,
          "typical": 4,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "drink",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.8,
          "max": 2.5,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "cake",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 1.5,
          "max": 4,
          "typical": 2.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "biscuit",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.8,
          "max": 2,
          "typical": 1.2,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "sweet",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.1,
          "max": 1,
          "typical": 0.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "chocolate",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.6,
          "max": 3,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "pen",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.5,
          "max": 2,
          "typical": 1,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "pencil",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.2,
          "max": 1,
          "typical": 0.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "ruler",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.8,
          "max": 2.5,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "notebook",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 1,
          "max": 4,
          "typical": 2,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "eraser",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.3,
          "max": 1.5,
          "typical": 0.75,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "book",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 3,
          "max": 15,
          "typical": 8,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "comic",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 2,
          "max": 5,
          "typical": 3,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "magazine",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 2.5,
          "max": 6,
          "typical": 4,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "toy",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 5,
          "max": 25,
          "typical": 12,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "game",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 8,
          "max": 60,
          "typical": 25,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "puzzle",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 5,
          "max": 20,
          "typical": 12,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "sticker",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 0.2,
          "max": 2,
          "typical": 0.8,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "badge",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 0.5,
          "max": 3,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "poster",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 2,
          "max": 8,
          "typical": 4,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "card",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 0.5,
          "max": 4,
          "typical": 2,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      }
    ],
    "culturalElements": [
      {
        "type": "currency",
        "value": "£",
        "explanation": "British pounds"
      },
      {
        "type": "location",
        "value": "UK local shop",
        "explanation": "Typical British corner shop"
      }
    ],
    "realWorldConnection": "Everyday shopping with realistic UK prices",
    "yearAppropriate": [
      1,
      2,
      3,
      4,
      5,
      6
    ],
    "templates": [
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "MULTI_STEP"
        ],
        "modelCompatibility": [
          "ADDITION"
        ],
        "operandCount": 3,
        "template": "{character} buys {article1} {item1} for {price1}, {article2} {item2} for {price2}, and {article3} {item3} for {price3}. What is the total cost?",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item1",
            "type": "item"
          },
          {
            "key": "item2",
            "type": "item"
          },
          {
            "key": "item3",
            "type": "item"
          },
          {
            "key": "price1",
            "type": "value"
          },
          {
            "key": "price2",
            "type": "value"
          },
          {
            "key": "price3",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "MULTI_STEP"
        ],
        "modelCompatibility": [
          "ADDITION"
        ],
        "operandCount": 2,
        "template": "{character} buys {article1} {item1} for {price1} and {article2} {item2} for {price2}. What is the total cost?",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item1",
            "type": "item"
          },
          {
            "key": "item2",
            "type": "item"
          },
          {
            "key": "price1",
            "type": "value"
          },
          {
            "key": "price2",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION"
        ],
        "modelCompatibility": [
          "SUBTRACTION",
          "CHANGE_CALCULATION"
        ],
        "template": "{character} buys {article} {item} for {price} and pays with {payment}. How much change does {character} get?",
        "answerTemplate": "{character} receives {result} in change",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "price",
            "type": "value"
          },
          {
            "key": "payment",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION"
        ],
        "modelCompatibility": [
          "MULTIPLICATION"
        ],
        "template": "{character} buys {quantity} {item} at {price} each. What is the total cost?",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "quantity",
            "type": "value"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "price",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION"
        ],
        "modelCompatibility": [
          "DIVISION"
        ],
        "template": "{character} has {total} to spend equally on {quantity} {item}. How much can {character} spend on each one?",
        "answerTemplate": "{character} can spend {result} on each {item}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "total",
            "type": "value"
          },
          {
            "key": "quantity",
            "type": "value"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "COMPARISON",
          "ESTIMATION",
          "MULTI_STEP"
        ],
        "template": "{character} goes to the shop and buys {items}. How much does {character} spend in total?",
        "answerTemplate": "{character} spends {result} in total",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "items",
            "type": "item_list"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "ESTIMATION"
        ],
        "template": "Estimate: If {character} buys {items}, about how much will it cost?",
        "answerTemplate": "It will cost approximately {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "items",
            "type": "item_list"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "VALIDATION"
        ],
        "template": "{character} calculated that {items} costs {amount}. Is this correct?",
        "answerTemplate": "{validation_result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "items",
            "type": "item_list"
          },
          {
            "key": "amount",
            "type": "value"
          },
          {
            "key": "validation_result",
            "type": "boolean"
          }
        ]
      }
    ]
  }
}
# Test D.3: MULTIPLICATION at difficulty 3.2
{
  "success": true,
  "question": {
    "text": "Liam buys 5 apple at 47p each. What is the total cost?",
    "options": [
      {
        "text": "£2.35",
        "value": 2.35,
        "index": 0
      },
      {
        "text": "3.35",
        "value": 3.35,
        "index": 1
      },
      {
        "text": "15",
        "value": 15,
        "index": 2
      },
      {
        "text": "5",
        "value": 5,
        "index": 3
      }
    ],
    "correctIndex": 0,
    "format": "DIRECT_CALCULATION",
    "difficulty": {
      "year": 3,
      "subLevel": 2,
      "displayName": "3.2",
      "cognitiveLoad": 35
    },
    "cognitiveLoad": 35,
    "curriculumTags": [
      "3N1a"
    ],
    "scenario": {
      "id": "shop-002-realistic-general",
      "theme": "SHOPPING",
      "setting": {
        "location": "local shop",
        "timeContext": "after school",
        "atmosphere": "friendly"
      },
      "characters": [
        {
          "name": "Liam",
          "role": "student"
        }
      ],
      "items": [
        {
          "name": "apple",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.2,
            "max": 0.5,
            "typical": 0.35,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "banana",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.15,
            "max": 0.4,
            "typical": 0.25,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "sandwich",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 2.5,
            "max": 6,
            "typical": 4,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "drink",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.8,
            "max": 2.5,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "cake",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 1.5,
            "max": 4,
            "typical": 2.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "biscuit",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.8,
            "max": 2,
            "typical": 1.2,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "sweet",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.1,
            "max": 1,
            "typical": 0.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "chocolate",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.6,
            "max": 3,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "pen",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.5,
            "max": 2,
            "typical": 1,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "pencil",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.2,
            "max": 1,
            "typical": 0.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "ruler",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.8,
            "max": 2.5,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "notebook",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 1,
            "max": 4,
            "typical": 2,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "eraser",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.3,
            "max": 1.5,
            "typical": 0.75,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "book",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 3,
            "max": 15,
            "typical": 8,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "comic",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 2,
            "max": 5,
            "typical": 3,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "magazine",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 2.5,
            "max": 6,
            "typical": 4,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "toy",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 5,
            "max": 25,
            "typical": 12,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "game",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 8,
            "max": 60,
            "typical": 25,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "puzzle",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 5,
            "max": 20,
            "typical": 12,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "sticker",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 0.2,
            "max": 2,
            "typical": 0.8,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "badge",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 0.5,
            "max": 3,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "poster",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 2,
            "max": 8,
            "typical": 4,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "card",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 0.5,
            "max": 4,
            "typical": 2,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        }
      ],
      "culturalElements": [
        {
          "type": "currency",
          "value": "£",
          "explanation": "British pounds"
        },
        {
          "type": "location",
          "value": "UK local shop",
          "explanation": "Typical British corner shop"
        }
      ],
      "realWorldConnection": "Everyday shopping with realistic UK prices",
      "yearAppropriate": [
        1,
        2,
        3,
        4,
        5,
        6
      ],
      "templates": [
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "MULTI_STEP"
          ],
          "modelCompatibility": [
            "ADDITION"
          ],
          "operandCount": 3,
          "template": "{character} buys {article1} {item1} for {price1}, {article2} {item2} for {price2}, and {article3} {item3} for {price3}. What is the total cost?",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item1",
              "type": "item"
            },
            {
              "key": "item2",
              "type": "item"
            },
            {
              "key": "item3",
              "type": "item"
            },
            {
              "key": "price1",
              "type": "value"
            },
            {
              "key": "price2",
              "type": "value"
            },
            {
              "key": "price3",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "MULTI_STEP"
          ],
          "modelCompatibility": [
            "ADDITION"
          ],
          "operandCount": 2,
          "template": "{character} buys {article1} {item1} for {price1} and {article2} {item2} for {price2}. What is the total cost?",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item1",
              "type": "item"
            },
            {
              "key": "item2",
              "type": "item"
            },
            {
              "key": "price1",
              "type": "value"
            },
            {
              "key": "price2",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION"
          ],
          "modelCompatibility": [
            "SUBTRACTION",
            "CHANGE_CALCULATION"
          ],
          "template": "{character} buys {article} {item} for {price} and pays with {payment}. How much change does {character} get?",
          "answerTemplate": "{character} receives {result} in change",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "price",
              "type": "value"
            },
            {
              "key": "payment",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION"
          ],
          "modelCompatibility": [
            "MULTIPLICATION"
          ],
          "template": "{character} buys {quantity} {item} at {price} each. What is the total cost?",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "quantity",
              "type": "value"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "price",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION"
          ],
          "modelCompatibility": [
            "DIVISION"
          ],
          "template": "{character} has {total} to spend equally on {quantity} {item}. How much can {character} spend on each one?",
          "answerTemplate": "{character} can spend {result} on each {item}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "total",
              "type": "value"
            },
            {
              "key": "quantity",
              "type": "value"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "COMPARISON",
            "ESTIMATION",
            "MULTI_STEP"
          ],
          "template": "{character} goes to the shop and buys {items}. How much does {character} spend in total?",
          "answerTemplate": "{character} spends {result} in total",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "items",
              "type": "item_list"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "ESTIMATION"
          ],
          "template": "Estimate: If {character} buys {items}, about how much will it cost?",
          "answerTemplate": "It will cost approximately {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "items",
              "type": "item_list"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "VALIDATION"
          ],
          "template": "{character} calculated that {items} costs {amount}. Is this correct?",
          "answerTemplate": "{validation_result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "items",
              "type": "item_list"
            },
            {
              "key": "amount",
              "type": "value"
            },
            {
              "key": "validation_result",
              "type": "boolean"
            }
          ]
        }
      ]
    },
    "distractors": [
      {
        "value": 15,
        "displayText": "15",
        "strategy": "WRONG_OPERATION",
        "reasoning": "Added instead of multiplying"
      },
      {
        "value": 5,
        "displayText": "5",
        "strategy": "WRONG_OPERATION",
        "reasoning": "Subtracted instead of multiplying"
      },
      {
        "value": 3.35,
        "displayText": "3.35",
        "strategy": "CLOSE_VALUE",
        "reasoning": "Off by 1"
      }
    ],
    "enhancementStatus": {
      "level": "partial",
      "requestedFormat": "DIRECT_CALCULATION",
      "actualFormat": "DIRECT_CALCULATION",
      "featuresActive": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "featuresPending": [],
      "isFullyEnhanced": true
    },
    "mathOutput": {
      "operation": "MULTIPLICATION",
      "multiplier": 5,
      "multiplicand": 0.47,
      "result": 2.35
    },
    "generationTime": 0,
    "questionId": "q_1759234385803_5wrg8c8cv",
    "generationSetup": {
      "controller_used": "DIRECT_CALCULATIONController",
      "format_requested": "DIRECT_CALCULATION",
      "format_actual": "DIRECT_CALCULATION",
      "scenario_theme": "SHOPPING",
      "scenario_id": "shop-002-realistic-general",
      "scenario_selection_method": "default",
      "distractor_strategies": [
        "WRONG_OPERATION",
        "WRONG_OPERATION",
        "CLOSE_VALUE"
      ],
      "distractor_count": 3,
      "theme_variety": false,
      "format_variety": false,
      "enhancement_level": "partial",
      "features_active": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "features_pending": [],
      "generation_time_ms": 0
    }
  },
  "metadata": {
    "format": "DIRECT_CALCULATION",
    "cognitive_load": 35,
    "curriculum_alignment": [
      "3N1a"
    ],
    "difficulty": "3.2",
    "scenario_theme": "SHOPPING",
    "distractor_strategies": [
      "WRONG_OPERATION",
      "WRONG_OPERATION",
      "CLOSE_VALUE"
    ],
    "generation_time_ms": 0,
    "api_version": "2.0",
    "enhancement_status": "partial",
    "format_requested": "DIRECT_CALCULATION",
    "format_used": "DIRECT_CALCULATION",
    "features_active": [
      "enhanced_distractors",
      "rich_scenarios",
      "cognitive_load",
      "advanced_formats"
    ],
    "features_pending": []
  },
  "context": {
    "id": "shop-002-realistic-general",
    "theme": "SHOPPING",
    "setting": {
      "location": "local shop",
      "timeContext": "after school",
      "atmosphere": "friendly"
    },
    "characters": [
      {
        "name": "Liam",
        "role": "student"
      }
    ],
    "items": [
      {
        "name": "apple",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.2,
          "max": 0.5,
          "typical": 0.35,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "banana",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.15,
          "max": 0.4,
          "typical": 0.25,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "sandwich",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 2.5,
          "max": 6,
          "typical": 4,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "drink",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.8,
          "max": 2.5,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "cake",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 1.5,
          "max": 4,
          "typical": 2.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "biscuit",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.8,
          "max": 2,
          "typical": 1.2,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "sweet",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.1,
          "max": 1,
          "typical": 0.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "chocolate",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.6,
          "max": 3,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "pen",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.5,
          "max": 2,
          "typical": 1,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "pencil",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.2,
          "max": 1,
          "typical": 0.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "ruler",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.8,
          "max": 2.5,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "notebook",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 1,
          "max": 4,
          "typical": 2,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "eraser",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.3,
          "max": 1.5,
          "typical": 0.75,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "book",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 3,
          "max": 15,
          "typical": 8,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "comic",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 2,
          "max": 5,
          "typical": 3,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "magazine",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 2.5,
          "max": 6,
          "typical": 4,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "toy",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 5,
          "max": 25,
          "typical": 12,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "game",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 8,
          "max": 60,
          "typical": 25,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "puzzle",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 5,
          "max": 20,
          "typical": 12,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "sticker",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 0.2,
          "max": 2,
          "typical": 0.8,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "badge",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 0.5,
          "max": 3,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "poster",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 2,
          "max": 8,
          "typical": 4,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "card",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 0.5,
          "max": 4,
          "typical": 2,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      }
    ],
    "culturalElements": [
      {
        "type": "currency",
        "value": "£",
        "explanation": "British pounds"
      },
      {
        "type": "location",
        "value": "UK local shop",
        "explanation": "Typical British corner shop"
      }
    ],
    "realWorldConnection": "Everyday shopping with realistic UK prices",
    "yearAppropriate": [
      1,
      2,
      3,
      4,
      5,
      6
    ],
    "templates": [
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "MULTI_STEP"
        ],
        "modelCompatibility": [
          "ADDITION"
        ],
        "operandCount": 3,
        "template": "{character} buys {article1} {item1} for {price1}, {article2} {item2} for {price2}, and {article3} {item3} for {price3}. What is the total cost?",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item1",
            "type": "item"
          },
          {
            "key": "item2",
            "type": "item"
          },
          {
            "key": "item3",
            "type": "item"
          },
          {
            "key": "price1",
            "type": "value"
          },
          {
            "key": "price2",
            "type": "value"
          },
          {
            "key": "price3",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "MULTI_STEP"
        ],
        "modelCompatibility": [
          "ADDITION"
        ],
        "operandCount": 2,
        "template": "{character} buys {article1} {item1} for {price1} and {article2} {item2} for {price2}. What is the total cost?",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item1",
            "type": "item"
          },
          {
            "key": "item2",
            "type": "item"
          },
          {
            "key": "price1",
            "type": "value"
          },
          {
            "key": "price2",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION"
        ],
        "modelCompatibility": [
          "SUBTRACTION",
          "CHANGE_CALCULATION"
        ],
        "template": "{character} buys {article} {item} for {price} and pays with {payment}. How much change does {character} get?",
        "answerTemplate": "{character} receives {result} in change",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "price",
            "type": "value"
          },
          {
            "key": "payment",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION"
        ],
        "modelCompatibility": [
          "MULTIPLICATION"
        ],
        "template": "{character} buys {quantity} {item} at {price} each. What is the total cost?",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "quantity",
            "type": "value"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "price",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION"
        ],
        "modelCompatibility": [
          "DIVISION"
        ],
        "template": "{character} has {total} to spend equally on {quantity} {item}. How much can {character} spend on each one?",
        "answerTemplate": "{character} can spend {result} on each {item}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "total",
            "type": "value"
          },
          {
            "key": "quantity",
            "type": "value"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "COMPARISON",
          "ESTIMATION",
          "MULTI_STEP"
        ],
        "template": "{character} goes to the shop and buys {items}. How much does {character} spend in total?",
        "answerTemplate": "{character} spends {result} in total",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "items",
            "type": "item_list"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "ESTIMATION"
        ],
        "template": "Estimate: If {character} buys {items}, about how much will it cost?",
        "answerTemplate": "It will cost approximately {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "items",
            "type": "item_list"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "VALIDATION"
        ],
        "template": "{character} calculated that {items} costs {amount}. Is this correct?",
        "answerTemplate": "{validation_result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "items",
            "type": "item_list"
          },
          {
            "key": "amount",
            "type": "value"
          },
          {
            "key": "validation_result",
            "type": "boolean"
          }
        ]
      }
    ]
  }
}
# Test D.4: MULTIPLICATION at difficulty 4.1
{
  "success": true,
  "question": {
    "text": "Liam buys 1 apple at 32p each. What is the total cost?",
    "options": [
      {
        "text": "9",
        "value": 9,
        "index": 0
      },
      {
        "text": "32p",
        "value": 0.32,
        "index": 1
      },
      {
        "text": "11",
        "value": 11,
        "index": 2
      },
      {
        "text": "1.32",
        "value": 1.32,
        "index": 3
      }
    ],
    "correctIndex": 1,
    "format": "DIRECT_CALCULATION",
    "difficulty": {
      "year": 4,
      "subLevel": 1,
      "displayName": "4.1",
      "cognitiveLoad": 40
    },
    "cognitiveLoad": 40,
    "curriculumTags": [
      "4N1a"
    ],
    "scenario": {
      "id": "shop-002-realistic-general",
      "theme": "SHOPPING",
      "setting": {
        "location": "local shop",
        "timeContext": "after school",
        "atmosphere": "friendly"
      },
      "characters": [
        {
          "name": "Liam",
          "role": "student"
        }
      ],
      "items": [
        {
          "name": "apple",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.2,
            "max": 0.5,
            "typical": 0.35,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "banana",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.15,
            "max": 0.4,
            "typical": 0.25,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "sandwich",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 2.5,
            "max": 6,
            "typical": 4,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "drink",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.8,
            "max": 2.5,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "cake",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 1.5,
            "max": 4,
            "typical": 2.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "biscuit",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.8,
            "max": 2,
            "typical": 1.2,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "sweet",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.1,
            "max": 1,
            "typical": 0.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "chocolate",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.6,
            "max": 3,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "pen",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.5,
            "max": 2,
            "typical": 1,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "pencil",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.2,
            "max": 1,
            "typical": 0.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "ruler",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.8,
            "max": 2.5,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "notebook",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 1,
            "max": 4,
            "typical": 2,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "eraser",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.3,
            "max": 1.5,
            "typical": 0.75,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "book",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 3,
            "max": 15,
            "typical": 8,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "comic",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 2,
            "max": 5,
            "typical": 3,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "magazine",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 2.5,
            "max": 6,
            "typical": 4,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "toy",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 5,
            "max": 25,
            "typical": 12,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "game",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 8,
            "max": 60,
            "typical": 25,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "puzzle",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 5,
            "max": 20,
            "typical": 12,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "sticker",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 0.2,
            "max": 2,
            "typical": 0.8,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "badge",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 0.5,
            "max": 3,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "poster",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 2,
            "max": 8,
            "typical": 4,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "card",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 0.5,
            "max": 4,
            "typical": 2,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        }
      ],
      "culturalElements": [
        {
          "type": "currency",
          "value": "£",
          "explanation": "British pounds"
        },
        {
          "type": "location",
          "value": "UK local shop",
          "explanation": "Typical British corner shop"
        }
      ],
      "realWorldConnection": "Everyday shopping with realistic UK prices",
      "yearAppropriate": [
        1,
        2,
        3,
        4,
        5,
        6
      ],
      "templates": [
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "MULTI_STEP"
          ],
          "modelCompatibility": [
            "ADDITION"
          ],
          "operandCount": 3,
          "template": "{character} buys {article1} {item1} for {price1}, {article2} {item2} for {price2}, and {article3} {item3} for {price3}. What is the total cost?",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item1",
              "type": "item"
            },
            {
              "key": "item2",
              "type": "item"
            },
            {
              "key": "item3",
              "type": "item"
            },
            {
              "key": "price1",
              "type": "value"
            },
            {
              "key": "price2",
              "type": "value"
            },
            {
              "key": "price3",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "MULTI_STEP"
          ],
          "modelCompatibility": [
            "ADDITION"
          ],
          "operandCount": 2,
          "template": "{character} buys {article1} {item1} for {price1} and {article2} {item2} for {price2}. What is the total cost?",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item1",
              "type": "item"
            },
            {
              "key": "item2",
              "type": "item"
            },
            {
              "key": "price1",
              "type": "value"
            },
            {
              "key": "price2",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION"
          ],
          "modelCompatibility": [
            "SUBTRACTION",
            "CHANGE_CALCULATION"
          ],
          "template": "{character} buys {article} {item} for {price} and pays with {payment}. How much change does {character} get?",
          "answerTemplate": "{character} receives {result} in change",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "price",
              "type": "value"
            },
            {
              "key": "payment",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION"
          ],
          "modelCompatibility": [
            "MULTIPLICATION"
          ],
          "template": "{character} buys {quantity} {item} at {price} each. What is the total cost?",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "quantity",
              "type": "value"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "price",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION"
          ],
          "modelCompatibility": [
            "DIVISION"
          ],
          "template": "{character} has {total} to spend equally on {quantity} {item}. How much can {character} spend on each one?",
          "answerTemplate": "{character} can spend {result} on each {item}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "total",
              "type": "value"
            },
            {
              "key": "quantity",
              "type": "value"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "COMPARISON",
            "ESTIMATION",
            "MULTI_STEP"
          ],
          "template": "{character} goes to the shop and buys {items}. How much does {character} spend in total?",
          "answerTemplate": "{character} spends {result} in total",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "items",
              "type": "item_list"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "ESTIMATION"
          ],
          "template": "Estimate: If {character} buys {items}, about how much will it cost?",
          "answerTemplate": "It will cost approximately {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "items",
              "type": "item_list"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "VALIDATION"
          ],
          "template": "{character} calculated that {items} costs {amount}. Is this correct?",
          "answerTemplate": "{validation_result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "items",
              "type": "item_list"
            },
            {
              "key": "amount",
              "type": "value"
            },
            {
              "key": "validation_result",
              "type": "boolean"
            }
          ]
        }
      ]
    },
    "distractors": [
      {
        "value": 11,
        "displayText": "11",
        "strategy": "WRONG_OPERATION",
        "reasoning": "Added instead of multiplying"
      },
      {
        "value": 9,
        "displayText": "9",
        "strategy": "WRONG_OPERATION",
        "reasoning": "Subtracted instead of multiplying"
      },
      {
        "value": 1.32,
        "displayText": "1.32",
        "strategy": "CLOSE_VALUE",
        "reasoning": "Off by 1"
      }
    ],
    "enhancementStatus": {
      "level": "partial",
      "requestedFormat": "DIRECT_CALCULATION",
      "actualFormat": "DIRECT_CALCULATION",
      "featuresActive": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "featuresPending": [],
      "isFullyEnhanced": true
    },
    "mathOutput": {
      "operation": "MULTIPLICATION",
      "multiplier": 1,
      "multiplicand": 0.32,
      "result": 0.32
    },
    "generationTime": 0,
    "questionId": "q_1759234385854_dhp9twyqa",
    "generationSetup": {
      "controller_used": "DIRECT_CALCULATIONController",
      "format_requested": "DIRECT_CALCULATION",
      "format_actual": "DIRECT_CALCULATION",
      "scenario_theme": "SHOPPING",
      "scenario_id": "shop-002-realistic-general",
      "scenario_selection_method": "default",
      "distractor_strategies": [
        "WRONG_OPERATION",
        "WRONG_OPERATION",
        "CLOSE_VALUE"
      ],
      "distractor_count": 3,
      "theme_variety": false,
      "format_variety": false,
      "enhancement_level": "partial",
      "features_active": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "features_pending": [],
      "generation_time_ms": 0
    }
  },
  "metadata": {
    "format": "DIRECT_CALCULATION",
    "cognitive_load": 40,
    "curriculum_alignment": [
      "4N1a"
    ],
    "difficulty": "4.1",
    "scenario_theme": "SHOPPING",
    "distractor_strategies": [
      "WRONG_OPERATION",
      "WRONG_OPERATION",
      "CLOSE_VALUE"
    ],
    "generation_time_ms": 0,
    "api_version": "2.0",
    "enhancement_status": "partial",
    "format_requested": "DIRECT_CALCULATION",
    "format_used": "DIRECT_CALCULATION",
    "features_active": [
      "enhanced_distractors",
      "rich_scenarios",
      "cognitive_load",
      "advanced_formats"
    ],
    "features_pending": []
  },
  "context": {
    "id": "shop-002-realistic-general",
    "theme": "SHOPPING",
    "setting": {
      "location": "local shop",
      "timeContext": "after school",
      "atmosphere": "friendly"
    },
    "characters": [
      {
        "name": "Liam",
        "role": "student"
      }
    ],
    "items": [
      {
        "name": "apple",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.2,
          "max": 0.5,
          "typical": 0.35,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "banana",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.15,
          "max": 0.4,
          "typical": 0.25,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "sandwich",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 2.5,
          "max": 6,
          "typical": 4,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "drink",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.8,
          "max": 2.5,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "cake",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 1.5,
          "max": 4,
          "typical": 2.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "biscuit",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.8,
          "max": 2,
          "typical": 1.2,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "sweet",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.1,
          "max": 1,
          "typical": 0.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "chocolate",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.6,
          "max": 3,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "pen",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.5,
          "max": 2,
          "typical": 1,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "pencil",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.2,
          "max": 1,
          "typical": 0.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "ruler",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.8,
          "max": 2.5,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "notebook",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 1,
          "max": 4,
          "typical": 2,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "eraser",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.3,
          "max": 1.5,
          "typical": 0.75,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "book",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 3,
          "max": 15,
          "typical": 8,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "comic",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 2,
          "max": 5,
          "typical": 3,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "magazine",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 2.5,
          "max": 6,
          "typical": 4,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "toy",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 5,
          "max": 25,
          "typical": 12,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "game",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 8,
          "max": 60,
          "typical": 25,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "puzzle",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 5,
          "max": 20,
          "typical": 12,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "sticker",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 0.2,
          "max": 2,
          "typical": 0.8,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "badge",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 0.5,
          "max": 3,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "poster",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 2,
          "max": 8,
          "typical": 4,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "card",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 0.5,
          "max": 4,
          "typical": 2,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      }
    ],
    "culturalElements": [
      {
        "type": "currency",
        "value": "£",
        "explanation": "British pounds"
      },
      {
        "type": "location",
        "value": "UK local shop",
        "explanation": "Typical British corner shop"
      }
    ],
    "realWorldConnection": "Everyday shopping with realistic UK prices",
    "yearAppropriate": [
      1,
      2,
      3,
      4,
      5,
      6
    ],
    "templates": [
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "MULTI_STEP"
        ],
        "modelCompatibility": [
          "ADDITION"
        ],
        "operandCount": 3,
        "template": "{character} buys {article1} {item1} for {price1}, {article2} {item2} for {price2}, and {article3} {item3} for {price3}. What is the total cost?",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item1",
            "type": "item"
          },
          {
            "key": "item2",
            "type": "item"
          },
          {
            "key": "item3",
            "type": "item"
          },
          {
            "key": "price1",
            "type": "value"
          },
          {
            "key": "price2",
            "type": "value"
          },
          {
            "key": "price3",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "MULTI_STEP"
        ],
        "modelCompatibility": [
          "ADDITION"
        ],
        "operandCount": 2,
        "template": "{character} buys {article1} {item1} for {price1} and {article2} {item2} for {price2}. What is the total cost?",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item1",
            "type": "item"
          },
          {
            "key": "item2",
            "type": "item"
          },
          {
            "key": "price1",
            "type": "value"
          },
          {
            "key": "price2",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION"
        ],
        "modelCompatibility": [
          "SUBTRACTION",
          "CHANGE_CALCULATION"
        ],
        "template": "{character} buys {article} {item} for {price} and pays with {payment}. How much change does {character} get?",
        "answerTemplate": "{character} receives {result} in change",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "price",
            "type": "value"
          },
          {
            "key": "payment",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION"
        ],
        "modelCompatibility": [
          "MULTIPLICATION"
        ],
        "template": "{character} buys {quantity} {item} at {price} each. What is the total cost?",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "quantity",
            "type": "value"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "price",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION"
        ],
        "modelCompatibility": [
          "DIVISION"
        ],
        "template": "{character} has {total} to spend equally on {quantity} {item}. How much can {character} spend on each one?",
        "answerTemplate": "{character} can spend {result} on each {item}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "total",
            "type": "value"
          },
          {
            "key": "quantity",
            "type": "value"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "COMPARISON",
          "ESTIMATION",
          "MULTI_STEP"
        ],
        "template": "{character} goes to the shop and buys {items}. How much does {character} spend in total?",
        "answerTemplate": "{character} spends {result} in total",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "items",
            "type": "item_list"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "ESTIMATION"
        ],
        "template": "Estimate: If {character} buys {items}, about how much will it cost?",
        "answerTemplate": "It will cost approximately {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "items",
            "type": "item_list"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "VALIDATION"
        ],
        "template": "{character} calculated that {items} costs {amount}. Is this correct?",
        "answerTemplate": "{validation_result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "items",
            "type": "item_list"
          },
          {
            "key": "amount",
            "type": "value"
          },
          {
            "key": "validation_result",
            "type": "boolean"
          }
        ]
      }
    ]
  }
}
# Test D.5: MULTIPLICATION at difficulty 5.3
{
  "success": true,
  "question": {
    "text": "Liam showed their working:\\n66 × 68\\n= 134\\n\\nIs this working correct?",
    "options": [
      {
        "text": "Incorrect",
        "value": 0,
        "index": 0
      },
      {
        "text": "Incorrect",
        "value": 0,
        "index": 1
      }
    ],
    "correctIndex": 0,
    "questionContent": {
      "fullText": "Liam showed their working:\\n66 × 68\\n= 134\\n\\nIs this working correct?"
    },
    "format": "VALIDATION",
    "difficulty": {
      "year": 5,
      "subLevel": 3,
      "displayName": "5.3",
      "cognitiveLoad": 60
    },
    "cognitiveLoad": 60,
    "curriculumTags": [
      "5N1a"
    ],
    "scenario": {
      "id": "shop-002-realistic-general",
      "theme": "SHOPPING",
      "setting": {
        "location": "local shop",
        "timeContext": "after school",
        "atmosphere": "friendly"
      },
      "characters": [
        {
          "name": "Liam",
          "role": "student"
        }
      ],
      "items": [
        {
          "name": "apple",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.2,
            "max": 0.5,
            "typical": 0.35,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "banana",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.15,
            "max": 0.4,
            "typical": 0.25,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "sandwich",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 2.5,
            "max": 6,
            "typical": 4,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "drink",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.8,
            "max": 2.5,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "cake",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 1.5,
            "max": 4,
            "typical": 2.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "biscuit",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.8,
            "max": 2,
            "typical": 1.2,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "sweet",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.1,
            "max": 1,
            "typical": 0.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "chocolate",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.6,
            "max": 3,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "pen",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.5,
            "max": 2,
            "typical": 1,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "pencil",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.2,
            "max": 1,
            "typical": 0.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "ruler",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.8,
            "max": 2.5,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "notebook",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 1,
            "max": 4,
            "typical": 2,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "eraser",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.3,
            "max": 1.5,
            "typical": 0.75,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "book",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 3,
            "max": 15,
            "typical": 8,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "comic",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 2,
            "max": 5,
            "typical": 3,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "magazine",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 2.5,
            "max": 6,
            "typical": 4,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "toy",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 5,
            "max": 25,
            "typical": 12,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "game",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 8,
            "max": 60,
            "typical": 25,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "puzzle",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 5,
            "max": 20,
            "typical": 12,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "sticker",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 0.2,
            "max": 2,
            "typical": 0.8,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "badge",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 0.5,
            "max": 3,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "poster",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 2,
            "max": 8,
            "typical": 4,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "card",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 0.5,
            "max": 4,
            "typical": 2,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        }
      ],
      "culturalElements": [
        {
          "type": "currency",
          "value": "£",
          "explanation": "British pounds"
        },
        {
          "type": "location",
          "value": "UK local shop",
          "explanation": "Typical British corner shop"
        }
      ],
      "realWorldConnection": "Everyday shopping with realistic UK prices",
      "yearAppropriate": [
        1,
        2,
        3,
        4,
        5,
        6
      ],
      "templates": [
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "MULTI_STEP"
          ],
          "modelCompatibility": [
            "ADDITION"
          ],
          "operandCount": 3,
          "template": "{character} buys {article1} {item1} for {price1}, {article2} {item2} for {price2}, and {article3} {item3} for {price3}. What is the total cost?",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item1",
              "type": "item"
            },
            {
              "key": "item2",
              "type": "item"
            },
            {
              "key": "item3",
              "type": "item"
            },
            {
              "key": "price1",
              "type": "value"
            },
            {
              "key": "price2",
              "type": "value"
            },
            {
              "key": "price3",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "MULTI_STEP"
          ],
          "modelCompatibility": [
            "ADDITION"
          ],
          "operandCount": 2,
          "template": "{character} buys {article1} {item1} for {price1} and {article2} {item2} for {price2}. What is the total cost?",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item1",
              "type": "item"
            },
            {
              "key": "item2",
              "type": "item"
            },
            {
              "key": "price1",
              "type": "value"
            },
            {
              "key": "price2",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION"
          ],
          "modelCompatibility": [
            "SUBTRACTION",
            "CHANGE_CALCULATION"
          ],
          "template": "{character} buys {article} {item} for {price} and pays with {payment}. How much change does {character} get?",
          "answerTemplate": "{character} receives {result} in change",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "price",
              "type": "value"
            },
            {
              "key": "payment",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION"
          ],
          "modelCompatibility": [
            "MULTIPLICATION"
          ],
          "template": "{character} buys {quantity} {item} at {price} each. What is the total cost?",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "quantity",
              "type": "value"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "price",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION"
          ],
          "modelCompatibility": [
            "DIVISION"
          ],
          "template": "{character} has {total} to spend equally on {quantity} {item}. How much can {character} spend on each one?",
          "answerTemplate": "{character} can spend {result} on each {item}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "total",
              "type": "value"
            },
            {
              "key": "quantity",
              "type": "value"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "COMPARISON",
            "ESTIMATION",
            "MULTI_STEP"
          ],
          "template": "{character} goes to the shop and buys {items}. How much does {character} spend in total?",
          "answerTemplate": "{character} spends {result} in total",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "items",
              "type": "item_list"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "ESTIMATION"
          ],
          "template": "Estimate: If {character} buys {items}, about how much will it cost?",
          "answerTemplate": "It will cost approximately {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "items",
              "type": "item_list"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "VALIDATION"
          ],
          "template": "{character} calculated that {items} costs {amount}. Is this correct?",
          "answerTemplate": "{validation_result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "items",
              "type": "item_list"
            },
            {
              "key": "amount",
              "type": "value"
            },
            {
              "key": "validation_result",
              "type": "boolean"
            }
          ]
        }
      ]
    },
    "distractors": [
      {
        "value": 0,
        "displayText": "Incorrect",
        "reasoning": "Incorrectly identified correct work as wrong"
      }
    ],
    "enhancementStatus": {
      "level": "full",
      "requestedFormat": "VALIDATION",
      "actualFormat": "VALIDATION",
      "featuresActive": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "featuresPending": [],
      "isFullyEnhanced": true
    },
    "mathOutput": {
      "operation": "MULTIPLICATION",
      "multiplicand": 66,
      "multiplier": 68,
      "result": 4488,
      "factors": [
        66,
        68
      ],
      "decimal_formatted": {
        "operands": [
          "66",
          "68"
        ],
        "result": "4488"
      }
    },
    "generationTime": 0,
    "questionId": "q_1759234385897_staj2vmtf",
    "generationSetup": {
      "controller_used": "VALIDATIONController",
      "format_requested": "VALIDATION",
      "format_actual": "VALIDATION",
      "scenario_theme": "SHOPPING",
      "scenario_id": "shop-002-realistic-general",
      "scenario_selection_method": "default",
      "distractor_strategies": [
        null
      ],
      "distractor_count": 1,
      "theme_variety": false,
      "format_variety": false,
      "enhancement_level": "full",
      "features_active": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "features_pending": [],
      "generation_time_ms": 0
    }
  },
  "metadata": {
    "format": "VALIDATION",
    "cognitive_load": 60,
    "curriculum_alignment": [
      "5N1a"
    ],
    "difficulty": "5.3",
    "scenario_theme": "SHOPPING",
    "distractor_strategies": [
      null
    ],
    "generation_time_ms": 0,
    "api_version": "2.0",
    "enhancement_status": "full",
    "format_requested": "VALIDATION",
    "format_used": "VALIDATION",
    "features_active": [
      "enhanced_distractors",
      "rich_scenarios",
      "cognitive_load",
      "advanced_formats"
    ],
    "features_pending": []
  },
  "context": {
    "id": "shop-002-realistic-general",
    "theme": "SHOPPING",
    "setting": {
      "location": "local shop",
      "timeContext": "after school",
      "atmosphere": "friendly"
    },
    "characters": [
      {
        "name": "Liam",
        "role": "student"
      }
    ],
    "items": [
      {
        "name": "apple",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.2,
          "max": 0.5,
          "typical": 0.35,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "banana",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.15,
          "max": 0.4,
          "typical": 0.25,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "sandwich",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 2.5,
          "max": 6,
          "typical": 4,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "drink",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.8,
          "max": 2.5,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "cake",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 1.5,
          "max": 4,
          "typical": 2.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "biscuit",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.8,
          "max": 2,
          "typical": 1.2,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "sweet",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.1,
          "max": 1,
          "typical": 0.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "chocolate",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.6,
          "max": 3,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "pen",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.5,
          "max": 2,
          "typical": 1,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "pencil",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.2,
          "max": 1,
          "typical": 0.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "ruler",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.8,
          "max": 2.5,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "notebook",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 1,
          "max": 4,
          "typical": 2,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "eraser",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.3,
          "max": 1.5,
          "typical": 0.75,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "book",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 3,
          "max": 15,
          "typical": 8,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "comic",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 2,
          "max": 5,
          "typical": 3,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "magazine",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 2.5,
          "max": 6,
          "typical": 4,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "toy",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 5,
          "max": 25,
          "typical": 12,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "game",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 8,
          "max": 60,
          "typical": 25,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "puzzle",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 5,
          "max": 20,
          "typical": 12,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "sticker",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 0.2,
          "max": 2,
          "typical": 0.8,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "badge",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 0.5,
          "max": 3,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "poster",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 2,
          "max": 8,
          "typical": 4,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "card",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 0.5,
          "max": 4,
          "typical": 2,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      }
    ],
    "culturalElements": [
      {
        "type": "currency",
        "value": "£",
        "explanation": "British pounds"
      },
      {
        "type": "location",
        "value": "UK local shop",
        "explanation": "Typical British corner shop"
      }
    ],
    "realWorldConnection": "Everyday shopping with realistic UK prices",
    "yearAppropriate": [
      1,
      2,
      3,
      4,
      5,
      6
    ],
    "templates": [
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "MULTI_STEP"
        ],
        "modelCompatibility": [
          "ADDITION"
        ],
        "operandCount": 3,
        "template": "{character} buys {article1} {item1} for {price1}, {article2} {item2} for {price2}, and {article3} {item3} for {price3}. What is the total cost?",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item1",
            "type": "item"
          },
          {
            "key": "item2",
            "type": "item"
          },
          {
            "key": "item3",
            "type": "item"
          },
          {
            "key": "price1",
            "type": "value"
          },
          {
            "key": "price2",
            "type": "value"
          },
          {
            "key": "price3",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "MULTI_STEP"
        ],
        "modelCompatibility": [
          "ADDITION"
        ],
        "operandCount": 2,
        "template": "{character} buys {article1} {item1} for {price1} and {article2} {item2} for {price2}. What is the total cost?",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item1",
            "type": "item"
          },
          {
            "key": "item2",
            "type": "item"
          },
          {
            "key": "price1",
            "type": "value"
          },
          {
            "key": "price2",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION"
        ],
        "modelCompatibility": [
          "SUBTRACTION",
          "CHANGE_CALCULATION"
        ],
        "template": "{character} buys {article} {item} for {price} and pays with {payment}. How much change does {character} get?",
        "answerTemplate": "{character} receives {result} in change",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "price",
            "type": "value"
          },
          {
            "key": "payment",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION"
        ],
        "modelCompatibility": [
          "MULTIPLICATION"
        ],
        "template": "{character} buys {quantity} {item} at {price} each. What is the total cost?",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "quantity",
            "type": "value"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "price",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION"
        ],
        "modelCompatibility": [
          "DIVISION"
        ],
        "template": "{character} has {total} to spend equally on {quantity} {item}. How much can {character} spend on each one?",
        "answerTemplate": "{character} can spend {result} on each {item}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "total",
            "type": "value"
          },
          {
            "key": "quantity",
            "type": "value"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "COMPARISON",
          "ESTIMATION",
          "MULTI_STEP"
        ],
        "template": "{character} goes to the shop and buys {items}. How much does {character} spend in total?",
        "answerTemplate": "{character} spends {result} in total",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "items",
            "type": "item_list"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "ESTIMATION"
        ],
        "template": "Estimate: If {character} buys {items}, about how much will it cost?",
        "answerTemplate": "It will cost approximately {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "items",
            "type": "item_list"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "VALIDATION"
        ],
        "template": "{character} calculated that {items} costs {amount}. Is this correct?",
        "answerTemplate": "{validation_result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "items",
            "type": "item_list"
          },
          {
            "key": "amount",
            "type": "value"
          },
          {
            "key": "validation_result",
            "type": "boolean"
          }
        ]
      }
    ]
  }
}
# Test D.6: MULTIPLICATION at difficulty 6.4
{
  "success": true,
  "question": {
    "text": "Liam is multiplying £571.00 × 126. Round the result to the nearest hundreds.",
    "options": [
      {
        "text": "215800",
        "value": 215800,
        "index": 0
      },
      {
        "text": "215840",
        "value": 215840,
        "index": 1
      },
      {
        "text": "215900",
        "value": 215900,
        "index": 2
      },
      {
        "text": "£215800.00",
        "value": 215800,
        "index": 3
      }
    ],
    "correctIndex": 0,
    "questionContent": {
      "fullText": "Liam is multiplying £571.00 × 126. Round the result to the nearest hundreds.",
      "templateData": {
        "character": "Liam",
        "operation": "is multiplying £571.00 × 126",
        "roundingPlace": "hundreds",
        "exactValue": "215838",
        "roundedValue": "215800"
      }
    },
    "format": "ESTIMATION",
    "difficulty": {
      "year": 6,
      "subLevel": 4,
      "displayName": "6.4",
      "cognitiveLoad": 75
    },
    "cognitiveLoad": 75,
    "curriculumTags": [
      "6N1a"
    ],
    "scenario": {
      "id": "shop-002-realistic-general",
      "theme": "SHOPPING",
      "setting": {
        "location": "local shop",
        "timeContext": "after school",
        "atmosphere": "friendly"
      },
      "characters": [
        {
          "name": "Liam",
          "role": "student"
        }
      ],
      "items": [
        {
          "name": "apple",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.2,
            "max": 0.5,
            "typical": 0.35,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "banana",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.15,
            "max": 0.4,
            "typical": 0.25,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "sandwich",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 2.5,
            "max": 6,
            "typical": 4,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "drink",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.8,
            "max": 2.5,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "cake",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 1.5,
            "max": 4,
            "typical": 2.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "biscuit",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.8,
            "max": 2,
            "typical": 1.2,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "sweet",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.1,
            "max": 1,
            "typical": 0.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "chocolate",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.6,
            "max": 3,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "pen",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.5,
            "max": 2,
            "typical": 1,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "pencil",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.2,
            "max": 1,
            "typical": 0.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "ruler",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.8,
            "max": 2.5,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "notebook",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 1,
            "max": 4,
            "typical": 2,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "eraser",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.3,
            "max": 1.5,
            "typical": 0.75,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "book",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 3,
            "max": 15,
            "typical": 8,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "comic",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 2,
            "max": 5,
            "typical": 3,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "magazine",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 2.5,
            "max": 6,
            "typical": 4,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "toy",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 5,
            "max": 25,
            "typical": 12,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "game",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 8,
            "max": 60,
            "typical": 25,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "puzzle",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 5,
            "max": 20,
            "typical": 12,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "sticker",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 0.2,
            "max": 2,
            "typical": 0.8,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "badge",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 0.5,
            "max": 3,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "poster",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 2,
            "max": 8,
            "typical": 4,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "card",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 0.5,
            "max": 4,
            "typical": 2,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        }
      ],
      "culturalElements": [
        {
          "type": "currency",
          "value": "£",
          "explanation": "British pounds"
        },
        {
          "type": "location",
          "value": "UK local shop",
          "explanation": "Typical British corner shop"
        }
      ],
      "realWorldConnection": "Everyday shopping with realistic UK prices",
      "yearAppropriate": [
        1,
        2,
        3,
        4,
        5,
        6
      ],
      "templates": [
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "MULTI_STEP"
          ],
          "modelCompatibility": [
            "ADDITION"
          ],
          "operandCount": 3,
          "template": "{character} buys {article1} {item1} for {price1}, {article2} {item2} for {price2}, and {article3} {item3} for {price3}. What is the total cost?",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item1",
              "type": "item"
            },
            {
              "key": "item2",
              "type": "item"
            },
            {
              "key": "item3",
              "type": "item"
            },
            {
              "key": "price1",
              "type": "value"
            },
            {
              "key": "price2",
              "type": "value"
            },
            {
              "key": "price3",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "MULTI_STEP"
          ],
          "modelCompatibility": [
            "ADDITION"
          ],
          "operandCount": 2,
          "template": "{character} buys {article1} {item1} for {price1} and {article2} {item2} for {price2}. What is the total cost?",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item1",
              "type": "item"
            },
            {
              "key": "item2",
              "type": "item"
            },
            {
              "key": "price1",
              "type": "value"
            },
            {
              "key": "price2",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION"
          ],
          "modelCompatibility": [
            "SUBTRACTION",
            "CHANGE_CALCULATION"
          ],
          "template": "{character} buys {article} {item} for {price} and pays with {payment}. How much change does {character} get?",
          "answerTemplate": "{character} receives {result} in change",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "price",
              "type": "value"
            },
            {
              "key": "payment",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION"
          ],
          "modelCompatibility": [
            "MULTIPLICATION"
          ],
          "template": "{character} buys {quantity} {item} at {price} each. What is the total cost?",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "quantity",
              "type": "value"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "price",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION"
          ],
          "modelCompatibility": [
            "DIVISION"
          ],
          "template": "{character} has {total} to spend equally on {quantity} {item}. How much can {character} spend on each one?",
          "answerTemplate": "{character} can spend {result} on each {item}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "total",
              "type": "value"
            },
            {
              "key": "quantity",
              "type": "value"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "COMPARISON",
            "ESTIMATION",
            "MULTI_STEP"
          ],
          "template": "{character} goes to the shop and buys {items}. How much does {character} spend in total?",
          "answerTemplate": "{character} spends {result} in total",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "items",
              "type": "item_list"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "ESTIMATION"
          ],
          "template": "Estimate: If {character} buys {items}, about how much will it cost?",
          "answerTemplate": "It will cost approximately {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "items",
              "type": "item_list"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "VALIDATION"
          ],
          "template": "{character} calculated that {items} costs {amount}. Is this correct?",
          "answerTemplate": "{validation_result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "items",
              "type": "item_list"
            },
            {
              "key": "amount",
              "type": "value"
            },
            {
              "key": "validation_result",
              "type": "boolean"
            }
          ]
        }
      ]
    },
    "distractors": [
      {
        "value": 215840,
        "strategy": "WRONG_OPERATION",
        "rationale": "Rounded to wrong place value"
      },
      {
        "value": 215800,
        "rationale": "Truncated instead of rounded"
      },
      {
        "value": 215900,
        "rationale": "Always rounded up"
      }
    ],
    "enhancementStatus": {
      "level": "full",
      "requestedFormat": "ESTIMATION",
      "actualFormat": "ESTIMATION",
      "featuresActive": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "featuresPending": [],
      "isFullyEnhanced": true
    },
    "mathOutput": {
      "operation": "MULTIPLICATION",
      "multiplicand": 571,
      "multiplier": 126,
      "result": 215838,
      "factors": [
        571,
        126,
        3
      ],
      "decimal_formatted": {
        "operands": [
          "571",
          "126",
          "3"
        ],
        "result": "215838"
      },
      "exactValue": 215838,
      "roundedValue": 215800
    },
    "generationTime": 1,
    "questionId": "q_1759234385945_axu3nwf96",
    "generationSetup": {
      "controller_used": "ESTIMATIONController",
      "format_requested": "ESTIMATION",
      "format_actual": "ESTIMATION",
      "scenario_theme": "SHOPPING",
      "scenario_id": "shop-002-realistic-general",
      "scenario_selection_method": "default",
      "distractor_strategies": [
        "WRONG_OPERATION",
        null,
        null
      ],
      "distractor_count": 3,
      "theme_variety": false,
      "format_variety": false,
      "enhancement_level": "full",
      "features_active": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "features_pending": [],
      "generation_time_ms": 1
    }
  },
  "metadata": {
    "format": "ESTIMATION",
    "cognitive_load": 75,
    "curriculum_alignment": [
      "6N1a"
    ],
    "difficulty": "6.4",
    "scenario_theme": "SHOPPING",
    "distractor_strategies": [
      "WRONG_OPERATION",
      null,
      null
    ],
    "generation_time_ms": 1,
    "api_version": "2.0",
    "enhancement_status": "full",
    "format_requested": "ESTIMATION",
    "format_used": "ESTIMATION",
    "features_active": [
      "enhanced_distractors",
      "rich_scenarios",
      "cognitive_load",
      "advanced_formats"
    ],
    "features_pending": []
  },
  "context": {
    "id": "shop-002-realistic-general",
    "theme": "SHOPPING",
    "setting": {
      "location": "local shop",
      "timeContext": "after school",
      "atmosphere": "friendly"
    },
    "characters": [
      {
        "name": "Liam",
        "role": "student"
      }
    ],
    "items": [
      {
        "name": "apple",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.2,
          "max": 0.5,
          "typical": 0.35,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "banana",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.15,
          "max": 0.4,
          "typical": 0.25,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "sandwich",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 2.5,
          "max": 6,
          "typical": 4,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "drink",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.8,
          "max": 2.5,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "cake",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 1.5,
          "max": 4,
          "typical": 2.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "biscuit",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.8,
          "max": 2,
          "typical": 1.2,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "sweet",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.1,
          "max": 1,
          "typical": 0.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "chocolate",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.6,
          "max": 3,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "pen",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.5,
          "max": 2,
          "typical": 1,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "pencil",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.2,
          "max": 1,
          "typical": 0.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "ruler",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.8,
          "max": 2.5,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "notebook",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 1,
          "max": 4,
          "typical": 2,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "eraser",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.3,
          "max": 1.5,
          "typical": 0.75,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "book",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 3,
          "max": 15,
          "typical": 8,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "comic",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 2,
          "max": 5,
          "typical": 3,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "magazine",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 2.5,
          "max": 6,
          "typical": 4,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "toy",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 5,
          "max": 25,
          "typical": 12,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "game",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 8,
          "max": 60,
          "typical": 25,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "puzzle",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 5,
          "max": 20,
          "typical": 12,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "sticker",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 0.2,
          "max": 2,
          "typical": 0.8,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "badge",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 0.5,
          "max": 3,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "poster",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 2,
          "max": 8,
          "typical": 4,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "card",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 0.5,
          "max": 4,
          "typical": 2,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      }
    ],
    "culturalElements": [
      {
        "type": "currency",
        "value": "£",
        "explanation": "British pounds"
      },
      {
        "type": "location",
        "value": "UK local shop",
        "explanation": "Typical British corner shop"
      }
    ],
    "realWorldConnection": "Everyday shopping with realistic UK prices",
    "yearAppropriate": [
      1,
      2,
      3,
      4,
      5,
      6
    ],
    "templates": [
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "MULTI_STEP"
        ],
        "modelCompatibility": [
          "ADDITION"
        ],
        "operandCount": 3,
        "template": "{character} buys {article1} {item1} for {price1}, {article2} {item2} for {price2}, and {article3} {item3} for {price3}. What is the total cost?",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item1",
            "type": "item"
          },
          {
            "key": "item2",
            "type": "item"
          },
          {
            "key": "item3",
            "type": "item"
          },
          {
            "key": "price1",
            "type": "value"
          },
          {
            "key": "price2",
            "type": "value"
          },
          {
            "key": "price3",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "MULTI_STEP"
        ],
        "modelCompatibility": [
          "ADDITION"
        ],
        "operandCount": 2,
        "template": "{character} buys {article1} {item1} for {price1} and {article2} {item2} for {price2}. What is the total cost?",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item1",
            "type": "item"
          },
          {
            "key": "item2",
            "type": "item"
          },
          {
            "key": "price1",
            "type": "value"
          },
          {
            "key": "price2",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION"
        ],
        "modelCompatibility": [
          "SUBTRACTION",
          "CHANGE_CALCULATION"
        ],
        "template": "{character} buys {article} {item} for {price} and pays with {payment}. How much change does {character} get?",
        "answerTemplate": "{character} receives {result} in change",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "price",
            "type": "value"
          },
          {
            "key": "payment",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION"
        ],
        "modelCompatibility": [
          "MULTIPLICATION"
        ],
        "template": "{character} buys {quantity} {item} at {price} each. What is the total cost?",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "quantity",
            "type": "value"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "price",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION"
        ],
        "modelCompatibility": [
          "DIVISION"
        ],
        "template": "{character} has {total} to spend equally on {quantity} {item}. How much can {character} spend on each one?",
        "answerTemplate": "{character} can spend {result} on each {item}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "total",
            "type": "value"
          },
          {
            "key": "quantity",
            "type": "value"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "COMPARISON",
          "ESTIMATION",
          "MULTI_STEP"
        ],
        "template": "{character} goes to the shop and buys {items}. How much does {character} spend in total?",
        "answerTemplate": "{character} spends {result} in total",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "items",
            "type": "item_list"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "ESTIMATION"
        ],
        "template": "Estimate: If {character} buys {items}, about how much will it cost?",
        "answerTemplate": "It will cost approximately {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "items",
            "type": "item_list"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "VALIDATION"
        ],
        "template": "{character} calculated that {items} costs {amount}. Is this correct?",
        "answerTemplate": "{validation_result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "items",
            "type": "item_list"
          },
          {
            "key": "amount",
            "type": "value"
          },
          {
            "key": "validation_result",
            "type": "boolean"
          }
        ]
      }
    ]
  }
}

--- SUITE E: SCENARIO THEME TESTS ---
Testing that each scenario theme can be applied...
# Test E.1: SHOPPING theme
{
  "success": true,
  "question": {
    "text": "Liam buys an apple for 36p, a banana for 16p, and a sandwich for £4.31. What is the total cost?",
    "options": [
      {
        "text": "0.06",
        "value": 0.06,
        "index": 0
      },
      {
        "text": "0.52",
        "value": 0.52,
        "index": 1
      },
      {
        "text": "£4.83",
        "value": 4.83,
        "index": 2
      },
      {
        "text": "0.2",
        "value": 0.2,
        "index": 3
      }
    ],
    "correctIndex": 2,
    "format": "DIRECT_CALCULATION",
    "difficulty": {
      "year": 3,
      "subLevel": 1,
      "displayName": "3.1",
      "cognitiveLoad": 30
    },
    "cognitiveLoad": 30,
    "curriculumTags": [
      "3N1a",
      "3N1b"
    ],
    "scenario": {
      "id": "shop-002-realistic-general",
      "theme": "SHOPPING",
      "setting": {
        "location": "local shop",
        "timeContext": "after school",
        "atmosphere": "friendly"
      },
      "characters": [
        {
          "name": "Liam",
          "role": "student"
        }
      ],
      "items": [
        {
          "name": "apple",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.2,
            "max": 0.5,
            "typical": 0.35,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "banana",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.15,
            "max": 0.4,
            "typical": 0.25,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "sandwich",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 2.5,
            "max": 6,
            "typical": 4,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "drink",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.8,
            "max": 2.5,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "cake",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 1.5,
            "max": 4,
            "typical": 2.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "biscuit",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.8,
            "max": 2,
            "typical": 1.2,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "sweet",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.1,
            "max": 1,
            "typical": 0.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "chocolate",
          "category": "FOOD_DRINK",
          "typicalValue": {
            "min": 0.6,
            "max": 3,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "pen",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.5,
            "max": 2,
            "typical": 1,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "pencil",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.2,
            "max": 1,
            "typical": 0.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "ruler",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.8,
            "max": 2.5,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "notebook",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 1,
            "max": 4,
            "typical": 2,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "eraser",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.3,
            "max": 1.5,
            "typical": 0.75,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "book",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 3,
            "max": 15,
            "typical": 8,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "comic",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 2,
            "max": 5,
            "typical": 3,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "magazine",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 2.5,
            "max": 6,
            "typical": 4,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "toy",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 5,
            "max": 25,
            "typical": 12,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "game",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 8,
            "max": 60,
            "typical": 25,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "puzzle",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 5,
            "max": 20,
            "typical": 12,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "sticker",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 0.2,
            "max": 2,
            "typical": 0.8,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "badge",
          "category": "TOYS_GAMES",
          "typicalValue": {
            "min": 0.5,
            "max": 3,
            "typical": 1.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "poster",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 2,
            "max": 8,
            "typical": 4,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "card",
          "category": "BOOKS_MEDIA",
          "typicalValue": {
            "min": 0.5,
            "max": 4,
            "typical": 2,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        }
      ],
      "culturalElements": [
        {
          "type": "currency",
          "value": "£",
          "explanation": "British pounds"
        },
        {
          "type": "location",
          "value": "UK local shop",
          "explanation": "Typical British corner shop"
        }
      ],
      "realWorldConnection": "Everyday shopping with realistic UK prices",
      "yearAppropriate": [
        1,
        2,
        3,
        4,
        5,
        6
      ],
      "templates": [
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "MULTI_STEP"
          ],
          "modelCompatibility": [
            "ADDITION"
          ],
          "operandCount": 3,
          "template": "{character} buys {article1} {item1} for {price1}, {article2} {item2} for {price2}, and {article3} {item3} for {price3}. What is the total cost?",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item1",
              "type": "item"
            },
            {
              "key": "item2",
              "type": "item"
            },
            {
              "key": "item3",
              "type": "item"
            },
            {
              "key": "price1",
              "type": "value"
            },
            {
              "key": "price2",
              "type": "value"
            },
            {
              "key": "price3",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "MULTI_STEP"
          ],
          "modelCompatibility": [
            "ADDITION"
          ],
          "operandCount": 2,
          "template": "{character} buys {article1} {item1} for {price1} and {article2} {item2} for {price2}. What is the total cost?",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item1",
              "type": "item"
            },
            {
              "key": "item2",
              "type": "item"
            },
            {
              "key": "price1",
              "type": "value"
            },
            {
              "key": "price2",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION"
          ],
          "modelCompatibility": [
            "SUBTRACTION",
            "CHANGE_CALCULATION"
          ],
          "template": "{character} buys {article} {item} for {price} and pays with {payment}. How much change does {character} get?",
          "answerTemplate": "{character} receives {result} in change",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "price",
              "type": "value"
            },
            {
              "key": "payment",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION"
          ],
          "modelCompatibility": [
            "MULTIPLICATION"
          ],
          "template": "{character} buys {quantity} {item} at {price} each. What is the total cost?",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "quantity",
              "type": "value"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "price",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION"
          ],
          "modelCompatibility": [
            "DIVISION"
          ],
          "template": "{character} has {total} to spend equally on {quantity} {item}. How much can {character} spend on each one?",
          "answerTemplate": "{character} can spend {result} on each {item}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "total",
              "type": "value"
            },
            {
              "key": "quantity",
              "type": "value"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "COMPARISON",
            "ESTIMATION",
            "MULTI_STEP"
          ],
          "template": "{character} goes to the shop and buys {items}. How much does {character} spend in total?",
          "answerTemplate": "{character} spends {result} in total",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "items",
              "type": "item_list"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "ESTIMATION"
          ],
          "template": "Estimate: If {character} buys {items}, about how much will it cost?",
          "answerTemplate": "It will cost approximately {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "items",
              "type": "item_list"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        },
        {
          "formatCompatibility": [
            "VALIDATION"
          ],
          "template": "{character} calculated that {items} costs {amount}. Is this correct?",
          "answerTemplate": "{validation_result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "items",
              "type": "item_list"
            },
            {
              "key": "amount",
              "type": "value"
            },
            {
              "key": "validation_result",
              "type": "boolean"
            }
          ]
        }
      ]
    },
    "distractors": [
      {
        "value": 0.2,
        "displayText": "0.2",
        "strategy": "WRONG_OPERATION",
        "reasoning": "Subtracted instead of adding"
      },
      {
        "value": 0.06,
        "displayText": "0.06",
        "strategy": "WRONG_OPERATION",
        "reasoning": "Multiplied instead of adding"
      },
      {
        "value": 0.52,
        "displayText": "0.52",
        "strategy": "PARTIAL_CALCULATION",
        "reasoning": "Stopped calculation early"
      }
    ],
    "enhancementStatus": {
      "level": "partial",
      "requestedFormat": "DIRECT_CALCULATION",
      "actualFormat": "DIRECT_CALCULATION",
      "featuresActive": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "featuresPending": [],
      "isFullyEnhanced": true
    },
    "mathOutput": {
      "operation": "ADDITION",
      "operand_1": 0.36,
      "operand_2": 0.16,
      "operand_3": 4.31,
      "result": 4.83
    },
    "generationTime": 0,
    "questionId": "q_1759234385990_r97mivm9s",
    "generationSetup": {
      "controller_used": "DIRECT_CALCULATIONController",
      "format_requested": "DIRECT_CALCULATION",
      "format_actual": "DIRECT_CALCULATION",
      "scenario_theme": "SHOPPING",
      "scenario_id": "shop-002-realistic-general",
      "scenario_selection_method": "requested",
      "distractor_strategies": [
        "WRONG_OPERATION",
        "WRONG_OPERATION",
        "PARTIAL_CALCULATION"
      ],
      "distractor_count": 3,
      "theme_variety": false,
      "format_variety": false,
      "enhancement_level": "partial",
      "features_active": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "features_pending": [],
      "generation_time_ms": 0
    }
  },
  "metadata": {
    "format": "DIRECT_CALCULATION",
    "cognitive_load": 30,
    "curriculum_alignment": [
      "3N1a",
      "3N1b"
    ],
    "difficulty": "3.1",
    "scenario_theme": "SHOPPING",
    "distractor_strategies": [
      "WRONG_OPERATION",
      "WRONG_OPERATION",
      "PARTIAL_CALCULATION"
    ],
    "generation_time_ms": 0,
    "api_version": "2.0",
    "enhancement_status": "partial",
    "format_requested": "DIRECT_CALCULATION",
    "format_used": "DIRECT_CALCULATION",
    "features_active": [
      "enhanced_distractors",
      "rich_scenarios",
      "cognitive_load",
      "advanced_formats"
    ],
    "features_pending": []
  },
  "context": {
    "id": "shop-002-realistic-general",
    "theme": "SHOPPING",
    "setting": {
      "location": "local shop",
      "timeContext": "after school",
      "atmosphere": "friendly"
    },
    "characters": [
      {
        "name": "Liam",
        "role": "student"
      }
    ],
    "items": [
      {
        "name": "apple",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.2,
          "max": 0.5,
          "typical": 0.35,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "banana",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.15,
          "max": 0.4,
          "typical": 0.25,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "sandwich",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 2.5,
          "max": 6,
          "typical": 4,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "drink",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.8,
          "max": 2.5,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "cake",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 1.5,
          "max": 4,
          "typical": 2.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "biscuit",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.8,
          "max": 2,
          "typical": 1.2,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "sweet",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.1,
          "max": 1,
          "typical": 0.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "chocolate",
        "category": "FOOD_DRINK",
        "typicalValue": {
          "min": 0.6,
          "max": 3,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "pen",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.5,
          "max": 2,
          "typical": 1,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "pencil",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.2,
          "max": 1,
          "typical": 0.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "ruler",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.8,
          "max": 2.5,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "notebook",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 1,
          "max": 4,
          "typical": 2,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "eraser",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.3,
          "max": 1.5,
          "typical": 0.75,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "book",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 3,
          "max": 15,
          "typical": 8,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "comic",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 2,
          "max": 5,
          "typical": 3,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "magazine",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 2.5,
          "max": 6,
          "typical": 4,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "toy",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 5,
          "max": 25,
          "typical": 12,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "game",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 8,
          "max": 60,
          "typical": 25,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "puzzle",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 5,
          "max": 20,
          "typical": 12,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "sticker",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 0.2,
          "max": 2,
          "typical": 0.8,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "badge",
        "category": "TOYS_GAMES",
        "typicalValue": {
          "min": 0.5,
          "max": 3,
          "typical": 1.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "poster",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 2,
          "max": 8,
          "typical": 4,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "card",
        "category": "BOOKS_MEDIA",
        "typicalValue": {
          "min": 0.5,
          "max": 4,
          "typical": 2,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      }
    ],
    "culturalElements": [
      {
        "type": "currency",
        "value": "£",
        "explanation": "British pounds"
      },
      {
        "type": "location",
        "value": "UK local shop",
        "explanation": "Typical British corner shop"
      }
    ],
    "realWorldConnection": "Everyday shopping with realistic UK prices",
    "yearAppropriate": [
      1,
      2,
      3,
      4,
      5,
      6
    ],
    "templates": [
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "MULTI_STEP"
        ],
        "modelCompatibility": [
          "ADDITION"
        ],
        "operandCount": 3,
        "template": "{character} buys {article1} {item1} for {price1}, {article2} {item2} for {price2}, and {article3} {item3} for {price3}. What is the total cost?",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item1",
            "type": "item"
          },
          {
            "key": "item2",
            "type": "item"
          },
          {
            "key": "item3",
            "type": "item"
          },
          {
            "key": "price1",
            "type": "value"
          },
          {
            "key": "price2",
            "type": "value"
          },
          {
            "key": "price3",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "MULTI_STEP"
        ],
        "modelCompatibility": [
          "ADDITION"
        ],
        "operandCount": 2,
        "template": "{character} buys {article1} {item1} for {price1} and {article2} {item2} for {price2}. What is the total cost?",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item1",
            "type": "item"
          },
          {
            "key": "item2",
            "type": "item"
          },
          {
            "key": "price1",
            "type": "value"
          },
          {
            "key": "price2",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION"
        ],
        "modelCompatibility": [
          "SUBTRACTION",
          "CHANGE_CALCULATION"
        ],
        "template": "{character} buys {article} {item} for {price} and pays with {payment}. How much change does {character} get?",
        "answerTemplate": "{character} receives {result} in change",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "price",
            "type": "value"
          },
          {
            "key": "payment",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION"
        ],
        "modelCompatibility": [
          "MULTIPLICATION"
        ],
        "template": "{character} buys {quantity} {item} at {price} each. What is the total cost?",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "quantity",
            "type": "value"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "price",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION"
        ],
        "modelCompatibility": [
          "DIVISION"
        ],
        "template": "{character} has {total} to spend equally on {quantity} {item}. How much can {character} spend on each one?",
        "answerTemplate": "{character} can spend {result} on each {item}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "total",
            "type": "value"
          },
          {
            "key": "quantity",
            "type": "value"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "COMPARISON",
          "ESTIMATION",
          "MULTI_STEP"
        ],
        "template": "{character} goes to the shop and buys {items}. How much does {character} spend in total?",
        "answerTemplate": "{character} spends {result} in total",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "items",
            "type": "item_list"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "ESTIMATION"
        ],
        "template": "Estimate: If {character} buys {items}, about how much will it cost?",
        "answerTemplate": "It will cost approximately {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "items",
            "type": "item_list"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      },
      {
        "formatCompatibility": [
          "VALIDATION"
        ],
        "template": "{character} calculated that {items} costs {amount}. Is this correct?",
        "answerTemplate": "{validation_result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "items",
            "type": "item_list"
          },
          {
            "key": "amount",
            "type": "value"
          },
          {
            "key": "validation_result",
            "type": "boolean"
          }
        ]
      }
    ]
  }
}
# Test E.2: COOKING theme
{
  "success": true,
  "question": {
    "text": "Isabella is making pizza. The ingredients cost £12, £7, £4. What is the total cost?",
    "options": [
      {
        "text": "£23.00",
        "value": 23,
        "index": 0
      },
      {
        "text": "5",
        "value": 5,
        "index": 1
      },
      {
        "text": "84",
        "value": 84,
        "index": 2
      },
      {
        "text": "33",
        "value": 33,
        "index": 3
      }
    ],
    "correctIndex": 0,
    "format": "DIRECT_CALCULATION",
    "difficulty": {
      "year": 3,
      "subLevel": 1,
      "displayName": "3.1",
      "cognitiveLoad": 30
    },
    "cognitiveLoad": 30,
    "curriculumTags": [
      "3N1a",
      "3N1b"
    ],
    "scenario": {
      "id": "cooking-3-1759234386036",
      "theme": "COOKING",
      "setting": {
        "location": "kitchen",
        "timeContext": "weekend baking",
        "atmosphere": "creative"
      },
      "characters": [
        {
          "name": "Isabella",
          "role": "student"
        },
        {
          "name": "Mum",
          "role": "parent"
        }
      ],
      "items": [
        {
          "name": "flour",
          "category": "FOOD_ITEMS",
          "typicalValue": {
            "min": 1,
            "max": 5,
            "typical": 2.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "eggs",
          "category": "FOOD_ITEMS",
          "typicalValue": {
            "min": 1,
            "max": 5,
            "typical": 2.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "butter",
          "category": "FOOD_ITEMS",
          "typicalValue": {
            "min": 1,
            "max": 5,
            "typical": 2.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "sugar",
          "category": "FOOD_ITEMS",
          "typicalValue": {
            "min": 1,
            "max": 5,
            "typical": 2.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "milk",
          "category": "FOOD_ITEMS",
          "typicalValue": {
            "min": 1,
            "max": 5,
            "typical": 2.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "chocolate chips",
          "category": "FOOD_ITEMS",
          "typicalValue": {
            "min": 1,
            "max": 5,
            "typical": 2.5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        }
      ],
      "culturalElements": [
        {
          "type": "currency",
          "value": "£",
          "explanation": "British pounds"
        },
        {
          "type": "measurement",
          "value": "grams",
          "explanation": "Weight measurement for ingredients"
        }
      ],
      "realWorldConnection": "Following recipes and calculating ingredient costs",
      "yearAppropriate": [
        3
      ],
      "templates": [
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "MULTI_STEP"
          ],
          "template": "{character} is making {recipe}. The ingredients cost {prices}. What is the total cost?",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "recipe",
              "type": "item"
            },
            {
              "key": "prices",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        }
      ]
    },
    "distractors": [
      {
        "value": 5,
        "displayText": "5",
        "strategy": "WRONG_OPERATION",
        "reasoning": "Subtracted instead of adding"
      },
      {
        "value": 84,
        "displayText": "84",
        "strategy": "WRONG_OPERATION",
        "reasoning": "Multiplied instead of adding"
      },
      {
        "value": 33,
        "displayText": "33",
        "strategy": "PLACE_VALUE_ERROR",
        "reasoning": "Error in carrying to next column"
      }
    ],
    "enhancementStatus": {
      "level": "partial",
      "requestedFormat": "DIRECT_CALCULATION",
      "actualFormat": "DIRECT_CALCULATION",
      "featuresActive": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "featuresPending": [],
      "isFullyEnhanced": true
    },
    "mathOutput": {
      "operation": "ADDITION",
      "operand_1": 12,
      "operand_2": 7,
      "operand_3": 4,
      "result": 23
    },
    "generationTime": 1,
    "questionId": "q_1759234386037_fku4ozwk0",
    "generationSetup": {
      "controller_used": "DIRECT_CALCULATIONController",
      "format_requested": "DIRECT_CALCULATION",
      "format_actual": "DIRECT_CALCULATION",
      "scenario_theme": "COOKING",
      "scenario_id": "cooking-3-1759234386036",
      "scenario_selection_method": "requested",
      "distractor_strategies": [
        "WRONG_OPERATION",
        "WRONG_OPERATION",
        "PLACE_VALUE_ERROR"
      ],
      "distractor_count": 3,
      "theme_variety": false,
      "format_variety": false,
      "enhancement_level": "partial",
      "features_active": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "features_pending": [],
      "generation_time_ms": 1
    }
  },
  "metadata": {
    "format": "DIRECT_CALCULATION",
    "cognitive_load": 30,
    "curriculum_alignment": [
      "3N1a",
      "3N1b"
    ],
    "difficulty": "3.1",
    "scenario_theme": "COOKING",
    "distractor_strategies": [
      "WRONG_OPERATION",
      "WRONG_OPERATION",
      "PLACE_VALUE_ERROR"
    ],
    "generation_time_ms": 1,
    "api_version": "2.0",
    "enhancement_status": "partial",
    "format_requested": "DIRECT_CALCULATION",
    "format_used": "DIRECT_CALCULATION",
    "features_active": [
      "enhanced_distractors",
      "rich_scenarios",
      "cognitive_load",
      "advanced_formats"
    ],
    "features_pending": []
  },
  "context": {
    "id": "cooking-3-1759234386036",
    "theme": "COOKING",
    "setting": {
      "location": "kitchen",
      "timeContext": "weekend baking",
      "atmosphere": "creative"
    },
    "characters": [
      {
        "name": "Isabella",
        "role": "student"
      },
      {
        "name": "Mum",
        "role": "parent"
      }
    ],
    "items": [
      {
        "name": "flour",
        "category": "FOOD_ITEMS",
        "typicalValue": {
          "min": 1,
          "max": 5,
          "typical": 2.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "eggs",
        "category": "FOOD_ITEMS",
        "typicalValue": {
          "min": 1,
          "max": 5,
          "typical": 2.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "butter",
        "category": "FOOD_ITEMS",
        "typicalValue": {
          "min": 1,
          "max": 5,
          "typical": 2.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "sugar",
        "category": "FOOD_ITEMS",
        "typicalValue": {
          "min": 1,
          "max": 5,
          "typical": 2.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "milk",
        "category": "FOOD_ITEMS",
        "typicalValue": {
          "min": 1,
          "max": 5,
          "typical": 2.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "chocolate chips",
        "category": "FOOD_ITEMS",
        "typicalValue": {
          "min": 1,
          "max": 5,
          "typical": 2.5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      }
    ],
    "culturalElements": [
      {
        "type": "currency",
        "value": "£",
        "explanation": "British pounds"
      },
      {
        "type": "measurement",
        "value": "grams",
        "explanation": "Weight measurement for ingredients"
      }
    ],
    "realWorldConnection": "Following recipes and calculating ingredient costs",
    "yearAppropriate": [
      3
    ],
    "templates": [
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "MULTI_STEP"
        ],
        "template": "{character} is making {recipe}. The ingredients cost {prices}. What is the total cost?",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "recipe",
            "type": "item"
          },
          {
            "key": "prices",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      }
    ]
  }
}
# Test E.3: SPORTS theme
{
  "success": true,
  "question": {
    "text": "The football costs £20. If Daniel buys 2, how much will it cost?",
    "options": [
      {
        "text": "38",
        "value": 38,
        "index": 0
      },
      {
        "text": "£53.00",
        "value": 53,
        "index": 1
      },
      {
        "text": "352",
        "value": 352,
        "index": 2
      },
      {
        "text": "63",
        "value": 63,
        "index": 3
      }
    ],
    "correctIndex": 1,
    "format": "DIRECT_CALCULATION",
    "difficulty": {
      "year": 3,
      "subLevel": 1,
      "displayName": "3.1",
      "cognitiveLoad": 30
    },
    "cognitiveLoad": 30,
    "curriculumTags": [
      "3N1a",
      "3N1b"
    ],
    "scenario": {
      "id": "sports-3-1759234386081",
      "theme": "SPORTS",
      "setting": {
        "location": "school sports hall",
        "timeContext": "weekend",
        "atmosphere": "energetic"
      },
      "characters": [
        {
          "name": "Daniel",
          "role": "student"
        },
        {
          "name": "Elijah",
          "role": "coach"
        }
      ],
      "items": [
        {
          "name": "football",
          "category": "SPORTS_EQUIPMENT",
          "typicalValue": {
            "min": 5,
            "max": 50,
            "typical": 20,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "tennis ball",
          "category": "SPORTS_EQUIPMENT",
          "typicalValue": {
            "min": 5,
            "max": 50,
            "typical": 20,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "cricket bat",
          "category": "SPORTS_EQUIPMENT",
          "typicalValue": {
            "min": 5,
            "max": 50,
            "typical": 20,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "rugby ball",
          "category": "SPORTS_EQUIPMENT",
          "typicalValue": {
            "min": 5,
            "max": 50,
            "typical": 20,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "basketball",
          "category": "SPORTS_EQUIPMENT",
          "typicalValue": {
            "min": 5,
            "max": 50,
            "typical": 20,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        }
      ],
      "culturalElements": [
        {
          "type": "currency",
          "value": "£",
          "explanation": "British pounds"
        }
      ],
      "realWorldConnection": "Calculating costs for sports activities",
      "yearAppropriate": [
        3
      ],
      "templates": [
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "MULTI_STEP"
          ],
          "template": "The {item} costs {price}. If {character} buys {quantity}, how much will it cost?",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "price",
              "type": "value"
            },
            {
              "key": "quantity",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        }
      ]
    },
    "distractors": [
      {
        "value": 352,
        "displayText": "352",
        "strategy": "WRONG_OPERATION",
        "reasoning": "Multiplied instead of adding"
      },
      {
        "value": 63,
        "displayText": "63",
        "strategy": "PLACE_VALUE_ERROR",
        "reasoning": "Error in carrying to next column"
      },
      {
        "value": 38,
        "displayText": "38",
        "strategy": "PARTIAL_CALCULATION",
        "reasoning": "Stopped calculation early"
      }
    ],
    "enhancementStatus": {
      "level": "partial",
      "requestedFormat": "DIRECT_CALCULATION",
      "actualFormat": "DIRECT_CALCULATION",
      "featuresActive": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "featuresPending": [],
      "isFullyEnhanced": true
    },
    "mathOutput": {
      "operation": "ADDITION",
      "operand_1": 16,
      "operand_2": 22,
      "operand_3": 15,
      "result": 53
    },
    "generationTime": 1,
    "questionId": "q_1759234386082_6k7255tzw",
    "generationSetup": {
      "controller_used": "DIRECT_CALCULATIONController",
      "format_requested": "DIRECT_CALCULATION",
      "format_actual": "DIRECT_CALCULATION",
      "scenario_theme": "SPORTS",
      "scenario_id": "sports-3-1759234386081",
      "scenario_selection_method": "requested",
      "distractor_strategies": [
        "WRONG_OPERATION",
        "PLACE_VALUE_ERROR",
        "PARTIAL_CALCULATION"
      ],
      "distractor_count": 3,
      "theme_variety": false,
      "format_variety": false,
      "enhancement_level": "partial",
      "features_active": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "features_pending": [],
      "generation_time_ms": 1
    }
  },
  "metadata": {
    "format": "DIRECT_CALCULATION",
    "cognitive_load": 30,
    "curriculum_alignment": [
      "3N1a",
      "3N1b"
    ],
    "difficulty": "3.1",
    "scenario_theme": "SPORTS",
    "distractor_strategies": [
      "WRONG_OPERATION",
      "PLACE_VALUE_ERROR",
      "PARTIAL_CALCULATION"
    ],
    "generation_time_ms": 1,
    "api_version": "2.0",
    "enhancement_status": "partial",
    "format_requested": "DIRECT_CALCULATION",
    "format_used": "DIRECT_CALCULATION",
    "features_active": [
      "enhanced_distractors",
      "rich_scenarios",
      "cognitive_load",
      "advanced_formats"
    ],
    "features_pending": []
  },
  "context": {
    "id": "sports-3-1759234386081",
    "theme": "SPORTS",
    "setting": {
      "location": "school sports hall",
      "timeContext": "weekend",
      "atmosphere": "energetic"
    },
    "characters": [
      {
        "name": "Daniel",
        "role": "student"
      },
      {
        "name": "Elijah",
        "role": "coach"
      }
    ],
    "items": [
      {
        "name": "football",
        "category": "SPORTS_EQUIPMENT",
        "typicalValue": {
          "min": 5,
          "max": 50,
          "typical": 20,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "tennis ball",
        "category": "SPORTS_EQUIPMENT",
        "typicalValue": {
          "min": 5,
          "max": 50,
          "typical": 20,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "cricket bat",
        "category": "SPORTS_EQUIPMENT",
        "typicalValue": {
          "min": 5,
          "max": 50,
          "typical": 20,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "rugby ball",
        "category": "SPORTS_EQUIPMENT",
        "typicalValue": {
          "min": 5,
          "max": 50,
          "typical": 20,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "basketball",
        "category": "SPORTS_EQUIPMENT",
        "typicalValue": {
          "min": 5,
          "max": 50,
          "typical": 20,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      }
    ],
    "culturalElements": [
      {
        "type": "currency",
        "value": "£",
        "explanation": "British pounds"
      }
    ],
    "realWorldConnection": "Calculating costs for sports activities",
    "yearAppropriate": [
      3
    ],
    "templates": [
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "MULTI_STEP"
        ],
        "template": "The {item} costs {price}. If {character} buys {quantity}, how much will it cost?",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "price",
            "type": "value"
          },
          {
            "key": "quantity",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      }
    ]
  }
}
# Test E.4: SCHOOL theme
{
  "success": true,
  "question": {
    "text": "Logan needs to buy calculator, compass, protractor, highlighter for school. How much will it cost in total?",
    "options": [
      {
        "text": "44",
        "value": 44,
        "index": 0
      },
      {
        "text": "57",
        "value": 57,
        "index": 1
      },
      {
        "text": "£47.00",
        "value": 47,
        "index": 2
      },
      {
        "text": "475",
        "value": 475,
        "index": 3
      }
    ],
    "correctIndex": 2,
    "format": "DIRECT_CALCULATION",
    "difficulty": {
      "year": 3,
      "subLevel": 1,
      "displayName": "3.1",
      "cognitiveLoad": 30
    },
    "cognitiveLoad": 30,
    "curriculumTags": [
      "3N1a",
      "3N1b"
    ],
    "scenario": {
      "id": "school-3-1759234386127",
      "theme": "SCHOOL",
      "setting": {
        "location": "school stationery shop",
        "timeContext": "start of term",
        "atmosphere": "busy"
      },
      "characters": [
        {
          "name": "Logan",
          "role": "student"
        },
        {
          "name": "Mrs. Thompson",
          "role": "teacher"
        }
      ],
      "items": [
        {
          "name": "calculator",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.5,
            "max": 15,
            "typical": 3,
            "distribution": "skewed_low"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "compass",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.5,
            "max": 15,
            "typical": 3,
            "distribution": "skewed_low"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "protractor",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.5,
            "max": 15,
            "typical": 3,
            "distribution": "skewed_low"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "highlighter",
          "category": "SCHOOL_SUPPLIES",
          "typicalValue": {
            "min": 0.5,
            "max": 15,
            "typical": 3,
            "distribution": "skewed_low"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        }
      ],
      "culturalElements": [
        {
          "type": "currency",
          "value": "£",
          "explanation": "British pounds"
        },
        {
          "type": "event",
          "value": "start of term",
          "explanation": "When students buy school supplies"
        }
      ],
      "realWorldConnection": "Budgeting for school supplies",
      "yearAppropriate": [
        3
      ],
      "templates": [
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "COMPARISON"
          ],
          "template": "{character} needs to buy {items} for school. How much will it cost in total?",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "items",
              "type": "item"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        }
      ]
    },
    "distractors": [
      {
        "value": 475,
        "displayText": "475",
        "strategy": "WRONG_OPERATION",
        "reasoning": "Multiplied instead of adding"
      },
      {
        "value": 57,
        "displayText": "57",
        "strategy": "PLACE_VALUE_ERROR",
        "reasoning": "Error in carrying to next column"
      },
      {
        "value": 44,
        "displayText": "44",
        "strategy": "PARTIAL_CALCULATION",
        "reasoning": "Stopped calculation early"
      }
    ],
    "enhancementStatus": {
      "level": "partial",
      "requestedFormat": "DIRECT_CALCULATION",
      "actualFormat": "DIRECT_CALCULATION",
      "featuresActive": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "featuresPending": [],
      "isFullyEnhanced": true
    },
    "mathOutput": {
      "operation": "ADDITION",
      "operand_1": 19,
      "operand_2": 25,
      "operand_3": 3,
      "result": 47
    },
    "generationTime": 0,
    "questionId": "q_1759234386127_g01m31ob0",
    "generationSetup": {
      "controller_used": "DIRECT_CALCULATIONController",
      "format_requested": "DIRECT_CALCULATION",
      "format_actual": "DIRECT_CALCULATION",
      "scenario_theme": "SCHOOL",
      "scenario_id": "school-3-1759234386127",
      "scenario_selection_method": "requested",
      "distractor_strategies": [
        "WRONG_OPERATION",
        "PLACE_VALUE_ERROR",
        "PARTIAL_CALCULATION"
      ],
      "distractor_count": 3,
      "theme_variety": false,
      "format_variety": false,
      "enhancement_level": "partial",
      "features_active": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "features_pending": [],
      "generation_time_ms": 0
    }
  },
  "metadata": {
    "format": "DIRECT_CALCULATION",
    "cognitive_load": 30,
    "curriculum_alignment": [
      "3N1a",
      "3N1b"
    ],
    "difficulty": "3.1",
    "scenario_theme": "SCHOOL",
    "distractor_strategies": [
      "WRONG_OPERATION",
      "PLACE_VALUE_ERROR",
      "PARTIAL_CALCULATION"
    ],
    "generation_time_ms": 0,
    "api_version": "2.0",
    "enhancement_status": "partial",
    "format_requested": "DIRECT_CALCULATION",
    "format_used": "DIRECT_CALCULATION",
    "features_active": [
      "enhanced_distractors",
      "rich_scenarios",
      "cognitive_load",
      "advanced_formats"
    ],
    "features_pending": []
  },
  "context": {
    "id": "school-3-1759234386127",
    "theme": "SCHOOL",
    "setting": {
      "location": "school stationery shop",
      "timeContext": "start of term",
      "atmosphere": "busy"
    },
    "characters": [
      {
        "name": "Logan",
        "role": "student"
      },
      {
        "name": "Mrs. Thompson",
        "role": "teacher"
      }
    ],
    "items": [
      {
        "name": "calculator",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.5,
          "max": 15,
          "typical": 3,
          "distribution": "skewed_low"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "compass",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.5,
          "max": 15,
          "typical": 3,
          "distribution": "skewed_low"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "protractor",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.5,
          "max": 15,
          "typical": 3,
          "distribution": "skewed_low"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "highlighter",
        "category": "SCHOOL_SUPPLIES",
        "typicalValue": {
          "min": 0.5,
          "max": 15,
          "typical": 3,
          "distribution": "skewed_low"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      }
    ],
    "culturalElements": [
      {
        "type": "currency",
        "value": "£",
        "explanation": "British pounds"
      },
      {
        "type": "event",
        "value": "start of term",
        "explanation": "When students buy school supplies"
      }
    ],
    "realWorldConnection": "Budgeting for school supplies",
    "yearAppropriate": [
      3
    ],
    "templates": [
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "COMPARISON"
        ],
        "template": "{character} needs to buy {items} for school. How much will it cost in total?",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "items",
            "type": "item"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      }
    ]
  }
}
# Test E.5: POCKET_MONEY theme
{
  "success": true,
  "question": {
    "text": "What is 38 + 19 + 33?",
    "options": [
      {
        "text": "100",
        "value": 100,
        "index": 0
      },
      {
        "text": "£90.00",
        "value": 90,
        "index": 1
      },
      {
        "text": "19",
        "value": 19,
        "index": 2
      },
      {
        "text": "722",
        "value": 722,
        "index": 3
      }
    ],
    "correctIndex": 1,
    "format": "DIRECT_CALCULATION",
    "difficulty": {
      "year": 3,
      "subLevel": 1,
      "displayName": "3.1",
      "cognitiveLoad": 30
    },
    "cognitiveLoad": 30,
    "curriculumTags": [
      "3N1a",
      "3N1b"
    ],
    "scenario": {
      "id": "pocket-money-3-1759234386173",
      "theme": "SCHOOL",
      "setting": {
        "location": "home",
        "timeContext": "weekly",
        "atmosphere": "planning"
      },
      "characters": [
        {
          "name": "Oliver",
          "role": "student"
        }
      ],
      "items": [
        {
          "name": "video game",
          "category": "SAVING_GOAL",
          "typicalValue": {
            "min": 12,
            "max": 40,
            "typical": 25,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "board game",
          "category": "SAVING_GOAL",
          "typicalValue": {
            "min": 12,
            "max": 40,
            "typical": 25,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "sports equipment",
          "category": "SAVING_GOAL",
          "typicalValue": {
            "min": 12,
            "max": 40,
            "typical": 25,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        }
      ],
      "culturalElements": [
        {
          "type": "currency",
          "value": "£",
          "explanation": "British pounds"
        },
        {
          "type": "custom",
          "value": "pocket money",
          "explanation": "Weekly allowance for children"
        }
      ],
      "realWorldConnection": "Learning to save and budget money",
      "yearAppropriate": [
        3
      ],
      "templates": [
        {
          "formatCompatibility": [
            "ESTIMATION",
            "MULTI_STEP"
          ],
          "template": "If {character} gets {amount} pocket money each week, how many weeks will it take to save for a {item} that costs {price}?",
          "answerTemplate": "It will take {result} weeks",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "amount",
              "type": "value"
            },
            {
              "key": "item",
              "type": "item"
            },
            {
              "key": "price",
              "type": "value"
            }
          ]
        }
      ]
    },
    "distractors": [
      {
        "value": 19,
        "displayText": "19",
        "strategy": "WRONG_OPERATION",
        "reasoning": "Subtracted instead of adding"
      },
      {
        "value": 722,
        "displayText": "722",
        "strategy": "WRONG_OPERATION",
        "reasoning": "Multiplied instead of adding"
      },
      {
        "value": 100,
        "displayText": "100",
        "strategy": "PLACE_VALUE_ERROR",
        "reasoning": "Error in carrying to next column"
      }
    ],
    "enhancementStatus": {
      "level": "partial",
      "requestedFormat": "DIRECT_CALCULATION",
      "actualFormat": "DIRECT_CALCULATION",
      "featuresActive": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "featuresPending": [],
      "isFullyEnhanced": true
    },
    "mathOutput": {
      "operation": "ADDITION",
      "operand_1": 38,
      "operand_2": 19,
      "operand_3": 33,
      "result": 90
    },
    "generationTime": 1,
    "questionId": "q_1759234386173_y00yujwuv",
    "generationSetup": {
      "controller_used": "DIRECT_CALCULATIONController",
      "format_requested": "DIRECT_CALCULATION",
      "format_actual": "DIRECT_CALCULATION",
      "scenario_theme": "SCHOOL",
      "scenario_id": "pocket-money-3-1759234386173",
      "scenario_selection_method": "requested",
      "distractor_strategies": [
        "WRONG_OPERATION",
        "WRONG_OPERATION",
        "PLACE_VALUE_ERROR"
      ],
      "distractor_count": 3,
      "theme_variety": false,
      "format_variety": false,
      "enhancement_level": "partial",
      "features_active": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "features_pending": [],
      "generation_time_ms": 1
    }
  },
  "metadata": {
    "format": "DIRECT_CALCULATION",
    "cognitive_load": 30,
    "curriculum_alignment": [
      "3N1a",
      "3N1b"
    ],
    "difficulty": "3.1",
    "scenario_theme": "SCHOOL",
    "distractor_strategies": [
      "WRONG_OPERATION",
      "WRONG_OPERATION",
      "PLACE_VALUE_ERROR"
    ],
    "generation_time_ms": 1,
    "api_version": "2.0",
    "enhancement_status": "partial",
    "format_requested": "DIRECT_CALCULATION",
    "format_used": "DIRECT_CALCULATION",
    "features_active": [
      "enhanced_distractors",
      "rich_scenarios",
      "cognitive_load",
      "advanced_formats"
    ],
    "features_pending": []
  },
  "context": {
    "id": "pocket-money-3-1759234386173",
    "theme": "SCHOOL",
    "setting": {
      "location": "home",
      "timeContext": "weekly",
      "atmosphere": "planning"
    },
    "characters": [
      {
        "name": "Oliver",
        "role": "student"
      }
    ],
    "items": [
      {
        "name": "video game",
        "category": "SAVING_GOAL",
        "typicalValue": {
          "min": 12,
          "max": 40,
          "typical": 25,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "board game",
        "category": "SAVING_GOAL",
        "typicalValue": {
          "min": 12,
          "max": 40,
          "typical": 25,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "sports equipment",
        "category": "SAVING_GOAL",
        "typicalValue": {
          "min": 12,
          "max": 40,
          "typical": 25,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      }
    ],
    "culturalElements": [
      {
        "type": "currency",
        "value": "£",
        "explanation": "British pounds"
      },
      {
        "type": "custom",
        "value": "pocket money",
        "explanation": "Weekly allowance for children"
      }
    ],
    "realWorldConnection": "Learning to save and budget money",
    "yearAppropriate": [
      3
    ],
    "templates": [
      {
        "formatCompatibility": [
          "ESTIMATION",
          "MULTI_STEP"
        ],
        "template": "If {character} gets {amount} pocket money each week, how many weeks will it take to save for a {item} that costs {price}?",
        "answerTemplate": "It will take {result} weeks",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "amount",
            "type": "value"
          },
          {
            "key": "item",
            "type": "item"
          },
          {
            "key": "price",
            "type": "value"
          }
        ]
      }
    ]
  }
}
# Test E.6: NATURE theme
{
  "success": true,
  "question": {
    "text": "Ava collected flower, leaf, stone, stick, acorn, feather, shell, pine cone while exploring. How many items in total?",
    "options": [
      {
        "text": "75",
        "value": 75,
        "index": 0
      },
      {
        "text": "45",
        "value": 45,
        "index": 1
      },
      {
        "text": "324",
        "value": 324,
        "index": 2
      },
      {
        "text": "85",
        "value": 85,
        "index": 3
      }
    ],
    "correctIndex": 0,
    "format": "DIRECT_CALCULATION",
    "difficulty": {
      "year": 3,
      "subLevel": 1,
      "displayName": "3.1",
      "cognitiveLoad": 30
    },
    "cognitiveLoad": 30,
    "curriculumTags": [
      "3N1a",
      "3N1b"
    ],
    "scenario": {
      "id": "nature-3-1759234386225",
      "theme": "NATURE",
      "setting": {
        "location": "forest",
        "timeContext": "outdoor exploration",
        "atmosphere": "peaceful"
      },
      "characters": [
        {
          "name": "Ava",
          "role": "student"
        },
        {
          "name": "Mr. Green",
          "role": "park ranger"
        }
      ],
      "items": [
        {
          "name": "flower",
          "category": "NATURE_ITEMS",
          "typicalValue": {
            "min": 1,
            "max": 20,
            "typical": 5,
            "distribution": "normal"
          },
          "unit": "items",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "leaf",
          "category": "NATURE_ITEMS",
          "typicalValue": {
            "min": 1,
            "max": 20,
            "typical": 5,
            "distribution": "normal"
          },
          "unit": "items",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "stone",
          "category": "NATURE_ITEMS",
          "typicalValue": {
            "min": 1,
            "max": 20,
            "typical": 5,
            "distribution": "normal"
          },
          "unit": "items",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "stick",
          "category": "NATURE_ITEMS",
          "typicalValue": {
            "min": 1,
            "max": 20,
            "typical": 5,
            "distribution": "normal"
          },
          "unit": "items",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "acorn",
          "category": "NATURE_ITEMS",
          "typicalValue": {
            "min": 1,
            "max": 20,
            "typical": 5,
            "distribution": "normal"
          },
          "unit": "items",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "feather",
          "category": "NATURE_ITEMS",
          "typicalValue": {
            "min": 1,
            "max": 20,
            "typical": 5,
            "distribution": "normal"
          },
          "unit": "items",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "shell",
          "category": "NATURE_ITEMS",
          "typicalValue": {
            "min": 1,
            "max": 20,
            "typical": 5,
            "distribution": "normal"
          },
          "unit": "items",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "pine cone",
          "category": "NATURE_ITEMS",
          "typicalValue": {
            "min": 1,
            "max": 20,
            "typical": 5,
            "distribution": "normal"
          },
          "unit": "items",
          "attributes": {
            "quality": "standard"
          }
        }
      ],
      "culturalElements": [
        {
          "type": "location",
          "value": "UK countryside",
          "explanation": "British natural environments"
        }
      ],
      "realWorldConnection": "Counting and collecting in nature",
      "yearAppropriate": [
        3
      ],
      "templates": [
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "COMPARISON"
          ],
          "template": "{character} collected {items} while exploring. How many items in total?",
          "answerTemplate": "{character} collected {result} items",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "items",
              "type": "item"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        }
      ]
    },
    "distractors": [
      {
        "value": 324,
        "displayText": "324",
        "strategy": "WRONG_OPERATION",
        "reasoning": "Multiplied instead of adding"
      },
      {
        "value": 85,
        "displayText": "85",
        "strategy": "PLACE_VALUE_ERROR",
        "reasoning": "Error in carrying to next column"
      },
      {
        "value": 45,
        "displayText": "45",
        "strategy": "PARTIAL_CALCULATION",
        "reasoning": "Stopped calculation early"
      }
    ],
    "enhancementStatus": {
      "level": "partial",
      "requestedFormat": "DIRECT_CALCULATION",
      "actualFormat": "DIRECT_CALCULATION",
      "featuresActive": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "featuresPending": [],
      "isFullyEnhanced": true
    },
    "mathOutput": {
      "operation": "ADDITION",
      "operand_1": 9,
      "operand_2": 36,
      "operand_3": 30,
      "result": 75
    },
    "generationTime": 2,
    "questionId": "q_1759234386225_v4qvxma28",
    "generationSetup": {
      "controller_used": "DIRECT_CALCULATIONController",
      "format_requested": "DIRECT_CALCULATION",
      "format_actual": "DIRECT_CALCULATION",
      "scenario_theme": "NATURE",
      "scenario_id": "nature-3-1759234386225",
      "scenario_selection_method": "requested",
      "distractor_strategies": [
        "WRONG_OPERATION",
        "PLACE_VALUE_ERROR",
        "PARTIAL_CALCULATION"
      ],
      "distractor_count": 3,
      "theme_variety": false,
      "format_variety": false,
      "enhancement_level": "partial",
      "features_active": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "features_pending": [],
      "generation_time_ms": 2
    }
  },
  "metadata": {
    "format": "DIRECT_CALCULATION",
    "cognitive_load": 30,
    "curriculum_alignment": [
      "3N1a",
      "3N1b"
    ],
    "difficulty": "3.1",
    "scenario_theme": "NATURE",
    "distractor_strategies": [
      "WRONG_OPERATION",
      "PLACE_VALUE_ERROR",
      "PARTIAL_CALCULATION"
    ],
    "generation_time_ms": 2,
    "api_version": "2.0",
    "enhancement_status": "partial",
    "format_requested": "DIRECT_CALCULATION",
    "format_used": "DIRECT_CALCULATION",
    "features_active": [
      "enhanced_distractors",
      "rich_scenarios",
      "cognitive_load",
      "advanced_formats"
    ],
    "features_pending": []
  },
  "context": {
    "id": "nature-3-1759234386225",
    "theme": "NATURE",
    "setting": {
      "location": "forest",
      "timeContext": "outdoor exploration",
      "atmosphere": "peaceful"
    },
    "characters": [
      {
        "name": "Ava",
        "role": "student"
      },
      {
        "name": "Mr. Green",
        "role": "park ranger"
      }
    ],
    "items": [
      {
        "name": "flower",
        "category": "NATURE_ITEMS",
        "typicalValue": {
          "min": 1,
          "max": 20,
          "typical": 5,
          "distribution": "normal"
        },
        "unit": "items",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "leaf",
        "category": "NATURE_ITEMS",
        "typicalValue": {
          "min": 1,
          "max": 20,
          "typical": 5,
          "distribution": "normal"
        },
        "unit": "items",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "stone",
        "category": "NATURE_ITEMS",
        "typicalValue": {
          "min": 1,
          "max": 20,
          "typical": 5,
          "distribution": "normal"
        },
        "unit": "items",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "stick",
        "category": "NATURE_ITEMS",
        "typicalValue": {
          "min": 1,
          "max": 20,
          "typical": 5,
          "distribution": "normal"
        },
        "unit": "items",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "acorn",
        "category": "NATURE_ITEMS",
        "typicalValue": {
          "min": 1,
          "max": 20,
          "typical": 5,
          "distribution": "normal"
        },
        "unit": "items",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "feather",
        "category": "NATURE_ITEMS",
        "typicalValue": {
          "min": 1,
          "max": 20,
          "typical": 5,
          "distribution": "normal"
        },
        "unit": "items",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "shell",
        "category": "NATURE_ITEMS",
        "typicalValue": {
          "min": 1,
          "max": 20,
          "typical": 5,
          "distribution": "normal"
        },
        "unit": "items",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "pine cone",
        "category": "NATURE_ITEMS",
        "typicalValue": {
          "min": 1,
          "max": 20,
          "typical": 5,
          "distribution": "normal"
        },
        "unit": "items",
        "attributes": {
          "quality": "standard"
        }
      }
    ],
    "culturalElements": [
      {
        "type": "location",
        "value": "UK countryside",
        "explanation": "British natural environments"
      }
    ],
    "realWorldConnection": "Counting and collecting in nature",
    "yearAppropriate": [
      3
    ],
    "templates": [
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "COMPARISON"
        ],
        "template": "{character} collected {items} while exploring. How many items in total?",
        "answerTemplate": "{character} collected {result} items",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "items",
            "type": "item"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      }
    ]
  }
}
# Test E.7: TRANSPORT theme
{
  "success": true,
  "question": {
    "text": "A {transport} journey costs £33. How much for 30 journeys?",
    "options": [
      {
        "text": "3",
        "value": 3,
        "index": 0
      },
      {
        "text": "90",
        "value": 90,
        "index": 1
      },
      {
        "text": "990",
        "value": 990,
        "index": 2
      },
      {
        "text": "£80.00",
        "value": 80,
        "index": 3
      }
    ],
    "correctIndex": 3,
    "format": "DIRECT_CALCULATION",
    "difficulty": {
      "year": 3,
      "subLevel": 1,
      "displayName": "3.1",
      "cognitiveLoad": 30
    },
    "cognitiveLoad": 30,
    "curriculumTags": [
      "3N1a",
      "3N1b"
    ],
    "scenario": {
      "id": "transport-3-1759234386268",
      "theme": "TRANSPORT",
      "setting": {
        "location": "transport hub",
        "timeContext": "journey planning",
        "atmosphere": "busy"
      },
      "characters": [
        {
          "name": "Jacob",
          "role": "passenger"
        },
        {
          "name": "Mrs. Driver",
          "role": "transport operator"
        }
      ],
      "items": [
        {
          "name": "bus",
          "category": "TRANSPORT",
          "typicalValue": {
            "min": 1.5,
            "max": 15,
            "typical": 5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "train",
          "category": "TRANSPORT",
          "typicalValue": {
            "min": 1.5,
            "max": 15,
            "typical": 5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "taxi",
          "category": "TRANSPORT",
          "typicalValue": {
            "min": 1.5,
            "max": 15,
            "typical": 5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "tube",
          "category": "TRANSPORT",
          "typicalValue": {
            "min": 1.5,
            "max": 15,
            "typical": 5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "bike",
          "category": "TRANSPORT",
          "typicalValue": {
            "min": 1.5,
            "max": 15,
            "typical": 5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        }
      ],
      "culturalElements": [
        {
          "type": "currency",
          "value": "£",
          "explanation": "British pounds for transport fares"
        }
      ],
      "realWorldConnection": "Calculating travel costs and distances",
      "yearAppropriate": [
        3
      ],
      "templates": [
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "MULTI_STEP"
          ],
          "template": "A {transport} journey costs {price}. How much for {quantity} journeys?",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "transport",
              "type": "item"
            },
            {
              "key": "price",
              "type": "value"
            },
            {
              "key": "quantity",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        }
      ]
    },
    "distractors": [
      {
        "value": 3,
        "displayText": "3",
        "strategy": "WRONG_OPERATION",
        "reasoning": "Subtracted instead of adding"
      },
      {
        "value": 990,
        "displayText": "990",
        "strategy": "WRONG_OPERATION",
        "reasoning": "Multiplied instead of adding"
      },
      {
        "value": 90,
        "displayText": "90",
        "strategy": "PLACE_VALUE_ERROR",
        "reasoning": "Error in carrying to next column"
      }
    ],
    "enhancementStatus": {
      "level": "partial",
      "requestedFormat": "DIRECT_CALCULATION",
      "actualFormat": "DIRECT_CALCULATION",
      "featuresActive": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "featuresPending": [],
      "isFullyEnhanced": true
    },
    "mathOutput": {
      "operation": "ADDITION",
      "operand_1": 33,
      "operand_2": 30,
      "operand_3": 17,
      "result": 80
    },
    "generationTime": 1,
    "questionId": "q_1759234386269_vkifl74mq",
    "generationSetup": {
      "controller_used": "DIRECT_CALCULATIONController",
      "format_requested": "DIRECT_CALCULATION",
      "format_actual": "DIRECT_CALCULATION",
      "scenario_theme": "TRANSPORT",
      "scenario_id": "transport-3-1759234386268",
      "scenario_selection_method": "requested",
      "distractor_strategies": [
        "WRONG_OPERATION",
        "WRONG_OPERATION",
        "PLACE_VALUE_ERROR"
      ],
      "distractor_count": 3,
      "theme_variety": false,
      "format_variety": false,
      "enhancement_level": "partial",
      "features_active": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "features_pending": [],
      "generation_time_ms": 1
    }
  },
  "metadata": {
    "format": "DIRECT_CALCULATION",
    "cognitive_load": 30,
    "curriculum_alignment": [
      "3N1a",
      "3N1b"
    ],
    "difficulty": "3.1",
    "scenario_theme": "TRANSPORT",
    "distractor_strategies": [
      "WRONG_OPERATION",
      "WRONG_OPERATION",
      "PLACE_VALUE_ERROR"
    ],
    "generation_time_ms": 1,
    "api_version": "2.0",
    "enhancement_status": "partial",
    "format_requested": "DIRECT_CALCULATION",
    "format_used": "DIRECT_CALCULATION",
    "features_active": [
      "enhanced_distractors",
      "rich_scenarios",
      "cognitive_load",
      "advanced_formats"
    ],
    "features_pending": []
  },
  "context": {
    "id": "transport-3-1759234386268",
    "theme": "TRANSPORT",
    "setting": {
      "location": "transport hub",
      "timeContext": "journey planning",
      "atmosphere": "busy"
    },
    "characters": [
      {
        "name": "Jacob",
        "role": "passenger"
      },
      {
        "name": "Mrs. Driver",
        "role": "transport operator"
      }
    ],
    "items": [
      {
        "name": "bus",
        "category": "TRANSPORT",
        "typicalValue": {
          "min": 1.5,
          "max": 15,
          "typical": 5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "train",
        "category": "TRANSPORT",
        "typicalValue": {
          "min": 1.5,
          "max": 15,
          "typical": 5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "taxi",
        "category": "TRANSPORT",
        "typicalValue": {
          "min": 1.5,
          "max": 15,
          "typical": 5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "tube",
        "category": "TRANSPORT",
        "typicalValue": {
          "min": 1.5,
          "max": 15,
          "typical": 5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "bike",
        "category": "TRANSPORT",
        "typicalValue": {
          "min": 1.5,
          "max": 15,
          "typical": 5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      }
    ],
    "culturalElements": [
      {
        "type": "currency",
        "value": "£",
        "explanation": "British pounds for transport fares"
      }
    ],
    "realWorldConnection": "Calculating travel costs and distances",
    "yearAppropriate": [
      3
    ],
    "templates": [
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "MULTI_STEP"
        ],
        "template": "A {transport} journey costs {price}. How much for {quantity} journeys?",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "transport",
            "type": "item"
          },
          {
            "key": "price",
            "type": "value"
          },
          {
            "key": "quantity",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      }
    ]
  }
}
# Test E.8: COLLECTIONS theme
{
  "success": true,
  "question": {
    "text": "Jacob has sticker, card, coin, stamp, badge, marble, button in their collection. How many altogether?",
    "options": [
      {
        "text": "540",
        "value": 540,
        "index": 0
      },
      {
        "text": "81",
        "value": 81,
        "index": 1
      },
      {
        "text": "91",
        "value": 91,
        "index": 2
      },
      {
        "text": "21",
        "value": 21,
        "index": 3
      }
    ],
    "correctIndex": 1,
    "format": "DIRECT_CALCULATION",
    "difficulty": {
      "year": 3,
      "subLevel": 1,
      "displayName": "3.1",
      "cognitiveLoad": 30
    },
    "cognitiveLoad": 30,
    "curriculumTags": [
      "3N1a",
      "3N1b"
    ],
    "scenario": {
      "id": "collections-3-1759234386315",
      "theme": "COLLECTIONS",
      "setting": {
        "location": "bedroom",
        "timeContext": "organizing collection",
        "atmosphere": "focused"
      },
      "characters": [
        {
          "name": "Jacob",
          "role": "collector"
        },
        {
          "name": "Charlotte",
          "role": "friend"
        }
      ],
      "items": [
        {
          "name": "sticker",
          "category": "COLLECTIBLES",
          "typicalValue": {
            "min": 1,
            "max": 50,
            "typical": 10,
            "distribution": "normal"
          },
          "unit": "items",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "card",
          "category": "COLLECTIBLES",
          "typicalValue": {
            "min": 1,
            "max": 50,
            "typical": 10,
            "distribution": "normal"
          },
          "unit": "items",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "coin",
          "category": "COLLECTIBLES",
          "typicalValue": {
            "min": 1,
            "max": 50,
            "typical": 10,
            "distribution": "normal"
          },
          "unit": "items",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "stamp",
          "category": "COLLECTIBLES",
          "typicalValue": {
            "min": 1,
            "max": 50,
            "typical": 10,
            "distribution": "normal"
          },
          "unit": "items",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "badge",
          "category": "COLLECTIBLES",
          "typicalValue": {
            "min": 1,
            "max": 50,
            "typical": 10,
            "distribution": "normal"
          },
          "unit": "items",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "marble",
          "category": "COLLECTIBLES",
          "typicalValue": {
            "min": 1,
            "max": 50,
            "typical": 10,
            "distribution": "normal"
          },
          "unit": "items",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "button",
          "category": "COLLECTIBLES",
          "typicalValue": {
            "min": 1,
            "max": 50,
            "typical": 10,
            "distribution": "normal"
          },
          "unit": "items",
          "attributes": {
            "quality": "standard"
          }
        }
      ],
      "culturalElements": [
        {
          "type": "hobby",
          "value": "collecting",
          "explanation": "Popular childhood hobby"
        }
      ],
      "realWorldConnection": "Organizing and counting collections",
      "yearAppropriate": [
        3
      ],
      "templates": [
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "ORDERING"
          ],
          "template": "{character} has {items} in their collection. How many altogether?",
          "answerTemplate": "{character} has {result} items total",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "items",
              "type": "item"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        }
      ]
    },
    "distractors": [
      {
        "value": 21,
        "displayText": "21",
        "strategy": "WRONG_OPERATION",
        "reasoning": "Subtracted instead of adding"
      },
      {
        "value": 540,
        "displayText": "540",
        "strategy": "WRONG_OPERATION",
        "reasoning": "Multiplied instead of adding"
      },
      {
        "value": 91,
        "displayText": "91",
        "strategy": "PLACE_VALUE_ERROR",
        "reasoning": "Error in carrying to next column"
      }
    ],
    "enhancementStatus": {
      "level": "partial",
      "requestedFormat": "DIRECT_CALCULATION",
      "actualFormat": "DIRECT_CALCULATION",
      "featuresActive": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "featuresPending": [],
      "isFullyEnhanced": true
    },
    "mathOutput": {
      "operation": "ADDITION",
      "operand_1": 36,
      "operand_2": 15,
      "operand_3": 30,
      "result": 81
    },
    "generationTime": 2,
    "questionId": "q_1759234386315_dsfldufzx",
    "generationSetup": {
      "controller_used": "DIRECT_CALCULATIONController",
      "format_requested": "DIRECT_CALCULATION",
      "format_actual": "DIRECT_CALCULATION",
      "scenario_theme": "COLLECTIONS",
      "scenario_id": "collections-3-1759234386315",
      "scenario_selection_method": "requested",
      "distractor_strategies": [
        "WRONG_OPERATION",
        "WRONG_OPERATION",
        "PLACE_VALUE_ERROR"
      ],
      "distractor_count": 3,
      "theme_variety": false,
      "format_variety": false,
      "enhancement_level": "partial",
      "features_active": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "features_pending": [],
      "generation_time_ms": 2
    }
  },
  "metadata": {
    "format": "DIRECT_CALCULATION",
    "cognitive_load": 30,
    "curriculum_alignment": [
      "3N1a",
      "3N1b"
    ],
    "difficulty": "3.1",
    "scenario_theme": "COLLECTIONS",
    "distractor_strategies": [
      "WRONG_OPERATION",
      "WRONG_OPERATION",
      "PLACE_VALUE_ERROR"
    ],
    "generation_time_ms": 2,
    "api_version": "2.0",
    "enhancement_status": "partial",
    "format_requested": "DIRECT_CALCULATION",
    "format_used": "DIRECT_CALCULATION",
    "features_active": [
      "enhanced_distractors",
      "rich_scenarios",
      "cognitive_load",
      "advanced_formats"
    ],
    "features_pending": []
  },
  "context": {
    "id": "collections-3-1759234386315",
    "theme": "COLLECTIONS",
    "setting": {
      "location": "bedroom",
      "timeContext": "organizing collection",
      "atmosphere": "focused"
    },
    "characters": [
      {
        "name": "Jacob",
        "role": "collector"
      },
      {
        "name": "Charlotte",
        "role": "friend"
      }
    ],
    "items": [
      {
        "name": "sticker",
        "category": "COLLECTIBLES",
        "typicalValue": {
          "min": 1,
          "max": 50,
          "typical": 10,
          "distribution": "normal"
        },
        "unit": "items",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "card",
        "category": "COLLECTIBLES",
        "typicalValue": {
          "min": 1,
          "max": 50,
          "typical": 10,
          "distribution": "normal"
        },
        "unit": "items",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "coin",
        "category": "COLLECTIBLES",
        "typicalValue": {
          "min": 1,
          "max": 50,
          "typical": 10,
          "distribution": "normal"
        },
        "unit": "items",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "stamp",
        "category": "COLLECTIBLES",
        "typicalValue": {
          "min": 1,
          "max": 50,
          "typical": 10,
          "distribution": "normal"
        },
        "unit": "items",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "badge",
        "category": "COLLECTIBLES",
        "typicalValue": {
          "min": 1,
          "max": 50,
          "typical": 10,
          "distribution": "normal"
        },
        "unit": "items",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "marble",
        "category": "COLLECTIBLES",
        "typicalValue": {
          "min": 1,
          "max": 50,
          "typical": 10,
          "distribution": "normal"
        },
        "unit": "items",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "button",
        "category": "COLLECTIBLES",
        "typicalValue": {
          "min": 1,
          "max": 50,
          "typical": 10,
          "distribution": "normal"
        },
        "unit": "items",
        "attributes": {
          "quality": "standard"
        }
      }
    ],
    "culturalElements": [
      {
        "type": "hobby",
        "value": "collecting",
        "explanation": "Popular childhood hobby"
      }
    ],
    "realWorldConnection": "Organizing and counting collections",
    "yearAppropriate": [
      3
    ],
    "templates": [
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "ORDERING"
        ],
        "template": "{character} has {items} in their collection. How many altogether?",
        "answerTemplate": "{character} has {result} items total",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "items",
            "type": "item"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      }
    ]
  }
}
# Test E.9: HOUSEHOLD theme
{
  "success": true,
  "question": {
    "text": "Charlotte needs to tidy cup, plate, spoon, towel, pillow, book, toy, sock. How many items to put away?",
    "options": [
      {
        "text": "32",
        "value": 32,
        "index": 0
      },
      {
        "text": "33",
        "value": 33,
        "index": 1
      },
      {
        "text": "69",
        "value": 69,
        "index": 2
      },
      {
        "text": "59",
        "value": 59,
        "index": 3
      }
    ],
    "correctIndex": 3,
    "format": "DIRECT_CALCULATION",
    "difficulty": {
      "year": 3,
      "subLevel": 1,
      "displayName": "3.1",
      "cognitiveLoad": 30
    },
    "cognitiveLoad": 30,
    "curriculumTags": [
      "3N1a",
      "3N1b"
    ],
    "scenario": {
      "id": "household-3-1759234386361",
      "theme": "HOUSEHOLD",
      "setting": {
        "location": "bathroom",
        "timeContext": "tidying up",
        "atmosphere": "homely"
      },
      "characters": [
        {
          "name": "Charlotte",
          "role": "child"
        },
        {
          "name": "Mum",
          "role": "parent"
        }
      ],
      "items": [
        {
          "name": "cup",
          "category": "HOUSEHOLD_ITEMS",
          "typicalValue": {
            "min": 1,
            "max": 30,
            "typical": 8,
            "distribution": "normal"
          },
          "unit": "items",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "plate",
          "category": "HOUSEHOLD_ITEMS",
          "typicalValue": {
            "min": 1,
            "max": 30,
            "typical": 8,
            "distribution": "normal"
          },
          "unit": "items",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "spoon",
          "category": "HOUSEHOLD_ITEMS",
          "typicalValue": {
            "min": 1,
            "max": 30,
            "typical": 8,
            "distribution": "normal"
          },
          "unit": "items",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "towel",
          "category": "HOUSEHOLD_ITEMS",
          "typicalValue": {
            "min": 1,
            "max": 30,
            "typical": 8,
            "distribution": "normal"
          },
          "unit": "items",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "pillow",
          "category": "HOUSEHOLD_ITEMS",
          "typicalValue": {
            "min": 1,
            "max": 30,
            "typical": 8,
            "distribution": "normal"
          },
          "unit": "items",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "book",
          "category": "HOUSEHOLD_ITEMS",
          "typicalValue": {
            "min": 1,
            "max": 30,
            "typical": 8,
            "distribution": "normal"
          },
          "unit": "items",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "toy",
          "category": "HOUSEHOLD_ITEMS",
          "typicalValue": {
            "min": 1,
            "max": 30,
            "typical": 8,
            "distribution": "normal"
          },
          "unit": "items",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "sock",
          "category": "HOUSEHOLD_ITEMS",
          "typicalValue": {
            "min": 1,
            "max": 30,
            "typical": 8,
            "distribution": "normal"
          },
          "unit": "items",
          "attributes": {
            "quality": "standard"
          }
        }
      ],
      "culturalElements": [
        {
          "type": "custom",
          "value": "household chores",
          "explanation": "Daily home activities"
        }
      ],
      "realWorldConnection": "Organizing and counting household items",
      "yearAppropriate": [
        3
      ],
      "templates": [
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "COMPARISON"
          ],
          "template": "{character} needs to tidy {items}. How many items to put away?",
          "answerTemplate": "{character} needs to put away {result} items",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "items",
              "type": "item"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        }
      ]
    },
    "distractors": [
      {
        "value": 32,
        "displayText": "32",
        "strategy": "WRONG_OPERATION",
        "reasoning": "Multiplied instead of adding"
      },
      {
        "value": 69,
        "displayText": "69",
        "strategy": "PLACE_VALUE_ERROR",
        "reasoning": "Error in carrying to next column"
      },
      {
        "value": 33,
        "displayText": "33",
        "strategy": "PARTIAL_CALCULATION",
        "reasoning": "Stopped calculation early"
      }
    ],
    "enhancementStatus": {
      "level": "partial",
      "requestedFormat": "DIRECT_CALCULATION",
      "actualFormat": "DIRECT_CALCULATION",
      "featuresActive": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "featuresPending": [],
      "isFullyEnhanced": true
    },
    "mathOutput": {
      "operation": "ADDITION",
      "operand_1": 1,
      "operand_2": 32,
      "operand_3": 26,
      "result": 59
    },
    "generationTime": 0,
    "questionId": "q_1759234386361_34vhxxwic",
    "generationSetup": {
      "controller_used": "DIRECT_CALCULATIONController",
      "format_requested": "DIRECT_CALCULATION",
      "format_actual": "DIRECT_CALCULATION",
      "scenario_theme": "HOUSEHOLD",
      "scenario_id": "household-3-1759234386361",
      "scenario_selection_method": "requested",
      "distractor_strategies": [
        "WRONG_OPERATION",
        "PLACE_VALUE_ERROR",
        "PARTIAL_CALCULATION"
      ],
      "distractor_count": 3,
      "theme_variety": false,
      "format_variety": false,
      "enhancement_level": "partial",
      "features_active": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "features_pending": [],
      "generation_time_ms": 0
    }
  },
  "metadata": {
    "format": "DIRECT_CALCULATION",
    "cognitive_load": 30,
    "curriculum_alignment": [
      "3N1a",
      "3N1b"
    ],
    "difficulty": "3.1",
    "scenario_theme": "HOUSEHOLD",
    "distractor_strategies": [
      "WRONG_OPERATION",
      "PLACE_VALUE_ERROR",
      "PARTIAL_CALCULATION"
    ],
    "generation_time_ms": 0,
    "api_version": "2.0",
    "enhancement_status": "partial",
    "format_requested": "DIRECT_CALCULATION",
    "format_used": "DIRECT_CALCULATION",
    "features_active": [
      "enhanced_distractors",
      "rich_scenarios",
      "cognitive_load",
      "advanced_formats"
    ],
    "features_pending": []
  },
  "context": {
    "id": "household-3-1759234386361",
    "theme": "HOUSEHOLD",
    "setting": {
      "location": "bathroom",
      "timeContext": "tidying up",
      "atmosphere": "homely"
    },
    "characters": [
      {
        "name": "Charlotte",
        "role": "child"
      },
      {
        "name": "Mum",
        "role": "parent"
      }
    ],
    "items": [
      {
        "name": "cup",
        "category": "HOUSEHOLD_ITEMS",
        "typicalValue": {
          "min": 1,
          "max": 30,
          "typical": 8,
          "distribution": "normal"
        },
        "unit": "items",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "plate",
        "category": "HOUSEHOLD_ITEMS",
        "typicalValue": {
          "min": 1,
          "max": 30,
          "typical": 8,
          "distribution": "normal"
        },
        "unit": "items",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "spoon",
        "category": "HOUSEHOLD_ITEMS",
        "typicalValue": {
          "min": 1,
          "max": 30,
          "typical": 8,
          "distribution": "normal"
        },
        "unit": "items",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "towel",
        "category": "HOUSEHOLD_ITEMS",
        "typicalValue": {
          "min": 1,
          "max": 30,
          "typical": 8,
          "distribution": "normal"
        },
        "unit": "items",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "pillow",
        "category": "HOUSEHOLD_ITEMS",
        "typicalValue": {
          "min": 1,
          "max": 30,
          "typical": 8,
          "distribution": "normal"
        },
        "unit": "items",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "book",
        "category": "HOUSEHOLD_ITEMS",
        "typicalValue": {
          "min": 1,
          "max": 30,
          "typical": 8,
          "distribution": "normal"
        },
        "unit": "items",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "toy",
        "category": "HOUSEHOLD_ITEMS",
        "typicalValue": {
          "min": 1,
          "max": 30,
          "typical": 8,
          "distribution": "normal"
        },
        "unit": "items",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "sock",
        "category": "HOUSEHOLD_ITEMS",
        "typicalValue": {
          "min": 1,
          "max": 30,
          "typical": 8,
          "distribution": "normal"
        },
        "unit": "items",
        "attributes": {
          "quality": "standard"
        }
      }
    ],
    "culturalElements": [
      {
        "type": "custom",
        "value": "household chores",
        "explanation": "Daily home activities"
      }
    ],
    "realWorldConnection": "Organizing and counting household items",
    "yearAppropriate": [
      3
    ],
    "templates": [
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "COMPARISON"
        ],
        "template": "{character} needs to tidy {items}. How many items to put away?",
        "answerTemplate": "{character} needs to put away {result} items",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "items",
            "type": "item"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      }
    ]
  }
}
# Test E.10: CELEBRATIONS theme
{
  "success": true,
  "question": {
    "text": "Abigail is planning a {celebration}. The supplies cost £9.00, £31.00. What is the total?",
    "options": [
      {
        "text": "40",
        "value": 40,
        "index": 0
      },
      {
        "text": "£61.00",
        "value": 61,
        "index": 1
      },
      {
        "text": "71",
        "value": 71,
        "index": 2
      },
      {
        "text": "279",
        "value": 279,
        "index": 3
      }
    ],
    "correctIndex": 1,
    "format": "DIRECT_CALCULATION",
    "difficulty": {
      "year": 3,
      "subLevel": 1,
      "displayName": "3.1",
      "cognitiveLoad": 30
    },
    "cognitiveLoad": 30,
    "curriculumTags": [
      "3N1a",
      "3N1b"
    ],
    "scenario": {
      "id": "celebrations-3-1759234386414",
      "theme": "CELEBRATIONS",
      "setting": {
        "location": "party venue",
        "timeContext": "celebration planning",
        "atmosphere": "festive"
      },
      "characters": [
        {
          "name": "Abigail",
          "role": "party organizer"
        },
        {
          "name": "Mia",
          "role": "guest"
        }
      ],
      "items": [
        {
          "name": "balloon",
          "category": "PARTY_SUPPLIES",
          "typicalValue": {
            "min": 0.5,
            "max": 20,
            "typical": 5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "cake",
          "category": "PARTY_SUPPLIES",
          "typicalValue": {
            "min": 0.5,
            "max": 20,
            "typical": 5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "present",
          "category": "PARTY_SUPPLIES",
          "typicalValue": {
            "min": 0.5,
            "max": 20,
            "typical": 5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "decoration",
          "category": "PARTY_SUPPLIES",
          "typicalValue": {
            "min": 0.5,
            "max": 20,
            "typical": 5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "party hat",
          "category": "PARTY_SUPPLIES",
          "typicalValue": {
            "min": 0.5,
            "max": 20,
            "typical": 5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        },
        {
          "name": "candle",
          "category": "PARTY_SUPPLIES",
          "typicalValue": {
            "min": 0.5,
            "max": 20,
            "typical": 5,
            "distribution": "normal"
          },
          "unit": "£",
          "attributes": {
            "quality": "standard"
          }
        }
      ],
      "culturalElements": [
        {
          "type": "currency",
          "value": "£",
          "explanation": "British pounds for party supplies"
        },
        {
          "type": "event",
          "value": "celebration",
          "explanation": "Special occasions and festivals"
        }
      ],
      "realWorldConnection": "Planning and budgeting for celebrations",
      "yearAppropriate": [
        3
      ],
      "templates": [
        {
          "formatCompatibility": [
            "DIRECT_CALCULATION",
            "MULTI_STEP"
          ],
          "template": "{character} is planning a {celebration}. The supplies cost {prices}. What is the total?",
          "answerTemplate": "The total cost is {result}",
          "placeholders": [
            {
              "key": "character",
              "type": "character"
            },
            {
              "key": "celebration",
              "type": "event"
            },
            {
              "key": "prices",
              "type": "value"
            },
            {
              "key": "result",
              "type": "value"
            }
          ]
        }
      ]
    },
    "distractors": [
      {
        "value": 279,
        "displayText": "279",
        "strategy": "WRONG_OPERATION",
        "reasoning": "Multiplied instead of adding"
      },
      {
        "value": 71,
        "displayText": "71",
        "strategy": "PLACE_VALUE_ERROR",
        "reasoning": "Error in carrying to next column"
      },
      {
        "value": 40,
        "displayText": "40",
        "strategy": "PARTIAL_CALCULATION",
        "reasoning": "Stopped calculation early"
      }
    ],
    "enhancementStatus": {
      "level": "partial",
      "requestedFormat": "DIRECT_CALCULATION",
      "actualFormat": "DIRECT_CALCULATION",
      "featuresActive": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "featuresPending": [],
      "isFullyEnhanced": true
    },
    "mathOutput": {
      "operation": "ADDITION",
      "operand_1": 9,
      "operand_2": 31,
      "operand_3": 21,
      "result": 61
    },
    "generationTime": 2,
    "questionId": "q_1759234386414_kkljjuemz",
    "generationSetup": {
      "controller_used": "DIRECT_CALCULATIONController",
      "format_requested": "DIRECT_CALCULATION",
      "format_actual": "DIRECT_CALCULATION",
      "scenario_theme": "CELEBRATIONS",
      "scenario_id": "celebrations-3-1759234386414",
      "scenario_selection_method": "requested",
      "distractor_strategies": [
        "WRONG_OPERATION",
        "PLACE_VALUE_ERROR",
        "PARTIAL_CALCULATION"
      ],
      "distractor_count": 3,
      "theme_variety": false,
      "format_variety": false,
      "enhancement_level": "partial",
      "features_active": [
        "enhanced_distractors",
        "rich_scenarios",
        "cognitive_load",
        "advanced_formats"
      ],
      "features_pending": [],
      "generation_time_ms": 2
    }
  },
  "metadata": {
    "format": "DIRECT_CALCULATION",
    "cognitive_load": 30,
    "curriculum_alignment": [
      "3N1a",
      "3N1b"
    ],
    "difficulty": "3.1",
    "scenario_theme": "CELEBRATIONS",
    "distractor_strategies": [
      "WRONG_OPERATION",
      "PLACE_VALUE_ERROR",
      "PARTIAL_CALCULATION"
    ],
    "generation_time_ms": 2,
    "api_version": "2.0",
    "enhancement_status": "partial",
    "format_requested": "DIRECT_CALCULATION",
    "format_used": "DIRECT_CALCULATION",
    "features_active": [
      "enhanced_distractors",
      "rich_scenarios",
      "cognitive_load",
      "advanced_formats"
    ],
    "features_pending": []
  },
  "context": {
    "id": "celebrations-3-1759234386414",
    "theme": "CELEBRATIONS",
    "setting": {
      "location": "party venue",
      "timeContext": "celebration planning",
      "atmosphere": "festive"
    },
    "characters": [
      {
        "name": "Abigail",
        "role": "party organizer"
      },
      {
        "name": "Mia",
        "role": "guest"
      }
    ],
    "items": [
      {
        "name": "balloon",
        "category": "PARTY_SUPPLIES",
        "typicalValue": {
          "min": 0.5,
          "max": 20,
          "typical": 5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "cake",
        "category": "PARTY_SUPPLIES",
        "typicalValue": {
          "min": 0.5,
          "max": 20,
          "typical": 5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "present",
        "category": "PARTY_SUPPLIES",
        "typicalValue": {
          "min": 0.5,
          "max": 20,
          "typical": 5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "decoration",
        "category": "PARTY_SUPPLIES",
        "typicalValue": {
          "min": 0.5,
          "max": 20,
          "typical": 5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "party hat",
        "category": "PARTY_SUPPLIES",
        "typicalValue": {
          "min": 0.5,
          "max": 20,
          "typical": 5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      },
      {
        "name": "candle",
        "category": "PARTY_SUPPLIES",
        "typicalValue": {
          "min": 0.5,
          "max": 20,
          "typical": 5,
          "distribution": "normal"
        },
        "unit": "£",
        "attributes": {
          "quality": "standard"
        }
      }
    ],
    "culturalElements": [
      {
        "type": "currency",
        "value": "£",
        "explanation": "British pounds for party supplies"
      },
      {
        "type": "event",
        "value": "celebration",
        "explanation": "Special occasions and festivals"
      }
    ],
    "realWorldConnection": "Planning and budgeting for celebrations",
    "yearAppropriate": [
      3
    ],
    "templates": [
      {
        "formatCompatibility": [
          "DIRECT_CALCULATION",
          "MULTI_STEP"
        ],
        "template": "{character} is planning a {celebration}. The supplies cost {prices}. What is the total?",
        "answerTemplate": "The total cost is {result}",
        "placeholders": [
          {
            "key": "character",
            "type": "character"
          },
          {
            "key": "celebration",
            "type": "event"
          },
          {
            "key": "prices",
            "type": "value"
          },
          {
            "key": "result",
            "type": "value"
          }
        ]
      }
    ]
  }
}

--- SUITE F: EDGE CASE AND ERROR HANDLING TESTS ---
Testing invalid inputs and expected error responses...
# Test F.1: Request with a non-existent model_id
{
  "error": "Unsupported model_id: FOOBAR. Supported models: ADDITION, SUBTRACTION, MULTIPLICATION, DIVISION, PERCENTAGE, FRACTION, COUNTING, TIME_RATE, CONVERSION, COMPARISON, MULTI_STEP, LINEAR_EQUATION, UNIT_RATE, COIN_RECOGNITION, CHANGE_CALCULATION, MONEY_COMBINATIONS, MIXED_MONEY_UNITS, MONEY_FRACTIONS, MONEY_SCALING, SHAPE_RECOGNITION, SHAPE_PROPERTIES, ANGLE_MEASUREMENT, POSITION_DIRECTION, AREA_PERIMETER"
}
# Test F.2: Request with an invalid difficulty_level
{
  "error": "difficulty_level must be X.Y where X=1-6 and Y=1-4"
}
# Test F.3: Request with an invalid format_preference
{
  "error": "Invalid format_preference. Valid options: DIRECT_CALCULATION, COMPARISON, ESTIMATION, ORDERING, VALIDATION, MULTI_STEP, MISSING_VALUE, PATTERN_RECOGNITION"
}
# Test F.4: Request with a dedicated broken model (TEST_BROKEN)
{
  "error": "Unsupported model_id: TEST_BROKEN. Supported models: ADDITION, SUBTRACTION, MULTIPLICATION, DIVISION, PERCENTAGE, FRACTION, COUNTING, TIME_RATE, CONVERSION, COMPARISON, MULTI_STEP, LINEAR_EQUATION, UNIT_RATE, COIN_RECOGNITION, CHANGE_CALCULATION, MONEY_COMBINATIONS, MIXED_MONEY_UNITS, MONEY_FRACTIONS, MONEY_SCALING, SHAPE_RECOGNITION, SHAPE_PROPERTIES, ANGLE_MEASUREMENT, POSITION_DIRECTION, AREA_PERIMETER"
}
# Test F.5: Request with a quantity greater than 20
{
  "error": "quantity must be between 1 and 20"
}
# Test F.6: Request missing the required model_id field
{
  "error": "model_id is required"
}

--- SUITE G: BATCH GENERATION TESTS ---
Testing the ability to generate multiple questions in one request...
# Test G.1: Request a batch of 5 questions
{
  "success": true,
  "questions": [
    {
      "text": "Liam buys an apple for 38p and pays with £2. How much change does Liam get?",
      "options": [
        {
          "text": "2.62",
          "value": 2.62,
          "index": 0
        },
        {
          "text": "72",
          "value": 72,
          "index": 1
        },
        {
          "text": "£1.62",
          "value": 1.62,
          "index": 2
        },
        {
          "text": "0.62",
          "value": 0.62,
          "index": 3
        }
      ],
      "correctIndex": 2,
      "format": "DIRECT_CALCULATION",
      "difficulty": {
        "year": 3,
        "subLevel": 3,
        "displayName": "3.3",
        "cognitiveLoad": 40
      },
      "cognitiveLoad": 40,
      "curriculumTags": [
        "3N1c",
        "3N1d"
      ],
      "scenario": {
        "id": "shop-002-realistic-general",
        "theme": "SHOPPING",
        "setting": {
          "location": "local shop",
          "timeContext": "after school",
          "atmosphere": "friendly"
        },
        "characters": [
          {
            "name": "Liam",
            "role": "student"
          }
        ],
        "items": [
          {
            "name": "apple",
            "category": "FOOD_DRINK",
            "typicalValue": {
              "min": 0.2,
              "max": 0.5,
              "typical": 0.35,
              "distribution": "normal"
            },
            "unit": "£",
            "attributes": {
              "quality": "standard"
            }
          },
          {
            "name": "banana",
            "category": "FOOD_DRINK",
            "typicalValue": {
              "min": 0.15,
              "max": 0.4,
              "typical": 0.25,
              "distribution": "normal"
            },
            "unit": "£",
            "attributes": {
              "quality": "standard"
            }
          },
          {
            "name": "sandwich",
            "category": "FOOD_DRINK",
            "typicalValue": {
              "min": 2.5,
              "max": 6,
              "typical": 4,
              "distribution": "normal"
            },
            "unit": "£",
            "attributes": {
              "quality": "standard"
            }
          },
          {
            "name": "drink",
            "category": "FOOD_DRINK",
            "typicalValue": {
              "min": 0.8,
              "max": 2.5,
              "typical": 1.5,
              "distribution": "normal"
            },
            "unit": "£",
            "attributes": {
              "quality": "standard"
            }
          },
          {
            "name": "cake",
            "category": "FOOD_DRINK",
            "typicalValue": {
              "min": 1.5,
              "max": 4,
              "typical": 2.5,
              "distribution": "normal"
            },
            "unit": "£",
            "attributes": {
              "quality": "standard"
            }
          },
          {
            "name": "biscuit",
            "category": "FOOD_DRINK",
            "typicalValue": {
              "min": 0.8,
              "max": 2,
              "typical": 1.2,
              "distribution": "normal"
            },
            "unit": "£",
            "attributes": {
              "quality": "standard"
            }
          },
          {
            "name": "sweet",
            "category": "FOOD_DRINK",
            "typicalValue": {
              "min": 0.1,
              "max": 1,
              "typical": 0.5,
              "distribution": "normal"
            },
            "unit": "£",
            "attributes": {
              "quality": "standard"
            }
          },
          {
            "name": "chocolate",
            "category": "FOOD_DRINK",
            "typicalValue": {
              "min": 0.6,
              "max": 3,
              "typical": 1.5,
              "distribution": "normal"
            },
            "unit": "£",
            "attributes": {
              "quality": "standard"
            }
          },
          {
            "name": "pen",
            "category": "SCHOOL_SUPPLIES",
            "typicalValue": {
              "min": 0.5,
              "max": 2,
              "typical": 1,
              "distribution": "normal"
            },
            "unit": "£",
            "attributes": {
              "quality": "standard"
            }
          },
          {
            "name": "pencil",
            "category": "SCHOOL_SUPPLIES",
            "typicalValue": {
              "min": 0.2,
              "max": 1,
              "typical": 0.5,
              "distribution": "normal"
            },
            "unit": "£",
            "attributes": {
              "quality": "standard"
            }
          },
          {
            "name": "ruler",
            "category": "SCHOOL_SUPPLIES",
            "typicalValue": {
              "min": 0.8,
              "max": 2.5,
              "typical": 1.5,
              "distribution": "normal"
            },
            "unit": "£",
            "attributes": {
              "quality": "standard"
            }
          },
          {
            "name": "notebook",
            "category": "SCHOOL_SUPPLIES",
            "typicalValue": {
              "min": 1,
              "max": 4,
              "typical": 2,
              "distribution": "normal"
            },
            "unit": "£",
            "attributes": {
              "quality": "standard"
            }
          },
          {
            "name": "eraser",
            "category": "SCHOOL_SUPPLIES",
            "typicalValue": {
              "min": 0.3,
              "max": 1.5,
              "typical": 0.75,
              "distribution": "normal"
            },
            "unit": "£",
            "attributes": {
              "quality": "standard"
            }
          },
          {
            "name": "book",
            "category": "BOOKS_MEDIA",
            "typicalValue": {
              "min": 3,
              "max": 15,
              "typical": 8,
              "distribution": "normal"
            },
            "unit": "£",
            "attributes": {
              "quality": "standard"
            }
          },
          {
            "name": "comic",
            "category": "BOOKS_MEDIA",
            "typicalValue": {
              "min": 2,
              "max": 5,
              "typical": 3,
              "distribution": "normal"
            },
            "unit": "£",
            "attributes": {
              "quality": "standard"
            }
          },
          {
            "name": "magazine",
            "category": "BOOKS_MEDIA",
            "typicalValue": {
              "min": 2.5,
              "max": 6,
              "typical": 4,
              "distribution": "normal"
            },
            "unit": "£",
            "attributes": {
              "quality": "standard"
            }
          },
          {
            "name": "toy",
            "category": "TOYS_GAMES",
            "typicalValue": {
              "min": 5,
              "max": 25,
              "typical": 12,
              "distribution": "normal"
            },
            "unit": "£",
            "attributes": {
              "quality": "standard"
            }
          },
          {
            "name": "game",
            "category": "TOYS_GAMES",
            "typicalValue": {
              "min": 8,
              "max": 60,
              "typical": 25,
              "distribution": "normal"
            },
            "unit": "£",
            "attributes": {
              "quality": "standard"
            }
          },
          {
            "name": "puzzle",
            "category": "TOYS_GAMES",
            "typicalValue": {
              "min": 5,
              "max": 20,
              "typical": 12,
              "distribution": "normal"
            },
            "unit": "£",
            "attributes": {
              "quality": "standard"
            }
          },
          {
            "name": "sticker",
            "category": "TOYS_GAMES",
            "typicalValue": {
              "min": 0.2,
              "max": 2,
              "typical": 0.8,
              "distribution": "normal"
            },
            "unit": "£",
            "attributes": {
              "quality": "standard"
            }
          },
          {
            "name": "badge",
            "category": "TOYS_GAMES",
            "typicalValue": {
              "min": 0.5,
              "max": 3,
              "typical": 1.5,
              "distribution": "normal"
            },
            "unit": "£",
            "attributes": {
              "quality": "standard"
            }
          },
          {
            "name": "poster",
            "category": "BOOKS_MEDIA",
            "typicalValue": {
              "min": 2,
              "max": 8,
              "typical": 4,
              "distribution": "normal"
            },
            "unit": "£",
            "attributes": {
              "quality": "standard"
            }
          },
          {
            "name": "card",
            "category": "BOOKS_MEDIA",
            "typicalValue": {
              "min": 0.5,
              "max": 4,
              "typical": 2,
              "distribution": "normal"
            },
            "unit": "£",
            "attributes": {
              "quality": "standard"
            }
          }
        ],
        "culturalElements": [
          {
            "type": "currency",
            "value": "£",
            "explanation": "British pounds"
          },
          {
            "type": "location",
            "value": "UK local shop",
            "explanation": "Typical British corner shop"
          }
        ],
        "realWorldConnection": "Everyday shopping with realistic UK prices",
        "yearAppropriate": [
          1,
          2,
          3,
          4,
          5,
          6
        ],
        "templates": [
          {
            "formatCompatibility": [
              "DIRECT_CALCULATION",
              "MULTI_STEP"
            ],
            "modelCompatibility": [
              "ADDITION"
            ],
            "operandCount": 3,
            "template": "{character} buys {article1} {item1} for {price1}, {article2} {item2} for {price2}, and {article3} {item3} for {price3}. What is the total cost?",
            "answerTemplate": "The total cost is {result}",
            "placeholders": [
              {
                "key": "character",
                "type": "character"
              },
              {
                "key": "item1",
                "type": "item"
              },
              {
                "key": "item2",
                "type": "item"
              },
              {
                "key": "item3",
                "type": "item"
              },
              {
                "key": "price1",
                "type": "value"
              },
              {
                "key": "price2",
                "type": "value"
              },
              {
                "key": "price3",
                "type": "value"
              },
              {
                "key": "result",
                "type": "value"
              }
            ]
          },
          {
            "formatCompatibility": [
              "DIRECT_CALCULATION",
              "MULTI_STEP"
            ],
            "modelCompatibility": [
              "ADDITION"
            ],
            "operandCount": 2,
            "template": "{character} buys {article1} {item1} for {price1} and {article2} {item2} for {price2}. What is the total cost?",
            "answerTemplate": "The total cost is {result}",
            "placeholders": [
              {
                "key": "character",
                "type": "character"
              },
              {
                "key": "item1",
                "type": "item"
              },
              {
                "key": "item2",
                "type": "item"
              },
              {
                "key": "price1",
                "type": "value"
              },
              {
                "key": "price2",
                "type": "value"
              },
              {
                "key": "result",
                "type": "value"
              }
            ]
          },
          {
            "formatCompatibility": [
              "DIRECT_CALCULATION"
            ],
            "modelCompatibility": [
              "SUBTRACTION",
              "CHANGE_CALCULATION"
            ],
            "template": "{character} buys {article} {item} for {price} and pays with {payment}. How much change does {character} get?",
            "answerTemplate": "{character} receives {result} in change",
            "placeholders": [
              {
                "key": "character",
                "type": "character"
              },
              {
                "key": "item",
                "type": "item"
              },
              {
                "key": "price",
                "type": "value"
              },
              {
                "key": "payment",
                "type": "value"
              },
              {
                "key": "result",
                "type": "value"
              }
            ]
          },
          {
            "formatCompatibility": [
              "DIRECT_CALCULATION"
            ],
            "modelCompatibility": [
              "MULTIPLICATION"
            ],
            "template": "{character} buys {quantity} {item} at {price} each. What is the total cost?",
            "answerTemplate": "The total cost is {result}",
            "placeholders": [
              {
                "key": "character",
                "type": "character"
              },
              {
                "key": "quantity",
                "type": "value"
              },
              {
                "key": "item",
                "type": "item"
              },
              {
                "key": "price",
                "type": "value"
              },
              {
                "key": "result",
                "type": "value"
              }
            ]
          },
          {
            "formatCompatibility": [
              "DIRECT_CALCULATION"
            ],
            "modelCompatibility": [
              "DIVISION"
            ],
            "template": "{character} has {total} to spend equally on {quantity} {item}. How much can {character} spend on each one?",
            "answerTemplate": "{character} can spend {result} on each {item}",
            "placeholders": [
              {
                "key": "character",
                "type": "character"
              },
              {
                "key": "total",
                "type": "value"
              },
              {
                "key": "quantity",
                "type": "value"
              },
              {
                "key": "item",
                "type": "item"
              },
              {
                "key": "result",
                "type": "value"
              }
            ]
          },
          {
            "formatCompatibility": [
              "DIRECT_CALCULATION",
              "COMPARISON",
              "ESTIMATION",
              "MULTI_STEP"
            ],
            "template": "{character} goes to the shop and buys {items}. How much does {character} spend in total?",
            "answerTemplate": "{character} spends {result} in total",
            "placeholders": [
              {
                "key": "character",
                "type": "character"
              },
              {
                "key": "items",
                "type": "item_list"
              },
              {
                "key": "result",
                "type": "value"
              }
            ]
          },
          {
            "formatCompatibility": [
              "ESTIMATION"
            ],
            "template": "Estimate: If {character} buys {items}, about how much will it cost?",
            "answerTemplate": "It will cost approximately {result}",
            "placeholders": [
              {
                "key": "character",
                "type": "character"
              },
              {
                "key": "items",
                "type": "item_list"
              },
              {
                "key": "result",
                "type": "value"
              }
            ]
          },
          {
            "formatCompatibility": [
              "VALIDATION"
            ],
            "template": "{character} calculated that {items} costs {amount}. Is this correct?",
            "answerTemplate": "{validation_result}",
            "placeholders": [
              {
                "key": "character",
                "type": "character"
              },
              {
                "key": "items",
                "type": "item_list"
              },
              {
                "key": "amount",
                "type": "value"
              },
              {
                "key": "validation_result",
                "type": "boolean"
              }
            ]
          }
        ]
      },
      "distractors": [
        {
          "value": 72,
          "displayText": "72",
          "strategy": "WRONG_OPERATION",
          "reasoning": "Added instead of subtracting"
        },
        {
          "value": 2.62,
          "displayText": "2.62",
          "strategy": "CLOSE_VALUE",
          "reasoning": "Off by 1"
        },
        {
          "value": 0.62,
          "displayText": "0.62",
          "strategy": "CLOSE_VALUE",
          "reasoning": "Off by 1"
        }
      ],
      "enhancementStatus": {
        "level": "partial",
        "requestedFormat": "DIRECT_CALCULATION",
        "actualFormat": "DIRECT_CALCULATION",
        "featuresActive": [
          "enhanced_distractors",
          "rich_scenarios",
          "cognitive_load",
          "advanced_formats"
        ],
        "featuresPending": [],
        "isFullyEnhanced": true
      },
      "mathOutput": {
        "operation": "SUBTRACTION",
        "subtrahend": 0.38,
        "minuend": 2,
        "result": 1.62
      },
      "generationTime": 1,
      "questionId": "q_1759234386722_o5ua91qv9",
      "generationSetup": {
        "controller_used": "DIRECT_CALCULATIONController",
        "format_requested": "DIRECT_CALCULATION",
        "format_actual": "DIRECT_CALCULATION",
        "scenario_theme": "SHOPPING",
        "scenario_id": "shop-002-realistic-general",
        "scenario_selection_method": "default",
        "distractor_strategies": [
          "WRONG_OPERATION",
          "CLOSE_VALUE",
          "CLOSE_VALUE"
        ],
        "distractor_count": 3,
        "theme_variety": false,
        "format_variety": false,
        "enhancement_level": "partial",
        "features_active": [
          "enhanced_distractors",
          "rich_scenarios",
          "cognitive_load",
          "advanced_formats"
        ],
        "features_pending": [],
        "generation_time_ms": 1
      }
    },
    {
      "text": "Liam needs to solve: 76 - 14\\n\\nWhich answer is correct?\\nA) 90  B) 62  C) 620  D) 60",
      "options": [
        {
          "text": "620",
          "value": 620,
          "index": 0
        },
        {
          "text": "60",
          "value": 60,
          "index": 1
        },
        {
          "text": "£62.00",
          "value": 62,
          "index": 2
        },
        {
          "text": "90",
          "value": 90,
          "index": 3
        }
      ],
      "correctIndex": 2,
      "questionContent": {
        "fullText": "Liam needs to solve: 76 - 14\\n\\nWhich answer is correct?\\nA) 90  B) 62  C) 620  D) 60"
      },
      "format": "VALIDATION",
      "difficulty": {
        "year": 3,
        "subLevel": 3,
        "displayName": "3.3",
        "cognitiveLoad": 40
      },
      "cognitiveLoad": 40,
      "curriculumTags": [
        "3N1c",
        "3N1d"
      ],
      "scenario": {
        "id": "shop-002-realistic-general",
        "theme": "SHOPPING",
        "setting": {
          "location": "local shop",
          "timeContext": "after school",
          "atmosphere": "friendly"
        },
        "characters": [
          {
            "name": "Liam",
            "role": "student"
          }
        ],
        "items": [
          {
            "name": "apple",
            "category": "FOOD_DRINK",
            "typicalValue": {
              "min": 0.2,
              "max": 0.5,
              "typical": 0.35,
              "distribution": "normal"
            },
            "unit": "£",
            "attributes": {
              "quality": "standard"
            }
          },
          {
            "name": "banana",
            "category": "FOOD_DRINK",
            "typicalValue": {
              "min": 0.15,
              "max": 0.4,
              "typical": 0.25,
              "distribution": "normal"
            },
            "unit": "£",
            "attributes": {
              "quality": "standard"
            }
          },
          {
            "name": "sandwich",
            "category": "FOOD_DRINK",
            "typicalValue": {
              "min": 2.5,
              "max": 6,
              "typical": 4,
              "distribution": "normal"
            },
            "unit": "£",
            "attributes": {
              "quality": "standard"
            }
          },
          {
            "name": "drink",
            "category": "FOOD_DRINK",
            "typicalValue": {
              "min": 0.8,
              "max": 2.5,
              "typical": 1.5,
              "distribution": "normal"
            },
            "unit": "£",
            "attributes": {
              "quality": "standard"
            }
          },
          {
            "name": "cake",
            "category": "FOOD_DRINK",
            "typicalValue": {
              "min": 1.5,
              "max": 4,
              "typical": 2.5,
              "distribution": "normal"
            },
            "unit": "£",
            "attributes": {
              "quality": "standard"
            }
          },
          {
            "name": "biscuit",
            "category": "FOOD_DRINK",
            "typicalValue": {
              "min": 0.8,
              "max": 2,
              "typical": 1.2,
              "distribution": "normal"
            },
            "unit": "£",
            "attributes": {
              "quality": "standard"
            }
          },
          {
            "name": "sweet",
            "category": "FOOD_DRINK",
            "typicalValue": {
              "min": 0.1,
              "max": 1,
              "typical": 0.5,
              "distribution": "normal"
            },
            "unit": "£",
            "attributes": {
              "quality": "standard"
            }
          },
          {
            "name": "chocolate",
            "category": "FOOD_DRINK",
            "typicalValue": {
              "min": 0.6,
              "max": 3,
              "typical": 1.5,
              "distribution": "normal"
            },
            "unit": "£",
            "attributes": {
              "quality": "standard"
            }
          },
          {
            "name": "pen",
            "category": "SCHOOL_SUPPLIES",
            "typicalValue": {
              "min": 0.5,
              "max": 2,
              "typical": 1,
              "distribution": "normal"
            },
            "unit": "£",
            "attributes": {
              "quality": "standard"
            }
          },
          {
            "name": "pencil",
            "category": "SCHOOL_SUPPLIES",
            "typicalValue": {
              "min": 0.2,
              "max": 1,
              "typical": 0.5,
              "distribution": "normal"
            },
            "unit": "£",
            "attributes": {
              "quality": "standard"
            }
          },
          {
            "name": "ruler",
            "category": "SCHOOL_SUPPLIES",
            "typicalValue": {
              "min": 0.8,
              "max": 2.5,
              "typical": 1.5,
              "distribution": "normal"
            },
            "unit": "£",
            "attributes": {
              "quality": "standard"
            }
          },
          {
            "name": "notebook",
            "category": "SCHOOL_SUPPLIES",
            "typicalValue": {
              "min": 1,
              "max": 4,
              "typical": 2,
              "distribution": "normal"
            },
            "unit": "£",
            "attributes": {
              "quality": "standard"
            }
          },
          {
            "name": "eraser",
            "category": "SCHOOL_SUPPLIES",
            "typicalValue": {
              "min": 0.3,
              "max": 1.5,
              "typical": 0.75,
              "distribution": "normal"
            },
            "unit": "£",
            "attributes": {
              "quality": "standard"
            }
          },
          {
            "name": "book",
            "category": "BOOKS_MEDIA",
            "typicalValue": {
              "min": 3,
              "max": 15,
              "typical": 8,
              "distribution": "normal"
            },
            "unit": "£",
            "attributes": {
              "quality": "standard"
            }
          },
          {
            "name": "comic",
            "category": "BOOKS_MEDIA",
            "typicalValue": {
              "min": 2,
              "max": 5,
              "typical": 3,
              "distribution": "normal"
            },
            "unit": "£",
            "attributes": {
              "quality": "standard"
            }
          },
          {
            "name": "magazine",
            "category": "BOOKS_MEDIA",
            "typicalValue": {
              "min": 2.5,
              "max": 6,
              "typical": 4,
              "distribution": "normal"
            },
            "unit": "£",
            "attributes": {
              "quality": "standard"
            }
          },
          {
            "name": "toy",
            "category": "TOYS_GAMES",
            "typicalValue": {
              "min": 5,
              "max": 25,
              "typical": 12,
              "distribution": "normal"
            },
            "unit": "£",
            "attributes": {
              "quality": "standard"
            }
          },
          {
            "name": "game",
            "category": "TOYS_GAMES",
            "typicalValue": {
              "min": 8,
              "max": 60,
              "typical": 25,
              "distribution": "normal"
            },
            "unit": "£",
            "attributes": {
              "quality": "standard"
            }
          },
          {
            "name": "puzzle",
            "category": "TOYS_GAMES",
            "typicalValue": {
              "min": 5,
              "max": 20,
              "typical": 12,
              "distribution": "normal"
            },
            "unit": "£",
            "attributes": {
              "quality": "standard"
            }
          },
          {
            "name": "sticker",
            "category": "TOYS_GAMES",
            "typicalValue": {
              "min": 0.2,
              "max": 2,
              "typical": 0.8,
              "distribution": "normal"
            },
            "unit": "£",
            "attributes": {
              "quality": "standard"
            }
          },
          {
            "name": "badge",
            "category": "TOYS_GAMES",
            "typicalValue": {
              "min": 0.5,
              "max": 3,
              "typical": 1.5,
              "distribution": "normal"
            },
            "unit": "£",
            "attributes": {
              "quality": "standard"
            }
          },
          {
            "name": "poster",
            "category": "BOOKS_MEDIA",
            "typicalValue": {
              "min": 2,
              "max": 8,
              "typical": 4,
              "distribution": "normal"
            },
            "unit": "£",
            "attributes": {
              "quality": "standard"
            }
          },
          {
            "name": "card",
            "category": "BOOKS_MEDIA",
            "typicalValue": {
              "min": 0.5,
              "max": 4,
              "typical": 2,
              "distribution": "normal"
            },
            "unit": "£",
            "attributes": {
              "quality": "standard"
            }
          }
        ],
        "culturalElements": [
          {
            "type": "currency",
            "value": "£",
            "explanation": "British pounds"
          },
          {
            "type": "location",
            "value": "UK local shop",
            "explanation": "Typical British corner shop"
          }
        ],
        "realWorldConnection": "Everyday shopping with realistic UK prices",
        "yearAppropriate": [
          1,
          2,
          3,
          4,
          5,
          6
        ],
        "templates": [
          {
            "formatCompatibility": [
              "DIRECT_CALCULATION",
              "MULTI_STEP"
            ],
            "modelCompatibility": [
              "ADDITION"
            ],
            "operandCount": 3,
            "template": "{character} buys {article1} {item1} for {price1}, {article2} {item2} for {price2}, and {article3} {item3} for {price3}. What is the total cost?",
            "answerTemplate": "The total cost is {result}",
            "placeholders": [
              {
                "key": "character",
                "type": "character"
              },
              {
                "key": "item1",
                "type": "item"
              },
              {
                "key": "item2",
                "type": "item"
              },
              {
                "key": "item3",
                "type": "item"
              },
              {
                "key": "price1",
                "type": "value"
              },
              {
                "key": "price2",
                "type": "value"
              },
              {
                "key": "price3",
                "type": "value"
              },
              {
                "key": "result",
                "type": "value"
              }
            ]
          },
          {
            "formatCompatibility": [
              "DIRECT_CALCULATION",
              "MULTI_STEP"
            ],
            "modelCompatibility": [
              "ADDITION"
            ],
            "operandCount": 2,
            "template": "{character} buys {article1} {item1} for {price1} and {article2} {item2} for {price2}. What is the total cost?",
            "answerTemplate": "The total cost is {result}",
            "placeholders": [
              {
                "key": "character",
                "type": "character"
              },
              {
                "key": "item1",
                "type": "item"
              },
              {
                "key": "item2",
                "type": "item"
              },
              {
                "key": "price1",
                "type": "value"
              },
              {
                "key": "price2",
                "type": "value"
              },
              {
                "key": "result",
                "type": "value"
              }
            ]
          },
          {
            "formatCompatibility": [
              "DIRECT_CALCULATION"
            ],
            "modelCompatibility": [
              "SUBTRACTION",
              "CHANGE_CALCULATION"
            ],
            "template": "{character} buys {article} {item} for {price} and pays with {payment}. How much change does {character} get?",
            "answerTemplate": "{character} receives {result} in change",
            "placeholders": [
              {
                "key": "character",
                "type": "character"
              },
              {
                "key": "item",
                "type": "item"
              },
              {
                "key": "price",
                "type": "value"
              },
              {
                "key": "payment",
                "type": "value"
              },
              {
                "key": "result",
                "type": "value"
              }
            ]
          },
          {
            "formatCompatibility": [
              "DIRECT_CALCULATION"
            ],
            "modelCompatibility": [
              "MULTIPLICATION"
            ],
            "template": "{character} buys {quantity} {item} at {price} each. What is the total cost?",
            "answerTemplate": "The total cost is {result}",
            "placeholders": [
              {
                "key": "character",
                "type": "character"
              },
              {
                "key": "quantity",
                "type": "value"
              },
              {
                "key": "item",
                "type": "item"
              },
              {
                "key": "price",
                "type": "value"
              },
              {
                "key": "result",
                "type": "value"
              }
            ]
          },
          {
            "formatCompatibility": [
              "DIRECT_CALCULATION"
            ],
            "modelCompatibility": [
              "DIVISION"
            ],
            "template": "{character} has {total} to spend equally on {quantity} {item}. How much can {character} spend on each one?",
            "answerTemplate": "{character} can spend {result} on each {item}",
            "placeholders": [
              {
                "key": "character",
                "type": "character"
              },
              {
                "key": "total",
                "type": "value"
              },
              {
                "key": "quantity",
                "type": "value"
              },
              {
                "key": "item",
                "type": "item"
              },
              {
                "key": "result",
                "type": "value"
              }
            ]
          },
          {
            "formatCompatibility": [
              "DIRECT_CALCULATION",
              "COMPARISON",
              "ESTIMATION",
              "MULTI_STEP"
            ],
            "template": "{character} goes to the shop and buys {items}. How much does {character} spend in total?",
            "answerTemplate": "{character} spends {result} in total",
            "placeholders": [
              {
                "key": "character",
                "type": "character"
              },
              {
                "key": "items",
                "type": "item_list"
              },
              {
                "key": "result",
                "type": "value"
              }
            ]
          },
          {
            "formatCompatibility": [
              "ESTIMATION"
            ],
            "template": "Estimate: If {character} buys {items}, about how much will it cost?",
            "answerTemplate": "It will cost approximately {result}",
            "placeholders": [
              {
                "key": "character",
                "type": "character"
              },
              {
                "key": "items",
                "type": "item_list"
              },
              {
                "key": "result",
                "type": "value"
              }
            ]
          },
          {
            "formatCompatibility": [
              "VALIDATION"
            ],
            "template": "{character} calculated that {items} costs {amount}. Is this correct?",
            "answerTemplate": "{validation_result}",
            "placeholders": [
              {
                "key": "character",
                "type": "character"
              },
              {
                "key": "items",
                "type": "item_list"
              },
              {
                "key": "amount",
                "type": "value"
              },
              {
                "key": "validation_result",
                "type": "boolean"
              }
            ]
          }
        ]
      },
      "distractors": [
        {
          "value": 90,
          "strategy": "CALCULATION_ERROR",
          "rationale": "Common calculation error"
        },
        {
          "value": 620,
          "strategy": "CALCULATION_ERROR",
          "rationale": "Common calculation error"
        },
        {
          "value": 60,
          "strategy": "CALCULATION_ERROR",
          "rationale": "Common calculation error"
        }
      ],
      "enhancementStatus": {
        "level": "full",
        "requestedFormat": "VALIDATION",
        "actualFormat": "VALIDATION",
        "featuresActive": [
          "enhanced_distractors",
          "rich_scenarios",
          "cognitive_load",
          "advanced_formats"
        ],
        "featuresPending": [],
        "isFullyEnhanced": true
      },
      "mathOutput": {
        "operation": "SUBTRACTION",
        "minuend": 76,
        "subtrahend": 14,
        "result": 62,
        "decimal_formatted": {
          "minuend": "76",
          "subtrahend": "14",
          "result": "62"
        }
      },
      "generationTime": 0,
      "questionId": "q_1759234386722_rarnktzit",
      "generationSetup": {
        "controller_used": "VALIDATIONController",
        "format_requested": "VALIDATION",
        "format_actual": "VALIDATION",
        "scenario_theme": "SHOPPING",
        "scenario_id": "shop-002-realistic-general",
        "scenario_selection_method": "default",
        "distractor_strategies": [
          "CALCULATION_ERROR",
          "CALCULATION_ERROR",
          "CALCULATION_ERROR"
        ],
        "distractor_count": 3,
        "theme_variety": false,
        "format_variety": false,
        "enhancement_level": "full",
        "features_active": [
          "enhanced_distractors",
          "rich_scenarios",
          "cognitive_load",
          "advanced_formats"
        ],
        "features_pending": [],
        "generation_time_ms": 0
      }
    },
    {
      "text": "Liam is subtracting £81.00 - £2.00. What is a reasonable estimate?",
      "options": [
        {
          "text": "79",
          "value": 79,
          "index": 0
        },
        {
          "text": "120",
          "value": 120,
          "index": 1
        },
        {
          "text": "48",
          "value": 48,
          "index": 2
        },
        {
          "text": "£80.00",
          "value": 80,
          "index": 3
        }
      ],
      "correctIndex": 3,
      "questionContent": {
        "fullText": "Liam is subtracting £81.00 - £2.00. What is a reasonable estimate?",
        "templateData": {
          "character": "Liam",
          "operation": "is subtracting £81.00 - £2.00",
          "exactValue": "79",
          "estimatedValue": "80"
        }
      },
      "format": "ESTIMATION",
      "difficulty": {
        "year": 3,
        "subLevel": 3,
        "displayName": "3.3",
        "cognitiveLoad": 40
      },
      "cognitiveLoad": 40,
      "curriculumTags": [
        "3N1c",
        "3N1d"
      ],
      "scenario": {
        "id": "shop-002-realistic-general",
        "theme": "SHOPPING",
        "setting": {
          "location": "local shop",
          "timeContext": "after school",
          "atmosphere": "friendly"
        },
        "characters": [
          {
            "name": "Liam",
            "role": "student"
          }
        ],
        "items": [
          {
            "name": "apple",
            "category": "FOOD_DRINK",
            "typicalValue": {
              "min": 0.2,
              "max": 0.5,
              "typical": 0.35,
              "distribution": "normal"
            },
            "unit": "£",
            "attributes": {
              "quality": "standard"
            }
          },
          {
            "name": "banana",
            "category": "FOOD_DRINK",
            "typicalValue": {
              "min": 0.15,
              "max": 0.4,
              "typical": 0.25,
              "distribution": "normal"
            },
            "unit": "£",
            "attributes": {
              "quality": "standard"
            }
          },
          {
            "name": "sandwich",
            "category": "FOOD_DRINK",
            "typicalValue": {
              "min": 2.5,
              "max": 6,
              "typical": 4,
              "distribution": "normal"
            },
            "unit": "£",
            "attributes": {
              "quality": "standard"
            }
          },
          {
            "name": "drink",
            "category": "FOOD_DRINK",
            "typicalValue": {
              "min": 0.8,
              "max": 2.5,
              "typical": 1.5,
              "distribution": "normal"
            },
            "unit": "£",
            "attributes": {
              "quality": "standard"
            }
          },
          {
            "name": "cake",
            "category": "FOOD_DRINK",
            "typicalValue": {
              "min": 1.5,
              "max": 4,
              "typical": 2.5,
              "distribution": "normal"
            },
            "unit": "£",
            "attributes": {
              "quality": "standard"
            }
          },
          {
            "name": "biscuit",
            "category": "FOOD_DRINK",
            "typicalValue": {
              "min": 0.8,
              "max": 2,
              "typical": 1.2,
              "distribution": "normal"
            },
            "unit": "£",
            "attributes": {
              "quality": "standard"
            }
          },
          {
            "name": "sweet",
            "category": "FOOD_DRINK",
            "typicalValue": {
              "min": 0.1,
              "max": 1,
              "typical": 0.5,
              "distribution": "normal"
            },
            "unit": "£",
            "attributes": {
              "quality": "standard"
            }
          },
          {
            "name": "chocolate",
            "category": "FOOD_DRINK",
            "typicalValue": {
              "min": 0.6,
              "max": 3,
              "typical": 1.5,
              "distribution": "normal"
            },
            "unit": "£",
            "attributes": {
              "quality": "standard"
            }
          },
          {
            "name": "pen",
            "category": "SCHOOL_SUPPLIES",
            "typicalValue": {
              "min": 0.5,
              "max": 2,
              "typical": 1,
              "distribution": "normal"
            },
            "unit": "£",
            "attributes": {
              "quality": "standard"
            }
          },
          {
            "name": "pencil",
            "category": "SCHOOL_SUPPLIES",
            "typicalValue": {
              "min": 0.2,
              "max": 1,
              "typical": 0.5,
              "distribution": "normal"
            },
            "unit": "£",
            "attributes": {
              "quality": "standard"
            }
          },
          {
            "name": "ruler",
            "category": "SCHOOL_SUPPLIES",
            "typicalValue": {
              "min": 0.8,
              "max": 2.5,
              "typical": 1.5,
              "distribution": "normal"
            },
            "unit": "£",
            "attributes": {
              "quality": "standard"
            }
          },
          {
            "name": "notebook",
            "category": "SCHOOL_SUPPLIES",
            "typicalValue": {
              "min": 1,
              "max": 4,
              "typical": 2,
              "distribution": "normal"
            },
            "unit": "£",
            "attributes": {
              "quality": "standard"
            }
          },
          {
            "name": "eraser",
            "category": "SCHOOL_SUPPLIES",
            "typicalValue": {
              "min": 0.3,
              "max": 1.5,
              "typical": 0.75,
              "distribution": "normal"
            },
            "unit": "£",
            "attributes": {
              "quality": "standard"
            }
          },
          {
            "name": "book",
            "category": "BOOKS_MEDIA",
            "typicalValue": {
              "min": 3,
              "max": 15,
              "typical": 8,
              "distribution": "normal"
            },
            "unit": "£",
            "attributes": {
              "quality": "standard"
            }
          },
          {
            "name": "comic",
            "category": "BOOKS_MEDIA",
            "typicalValue": {
              "min": 2,
              "max": 5,
              "typical": 3,
              "distribution": "normal"
            },
            "unit": "£",
            "attributes": {
              "quality": "standard"
            }
          },
          {
            "name": "magazine",
            "category": "BOOKS_MEDIA",
            "typicalValue": {
              "min": 2.5,
              "max": 6,
              "typical": 4,
              "distribution": "normal"
            },
            "unit": "£",
            "attributes": {
              "quality": "standard"
            }
          },
          {
            "name": "toy",
            "category": "TOYS_GAMES",
            "typicalValue": {
              "min": 5,
              "max": 25,
              "typical": 12,
              "distribution": "normal"
            },
            "unit": "£",
            "attributes": {
              "quality": "standard"
            }
          },
          {
            "name": "game",
            "category": "TOYS_GAMES",
            "typicalValue": {
              "min": 8,
              "max": 60,
              "typical": 25,
              "distribution": "normal"
            },
            "unit": "£",
            "attributes": {
              "quality": "standard"
            }
          },
          {
            "name": "puzzle",
            "category": "TOYS_GAMES",
            "typicalValue": {
              "min": 5,
              "max": 20,
              "typical": 12,
              "distribution": "normal"
            },
            "unit": "£",
            "attributes": {
              "quality": "standard"
            }
          },
          {
            "name": "sticker",
            "category": "TOYS_GAMES",
            "typicalValue": {
              "min": 0.2,
              "max": 2,
              "typical": 0.8,
              "distribution": "normal"
            },
            "unit": "£",
            "attributes": {
              "quality": "standard"
            }
          },
          {
            "name": "badge",
            "category": "TOYS_GAMES",
            "typicalValue": {
              "min": 0.5,
              "max": 3,
              "typical": 1.5,
              "distribution": "normal"
            },
            "unit": "£",
            "attributes": {
              "quality": "standard"
            }
          },
          {
            "name": "poster",
            "category": "BOOKS_MEDIA",
            "typicalValue": {
              "min": 2,
              "max": 8,
              "typical": 4,
              "distribution": "normal"
            },
            "unit": "£",
            "attributes": {
              "quality": "standard"
            }
          },
          {
            "name": "card",
            "category": "BOOKS_MEDIA",
            "typicalValue": {
              "min": 0.5,
              "max": 4,
              "typical": 2,
              "distribution": "normal"
            },
            "unit": "£",
            "attributes": {
              "quality": "standard"
            }
          }
        ],
        "culturalElements": [
          {
            "type": "currency",
            "value": "£",
            "explanation": "British pounds"
          },
          {
            "type": "location",
            "value": "UK local shop",
            "explanation": "Typical British corner shop"
          }
        ],
        "realWorldConnection": "Everyday shopping with realistic UK prices",
        "yearAppropriate": [
          1,
          2,
          3,
          4,
          5,
          6
        ],
        "templates": [
          {
            "formatCompatibility": [
              "DIRECT_CALCULATION",
              "MULTI_STEP"
            ],
            "modelCompatibility": [
              "ADDITION"
            ],
            "operandCount": 3,
            "template": "{character} buys {article1} {item1} for {price1}, {article2} {item2} for {price2}, and {article3} {item3} for {price3}. What is the total cost?",
            "answerTemplate": "The total cost is {result}",
            "placeholders": [
              {
                "key": "character",
                "type": "character"
              },
              {
                "key": "item1",
                "type": "item"
              },
              {
                "key": "item2",
                "type": "item"
              },
              {
                "key": "item3",
                "type": "item"
              },
              {
                "key": "price1",
                "type": "value"
              },
              {
                "key": "price2",
                "type": "value"
              },
              {
                "key": "price3",
                "type": "value"
              },
              {
                "key": "result",
                "type": "value"
              }
            ]
          },
          {
            "formatCompatibility": [
              "DIRECT_CALCULATION",
              "MULTI_STEP"
            ],
            "modelCompatibility": [
              "ADDITION"
            ],
            "operandCount": 2,
            "template": "{character} buys {article1} {item1} for {price1} and {article2} {item2} for {price2}. What is the total cost?",
            "answerTemplate": "The total cost is {result}",
            "placeholders": [
              {
                "key": "character",
                "type": "character"
              },
              {
                "key": "item1",
                "type": "item"
              },
              {
                "key": "item2",
                "type": "item"
              },
              {
                "key": "price1",
                "type": "value"
              },
              {
                "key": "price2",
                "type": "value"
              },
              {
                "key": "result",
                "type": "value"
              }
            ]
          },
          {
            "formatCompatibility": [
              "DIRECT_CALCULATION"
            ],
            "modelCompatibility": [
              "SUBTRACTION",
              "CHANGE_CALCULATION"
            ],
            "template": "{character} buys {article} {item} for {price} and pays with {payment}. How much change does {character} get?",
            "answerTemplate": "{character} receives {result} in change",
            "placeholders": [
              {
                "key": "character",
                "type": "character"
              },
              {
                "key": "item",
                "type": "item"
              },
              {
                "key": "price",
                "type": "value"
              },
              {
                "key": "payment",
                "type": "value"
              },
              {
                "key": "result",
                "type": "value"
              }
            ]
          },
          {
            "formatCompatibility": [
              "DIRECT_CALCULATION"
            ],
            "modelCompatibility": [
              "MULTIPLICATION"
            ],
            "template": "{character} buys {quantity} {item} at {price} each. What is the total cost?",
            "answerTemplate": "The total cost is {result}",
            "placeholders": [
              {
                "key": "character",
                "type": "character"
              },
              {
                "key": "quantity",
                "type": "value"
              },
              {
                "key": "item",
                "type": "item"
              },
              {
                "key": "price",
                "type": "value"
              },
              {
                "key": "result",
                "type": "value"
              }
            ]
          },
          {
            "formatCompatibility": [
              "DIRECT_CALCULATION"
            ],
            "modelCompatibility": [
              "DIVISION"
            ],
            "template": "{character} has {total} to spend equally on {quantity} {item}. How much can {character} spend on each one?",
            "answerTemplate": "{character} can spend {result} on each {item}",
            "placeholders": [
              {
                "key": "character",
                "type": "character"
              },
              {
                "key": "total",
                "type": "value"
              },
              {
                "key": "quantity",
                "type": "value"
              },
              {
                "key": "item",
                "type": "item"
              },
              {
                "key": "result",
                "type": "value"
              }
            ]
          },
          {
            "formatCompatibility": [
              "DIRECT_CALCULATION",
              "COMPARISON",
              "ESTIMATION",
              "MULTI_STEP"
            ],
            "template": "{character} goes to the shop and buys {items}. How much does {character} spend in total?",
            "answerTemplate": "{character} spends {result} in total",
            "placeholders": [
              {
                "key": "character",
                "type": "character"
              },
              {
                "key": "items",
                "type": "item_list"
              },
              {
                "key": "result",
                "type": "value"
              }
            ]
          },
          {
            "formatCompatibility": [
              "ESTIMATION"
            ],
            "template": "Estimate: If {character} buys {items}, about how much will it cost?",
            "answerTemplate": "It will cost approximately {result}",
            "placeholders": [
              {
                "key": "character",
                "type": "character"
              },
              {
                "key": "items",
                "type": "item_list"
              },
              {
                "key": "result",
                "type": "value"
              }
            ]
          },
          {
            "formatCompatibility": [
              "VALIDATION"
            ],
            "template": "{character} calculated that {items} costs {amount}. Is this correct?",
            "answerTemplate": "{validation_result}",
            "placeholders": [
              {
                "key": "character",
                "type": "character"
              },
              {
                "key": "items",
                "type": "item_list"
              },
              {
                "key": "amount",
                "type": "value"
              },
              {
                "key": "validation_result",
                "type": "boolean"
              }
            ]
          }
        ]
      },
      "distractors": [
        {
          "value": 79,
          "strategy": "WRONG_OPERATION",
          "rationale": "Used exact calculation instead of estimation"
        },
        {
          "value": 120,
          "rationale": "Overestimated significantly"
        },
        {
          "value": 48,
          "rationale": "Underestimated significantly"
        }
      ],
      "enhancementStatus": {
        "level": "full",
        "requestedFormat": "ESTIMATION",
        "actualFormat": "ESTIMATION",
        "featuresActive": [
          "enhanced_distractors",
          "rich_scenarios",
          "cognitive_load",
          "advanced_formats"
        ],
        "featuresPending": [],
        "isFullyEnhanced": true
      },
      "mathOutput": {
        "operation": "SUBTRACTION",
        "minuend": 81,
        "subtrahend": 2,
        "result": 79,
        "decimal_formatted": {
          "minuend": "81",
          "subtrahend": "2",
          "result": "79"
        },
        "exactValue": 79,
        "estimatedValue": 80
      },
      "generationTime": 1,
      "questionId": "q_1759234386816_6qk6hqw3a",
      "generationSetup": {
        "controller_used": "ESTIMATIONController",
        "format_requested": "ESTIMATION",
        "format_actual": "ESTIMATION",
        "scenario_theme": "SHOPPING",
        "scenario_id": "shop-002-realistic-general",
        "scenario_selection_method": "default",
        "distractor_strategies": [
          "WRONG_OPERATION",
          null,
          null
        ],
        "distractor_count": 3,
        "theme_variety": false,
        "format_variety": false,
        "enhancement_level": "full",
        "features_active": [
          "enhanced_distractors",
          "rich_scenarios",
          "cognitive_load",
          "advanced_formats"
        ],
        "features_pending": [],
        "generation_time_ms": 1
      }
    },
    {
      "text": "Liam buys an apple for 48p and pays with £2. How much change does Liam get?",
      "options": [
        {
          "text": "£1.52",
          "value": 1.52,
          "index": 0
        },
        {
          "text": "92",
          "value": 92,
          "index": 1
        },
        {
          "text": "0.52",
          "value": 0.52,
          "index": 2
        },
        {
          "text": "2.52",
          "value": 2.52,
          "index": 3
        }
      ],
      "correctIndex": 0,
      "format": "DIRECT_CALCULATION",
      "difficulty": {
        "year": 3,
        "subLevel": 3,
        "displayName": "3.3",
        "cognitiveLoad": 40
      },
      "cognitiveLoad": 40,
      "curriculumTags": [
        "3N1c",
        "3N1d"
      ],
      "scenario": {
        "id": "shop-002-realistic-general",
        "theme": "SHOPPING",
        "setting": {
          "location": "local shop",
          "timeContext": "after school",
          "atmosphere": "friendly"
        },
        "characters": [
          {
            "name": "Liam",
            "role": "student"
          }
        ],
        "items": [
          {
            "name": "apple",
            "category": "FOOD_DRINK",
            "typicalValue": {
              "min": 0.2,
              "max": 0.5,
              "typical": 0.35,
              "distribution": "normal"
            },
            "unit": "£",
            "attributes": {
              "quality": "standard"
            }
          },
          {
            "name": "banana",
            "category": "FOOD_DRINK",
            "typicalValue": {
              "min": 0.15,
              "max": 0.4,
              "typical": 0.25,
              "distribution": "normal"
            },
            "unit": "£",
            "attributes": {
              "quality": "standard"
            }
          },
          {
            "name": "sandwich",
            "category": "FOOD_DRINK",
            "typicalValue": {
              "min": 2.5,
              "max": 6,
              "typical": 4,
              "distribution": "normal"
            },
            "unit": "£",
            "attributes": {
              "quality": "standard"
            }
          },
          {
            "name": "drink",
            "category": "FOOD_DRINK",
            "typicalValue": {
              "min": 0.8,
              "max": 2.5,
              "typical": 1.5,
              "distribution": "normal"
            },
            "unit": "£",
            "attributes": {
              "quality": "standard"
            }
          },
          {
            "name": "cake",
            "category": "FOOD_DRINK",
            "typicalValue": {
              "min": 1.5,
              "max": 4,
              "typical": 2.5,
              "distribution": "normal"
            },
            "unit": "£",
            "attributes": {
              "quality": "standard"
            }
          },
          {
            "name": "biscuit",
            "category": "FOOD_DRINK",
            "typicalValue": {
              "min": 0.8,
              "max": 2,
              "typical": 1.2,
              "distribution": "normal"
            },
            "unit": "£",
            "attributes": {
              "quality": "standard"
            }
          },
          {
            "name": "sweet",
            "category": "FOOD_DRINK",
            "typicalValue": {
              "min": 0.1,
              "max": 1,
              "typical": 0.5,
              "distribution": "normal"
            },
            "unit": "£",
            "attributes": {
              "quality": "standard"
            }
          },
          {
            "name": "chocolate",
            "category": "FOOD_DRINK",
            "typicalValue": {
              "min": 0.6,
              "max": 3,
              "typical": 1.5,
              "distribution": "normal"
            },
            "unit": "£",
            "attributes": {
              "quality": "standard"
            }
          },
          {
            "name": "pen",
            "category": "SCHOOL_SUPPLIES",
            "typicalValue": {
              "min": 0.5,
              "max": 2,
              "typical": 1,
              "distribution": "normal"
            },
            "unit": "£",
            "attributes": {
              "quality": "standard"
            }
          },
          {
            "name": "pencil",
            "category": "SCHOOL_SUPPLIES",
            "typicalValue": {
              "min": 0.2,
              "max": 1,
              "typical": 0.5,
              "distribution": "normal"
            },
            "unit": "£",
            "attributes": {
              "quality": "standard"
            }
          },
          {
            "name": "ruler",
            "category": "SCHOOL_SUPPLIES",
            "typicalValue": {
              "min": 0.8,
              "max": 2.5,
              "typical": 1.5,
              "distribution": "normal"
            },
            "unit": "£",
            "attributes": {
              "quality": "standard"
            }
          },
          {
            "name": "notebook",
            "category": "SCHOOL_SUPPLIES",
            "typicalValue": {
              "min": 1,
              "max": 4,
              "typical": 2,
              "distribution": "normal"
            },
            "unit": "£",
            "attributes": {
              "quality": "standard"
            }
          },
          {
            "name": "eraser",
            "category": "SCHOOL_SUPPLIES",
            "typicalValue": {
              "min": 0.3,
              "max": 1.5,
              "typical": 0.75,
              "distribution": "normal"
            },
            "unit": "£",
            "attributes": {
              "quality": "standard"
            }
          },
          {
            "name": "book",
            "category": "BOOKS_MEDIA",
            "typicalValue": {
              "min": 3,
              "max": 15,
              "typical": 8,
              "distribution": "normal"
            },
            "unit": "£",
            "attributes": {
              "quality": "standard"
            }
          },
          {
            "name": "comic",
            "category": "BOOKS_MEDIA",
            "typicalValue": {
              "min": 2,
              "max": 5,
              "typical": 3,
              "distribution": "normal"
            },
            "unit": "£",
            "attributes": {
              "quality": "standard"
            }
          },
          {
            "name": "magazine",
            "category": "BOOKS_MEDIA",
            "typicalValue": {
              "min": 2.5,
              "max": 6,
              "typical": 4,
              "distribution": "normal"
            },
            "unit": "£",
            "attributes": {
              "quality": "standard"
            }
          },
          {
            "name": "toy",
            "category": "TOYS_GAMES",
            "typicalValue": {
              "min": 5,
              "max": 25,
              "typical": 12,
              "distribution": "normal"
            },
            "unit": "£",
            "attributes": {
              "quality": "standard"
            }
          },
          {
            "name": "game",
            "category": "TOYS_GAMES",
            "typicalValue": {
              "min": 8,
              "max": 60,
              "typical": 25,
              "distribution": "normal"
            },
            "unit": "£",
            "attributes": {
              "quality": "standard"
            }
          },
          {
            "name": "puzzle",
            "category": "TOYS_GAMES",
            "typicalValue": {
              "min": 5,
              "max": 20,
              "typical": 12,
              "distribution": "normal"
            },
            "unit": "£",
            "attributes": {
              "quality": "standard"
            }
          },
          {
            "name": "sticker",
            "category": "TOYS_GAMES",
            "typicalValue": {
              "min": 0.2,
              "max": 2,
              "typical": 0.8,
              "distribution": "normal"
            },
            "unit": "£",
            "attributes": {
              "quality": "standard"
            }
          },
          {
            "name": "badge",
            "category": "TOYS_GAMES",
            "typicalValue": {
              "min": 0.5,
              "max": 3,
              "typical": 1.5,
              "distribution": "normal"
            },
            "unit": "£",
            "attributes": {
              "quality": "standard"
            }
          },
          {
            "name": "poster",
            "category": "BOOKS_MEDIA",
            "typicalValue": {
              "min": 2,
              "max": 8,
              "typical": 4,
              "distribution": "normal"
            },
            "unit": "£",
            "attributes": {
              "quality": "standard"
            }
          },
          {
            "name": "card",
            "category": "BOOKS_MEDIA",
            "typicalValue": {
              "min": 0.5,
              "max": 4,
              "typical": 2,
              "distribution": "normal"
            },
            "unit": "£",
            "attributes": {
              "quality": "standard"
            }
          }
        ],
        "culturalElements": [
          {
            "type": "currency",
            "value": "£",
            "explanation": "British pounds"
          },
          {
            "type": "location",
            "value": "UK local shop",
            "explanation": "Typical British corner shop"
          }
        ],
        "realWorldConnection": "Everyday shopping with realistic UK prices",
        "yearAppropriate": [
          1,
          2,
          3,
          4,
          5,
          6
        ],
        "templates": [
          {
            "formatCompatibility": [
              "DIRECT_CALCULATION",
              "MULTI_STEP"
            ],
            "modelCompatibility": [
              "ADDITION"
            ],
            "operandCount": 3,
            "template": "{character} buys {article1} {item1} for {price1}, {article2} {item2} for {price2}, and {article3} {item3} for {price3}. What is the total cost?",
            "answerTemplate": "The total cost is {result}",
            "placeholders": [
              {
                "key": "character",
                "type": "character"
              },
              {
                "key": "item1",
                "type": "item"
              },
              {
                "key": "item2",
                "type": "item"
              },
              {
                "key": "item3",
                "type": "item"
              },
              {
                "key": "price1",
                "type": "value"
              },
              {
                "key": "price2",
                "type": "value"
              },
              {
                "key": "price3",
                "type": "value"
              },
              {
                "key": "result",
                "type": "value"
              }
            ]
          },
          {
            "formatCompatibility": [
              "DIRECT_CALCULATION",
              "MULTI_STEP"
            ],
            "modelCompatibility": [
              "ADDITION"
            ],
            "operandCount": 2,
            "template": "{character} buys {article1} {item1} for {price1} and {article2} {item2} for {price2}. What is the total cost?",
            "answerTemplate": "The total cost is {result}",
            "placeholders": [
              {
                "key": "character",
                "type": "character"
              },
              {
                "key": "item1",
                "type": "item"
              },
              {
                "key": "item2",
                "type": "item"
              },
              {
                "key": "price1",
                "type": "value"
              },
              {
                "key": "price2",
                "type": "value"
              },
              {
                "key": "result",
                "type": "value"
              }
            ]
          },
          {
            "formatCompatibility": [
              "DIRECT_CALCULATION"
            ],
            "modelCompatibility": [
              "SUBTRACTION",
              "CHANGE_CALCULATION"
            ],
            "template": "{character} buys {article} {item} for {price} and pays with {payment}. How much change does {character} get?",
            "answerTemplate": "{character} receives {result} in change",
            "placeholders": [
              {
                "key": "character",
                "type": "character"
              },
              {
                "key": "item",
                "type": "item"
              },
              {
                "key": "price",
                "type": "value"
              },
              {
                "key": "payment",
                "type": "value"
              },
              {
                "key": "result",
                "type": "value"
              }
            ]
          },
          {
            "formatCompatibility": [
              "DIRECT_CALCULATION"
            ],
            "modelCompatibility": [
              "MULTIPLICATION"
            ],
            "template": "{character} buys {quantity} {item} at {price} each. What is the total cost?",
            "answerTemplate": "The total cost is {result}",
            "placeholders": [
              {
                "key": "character",
                "type": "character"
              },
              {
                "key": "quantity",
                "type": "value"
              },
              {
                "key": "item",
                "type": "item"
              },
              {
                "key": "price",
                "type": "value"
              },
              {
                "key": "result",
                "type": "value"
              }
            ]
          },
          {
            "formatCompatibility": [
              "DIRECT_CALCULATION"
            ],
            "modelCompatibility": [
              "DIVISION"
            ],
            "template": "{character} has {total} to spend equally on {quantity} {item}. How much can {character} spend on each one?",
            "answerTemplate": "{character} can spend {result} on each {item}",
            "placeholders": [
              {
                "key": "character",
                "type": "character"
              },
              {
                "key": "total",
                "type": "value"
              },
              {
                "key": "quantity",
                "type": "value"
              },
              {
                "key": "item",
                "type": "item"
              },
              {
                "key": "result",
                "type": "value"
              }
            ]
          },
          {
            "formatCompatibility": [
              "DIRECT_CALCULATION",
              "COMPARISON",
              "ESTIMATION",
              "MULTI_STEP"
            ],
            "template": "{character} goes to the shop and buys {items}. How much does {character} spend in total?",
            "answerTemplate": "{character} spends {result} in total",
            "placeholders": [
              {
                "key": "character",
                "type": "character"
              },
              {
                "key": "items",
                "type": "item_list"
              },
              {
                "key": "result",
                "type": "value"
              }
            ]
          },
          {
            "formatCompatibility": [
              "ESTIMATION"
            ],
            "template": "Estimate: If {character} buys {items}, about how much will it cost?",
            "answerTemplate": "It will cost approximately {result}",
            "placeholders": [
              {
                "key": "character",
                "type": "character"
              },
              {
                "key": "items",
                "type": "item_list"
              },
              {
                "key": "result",
                "type": "value"
              }
            ]
          },
          {
            "formatCompatibility": [
              "VALIDATION"
            ],
            "template": "{character} calculated that {items} costs {amount}. Is this correct?",
            "answerTemplate": "{validation_result}",
            "placeholders": [
              {
                "key": "character",
                "type": "character"
              },
              {
                "key": "items",
                "type": "item_list"
              },
              {
                "key": "amount",
                "type": "value"
              },
              {
                "key": "validation_result",
                "type": "boolean"
              }
            ]
          }
        ]
      },
      "distractors": [
        {
          "value": 92,
          "displayText": "92",
          "strategy": "WRONG_OPERATION",
          "reasoning": "Added instead of subtracting"
        },
        {
          "value": 2.52,
          "displayText": "2.52",
          "strategy": "CLOSE_VALUE",
          "reasoning": "Off by 1"
        },
        {
          "value": 0.52,
          "displayText": "0.52",
          "strategy": "CLOSE_VALUE",
          "reasoning": "Off by 1"
        }
      ],
      "enhancementStatus": {
        "level": "partial",
        "requestedFormat": "DIRECT_CALCULATION",
        "actualFormat": "DIRECT_CALCULATION",
        "featuresActive": [
          "enhanced_distractors",
          "rich_scenarios",
          "cognitive_load",
          "advanced_formats"
        ],
        "featuresPending": [],
        "isFullyEnhanced": true
      },
      "mathOutput": {
        "operation": "SUBTRACTION",
        "subtrahend": 0.48,
        "minuend": 2,
        "result": 1.52
      },
      "generationTime": 0,
      "questionId": "q_1759234386816_7htxpy8ng",
      "generationSetup": {
        "controller_used": "DIRECT_CALCULATIONController",
        "format_requested": "DIRECT_CALCULATION",
        "format_actual": "DIRECT_CALCULATION",
        "scenario_theme": "SHOPPING",
        "scenario_id": "shop-002-realistic-general",
        "scenario_selection_method": "default",
        "distractor_strategies": [
          "WRONG_OPERATION",
          "CLOSE_VALUE",
          "CLOSE_VALUE"
        ],
        "distractor_count": 3,
        "theme_variety": false,
        "format_variety": false,
        "enhancement_level": "partial",
        "features_active": [
          "enhanced_distractors",
          "rich_scenarios",
          "cognitive_load",
          "advanced_formats"
        ],
        "features_pending": [],
        "generation_time_ms": 0
      }
    }
  ],
  "metadata": {
    "format": "DIRECT_CALCULATION",
    "cognitive_load": 40,
    "curriculum_alignment": [
      "3N1c",
      "3N1d"
    ],
    "difficulty": "3.3",
    "scenario_theme": "SHOPPING",
    "distractor_strategies": [],
    "generation_time_ms": 95,
    "enhancement_status": "partial",
    "format_used": "DIRECT_CALCULATION",
    "features_active": [
      "enhanced_distractors",
      "rich_scenarios",
      "cognitive_load",
      "advanced_formats"
    ],
    "features_pending": [],
    "api_version": "2.0"
  },
  "batch_info": {
    "total_questions": 5,
    "avg_generation_time": 19,
    "success_rate": 0.8
  }
}

--- API TEST SUITE COMPLETE ---
